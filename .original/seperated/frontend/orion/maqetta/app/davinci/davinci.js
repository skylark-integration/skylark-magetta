/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/

/*
	This is an optimized version of Dojo, built for deployment and not for
	development. To get sources and documentation, please visit:

		http://dojotoolkit.org
*/

//>>built
require({cache:{"davinci/ui/widgets/ProjectToolbar":function(){
define(["dojo/_base/declare","dijit/_WidgetBase","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","system/resource","davinci/Workbench","../Rename","dojo/dom-attr","dojo/text!./templates/projectToolbar.html","dojo/i18n!../nls/ui","dijit/form/Button","dijit/form/TextBox","dijit/form/RadioButton","dijit/layout/ContentPane","./ProjectSelection"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9,_a){
return _1("davinci.ui.widgets.ProjectToolbar",[_2,_3,_4],{templateString:_9,postCreate:function(){
this.connect(this._projectSelection,"onChange",this._projectSelectionChanged);
this._currentProject=this._projectSelection.get("value");
_8.set(this._projectDelete,"title",_a.deleteProjectButtonTitle);
_8.set(this._projectRename,"title",_a.renameProjectButtonTitle);
},onChange:function(){
},_projectSelectionChanged:function(){
var _b=this._projectSelection.get("value");
if(_b==this._currentProject){
return;
}
_6.loadProject(_b);
},_delete:function(){
var _c=this._projectSelection.get("projects");
if(_c.length<2){
alert(_a.deleteOnlyProjectError);
return;
}
var _d=null;
var _e=this._projectSelection.get("value");
for(var i=0;!_d&&i<_c.length;i++){
if(_c[i]!=_e){
_d=_c[i];
}
}
if(!confirm(dojo.string.substitute(_a.areYouSureDelete,[_e]))){
return;
}
var _f=_5.findResource(_e);
_f.deleteResource().then(function(){
_6.loadProject(_d);
});
},_rename:function(){
var _10=_6.getProject();
var _11=new _7({value:_10,invalid:this._projectSelection.get("projects")});
_6.showModal(_11,_a.renameProjectDialogTitle,{height:110,width:200},function(){
var _12=_11.get("cancel");
if(!_12){
var _13=_11.get("value");
if(_13==_10){
return;
}
var _14=_5.findResource(_10);
_14.rename(_13).then(function(){
_6.loadProject(_13);
});
}
return true;
});
}});
});
},"dijit/Tooltip":function(){
require({cache:{"url:dijit/templates/Tooltip.html":"<div class=\"dijitTooltip dijitTooltipLeft\" id=\"dojoTooltip\"\n\t><div class=\"dijitTooltipContainer dijitTooltipContents\" data-dojo-attach-point=\"containerNode\" role='alert'></div\n\t><div class=\"dijitTooltipConnector\" data-dojo-attach-point=\"connectorNode\"></div\n></div>\n"}});
define("dijit/Tooltip",["dojo/_base/array","dojo/_base/declare","dojo/_base/fx","dojo/dom","dojo/dom-class","dojo/dom-geometry","dojo/dom-style","dojo/_base/lang","dojo/mouse","dojo/on","dojo/sniff","./_base/manager","./place","./_Widget","./_TemplatedMixin","./BackgroundIframe","dojo/text!./templates/Tooltip.html","./main"],function(_15,_16,fx,dom,_17,_18,_19,_1a,_1b,on,has,_1c,_1d,_1e,_1f,_20,_21,_22){
var _23=_16("dijit._MasterTooltip",[_1e,_1f],{duration:_1c.defaultDuration,templateString:_21,postCreate:function(){
this.ownerDocumentBody.appendChild(this.domNode);
this.bgIframe=new _20(this.domNode);
this.fadeIn=fx.fadeIn({node:this.domNode,duration:this.duration,onEnd:_1a.hitch(this,"_onShow")});
this.fadeOut=fx.fadeOut({node:this.domNode,duration:this.duration,onEnd:_1a.hitch(this,"_onHide")});
},show:function(_24,_25,_26,rtl,_27){
if(this.aroundNode&&this.aroundNode===_25&&this.containerNode.innerHTML==_24){
return;
}
if(this.fadeOut.status()=="playing"){
this._onDeck=arguments;
return;
}
this.containerNode.innerHTML=_24;
if(_27){
this.set("textDir",_27);
}
this.containerNode.align=rtl?"right":"left";
var pos=_1d.around(this.domNode,_25,_26&&_26.length?_26:_28.defaultPosition,!rtl,_1a.hitch(this,"orient"));
var _29=pos.aroundNodePos;
if(pos.corner.charAt(0)=="M"&&pos.aroundCorner.charAt(0)=="M"){
this.connectorNode.style.top=_29.y+((_29.h-this.connectorNode.offsetHeight)>>1)-pos.y+"px";
this.connectorNode.style.left="";
}else{
if(pos.corner.charAt(1)=="M"&&pos.aroundCorner.charAt(1)=="M"){
this.connectorNode.style.left=_29.x+((_29.w-this.connectorNode.offsetWidth)>>1)-pos.x+"px";
}else{
this.connectorNode.style.left="";
this.connectorNode.style.top="";
}
}
_19.set(this.domNode,"opacity",0);
this.fadeIn.play();
this.isShowingNow=true;
this.aroundNode=_25;
},orient:function(_2a,_2b,_2c,_2d,_2e){
this.connectorNode.style.top="";
var _2f=_2d.h,_30=_2d.w;
_2a.className="dijitTooltip "+{"MR-ML":"dijitTooltipRight","ML-MR":"dijitTooltipLeft","TM-BM":"dijitTooltipAbove","BM-TM":"dijitTooltipBelow","BL-TL":"dijitTooltipBelow dijitTooltipABLeft","TL-BL":"dijitTooltipAbove dijitTooltipABLeft","BR-TR":"dijitTooltipBelow dijitTooltipABRight","TR-BR":"dijitTooltipAbove dijitTooltipABRight","BR-BL":"dijitTooltipRight","BL-BR":"dijitTooltipLeft"}[_2b+"-"+_2c];
this.domNode.style.width="auto";
var _31=_18.position(this.domNode);
if(has("ie")==9){
_31.w+=2;
}
var _32=Math.min((Math.max(_30,1)),_31.w);
_18.setMarginBox(this.domNode,{w:_32});
if(_2c.charAt(0)=="B"&&_2b.charAt(0)=="B"){
var bb=_18.position(_2a);
var _33=this.connectorNode.offsetHeight;
if(bb.h>_2f){
var _34=_2f-((_2e.h+_33)>>1);
this.connectorNode.style.top=_34+"px";
this.connectorNode.style.bottom="";
}else{
this.connectorNode.style.bottom=Math.min(Math.max(_2e.h/2-_33/2,0),bb.h-_33)+"px";
this.connectorNode.style.top="";
}
}else{
this.connectorNode.style.top="";
this.connectorNode.style.bottom="";
}
return Math.max(0,_31.w-_30);
},_onShow:function(){
if(has("ie")){
this.domNode.style.filter="";
}
},hide:function(_35){
if(this._onDeck&&this._onDeck[1]==_35){
this._onDeck=null;
}else{
if(this.aroundNode===_35){
this.fadeIn.stop();
this.isShowingNow=false;
this.aroundNode=null;
this.fadeOut.play();
}else{
}
}
},_onHide:function(){
this.domNode.style.cssText="";
this.containerNode.innerHTML="";
if(this._onDeck){
this.show.apply(this,this._onDeck);
this._onDeck=null;
}
},_setAutoTextDir:function(_36){
this.applyTextDir(_36,has("ie")?_36.outerText:_36.textContent);
_15.forEach(_36.children,function(_37){
this._setAutoTextDir(_37);
},this);
},_setTextDirAttr:function(_38){
this._set("textDir",_38);
if(_38=="auto"){
this._setAutoTextDir(this.containerNode);
}else{
this.containerNode.dir=this.textDir;
}
}});
_22.showTooltip=function(_39,_3a,_3b,rtl,_3c){
if(_3b){
_3b=_15.map(_3b,function(val){
return {after:"after-centered",before:"before-centered"}[val]||val;
});
}
if(!_28._masterTT){
_22._masterTT=_28._masterTT=new _23();
}
return _28._masterTT.show(_39,_3a,_3b,rtl,_3c);
};
_22.hideTooltip=function(_3d){
return _28._masterTT&&_28._masterTT.hide(_3d);
};
var _28=_16("dijit.Tooltip",_1e,{label:"",showDelay:400,connectId:[],position:[],selector:"",_setConnectIdAttr:function(_3e){
_15.forEach(this._connections||[],function(_3f){
_15.forEach(_3f,function(_40){
_40.remove();
});
},this);
this._connectIds=_15.filter(_1a.isArrayLike(_3e)?_3e:(_3e?[_3e]:[]),function(id){
return dom.byId(id,this.ownerDocument);
},this);
this._connections=_15.map(this._connectIds,function(id){
var _41=dom.byId(id,this.ownerDocument),_42=this.selector,_43=_42?function(_44){
return on.selector(_42,_44);
}:function(_45){
return _45;
},_46=this;
return [on(_41,_43(_1b.enter),function(){
_46._onHover(this);
}),on(_41,_43("focusin"),function(){
_46._onHover(this);
}),on(_41,_43(_1b.leave),_1a.hitch(_46,"_onUnHover")),on(_41,_43("focusout"),_1a.hitch(_46,"_onUnHover"))];
},this);
this._set("connectId",_3e);
},addTarget:function(_47){
var id=_47.id||_47;
if(_15.indexOf(this._connectIds,id)==-1){
this.set("connectId",this._connectIds.concat(id));
}
},removeTarget:function(_48){
var id=_48.id||_48,idx=_15.indexOf(this._connectIds,id);
if(idx>=0){
this._connectIds.splice(idx,1);
this.set("connectId",this._connectIds);
}
},buildRendering:function(){
this.inherited(arguments);
_17.add(this.domNode,"dijitTooltipData");
},startup:function(){
this.inherited(arguments);
var ids=this.connectId;
_15.forEach(_1a.isArrayLike(ids)?ids:[ids],this.addTarget,this);
},getContent:function(_49){
return this.label||this.domNode.innerHTML;
},_onHover:function(_4a){
if(!this._showTimer){
this._showTimer=this.defer(function(){
this.open(_4a);
},this.showDelay);
}
},_onUnHover:function(){
if(this._showTimer){
this._showTimer.remove();
delete this._showTimer;
}
this.close();
},open:function(_4b){
if(this._showTimer){
this._showTimer.remove();
delete this._showTimer;
}
var _4c=this.getContent(_4b);
if(!_4c){
return;
}
_28.show(_4c,_4b,this.position,!this.isLeftToRight(),this.textDir);
this._connectNode=_4b;
this.onShow(_4b,this.position);
},close:function(){
if(this._connectNode){
_28.hide(this._connectNode);
delete this._connectNode;
this.onHide();
}
if(this._showTimer){
this._showTimer.remove();
delete this._showTimer;
}
},onShow:function(){
},onHide:function(){
},destroy:function(){
this.close();
_15.forEach(this._connections||[],function(_4d){
_15.forEach(_4d,function(_4e){
_4e.remove();
});
},this);
this.inherited(arguments);
}});
_28._MasterTooltip=_23;
_28.show=_22.showTooltip;
_28.hide=_22.hideTooltip;
_28.defaultPosition=["after-centered","before-centered"];
return _28;
});
},"davinci/workbench/OutlineView":function(){
define(["dojo/_base/declare","./ViewPart","../Workbench","../ui/widgets/OutlineTree","dijit/layout/ContentPane","dojo/i18n!./nls/workbench"],function(_4f,_50,_51,_52,_53,_54){
return _4f(_50,{constructor:function(_55,_56){
this.subscribe("/davinci/ui/editorSelected",this.editorChanged);
this.subscribe("/davinci/ui/context/pagerebuilt",this._pageRebuilt);
},editorChanged:function(_57){
var _58=_57.editor;
if(this.currentEditor){
if(this.currentEditor==_58){
return;
}
if(this.outlineTree){
this.removeContent();
this.outlineTree.destroy();
}
delete this.outlineProvider;
delete this.outlineTree;
delete this._toolbarID;
}
this.currentEditor=_58;
if(!_58){
return;
}
if(_58.getOutline){
this.outlineProvider=_58.getOutline();
}
var _59;
this.toolbarDiv.innerHTML="";
if(this.outlineProvider){
this.outlineProvider._outlineView=this;
this.createTree();
}else{
this.containerNode.innerHTML=_54.outlineNotAvailable;
}
},createTree:function(){
if(this.outlineTree){
this.removeContent();
}
if(this.popup){
this.popup.destroyRecursive();
}
if(this.outlineProvider&&this.outlineProvider.getModel){
this.outlineModel=this.outlineProvider.getModel(this.currentEditor);
}
var _5a={model:this.outlineModel,showRoot:this.outlineModel.showRoot,betweenThreshold:this.outlineModel.betweenThreshold,checkItemAcceptance:this.outlineModel.checkItemAcceptance,isMultiSelect:true,persist:false};
if(this.outlineProvider.getIconClass){
_5a.getIconClass=this.outlineProvider.getIconClass;
}
if(this.currentEditor.getContext){
_5a.context=this.currentEditor.getContext();
}
if(this.outlineModel.dndController){
_5a.dndController=this.outlineModel.dndController;
}
this.outlineTree=new _52(_5a);
this.container=new _53({style:"padding:0"});
this.subcontainer=dojo.doc.createElement("div");
this.subcontainer.id="dvOutlineSubcontainer";
this.subcontainer.appendChild(this.outlineTree.domNode);
this.container.domNode.appendChild(this.subcontainer);
this.setContent(this.container);
this.attachToolbar();
this.outlineTree.startup();
if(this.outlineProvider){
this.outlineProvider._tree=this.outlineTree;
}
var _5b=(this.outlineProvider.getActionsID&&this.outlineProvider.getActionsID())||"davinci.ui.outline";
this.popup=_51.createPopup({partID:_5b,domNode:this.outlineTree.domNode,openCallback:this.outlineTree.getMenuOpenCallback?this.outlineTree.getMenuOpenCallback():null});
},_getViewContext:function(){
return this.outlineProvider;
},selectionChanged:function(_5c){
if(!this.publishing["/davinci/ui/selectionChanged"]&&_5c.length&&_5c[0].model&&this.outlineTree){
this.outlineTree.selectNode([_5c[0].model]);
}
},_pageRebuilt:function(){
if(this.outlineTree){
var _5d=this.outlineTree.get("paths");
this.createTree();
this.outlineTree.set("paths",_5d);
}
},modelChanged:function(_5e){
if(this.outlineModel&&this.outlineModel.refresh){
this.outlineModel.refresh();
}else{
if(this.outlineProvider&&this.outlineProvider.getStore){
this.outlineModel.store=this.outlineProvider.getStore();
this.outlineModel.onChange(this.outlineProvider._rootItem);
}
}
}});
});
},"url:davinci/ve/actions/templates/EnableApplicationStates.html":"<div>\n\t<div class=\"dijitDialogPaneContentArea\">\n\t\t<div class='EnableAsStateContainerWidgetDiv'>\n\t\t\t${veNls.EnableApplicationStatesCurrentWidget}:\n\t\t\t<span class='EnableAsStateContainerWidgetLabel' dojoAttachPoint='widgetLabel'></span>\n\t\t</div>\n\t\t<div class='EnableAsStateContainerStatesDiv' dojoAttachPoint='statesListDiv'>\n\t\t\t//Filled in by JavaScript logic\n\t\t</div>\n\t\t<div class='EnableAsStateContainerDescriptionDiv' dojoAttachPoint='description'>\n\t\t\t//Filled in by JavaScript logic\n\t\t</div>\n\t\t<div class='EnableAsStateContainerCheckBoxDiv'>\n\t\t\t<input dojoAttachPoint=\"checkBoxWidget\" dojoType=\"dijit.form.CheckBox\" dojoAttachEvent=\"onKeyUp:_onKeyPress\" type=\"text\"></input>\n\t\t\t${veNls.EnableAsStateContainerWidgetLabel}\n\t\t</div>\n\t</div>\n\t\t\t\t\n\t<div class=\"dijitDialogPaneActionBar\">\n\t\t<button dojoType='dijit.form.Button' dojoAttachPoint='okButton' label='${commonNls.buttonOk}' class=\"maqPrimaryButton\"></button>\n\t\t<button dojoType='dijit.form.Button' dojoAttachPoint='cancelButton' label='${commonNls.buttonCancel}' class=\"maqSecondaryButton\"></button>\n\t</div>\n</div>\n","url:davinci/workbench/templates/Preferences.html":"<div style='width:100%; height: 100%'>\r\n\t<div class=\"dijitDialogPaneContentArea\">\r\n\t\t<div dojoType='dijit.layout.BorderContainer' dojoAttachPoint=\"borderContainer\" style='width:100%; height: 100%' gutters='false' liveSplitters='true' id='preferencesContainer'>\r\n\t\t\t<div dojoType='dijit.layout.ContentPane' id='pref.TreePane' splitter='true' region='leading' style='width: 200px;' minSize='100' maxSize='300'></div>\r\n\t\t\t<div dojoType='dijit.layout.ContentPane' region='center' id='pref.RightPane'></div>\r\n\t\t</div>\r\n\t</div>\r\n\t<div class=\"dijitDialogPaneActionBar\">\r\n\t\t<!-- FIXME: we don't have logic to yet implement restoreDefaults() yet. See #627\r\n\t\t<button dojoType=dijit.form.Button type=\"button\" onclick=\"davinci.workbench.Preferences.restoreDefaults();\"></button>-->\r\n\t\t<button dojoType=\"dijit.form.Button\" type=\"button\" onclick=\"davinci.workbench.Preferences.save();\" class=\"maqPrimaryButton\" type=\"submit\">${commonStrings.buttonSave}</button>\r\n\t\t<button dojoType=\"dijit.form.Button\" type=\"button\" onclick=\"davinci.workbench.Preferences.finish();\" class=\"maqSecondaryButton\">${commonStrings.buttonCancel}</button>\r\n\t</div>\r\n</div>\r\n\r\n\r\n","dijit/MenuSeparator":function(){
require({cache:{"url:dijit/templates/MenuSeparator.html":"<tr class=\"dijitMenuSeparator\">\n\t<td class=\"dijitMenuSeparatorIconCell\">\n\t\t<div class=\"dijitMenuSeparatorTop\"></div>\n\t\t<div class=\"dijitMenuSeparatorBottom\"></div>\n\t</td>\n\t<td colspan=\"3\" class=\"dijitMenuSeparatorLabelCell\">\n\t\t<div class=\"dijitMenuSeparatorTop dijitMenuSeparatorLabel\"></div>\n\t\t<div class=\"dijitMenuSeparatorBottom\"></div>\n\t</td>\n</tr>"}});
define("dijit/MenuSeparator",["dojo/_base/declare","dojo/dom","./_WidgetBase","./_TemplatedMixin","./_Contained","dojo/text!./templates/MenuSeparator.html"],function(_5f,dom,_60,_61,_62,_63){
return _5f("dijit.MenuSeparator",[_60,_61,_62],{templateString:_63,buildRendering:function(){
this.inherited(arguments);
dom.setSelectable(this.domNode,false);
},isFocusable:function(){
return false;
}});
});
},"dijit/CalendarLite":function(){
require({cache:{"url:dijit/templates/Calendar.html":"<table cellspacing=\"0\" cellpadding=\"0\" class=\"dijitCalendarContainer\" role=\"grid\" aria-labelledby=\"${id}_mddb ${id}_year\">\n\t<thead>\n\t\t<tr class=\"dijitReset dijitCalendarMonthContainer\" valign=\"top\">\n\t\t\t<th class='dijitReset dijitCalendarArrow' data-dojo-attach-point=\"decrementMonth\">\n\t\t\t\t<img src=\"${_blankGif}\" alt=\"\" class=\"dijitCalendarIncrementControl dijitCalendarDecrease\" role=\"presentation\"/>\n\t\t\t\t<span data-dojo-attach-point=\"decreaseArrowNode\" class=\"dijitA11ySideArrow\">-</span>\n\t\t\t</th>\n\t\t\t<th class='dijitReset' colspan=\"5\">\n\t\t\t\t<div data-dojo-attach-point=\"monthNode\">\n\t\t\t\t</div>\n\t\t\t</th>\n\t\t\t<th class='dijitReset dijitCalendarArrow' data-dojo-attach-point=\"incrementMonth\">\n\t\t\t\t<img src=\"${_blankGif}\" alt=\"\" class=\"dijitCalendarIncrementControl dijitCalendarIncrease\" role=\"presentation\"/>\n\t\t\t\t<span data-dojo-attach-point=\"increaseArrowNode\" class=\"dijitA11ySideArrow\">+</span>\n\t\t\t</th>\n\t\t</tr>\n\t\t<tr role=\"row\">\n\t\t\t${!dayCellsHtml}\n\t\t</tr>\n\t</thead>\n\t<tbody data-dojo-attach-point=\"dateRowsNode\" data-dojo-attach-event=\"onclick: _onDayClick\" class=\"dijitReset dijitCalendarBodyContainer\">\n\t\t\t${!dateRowsHtml}\n\t</tbody>\n\t<tfoot class=\"dijitReset dijitCalendarYearContainer\">\n\t\t<tr>\n\t\t\t<td class='dijitReset' valign=\"top\" colspan=\"7\" role=\"presentation\">\n\t\t\t\t<div class=\"dijitCalendarYearLabel\">\n\t\t\t\t\t<span data-dojo-attach-point=\"previousYearLabelNode\" class=\"dijitInline dijitCalendarPreviousYear\" role=\"button\"></span>\n\t\t\t\t\t<span data-dojo-attach-point=\"currentYearLabelNode\" class=\"dijitInline dijitCalendarSelectedYear\" role=\"button\" id=\"${id}_year\"></span>\n\t\t\t\t\t<span data-dojo-attach-point=\"nextYearLabelNode\" class=\"dijitInline dijitCalendarNextYear\" role=\"button\"></span>\n\t\t\t\t</div>\n\t\t\t</td>\n\t\t</tr>\n\t</tfoot>\n</table>\n"}});
define("dijit/CalendarLite",["dojo/_base/array","dojo/_base/declare","dojo/cldr/supplemental","dojo/date","dojo/date/locale","dojo/date/stamp","dojo/dom","dojo/dom-class","dojo/_base/event","dojo/_base/lang","dojo/sniff","dojo/string","./_WidgetBase","./_TemplatedMixin","dojo/text!./templates/Calendar.html","./hccss"],function(_64,_65,_66,_67,_68,_69,dom,_6a,_6b,_6c,has,_6d,_6e,_6f,_70){
var _71=_65("dijit.CalendarLite",[_6e,_6f],{templateString:_70,dowTemplateString:"<th class=\"dijitReset dijitCalendarDayLabelTemplate\" role=\"columnheader\"><span class=\"dijitCalendarDayLabel\">${d}</span></th>",dateTemplateString:"<td class=\"dijitReset\" role=\"gridcell\" data-dojo-attach-point=\"dateCells\"><span class=\"dijitCalendarDateLabel\" data-dojo-attach-point=\"dateLabels\"></span></td>",weekTemplateString:"<tr class=\"dijitReset dijitCalendarWeekTemplate\" role=\"row\">${d}${d}${d}${d}${d}${d}${d}</tr>",value:new Date(""),datePackage:"",dayWidth:"narrow",tabIndex:"0",currentFocus:new Date(),baseClass:"dijitCalendar",_isValidDate:function(_72){
return _72&&!isNaN(_72)&&typeof _72=="object"&&_72.toString()!=this.constructor.prototype.value.toString();
},_getValueAttr:function(){
if(this.value&&!isNaN(this.value)){
var _73=new this.dateClassObj(this.value);
_73.setHours(0,0,0,0);
if(_73.getDate()<this.value.getDate()){
_73=this.dateModule.add(_73,"hour",1);
}
return _73;
}else{
return null;
}
},_setValueAttr:function(_74,_75){
if(typeof _74=="string"){
_74=_69.fromISOString(_74);
}
_74=this._patchDate(_74);
if(this._isValidDate(_74)&&!this.isDisabledDate(_74,this.lang)){
this._set("value",_74);
this.set("currentFocus",_74);
this._markSelectedDates([_74]);
if(this._created&&(_75||typeof _75=="undefined")){
this.onChange(this.get("value"));
}
}else{
this._set("value",null);
this._markSelectedDates([]);
}
},_patchDate:function(_76){
if(_76){
_76=new this.dateClassObj(_76);
_76.setHours(1,0,0,0);
}
return _76;
},_setText:function(_77,_78){
while(_77.firstChild){
_77.removeChild(_77.firstChild);
}
_77.appendChild(_77.ownerDocument.createTextNode(_78));
},_populateGrid:function(){
var _79=new this.dateClassObj(this.currentFocus);
_79.setDate(1);
var _7a=_79.getDay(),_7b=this.dateModule.getDaysInMonth(_79),_7c=this.dateModule.getDaysInMonth(this.dateModule.add(_79,"month",-1)),_7d=new this.dateClassObj(),_7e=_66.getFirstDayOfWeek(this.lang);
if(_7e>_7a){
_7e-=7;
}
this._date2cell={};
_64.forEach(this.dateCells,function(_7f,idx){
var i=idx+_7e;
var _80=new this.dateClassObj(_79),_81,_82="dijitCalendar",adj=0;
if(i<_7a){
_81=_7c-_7a+i+1;
adj=-1;
_82+="Previous";
}else{
if(i>=(_7a+_7b)){
_81=i-_7a-_7b+1;
adj=1;
_82+="Next";
}else{
_81=i-_7a+1;
_82+="Current";
}
}
if(adj){
_80=this.dateModule.add(_80,"month",adj);
}
_80.setDate(_81);
if(!this.dateModule.compare(_80,_7d,"date")){
_82="dijitCalendarCurrentDate "+_82;
}
if(this.isDisabledDate(_80,this.lang)){
_82="dijitCalendarDisabledDate "+_82;
_7f.setAttribute("aria-disabled","true");
}else{
_82="dijitCalendarEnabledDate "+_82;
_7f.removeAttribute("aria-disabled");
_7f.setAttribute("aria-selected","false");
}
var _83=this.getClassForDate(_80,this.lang);
if(_83){
_82=_83+" "+_82;
}
_7f.className=_82+"Month dijitCalendarDateTemplate";
var _84=_80.valueOf();
this._date2cell[_84]=_7f;
_7f.dijitDateValue=_84;
this._setText(this.dateLabels[idx],_80.getDateLocalized?_80.getDateLocalized(this.lang):_80.getDate());
},this);
},_populateControls:function(){
var _85=new this.dateClassObj(this.currentFocus);
_85.setDate(1);
this.monthWidget.set("month",_85);
var y=_85.getFullYear()-1;
var d=new this.dateClassObj();
_64.forEach(["previous","current","next"],function(_86){
d.setFullYear(y++);
this._setText(this[_86+"YearLabelNode"],this.dateLocaleModule.format(d,{selector:"year",locale:this.lang}));
},this);
},goToToday:function(){
this.set("value",new this.dateClassObj());
},constructor:function(_87){
this.dateModule=_87.datePackage?_6c.getObject(_87.datePackage,false):_67;
this.dateClassObj=this.dateModule.Date||Date;
this.dateLocaleModule=_87.datePackage?_6c.getObject(_87.datePackage+".locale",false):_68;
},_createMonthWidget:function(){
return _71._MonthWidget({id:this.id+"_mw",lang:this.lang,dateLocaleModule:this.dateLocaleModule},this.monthNode);
},buildRendering:function(){
var d=this.dowTemplateString,_88=this.dateLocaleModule.getNames("days",this.dayWidth,"standAlone",this.lang),_89=_66.getFirstDayOfWeek(this.lang);
this.dayCellsHtml=_6d.substitute([d,d,d,d,d,d,d].join(""),{d:""},function(){
return _88[_89++%7];
});
var r=_6d.substitute(this.weekTemplateString,{d:this.dateTemplateString});
this.dateRowsHtml=[r,r,r,r,r,r].join("");
this.dateCells=[];
this.dateLabels=[];
this.inherited(arguments);
dom.setSelectable(this.domNode,false);
var _8a=new this.dateClassObj(this.currentFocus);
this.monthWidget=this._createMonthWidget();
this.set("currentFocus",_8a,false);
},postCreate:function(){
this.inherited(arguments);
this._connectControls();
},_connectControls:function(){
var _8b=_6c.hitch(this,function(_8c,_8d,_8e){
this.connect(this[_8c],"onclick",function(){
this._setCurrentFocusAttr(this.dateModule.add(this.currentFocus,_8d,_8e));
});
});
_8b("incrementMonth","month",1);
_8b("decrementMonth","month",-1);
_8b("nextYearLabelNode","year",1);
_8b("previousYearLabelNode","year",-1);
},_setCurrentFocusAttr:function(_8f,_90){
var _91=this.currentFocus,_92=this._getNodeByDate(_91);
_8f=this._patchDate(_8f);
this._set("currentFocus",_8f);
if(!this._date2cell||this.dateModule.difference(_91,_8f,"month")!=0){
this._populateGrid();
this._populateControls();
this._markSelectedDates([this.value]);
}
var _93=this._getNodeByDate(_8f);
_93.setAttribute("tabIndex",this.tabIndex);
if(this.focused||_90){
_93.focus();
}
if(_92&&_92!=_93){
if(has("webkit")){
_92.setAttribute("tabIndex","-1");
}else{
_92.removeAttribute("tabIndex");
}
}
},focus:function(){
this._setCurrentFocusAttr(this.currentFocus,true);
},_onDayClick:function(evt){
_6b.stop(evt);
for(var _94=evt.target;_94&&!_94.dijitDateValue;_94=_94.parentNode){
}
if(_94&&!_6a.contains(_94,"dijitCalendarDisabledDate")){
this.set("value",_94.dijitDateValue);
}
},_getNodeByDate:function(_95){
_95=this._patchDate(_95);
return _95&&this._date2cell?this._date2cell[_95.valueOf()]:null;
},_markSelectedDates:function(_96){
function _97(_98,_99){
_6a.toggle(_99,"dijitCalendarSelectedDate",_98);
_99.setAttribute("aria-selected",_98?"true":"false");
};
_64.forEach(this._selectedCells||[],_6c.partial(_97,false));
this._selectedCells=_64.filter(_64.map(_96,this._getNodeByDate,this),function(n){
return n;
});
_64.forEach(this._selectedCells,_6c.partial(_97,true));
},onChange:function(){
},isDisabledDate:function(){
},getClassForDate:function(){
}});
_71._MonthWidget=_65("dijit.CalendarLite._MonthWidget",_6e,{_setMonthAttr:function(_9a){
var _9b=this.dateLocaleModule.getNames("months","wide","standAlone",this.lang,_9a),_9c=(has("ie")==6?"":"<div class='dijitSpacer'>"+_64.map(_9b,function(s){
return "<div>"+s+"</div>";
}).join("")+"</div>");
this.domNode.innerHTML=_9c+"<div class='dijitCalendarMonthLabel dijitCalendarCurrentMonthLabel'>"+_9b[_9a.getMonth()]+"</div>";
}});
return _71;
});
},"davinci/review/model/resource/root":function(){
define(["dojo/_base/declare","davinci/model/resource/Resource","davinci/review/model/resource/Folder","davinci/Runtime","dojo/Deferred"],function(_9d,_9e,_9f,_a0,_a1){
var _a2=_9d(_9e,{constructor:function(_a3){
this.elementType="ReviewRoot";
this.name="root";
this.parent=null;
},findFile:function(_a4,_a5){
var _a6=new _a1();
this.getChildren(function(_a7){
var _a8=null;
dojo.forEach(_a7,function(_a9){
if(_a9.timeStamp==_a4){
_a8=_a9;
}
});
var _aa=null;
if(_a8!=null){
_a8.getChildren(function(_ab){
dojo.forEach(_ab,function(_ac){
if(this._fileNamesEqual(_ac.name,_a5)){
_aa=_ac;
}
}.bind(this));
_a6.resolve(_aa);
}.bind(this));
}
}.bind(this));
return _a6;
},_fileNamesEqual:function(_ad,_ae){
if(_ad.indexOf("./")!=0){
_ad="./"+_ad;
}
if(_ae.indexOf("./")!=0){
_ae="./"+_ae;
}
return _ad===_ae;
},findVersion:function(_af,_b0){
var _b1=new _a1();
this.getChildren(function(_b2){
var _b3=null;
dojo.some(_b2,function(_b4){
if(_b4.designerId==_af&&_b4.timeStamp==_b0){
_b3=_b4;
return true;
}
return false;
});
_b1.resolve(_b3);
});
return _b1;
},getChildren:function(_b5,_b6){
if(!this._isLoaded){
if(this._loading){
this._loading.push(_b5);
return;
}
this._loading=[];
this._loading.push(_b5);
_a0.serverJSONRequest({url:"cmd/listVersions",load:dojo.hitch(this,function(_b7,_b8){
this.children=[];
for(var i=0;i<_b7.length;i++){
var _b9=new _9f(dojo.mixin({name:_b7[i].versionTitle,parent:this},_b7[i]));
this.children.push(_b9);
}
this._isLoaded=true;
dojo.forEach(this._loading,function(_ba){
(_ba)(this.children);
},this);
delete this._loading;
})});
return;
}
_b5(this.children);
},getPath:function(){
return ".review/snapshot";
}});
return dojo.setObject("davinci.review.model.resource.root",new _a2());
});
},"dojox/grid/_View":function(){
require({cache:{"url:dojox/grid/resources/View.html":"<div class=\"dojoxGridView\" role=\"presentation\">\n\t<div class=\"dojoxGridHeader\" dojoAttachPoint=\"headerNode\" role=\"presentation\">\n\t\t<div dojoAttachPoint=\"headerNodeContainer\" style=\"width:9000em\" role=\"presentation\">\n\t\t\t<div dojoAttachPoint=\"headerContentNode\" role=\"row\"></div>\n\t\t</div>\n\t</div>\n\t<input type=\"checkbox\" class=\"dojoxGridHiddenFocus\" dojoAttachPoint=\"hiddenFocusNode\" role=\"presentation\" />\n\t<input type=\"checkbox\" class=\"dojoxGridHiddenFocus\" role=\"presentation\" />\n\t<div class=\"dojoxGridScrollbox\" dojoAttachPoint=\"scrollboxNode\" role=\"presentation\">\n\t\t<div class=\"dojoxGridContent\" dojoAttachPoint=\"contentNode\" hidefocus=\"hidefocus\" role=\"presentation\"></div>\n\t</div>\n</div>\n"}});
define("dojox/grid/_View",["dojo","dijit/registry","../main","dojo/_base/declare","dojo/_base/array","dojo/_base/lang","dojo/_base/connect","dojo/_base/sniff","dojo/query","dojo/_base/window","dojo/text!./resources/View.html","dojo/dnd/Source","dijit/_Widget","dijit/_TemplatedMixin","dojox/html/metrics","./util","dojo/_base/html","./_Builder","dojo/dnd/Avatar","dojo/dnd/Manager"],function(_bb,_bc,_bd,_be,_bf,_c0,_c1,has,_c2,win,_c3,_c4,_c5,_c6,_c7,_c8,_c9,_ca,_cb,_cc){
var _cd=function(_ce,_cf){
return _ce.style.cssText==undefined?_ce.getAttribute("style"):_ce.style.cssText;
};
var _d0=_be("dojox.grid._View",[_c5,_c6],{defaultWidth:"18em",viewWidth:"",templateString:_c3,classTag:"dojoxGrid",marginBottom:0,rowPad:2,_togglingColumn:-1,_headerBuilderClass:_ca._HeaderBuilder,_contentBuilderClass:_ca._ContentBuilder,postMixInProperties:function(){
this.rowNodes={};
},postCreate:function(){
this.connect(this.scrollboxNode,"onscroll","doscroll");
_c8.funnelEvents(this.contentNode,this,"doContentEvent",["mouseover","mouseout","click","dblclick","contextmenu","mousedown"]);
_c8.funnelEvents(this.headerNode,this,"doHeaderEvent",["dblclick","mouseover","mouseout","mousemove","mousedown","click","contextmenu"]);
this.content=new this._contentBuilderClass(this);
this.header=new this._headerBuilderClass(this);
if(!this.grid.isLeftToRight()){
this.headerNodeContainer.style.width="";
}
},destroy:function(){
_c9.destroy(this.headerNode);
delete this.headerNode;
for(var i in this.rowNodes){
this._cleanupRowWidgets(this.rowNodes[i]);
_c9.destroy(this.rowNodes[i]);
}
this.rowNodes={};
if(this.source){
this.source.destroy();
}
this.inherited(arguments);
},focus:function(){
if(has("ie")||has("webkit")||has("opera")){
this.hiddenFocusNode.focus();
}else{
this.scrollboxNode.focus();
}
},setStructure:function(_d1){
var vs=(this.structure=_d1);
if(vs.width&&!isNaN(vs.width)){
this.viewWidth=vs.width+"em";
}else{
this.viewWidth=vs.width||(vs.noscroll?"auto":this.viewWidth);
}
this._onBeforeRow=vs.onBeforeRow||function(){
};
this._onAfterRow=vs.onAfterRow||function(){
};
this.noscroll=vs.noscroll;
if(this.noscroll){
this.scrollboxNode.style.overflow="hidden";
}
this.simpleStructure=Boolean(vs.cells.length==1);
this.testFlexCells();
this.updateStructure();
},_cleanupRowWidgets:function(_d2){
if(_d2){
_bf.forEach(_c2("[widgetId]",_d2).map(_bc.byNode),function(w){
if(w._destroyOnRemove){
w.destroy();
delete w;
}else{
if(w.domNode&&w.domNode.parentNode){
w.domNode.parentNode.removeChild(w.domNode);
}
}
});
}
},onBeforeRow:function(_d3,_d4){
this._onBeforeRow(_d3,_d4);
if(_d3>=0){
this._cleanupRowWidgets(this.getRowNode(_d3));
}
},onAfterRow:function(_d5,_d6,_d7){
this._onAfterRow(_d5,_d6,_d7);
var g=this.grid;
_bf.forEach(_c2(".dojoxGridStubNode",_d7),function(n){
if(n&&n.parentNode){
var lw=n.getAttribute("linkWidget");
var _d8=window.parseInt(_c9.attr(n,"cellIdx"),10);
var _d9=g.getCell(_d8);
var w=_bc.byId(lw);
if(w){
n.parentNode.replaceChild(w.domNode,n);
if(!w._started){
w.startup();
}
_bb.destroy(n);
}else{
n.innerHTML="";
}
}
},this);
},testFlexCells:function(){
this.flexCells=false;
for(var j=0,row;(row=this.structure.cells[j]);j++){
for(var i=0,_da;(_da=row[i]);i++){
_da.view=this;
this.flexCells=this.flexCells||_da.isFlex();
}
}
return this.flexCells;
},updateStructure:function(){
this.header.update();
this.content.update();
},getScrollbarWidth:function(){
var _db=this.hasVScrollbar();
var _dc=_c9.style(this.scrollboxNode,"overflow");
if(this.noscroll||!_dc||_dc=="hidden"){
_db=false;
}else{
if(_dc=="scroll"){
_db=true;
}
}
return (_db?_c7.getScrollbar().w:0);
},getColumnsWidth:function(){
var h=this.headerContentNode;
return h&&h.firstChild?h.firstChild.offsetWidth:0;
},setColumnsWidth:function(_dd){
this.headerContentNode.firstChild.style.width=_dd+"px";
if(this.viewWidth){
this.viewWidth=_dd+"px";
}
},getWidth:function(){
return this.viewWidth||(this.getColumnsWidth()+this.getScrollbarWidth())+"px";
},getContentWidth:function(){
return Math.max(0,_c9._getContentBox(this.domNode).w-this.getScrollbarWidth())+"px";
},render:function(){
this.scrollboxNode.style.height="";
this.renderHeader();
if(this._togglingColumn>=0){
this.setColumnsWidth(this.getColumnsWidth()-this._togglingColumn);
this._togglingColumn=-1;
}
var _de=this.grid.layout.cells;
var _df=_c0.hitch(this,function(_e0,_e1){
!this.grid.isLeftToRight()&&(_e1=!_e1);
var inc=_e1?-1:1;
var idx=this.header.getCellNodeIndex(_e0)+inc;
var _e2=_de[idx];
while(_e2&&_e2.getHeaderNode()&&_e2.getHeaderNode().style.display=="none"){
idx+=inc;
_e2=_de[idx];
}
if(_e2){
return _e2.getHeaderNode();
}
return null;
});
if(this.grid.columnReordering&&this.simpleStructure){
if(this.source){
this.source.destroy();
}
var _e3="dojoxGrid_bottomMarker";
var _e4="dojoxGrid_topMarker";
if(this.bottomMarker){
_c9.destroy(this.bottomMarker);
}
this.bottomMarker=_c9.byId(_e3);
if(this.topMarker){
_c9.destroy(this.topMarker);
}
this.topMarker=_c9.byId(_e4);
if(!this.bottomMarker){
this.bottomMarker=_c9.create("div",{"id":_e3,"class":"dojoxGridColPlaceBottom"},win.body());
this._hide(this.bottomMarker);
this.topMarker=_c9.create("div",{"id":_e4,"class":"dojoxGridColPlaceTop"},win.body());
this._hide(this.topMarker);
}
this.arrowDim=_c9.contentBox(this.bottomMarker);
var _e5=_c9.contentBox(this.headerContentNode.firstChild.rows[0]).h;
this.source=new _c4(this.headerContentNode.firstChild.rows[0],{horizontal:true,accept:["gridColumn_"+this.grid.id],viewIndex:this.index,generateText:false,onMouseDown:_c0.hitch(this,function(e){
this.header.decorateEvent(e);
if((this.header.overRightResizeArea(e)||this.header.overLeftResizeArea(e))&&this.header.canResize(e)&&!this.header.moveable){
this.header.beginColumnResize(e);
}else{
if(this.grid.headerMenu){
this.grid.headerMenu.onCancel(true);
}
if(e.button===(has("ie")<9?1:0)){
_c4.prototype.onMouseDown.call(this.source,e);
}
}
}),onMouseOver:_c0.hitch(this,function(e){
var src=this.source;
if(src._getChildByEvent(e)){
_c4.prototype.onMouseOver.apply(src,arguments);
}
}),_markTargetAnchor:_c0.hitch(this,function(_e6){
var src=this.source;
if(src.current==src.targetAnchor&&src.before==_e6){
return;
}
if(src.targetAnchor&&_df(src.targetAnchor,src.before)){
src._removeItemClass(_df(src.targetAnchor,src.before),src.before?"After":"Before");
}
_c4.prototype._markTargetAnchor.call(src,_e6);
var _e7=_e6?src.targetAnchor:_df(src.targetAnchor,src.before);
var _e8=0;
if(!_e7){
_e7=src.targetAnchor;
_e8=_c9.contentBox(_e7).w+this.arrowDim.w/2+2;
}
var pos=_c9.position(_e7,true);
var _e9=Math.floor(pos.x-this.arrowDim.w/2+_e8);
_c9.style(this.bottomMarker,"visibility","visible");
_c9.style(this.topMarker,"visibility","visible");
_c9.style(this.bottomMarker,{"left":_e9+"px","top":(_e5+pos.y)+"px"});
_c9.style(this.topMarker,{"left":_e9+"px","top":(pos.y-this.arrowDim.h)+"px"});
if(src.targetAnchor&&_df(src.targetAnchor,src.before)){
src._addItemClass(_df(src.targetAnchor,src.before),src.before?"After":"Before");
}
}),_unmarkTargetAnchor:_c0.hitch(this,function(){
var src=this.source;
if(!src.targetAnchor){
return;
}
if(src.targetAnchor&&_df(src.targetAnchor,src.before)){
src._removeItemClass(_df(src.targetAnchor,src.before),src.before?"After":"Before");
}
this._hide(this.bottomMarker);
this._hide(this.topMarker);
_c4.prototype._unmarkTargetAnchor.call(src);
}),destroy:_c0.hitch(this,function(){
_c1.disconnect(this._source_conn);
_c1.unsubscribe(this._source_sub);
_c4.prototype.destroy.call(this.source);
if(this.bottomMarker){
_c9.destroy(this.bottomMarker);
delete this.bottomMarker;
}
if(this.topMarker){
_c9.destroy(this.topMarker);
delete this.topMarker;
}
}),onDndCancel:_c0.hitch(this,function(){
_c4.prototype.onDndCancel.call(this.source);
this._hide(this.bottomMarker);
this._hide(this.topMarker);
})});
this._source_conn=_c1.connect(this.source,"onDndDrop",this,"_onDndDrop");
this._source_sub=_c1.subscribe("/dnd/drop/before",this,"_onDndDropBefore");
this.source.startup();
}
},_hide:function(_ea){
_c9.style(_ea,{top:"-10000px","visibility":"hidden"});
},_onDndDropBefore:function(_eb,_ec,_ed){
if(_cc.manager().target!==this.source){
return;
}
this.source._targetNode=this.source.targetAnchor;
this.source._beforeTarget=this.source.before;
var _ee=this.grid.views.views;
var _ef=_ee[_eb.viewIndex];
var _f0=_ee[this.index];
if(_f0!=_ef){
_ef.convertColPctToFixed();
_f0.convertColPctToFixed();
}
},_onDndDrop:function(_f1,_f2,_f3){
if(_cc.manager().target!==this.source){
if(_cc.manager().source===this.source){
this._removingColumn=true;
}
return;
}
this._hide(this.bottomMarker);
this._hide(this.topMarker);
var _f4=function(n){
return n?_c9.attr(n,"idx"):null;
};
var w=_c9.marginBox(_f2[0]).w;
if(_f1.viewIndex!==this.index){
var _f5=this.grid.views.views;
var _f6=_f5[_f1.viewIndex];
var _f7=_f5[this.index];
if(_f6.viewWidth&&_f6.viewWidth!="auto"){
_f6.setColumnsWidth(_f6.getColumnsWidth()-w);
}
if(_f7.viewWidth&&_f7.viewWidth!="auto"){
_f7.setColumnsWidth(_f7.getColumnsWidth());
}
}
var stn=this.source._targetNode;
var stb=this.source._beforeTarget;
!this.grid.isLeftToRight()&&(stb=!stb);
var _f8=this.grid.layout;
var idx=this.index;
delete this.source._targetNode;
delete this.source._beforeTarget;
_f8.moveColumn(_f1.viewIndex,idx,_f4(_f2[0]),_f4(stn),stb);
},renderHeader:function(){
this.headerContentNode.innerHTML=this.header.generateHtml(this._getHeaderContent);
if(this.flexCells){
this.contentWidth=this.getContentWidth();
this.headerContentNode.firstChild.style.width=this.contentWidth;
}
_c8.fire(this,"onAfterRow",[-1,this.structure.cells,this.headerContentNode]);
},_getHeaderContent:function(_f9){
var n=_f9.name||_f9.grid.getCellName(_f9);
if(/^\s+$/.test(n)){
n="&nbsp;";
}
var ret=["<div class=\"dojoxGridSortNode"];
if(_f9.index!=_f9.grid.getSortIndex()){
ret.push("\">");
}else{
ret=ret.concat([" ",_f9.grid.sortInfo>0?"dojoxGridSortUp":"dojoxGridSortDown","\"><div class=\"dojoxGridArrowButtonChar\">",_f9.grid.sortInfo>0?"&#9650;":"&#9660;","</div><div class=\"dojoxGridArrowButtonNode\" role=\"presentation\"></div>","<div class=\"dojoxGridColCaption\">"]);
}
ret=ret.concat([n,"</div></div>"]);
return ret.join("");
},resize:function(){
this.adaptHeight();
this.adaptWidth();
},hasHScrollbar:function(_fa){
var _fb=this._hasHScroll||false;
if(this._hasHScroll==undefined||_fa){
if(this.noscroll){
this._hasHScroll=false;
}else{
var _fc=_c9.style(this.scrollboxNode,"overflow");
if(_fc=="hidden"){
this._hasHScroll=false;
}else{
if(_fc=="scroll"){
this._hasHScroll=true;
}else{
this._hasHScroll=(this.scrollboxNode.offsetWidth-this.getScrollbarWidth()<this.contentNode.offsetWidth);
}
}
}
}
if(_fb!==this._hasHScroll){
this.grid.update();
}
return this._hasHScroll;
},hasVScrollbar:function(_fd){
var _fe=this._hasVScroll||false;
if(this._hasVScroll==undefined||_fd){
if(this.noscroll){
this._hasVScroll=false;
}else{
var _ff=_c9.style(this.scrollboxNode,"overflow");
if(_ff=="hidden"){
this._hasVScroll=false;
}else{
if(_ff=="scroll"){
this._hasVScroll=true;
}else{
this._hasVScroll=(this.scrollboxNode.scrollHeight>this.scrollboxNode.clientHeight);
}
}
}
}
if(_fe!==this._hasVScroll){
this.grid.update();
}
return this._hasVScroll;
},convertColPctToFixed:function(){
var _100=false;
this.grid.initialWidth="";
var _101=_c2("th",this.headerContentNode);
var _102=_bf.map(_101,function(c,vIdx){
var w=c.style.width;
_c9.attr(c,"vIdx",vIdx);
if(w&&w.slice(-1)=="%"){
_100=true;
}else{
if(w&&w.slice(-2)=="px"){
return window.parseInt(w,10);
}
}
return _c9.contentBox(c).w;
});
if(_100){
_bf.forEach(this.grid.layout.cells,function(cell,idx){
if(cell.view==this){
var _103=cell.view.getHeaderCellNode(cell.index);
if(_103&&_c9.hasAttr(_103,"vIdx")){
var vIdx=window.parseInt(_c9.attr(_103,"vIdx"));
this.setColWidth(idx,_102[vIdx]);
_c9.removeAttr(_103,"vIdx");
}
}
},this);
return true;
}
return false;
},adaptHeight:function(_104){
if(!this.grid._autoHeight){
var h=(this.domNode.style.height&&parseInt(this.domNode.style.height.replace(/px/,""),10))||this.domNode.clientHeight;
var self=this;
var _105=function(){
var v;
for(var i in self.grid.views.views){
v=self.grid.views.views[i];
if(v!==self&&v.hasHScrollbar()){
return true;
}
}
return false;
};
if(_104||(this.noscroll&&_105())){
h-=_c7.getScrollbar().h;
}
_c8.setStyleHeightPx(this.scrollboxNode,h);
}
this.hasVScrollbar(true);
},adaptWidth:function(){
if(this.flexCells){
this.contentWidth=this.getContentWidth();
this.headerContentNode.firstChild.style.width=this.contentWidth;
}
var w=this.scrollboxNode.offsetWidth-this.getScrollbarWidth();
if(!this._removingColumn){
w=Math.max(w,this.getColumnsWidth())+"px";
}else{
w=Math.min(w,this.getColumnsWidth())+"px";
this._removingColumn=false;
}
var cn=this.contentNode;
cn.style.width=w;
this.hasHScrollbar(true);
},setSize:function(w,h){
var ds=this.domNode.style;
var hs=this.headerNode.style;
if(w){
ds.width=w;
hs.width=w;
}
ds.height=(h>=0?h+"px":"");
},renderRow:function(_106){
var _107=this.createRowNode(_106);
this.buildRow(_106,_107);
return _107;
},createRowNode:function(_108){
var node=document.createElement("div");
node.className=this.classTag+"Row";
if(this instanceof _bd.grid._RowSelector){
_c9.attr(node,"role","presentation");
}else{
_c9.attr(node,"role","row");
if(this.grid.selectionMode!="none"){
node.setAttribute("aria-selected","false");
}
}
node[_c8.gridViewTag]=this.id;
node[_c8.rowIndexTag]=_108;
this.rowNodes[_108]=node;
return node;
},buildRow:function(_109,_10a){
this.buildRowContent(_109,_10a);
this.styleRow(_109,_10a);
},buildRowContent:function(_10b,_10c){
_10c.innerHTML=this.content.generateHtml(_10b,_10b);
if(this.flexCells&&this.contentWidth){
_10c.firstChild.style.width=this.contentWidth;
}
_c8.fire(this,"onAfterRow",[_10b,this.structure.cells,_10c]);
},rowRemoved:function(_10d){
if(_10d>=0){
this._cleanupRowWidgets(this.getRowNode(_10d));
}
this.grid.edit.save(this,_10d);
delete this.rowNodes[_10d];
},getRowNode:function(_10e){
return this.rowNodes[_10e];
},getCellNode:function(_10f,_110){
var row=this.getRowNode(_10f);
if(row){
return this.content.getCellNode(row,_110);
}
},getHeaderCellNode:function(_111){
if(this.headerContentNode){
return this.header.getCellNode(this.headerContentNode,_111);
}
},styleRow:function(_112,_113){
_113._style=_cd(_113);
this.styleRowNode(_112,_113);
},styleRowNode:function(_114,_115){
if(_115){
this.doStyleRowNode(_114,_115);
}
},doStyleRowNode:function(_116,_117){
this.grid.styleRowNode(_116,_117);
},updateRow:function(_118){
var _119=this.getRowNode(_118);
if(_119){
_119.style.height="";
this.buildRow(_118,_119);
}
return _119;
},updateRowStyles:function(_11a){
this.styleRowNode(_11a,this.getRowNode(_11a));
},lastTop:0,firstScroll:0,_nativeScroll:false,doscroll:function(_11b){
if(has("ff")>=13){
this._nativeScroll=true;
}
var _11c=this.grid.isLeftToRight();
if(this.firstScroll<2){
if((!_11c&&this.firstScroll==1)||(_11c&&this.firstScroll===0)){
var s=_c9.marginBox(this.headerNodeContainer);
if(has("ie")){
this.headerNodeContainer.style.width=s.w+this.getScrollbarWidth()+"px";
}else{
if(has("mozilla")){
this.headerNodeContainer.style.width=s.w-this.getScrollbarWidth()+"px";
this.scrollboxNode.scrollLeft=_11c?this.scrollboxNode.clientWidth-this.scrollboxNode.scrollWidth:this.scrollboxNode.scrollWidth-this.scrollboxNode.clientWidth;
}
}
}
this.firstScroll++;
}
this.headerNode.scrollLeft=this.scrollboxNode.scrollLeft;
var top=this.scrollboxNode.scrollTop;
if(top!==this.lastTop){
this.grid.scrollTo(top);
}
this._nativeScroll=false;
},setScrollTop:function(_11d){
this.lastTop=_11d;
if(!this._nativeScroll){
this.scrollboxNode.scrollTop=_11d;
}
return this.scrollboxNode.scrollTop;
},doContentEvent:function(e){
if(this.content.decorateEvent(e)){
this.grid.onContentEvent(e);
}
},doHeaderEvent:function(e){
if(this.header.decorateEvent(e)){
this.grid.onHeaderEvent(e);
}
},dispatchContentEvent:function(e){
return this.content.dispatchEvent(e);
},dispatchHeaderEvent:function(e){
return this.header.dispatchEvent(e);
},setColWidth:function(_11e,_11f){
this.grid.setCellWidth(_11e,_11f+"px");
},update:function(){
if(!this.domNode){
return;
}
this.content.update();
this.grid.update();
var left=this.scrollboxNode.scrollLeft;
this.scrollboxNode.scrollLeft=left;
this.headerNode.scrollLeft=left;
}});
var _120=_be("dojox.grid._GridAvatar",_cb,{construct:function(){
var dd=win.doc;
var a=dd.createElement("table");
a.cellPadding=a.cellSpacing="0";
a.className="dojoxGridDndAvatar";
a.style.position="absolute";
a.style.zIndex=1999;
a.style.margin="0px";
var b=dd.createElement("tbody");
var tr=dd.createElement("tr");
var td=dd.createElement("td");
var img=dd.createElement("td");
tr.className="dojoxGridDndAvatarItem";
img.className="dojoxGridDndAvatarItemImage";
img.style.width="16px";
var _121=this.manager.source,node;
if(_121.creator){
node=_121._normalizedCreator(_121.getItem(this.manager.nodes[0].id).data,"avatar").node;
}else{
node=this.manager.nodes[0].cloneNode(true);
var _122,_123;
if(node.tagName.toLowerCase()=="tr"){
_122=dd.createElement("table");
_123=dd.createElement("tbody");
_123.appendChild(node);
_122.appendChild(_123);
node=_122;
}else{
if(node.tagName.toLowerCase()=="th"){
_122=dd.createElement("table");
_123=dd.createElement("tbody");
var r=dd.createElement("tr");
_122.cellPadding=_122.cellSpacing="0";
r.appendChild(node);
_123.appendChild(r);
_122.appendChild(_123);
node=_122;
}
}
}
node.id="";
td.appendChild(node);
tr.appendChild(img);
tr.appendChild(td);
_c9.style(tr,"opacity",0.9);
b.appendChild(tr);
a.appendChild(b);
this.node=a;
var m=_cc.manager();
this.oldOffsetY=m.OFFSET_Y;
m.OFFSET_Y=1;
},destroy:function(){
_cc.manager().OFFSET_Y=this.oldOffsetY;
this.inherited(arguments);
}});
var _124=_cc.manager().makeAvatar;
_cc.manager().makeAvatar=function(){
var src=this.source;
if(src.viewIndex!==undefined&&!_c9.hasClass(win.body(),"dijit_a11y")){
return new _120(this);
}
return _124.call(_cc.manager());
};
return _d0;
});
},"dijit/PopupMenuItem":function(){
define("dijit/PopupMenuItem",["dojo/_base/declare","dojo/dom-style","dojo/query","./registry","./MenuItem","./hccss"],function(_125,_126,_127,_128,_129){
return _125("dijit.PopupMenuItem",_129,{_fillContent:function(){
if(this.srcNodeRef){
var _12a=_127("*",this.srcNodeRef);
this.inherited(arguments,[_12a[0]]);
this.dropDownContainer=this.srcNodeRef;
}
},startup:function(){
if(this._started){
return;
}
this.inherited(arguments);
if(!this.popup){
var node=_127("[widgetId]",this.dropDownContainer)[0];
this.popup=_128.byNode(node);
}
this.ownerDocumentBody.appendChild(this.popup.domNode);
this.popup.startup();
this.popup.domNode.style.display="none";
if(this.arrowWrapper){
_126.set(this.arrowWrapper,"visibility","");
}
this.focusNode.setAttribute("aria-haspopup","true");
},destroyDescendants:function(_12b){
if(this.popup){
if(!this.popup._destroyed){
this.popup.destroyRecursive(_12b);
}
delete this.popup;
}
this.inherited(arguments);
}});
});
},"dijit/form/_FormSelectWidget":function(){
define("dijit/form/_FormSelectWidget",["dojo/_base/array","dojo/_base/Deferred","dojo/aspect","dojo/data/util/sorter","dojo/_base/declare","dojo/dom","dojo/dom-class","dojo/_base/kernel","dojo/_base/lang","dojo/query","dojo/when","dojo/store/util/QueryResults","./_FormValueWidget"],function(_12c,_12d,_12e,_12f,_130,dom,_131,_132,lang,_133,when,_134,_135){
var _136=_130("dijit.form._FormSelectWidget",_135,{multiple:false,options:null,store:null,query:null,queryOptions:null,labelAttr:"",onFetch:null,sortByLabel:true,loadChildrenOnOpen:false,onLoadDeferred:null,getOptions:function(_137){
var _138=_137,opts=this.options||[],l=opts.length;
if(_138===undefined){
return opts;
}
if(lang.isArray(_138)){
return _12c.map(_138,"return this.getOptions(item);",this);
}
if(lang.isObject(_137)){
if(!_12c.some(this.options,function(o,idx){
if(o===_138||(o.value&&o.value===_138.value)){
_138=idx;
return true;
}
return false;
})){
_138=-1;
}
}
if(typeof _138=="string"){
for(var i=0;i<l;i++){
if(opts[i].value===_138){
_138=i;
break;
}
}
}
if(typeof _138=="number"&&_138>=0&&_138<l){
return this.options[_138];
}
return null;
},addOption:function(_139){
if(!lang.isArray(_139)){
_139=[_139];
}
_12c.forEach(_139,function(i){
if(i&&lang.isObject(i)){
this.options.push(i);
}
},this);
this._loadChildren();
},removeOption:function(_13a){
if(!lang.isArray(_13a)){
_13a=[_13a];
}
var _13b=this.getOptions(_13a);
_12c.forEach(_13b,function(i){
if(i){
this.options=_12c.filter(this.options,function(node){
return (node.value!==i.value||node.label!==i.label);
});
this._removeOptionItem(i);
}
},this);
this._loadChildren();
},updateOption:function(_13c){
if(!lang.isArray(_13c)){
_13c=[_13c];
}
_12c.forEach(_13c,function(i){
var _13d=this.getOptions(i),k;
if(_13d){
for(k in i){
_13d[k]=i[k];
}
}
},this);
this._loadChildren();
},setStore:function(_13e,_13f,_140){
var _141=this.store;
_140=_140||{};
if(_141!==_13e){
var h;
while((h=this._notifyConnections.pop())){
h.remove();
}
if(!_13e.get){
lang.mixin(_13e,{_oldAPI:true,get:function(id){
var _142=new _12d();
this.fetchItemByIdentity({identity:id,onItem:function(_143){
_142.resolve(_143);
},onError:function(_144){
_142.reject(_144);
}});
return _142.promise;
},query:function(_145,_146){
var _147=new _12d(function(){
if(_148.abort){
_148.abort();
}
});
_147.total=new _12d();
var _148=this.fetch(lang.mixin({query:_145,onBegin:function(_149){
_147.total.resolve(_149);
},onComplete:function(_14a){
_147.resolve(_14a);
},onError:function(_14b){
_147.reject(_14b);
}},_146));
return new _134(_147);
}});
if(_13e.getFeatures()["dojo.data.api.Notification"]){
this._notifyConnections=[_12e.after(_13e,"onNew",lang.hitch(this,"_onNewItem"),true),_12e.after(_13e,"onDelete",lang.hitch(this,"_onDeleteItem"),true),_12e.after(_13e,"onSet",lang.hitch(this,"_onSetItem"),true)];
}
}
this._set("store",_13e);
}
if(this.options&&this.options.length){
this.removeOption(this.options);
}
if(this._queryRes&&this._queryRes.close){
this._queryRes.close();
}
if(_140.query){
this._set("query",_140.query);
this._set("queryOptions",_140.queryOptions);
}
if(_13e){
this._loadingStore=true;
this.onLoadDeferred=new _12d();
this._queryRes=_13e.query(this.query,this.queryOptions);
when(this._queryRes,lang.hitch(this,function(_14c){
if(this.sortByLabel&&!_140.sort&&_14c.length){
if(_14c[0].getValue){
_14c.sort(_12f.createSortFunction([{attribute:_13e.getLabelAttributes(_14c[0])[0]}],_13e));
}else{
var _14d=this.labelAttr;
_14c.sort(function(a,b){
return a[_14d]>b[_14d]?1:b[_14d]>a[_14d]?-1:0;
});
}
}
if(_140.onFetch){
_14c=_140.onFetch.call(this,_14c,_140);
}
_12c.forEach(_14c,function(i){
this._addOptionForItem(i);
},this);
if(this._queryRes.observe){
this._queryRes.observe(lang.hitch(this,function(_14e,_14f,_150){
if(_14f==_150){
this._onSetItem(_14e);
}else{
if(_14f!=-1){
this._onDeleteItem(_14e);
}
if(_150!=-1){
this._onNewItem(_14e);
}
}
}),true);
}
this._loadingStore=false;
this.set("value","_pendingValue" in this?this._pendingValue:_13f);
delete this._pendingValue;
if(!this.loadChildrenOnOpen){
this._loadChildren();
}else{
this._pseudoLoadChildren(_14c);
}
this.onLoadDeferred.resolve(true);
this.onSetStore();
}),function(err){
console.error("dijit.form.Select: "+err.toString());
this.onLoadDeferred.reject(err);
});
}
return _141;
},_setValueAttr:function(_151,_152){
if(!this._onChangeActive){
_152=null;
}
if(this._loadingStore){
this._pendingValue=_151;
return;
}
var opts=this.getOptions()||[];
if(!lang.isArray(_151)){
_151=[_151];
}
_12c.forEach(_151,function(i,idx){
if(!lang.isObject(i)){
i=i+"";
}
if(typeof i==="string"){
_151[idx]=_12c.filter(opts,function(node){
return node.value===i;
})[0]||{value:"",label:""};
}
},this);
_151=_12c.filter(_151,function(i){
return i&&i.value;
});
if(!this.multiple&&(!_151[0]||!_151[0].value)&&opts.length){
_151[0]=opts[0];
}
_12c.forEach(opts,function(i){
i.selected=_12c.some(_151,function(v){
return v.value===i.value;
});
});
var val=_12c.map(_151,function(i){
return i.value;
}),disp=_12c.map(_151,function(i){
return i.label;
});
if(typeof val=="undefined"||typeof val[0]=="undefined"){
return;
}
this._setDisplay(this.multiple?disp:disp[0]);
this.inherited(arguments,[this.multiple?val:val[0],_152]);
this._updateSelection();
},_getDisplayedValueAttr:function(){
var val=this.get("value");
if(!lang.isArray(val)){
val=[val];
}
var ret=_12c.map(this.getOptions(val),function(v){
if(v&&"label" in v){
return v.label;
}else{
if(v){
return v.value;
}
}
return null;
},this);
return this.multiple?ret:ret[0];
},_loadChildren:function(){
if(this._loadingStore){
return;
}
_12c.forEach(this._getChildren(),function(_153){
_153.destroyRecursive();
});
_12c.forEach(this.options,this._addOptionItem,this);
this._updateSelection();
},_updateSelection:function(){
this._set("value",this._getValueFromOpts());
var val=this.value;
if(!lang.isArray(val)){
val=[val];
}
if(val&&val[0]){
_12c.forEach(this._getChildren(),function(_154){
var _155=_12c.some(val,function(v){
return _154.option&&(v===_154.option.value);
});
_131.toggle(_154.domNode,this.baseClass.replace(/\s+|$/g,"SelectedOption "),_155);
_154.domNode.setAttribute("aria-selected",_155?"true":"false");
},this);
}
},_getValueFromOpts:function(){
var opts=this.getOptions()||[];
if(!this.multiple&&opts.length){
var opt=_12c.filter(opts,function(i){
return i.selected;
})[0];
if(opt&&opt.value){
return opt.value;
}else{
opts[0].selected=true;
return opts[0].value;
}
}else{
if(this.multiple){
return _12c.map(_12c.filter(opts,function(i){
return i.selected;
}),function(i){
return i.value;
})||[];
}
}
return "";
},_onNewItem:function(item,_156){
if(!_156||!_156.parent){
this._addOptionForItem(item);
}
},_onDeleteItem:function(item){
var _157=this.store;
this.removeOption(_157.getIdentity(item));
},_onSetItem:function(item){
this.updateOption(this._getOptionObjForItem(item));
},_getOptionObjForItem:function(item){
var _158=this.store,_159=(this.labelAttr&&this.labelAttr in item)?item[this.labelAttr]:_158.getLabel(item),_15a=(_159?_158.getIdentity(item):null);
return {value:_15a,label:_159,item:item};
},_addOptionForItem:function(item){
var _15b=this.store;
if(_15b.isItemLoaded&&!_15b.isItemLoaded(item)){
_15b.loadItem({item:item,onItem:function(i){
this._addOptionForItem(i);
},scope:this});
return;
}
var _15c=this._getOptionObjForItem(item);
this.addOption(_15c);
},constructor:function(_15d){
this._oValue=(_15d||{}).value||null;
this._notifyConnections=[];
},buildRendering:function(){
this.inherited(arguments);
dom.setSelectable(this.focusNode,false);
},_fillContent:function(){
if(!this.options){
this.options=this.srcNodeRef?_133("> *",this.srcNodeRef).map(function(node){
if(node.getAttribute("type")==="separator"){
return {value:"",label:"",selected:false,disabled:false};
}
return {value:(node.getAttribute("data-"+_132._scopeName+"-value")||node.getAttribute("value")),label:String(node.innerHTML),selected:node.getAttribute("selected")||false,disabled:node.getAttribute("disabled")||false};
},this):[];
}
if(!this.value){
this._set("value",this._getValueFromOpts());
}else{
if(this.multiple&&typeof this.value=="string"){
this._set("value",this.value.split(","));
}
}
},postCreate:function(){
this.inherited(arguments);
this.connect(this,"onChange","_updateSelection");
var _15e=this.store;
if(_15e&&(_15e.getIdentity||_15e.getFeatures()["dojo.data.api.Identity"])){
this.store=null;
this.setStore(_15e,this._oValue);
}
},startup:function(){
this._loadChildren();
this.inherited(arguments);
},destroy:function(){
var h;
while((h=this._notifyConnections.pop())){
h.remove();
}
if(this._queryRes&&this._queryRes.close){
this._queryRes.close();
}
this.inherited(arguments);
},_addOptionItem:function(){
},_removeOptionItem:function(){
},_setDisplay:function(){
},_getChildren:function(){
return [];
},_getSelectedOptionsAttr:function(){
return this.getOptions(this.get("value"));
},_pseudoLoadChildren:function(){
},onSetStore:function(){
}});
return _136;
});
},"davinci/ve/widgets/MultiInputDropDown":function(){
define("davinci/ve/widgets/MultiInputDropDown",["dojo/_base/declare","dijit/_WidgetBase","davinci/ve/widgets/MutableStore","dijit/form/ComboBox","dojo/i18n!davinci/ve/nls/ve","dojo/i18n!dijit/nls/common"],function(_15f,_160,_161,_162,_163,_164){
var _165=_15f("davinci.ve.widgets.MultiInputDropDown",[_160],{numberDelta:1,insertPosition:1,data:null,postCreate:function(){
this.domNode.removeAttribute("data-dojo-type");
this.domNode.removeAttribute("dojoType");
var _166=dojo.doc.createElement("div");
this._run={};
if(!this.data){
this.data=[{value:""},{value:"auto"},{value:"0px"},{value:_165.divider},{value:"Remove Value",run:function(){
this.set("value","");
}},{value:_165.divider},{value:"Help",run:function(){
alert("help!");
}}];
}else{
this.data.push({value:_165.divider});
this.data.push({value:"Remove Value",run:function(){
this.set("value","");
}});
}
var _167=[];
for(var i=0;i<this.data.length;i++){
_167.push(this.data[i].value);
if(this.data[i].run){
this._run[this.data[i].value]=this.data[i].run;
}
}
this._store=new _161({values:_167,divider:_165.divider});
this._dropDown=new _162({store:this._store,required:false,style:"width:100%"});
var _168=dojo.doc.createElement("div");
dojo.style(_168,"float","right");
this._plus=dojo.doc.createElement("button");
dojo.addClass(this._plus,"incrementButton");
dojo.addClass(this._plus,"propertyButton");
_168.appendChild(this._plus);
this._minus=dojo.doc.createElement("button");
dojo.addClass(this._minus,"decrementButton");
dojo.addClass(this._minus,"propertyButton");
_168.appendChild(this._minus);
_166.appendChild(_168);
var div=dojo.create("div",{"class":"propInputWithIncrDecrButtons"});
div.appendChild(this._dropDown.domNode);
_166.appendChild(div);
div=dojo.doc.createElement("div");
dojo.style(div,"clear","both");
_166.appendChild(div);
this._currentValue=this._store.getItemNumber(0);
dojo.connect(this._dropDown,"onKeyUp",this,"_updateSpinner");
dojo.connect(this._dropDown,"onChange",this,"_onChange");
dojo.connect(this._plus,"onclick",this,"_plusButton",false);
dojo.connect(this._minus,"onclick",this,"_minusButton",false);
this._updateSpinner();
this.domNode.appendChild(_166);
},_setReadOnlyAttr:function(_169){
this._isReadOnly=_169;
this._dropDown.set("disabled",_169);
dojo.attr(this._plus,"disabled",_169);
dojo.attr(this._minus,"disabled",_169);
},onChange:function(_16a){
},_getValueAttr:function(){
return this._dropDown.get("value");
},_setValueAttr:function(_16b,_16c){
this._dropDown.set("value",_16b,true);
this._currentValue=this._dropDown.get("value");
this._onChange(this._currentValue);
if(!_16c){
this.onChange();
}
},_changeValue:function(_16d,_16e){
var _16f=_16d.split(" ");
var _170="";
for(var i=0;i<_16f.length;i++){
if(i>0){
_170+=" ";
}
var bits=_16f[i].match(/([-\d\.]+)([a-zA-Z%]*)/);
if(!bits){
_170+=_16f[i];
}else{
if(bits.length==1){
_170+=bits[0];
}else{
for(var z=1;z<bits.length;z++){
if(!isNaN(bits[z])&&bits[z]!=""){
_170+=parseFloat(bits[z])+_16e;
}else{
_170+=bits[z];
}
}
}
}
}
return _170;
},_plusButton:function(){
var _171=this._dropDown.get("value");
var _172=this._changeValue(_171,this.numberDelta);
this._store.modifyItem(_171,_172);
this._dropDown.set("value",_172);
},_minusButton:function(){
var _173=this._dropDown.get("value");
var _174=this._changeValue(_173,-1*this.numberDelta);
this._store.modifyItem(_173,_174);
this._dropDown.set("value",_174);
},_updateSpinner:function(){
var _175=this._dropDown.get("value");
var _176=/(-?)(\d+){1}/;
var _177=_176.exec(_175);
if(_177&&_177.length){
this._minus.disabled=this._plus.disabled=false;
}else{
this._minus.disabled=this._plus.disabled=true;
}
return true;
},_onChange:function(_178){
var _179;
if(_178 in this._run){
this._dropDown.get("value",this._store.getItemNumber(0));
dojo.hitch(this,this._run[_178])();
}else{
if(_178==_165.divider){
this._dropDown.get("value",this._store.getItemNumber(0));
}else{
if(_179=this._store.findSimilar(_178)){
this._store.modifyItem(_179,_178);
}else{
if(!this._store.contains(_178)){
this._store.insert(this.insertPosition,_178);
}
}
}
}
if(this._currentValue!=this._dropDown.get("value")){
this._currentValue=this._dropDown.get("value");
this.onChange(_178);
}
this._updateSpinner();
}});
return dojo.mixin(_165,{divider:"---"});
});
},"davinci/ve/utils/ImageUtils":function(){
define("davinci/ve/utils/ImageUtils",[],function(){
return {ImageUpdateFocus:function(_17a,_17b){
if(_17b&&_17a&&_17a.domNode&&_17a.domNode.tagName==="IMG"){
var conn=dojo.connect(_17a.domNode,"onload",function(){
var _17c=_17b.getSelection();
for(var i=0;i<_17c.length;i++){
if(_17c[i]==_17a){
_17b.updateFocus(_17a,i);
break;
}
}
dojo.disconnect(conn);
});
}
}};
});
},"dojox/grid/_SelectionPreserver":function(){
define("dojox/grid/_SelectionPreserver",["dojo/_base/declare","dojo/_base/connect","dojo/_base/lang","dojo/_base/array"],function(_17d,_17e,lang,_17f){
return _17d("dojox.grid._SelectionPreserver",null,{constructor:function(_180){
this.selection=_180;
var grid=this.grid=_180.grid;
this.reset();
this._connects=[_17e.connect(grid,"_setStore",this,"reset"),_17e.connect(grid,"_addItem",this,"_reSelectById"),_17e.connect(_180,"onSelected",lang.hitch(this,"_selectById",true)),_17e.connect(_180,"onDeselected",lang.hitch(this,"_selectById",false)),_17e.connect(_180,"deselectAll",this,"reset")];
},destroy:function(){
this.reset();
_17f.forEach(this._connects,_17e.disconnect);
delete this._connects;
},reset:function(){
this._selectedById={};
},_reSelectById:function(item,_181){
if(item&&this.grid._hasIdentity){
this.selection.selected[_181]=this._selectedById[this.grid.store.getIdentity(item)];
}
},_selectById:function(_182,_183){
if(this.selection.mode=="none"||!this.grid._hasIdentity){
return;
}
var item=_183,g=this.grid;
if(typeof _183=="number"||typeof _183=="string"){
var _184=g._by_idx[_183];
item=_184&&_184.item;
}
if(item){
this._selectedById[g.store.getIdentity(item)]=!!_182;
}
return item;
}});
});
},"davinci/html/ui/ImageViewer":function(){
define("davinci/html/ui/ImageViewer",["dojo/_base/declare","davinci/ve/utils/URLRewrite"],function(_185,_186){
return _185("davinci.html.ui.ImageViewer",null,{isReadOnly:true,constructor:function(_187){
this.element=_187;
},save:function(){
},getDefaultContent:function(){
},supports:function(_188){
return false;
},setContent:function(_189,_18a){
this.fileName=_189;
this.element.innerHTML="<div style='overflow:auto'>"+"<img src='"+_186.encodeURI(this.resourceFile.getURL())+"'/>"+"</div>";
this.dirty=false;
},destroy:function(){
}});
});
},"davinci/ve/DijitWidget":function(){
define(["dojo/_base/declare","dojo/_base/window","dojo/_base/lang","dojo/dom-attr","dojo/parser","./_Widget","./metadata"],function(_18b,_18c,_18d,_18e,_18f,_190,_191){
var _192="__DijitWidgetScratchSpace";
return _18b("davinci.ve.DijitWidget",_190,{isDijitWidget:true,constructor:function(_193,node,_194,_195,_196){
if(typeof _194==="string"){
var type=_18e.get(node,"data-dojo-type")||_18e.get(node,"dojoType");
if(!type){
_18e.set(node,"data-dojo-type",_194);
}
if(_196){
_196.addAttribute("data-dojo-type",_194);
}
var doc=node.ownerDocument,win=doc.defaultView,ss=doc[_192];
if(!ss){
ss=doc[_192]=doc.createElement("div");
}
ss.appendChild(node);
var _197=win.require("dojo/parser").instantiate([node],_193,{noStart:true});
_194=_197[0];
if(ss.firstChild){
ss.removeChild(ss.firstChild);
}
this.domNode=_194.domNode;
_194.domNode._dvWidget=this;
this.isLayoutContainer=_194.isLayoutContainer;
}else{
this.type=_194.declaredClass;
}
var _198=davinci.ve.metadata.getAllowedChild(this.type);
this.acceptsHTMLChildren=_198[0]==="ANY"||_198.indexOf("HTML")!==-1;
this.dijitWidget=_194;
this.containerNode=_194.containerNode;
this.styleNode=_194.styleNode;
this.id=_194.id;
},getParent:function(){
var _199;
if(!this.dijitWidget||!this.dijitWidget.domNode||!this.dijitWidget.domNode.parentNode){
return;
}
do{
_199=require("davinci/ve/widget").getEnclosingWidget(this.dijitWidget.domNode.parentNode);
}while(_199&&_199.dijitWidget&&_199.dijitWidget.declaredClass.split(".").pop().charAt(0)=="_");
return _199;
},_getChildren:function(_19a){
if(this.acceptsHTMLChildren){
return this.inherited(arguments);
}
var _19b=[];
if(davinci.ve.metadata.getAllowedChild(this.type)[0]!=="NONE"){
this.dijitWidget.getChildren().forEach(function(_19c){
if(_19a){
_19b.push(require("davinci/ve/widget").getWidget(_19c.domNode));
}else{
var _19d=_19c.domNode&&_19c.domNode._dvWidget;
if(_19d){
_19b.push(_19d);
}
}
});
}
return _19b;
},_getContainerNode:function(){
return this.containerNode||this.domNode;
},selectChild:function(_19e){
if(this.dijitWidget.selectChild){
this.dijitWidget.selectChild(_19e.dijitWidget);
}
},addChild:function(_19f,_1a0){
if(this.dijitWidget.addChild&&_19f.dijitWidget){
if(typeof _1a0==="number"&&_1a0>=0){
var _1a1=this.getChildren();
if(_1a0<_1a1.length){
this._srcElement.insertBefore(_19f._srcElement,_1a1[_1a0]._srcElement);
}else{
this._srcElement.addChild(_19f._srcElement);
}
if(!this.acceptsHTMLChildren){
this._addChildHelper(_19f.dijitWidget,_1a0);
}else{
this._addChildHooked(_19f.dijitWidget,_1a0);
}
}else{
this._srcElement.addChild(_19f._srcElement);
this._addChildHelper(_19f.dijitWidget);
}
}else{
this.inherited(arguments);
}
},_addChildHelper:function(_1a2,_1a3){
var _1a4=this.getHelper();
if(_1a4&&_1a4.addChild){
_1a4.addChild(this,_1a2,_1a3);
}else{
this.dijitWidget.addChild(_1a2,_1a3);
}
},_addChildHooked:function(_1a5,_1a6){
var _1a7=this.dijitWidget,_1a8=_1a7.getChildren;
_1a7.getChildren=dojo.hitch(this,this.getChildren);
var _1a9=this.getHelper();
if(_1a9&&_1a9.addChild){
_1a9.addChild(this,_1a5,_1a6);
}else{
_1a7.addChild(_1a5,_1a6);
}
_1a7.getChildren=_1a8;
},removeChild:function(_1aa){
if(!_1aa){
return;
}
if(this.dijitWidget.removeChild&&_1aa.dijitWidget){
this.dijitWidget.removeChild(_1aa.dijitWidget);
this._srcElement.removeChild(_1aa._srcElement);
}else{
this.inherited(arguments);
}
},_getPropertyValue:function(name){
return this.dijitWidget.get(name);
},startup:function(){
this.dijitWidget.startup();
},isLayout:function(){
var _1ab=this.getContext();
var djit=_1ab.getDijit();
var _1ac=this.dijitWidget.isInstanceOf(djit.layout._LayoutWidget);
return _1ac;
},resize:function(){
var _1ad=this.getHelper();
if(_1ad&&_1ad.resize){
_1ad.resize(this);
}else{
if(this.dijitWidget.resize){
this.dijitWidget.resize();
}
}
},renderWidget:function(){
if(this.dijitWidget.render){
this.dijitWidget.render();
}else{
if(this.dijitWidget.chart){
var box=dojo.marginBox(this.dijitWidget.domNode);
this.dijitWidget.resize(box);
}
}
if(this.domNode.parentNode._dvWidget&&this.domNode.parentNode._dvWidget.isDijitWidget){
this._refresh(this.domNode.parentNode);
}
},_refresh:function(node){
var _1ae=node.parentNode;
if(_1ae._dvWidget&&_1ae._dvWidget.isDijitWidget){
this._refresh(_1ae);
}else{
if(node._dvWidget.resize){
node._dvWidget.resize();
}
}
},_attr:function(name,_1af){
return this.dijitWidget.get.apply(this.dijitWidget,arguments);
}});
});
},"davinci/ve/widgets/EventSelection":function(){
define(["dojo/_base/declare","dojo/_base/connect","../../workbench/ViewLite","./HTMLStringUtil","davinci/ve/States","../commands/ModifyCommand"],function(_1b0,_1b1,_1b2,_1b3,_1b4,_1b5){
var _1b6=function(root){
var _1b7=[];
var _1b8=root&&_1b4.getAllStateContainers(root);
if(_1b8){
for(var j=0;j<_1b8.length;j++){
var _1b9=_1b4.getStates(_1b8[j]);
_1b7=_1b7.concat(_1b9);
}
}
var _1ba=[""];
for(var i=0;i<_1b7.length;i++){
var val=_1b7[i]+":State";
if(_1ba.indexOf(val)<0){
_1ba.push(val);
}
}
return _1ba;
};
var _1bb=function(_1bc){
_1bc.replace(/'/,"\\'");
_1bc.replace(/"/,"\\\"");
if(_1bc&&_1bc.match(/.*:State$/)){
_1bc="davinci.states.setState('"+_1bc.substring(0,_1bc.length-":State".length)+"')";
}
return _1bc;
};
var _1bd=function(_1be){
if(_1be&&_1be.match(/^davinci.states.setState\('.*'\)$/)){
var _1bf=_1be.substring("davinci.states.setState('".length,_1be.length-2);
_1be=_1bf+":State";
}
return _1be;
};
var _1c0=_1b0("davinci.ve.widgets.EventSelection",[_1b2],{pageTemplate:[{display:"onclick",target:"onclick",type:"state",hideCascade:true},{display:"ondblclick",target:"ondblclick",type:"state",hideCascade:true},{display:"onmousedown",target:"onmousedown",type:"state",hideCascade:true},{display:"onmouseup",target:"onmouseup",type:"state",hideCascade:true},{display:"onmouseover",target:"onmouseover",type:"state",hideCascade:true},{display:"onmousemove",target:"onmousemove",type:"state",hideCascade:true},{display:"onmouseout",target:"onmouseout",type:"state",hideCascade:true},{display:"onkeypress",target:"onkeypress",type:"state",hideCascade:true},{display:"onkeydown",target:"onkeydown",type:"state",hideCascade:true},{display:"onkeyup",target:"onkeyup",type:"state",hideCascade:true},{display:"onfocus",target:"onfocus",type:"state",hideCascade:true},{display:"onblur",target:"onblur",type:"state",hideCascade:true}],buildRendering:function(){
this.domNode=dojo.doc.createElement("div");
this.domNode.innerHTML=_1b3.generateTable(this.pageTemplate,{zeroSpaceForIncrDecr:true});
this.inherited(arguments);
},setReadOnly:function(_1c1){
for(var i=0;i<this.pageTemplate.length;i++){
var _1c2=this.pageTemplate[i].widget;
if(_1c2){
_1c2.set("readOnly",_1c1);
}else{
var node=this.pageTemplate[i].domNode;
if(node){
dojo.attr(node,"disabled",_1c1);
}
}
}
},startup:function(){
this.inherited(arguments);
function _1c3(_1c4){
return function(){
return this._onChange({target:_1c4});
};
};
for(var i=0;i<this.pageTemplate.length;i++){
var box=dijit.byId(this.pageTemplate[i].id);
this.pageTemplate[i].widget=box;
_1b1.connect(box,"onChange",this,_1c3(i));
}
this._buildSelectionValues();
_1b1.subscribe("/davinci/ui/context/loaded",dojo.hitch(this,this._buildSelectionValues));
_1b1.subscribe("/davinci/states/stored",dojo.hitch(this,this._buildSelectionValues));
_1b1.subscribe("/davinci/states/state/added",dojo.hitch(this,this._buildSelectionValues));
_1b1.subscribe("/davinci/states/state/removed",dojo.hitch(this,this._updateValues));
_1b1.subscribe("/davinci/states/state/renamed",dojo.hitch(this,this._updateValues));
_1b1.subscribe("/davinci/ui/widgetPropertiesChanged",dojo.hitch(this,this._widgetPropertiesChanged));
this.setReadOnly(true);
},onEditorSelected:function(){
if(!this._editor||!this._editor.supports("states")){
delete this._editor;
}
this._buildSelectionValues();
},_onChange:function(a){
var _1c5=a.target;
var _1c6=dijit.byId(this.pageTemplate[_1c5].id);
var _1c7=_1c6.get("value");
_1c7=_1bb(_1c7);
var _1c8={};
_1c8[this.pageTemplate[_1c5].target]=_1c7;
var _1c9=new davinci.ve.commands.EventCommand(this._widget,_1c8);
dojo.publish("/davinci/ui/widgetPropertiesChanges",[{source:this._editor.editor_id,command:_1c9}]);
},_getRoot:function(){
var _1ca=this._editor,root;
if(_1ca&&_1ca.getContext){
var _1cb=_1ca.getContext();
root=_1cb&&_1cb.rootNode;
}
return root;
},_updateValues:function(e){
if(!e||!e.node||!e.node._dvWidget){
return;
}
var _1cc=e.node._dvWidget;
this._buildSelectionValues();
if(_1cc==this._widget){
this._setValues();
}
},onWidgetSelectionChange:function(){
if(!this._widget){
this.setReadOnly(true);
this._clearValues();
return;
}else{
this._setValues();
this.setReadOnly(false);
}
},_clearValues:function(){
for(var i=0;i<this.pageTemplate.length;i++){
var box=dijit.byId(this.pageTemplate[i].id);
box.set("value","",false);
}
},_buildSelectionValues:function(){
var root=this._getRoot();
var _1cd=_1b6(root);
for(var i=0;i<this.pageTemplate.length;i++){
var box=dijit.byId(this.pageTemplate[i].id);
box.store.clearValues();
box.store.setValues(_1cd);
}
},_setValues:function(){
for(var i=0;i<this.pageTemplate.length;i++){
var name=this.pageTemplate[i].target;
var _1ce=this._widget;
var _1cf="";
if(_1ce.properties&&_1ce.properties[name]){
_1cf=_1ce.properties[name];
}else{
_1cf=_1ce._srcElement.getAttribute(name);
}
_1cf=_1bd(_1cf);
var box=dijit.byId(this.pageTemplate[i].id);
if(box){
box.set("value",_1cf,false);
}
}
},_widgetPropertiesChanged:function(data){
this._updateValues({widget:data[0]});
}});
_1c0.getEventSelectionValues=_1b6;
_1c0.getEventScriptFromValue=_1bb;
_1c0.getValueFromEventScript=_1bd;
return _1c0;
});
},"davinci/ve/actions/EditValueAction":function(){
define("davinci/ve/actions/EditValueAction",["dojo/_base/declare","davinci/ve/actions/ContextAction"],function(_1d0,_1d1){
return _1d0("davinci.ve.actions.EditValueAction",[_1d1],{run:function(_1d2){
_1d2=this.fixupContext(_1d2);
if(_1d2){
if(_1d2.declaredClass!=="davinci.ve.Context"){
return;
}
var _1d3=_1d2.getSelection();
if(_1d3.length!==1){
return;
}
_1d2.select(_1d3[0],false,true);
}
},isEnabled:function(_1d4){
_1d4=this.fixupContext(_1d4);
return (_1d4&&_1d4.getSelection().length>0);
},shouldShow:function(_1d5){
_1d5=this.fixupContext(_1d5);
var _1d6=_1d5?_1d5.editor:null;
return (_1d6&&_1d6.declaredClass=="davinci.ve.PageEditor");
}});
});
},"dijit/form/_ListMouseMixin":function(){
define("dijit/form/_ListMouseMixin",["dojo/_base/declare","dojo/mouse","dojo/on","dojo/touch","./_ListBase"],function(_1d7,_1d8,on,_1d9,_1da){
return _1d7("dijit.form._ListMouseMixin",_1da,{postCreate:function(){
this.inherited(arguments);
this.own(on(this.domNode,_1d9.press,function(evt){
evt.preventDefault();
}));
this._listConnect(_1d9.press,"_onMouseDown");
this._listConnect(_1d9.release,"_onMouseUp");
this._listConnect(_1d8.enter,"_onMouseOver");
this._listConnect(_1d8.leave,"_onMouseOut");
},_onMouseDown:function(evt,_1db){
if(this._hoveredNode){
this.onUnhover(this._hoveredNode);
this._hoveredNode=null;
}
this._isDragging=true;
this._setSelectedAttr(_1db);
},_onMouseUp:function(evt,_1dc){
this._isDragging=false;
var _1dd=this.selected;
var _1de=this._hoveredNode;
if(_1dd&&_1dc==_1dd){
this.onClick(_1dd);
}else{
if(_1de&&_1dc==_1de){
this._setSelectedAttr(_1de);
this.onClick(_1de);
}
}
},_onMouseOut:function(evt,_1df){
if(this._hoveredNode){
this.onUnhover(this._hoveredNode);
this._hoveredNode=null;
}
if(this._isDragging){
this._cancelDrag=(new Date()).getTime()+1000;
}
},_onMouseOver:function(evt,_1e0){
if(this._cancelDrag){
var time=(new Date()).getTime();
if(time>this._cancelDrag){
this._isDragging=false;
}
this._cancelDrag=null;
}
this._hoveredNode=_1e0;
this.onHover(_1e0);
if(this._isDragging){
this._setSelectedAttr(_1e0);
}
}});
});
},"davinci/ve/actions/MoveToBackAction":function(){
define("davinci/ve/actions/MoveToBackAction",["dojo/_base/declare","./_ReorderAction","davinci/commands/CompoundCommand","davinci/ve/commands/ReparentCommand"],function(_1e1,_1e2,_1e3,_1e4){
return _1e1("davinci.ve.actions.MoveToBackAction",[_1e2],{name:"MoveToBack",iconClass:"editActionIcon editMoveToBackIcon",run:function(_1e5){
_1e5=this.fixupContext(_1e5);
if(!_1e5){
return;
}
var _1e6=(_1e5&&_1e5.getSelection)?_1e5.getSelection():[];
if(_1e6.length===0){
return;
}
if(!this.selectionSameParentAllAbsolute(_1e6)){
return;
}
var _1e7=_1e6[0].getParent();
var _1e8=this.getAbsoluteSiblings(_1e6[0]);
var _1e9=new _1e3();
for(var i=_1e8.length-1;i>=0;i--){
var _1ea=_1e8[i];
if(_1e6.indexOf(_1ea)>=0){
_1e9.add(new _1e4(_1ea,_1e7,0));
}
}
_1e5.getCommandStack().execute(_1e9);
},isEnabled:function(_1eb){
_1eb=this.fixupContext(_1eb);
var _1ec=(_1eb&&_1eb.getSelection)?_1eb.getSelection():[];
if(_1ec.length===0){
return false;
}
if(!this.selectionSameParentAllAbsolute(_1ec)){
return false;
}
var _1ed=this.getAbsoluteSiblings(_1ec[0]);
for(var j=0;j<_1ec.length;j++){
var _1ee=_1ec[j];
if(_1ed.indexOf(_1ee)>(_1ec.length-1)){
return true;
}
}
return false;
}});
});
},"dojo/date/locale":function(){
define("dojo/date/locale",["../_base/lang","../_base/array","../date","../cldr/supplemental","../i18n","../regexp","../string","../i18n!../cldr/nls/gregorian","module"],function(lang,_1ef,date,_1f0,i18n,_1f1,_1f2,_1f3,_1f4){
var _1f5={};
lang.setObject(_1f4.id.replace(/\//g,"."),_1f5);
function _1f6(_1f7,_1f8,_1f9,_1fa){
return _1fa.replace(/([a-z])\1*/ig,function(_1fb){
var s,pad,c=_1fb.charAt(0),l=_1fb.length,_1fc=["abbr","wide","narrow"];
switch(c){
case "G":
s=_1f8[(l<4)?"eraAbbr":"eraNames"][_1f7.getFullYear()<0?0:1];
break;
case "y":
s=_1f7.getFullYear();
switch(l){
case 1:
break;
case 2:
if(!_1f9.fullYear){
s=String(s);
s=s.substr(s.length-2);
break;
}
default:
pad=true;
}
break;
case "Q":
case "q":
s=Math.ceil((_1f7.getMonth()+1)/3);
pad=true;
break;
case "M":
case "L":
var m=_1f7.getMonth();
if(l<3){
s=m+1;
pad=true;
}else{
var _1fd=["months",c=="L"?"standAlone":"format",_1fc[l-3]].join("-");
s=_1f8[_1fd][m];
}
break;
case "w":
var _1fe=0;
s=_1f5._getWeekOfYear(_1f7,_1fe);
pad=true;
break;
case "d":
s=_1f7.getDate();
pad=true;
break;
case "D":
s=_1f5._getDayOfYear(_1f7);
pad=true;
break;
case "e":
case "c":
var d=_1f7.getDay();
if(l<2){
s=(d-_1f0.getFirstDayOfWeek(_1f9.locale)+8)%7;
break;
}
case "E":
d=_1f7.getDay();
if(l<3){
s=d+1;
pad=true;
}else{
var _1ff=["days",c=="c"?"standAlone":"format",_1fc[l-3]].join("-");
s=_1f8[_1ff][d];
}
break;
case "a":
var _200=_1f7.getHours()<12?"am":"pm";
s=_1f9[_200]||_1f8["dayPeriods-format-wide-"+_200];
break;
case "h":
case "H":
case "K":
case "k":
var h=_1f7.getHours();
switch(c){
case "h":
s=(h%12)||12;
break;
case "H":
s=h;
break;
case "K":
s=(h%12);
break;
case "k":
s=h||24;
break;
}
pad=true;
break;
case "m":
s=_1f7.getMinutes();
pad=true;
break;
case "s":
s=_1f7.getSeconds();
pad=true;
break;
case "S":
s=Math.round(_1f7.getMilliseconds()*Math.pow(10,l-3));
pad=true;
break;
case "v":
case "z":
s=_1f5._getZone(_1f7,true,_1f9);
if(s){
break;
}
l=4;
case "Z":
var _201=_1f5._getZone(_1f7,false,_1f9);
var tz=[(_201<=0?"+":"-"),_1f2.pad(Math.floor(Math.abs(_201)/60),2),_1f2.pad(Math.abs(_201)%60,2)];
if(l==4){
tz.splice(0,0,"GMT");
tz.splice(3,0,":");
}
s=tz.join("");
break;
default:
throw new Error("dojo.date.locale.format: invalid pattern char: "+_1fa);
}
if(pad){
s=_1f2.pad(s,l);
}
return s;
});
};
_1f5._getZone=function(_202,_203,_204){
if(_203){
return date.getTimezoneName(_202);
}else{
return _202.getTimezoneOffset();
}
};
_1f5.format=function(_205,_206){
_206=_206||{};
var _207=i18n.normalizeLocale(_206.locale),_208=_206.formatLength||"short",_209=_1f5._getGregorianBundle(_207),str=[],_20a=lang.hitch(this,_1f6,_205,_209,_206);
if(_206.selector=="year"){
return _20b(_209["dateFormatItem-yyyy"]||"yyyy",_20a);
}
var _20c;
if(_206.selector!="date"){
_20c=_206.timePattern||_209["timeFormat-"+_208];
if(_20c){
str.push(_20b(_20c,_20a));
}
}
if(_206.selector!="time"){
_20c=_206.datePattern||_209["dateFormat-"+_208];
if(_20c){
str.push(_20b(_20c,_20a));
}
}
return str.length==1?str[0]:_209["dateTimeFormat-"+_208].replace(/\{(\d+)\}/g,function(_20d,key){
return str[key];
});
};
_1f5.regexp=function(_20e){
return _1f5._parseInfo(_20e).regexp;
};
_1f5._parseInfo=function(_20f){
_20f=_20f||{};
var _210=i18n.normalizeLocale(_20f.locale),_211=_1f5._getGregorianBundle(_210),_212=_20f.formatLength||"short",_213=_20f.datePattern||_211["dateFormat-"+_212],_214=_20f.timePattern||_211["timeFormat-"+_212],_215;
if(_20f.selector=="date"){
_215=_213;
}else{
if(_20f.selector=="time"){
_215=_214;
}else{
_215=_211["dateTimeFormat-"+_212].replace(/\{(\d+)\}/g,function(_216,key){
return [_214,_213][key];
});
}
}
var _217=[],re=_20b(_215,lang.hitch(this,_218,_217,_211,_20f));
return {regexp:re,tokens:_217,bundle:_211};
};
_1f5.parse=function(_219,_21a){
var _21b=/[\u200E\u200F\u202A\u202E]/g,info=_1f5._parseInfo(_21a),_21c=info.tokens,_21d=info.bundle,re=new RegExp("^"+info.regexp.replace(_21b,"")+"$",info.strict?"":"i"),_21e=re.exec(_219&&_219.replace(_21b,""));
if(!_21e){
return null;
}
var _21f=["abbr","wide","narrow"],_220=[1970,0,1,0,0,0,0],amPm="",_221=_1ef.every(_21e,function(v,i){
if(!i){
return true;
}
var _222=_21c[i-1],l=_222.length,c=_222.charAt(0);
switch(c){
case "y":
if(l!=2&&_21a.strict){
_220[0]=v;
}else{
if(v<100){
v=Number(v);
var year=""+new Date().getFullYear(),_223=year.substring(0,2)*100,_224=Math.min(Number(year.substring(2,4))+20,99);
_220[0]=(v<_224)?_223+v:_223-100+v;
}else{
if(_21a.strict){
return false;
}
_220[0]=v;
}
}
break;
case "M":
case "L":
if(l>2){
var _225=_21d["months-"+(c=="L"?"standAlone":"format")+"-"+_21f[l-3]].concat();
if(!_21a.strict){
v=v.replace(".","").toLowerCase();
_225=_1ef.map(_225,function(s){
return s.replace(".","").toLowerCase();
});
}
v=_1ef.indexOf(_225,v);
if(v==-1){
return false;
}
}else{
v--;
}
_220[1]=v;
break;
case "E":
case "e":
case "c":
var days=_21d["days-"+(c=="c"?"standAlone":"format")+"-"+_21f[l-3]].concat();
if(!_21a.strict){
v=v.toLowerCase();
days=_1ef.map(days,function(d){
return d.toLowerCase();
});
}
v=_1ef.indexOf(days,v);
if(v==-1){
return false;
}
break;
case "D":
_220[1]=0;
case "d":
_220[2]=v;
break;
case "a":
var am=_21a.am||_21d["dayPeriods-format-wide-am"],pm=_21a.pm||_21d["dayPeriods-format-wide-pm"];
if(!_21a.strict){
var _226=/\./g;
v=v.replace(_226,"").toLowerCase();
am=am.replace(_226,"").toLowerCase();
pm=pm.replace(_226,"").toLowerCase();
}
if(_21a.strict&&v!=am&&v!=pm){
return false;
}
amPm=(v==pm)?"p":(v==am)?"a":"";
break;
case "K":
if(v==24){
v=0;
}
case "h":
case "H":
case "k":
if(v>23){
return false;
}
_220[3]=v;
break;
case "m":
_220[4]=v;
break;
case "s":
_220[5]=v;
break;
case "S":
_220[6]=v;
}
return true;
});
var _227=+_220[3];
if(amPm==="p"&&_227<12){
_220[3]=_227+12;
}else{
if(amPm==="a"&&_227==12){
_220[3]=0;
}
}
var _228=new Date(_220[0],_220[1],_220[2],_220[3],_220[4],_220[5],_220[6]);
if(_21a.strict){
_228.setFullYear(_220[0]);
}
var _229=_21c.join(""),_22a=_229.indexOf("d")!=-1,_22b=_229.indexOf("M")!=-1;
if(!_221||(_22b&&_228.getMonth()>_220[1])||(_22a&&_228.getDate()>_220[2])){
return null;
}
if((_22b&&_228.getMonth()<_220[1])||(_22a&&_228.getDate()<_220[2])){
_228=date.add(_228,"hour",1);
}
return _228;
};
function _20b(_22c,_22d,_22e,_22f){
var _230=function(x){
return x;
};
_22d=_22d||_230;
_22e=_22e||_230;
_22f=_22f||_230;
var _231=_22c.match(/(''|[^'])+/g),_232=_22c.charAt(0)=="'";
_1ef.forEach(_231,function(_233,i){
if(!_233){
_231[i]="";
}else{
_231[i]=(_232?_22e:_22d)(_233.replace(/''/g,"'"));
_232=!_232;
}
});
return _22f(_231.join(""));
};
function _218(_234,_235,_236,_237){
_237=_1f1.escapeString(_237);
if(!_236.strict){
_237=_237.replace(" a"," ?a");
}
return _237.replace(/([a-z])\1*/ig,function(_238){
var s,c=_238.charAt(0),l=_238.length,p2="",p3="";
if(_236.strict){
if(l>1){
p2="0"+"{"+(l-1)+"}";
}
if(l>2){
p3="0"+"{"+(l-2)+"}";
}
}else{
p2="0?";
p3="0{0,2}";
}
switch(c){
case "y":
s="\\d{2,4}";
break;
case "M":
case "L":
s=(l>2)?"\\S+?":"1[0-2]|"+p2+"[1-9]";
break;
case "D":
s="[12][0-9][0-9]|3[0-5][0-9]|36[0-6]|"+p2+"[1-9][0-9]|"+p3+"[1-9]";
break;
case "d":
s="3[01]|[12]\\d|"+p2+"[1-9]";
break;
case "w":
s="[1-4][0-9]|5[0-3]|"+p2+"[1-9]";
break;
case "E":
case "e":
case "c":
s="\\S+";
break;
case "h":
s="1[0-2]|"+p2+"[1-9]";
break;
case "k":
s="1[01]|"+p2+"\\d";
break;
case "H":
s="1\\d|2[0-3]|"+p2+"\\d";
break;
case "K":
s="1\\d|2[0-4]|"+p2+"[1-9]";
break;
case "m":
case "s":
s="[0-5]\\d";
break;
case "S":
s="\\d{"+l+"}";
break;
case "a":
var am=_236.am||_235["dayPeriods-format-wide-am"],pm=_236.pm||_235["dayPeriods-format-wide-pm"];
s=am+"|"+pm;
if(!_236.strict){
if(am!=am.toLowerCase()){
s+="|"+am.toLowerCase();
}
if(pm!=pm.toLowerCase()){
s+="|"+pm.toLowerCase();
}
if(s.indexOf(".")!=-1){
s+="|"+s.replace(/\./g,"");
}
}
s=s.replace(/\./g,"\\.");
break;
default:
s=".*";
}
if(_234){
_234.push(_238);
}
return "("+s+")";
}).replace(/[\xa0 ]/g,"[\\s\\xa0]");
};
var _239=[];
_1f5.addCustomFormats=function(_23a,_23b){
_239.push({pkg:_23a,name:_23b});
};
_1f5._getGregorianBundle=function(_23c){
var _23d={};
_1ef.forEach(_239,function(desc){
var _23e=i18n.getLocalization(desc.pkg,desc.name,_23c);
_23d=lang.mixin(_23d,_23e);
},this);
return _23d;
};
_1f5.addCustomFormats(_1f4.id.replace(/\/date\/locale$/,".cldr"),"gregorian");
_1f5.getNames=function(item,type,_23f,_240){
var _241,_242=_1f5._getGregorianBundle(_240),_243=[item,_23f,type];
if(_23f=="standAlone"){
var key=_243.join("-");
_241=_242[key];
if(_241[0]==1){
_241=undefined;
}
}
_243[1]="format";
return (_241||_242[_243.join("-")]).concat();
};
_1f5.isWeekend=function(_244,_245){
var _246=_1f0.getWeekend(_245),day=(_244||new Date()).getDay();
if(_246.end<_246.start){
_246.end+=7;
if(day<_246.start){
day+=7;
}
}
return day>=_246.start&&day<=_246.end;
};
_1f5._getDayOfYear=function(_247){
return date.difference(new Date(_247.getFullYear(),0,1,_247.getHours()),_247)+1;
};
_1f5._getWeekOfYear=function(_248,_249){
if(arguments.length==1){
_249=0;
}
var _24a=new Date(_248.getFullYear(),0,1).getDay(),adj=(_24a-_249+7)%7,week=Math.floor((_1f5._getDayOfYear(_248)+adj-1)/7);
if(_24a==_249){
week++;
}
return week;
};
return _1f5;
});
},"davinci/ve/tools/CreateTool":function(){
define(["dojo/_base/declare","../tools/_Tool","davinci/Workbench","davinci/workbench/Preferences","../metadata","../widget","dojo/Deferred","dojo/promise/all","davinci/commands/CompoundCommand","../commands/AddCommand","../commands/MoveCommand","../commands/ResizeCommand","../commands/StyleCommand"],function(_24b,_24c,_24d,_24e,_24f,_250,_251,all,_252,_253,_254,_255,_256){
var _257="The selected target is not a valid parent for the given widget.";
return _24b("davinci.ve.tools.CreateTool",_24c,{constructor:function(data){
this._data=data;
if(data&&data.type){
var _258=_24f.queryDescriptor(data.type,"resizableOnCreate");
var _259=_258||_24f.queryDescriptor(data.type,"resizable");
if(_259!=="none"){
this._resizable=_259;
}
this._dropCursor=_24f.queryDescriptor(data.type,"dropCursor");
}
this._requireHelpers(data);
},activate:function(_25a){
this._context=_25a;
if(_25a&&_25a.rootNode){
this._oldCursor=_25a.rootNode.style.cursor;
}
_25a.rootNode.style.cursor="crosshair";
},deactivate:function(){
if(this._context&&this._context.rootNode){
this._context.rootNode.style.cursor=this._oldCursor;
}
this._setTarget(null);
delete this._mdPosition;
this._context.dragMoveCleanup();
},onMouseDown:function(_25b){
this._target=_250.getEnclosingWidget(_25b.target);
this._mdPosition=this._context.getContentPosition(_25b);
this._dragRect=null;
},onMouseMove:function(_25c){
var _25d=this._context;
var cp=_25d._chooseParent;
if(_25c.target!=this._lastEventTarget){
cp.setProposedParentWidget(null);
}
this._lastEventTarget=_25c.target;
if(this._mdPosition){
if(this._resizable){
_25d.deselect();
var p=_25d.getContentPosition(_25c);
var l,t,w,h;
var _25e=true;
var _25f=true;
if(p.x>=this._mdPosition.x){
l=this._mdPosition.x;
w=p.x-this._mdPosition.x;
}else{
l=p.x;
w=this._mdPosition.x-p.x;
_25e=false;
}
if(p.y>=this._mdPosition.y){
t=this._mdPosition.y;
h=p.y-this._mdPosition.y;
}else{
t=p.y;
h=this._mdPosition.y-p.y;
_25f=false;
}
if(_25c.shiftKey){
if(w>=h){
h=w;
if(!_25f){
t=this._mdPosition.y-h;
}
}else{
w=h;
if(!_25e){
l=this._mdPosition.x-w;
}
}
}
if(!this._dragSizeRect){
var body=_25d.getDocument().body;
this._dragSizeRect=dojo.create("div",{style:"border:1px dashed black;z-index:1000001;position:absolute;"},body);
}
var _260=this._dragSizeRect.style;
_260.left=l+"px";
_260.top=t+"px";
_260.width=w+"px";
_260.height=h+"px";
if(w>4||h>4){
var box={l:l,t:t,w:(w>0?w:1),h:(h>0?h:1)};
_25d.focus({box:box,op:{}});
}else{
_25d.focus(null);
}
}
}else{
var _261=!this.createWithFlowLayout();
this._setTarget(_25c.target,_25c);
var _262=_25d.getPreference("showPossibleParents");
var _263=(!_262&&this._spaceKeyDown)||(_262&&!this._spaceKeyDown);
var _264={x:_25c.pageX,y:_25c.pageY};
var box={l:_25c.pageX,t:_25c.pageY,w:0,h:0};
var _265=_24e.getPreferences("davinci.ve.editorPrefs",_24d.getProject());
var _266=_265.snap&&_261;
var _267=_266;
var _268=!_261;
if(typeof this._dropCursor=="object"&&this._dropCursor.show===false){
_268=false;
}
var _269=this._dropCursor&&this._dropCursor.beforeAfter;
_25d.dragMoveUpdate({data:this._data,position:_264,absolute:_261,currentParent:null,eventTarget:_25c.target,rect:box,doSnapLinesX:_266,doSnapLinesY:_267,doFindParentsXY:_263,doCursor:_268,beforeAfter:_269});
}
},onMouseUp:function(_26a){
var _26b=this._context;
var cp=_26b._chooseParent;
var _26c=!this.createWithFlowLayout();
if(this._dragSizeRect){
var _26d=this._dragSizeRect.parentNode;
_26d.removeChild(this._dragSizeRect);
this._dragSizeRect=null;
}
var _26e=_26b.getActiveDragDiv();
if(_26e){
var _26f=dojo.query(".maqCandidateParents",_26e);
if(_26f.length==1){
_26f[0].innerHTML="";
}
}
this._lastEventTarget=null;
var size,_270,w,h;
var p=_26b.getContentPosition(_26a);
if(this._mdPosition){
var _271=true;
var _272=true;
this._position=dojo.mixin({},this._mdPosition);
if(p.x<this._mdPosition.x){
this._position.x=p.x;
}
if(this._resizable=="height"){
w=0;
}else{
if(p.x-this._mdPosition.x>=0){
w=p.x-this._mdPosition.x;
}else{
w=this._mdPosition.x-p.x;
_271=false;
}
}
if(p.y<this._mdPosition.y){
this._position.y=p.y;
}
if(this._resizable=="width"){
h=0;
}else{
if(p.y-this._mdPosition.y>=0){
h=p.y-this._mdPosition.y;
}else{
h=this._mdPosition.y-p.y;
_272=false;
}
}
if(_26a.shiftKey){
if(w>=h){
h=w;
if(!_272){
t=this._mdPosition.y-h;
}
}else{
w=h;
if(!_271){
l=this._mdPosition.x-w;
}
}
}
}else{
this._position=p;
}
if(this._resizable&&this._position){
var w,h;
if(w>4||h>4){
size={w:(w>0?w:undefined),h:(h>0?h:undefined)};
}
}
var ppw=cp.getProposedParentWidget();
if(ppw){
_270=ppw.parent;
if(ppw.refChild){
var _273=ppw.parent.getChildren();
var idx=_273.indexOf(ppw.refChild);
if(idx>=0){
if(ppw.refAfter){
idx++;
}
}else{
idx=null;
}
}
}else{
var _274=this._getTarget()||_250.getEnclosingWidget(_26a.target);
var data=this._data;
var _275=cp.getAllowedTargetWidget(_274,data,true,{absolute:_26c});
var _276=dojo.isArray(data)?data[0].type:data.type;
var _277=_250.getWidgetHelper(_276);
if(_275.length>1&&_277&&_277.chooseParent){
_270=_277.chooseParent(_275);
}else{
if(_275.length>0){
if(_275.indexOf(_274)>=0){
_270=_274;
}else{
_270=_275[0];
}
}
}
}
cp.setProposedParentWidget(null);
var _278=function(_279){
this.prototype=Error.prototype;
this.name="InvalidTargetWidgetError";
this.message=_279?_279:_257;
};
try{
var data=this._data instanceof Array?this._data:[this._data];
if(!_270){
function _27a(type){
var _27b=_24f.queryDescriptor(type,"class");
if(_27b){
return _27b.split(/\s+/).push(type);
}
return [type];
};
var _27c=data.map(function(elem){
return elem.type;
}).join(", "),_27d=data.map(function(elem){
return {allowedParent:_24f.getAllowedParent(elem.type),classList:_27a(elem.type)};
});
var _27e=_257;
if(_27d.length===1&&_27d[0].allowedParent){
_27e+=["The widget <span style=\"font-family: monospace\">",_27c,"</span> requires ",_27d[0].allowedParent.length>1?"one of the following parent types":"the parent type"," <span style=\"font-family: monospace\">",_27d[0].allowedParent.join(", "),"</span>."].join("");
var _276=data[0].type;
var _277=_250.getWidgetHelper(_276);
if(_277&&_277.isAllowedError){
_27e=_277.isAllowedError({errorMsg:_27e,type:_276,allowedParent:_27d[0].allowedParent,absolute:_26c});
}
}
throw new _278(_27e);
}
for(var i=0;i<data.length;i++){
var type=data[i].type;
var _27f=_24f.getLibraryForType(type),_280=_27f.name,args=[type,_26b];
if(!_26b._widgets.hasOwnProperty(_280)){
_26b._widgets[_280]=0;
}
if(++_26b._widgets[_280]==1){
_24f.invokeCallback(_27f,"onFirstAdd",args);
}
_24f.invokeCallback(_27f,"onAdd",args);
}
this.create({target:_270,index:idx,directTarget:this._getTarget(),size:size});
}
catch(e){
var _281,_282;
if(e instanceof _278){
_281=e.message;
_282="Invalid Target";
}else{
_281="The action was interrupted by an internal error.";
_282="Error";
console.error(e);
}
_24d.showMessage(_282,_281);
}
finally{
if(this.exitCreateToolOnMouseUp()){
_26b.setActiveTool(null);
}
this._cleanupActions();
}
},_cleanupActions:function(){
var _283=this._context;
_283.dragMoveCleanup();
if(!_283.inlineEditActive()){
var _284=this._context.getDocument();
_284.defaultView.focus();
}
},onKeyDown:function(_285){
dojo.stopEvent(_285);
var _286=this._context;
if(_285.keyCode==dojo.keys.ESCAPE){
_286.setActiveTool(null);
this._cleanupActions();
return;
}
var _287=this._context.getPreference("showPossibleParents");
if(_285.keyCode==dojo.keys.SPACE){
this._spaceKeyDown=true;
}else{
this._processKeyDown(_285.keyCode);
}
var _288=(!_287&&this._spaceKeyDown)||(_287&&!this._spaceKeyDown);
var data=this._data;
var _289=dojo.isArray(data)?data[0].type:data.type;
var cp=_286._chooseParent;
var _28a=!this.createWithFlowLayout();
var _28b=!_28a;
if(typeof this._dropCursor=="object"&&this._dropCursor.show===false){
_28b=false;
}
var _28c=this._dropCursor&&this._dropCursor.beforeAfter;
var _28d=null;
cp.dragUpdateCandidateParents({widgetType:_289,showCandidateParents:_288,absolute:_28a,doCursor:_28b,beforeAfter:_28c,currentParent:_28d});
},_processKeyDown:function(_28e){
if(_28e>=49&&_28e<=57){
var _28f=this._context;
var cp=_28f._chooseParent;
var _290=cp.getProposedParentsList();
if(_290&&_290.length>1){
var _291=_290.length-(_28e-48);
if(_291>=0){
cp.setProposedParentWidget(_290[_291]);
}
}
}
},onKeyUp:function(_292){
if(_292.keyCode==dojo.keys.SPACE){
this._spaceKeyDown=false;
}
dojo.stopEvent(_292);
var _293=this._context.getPreference("showPossibleParents");
var _294=(!_293&&this._spaceKeyDown)||(_293&&!this._spaceKeyDown);
var data=this._data;
var _295=dojo.isArray(data)?data[0].type:data.type;
var _296=this._context;
var cp=_296._chooseParent;
var _297=!this.createWithFlowLayout();
var _298=!_297;
if(typeof this._dropCursor=="object"&&this._dropCursor.show===false){
_298=false;
}
var _299=this._dropCursor&&this._dropCursor.beforeAfter;
var _29a=null;
cp.dragUpdateCandidateParents({widgetType:_295,showCandidateParents:_294,absolute:_297,doCursor:_298,beforeAfter:_299,currentParent:_29a});
},_requireHelpers:function(data){
var _29b=[];
if(!data||!data.type){
if(data instanceof Array){
data.forEach(function(d){
_29b.concat(this._requireHelpers(d));
},this);
}
return _29b;
}
_29b.push(_250.requireWidgetHelper(data.type));
if(data.children&&!dojo.isString(data.children)){
if(!dojo.every(data.children,function(c){
return _29b.concat(this._requireHelpers(c));
},this)){
return _29b;
}
}
return _29b;
},create:function(args){
if(!args||!this._data){
return;
}
var _29c=args.target,_29d,_29e;
while(_29c){
_29d=_29c.getContainerNode();
if(_29d){
break;
}
_29e=_29c;
_29c=_29c.getParent();
}
var _29f=args.index;
var _2a0;
var _2a1=false;
if(this._data.properties&&this._data.properties.style&&(this._data.properties.style.indexOf("absolute")>0)){
_2a1=true;
}
if(!_2a1&&this.createWithFlowLayout()){
if(_29e){
_29f=_29c.indexOf(_29e);
}
}else{
if(args.position){
_2a0=args.position;
}else{
if(this._position){
_2a0=this._position;
}
}
}
this._data.context=this._context;
all(this._requireHelpers(this._data)).then(function(){
this._create({parent:_29c,index:_29f,position:_2a0,size:args.size});
}.bind(this));
},_create:function(args){
var _2a2=this._context,_2a3=[],_2a4=new _251();
if(!this._loadType(this._data,_2a3)){
_2a4.reject();
return _2a4;
}
all(_2a3).then(function(){
var w;
if(this.createNewWidget()){
dojo.withDoc(this._context.getDocument(),function(){
w=_250.createWidget(this._data);
},this);
}else{
w=this._widget;
}
if(!w){
_2a4.reject(new Error("Failed to create widget"));
}
var _2a5=new davinci.commands.CompoundCommand();
if(this.createNewWidget()){
args.size=this._getInitialSize(w,args);
_2a5.add(new _253(w,args.parent||this._context.getContainerNode(),args.index));
if(args.position){
var _2a6=_2a2.getPreference("absoluteWidgetsZindex");
_2a5.add(new _256(w,[{position:"absolute"},{"z-index":_2a6}]));
_2a5.add(new _254(w,args.position.x,args.position.y));
}
if(args.size){
var _2a7=args.size.w,_2a8=args.size.h;
_2a5.add(new _255(w,_2a7,_2a8));
var _2a9=_250.getWidgetHelper(w.type);
if(_2a9&&_2a9.onCreateResize){
_2a9.onCreateResize(_2a5,w,_2a7,_2a8);
}
}
}
var w_id=w.id;
if(this.addToCommandStack){
this.addToCommandStack(_2a5,{widget:w});
}
if(!_2a5.isEmpty()){
this._context.getCommandStack().execute(_2a5);
}
if(w.isLayoutContainer){
w.resize();
}
var w=_250.byId(w_id);
this._select(w);
this._widget=w;
_2a4.resolve(w);
this.mouseUpProcessingCompleted();
}.bind(this));
return _2a4;
},_loadType:function(data,_2aa){
if(!data||!data.type){
return false;
}
_2aa.push(this._context.loadRequires(data.type,true));
if(data.children&&!dojo.isString(data.children)){
dojo.forEach(data.children,function(c){
this._loadType(c,_2aa);
}.bind(this));
}
return true;
},_getInitialSize:function(w,args){
var _2ab=args.size;
var _2ac=w.getHelper();
if(_2ac&&_2ac.initialSize){
var size=_2ac.initialSize(args);
if(size){
_2ab=size;
}
}
if(!_2ab){
var _2ad=_24f.queryDescriptor(w.type,"initialSize");
if(_2ad){
if(args&&!args.position){
var _2ae=args.parent;
if(_2ae.type=="html.body"){
if(_2ad=="auto"||_2ad.flow=="auto"){
_2ab={w:"100%",h:"auto"};
}else{
_2ab=this._getExplicitFlowSizeFromMetadata(_2ad);
}
}else{
if(this._isTypeContainer(_2ae.type)){
if(_2ad=="auto"||_2ad.flow=="auto"){
var _2af=_2ae.getData().children;
_2ab={w:"100%",h:(_2af&&_2af.length)?"auto":"100%"};
}else{
_2ab=this._getExplicitFlowSizeFromMetadata(_2ad);
}
}else{
_2ab=this._getExplicitFlowSizeFromMetadata(_2ad);
}
}
}else{
if(_2ad=="auto"||_2ad.absolute=="auto"){
_2ab={w:"300px",h:"300px"};
}else{
_2ab=this._getExplicitAbsoluteSizeFromMetadata(_2ad);
}
}
}
}
return _2ab;
},_getExplicitFlowSizeFromMetadata:function(_2b0){
var _2b1=null;
if(_2b0.flow){
_2b1={w:_2b0.flow.width?_2b0.flow.width:"100%",h:_2b0.flow.height?_2b0.flow.height:"auto"};
}else{
_2b1={w:_2b0.width?_2b0.width:"100%",h:_2b0.height?_2b0.height:"auto"};
}
return _2b1;
},_getExplicitAbsoluteSizeFromMetadata:function(_2b2){
var _2b3=null;
if(_2b2.absolute){
_2b3={w:_2b2.absolute.width?_2b2.absolute.width:"300px",h:_2b2.absolute.height?_2b2.absolute.height:"300px",};
}else{
_2b3={w:_2b2.width?_2b2.width:"300px",h:_2b2.height?_2b2.height:"300px"};
}
return _2b3;
},_isTypeContainer:function(type){
return type&&(type=="dijit.layout.ContentPane"||type=="html.div"||type=="html.form"||type=="html.fieldset");
},_select:function(w){
_24f.getSmartInput(w.type).then(function(_2b4){
if(!this._data.fileDragCreate&&_2b4&&_2b4.displayOnCreate){
w.inLineEdit_displayOnCreate=_2b4.displayOnCreate;
this._context.select(w,null,true);
}else{
this._context.select(w);
}
}.bind(this));
},createWithFlowLayout:function(){
var _2b5=_24f.queryDescriptor(this._data.type,"forceAbsolute");
if(_2b5){
return false;
}else{
return this._context.getFlowLayout();
}
},createNewWidget:function(){
return true;
},exitCreateToolOnMouseUp:function(){
return true;
},mouseUpProcessingCompleted:function(){
}});
});
},"url:dijit/layout/templates/_ScrollingTabControllerButton.html":"<div data-dojo-attach-event=\"onclick:_onClick\" class=\"dijitTabInnerDiv dijitTabContent dijitButtonContents\"  data-dojo-attach-point=\"focusNode\">\n\t<img role=\"presentation\" alt=\"\" src=\"${_blankGif}\" class=\"dijitTabStripIcon\" data-dojo-attach-point=\"iconNode\"/>\n\t<span data-dojo-attach-point=\"containerNode,titleNode\" class=\"dijitButtonText\"></span>\n</div>","davinci/ve/ThemeModifier":function(){
define(["dojo/_base/declare","../model/Path","../model/Factory","./utils/URLRewrite","./commands/ModifyRuleCommand","./commands/StyleCommand","dojo/i18n!davinci/ve/nls/common","system/resource"],function(_2b6,Path,_2b7,_2b8,_2b9,_2ba,_2bb,_2bc){
return _2b6("davinci.ve.ThemeModifier",null,{_getCssFiles:function(){
if(this.cssFiles){
return this.cssFiles;
}
this.cssFiles=[];
if(this.themeCssFiles){
var _2bd=this._themePath.getParentPath();
this.cssFiles=this.themeCssFiles.map(function(_2be){
return _2b7.getModel({url:_2bd.append(_2be).toString(),includeImports:true,});
});
}
return this.cssFiles;
},_getThemeResource:function(_2bf){
var _2c0=this._themePath.getParentPath().append(_2bf).toString();
return system.resource.findResource(_2c0);
},getDeltaRule:function(rule){
var _2c1=null;
var _2c2=this.cssFiles[0];
var _2c3=rule.getSelectorText();
this.cssFiles.forEach(function(file){
var _2c4=file.getRules(_2c3);
if(_2c4.length>0){
_2c2=file;
}
_2c4.forEach(function(r){
if(r.parent.url==file.url){
_2c1=r;
}
}.bind(this));
}.bind(this));
if(!_2c1&&_2c2){
_2c1=_2c2.addRule(_2c3+" {}");
}
return _2c1;
},_markDirty:function(file,_2c5){
if(!this._dirtyResource){
this._dirtyResource={};
}
this._dirtyResource[file]={time:Date.now(),modelObject:_2c5};
this._srcChanged();
},getCommandForStyleChange:function(_2c6){
var _2c7=this,_2c8=_2c7.getSelection(),_2c9=_2c8.length?_2c8[_2c8.length-1]:undefined;
if(_2c8.length>1){
_2c7.select(_2c9);
}
var _2ca=null;
if(_2c6.appliesTo=="inline"){
var _2cb=[];
var _2cc=new Path(this.fileName);
for(var i=0;i<_2c6.values.length;i++){
for(var name in _2c6.values[i]){
if(_2b8.containsUrl(_2c6.values[i][name])&&!_2b8.isAbsolute(_2c6.values[i][name])){
var _2cd=new Path(_2b8.getUrl(_2c6.values[i][name]));
if(!_2cd.isAbsolute){
var _2ce=_2cd.relativeTo(_2cc).toString();
var _2cf=_2b8.replaceUrl(_2c6.values[i][name],_2ce);
_2cb.push(a);
}else{
var a={};
a[name]=_2c6.values[i][name];
_2cb.push(a);
}
}else{
var a={};
a[name]=_2c6.values[i][name];
_2cb.push(a);
}
}
}
_2ca=new _2ba(_2c9,_2cb,_2c6.applyToWhichStates);
}else{
var rule=null;
if(_2c6.appliesTo.type=="proposal"){
var _2d0=_2c7.model.find({elementType:"CSSFile",relativeURL:_2c6.appliesTo.targetFile},true);
if(!_2d0&&_2c7.cssFiles){
for(var i=0;_2c7.cssFiles.length;i++){
if(_2c7.cssFiles[i].url===_2c6.appliesTo.targetFile){
_2d0=_2c7.cssFiles[i];
break;
}
}
if(!_2d0){
return;
}
}
var rule=_2d0.addRule(_2c6.appliesTo.ruleString+" {}");
}else{
rule=_2c6.appliesTo.rule;
}
var _2ca=new _2b9(rule,_2c6.values,_2c7);
}
return _2ca;
},saveDynamicCssFiles:function(_2d1,_2d2){
var _2d3={visit:function(node){
if(node.elementType=="CSSFile"&&node.isDirty()){
var _2d4=node.save(_2d2);
_2d4.then(function(){
if(!_2d2){
_2bc.findResource(node.url).removeWorkingCopy();
}
node.dirtyResource=_2d2;
}.bind(this),function(_2d5){
alert(dojo.string.substitute(_2bb.errorSavingFile,[node.url,_2d5]));
}.bind(this));
}
return false;
}};
if(_2d1){
_2d1.forEach(function(file){
file.visit(_2d3);
}.bind(this));
}
},dirtyDynamicCssFiles:function(_2d6){
var _2d7=false;
var _2d8={visit:function(node){
if(node.elementType=="CSSFile"&&node.isDirty()){
_2d7=true;
}
return _2d7;
}};
if(_2d6){
_2d6.forEach(function(file){
if(_2d7){
return _2d7;
}
file.visit(_2d8);
}.bind(this));
}
return _2d7;
},close:function(){
if(this.cssFiles){
this.cssFiles.forEach(function(file){
file.close();
require("davinci/model/Factory").closeModel(file);
}.bind(this));
}
delete this.cssFiles;
},destroy:function(){
this.close();
}});
});
},"davinci/js/JSExpression":function(){
define(["dojo/_base/declare","davinci/js/JSElement"],function(_2d9,_2da){
return _2d9("davinci.js.JSExpression",_2da,{constructor:function(){
this.elementType="JSExpression";
},getText:function(){
var s="";
if(this.comment){
s+=this.printNewLine(context)+this.comment.getText(context);
}
if(this.label){
s+=this.printNewLine(context)+this.label.getText(context);
}
return s;
},add:function(e){
}});
});
},"dijit/_MenuBase":function(){
define("dijit/_MenuBase",["dojo/_base/array","dojo/_base/declare","dojo/dom","dojo/dom-attr","dojo/dom-class","dojo/_base/lang","dojo/mouse","dojo/on","dojo/window","./a11yclick","./popup","./registry","./_Widget","./_KeyNavContainer","./_TemplatedMixin"],function(_2db,_2dc,dom,_2dd,_2de,lang,_2df,on,_2e0,_2e1,pm,_2e2,_2e3,_2e4,_2e5){
return _2dc("dijit._MenuBase",[_2e3,_2e5,_2e4],{parentMenu:null,popupDelay:500,autoFocus:false,postCreate:function(){
var self=this,_2e6=function(node){
return _2de.contains(node,"dijitMenuItem");
};
this.own(on(this.containerNode,on.selector(_2e6,_2df.enter),function(){
self.onItemHover(_2e2.byNode(this));
}),on(this.containerNode,on.selector(_2e6,_2df.leave),function(){
self.onItemUnhover(_2e2.byNode(this));
}),on(this.containerNode,on.selector(_2e6,_2e1),function(evt){
self.onItemClick(_2e2.byNode(this),evt);
evt.stopPropagation();
evt.preventDefault();
}));
this.inherited(arguments);
},onExecute:function(){
},onCancel:function(){
},_moveToPopup:function(evt){
if(this.focusedChild&&this.focusedChild.popup&&!this.focusedChild.disabled){
this.onItemClick(this.focusedChild,evt);
}else{
var _2e7=this._getTopMenu();
if(_2e7&&_2e7._isMenuBar){
_2e7.focusNext();
}
}
},_onPopupHover:function(){
if(this.currentPopup&&this.currentPopup._pendingClose_timer){
var _2e8=this.currentPopup.parentMenu;
if(_2e8.focusedChild){
_2e8.focusedChild._setSelected(false);
}
_2e8.focusedChild=this.currentPopup.from_item;
_2e8.focusedChild._setSelected(true);
this._stopPendingCloseTimer(this.currentPopup);
}
},onItemHover:function(item){
if(this.isActive){
this.focusChild(item);
if(this.focusedChild.popup&&!this.focusedChild.disabled&&!this.hover_timer){
this.hover_timer=this.defer("_openPopup",this.popupDelay);
}
}
if(this.focusedChild){
this.focusChild(item);
}
this._hoveredChild=item;
item._set("hovering",true);
},_onChildBlur:function(item){
this._stopPopupTimer();
item._setSelected(false);
var _2e9=item.popup;
if(_2e9){
this._stopPendingCloseTimer(_2e9);
_2e9._pendingClose_timer=this.defer(function(){
_2e9._pendingClose_timer=null;
if(_2e9.parentMenu){
_2e9.parentMenu.currentPopup=null;
}
pm.close(_2e9);
},this.popupDelay);
}
},onItemUnhover:function(item){
if(this.isActive){
this._stopPopupTimer();
}
if(this._hoveredChild==item){
this._hoveredChild=null;
}
item._set("hovering",false);
},_stopPopupTimer:function(){
if(this.hover_timer){
this.hover_timer=this.hover_timer.remove();
}
},_stopPendingCloseTimer:function(_2ea){
if(_2ea._pendingClose_timer){
_2ea._pendingClose_timer=_2ea._pendingClose_timer.remove();
}
},_stopFocusTimer:function(){
if(this._focus_timer){
this._focus_timer=this._focus_timer.remove();
}
},_getTopMenu:function(){
for(var top=this;top.parentMenu;top=top.parentMenu){
}
return top;
},onItemClick:function(item,evt){
if(typeof this.isShowingNow=="undefined"){
this._markActive();
}
this.focusChild(item);
if(item.disabled){
return false;
}
if(item.popup){
this._openPopup(evt.type=="keypress");
}else{
this.onExecute();
item._onClick?item._onClick(evt):item.onClick(evt);
}
},_openPopup:function(_2eb){
this._stopPopupTimer();
var _2ec=this.focusedChild;
if(!_2ec){
return;
}
var _2ed=_2ec.popup;
if(!_2ed.isShowingNow){
if(this.currentPopup){
this._stopPendingCloseTimer(this.currentPopup);
pm.close(this.currentPopup);
}
_2ed.parentMenu=this;
_2ed.from_item=_2ec;
var self=this;
pm.open({parent:this,popup:_2ed,around:_2ec.domNode,orient:this._orient||["after","before"],onCancel:function(){
self.focusChild(_2ec);
self._cleanUp();
_2ec._setSelected(true);
self.focusedChild=_2ec;
},onExecute:lang.hitch(this,"_cleanUp")});
this.currentPopup=_2ed;
_2ed.connect(_2ed.domNode,"onmouseenter",lang.hitch(self,"_onPopupHover"));
}
if(_2eb&&_2ed.focus){
_2ed._focus_timer=this.defer(lang.hitch(_2ed,function(){
this._focus_timer=null;
this.focus();
}));
}
},_markActive:function(){
this.isActive=true;
_2de.replace(this.domNode,"dijitMenuActive","dijitMenuPassive");
},onOpen:function(){
this.isShowingNow=true;
this._markActive();
},_markInactive:function(){
this.isActive=false;
_2de.replace(this.domNode,"dijitMenuPassive","dijitMenuActive");
},onClose:function(){
this._stopFocusTimer();
this._markInactive();
this.isShowingNow=false;
this.parentMenu=null;
},_closeChild:function(){
this._stopPopupTimer();
if(this.currentPopup){
if(_2db.indexOf(this._focusManager.activeStack,this.id)>=0){
_2dd.set(this.focusedChild.focusNode,"tabIndex",this.tabIndex);
this.focusedChild.focusNode.focus();
}
pm.close(this.currentPopup);
this.currentPopup=null;
}
if(this.focusedChild){
this.focusedChild._setSelected(false);
this.onItemUnhover(this.focusedChild);
this.focusedChild=null;
}
},_onItemFocus:function(item){
if(this._hoveredChild&&this._hoveredChild!=item){
this.onItemUnhover(this._hoveredChild);
}
},_onBlur:function(){
this._cleanUp();
this.inherited(arguments);
},_cleanUp:function(){
this._closeChild();
if(typeof this.isShowingNow=="undefined"){
this._markInactive();
}
}});
});
},"dijit/layout/_ContentPaneResizeMixin":function(){
define("dijit/layout/_ContentPaneResizeMixin",["dojo/_base/array","dojo/_base/declare","dojo/dom-class","dojo/dom-geometry","dojo/dom-style","dojo/_base/lang","dojo/query","dojo/sniff","../registry","../Viewport","./utils"],function(_2ee,_2ef,_2f0,_2f1,_2f2,lang,_2f3,has,_2f4,_2f5,_2f6){
return _2ef("dijit.layout._ContentPaneResizeMixin",null,{doLayout:true,isLayoutContainer:true,startup:function(){
if(this._started){
return;
}
var _2f7=this.getParent();
this._childOfLayoutWidget=_2f7&&_2f7.isLayoutContainer;
this._needLayout=!this._childOfLayoutWidget;
this.inherited(arguments);
if(this._isShown()){
this._onShow();
}
if(!this._childOfLayoutWidget){
this.own(_2f5.on("resize",lang.hitch(this,"resize")));
}
},_checkIfSingleChild:function(){
var _2f8=[],_2f9=false;
_2f3("> *",this.containerNode).some(function(node){
var _2fa=_2f4.byNode(node);
if(_2fa&&_2fa.resize){
_2f8.push(_2fa);
}else{
if(node.offsetHeight){
_2f9=true;
}
}
});
this._singleChild=_2f8.length==1&&!_2f9?_2f8[0]:null;
_2f0.toggle(this.containerNode,this.baseClass+"SingleChild",!!this._singleChild);
},resize:function(_2fb,_2fc){
this._resizeCalled=true;
this._scheduleLayout(_2fb,_2fc);
},_scheduleLayout:function(_2fd,_2fe){
if(this._isShown()){
this._layout(_2fd,_2fe);
}else{
this._needLayout=true;
this._changeSize=_2fd;
this._resultSize=_2fe;
}
},_layout:function(_2ff,_300){
delete this._needLayout;
if(!this._wasShown&&this.open!==false){
this._onShow();
}
if(_2ff){
_2f1.setMarginBox(this.domNode,_2ff);
}
var cn=this.containerNode;
if(cn===this.domNode){
var mb=_300||{};
lang.mixin(mb,_2ff||{});
if(!("h" in mb)||!("w" in mb)){
mb=lang.mixin(_2f1.getMarginBox(cn),mb);
}
this._contentBox=_2f6.marginBox2contentBox(cn,mb);
}else{
this._contentBox=_2f1.getContentBox(cn);
}
this._layoutChildren();
},_layoutChildren:function(){
if(this.doLayout){
this._checkIfSingleChild();
}
if(this._singleChild&&this._singleChild.resize){
var cb=this._contentBox||_2f1.getContentBox(this.containerNode);
this._singleChild.resize({w:cb.w,h:cb.h});
}else{
_2ee.forEach(this.getChildren(),function(_301){
if(_301.resize){
_301.resize();
}
});
}
},_isShown:function(){
if(this._childOfLayoutWidget){
if(this._resizeCalled&&"open" in this){
return this.open;
}
return this._resizeCalled;
}else{
if("open" in this){
return this.open;
}else{
var node=this.domNode,_302=this.domNode.parentNode;
return (node.style.display!="none")&&(node.style.visibility!="hidden")&&!_2f0.contains(node,"dijitHidden")&&_302&&_302.style&&(_302.style.display!="none");
}
}
},_onShow:function(){
this._wasShown=true;
if(this._needLayout){
this._layout(this._changeSize,this._resultSize);
}
this.inherited(arguments);
}});
});
},"dijit/form/ComboBox":function(){
define("dijit/form/ComboBox",["dojo/_base/declare","./ValidationTextBox","./ComboBoxMixin"],function(_303,_304,_305){
return _303("dijit.form.ComboBox",[_304,_305],{});
});
},"dojox/grid/DataGrid":function(){
require({cache:{"dojo/uacss":function(){
define(["./dom-geometry","./_base/lang","./ready","./sniff","./_base/window"],function(_306,lang,_307,has,_308){
var html=_308.doc.documentElement,ie=has("ie"),_309=has("opera"),maj=Math.floor,ff=has("ff"),_30a=_306.boxModel.replace(/-/,""),_30b={"dj_ie":ie,"dj_ie6":maj(ie)==6,"dj_ie7":maj(ie)==7,"dj_ie8":maj(ie)==8,"dj_ie9":maj(ie)==9,"dj_quirks":has("quirks"),"dj_iequirks":ie&&has("quirks"),"dj_opera":_309,"dj_khtml":has("khtml"),"dj_webkit":has("webkit"),"dj_safari":has("safari"),"dj_chrome":has("chrome"),"dj_gecko":has("mozilla"),"dj_ff3":maj(ff)==3};
_30b["dj_"+_30a]=true;
var _30c="";
for(var clz in _30b){
if(_30b[clz]){
_30c+=clz+" ";
}
}
html.className=lang.trim(html.className+" "+_30c);
_307(90,function(){
if(!_306.isBodyLtr()){
var _30d="dj_rtl dijitRtl "+_30c.replace(/ /g,"-rtl ");
html.className=lang.trim(html.className+" "+_30d+"dj_rtl dijitRtl "+_30c.replace(/ /g,"-rtl "));
}
});
return has;
});
},"dojo/text":function(){
define(["./_base/kernel","require","./has","./_base/xhr"],function(dojo,_30e,has,xhr){
var _30f;
if(1){
_30f=function(url,sync,load){
xhr("GET",{url:url,sync:!!sync,load:load,headers:dojo.config.textPluginHeaders||{}});
};
}else{
if(_30e.getText){
_30f=_30e.getText;
}else{
console.error("dojo/text plugin failed to load because loader does not support getText");
}
}
var _310={},_311=function(text){
if(text){
text=text.replace(/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,"");
var _312=text.match(/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im);
if(_312){
text=_312[1];
}
}else{
text="";
}
return text;
},_313={},_314={};
dojo.cache=function(_315,url,_316){
var key;
if(typeof _315=="string"){
if(/\//.test(_315)){
key=_315;
_316=url;
}else{
key=_30e.toUrl(_315.replace(/\./g,"/")+(url?("/"+url):""));
}
}else{
key=_315+"";
_316=url;
}
var val=(_316!=undefined&&typeof _316!="string")?_316.value:_316,_317=_316&&_316.sanitize;
if(typeof val=="string"){
_310[key]=val;
return _317?_311(val):val;
}else{
if(val===null){
delete _310[key];
return null;
}else{
if(!(key in _310)){
_30f(key,true,function(text){
_310[key]=text;
});
}
return _317?_311(_310[key]):_310[key];
}
}
};
return {dynamic:true,normalize:function(id,_318){
var _319=id.split("!"),url=_319[0];
return (/^\./.test(url)?_318(url):url)+(_319[1]?"!"+_319[1]:"");
},load:function(id,_31a,load){
var _31b=id.split("!"),_31c=_31b.length>1,_31d=_31b[0],url=_31a.toUrl(_31b[0]),_31e="url:"+url,text=_313,_31f=function(text){
load(_31c?_311(text):text);
};
if(_31d in _310){
text=_310[_31d];
}else{
if(_31e in _31a.cache){
text=_31a.cache[_31e];
}else{
if(url in _310){
text=_310[url];
}
}
}
if(text===_313){
if(_314[url]){
_314[url].push(_31f);
}else{
var _320=_314[url]=[_31f];
_30f(url,!_31a.async,function(text){
_310[_31d]=_310[url]=text;
for(var i=0;i<_320.length;){
_320[i++](text);
}
delete _314[url];
});
}
}else{
_31f(text);
}
}};
});
},"dijit/hccss":function(){
define(["dojo/dom-class","dojo/hccss","dojo/ready","dojo/_base/window"],function(_321,has,_322,win){
_322(90,function(){
if(has("highcontrast")){
_321.add(win.body(),"dijit_a11y");
}
});
return has;
});
},"dojox/grid/_View":function(){
define(["dojo","dijit/registry","../main","dojo/_base/declare","dojo/_base/array","dojo/_base/lang","dojo/_base/connect","dojo/_base/sniff","dojo/query","dojo/_base/window","dojo/text!./resources/View.html","dojo/dnd/Source","dijit/_Widget","dijit/_TemplatedMixin","dojox/html/metrics","./util","dojo/_base/html","./_Builder","dojo/dnd/Avatar","dojo/dnd/Manager"],function(dojo,_323,_324,_325,_326,lang,_327,has,_328,win,_329,_32a,_32b,_32c,_32d,util,html,_32e,_32f,_330){
var _331=function(_332,_333){
return _332.style.cssText==undefined?_332.getAttribute("style"):_332.style.cssText;
};
var _334=_325("dojox.grid._View",[_32b,_32c],{defaultWidth:"18em",viewWidth:"",templateString:_329,classTag:"dojoxGrid",marginBottom:0,rowPad:2,_togglingColumn:-1,_headerBuilderClass:_32e._HeaderBuilder,_contentBuilderClass:_32e._ContentBuilder,postMixInProperties:function(){
this.rowNodes={};
},postCreate:function(){
this.connect(this.scrollboxNode,"onscroll","doscroll");
util.funnelEvents(this.contentNode,this,"doContentEvent",["mouseover","mouseout","click","dblclick","contextmenu","mousedown"]);
util.funnelEvents(this.headerNode,this,"doHeaderEvent",["dblclick","mouseover","mouseout","mousemove","mousedown","click","contextmenu"]);
this.content=new this._contentBuilderClass(this);
this.header=new this._headerBuilderClass(this);
if(!this.grid.isLeftToRight()){
this.headerNodeContainer.style.width="";
}
},destroy:function(){
html.destroy(this.headerNode);
delete this.headerNode;
for(var i in this.rowNodes){
this._cleanupRowWidgets(this.rowNodes[i]);
html.destroy(this.rowNodes[i]);
}
this.rowNodes={};
if(this.source){
this.source.destroy();
}
this.inherited(arguments);
},focus:function(){
if(has("ie")||has("webkit")||has("opera")){
this.hiddenFocusNode.focus();
}else{
this.scrollboxNode.focus();
}
},setStructure:function(_335){
var vs=(this.structure=_335);
if(vs.width&&!isNaN(vs.width)){
this.viewWidth=vs.width+"em";
}else{
this.viewWidth=vs.width||(vs.noscroll?"auto":this.viewWidth);
}
this._onBeforeRow=vs.onBeforeRow||function(){
};
this._onAfterRow=vs.onAfterRow||function(){
};
this.noscroll=vs.noscroll;
if(this.noscroll){
this.scrollboxNode.style.overflow="hidden";
}
this.simpleStructure=Boolean(vs.cells.length==1);
this.testFlexCells();
this.updateStructure();
},_cleanupRowWidgets:function(_336){
if(_336){
_326.forEach(_328("[widgetId]",_336).map(_323.byNode),function(w){
if(w._destroyOnRemove){
w.destroy();
delete w;
}else{
if(w.domNode&&w.domNode.parentNode){
w.domNode.parentNode.removeChild(w.domNode);
}
}
});
}
},onBeforeRow:function(_337,_338){
this._onBeforeRow(_337,_338);
if(_337>=0){
this._cleanupRowWidgets(this.getRowNode(_337));
}
},onAfterRow:function(_339,_33a,_33b){
this._onAfterRow(_339,_33a,_33b);
var g=this.grid;
_326.forEach(_328(".dojoxGridStubNode",_33b),function(n){
if(n&&n.parentNode){
var lw=n.getAttribute("linkWidget");
var _33c=window.parseInt(html.attr(n,"cellIdx"),10);
var _33d=g.getCell(_33c);
var w=_323.byId(lw);
if(w){
n.parentNode.replaceChild(w.domNode,n);
if(!w._started){
w.startup();
}
dojo.destroy(n);
}else{
n.innerHTML="";
}
}
},this);
},testFlexCells:function(){
this.flexCells=false;
for(var j=0,row;(row=this.structure.cells[j]);j++){
for(var i=0,cell;(cell=row[i]);i++){
cell.view=this;
this.flexCells=this.flexCells||cell.isFlex();
}
}
return this.flexCells;
},updateStructure:function(){
this.header.update();
this.content.update();
},getScrollbarWidth:function(){
var _33e=this.hasVScrollbar();
var _33f=html.style(this.scrollboxNode,"overflow");
if(this.noscroll||!_33f||_33f=="hidden"){
_33e=false;
}else{
if(_33f=="scroll"){
_33e=true;
}
}
return (_33e?_32d.getScrollbar().w:0);
},getColumnsWidth:function(){
var h=this.headerContentNode;
return h&&h.firstChild?h.firstChild.offsetWidth:0;
},setColumnsWidth:function(_340){
this.headerContentNode.firstChild.style.width=_340+"px";
if(this.viewWidth){
this.viewWidth=_340+"px";
}
},getWidth:function(){
return this.viewWidth||(this.getColumnsWidth()+this.getScrollbarWidth())+"px";
},getContentWidth:function(){
return Math.max(0,html._getContentBox(this.domNode).w-this.getScrollbarWidth())+"px";
},render:function(){
this.scrollboxNode.style.height="";
this.renderHeader();
if(this._togglingColumn>=0){
this.setColumnsWidth(this.getColumnsWidth()-this._togglingColumn);
this._togglingColumn=-1;
}
var _341=this.grid.layout.cells;
var _342=lang.hitch(this,function(node,_343){
!this.grid.isLeftToRight()&&(_343=!_343);
var inc=_343?-1:1;
var idx=this.header.getCellNodeIndex(node)+inc;
var cell=_341[idx];
while(cell&&cell.getHeaderNode()&&cell.getHeaderNode().style.display=="none"){
idx+=inc;
cell=_341[idx];
}
if(cell){
return cell.getHeaderNode();
}
return null;
});
if(this.grid.columnReordering&&this.simpleStructure){
if(this.source){
this.source.destroy();
}
var _344="dojoxGrid_bottomMarker";
var _345="dojoxGrid_topMarker";
if(this.bottomMarker){
html.destroy(this.bottomMarker);
}
this.bottomMarker=html.byId(_344);
if(this.topMarker){
html.destroy(this.topMarker);
}
this.topMarker=html.byId(_345);
if(!this.bottomMarker){
this.bottomMarker=html.create("div",{"id":_344,"class":"dojoxGridColPlaceBottom"},win.body());
this._hide(this.bottomMarker);
this.topMarker=html.create("div",{"id":_345,"class":"dojoxGridColPlaceTop"},win.body());
this._hide(this.topMarker);
}
this.arrowDim=html.contentBox(this.bottomMarker);
var _346=html.contentBox(this.headerContentNode.firstChild.rows[0]).h;
this.source=new _32a(this.headerContentNode.firstChild.rows[0],{horizontal:true,accept:["gridColumn_"+this.grid.id],viewIndex:this.index,generateText:false,onMouseDown:lang.hitch(this,function(e){
this.header.decorateEvent(e);
if((this.header.overRightResizeArea(e)||this.header.overLeftResizeArea(e))&&this.header.canResize(e)&&!this.header.moveable){
this.header.beginColumnResize(e);
}else{
if(this.grid.headerMenu){
this.grid.headerMenu.onCancel(true);
}
if(e.button===(has("ie")<9?1:0)){
_32a.prototype.onMouseDown.call(this.source,e);
}
}
}),onMouseOver:lang.hitch(this,function(e){
var src=this.source;
if(src._getChildByEvent(e)){
_32a.prototype.onMouseOver.apply(src,arguments);
}
}),_markTargetAnchor:lang.hitch(this,function(_347){
var src=this.source;
if(src.current==src.targetAnchor&&src.before==_347){
return;
}
if(src.targetAnchor&&_342(src.targetAnchor,src.before)){
src._removeItemClass(_342(src.targetAnchor,src.before),src.before?"After":"Before");
}
_32a.prototype._markTargetAnchor.call(src,_347);
var _348=_347?src.targetAnchor:_342(src.targetAnchor,src.before);
var _349=0;
if(!_348){
_348=src.targetAnchor;
_349=html.contentBox(_348).w+this.arrowDim.w/2+2;
}
var pos=html.position(_348,true);
var left=Math.floor(pos.x-this.arrowDim.w/2+_349);
html.style(this.bottomMarker,"visibility","visible");
html.style(this.topMarker,"visibility","visible");
html.style(this.bottomMarker,{"left":left+"px","top":(_346+pos.y)+"px"});
html.style(this.topMarker,{"left":left+"px","top":(pos.y-this.arrowDim.h)+"px"});
if(src.targetAnchor&&_342(src.targetAnchor,src.before)){
src._addItemClass(_342(src.targetAnchor,src.before),src.before?"After":"Before");
}
}),_unmarkTargetAnchor:lang.hitch(this,function(){
var src=this.source;
if(!src.targetAnchor){
return;
}
if(src.targetAnchor&&_342(src.targetAnchor,src.before)){
src._removeItemClass(_342(src.targetAnchor,src.before),src.before?"After":"Before");
}
this._hide(this.bottomMarker);
this._hide(this.topMarker);
_32a.prototype._unmarkTargetAnchor.call(src);
}),destroy:lang.hitch(this,function(){
_327.disconnect(this._source_conn);
_327.unsubscribe(this._source_sub);
_32a.prototype.destroy.call(this.source);
if(this.bottomMarker){
html.destroy(this.bottomMarker);
delete this.bottomMarker;
}
if(this.topMarker){
html.destroy(this.topMarker);
delete this.topMarker;
}
}),onDndCancel:lang.hitch(this,function(){
_32a.prototype.onDndCancel.call(this.source);
this._hide(this.bottomMarker);
this._hide(this.topMarker);
})});
this._source_conn=_327.connect(this.source,"onDndDrop",this,"_onDndDrop");
this._source_sub=_327.subscribe("/dnd/drop/before",this,"_onDndDropBefore");
this.source.startup();
}
},_hide:function(node){
html.style(node,{top:"-10000px","visibility":"hidden"});
},_onDndDropBefore:function(_34a,_34b,copy){
if(_330.manager().target!==this.source){
return;
}
this.source._targetNode=this.source.targetAnchor;
this.source._beforeTarget=this.source.before;
var _34c=this.grid.views.views;
var _34d=_34c[_34a.viewIndex];
var _34e=_34c[this.index];
if(_34e!=_34d){
_34d.convertColPctToFixed();
_34e.convertColPctToFixed();
}
},_onDndDrop:function(_34f,_350,copy){
if(_330.manager().target!==this.source){
if(_330.manager().source===this.source){
this._removingColumn=true;
}
return;
}
this._hide(this.bottomMarker);
this._hide(this.topMarker);
var _351=function(n){
return n?html.attr(n,"idx"):null;
};
var w=html.marginBox(_350[0]).w;
if(_34f.viewIndex!==this.index){
var _352=this.grid.views.views;
var _353=_352[_34f.viewIndex];
var _354=_352[this.index];
if(_353.viewWidth&&_353.viewWidth!="auto"){
_353.setColumnsWidth(_353.getColumnsWidth()-w);
}
if(_354.viewWidth&&_354.viewWidth!="auto"){
_354.setColumnsWidth(_354.getColumnsWidth());
}
}
var stn=this.source._targetNode;
var stb=this.source._beforeTarget;
!this.grid.isLeftToRight()&&(stb=!stb);
var _355=this.grid.layout;
var idx=this.index;
delete this.source._targetNode;
delete this.source._beforeTarget;
_355.moveColumn(_34f.viewIndex,idx,_351(_350[0]),_351(stn),stb);
},renderHeader:function(){
this.headerContentNode.innerHTML=this.header.generateHtml(this._getHeaderContent);
if(this.flexCells){
this.contentWidth=this.getContentWidth();
this.headerContentNode.firstChild.style.width=this.contentWidth;
}
util.fire(this,"onAfterRow",[-1,this.structure.cells,this.headerContentNode]);
},_getHeaderContent:function(_356){
var n=_356.name||_356.grid.getCellName(_356);
if(/^\s+$/.test(n)){
n="&nbsp;";
}
var ret=["<div class=\"dojoxGridSortNode"];
if(_356.index!=_356.grid.getSortIndex()){
ret.push("\">");
}else{
ret=ret.concat([" ",_356.grid.sortInfo>0?"dojoxGridSortUp":"dojoxGridSortDown","\"><div class=\"dojoxGridArrowButtonChar\">",_356.grid.sortInfo>0?"&#9650;":"&#9660;","</div><div class=\"dojoxGridArrowButtonNode\" role=\"presentation\"></div>","<div class=\"dojoxGridColCaption\">"]);
}
ret=ret.concat([n,"</div></div>"]);
return ret.join("");
},resize:function(){
this.adaptHeight();
this.adaptWidth();
},hasHScrollbar:function(_357){
var _358=this._hasHScroll||false;
if(this._hasHScroll==undefined||_357){
if(this.noscroll){
this._hasHScroll=false;
}else{
var _359=html.style(this.scrollboxNode,"overflow");
if(_359=="hidden"){
this._hasHScroll=false;
}else{
if(_359=="scroll"){
this._hasHScroll=true;
}else{
this._hasHScroll=(this.scrollboxNode.offsetWidth-this.getScrollbarWidth()<this.contentNode.offsetWidth);
}
}
}
}
if(_358!==this._hasHScroll){
this.grid.update();
}
return this._hasHScroll;
},hasVScrollbar:function(_35a){
var _35b=this._hasVScroll||false;
if(this._hasVScroll==undefined||_35a){
if(this.noscroll){
this._hasVScroll=false;
}else{
var _35c=html.style(this.scrollboxNode,"overflow");
if(_35c=="hidden"){
this._hasVScroll=false;
}else{
if(_35c=="scroll"){
this._hasVScroll=true;
}else{
this._hasVScroll=(this.scrollboxNode.scrollHeight>this.scrollboxNode.clientHeight);
}
}
}
}
if(_35b!==this._hasVScroll){
this.grid.update();
}
return this._hasVScroll;
},convertColPctToFixed:function(){
var _35d=false;
this.grid.initialWidth="";
var _35e=_328("th",this.headerContentNode);
var _35f=_326.map(_35e,function(c,vIdx){
var w=c.style.width;
html.attr(c,"vIdx",vIdx);
if(w&&w.slice(-1)=="%"){
_35d=true;
}else{
if(w&&w.slice(-2)=="px"){
return window.parseInt(w,10);
}
}
return html.contentBox(c).w;
});
if(_35d){
_326.forEach(this.grid.layout.cells,function(cell,idx){
if(cell.view==this){
var _360=cell.view.getHeaderCellNode(cell.index);
if(_360&&html.hasAttr(_360,"vIdx")){
var vIdx=window.parseInt(html.attr(_360,"vIdx"));
this.setColWidth(idx,_35f[vIdx]);
html.removeAttr(_360,"vIdx");
}
}
},this);
return true;
}
return false;
},adaptHeight:function(_361){
if(!this.grid._autoHeight){
var h=(this.domNode.style.height&&parseInt(this.domNode.style.height.replace(/px/,""),10))||this.domNode.clientHeight;
var self=this;
var _362=function(){
var v;
for(var i in self.grid.views.views){
v=self.grid.views.views[i];
if(v!==self&&v.hasHScrollbar()){
return true;
}
}
return false;
};
if(_361||(this.noscroll&&_362())){
h-=_32d.getScrollbar().h;
}
util.setStyleHeightPx(this.scrollboxNode,h);
}
this.hasVScrollbar(true);
},adaptWidth:function(){
if(this.flexCells){
this.contentWidth=this.getContentWidth();
this.headerContentNode.firstChild.style.width=this.contentWidth;
}
var w=this.scrollboxNode.offsetWidth-this.getScrollbarWidth();
if(!this._removingColumn){
w=Math.max(w,this.getColumnsWidth())+"px";
}else{
w=Math.min(w,this.getColumnsWidth())+"px";
this._removingColumn=false;
}
var cn=this.contentNode;
cn.style.width=w;
this.hasHScrollbar(true);
},setSize:function(w,h){
var ds=this.domNode.style;
var hs=this.headerNode.style;
if(w){
ds.width=w;
hs.width=w;
}
ds.height=(h>=0?h+"px":"");
},renderRow:function(_363){
var _364=this.createRowNode(_363);
this.buildRow(_363,_364);
return _364;
},createRowNode:function(_365){
var node=document.createElement("div");
node.className=this.classTag+"Row";
if(this instanceof _324.grid._RowSelector){
html.attr(node,"role","presentation");
}else{
html.attr(node,"role","row");
if(this.grid.selectionMode!="none"){
node.setAttribute("aria-selected","false");
}
}
node[util.gridViewTag]=this.id;
node[util.rowIndexTag]=_365;
this.rowNodes[_365]=node;
return node;
},buildRow:function(_366,_367){
this.buildRowContent(_366,_367);
this.styleRow(_366,_367);
},buildRowContent:function(_368,_369){
_369.innerHTML=this.content.generateHtml(_368,_368);
if(this.flexCells&&this.contentWidth){
_369.firstChild.style.width=this.contentWidth;
}
util.fire(this,"onAfterRow",[_368,this.structure.cells,_369]);
},rowRemoved:function(_36a){
if(_36a>=0){
this._cleanupRowWidgets(this.getRowNode(_36a));
}
this.grid.edit.save(this,_36a);
delete this.rowNodes[_36a];
},getRowNode:function(_36b){
return this.rowNodes[_36b];
},getCellNode:function(_36c,_36d){
var row=this.getRowNode(_36c);
if(row){
return this.content.getCellNode(row,_36d);
}
},getHeaderCellNode:function(_36e){
if(this.headerContentNode){
return this.header.getCellNode(this.headerContentNode,_36e);
}
},styleRow:function(_36f,_370){
_370._style=_331(_370);
this.styleRowNode(_36f,_370);
},styleRowNode:function(_371,_372){
if(_372){
this.doStyleRowNode(_371,_372);
}
},doStyleRowNode:function(_373,_374){
this.grid.styleRowNode(_373,_374);
},updateRow:function(_375){
var _376=this.getRowNode(_375);
if(_376){
_376.style.height="";
this.buildRow(_375,_376);
}
return _376;
},updateRowStyles:function(_377){
this.styleRowNode(_377,this.getRowNode(_377));
},lastTop:0,firstScroll:0,_nativeScroll:false,doscroll:function(_378){
if(has("ff")>=13){
this._nativeScroll=true;
}
var _379=this.grid.isLeftToRight();
if(this.firstScroll<2){
if((!_379&&this.firstScroll==1)||(_379&&this.firstScroll===0)){
var s=html.marginBox(this.headerNodeContainer);
if(has("ie")){
this.headerNodeContainer.style.width=s.w+this.getScrollbarWidth()+"px";
}else{
if(has("mozilla")){
this.headerNodeContainer.style.width=s.w-this.getScrollbarWidth()+"px";
this.scrollboxNode.scrollLeft=_379?this.scrollboxNode.clientWidth-this.scrollboxNode.scrollWidth:this.scrollboxNode.scrollWidth-this.scrollboxNode.clientWidth;
}
}
}
this.firstScroll++;
}
this.headerNode.scrollLeft=this.scrollboxNode.scrollLeft;
var top=this.scrollboxNode.scrollTop;
if(top!==this.lastTop){
this.grid.scrollTo(top);
}
this._nativeScroll=false;
},setScrollTop:function(_37a){
this.lastTop=_37a;
if(!this._nativeScroll){
this.scrollboxNode.scrollTop=_37a;
}
return this.scrollboxNode.scrollTop;
},doContentEvent:function(e){
if(this.content.decorateEvent(e)){
this.grid.onContentEvent(e);
}
},doHeaderEvent:function(e){
if(this.header.decorateEvent(e)){
this.grid.onHeaderEvent(e);
}
},dispatchContentEvent:function(e){
return this.content.dispatchEvent(e);
},dispatchHeaderEvent:function(e){
return this.header.dispatchEvent(e);
},setColWidth:function(_37b,_37c){
this.grid.setCellWidth(_37b,_37c+"px");
},update:function(){
if(!this.domNode){
return;
}
this.content.update();
this.grid.update();
var left=this.scrollboxNode.scrollLeft;
this.scrollboxNode.scrollLeft=left;
this.headerNode.scrollLeft=left;
}});
var _37d=_325("dojox.grid._GridAvatar",_32f,{construct:function(){
var dd=win.doc;
var a=dd.createElement("table");
a.cellPadding=a.cellSpacing="0";
a.className="dojoxGridDndAvatar";
a.style.position="absolute";
a.style.zIndex=1999;
a.style.margin="0px";
var b=dd.createElement("tbody");
var tr=dd.createElement("tr");
var td=dd.createElement("td");
var img=dd.createElement("td");
tr.className="dojoxGridDndAvatarItem";
img.className="dojoxGridDndAvatarItemImage";
img.style.width="16px";
var _37e=this.manager.source,node;
if(_37e.creator){
node=_37e._normalizedCreator(_37e.getItem(this.manager.nodes[0].id).data,"avatar").node;
}else{
node=this.manager.nodes[0].cloneNode(true);
var _37f,_380;
if(node.tagName.toLowerCase()=="tr"){
_37f=dd.createElement("table");
_380=dd.createElement("tbody");
_380.appendChild(node);
_37f.appendChild(_380);
node=_37f;
}else{
if(node.tagName.toLowerCase()=="th"){
_37f=dd.createElement("table");
_380=dd.createElement("tbody");
var r=dd.createElement("tr");
_37f.cellPadding=_37f.cellSpacing="0";
r.appendChild(node);
_380.appendChild(r);
_37f.appendChild(_380);
node=_37f;
}
}
}
node.id="";
td.appendChild(node);
tr.appendChild(img);
tr.appendChild(td);
html.style(tr,"opacity",0.9);
b.appendChild(tr);
a.appendChild(b);
this.node=a;
var m=_330.manager();
this.oldOffsetY=m.OFFSET_Y;
m.OFFSET_Y=1;
},destroy:function(){
_330.manager().OFFSET_Y=this.oldOffsetY;
this.inherited(arguments);
}});
var _381=_330.manager().makeAvatar;
_330.manager().makeAvatar=function(){
var src=this.source;
if(src.viewIndex!==undefined&&!html.hasClass(win.body(),"dijit_a11y")){
return new _37d(this);
}
return _381.call(_330.manager());
};
return _334;
});
},"dijit/_Contained":function(){
define(["dojo/_base/declare","./registry"],function(_382,_383){
return _382("dijit._Contained",null,{_getSibling:function(_384){
var node=this.domNode;
do{
node=node[_384+"Sibling"];
}while(node&&node.nodeType!=1);
return node&&_383.byNode(node);
},getPreviousSibling:function(){
return this._getSibling("previous");
},getNextSibling:function(){
return this._getSibling("next");
},getIndexInParent:function(){
var p=this.getParent();
if(!p||!p.getIndexOfChild){
return -1;
}
return p.getIndexOfChild(this);
}});
});
},"dojo/dnd/Selector":function(){
define(["../_base/array","../_base/declare","../_base/event","../_base/kernel","../_base/lang","../dom","../dom-construct","../mouse","../_base/NodeList","../on","../touch","./common","./Container"],function(_385,_386,_387,_388,lang,dom,_389,_38a,_38b,on,_38c,dnd,_38d){
var _38e=_386("dojo.dnd.Selector",_38d,{constructor:function(node,_38f){
if(!_38f){
_38f={};
}
this.singular=_38f.singular;
this.autoSync=_38f.autoSync;
this.selection={};
this.anchor=null;
this.simpleSelection=false;
this.events.push(on(this.node,_38c.press,lang.hitch(this,"onMouseDown")),on(this.node,_38c.release,lang.hitch(this,"onMouseUp")));
},singular:false,getSelectedNodes:function(){
var t=new _38b();
var e=dnd._empty;
for(var i in this.selection){
if(i in e){
continue;
}
t.push(dom.byId(i));
}
return t;
},selectNone:function(){
return this._removeSelection()._removeAnchor();
},selectAll:function(){
this.forInItems(function(data,id){
this._addItemClass(dom.byId(id),"Selected");
this.selection[id]=1;
},this);
return this._removeAnchor();
},deleteSelectedNodes:function(){
var e=dnd._empty;
for(var i in this.selection){
if(i in e){
continue;
}
var n=dom.byId(i);
this.delItem(i);
_389.destroy(n);
}
this.anchor=null;
this.selection={};
return this;
},forInSelectedItems:function(f,o){
o=o||_388.global;
var s=this.selection,e=dnd._empty;
for(var i in s){
if(i in e){
continue;
}
f.call(o,this.getItem(i),i,this);
}
},sync:function(){
_38e.superclass.sync.call(this);
if(this.anchor){
if(!this.getItem(this.anchor.id)){
this.anchor=null;
}
}
var t=[],e=dnd._empty;
for(var i in this.selection){
if(i in e){
continue;
}
if(!this.getItem(i)){
t.push(i);
}
}
_385.forEach(t,function(i){
delete this.selection[i];
},this);
return this;
},insertNodes:function(_390,data,_391,_392){
var _393=this._normalizedCreator;
this._normalizedCreator=function(item,hint){
var t=_393.call(this,item,hint);
if(_390){
if(!this.anchor){
this.anchor=t.node;
this._removeItemClass(t.node,"Selected");
this._addItemClass(this.anchor,"Anchor");
}else{
if(this.anchor!=t.node){
this._removeItemClass(t.node,"Anchor");
this._addItemClass(t.node,"Selected");
}
}
this.selection[t.node.id]=1;
}else{
this._removeItemClass(t.node,"Selected");
this._removeItemClass(t.node,"Anchor");
}
return t;
};
_38e.superclass.insertNodes.call(this,data,_391,_392);
this._normalizedCreator=_393;
return this;
},destroy:function(){
_38e.superclass.destroy.call(this);
this.selection=this.anchor=null;
},onMouseDown:function(e){
if(this.autoSync){
this.sync();
}
if(!this.current){
return;
}
if(!this.singular&&!dnd.getCopyKeyState(e)&&!e.shiftKey&&(this.current.id in this.selection)){
this.simpleSelection=true;
if(_38a.isLeft(e)){
_387.stop(e);
}
return;
}
if(!this.singular&&e.shiftKey){
if(!dnd.getCopyKeyState(e)){
this._removeSelection();
}
var c=this.getAllNodes();
if(c.length){
if(!this.anchor){
this.anchor=c[0];
this._addItemClass(this.anchor,"Anchor");
}
this.selection[this.anchor.id]=1;
if(this.anchor!=this.current){
var i=0,node;
for(;i<c.length;++i){
node=c[i];
if(node==this.anchor||node==this.current){
break;
}
}
for(++i;i<c.length;++i){
node=c[i];
if(node==this.anchor||node==this.current){
break;
}
this._addItemClass(node,"Selected");
this.selection[node.id]=1;
}
this._addItemClass(this.current,"Selected");
this.selection[this.current.id]=1;
}
}
}else{
if(this.singular){
if(this.anchor==this.current){
if(dnd.getCopyKeyState(e)){
this.selectNone();
}
}else{
this.selectNone();
this.anchor=this.current;
this._addItemClass(this.anchor,"Anchor");
this.selection[this.current.id]=1;
}
}else{
if(dnd.getCopyKeyState(e)){
if(this.anchor==this.current){
delete this.selection[this.anchor.id];
this._removeAnchor();
}else{
if(this.current.id in this.selection){
this._removeItemClass(this.current,"Selected");
delete this.selection[this.current.id];
}else{
if(this.anchor){
this._removeItemClass(this.anchor,"Anchor");
this._addItemClass(this.anchor,"Selected");
}
this.anchor=this.current;
this._addItemClass(this.current,"Anchor");
this.selection[this.current.id]=1;
}
}
}else{
if(!(this.current.id in this.selection)){
this.selectNone();
this.anchor=this.current;
this._addItemClass(this.current,"Anchor");
this.selection[this.current.id]=1;
}
}
}
}
_387.stop(e);
},onMouseUp:function(){
if(!this.simpleSelection){
return;
}
this.simpleSelection=false;
this.selectNone();
if(this.current){
this.anchor=this.current;
this._addItemClass(this.anchor,"Anchor");
this.selection[this.current.id]=1;
}
},onMouseMove:function(){
this.simpleSelection=false;
},onOverEvent:function(){
this.onmousemoveEvent=on(this.node,_38c.move,lang.hitch(this,"onMouseMove"));
},onOutEvent:function(){
if(this.onmousemoveEvent){
this.onmousemoveEvent.remove();
delete this.onmousemoveEvent;
}
},_removeSelection:function(){
var e=dnd._empty;
for(var i in this.selection){
if(i in e){
continue;
}
var node=dom.byId(i);
if(node){
this._removeItemClass(node,"Selected");
}
}
this.selection={};
return this;
},_removeAnchor:function(){
if(this.anchor){
this._removeItemClass(this.anchor,"Anchor");
this.anchor=null;
}
return this;
}});
return _38e;
});
},"dojox/grid/DataSelection":function(){
define("dojox/grid/DataSelection",["dojo/_base/declare","./_SelectionPreserver","./Selection"],function(_394,_395,_396){
return _394("dojox.grid.DataSelection",_396,{constructor:function(grid){
if(grid.keepSelection){
this.preserver=new _395(this);
}
},destroy:function(){
if(this.preserver){
this.preserver.destroy();
}
},getFirstSelected:function(){
var idx=_396.prototype.getFirstSelected.call(this);
if(idx==-1){
return null;
}
return this.grid.getItem(idx);
},getNextSelected:function(_397){
var _398=this.grid.getItemIndex(_397);
var idx=_396.prototype.getNextSelected.call(this,_398);
if(idx==-1){
return null;
}
return this.grid.getItem(idx);
},getSelected:function(){
var _399=[];
for(var i=0,l=this.selected.length;i<l;i++){
if(this.selected[i]){
_399.push(this.grid.getItem(i));
}
}
return _399;
},addToSelection:function(_39a){
if(this.mode=="none"){
return;
}
var idx=null;
if(typeof _39a=="number"||typeof _39a=="string"){
idx=_39a;
}else{
idx=this.grid.getItemIndex(_39a);
}
_396.prototype.addToSelection.call(this,idx);
},deselect:function(_39b){
if(this.mode=="none"){
return;
}
var idx=null;
if(typeof _39b=="number"||typeof _39b=="string"){
idx=_39b;
}else{
idx=this.grid.getItemIndex(_39b);
}
_396.prototype.deselect.call(this,idx);
},deselectAll:function(_39c){
var idx=null;
if(_39c||typeof _39c=="number"){
if(typeof _39c=="number"||typeof _39c=="string"){
idx=_39c;
}else{
idx=this.grid.getItemIndex(_39c);
}
_396.prototype.deselectAll.call(this,idx);
}else{
this.inherited(arguments);
}
}});
});
},"url:dijit/templates/CheckedMenuItem.html":"<tr class=\"dijitReset dijitMenuItem\" data-dojo-attach-point=\"focusNode\" role=\"menuitemcheckbox\" tabIndex=\"-1\">\n\t<td class=\"dijitReset dijitMenuItemIconCell\" role=\"presentation\">\n\t\t<img src=\"${_blankGif}\" alt=\"\" class=\"dijitMenuItemIcon dijitCheckedMenuItemIcon\" data-dojo-attach-point=\"iconNode\"/>\n\t\t<span class=\"dijitCheckedMenuItemIconChar\">&#10003;</span>\n\t</td>\n\t<td class=\"dijitReset dijitMenuItemLabel\" colspan=\"2\" data-dojo-attach-point=\"containerNode,labelNode\"></td>\n\t<td class=\"dijitReset dijitMenuItemAccelKey\" style=\"display: none\" data-dojo-attach-point=\"accelKeyNode\"></td>\n\t<td class=\"dijitReset dijitMenuArrowCell\" role=\"presentation\">&#160;</td>\n</tr>\n","dojo/dnd/Manager":function(){
define(["../_base/array","../_base/declare","../_base/event","../_base/lang","../_base/window","../dom-class","../Evented","../has","../keys","../on","../topic","../touch","./common","./autoscroll","./Avatar"],function(_39d,_39e,_39f,lang,win,_3a0,_3a1,has,keys,on,_3a2,_3a3,dnd,_3a4,_3a5){
var _3a6=_39e("dojo.dnd.Manager",[_3a1],{constructor:function(){
this.avatar=null;
this.source=null;
this.nodes=[];
this.copy=true;
this.target=null;
this.canDropFlag=false;
this.events=[];
},OFFSET_X:has("touch")?0:16,OFFSET_Y:has("touch")?-64:16,overSource:function(_3a7){
if(this.avatar){
this.target=(_3a7&&_3a7.targetState!="Disabled")?_3a7:null;
this.canDropFlag=Boolean(this.target);
this.avatar.update();
}
_3a2.publish("/dnd/source/over",_3a7);
},outSource:function(_3a8){
if(this.avatar){
if(this.target==_3a8){
this.target=null;
this.canDropFlag=false;
this.avatar.update();
_3a2.publish("/dnd/source/over",null);
}
}else{
_3a2.publish("/dnd/source/over",null);
}
},startDrag:function(_3a9,_3aa,copy){
_3a4.autoScrollStart(win.doc);
this.source=_3a9;
this.nodes=_3aa;
this.copy=Boolean(copy);
this.avatar=this.makeAvatar();
win.body().appendChild(this.avatar.node);
_3a2.publish("/dnd/start",_3a9,_3aa,this.copy);
this.events=[on(win.doc,_3a3.move,lang.hitch(this,"onMouseMove")),on(win.doc,_3a3.release,lang.hitch(this,"onMouseUp")),on(win.doc,"keydown",lang.hitch(this,"onKeyDown")),on(win.doc,"keyup",lang.hitch(this,"onKeyUp")),on(win.doc,"dragstart",_39f.stop),on(win.body(),"selectstart",_39f.stop)];
var c="dojoDnd"+(copy?"Copy":"Move");
_3a0.add(win.body(),c);
},canDrop:function(flag){
var _3ab=Boolean(this.target&&flag);
if(this.canDropFlag!=_3ab){
this.canDropFlag=_3ab;
this.avatar.update();
}
},stopDrag:function(){
_3a0.remove(win.body(),["dojoDndCopy","dojoDndMove"]);
_39d.forEach(this.events,function(_3ac){
_3ac.remove();
});
this.events=[];
this.avatar.destroy();
this.avatar=null;
this.source=this.target=null;
this.nodes=[];
},makeAvatar:function(){
return new _3a5(this);
},updateAvatar:function(){
this.avatar.update();
},onMouseMove:function(e){
var a=this.avatar;
if(a){
_3a4.autoScrollNodes(e);
var s=a.node.style;
s.left=(e.pageX+this.OFFSET_X)+"px";
s.top=(e.pageY+this.OFFSET_Y)+"px";
var copy=Boolean(this.source.copyState(dnd.getCopyKeyState(e)));
if(this.copy!=copy){
this._setCopyStatus(copy);
}
}
if(has("touch")){
e.preventDefault();
}
},onMouseUp:function(e){
if(this.avatar){
if(this.target&&this.canDropFlag){
var copy=Boolean(this.source.copyState(dnd.getCopyKeyState(e)));
_3a2.publish("/dnd/drop/before",this.source,this.nodes,copy,this.target,e);
_3a2.publish("/dnd/drop",this.source,this.nodes,copy,this.target,e);
}else{
_3a2.publish("/dnd/cancel");
}
this.stopDrag();
}
},onKeyDown:function(e){
if(this.avatar){
switch(e.keyCode){
case keys.CTRL:
var copy=Boolean(this.source.copyState(true));
if(this.copy!=copy){
this._setCopyStatus(copy);
}
break;
case keys.ESCAPE:
_3a2.publish("/dnd/cancel");
this.stopDrag();
break;
}
}
},onKeyUp:function(e){
if(this.avatar&&e.keyCode==keys.CTRL){
var copy=Boolean(this.source.copyState(false));
if(this.copy!=copy){
this._setCopyStatus(copy);
}
}
},_setCopyStatus:function(copy){
this.copy=copy;
this.source._markDndStatus(this.copy);
this.updateAvatar();
_3a0.replace(win.body(),"dojoDnd"+(this.copy?"Copy":"Move"),"dojoDnd"+(this.copy?"Move":"Copy"));
}});
dnd._manager=null;
_3a6.manager=dnd.manager=function(){
if(!dnd._manager){
dnd._manager=new _3a6();
}
return dnd._manager;
};
return _3a6;
});
},"dijit/a11yclick":function(){
define(["dojo/on","dojo/_base/array","dojo/keys","dojo/_base/declare","dojo/has","dojo/_base/unload","dojo/_base/window"],function(on,_3ad,keys,_3ae,has,_3af,win){
var _3b0=null;
if(has("dom-addeventlistener")){
win.doc.addEventListener("keydown",function(evt){
_3b0=evt.target;
},true);
}else{
(function(){
var _3b1=function(evt){
_3b0=evt.srcElement;
};
win.doc.attachEvent("onkeydown",_3b1);
_3af.addOnWindowUnload(function(){
win.doc.detachEvent("onkeydown",_3b1);
});
})();
}
function _3b2(e){
return (e.keyCode===keys.ENTER||e.keyCode===keys.SPACE)&&!e.ctrlKey&&!e.shiftKey&&!e.altKey&&!e.metaKey;
};
return function(node,_3b3){
if(/input|button/i.test(node.nodeName)){
return on(node,"click",_3b3);
}else{
var _3b4=[on(node,"keydown",function(e){
if(_3b2(e)){
_3b0=e.target;
e.preventDefault();
}
}),on(node,"keyup",function(e){
if(_3b2(e)&&e.target==_3b0){
_3b0=null;
on.emit(e.target,"click",{cancelable:true,bubbles:true});
}
}),on(node,"click",function(e){
_3b3.call(this,e);
})];
if(has("touch")){
var _3b5;
_3b4.push(on(node,"touchend",function(e){
var _3b6=e.target;
_3b5=setTimeout(function(){
_3b5=null;
on.emit(_3b6,"click",{cancelable:true,bubbles:true});
},600);
}),on(node,"click",function(e){
if(_3b5){
clearTimeout(_3b5);
}
}));
}
return {remove:function(){
_3ad.forEach(_3b4,function(h){
h.remove();
});
if(_3b5){
clearTimeout(_3b5);
_3b5=null;
}
}};
}
};
return ret;
});
},"dojox/grid/_RowSelector":function(){
define(["dojo/_base/declare","./_View"],function(_3b7,_3b8){
return _3b7("dojox.grid._RowSelector",_3b8,{defaultWidth:"2em",noscroll:true,padBorderWidth:2,buildRendering:function(){
this.inherited("buildRendering",arguments);
this.scrollboxNode.style.overflow="hidden";
this.headerNode.style.visibility="hidden";
},getWidth:function(){
return this.viewWidth||this.defaultWidth;
},buildRowContent:function(_3b9,_3ba){
var w=this.contentWidth||0;
_3ba.innerHTML="<table class=\"dojoxGridRowbarTable\" style=\"width:"+w+"px;height:1px;\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\" role=\"presentation\"><tr><td class=\"dojoxGridRowbarInner\">&nbsp;</td></tr></table>";
},renderHeader:function(){
},updateRow:function(){
},resize:function(){
this.adaptHeight();
},adaptWidth:function(){
if(!("contentWidth" in this)&&this.contentNode&&this.contentNode.offsetWidth>0){
this.contentWidth=this.contentNode.offsetWidth-this.padBorderWidth;
}
},doStyleRowNode:function(_3bb,_3bc){
var n=["dojoxGridRowbar dojoxGridNonNormalizedCell"];
if(this.grid.rows.isOver(_3bb)){
n.push("dojoxGridRowbarOver");
}
if(this.grid.selection.isSelected(_3bb)){
n.push("dojoxGridRowbarSelected");
}
_3bc.className=n.join(" ");
},domouseover:function(e){
this.grid.onMouseOverRow(e);
},domouseout:function(e){
if(!this.isIntraRowEvent(e)){
this.grid.onMouseOutRow(e);
}
}});
});
},"dojox/grid/_Layout":function(){
define("dojox/grid/_Layout",["dojo/_base/kernel","../main","dojo/_base/declare","dojo/_base/array","dojo/_base/lang","dojo/dom-geometry","./cells","./_RowSelector"],function(dojo,_3bd,_3be,_3bf,lang,_3c0){
return _3be("dojox.grid._Layout",null,{constructor:function(_3c1){
this.grid=_3c1;
},cells:[],structure:null,defaultWidth:"6em",moveColumn:function(_3c2,_3c3,_3c4,_3c5,_3c6){
var _3c7=this.structure[_3c2].cells[0];
var _3c8=this.structure[_3c3].cells[0];
var cell=null;
var _3c9=0;
var _3ca=0;
for(var i=0,c;c=_3c7[i];i++){
if(c.index==_3c4){
_3c9=i;
break;
}
}
cell=_3c7.splice(_3c9,1)[0];
cell.view=this.grid.views.views[_3c3];
for(i=0,c=null;c=_3c8[i];i++){
if(c.index==_3c5){
_3ca=i;
break;
}
}
if(!_3c6){
_3ca+=1;
}
_3c8.splice(_3ca,0,cell);
var _3cb=this.grid.getCell(this.grid.getSortIndex());
if(_3cb){
_3cb._currentlySorted=this.grid.getSortAsc();
}
this.cells=[];
_3c4=0;
var v;
for(i=0;v=this.structure[i];i++){
for(var j=0,cs;cs=v.cells[j];j++){
for(var k=0;c=cs[k];k++){
c.index=_3c4;
this.cells.push(c);
if("_currentlySorted" in c){
var si=_3c4+1;
si*=c._currentlySorted?1:-1;
this.grid.sortInfo=si;
delete c._currentlySorted;
}
_3c4++;
}
}
}
_3bf.forEach(this.cells,function(c){
var _3cc=c.markup[2].split(" ");
var _3cd=parseInt(_3cc[1].substring(5));
if(_3cd!=c.index){
_3cc[1]="idx=\""+c.index+"\"";
c.markup[2]=_3cc.join(" ");
}
});
this.grid.setupHeaderMenu();
},setColumnVisibility:function(_3ce,_3cf){
var cell=this.cells[_3ce];
if(cell.hidden==_3cf){
cell.hidden=!_3cf;
var v=cell.view,w=v.viewWidth;
if(w&&w!="auto"){
v._togglingColumn=_3c0.getMarginBox(cell.getHeaderNode()).w||0;
}
v.update();
return true;
}else{
return false;
}
},addCellDef:function(_3d0,_3d1,_3d2){
var self=this;
var _3d3=function(_3d4){
var w=0;
if(_3d4.colSpan>1){
w=0;
}else{
w=_3d4.width||self._defaultCellProps.width||self.defaultWidth;
if(!isNaN(w)){
w=w+"em";
}
}
return w;
};
var _3d5={grid:this.grid,subrow:_3d0,layoutIndex:_3d1,index:this.cells.length};
if(_3d2&&_3d2 instanceof _3bd.grid.cells._Base){
var _3d6=lang.clone(_3d2);
_3d5.unitWidth=_3d3(_3d6._props);
_3d6=lang.mixin(_3d6,this._defaultCellProps,_3d2._props,_3d5);
return _3d6;
}
var _3d7=_3d2.type||_3d2.cellType||this._defaultCellProps.type||this._defaultCellProps.cellType||_3bd.grid.cells.Cell;
if(lang.isString(_3d7)){
_3d7=lang.getObject(_3d7);
}
_3d5.unitWidth=_3d3(_3d2);
return new _3d7(lang.mixin({},this._defaultCellProps,_3d2,_3d5));
},addRowDef:function(_3d8,_3d9){
var _3da=[];
var _3db=0,_3dc=0,_3dd=true;
for(var i=0,def,cell;(def=_3d9[i]);i++){
cell=this.addCellDef(_3d8,i,def);
_3da.push(cell);
this.cells.push(cell);
if(_3dd&&cell.relWidth){
_3db+=cell.relWidth;
}else{
if(cell.width){
var w=cell.width;
if(typeof w=="string"&&w.slice(-1)=="%"){
_3dc+=window.parseInt(w,10);
}else{
if(w=="auto"){
_3dd=false;
}
}
}
}
}
if(_3db&&_3dd){
_3bf.forEach(_3da,function(cell){
if(cell.relWidth){
cell.width=cell.unitWidth=((cell.relWidth/_3db)*(100-_3dc))+"%";
}
});
}
return _3da;
},addRowsDef:function(_3de){
var _3df=[];
if(lang.isArray(_3de)){
if(lang.isArray(_3de[0])){
for(var i=0,row;_3de&&(row=_3de[i]);i++){
_3df.push(this.addRowDef(i,row));
}
}else{
_3df.push(this.addRowDef(0,_3de));
}
}
return _3df;
},addViewDef:function(_3e0){
this._defaultCellProps=_3e0.defaultCell||{};
if(_3e0.width&&_3e0.width=="auto"){
delete _3e0.width;
}
return lang.mixin({},_3e0,{cells:this.addRowsDef(_3e0.rows||_3e0.cells)});
},setStructure:function(_3e1){
this.fieldIndex=0;
this.cells=[];
var s=this.structure=[];
if(this.grid.rowSelector){
var sel={type:_3bd._scopeName+".grid._RowSelector"};
if(lang.isString(this.grid.rowSelector)){
var _3e2=this.grid.rowSelector;
if(_3e2=="false"){
sel=null;
}else{
if(_3e2!="true"){
sel["width"]=_3e2;
}
}
}else{
if(!this.grid.rowSelector){
sel=null;
}
}
if(sel){
s.push(this.addViewDef(sel));
}
}
var _3e3=function(def){
return ("name" in def||"field" in def||"get" in def);
};
var _3e4=function(def){
if(lang.isArray(def)){
if(lang.isArray(def[0])||_3e3(def[0])){
return true;
}
}
return false;
};
var _3e5=function(def){
return (def!==null&&lang.isObject(def)&&("cells" in def||"rows" in def||("type" in def&&!_3e3(def))));
};
if(lang.isArray(_3e1)){
var _3e6=false;
for(var i=0,st;(st=_3e1[i]);i++){
if(_3e5(st)){
_3e6=true;
break;
}
}
if(!_3e6){
s.push(this.addViewDef({cells:_3e1}));
}else{
for(i=0;(st=_3e1[i]);i++){
if(_3e4(st)){
s.push(this.addViewDef({cells:st}));
}else{
if(_3e5(st)){
s.push(this.addViewDef(st));
}
}
}
}
}else{
if(_3e5(_3e1)){
s.push(this.addViewDef(_3e1));
}
}
this.cellCount=this.cells.length;
this.grid.setupHeaderMenu();
}});
});
},"dojo/i18n":function(){
define(["./_base/kernel","require","./has","./_base/array","./_base/config","./_base/lang","./_base/xhr","./json","module"],function(dojo,_3e7,has,_3e8,_3e9,lang,xhr,json,_3ea){
has.add("dojo-preload-i18n-Api",1);
1||has.add("dojo-v1x-i18n-Api",1);
var _3eb=dojo.i18n={},_3ec=/(^.*(^|\/)nls)(\/|$)([^\/]*)\/?([^\/]*)/,_3ed=function(root,_3ee,_3ef,_3f0){
for(var _3f1=[_3ef+_3f0],_3f2=_3ee.split("-"),_3f3="",i=0;i<_3f2.length;i++){
_3f3+=(_3f3?"-":"")+_3f2[i];
if(!root||root[_3f3]){
_3f1.push(_3ef+_3f3+"/"+_3f0);
}
}
return _3f1;
},_3f4={},_3f5=function(_3f6,_3f7,_3f8){
_3f8=_3f8?_3f8.toLowerCase():dojo.locale;
_3f6=_3f6.replace(/\./g,"/");
_3f7=_3f7.replace(/\./g,"/");
return (/root/i.test(_3f8))?(_3f6+"/nls/"+_3f7):(_3f6+"/nls/"+_3f8+"/"+_3f7);
},_3f9=dojo.getL10nName=function(_3fa,_3fb,_3fc){
return _3fa=_3ea.id+"!"+_3f5(_3fa,_3fb,_3fc);
},_3fd=function(_3fe,_3ff,_400,_401,_402,load){
_3fe([_3ff],function(root){
var _403=lang.clone(root.root),_404=_3ed(!root._v1x&&root,_402,_400,_401);
_3fe(_404,function(){
for(var i=1;i<_404.length;i++){
_403=lang.mixin(lang.clone(_403),arguments[i]);
}
var _405=_3ff+"/"+_402;
_3f4[_405]=_403;
load();
});
});
},_406=function(id,_407){
return /^\./.test(id)?_407(id):id;
},_408=function(_409){
var list=_3e9.extraLocale||[];
list=lang.isArray(list)?list:[list];
list.push(_409);
return list;
},load=function(id,_40a,load){
if(has("dojo-preload-i18n-Api")){
var _40b=id.split("*"),_40c=_40b[1]=="preload";
if(_40c){
if(!_3f4[id]){
_3f4[id]=1;
_40d(_40b[2],json.parse(_40b[3]),1,_40a);
}
load(1);
}
if(_40c||_40e(id,_40a,load)){
return;
}
}
var _40f=_3ec.exec(id),_410=_40f[1]+"/",_411=_40f[5]||_40f[4],_412=_410+_411,_413=(_40f[5]&&_40f[4]),_414=_413||dojo.locale,_415=_412+"/"+_414,_416=_413?[_414]:_408(_414),_417=_416.length,_418=function(){
if(!--_417){
load(lang.delegate(_3f4[_415]));
}
};
_3e8.forEach(_416,function(_419){
var _41a=_412+"/"+_419;
if(has("dojo-preload-i18n-Api")){
_41b(_41a);
}
if(!_3f4[_41a]){
_3fd(_40a,_412,_410,_411,_419,_418);
}else{
_418();
}
});
};
if(has("dojo-unit-tests")){
var _41c=_3eb.unitTests=[];
}
if(has("dojo-preload-i18n-Api")||1){
var _41d=_3eb.normalizeLocale=function(_41e){
var _41f=_41e?_41e.toLowerCase():dojo.locale;
return _41f=="root"?"ROOT":_41f;
},isXd=function(mid,_420){
return (1&&1)?_420.isXdUrl(_3e7.toUrl(mid+".js")):true;
},_421=0,_422=[],_40d=_3eb._preloadLocalizations=function(_423,_424,_425,_426){
_426=_426||_3e7;
function _427(mid,_428){
if(isXd(mid,_426)||_425){
_426([mid],_428);
}else{
_432([mid],_428,_426);
}
};
function _429(_42a,func){
var _42b=_42a.split("-");
while(_42b.length){
if(func(_42b.join("-"))){
return;
}
_42b.pop();
}
func("ROOT");
};
function _42c(_42d){
_42d=_41d(_42d);
_429(_42d,function(loc){
if(_3e8.indexOf(_424,loc)>=0){
var mid=_423.replace(/\./g,"/")+"_"+loc;
_421++;
_427(mid,function(_42e){
for(var p in _42e){
_3f4[_3e7.toAbsMid(p)+"/"+loc]=_42e[p];
}
--_421;
while(!_421&&_422.length){
load.apply(null,_422.shift());
}
});
return true;
}
return false;
});
};
_42c();
_3e8.forEach(dojo.config.extraLocale,_42c);
},_40e=function(id,_42f,load){
if(_421){
_422.push([id,_42f,load]);
}
return _421;
},_41b=function(){
};
}
if(1){
var _430={},_431=new Function("__bundle","__checkForLegacyModules","__mid","__amdValue","var define = function(mid, factory){define.called = 1; __amdValue.result = factory || mid;},"+"\t   require = function(){define.called = 1;};"+"try{"+"define.called = 0;"+"eval(__bundle);"+"if(define.called==1)"+"return __amdValue;"+"if((__checkForLegacyModules = __checkForLegacyModules(__mid)))"+"return __checkForLegacyModules;"+"}catch(e){}"+"try{"+"return eval('('+__bundle+')');"+"}catch(e){"+"return e;"+"}"),_432=function(deps,_433,_434){
var _435=[];
_3e8.forEach(deps,function(mid){
var url=_434.toUrl(mid+".js");
function load(text){
var _436=_431(text,_41b,mid,_430);
if(_436===_430){
_435.push(_3f4[url]=_430.result);
}else{
if(_436 instanceof Error){
console.error("failed to evaluate i18n bundle; url="+url,_436);
_436={};
}
_435.push(_3f4[url]=(/nls\/[^\/]+\/[^\/]+$/.test(url)?_436:{root:_436,_v1x:1}));
}
};
if(_3f4[url]){
_435.push(_3f4[url]);
}else{
var _437=_434.syncLoadNls(mid);
if(_437){
_435.push(_437);
}else{
if(!xhr){
try{
_434.getText(url,true,load);
}
catch(e){
_435.push(_3f4[url]={});
}
}else{
xhr.get({url:url,sync:true,load:load,error:function(){
_435.push(_3f4[url]={});
}});
}
}
}
});
_433&&_433.apply(null,_435);
};
_41b=function(_438){
for(var _439,_43a=_438.split("/"),_43b=dojo.global[_43a[0]],i=1;_43b&&i<_43a.length-1;_43b=_43b[_43a[i++]]){
}
if(_43b){
_439=_43b[_43a[i]];
if(!_439){
_439=_43b[_43a[i].replace(/-/g,"_")];
}
if(_439){
_3f4[_438]=_439;
}
}
return _439;
};
_3eb.getLocalization=function(_43c,_43d,_43e){
var _43f,_440=_3f5(_43c,_43d,_43e);
load(_440,(!isXd(_440,_3e7)?function(deps,_441){
_432(deps,_441,_3e7);
}:_3e7),function(_442){
_43f=_442;
});
return _43f;
};
if(has("dojo-unit-tests")){
_41c.push(function(doh){
doh.register("tests.i18n.unit",function(t){
var _443;
_443=_431("{prop:1}",_41b,"nonsense",_430);
t.is({prop:1},_443);
t.is(undefined,_443[1]);
_443=_431("({prop:1})",_41b,"nonsense",_430);
t.is({prop:1},_443);
t.is(undefined,_443[1]);
_443=_431("{'prop-x':1}",_41b,"nonsense",_430);
t.is({"prop-x":1},_443);
t.is(undefined,_443[1]);
_443=_431("({'prop-x':1})",_41b,"nonsense",_430);
t.is({"prop-x":1},_443);
t.is(undefined,_443[1]);
_443=_431("define({'prop-x':1})",_41b,"nonsense",_430);
t.is(_430,_443);
t.is({"prop-x":1},_430.result);
_443=_431("define('some/module', {'prop-x':1})",_41b,"nonsense",_430);
t.is(_430,_443);
t.is({"prop-x":1},_430.result);
_443=_431("this is total nonsense and should throw an error",_41b,"nonsense",_430);
t.is(_443 instanceof Error,true);
});
});
}
}
return lang.mixin(_3eb,{dynamic:true,normalize:_406,load:load,cache:_3f4});
});
},"dojox/grid/_Grid":function(){
require({cache:{"url:dojox/grid/resources/_Grid.html":"<div hidefocus=\"hidefocus\" role=\"grid\" dojoAttachEvent=\"onmouseout:_mouseOut\">\n\t<div class=\"dojoxGridMasterHeader\" dojoAttachPoint=\"viewsHeaderNode\" role=\"presentation\"></div>\n\t<div class=\"dojoxGridMasterView\" dojoAttachPoint=\"viewsNode\" role=\"presentation\"></div>\n\t<div class=\"dojoxGridMasterMessages\" style=\"display: none;\" dojoAttachPoint=\"messagesNode\"></div>\n\t<span dojoAttachPoint=\"lastFocusNode\" tabindex=\"0\"></span>\n</div>\n"}});
define("dojox/grid/_Grid",["dojo/_base/kernel","../main","dojo/_base/declare","./_Events","./_Scroller","./_Layout","./_View","./_ViewManager","./_RowManager","./_FocusManager","./_EditManager","./Selection","./_RowSelector","./util","dijit/_Widget","dijit/_TemplatedMixin","dijit/CheckedMenuItem","dojo/text!./resources/_Grid.html","dojo/string","dojo/_base/array","dojo/_base/lang","dojo/_base/sniff","dojox/html/metrics","dojo/_base/html","dojo/query","dojo/dnd/common","dojo/i18n!dijit/nls/loading"],function(dojo,_444,_445,_446,_447,_448,_449,_44a,_44b,_44c,_44d,_44e,_44f,util,_450,_451,_452,_453,_454,_455,lang,has,_456,html,_457){
if(!dojo.isCopyKey){
dojo.isCopyKey=dojo.dnd.getCopyKeyState;
}
var _458=_445("dojox.grid._Grid",[_450,_451,_446],{templateString:_453,classTag:"dojoxGrid",rowCount:5,keepRows:75,rowsPerPage:25,autoWidth:false,initialWidth:"",autoHeight:"",rowHeight:0,autoRender:true,defaultHeight:"15em",height:"",structure:null,elasticView:-1,singleClickEdit:false,selectionMode:"extended",rowSelector:"",columnReordering:false,headerMenu:null,placeholderLabel:"GridColumns",selectable:false,_click:null,loadingMessage:"<span class='dojoxGridLoading'>${loadingState}</span>",errorMessage:"<span class='dojoxGridError'>${errorState}</span>",noDataMessage:"",escapeHTMLInData:true,formatterScope:null,editable:false,summary:"",_setSummaryAttr:"domNode",sortInfo:0,_placeholders:null,_layoutClass:_448,buildRendering:function(){
this.inherited(arguments);
if(!this.domNode.getAttribute("tabIndex")){
this.domNode.tabIndex="0";
}
this.createScroller();
this.createLayout();
this.createViews();
this.createManagers();
this.createSelection();
this.connect(this.selection,"onSelected","onSelected");
this.connect(this.selection,"onDeselected","onDeselected");
this.connect(this.selection,"onChanged","onSelectionChanged");
_456.initOnFontResize();
this.connect(_456,"onFontResize","textSizeChanged");
util.funnelEvents(this.domNode,this,"doKeyEvent",util.keyEvents);
if(this.selectionMode!="none"){
this.domNode.setAttribute("aria-multiselectable",this.selectionMode=="single"?"false":"true");
}
html.addClass(this.domNode,this.classTag);
if(!this.isLeftToRight()){
html.addClass(this.domNode,this.classTag+"Rtl");
}
},postMixInProperties:function(){
this.inherited(arguments);
var _459=dojo.i18n.getLocalization("dijit","loading",this.lang);
this.loadingMessage=_454.substitute(this.loadingMessage,_459);
this.errorMessage=_454.substitute(this.errorMessage,_459);
if(this.srcNodeRef&&this.srcNodeRef.style.height){
this.height=this.srcNodeRef.style.height;
}
this._setAutoHeightAttr(this.autoHeight,true);
this.lastScrollTop=this.scrollTop=0;
},postCreate:function(){
this._placeholders=[];
this._setHeaderMenuAttr(this.headerMenu);
this._setStructureAttr(this.structure);
this._click=[];
this.inherited(arguments);
if(this.domNode&&this.autoWidth&&this.initialWidth){
this.domNode.style.width=this.initialWidth;
}
if(this.domNode&&!this.editable){
html.attr(this.domNode,"aria-readonly","true");
}
},destroy:function(){
this.domNode.onReveal=null;
this.domNode.onSizeChange=null;
delete this._click;
if(this.scroller){
this.scroller.destroy();
delete this.scroller;
}
this.edit.destroy();
delete this.edit;
this.views.destroyViews();
if(this.focus){
this.focus.destroy();
delete this.focus;
}
if(this.headerMenu&&this._placeholders.length){
_455.forEach(this._placeholders,function(p){
p.unReplace(true);
});
this.headerMenu.unBindDomNode(this.viewsHeaderNode);
}
this.inherited(arguments);
},_setAutoHeightAttr:function(ah,_45a){
if(typeof ah=="string"){
if(!ah||ah=="false"){
ah=false;
}else{
if(ah=="true"){
ah=true;
}else{
ah=window.parseInt(ah,10);
}
}
}
if(typeof ah=="number"){
if(isNaN(ah)){
ah=false;
}
if(ah<0){
ah=true;
}else{
if(ah===0){
ah=false;
}
}
}
this.autoHeight=ah;
if(typeof ah=="boolean"){
this._autoHeight=ah;
}else{
if(typeof ah=="number"){
this._autoHeight=(ah>=this.get("rowCount"));
}else{
this._autoHeight=false;
}
}
if(this._started&&!_45a){
this.render();
}
},_getRowCountAttr:function(){
return this.updating&&this.invalidated&&this.invalidated.rowCount!=undefined?this.invalidated.rowCount:this.rowCount;
},textSizeChanged:function(){
this.render();
},sizeChange:function(){
this.update();
},createManagers:function(){
this.rows=new _44b(this);
this.focus=new _44c(this);
this.edit=new _44d(this);
},createSelection:function(){
this.selection=new _44e(this);
},createScroller:function(){
this.scroller=new _447();
this.scroller.grid=this;
this.scroller.renderRow=lang.hitch(this,"renderRow");
this.scroller.removeRow=lang.hitch(this,"rowRemoved");
},createLayout:function(){
this.layout=new this._layoutClass(this);
this.connect(this.layout,"moveColumn","onMoveColumn");
},onMoveColumn:function(){
this.update();
},onResizeColumn:function(_45b){
},createViews:function(){
this.views=new _44a(this);
this.views.createView=lang.hitch(this,"createView");
},createView:function(_45c,idx){
var c=lang.getObject(_45c);
var view=new c({grid:this,index:idx});
this.viewsNode.appendChild(view.domNode);
this.viewsHeaderNode.appendChild(view.headerNode);
this.views.addView(view);
html.attr(this.domNode,"align",this.isLeftToRight()?"left":"right");
return view;
},buildViews:function(){
for(var i=0,vs;(vs=this.layout.structure[i]);i++){
this.createView(vs.type||_444._scopeName+".grid._View",i).setStructure(vs);
}
this.scroller.setContentNodes(this.views.getContentNodes());
},_setStructureAttr:function(_45d){
var s=_45d;
if(s&&lang.isString(s)){
dojo.deprecated("dojox.grid._Grid.set('structure', 'objVar')","use dojox.grid._Grid.set('structure', objVar) instead","2.0");
s=lang.getObject(s);
}
this.structure=s;
if(!s){
if(this.layout.structure){
s=this.layout.structure;
}else{
return;
}
}
this.views.destroyViews();
this.focus.focusView=null;
if(s!==this.layout.structure){
this.layout.setStructure(s);
}
this._structureChanged();
},setStructure:function(_45e){
dojo.deprecated("dojox.grid._Grid.setStructure(obj)","use dojox.grid._Grid.set('structure', obj) instead.","2.0");
this._setStructureAttr(_45e);
},getColumnTogglingItems:function(){
var _45f,_460=[];
_45f=_455.map(this.layout.cells,function(cell){
if(!cell.menuItems){
cell.menuItems=[];
}
var self=this;
var item=new _452({label:cell.name,checked:!cell.hidden,_gridCell:cell,onChange:function(_461){
if(self.layout.setColumnVisibility(this._gridCell.index,_461)){
var _462=this._gridCell.menuItems;
if(_462.length>1){
_455.forEach(_462,function(item){
if(item!==this){
item.setAttribute("checked",_461);
}
},this);
}
_461=_455.filter(self.layout.cells,function(c){
if(c.menuItems.length>1){
_455.forEach(c.menuItems,"item.set('disabled', false);");
}else{
c.menuItems[0].set("disabled",false);
}
return !c.hidden;
});
if(_461.length==1){
_455.forEach(_461[0].menuItems,"item.set('disabled', true);");
}
}
},destroy:function(){
var _463=_455.indexOf(this._gridCell.menuItems,this);
this._gridCell.menuItems.splice(_463,1);
delete this._gridCell;
_452.prototype.destroy.apply(this,arguments);
}});
cell.menuItems.push(item);
if(!cell.hidden){
_460.push(item);
}
return item;
},this);
if(_460.length==1){
_460[0].set("disabled",true);
}
return _45f;
},_setHeaderMenuAttr:function(menu){
if(this._placeholders&&this._placeholders.length){
_455.forEach(this._placeholders,function(p){
p.unReplace(true);
});
this._placeholders=[];
}
if(this.headerMenu){
this.headerMenu.unBindDomNode(this.viewsHeaderNode);
}
this.headerMenu=menu;
if(!menu){
return;
}
this.headerMenu.bindDomNode(this.viewsHeaderNode);
if(this.headerMenu.getPlaceholders){
this._placeholders=this.headerMenu.getPlaceholders(this.placeholderLabel);
}
},setHeaderMenu:function(menu){
dojo.deprecated("dojox.grid._Grid.setHeaderMenu(obj)","use dojox.grid._Grid.set('headerMenu', obj) instead.","2.0");
this._setHeaderMenuAttr(menu);
},setupHeaderMenu:function(){
if(this._placeholders&&this._placeholders.length){
_455.forEach(this._placeholders,function(p){
if(p._replaced){
p.unReplace(true);
}
p.replace(this.getColumnTogglingItems());
},this);
}
},_fetch:function(_464){
this.setScrollTop(0);
},getItem:function(_465){
return null;
},showMessage:function(_466){
if(_466){
this.messagesNode.innerHTML=_466;
this.messagesNode.style.display="";
}else{
this.messagesNode.innerHTML="";
this.messagesNode.style.display="none";
}
},_structureChanged:function(){
this.buildViews();
if(this.autoRender&&this._started){
this.render();
}
},hasLayout:function(){
return this.layout.cells.length;
},resize:function(_467,_468){
if(dojo.isIE&&!_467&&!_468&&this._autoHeight){
return;
}
this._pendingChangeSize=_467;
this._pendingResultSize=_468;
this.sizeChange();
},_getPadBorder:function(){
this._padBorder=this._padBorder||html._getPadBorderExtents(this.domNode);
return this._padBorder;
},_getHeaderHeight:function(){
var vns=this.viewsHeaderNode.style,t=vns.display=="none"?0:this.views.measureHeader();
vns.height=t+"px";
this.views.normalizeHeaderNodeHeight();
return t;
},_resize:function(_469,_46a){
_469=_469||this._pendingChangeSize;
_46a=_46a||this._pendingResultSize;
delete this._pendingChangeSize;
delete this._pendingResultSize;
if(!this.domNode){
return;
}
var pn=this.domNode.parentNode;
if(!pn||pn.nodeType!=1||!this.hasLayout()||pn.style.visibility=="hidden"||pn.style.display=="none"){
return;
}
var _46b=this._getPadBorder();
var hh=undefined;
var h;
if(this._autoHeight){
this.domNode.style.height="auto";
}else{
if(typeof this.autoHeight=="number"){
h=hh=this._getHeaderHeight();
h+=(this.scroller.averageRowHeight*this.autoHeight);
this.domNode.style.height=h+"px";
}else{
if(this.domNode.clientHeight<=_46b.h){
if(pn==document.body){
this.domNode.style.height=this.defaultHeight;
}else{
if(this.height){
this.domNode.style.height=this.height;
}else{
this.fitTo="parent";
}
}
}
}
}
if(_46a){
_469=_46a;
}
if(!this._autoHeight&&_469){
html.marginBox(this.domNode,_469);
this.height=this.domNode.style.height;
delete this.fitTo;
}else{
if(this.fitTo=="parent"){
h=this._parentContentBoxHeight=this._parentContentBoxHeight||html._getContentBox(pn).h;
this.domNode.style.height=Math.max(0,h)+"px";
}
}
var _46c=_455.some(this.views.views,function(v){
return v.flexCells;
});
if(!this._autoHeight&&(h||html._getContentBox(this.domNode).h)===0){
this.viewsHeaderNode.style.display="none";
}else{
this.viewsHeaderNode.style.display="block";
if(!_46c&&hh===undefined){
hh=this._getHeaderHeight();
}
}
if(_46c){
hh=undefined;
}
this.adaptWidth();
this.adaptHeight(hh);
this.postresize();
},adaptWidth:function(){
var _46d=(!this.initialWidth&&this.autoWidth);
var w=_46d?0:this.domNode.clientWidth||(this.domNode.offsetWidth-this._getPadBorder().w),vw=this.views.arrange(1,w);
this.views.onEach("adaptWidth");
if(_46d){
this.domNode.style.width=vw+"px";
}
},adaptHeight:function(_46e){
var t=_46e===undefined?this._getHeaderHeight():_46e;
var h=(this._autoHeight?-1:Math.max(this.domNode.clientHeight-t,0)||0);
this.views.onEach("setSize",[0,h]);
this.views.onEach("adaptHeight");
if(!this._autoHeight){
var _46f=0,_470=0;
var _471=_455.filter(this.views.views,function(v){
var has=v.hasHScrollbar();
if(has){
_46f++;
}else{
_470++;
}
return (!has);
});
if(_46f>0&&_470>0){
_455.forEach(_471,function(v){
v.adaptHeight(true);
});
}
}
if(this.autoHeight===true||h!=-1||(typeof this.autoHeight=="number"&&this.autoHeight>=this.get("rowCount"))){
this.scroller.windowHeight=h;
}else{
this.scroller.windowHeight=Math.max(this.domNode.clientHeight-t,0);
}
},startup:function(){
if(this._started){
return;
}
this.inherited(arguments);
if(this.autoRender){
this.render();
}
},render:function(){
if(!this.domNode){
return;
}
if(!this._started){
return;
}
if(!this.hasLayout()){
this.scroller.init(0,this.keepRows,this.rowsPerPage);
return;
}
this.update=this.defaultUpdate;
this._render();
},_render:function(){
this.scroller.init(this.get("rowCount"),this.keepRows,this.rowsPerPage);
this.prerender();
this.setScrollTop(0);
this.postrender();
},prerender:function(){
this.keepRows=this._autoHeight?0:this.keepRows;
this.scroller.setKeepInfo(this.keepRows);
this.views.render();
this._resize();
},postrender:function(){
this.postresize();
this.focus.initFocusView();
html.setSelectable(this.domNode,this.selectable);
},postresize:function(){
if(this._autoHeight){
var size=Math.max(this.views.measureContent())+"px";
this.viewsNode.style.height=size;
}
},renderRow:function(_472,_473){
this.views.renderRow(_472,_473,this._skipRowRenormalize);
},rowRemoved:function(_474){
this.views.rowRemoved(_474);
},invalidated:null,updating:false,beginUpdate:function(){
this.invalidated=[];
this.updating=true;
},endUpdate:function(){
this.updating=false;
var i=this.invalidated,r;
if(i.all){
this.update();
}else{
if(i.rowCount!=undefined){
this.updateRowCount(i.rowCount);
}else{
for(r in i){
this.updateRow(Number(r));
}
}
}
this.invalidated=[];
},defaultUpdate:function(){
if(!this.domNode){
return;
}
if(this.updating){
this.invalidated.all=true;
return;
}
this.lastScrollTop=this.scrollTop;
this.prerender();
this.scroller.invalidateNodes();
this.setScrollTop(this.lastScrollTop);
this.postrender();
},update:function(){
this.render();
},updateRow:function(_475){
_475=Number(_475);
if(this.updating){
this.invalidated[_475]=true;
}else{
this.views.updateRow(_475);
this.scroller.rowHeightChanged(_475);
}
},updateRows:function(_476,_477){
_476=Number(_476);
_477=Number(_477);
var i;
if(this.updating){
for(i=0;i<_477;i++){
this.invalidated[i+_476]=true;
}
}else{
for(i=0;i<_477;i++){
this.views.updateRow(i+_476,this._skipRowRenormalize);
}
this.scroller.rowHeightChanged(_476);
}
},updateRowCount:function(_478){
if(this.updating){
this.invalidated.rowCount=_478;
}else{
this.rowCount=_478;
this._setAutoHeightAttr(this.autoHeight,true);
if(this.layout.cells.length){
this.scroller.updateRowCount(_478);
}
this._resize();
if(this.layout.cells.length){
this.setScrollTop(this.scrollTop);
}
}
},updateRowStyles:function(_479){
this.views.updateRowStyles(_479);
},getRowNode:function(_47a){
if(this.focus.focusView&&!(this.focus.focusView instanceof _44f)){
return this.focus.focusView.rowNodes[_47a];
}else{
for(var i=0,_47b;(_47b=this.views.views[i]);i++){
if(!(_47b instanceof _44f)){
return _47b.rowNodes[_47a];
}
}
}
return null;
},rowHeightChanged:function(_47c){
this.views.renormalizeRow(_47c);
this.scroller.rowHeightChanged(_47c);
},fastScroll:true,delayScroll:false,scrollRedrawThreshold:(has("ie")?100:50),scrollTo:function(_47d){
if(!this.fastScroll){
this.setScrollTop(_47d);
return;
}
var _47e=Math.abs(this.lastScrollTop-_47d);
this.lastScrollTop=_47d;
if(_47e>this.scrollRedrawThreshold||this.delayScroll){
this.delayScroll=true;
this.scrollTop=_47d;
this.views.setScrollTop(_47d);
if(this._pendingScroll){
window.clearTimeout(this._pendingScroll);
}
var _47f=this;
this._pendingScroll=window.setTimeout(function(){
delete _47f._pendingScroll;
_47f.finishScrollJob();
},200);
}else{
this.setScrollTop(_47d);
}
},finishScrollJob:function(){
this.delayScroll=false;
this.setScrollTop(this.scrollTop);
},setScrollTop:function(_480){
this.scroller.scroll(this.views.setScrollTop(_480));
},scrollToRow:function(_481){
this.setScrollTop(this.scroller.findScrollTop(_481)+1);
},styleRowNode:function(_482,_483){
if(_483){
this.rows.styleRowNode(_482,_483);
}
},_mouseOut:function(e){
this.rows.setOverRow(-2);
},getCell:function(_484){
return this.layout.cells[_484];
},setCellWidth:function(_485,_486){
this.getCell(_485).unitWidth=_486;
},getCellName:function(_487){
return "Cell "+_487.index;
},canSort:function(_488){
},sort:function(){
},getSortAsc:function(_489){
_489=_489==undefined?this.sortInfo:_489;
return Boolean(_489>0);
},getSortIndex:function(_48a){
_48a=_48a==undefined?this.sortInfo:_48a;
return Math.abs(_48a)-1;
},setSortIndex:function(_48b,_48c){
var si=_48b+1;
if(_48c!=undefined){
si*=(_48c?1:-1);
}else{
if(this.getSortIndex()==_48b){
si=-this.sortInfo;
}
}
this.setSortInfo(si);
},setSortInfo:function(_48d){
if(this.canSort(_48d)){
this.sortInfo=_48d;
this.sort();
this.update();
}
},doKeyEvent:function(e){
e.dispatch="do"+e.type;
this.onKeyEvent(e);
},_dispatch:function(m,e){
if(m in this){
return this[m](e);
}
return false;
},dispatchKeyEvent:function(e){
this._dispatch(e.dispatch,e);
},dispatchContentEvent:function(e){
this.edit.dispatchEvent(e)||e.sourceView.dispatchContentEvent(e)||this._dispatch(e.dispatch,e);
},dispatchHeaderEvent:function(e){
e.sourceView.dispatchHeaderEvent(e)||this._dispatch("doheader"+e.type,e);
},dokeydown:function(e){
this.onKeyDown(e);
},doclick:function(e){
if(e.cellNode){
this.onCellClick(e);
}else{
this.onRowClick(e);
}
},dodblclick:function(e){
if(e.cellNode){
this.onCellDblClick(e);
}else{
this.onRowDblClick(e);
}
},docontextmenu:function(e){
if(e.cellNode){
this.onCellContextMenu(e);
}else{
this.onRowContextMenu(e);
}
},doheaderclick:function(e){
if(e.cellNode){
this.onHeaderCellClick(e);
}else{
this.onHeaderClick(e);
}
},doheaderdblclick:function(e){
if(e.cellNode){
this.onHeaderCellDblClick(e);
}else{
this.onHeaderDblClick(e);
}
},doheadercontextmenu:function(e){
if(e.cellNode){
this.onHeaderCellContextMenu(e);
}else{
this.onHeaderContextMenu(e);
}
},doStartEdit:function(_48e,_48f){
this.onStartEdit(_48e,_48f);
},doApplyCellEdit:function(_490,_491,_492){
this.onApplyCellEdit(_490,_491,_492);
},doCancelEdit:function(_493){
this.onCancelEdit(_493);
},doApplyEdit:function(_494){
this.onApplyEdit(_494);
},addRow:function(){
this.updateRowCount(this.get("rowCount")+1);
},removeSelectedRows:function(){
if(this.allItemsSelected){
this.updateRowCount(0);
}else{
this.updateRowCount(Math.max(0,this.get("rowCount")-this.selection.getSelected().length));
}
this.selection.clear();
}});
_458.markupFactory=function(_495,node,ctor,_496){
var _497=function(n){
var w=html.attr(n,"width")||"auto";
if((w!="auto")&&(w.slice(-2)!="em")&&(w.slice(-1)!="%")){
w=parseInt(w,10)+"px";
}
return w;
};
if(!_495.structure&&node.nodeName.toLowerCase()=="table"){
_495.structure=_457("> colgroup",node).map(function(cg){
var sv=html.attr(cg,"span");
var v={noscroll:(html.attr(cg,"noscroll")=="true")?true:false,__span:(!!sv?parseInt(sv,10):1),cells:[]};
if(html.hasAttr(cg,"width")){
v.width=_497(cg);
}
return v;
});
if(!_495.structure.length){
_495.structure.push({__span:Infinity,cells:[]});
}
_457("thead > tr",node).forEach(function(tr,_498){
var _499=0;
var _49a=0;
var _49b;
var _49c=null;
_457("> th",tr).map(function(th){
if(!_49c){
_49b=0;
_49c=_495.structure[0];
}else{
if(_499>=(_49b+_49c.__span)){
_49a++;
_49b+=_49c.__span;
var _49d=_49c;
_49c=_495.structure[_49a];
}
}
var cell={name:lang.trim(html.attr(th,"name")||th.innerHTML),colSpan:parseInt(html.attr(th,"colspan")||1,10),type:lang.trim(html.attr(th,"cellType")||""),id:lang.trim(html.attr(th,"id")||"")};
_499+=cell.colSpan;
var _49e=html.attr(th,"rowspan");
if(_49e){
cell.rowSpan=_49e;
}
if(html.hasAttr(th,"width")){
cell.width=_497(th);
}
if(html.hasAttr(th,"relWidth")){
cell.relWidth=window.parseInt(html.attr(th,"relWidth"),10);
}
if(html.hasAttr(th,"hidden")){
cell.hidden=(html.attr(th,"hidden")=="true"||html.attr(th,"hidden")===true);
}
if(_496){
_496(th,cell);
}
cell.type=cell.type?lang.getObject(cell.type):_444.grid.cells.Cell;
if(cell.type&&cell.type.markupFactory){
cell.type.markupFactory(th,cell);
}
if(!_49c.cells[_498]){
_49c.cells[_498]=[];
}
_49c.cells[_498].push(cell);
});
});
}
return new ctor(_495,node);
};
return _458;
});
},"dojox/main":function(){
define("dojox/main",["dojo/_base/kernel"],function(dojo){
return dojo.dojox;
});
},"dojo/dnd/Mover":function(){
define(["../_base/array","../_base/declare","../_base/event","../_base/lang","../sniff","../_base/window","../dom","../dom-geometry","../dom-style","../Evented","../on","../touch","./common","./autoscroll"],function(_49f,_4a0,_4a1,lang,has,win,dom,_4a2,_4a3,_4a4,on,_4a5,dnd,_4a6){
return _4a0("dojo.dnd.Mover",[_4a4],{constructor:function(node,e,host){
this.node=dom.byId(node);
this.marginBox={l:e.pageX,t:e.pageY};
this.mouseButton=e.button;
var h=(this.host=host),d=node.ownerDocument;
this.events=[on(d,_4a5.move,lang.hitch(this,"onFirstMove")),on(d,_4a5.move,lang.hitch(this,"onMouseMove")),on(d,_4a5.release,lang.hitch(this,"onMouseUp")),on(d,"dragstart",_4a1.stop),on(d.body,"selectstart",_4a1.stop)];
_4a6.autoScrollStart(d);
if(h&&h.onMoveStart){
h.onMoveStart(this);
}
},onMouseMove:function(e){
_4a6.autoScroll(e);
var m=this.marginBox;
this.host.onMove(this,{l:m.l+e.pageX,t:m.t+e.pageY},e);
_4a1.stop(e);
},onMouseUp:function(e){
if(has("webkit")&&has("mac")&&this.mouseButton==2?e.button==0:this.mouseButton==e.button){
this.destroy();
}
_4a1.stop(e);
},onFirstMove:function(e){
var s=this.node.style,l,t,h=this.host;
switch(s.position){
case "relative":
case "absolute":
l=Math.round(parseFloat(s.left))||0;
t=Math.round(parseFloat(s.top))||0;
break;
default:
s.position="absolute";
var m=_4a2.getMarginBox(this.node);
var b=win.doc.body;
var bs=_4a3.getComputedStyle(b);
var bm=_4a2.getMarginBox(b,bs);
var bc=_4a2.getContentBox(b,bs);
l=m.l-(bc.l-bm.l);
t=m.t-(bc.t-bm.t);
break;
}
this.marginBox.l=l-this.marginBox.l;
this.marginBox.t=t-this.marginBox.t;
if(h&&h.onFirstMove){
h.onFirstMove(this,e);
}
this.events.shift().remove();
},destroy:function(){
_49f.forEach(this.events,function(_4a7){
_4a7.remove();
});
var h=this.host;
if(h&&h.onMoveStop){
h.onMoveStop(this);
}
this.events=this.node=this.host=null;
}});
});
},"dojo/Stateful":function(){
define(["./_base/declare","./_base/lang","./_base/array","dojo/when"],function(_4a8,lang,_4a9,when){
return _4a8("dojo.Stateful",null,{_attrPairNames:{},_getAttrNames:function(name){
var apn=this._attrPairNames;
if(apn[name]){
return apn[name];
}
return (apn[name]={s:"_"+name+"Setter",g:"_"+name+"Getter"});
},postscript:function(_4aa){
if(_4aa){
this.set(_4aa);
}
},_get:function(name,_4ab){
return typeof this[_4ab.g]==="function"?this[_4ab.g]():this[name];
},get:function(name){
return this._get(name,this._getAttrNames(name));
},set:function(name,_4ac){
if(typeof name==="object"){
for(var x in name){
if(name.hasOwnProperty(x)&&x!="_watchCallbacks"){
this.set(x,name[x]);
}
}
return this;
}
var _4ad=this._getAttrNames(name),_4ae=this._get(name,_4ad),_4af=this[_4ad.s],_4b0;
if(typeof _4af==="function"){
_4b0=_4af.apply(this,Array.prototype.slice.call(arguments,1));
}else{
this[name]=_4ac;
}
if(this._watchCallbacks){
var self=this;
when(_4b0,function(){
self._watchCallbacks(name,_4ae,_4ac);
});
}
return this;
},_changeAttrValue:function(name,_4b1){
var _4b2=this.get(name);
this[name]=_4b1;
if(this._watchCallbacks){
this._watchCallbacks(name,_4b2,_4b1);
}
return this;
},watch:function(name,_4b3){
var _4b4=this._watchCallbacks;
if(!_4b4){
var self=this;
_4b4=this._watchCallbacks=function(name,_4b5,_4b6,_4b7){
var _4b8=function(_4b9){
if(_4b9){
_4b9=_4b9.slice();
for(var i=0,l=_4b9.length;i<l;i++){
_4b9[i].call(self,name,_4b5,_4b6);
}
}
};
_4b8(_4b4["_"+name]);
if(!_4b7){
_4b8(_4b4["*"]);
}
};
}
if(!_4b3&&typeof name==="function"){
_4b3=name;
name="*";
}else{
name="_"+name;
}
var _4ba=_4b4[name];
if(typeof _4ba!=="object"){
_4ba=_4b4[name]=[];
}
_4ba.push(_4b3);
var _4bb={};
_4bb.unwatch=_4bb.remove=function(){
var _4bc=_4a9.indexOf(_4ba,_4b3);
if(_4bc>-1){
_4ba.splice(_4bc,1);
}
};
return _4bb;
}});
});
},"dojo/touch":function(){
define(["./_base/kernel","./_base/lang","./aspect","./dom","./on","./has","./mouse","./ready","./_base/window"],function(dojo,lang,_4bd,dom,on,has,_4be,_4bf,win){
var _4c0=has("touch");
var _4c1,_4c2;
if(_4c0){
_4bf(function(){
_4c2=win.body();
win.doc.addEventListener("touchstart",function(evt){
var _4c3=_4c2;
_4c2=evt.target;
on.emit(_4c3,"dojotouchout",{target:_4c3,relatedTarget:_4c2,bubbles:true});
on.emit(_4c2,"dojotouchover",{target:_4c2,relatedTarget:_4c3,bubbles:true});
},true);
on(win.doc,"touchmove",function(evt){
var _4c4=win.doc.elementFromPoint(evt.pageX-win.global.pageXOffset,evt.pageY-win.global.pageYOffset);
if(_4c4&&_4c2!==_4c4){
on.emit(_4c2,"dojotouchout",{target:_4c2,relatedTarget:_4c4,bubbles:true});
on.emit(_4c4,"dojotouchover",{target:_4c4,relatedTarget:_4c2,bubbles:true});
_4c2=_4c4;
}
});
});
_4c1=function(node,_4c5){
return on(win.doc,"touchmove",function(evt){
if(node===win.doc||dom.isDescendant(_4c2,node)){
_4c5.call(this,lang.mixin({},evt,{target:_4c2}));
}
});
};
}
function _4c6(type){
return function(node,_4c7){
return on(node,type,_4c7);
};
};
var _4c8={press:_4c6(_4c0?"touchstart":"mousedown"),move:_4c0?_4c1:_4c6("mousemove"),release:_4c6(_4c0?"touchend":"mouseup"),cancel:_4c0?_4c6("touchcancel"):_4be.leave,over:_4c6(_4c0?"dojotouchover":"mouseover"),out:_4c6(_4c0?"dojotouchout":"mouseout"),enter:_4be._eventHandler(_4c0?"dojotouchover":"mouseover"),leave:_4be._eventHandler(_4c0?"dojotouchout":"mouseout")};
1&&(dojo.touch=_4c8);
return _4c8;
});
},"dojox/grid/Selection":function(){
define(["dojo/_base/declare","dojo/_base/array","dojo/_base/lang","dojo/dom-attr"],function(_4c9,_4ca,lang,_4cb){
return _4c9("dojox.grid.Selection",null,{constructor:function(_4cc){
this.grid=_4cc;
this.selected=[];
this.setMode(_4cc.selectionMode);
},mode:"extended",selected:null,updating:0,selectedIndex:-1,setMode:function(mode){
if(this.selected.length){
this.deselectAll();
}
if(mode!="extended"&&mode!="multiple"&&mode!="single"&&mode!="none"){
this.mode="extended";
}else{
this.mode=mode;
}
},onCanSelect:function(_4cd){
return this.grid.onCanSelect(_4cd);
},onCanDeselect:function(_4ce){
return this.grid.onCanDeselect(_4ce);
},onSelected:function(_4cf){
},onDeselected:function(_4d0){
},onChanging:function(){
},onChanged:function(){
},isSelected:function(_4d1){
if(this.mode=="none"){
return false;
}
return this.selected[_4d1];
},getFirstSelected:function(){
if(!this.selected.length||this.mode=="none"){
return -1;
}
for(var i=0,l=this.selected.length;i<l;i++){
if(this.selected[i]){
return i;
}
}
return -1;
},getNextSelected:function(_4d2){
if(this.mode=="none"){
return -1;
}
for(var i=_4d2+1,l=this.selected.length;i<l;i++){
if(this.selected[i]){
return i;
}
}
return -1;
},getSelected:function(){
var _4d3=[];
for(var i=0,l=this.selected.length;i<l;i++){
if(this.selected[i]){
_4d3.push(i);
}
}
return _4d3;
},getSelectedCount:function(){
var c=0;
for(var i=0;i<this.selected.length;i++){
if(this.selected[i]){
c++;
}
}
return c;
},_beginUpdate:function(){
if(this.updating===0){
this.onChanging();
}
this.updating++;
},_endUpdate:function(){
this.updating--;
if(this.updating===0){
this.onChanged();
}
},select:function(_4d4){
if(this.mode=="none"){
return;
}
if(this.mode!="multiple"){
this.deselectAll(_4d4);
this.addToSelection(_4d4);
}else{
this.toggleSelect(_4d4);
}
},addToSelection:function(_4d5){
if(this.mode=="none"){
return;
}
if(lang.isArray(_4d5)){
_4ca.forEach(_4d5,this.addToSelection,this);
return;
}
_4d5=Number(_4d5);
if(this.selected[_4d5]){
this.selectedIndex=_4d5;
}else{
if(this.onCanSelect(_4d5)!==false){
this.selectedIndex=_4d5;
var _4d6=this.grid.getRowNode(_4d5);
if(_4d6){
_4cb.set(_4d6,"aria-selected","true");
}
this._beginUpdate();
this.selected[_4d5]=true;
this.onSelected(_4d5);
this._endUpdate();
}
}
},deselect:function(_4d7){
if(this.mode=="none"){
return;
}
if(lang.isArray(_4d7)){
_4ca.forEach(_4d7,this.deselect,this);
return;
}
_4d7=Number(_4d7);
if(this.selectedIndex==_4d7){
this.selectedIndex=-1;
}
if(this.selected[_4d7]){
if(this.onCanDeselect(_4d7)===false){
return;
}
var _4d8=this.grid.getRowNode(_4d7);
if(_4d8){
_4cb.set(_4d8,"aria-selected","false");
}
this._beginUpdate();
delete this.selected[_4d7];
this.onDeselected(_4d7);
this._endUpdate();
}
},setSelected:function(_4d9,_4da){
this[(_4da?"addToSelection":"deselect")](_4d9);
},toggleSelect:function(_4db){
if(lang.isArray(_4db)){
_4ca.forEach(_4db,this.toggleSelect,this);
return;
}
this.setSelected(_4db,!this.selected[_4db]);
},_range:function(_4dc,inTo,func){
var s=(_4dc>=0?_4dc:inTo),e=inTo;
if(s>e){
e=s;
s=inTo;
}
for(var i=s;i<=e;i++){
func(i);
}
},selectRange:function(_4dd,inTo){
this._range(_4dd,inTo,lang.hitch(this,"addToSelection"));
},deselectRange:function(_4de,inTo){
this._range(_4de,inTo,lang.hitch(this,"deselect"));
},insert:function(_4df){
this.selected.splice(_4df,0,false);
if(this.selectedIndex>=_4df){
this.selectedIndex++;
}
},remove:function(_4e0){
this.selected.splice(_4e0,1);
if(this.selectedIndex>=_4e0){
this.selectedIndex--;
}
},deselectAll:function(_4e1){
for(var i in this.selected){
if((i!=_4e1)&&(this.selected[i]===true)){
this.deselect(i);
}
}
},clickSelect:function(_4e2,_4e3,_4e4){
if(this.mode=="none"){
return;
}
this._beginUpdate();
if(this.mode!="extended"){
this.select(_4e2);
}else{
var _4e5=this.selectedIndex;
if(!_4e3){
this.deselectAll(_4e2);
}
if(_4e4){
this.selectRange(_4e5,_4e2);
}else{
if(_4e3){
this.toggleSelect(_4e2);
}else{
this.addToSelection(_4e2);
}
}
}
this._endUpdate();
},clickSelectEvent:function(e){
this.clickSelect(e.rowIndex,dojo.isCopyKey(e),e.shiftKey);
},clear:function(){
this._beginUpdate();
this.deselectAll();
this._endUpdate();
}});
});
},"dijit/_CssStateMixin":function(){
define(["dojo/_base/array","dojo/_base/declare","dojo/dom","dojo/dom-class","dojo/_base/lang","dojo/on","dojo/ready","dojo/_base/window","./registry"],function(_4e6,_4e7,dom,_4e8,lang,on,_4e9,win,_4ea){
var _4eb=_4e7("dijit._CssStateMixin",[],{cssStateNodes:{},hovering:false,active:false,_applyAttributes:function(){
this.inherited(arguments);
_4e6.forEach(["disabled","readOnly","checked","selected","focused","state","hovering","active","_opened"],function(attr){
this.watch(attr,lang.hitch(this,"_setStateClass"));
},this);
for(var ap in this.cssStateNodes){
this._trackMouseState(this[ap],this.cssStateNodes[ap]);
}
this._trackMouseState(this.domNode,this.baseClass);
this._setStateClass();
},_cssMouseEvent:function(_4ec){
if(!this.disabled){
switch(_4ec.type){
case "mouseover":
this._set("hovering",true);
this._set("active",this._mouseDown);
break;
case "mouseout":
this._set("hovering",false);
this._set("active",false);
break;
case "mousedown":
case "touchstart":
this._set("active",true);
break;
case "mouseup":
case "touchend":
this._set("active",false);
break;
}
}
},_setStateClass:function(){
var _4ed=this.baseClass.split(" ");
function _4ee(_4ef){
_4ed=_4ed.concat(_4e6.map(_4ed,function(c){
return c+_4ef;
}),"dijit"+_4ef);
};
if(!this.isLeftToRight()){
_4ee("Rtl");
}
var _4f0=this.checked=="mixed"?"Mixed":(this.checked?"Checked":"");
if(this.checked){
_4ee(_4f0);
}
if(this.state){
_4ee(this.state);
}
if(this.selected){
_4ee("Selected");
}
if(this._opened){
_4ee("Opened");
}
if(this.disabled){
_4ee("Disabled");
}else{
if(this.readOnly){
_4ee("ReadOnly");
}else{
if(this.active){
_4ee("Active");
}else{
if(this.hovering){
_4ee("Hover");
}
}
}
}
if(this.focused){
_4ee("Focused");
}
var tn=this.stateNode||this.domNode,_4f1={};
_4e6.forEach(tn.className.split(" "),function(c){
_4f1[c]=true;
});
if("_stateClasses" in this){
_4e6.forEach(this._stateClasses,function(c){
delete _4f1[c];
});
}
_4e6.forEach(_4ed,function(c){
_4f1[c]=true;
});
var _4f2=[];
for(var c in _4f1){
_4f2.push(c);
}
tn.className=_4f2.join(" ");
this._stateClasses=_4ed;
},_subnodeCssMouseEvent:function(node,_4f3,evt){
if(this.disabled||this.readOnly){
return;
}
function _4f4(_4f5){
_4e8.toggle(node,_4f3+"Hover",_4f5);
};
function _4f6(_4f7){
_4e8.toggle(node,_4f3+"Active",_4f7);
};
function _4f8(_4f9){
_4e8.toggle(node,_4f3+"Focused",_4f9);
};
switch(evt.type){
case "mouseover":
_4f4(true);
break;
case "mouseout":
_4f4(false);
_4f6(false);
break;
case "mousedown":
case "touchstart":
_4f6(true);
break;
case "mouseup":
case "touchend":
_4f6(false);
break;
case "focus":
case "focusin":
_4f8(true);
break;
case "blur":
case "focusout":
_4f8(false);
break;
}
},_trackMouseState:function(node,_4fa){
node._cssState=_4fa;
}});
_4e9(function(){
function _4fb(evt){
if(!dom.isDescendant(evt.relatedTarget,evt.target)){
for(var node=evt.target;node&&node!=evt.relatedTarget;node=node.parentNode){
if(node._cssState){
var _4fc=_4ea.getEnclosingWidget(node);
if(_4fc){
if(node==_4fc.domNode){
_4fc._cssMouseEvent(evt);
}else{
_4fc._subnodeCssMouseEvent(node,node._cssState,evt);
}
}
}
}
}
};
function _4fd(evt){
evt.target=evt.srcElement;
_4fb(evt);
};
var body=win.body();
_4e6.forEach(["mouseover","mouseout","mousedown","touchstart","mouseup","touchend"],function(type){
if(body.addEventListener){
body.addEventListener(type,_4fb,true);
}else{
body.attachEvent("on"+type,_4fd);
}
});
on(body,"focusin, focusout",function(evt){
var node=evt.target;
if(node._cssState&&!node.getAttribute("widgetId")){
var _4fe=_4ea.getEnclosingWidget(node);
_4fe._subnodeCssMouseEvent(node,node._cssState,evt);
}
});
});
return _4eb;
});
},"url:dojox/grid/resources/_Grid.html":"<div hidefocus=\"hidefocus\" role=\"grid\" dojoAttachEvent=\"onmouseout:_mouseOut\">\n\t<div class=\"dojoxGridMasterHeader\" dojoAttachPoint=\"viewsHeaderNode\" role=\"presentation\"></div>\n\t<div class=\"dojoxGridMasterView\" dojoAttachPoint=\"viewsNode\" role=\"presentation\"></div>\n\t<div class=\"dojoxGridMasterMessages\" style=\"display: none;\" dojoAttachPoint=\"messagesNode\"></div>\n\t<span dojoAttachPoint=\"lastFocusNode\" tabindex=\"0\"></span>\n</div>\n","dojox/grid/_RowManager":function(){
define(["dojo/_base/declare","dojo/_base/lang","dojo/dom-class"],function(_4ff,lang,_500){
var _501=function(_502,_503){
if(_502.style.cssText==undefined){
_502.setAttribute("style",_503);
}else{
_502.style.cssText=_503;
}
};
return _4ff("dojox.grid._RowManager",null,{constructor:function(_504){
this.grid=_504;
},linesToEms:2,overRow:-2,prepareStylingRow:function(_505,_506){
return {index:_505,node:_506,odd:Boolean(_505&1),selected:!!this.grid.selection.isSelected(_505),over:this.isOver(_505),customStyles:"",customClasses:"dojoxGridRow"};
},styleRowNode:function(_507,_508){
var row=this.prepareStylingRow(_507,_508);
this.grid.onStyleRow(row);
this.applyStyles(row);
},applyStyles:function(_509){
var i=_509;
i.node.className=i.customClasses;
var h=i.node.style.height;
_501(i.node,i.customStyles+";"+(i.node._style||""));
i.node.style.height=h;
},updateStyles:function(_50a){
this.grid.updateRowStyles(_50a);
},setOverRow:function(_50b){
var last=this.overRow;
this.overRow=_50b;
if((last!=this.overRow)&&(lang.isString(last)||last>=0)){
this.updateStyles(last);
}
this.updateStyles(this.overRow);
},isOver:function(_50c){
return (this.overRow==_50c&&!_500.contains(this.grid.domNode,"dojoxGridColumnResizing"));
}});
});
},"dojo/hccss":function(){
define(["require","./_base/config","./dom-class","./dom-construct","./dom-style","./has","./ready","./_base/window"],function(_50d,_50e,_50f,_510,_511,has,_512,win){
has.add("highcontrast",function(){
var div=win.doc.createElement("div");
div.style.cssText="border: 1px solid; border-color:red green; position: absolute; height: 5px; top: -999px;"+"background-image: url("+(_50e.blankGif||_50d.toUrl("./resources/blank.gif"))+");";
win.body().appendChild(div);
var cs=_511.getComputedStyle(div),_513=cs.backgroundImage,hc=(cs.borderTopColor==cs.borderRightColor)||(_513&&(_513=="none"||_513=="url(invalid-url:)"));
_510.destroy(div);
return hc;
});
_512(90,function(){
if(has("highcontrast")){
_50f.add(win.body(),"dj_a11y");
}
});
return has;
});
},"dojo/string":function(){
define(["./_base/kernel","./_base/lang"],function(_514,lang){
var _515={};
lang.setObject("dojo.string",_515);
_515.rep=function(str,num){
if(num<=0||!str){
return "";
}
var buf=[];
for(;;){
if(num&1){
buf.push(str);
}
if(!(num>>=1)){
break;
}
str+=str;
}
return buf.join("");
};
_515.pad=function(text,size,ch,end){
if(!ch){
ch="0";
}
var out=String(text),pad=_515.rep(ch,Math.ceil((size-out.length)/ch.length));
return end?out+pad:pad+out;
};
_515.substitute=function(_516,map,_517,_518){
_518=_518||_514.global;
_517=_517?lang.hitch(_518,_517):function(v){
return v;
};
return _516.replace(/\$\{([^\s\:\}]+)(?:\:([^\s\:\}]+))?\}/g,function(_519,key,_51a){
var _51b=lang.getObject(key,false,map);
if(_51a){
_51b=lang.getObject(_51a,false,_518).call(_518,_51b,key);
}
return _517(_51b,key).toString();
});
};
_515.trim=String.prototype.trim?lang.trim:function(str){
str=str.replace(/^\s+/,"");
for(var i=str.length-1;i>=0;i--){
if(/\S/.test(str.charAt(i))){
str=str.substring(0,i+1);
break;
}
}
return str;
};
return _515;
});
},"dojo/dnd/Avatar":function(){
define(["../_base/declare","../_base/window","../dom","../dom-attr","../dom-class","../dom-construct","../hccss","../query"],function(_51c,win,dom,_51d,_51e,_51f,has,_520){
return _51c("dojo.dnd.Avatar",null,{constructor:function(_521){
this.manager=_521;
this.construct();
},construct:function(){
var a=_51f.create("table",{"class":"dojoDndAvatar",style:{position:"absolute",zIndex:"1999",margin:"0px"}}),_522=this.manager.source,node,b=_51f.create("tbody",null,a),tr=_51f.create("tr",null,b),td=_51f.create("td",null,tr),k=Math.min(5,this.manager.nodes.length),i=0;
if(has("highcontrast")){
_51f.create("span",{id:"a11yIcon",innerHTML:this.manager.copy?"+":"<"},td);
}
_51f.create("span",{innerHTML:_522.generateText?this._generateText():""},td);
_51d.set(tr,{"class":"dojoDndAvatarHeader",style:{opacity:0.9}});
for(;i<k;++i){
if(_522.creator){
node=_522._normalizedCreator(_522.getItem(this.manager.nodes[i].id).data,"avatar").node;
}else{
node=this.manager.nodes[i].cloneNode(true);
if(node.tagName.toLowerCase()=="tr"){
var _523=_51f.create("table"),_524=_51f.create("tbody",null,_523);
_524.appendChild(node);
node=_523;
}
}
node.id="";
tr=_51f.create("tr",null,b);
td=_51f.create("td",null,tr);
td.appendChild(node);
_51d.set(tr,{"class":"dojoDndAvatarItem",style:{opacity:(9-i)/10}});
}
this.node=a;
},destroy:function(){
_51f.destroy(this.node);
this.node=false;
},update:function(){
_51e.toggle(this.node,"dojoDndAvatarCanDrop",this.manager.canDropFlag);
if(has("highcontrast")){
var icon=dom.byId("a11yIcon");
var text="+";
if(this.manager.canDropFlag&&!this.manager.copy){
text="< ";
}else{
if(!this.manager.canDropFlag&&!this.manager.copy){
text="o";
}else{
if(!this.manager.canDropFlag){
text="x";
}
}
}
icon.innerHTML=text;
}
_520(("tr.dojoDndAvatarHeader td span"+(has("highcontrast")?" span":"")),this.node).forEach(function(node){
node.innerHTML=this.manager.source.generateText?this._generateText():"";
},this);
},_generateText:function(){
return this.manager.nodes.length.toString();
}});
});
},"dojox/grid/_Scroller":function(){
define("dojox/grid/_Scroller",["dijit/registry","dojo/_base/declare","dojo/_base/lang","./util","dojo/_base/html"],function(_525,_526,lang,util,html){
var _527=function(_528){
var i=0,n,p=_528.parentNode;
while((n=p.childNodes[i++])){
if(n==_528){
return i-1;
}
}
return -1;
};
var _529=function(_52a){
if(!_52a){
return;
}
dojo.forEach(_525.toArray(),function(w){
if(w.domNode&&html.isDescendant(w.domNode,_52a,true)){
w.destroy();
}
});
};
var _52b=function(_52c){
var node=html.byId(_52c);
return (node&&node.tagName?node.tagName.toLowerCase():"");
};
var _52d=function(_52e,_52f){
var _530=[];
var i=0,n;
while((n=_52e.childNodes[i])){
i++;
if(_52b(n)==_52f){
_530.push(n);
}
}
return _530;
};
var _531=function(_532){
return _52d(_532,"div");
};
return _526("dojox.grid._Scroller",null,{constructor:function(_533){
this.setContentNodes(_533);
this.pageHeights=[];
this.pageNodes=[];
this.stack=[];
},rowCount:0,defaultRowHeight:32,keepRows:100,contentNode:null,scrollboxNode:null,defaultPageHeight:0,keepPages:10,pageCount:0,windowHeight:0,firstVisibleRow:0,lastVisibleRow:0,averageRowHeight:0,page:0,pageTop:0,init:function(_534,_535,_536){
switch(arguments.length){
case 3:
this.rowsPerPage=_536;
case 2:
this.keepRows=_535;
case 1:
this.rowCount=_534;
default:
break;
}
this.defaultPageHeight=this.defaultRowHeight*this.rowsPerPage;
this.pageCount=this._getPageCount(this.rowCount,this.rowsPerPage);
this.setKeepInfo(this.keepRows);
this.invalidate();
if(this.scrollboxNode){
this.scrollboxNode.scrollTop=0;
this.scroll(0);
this.scrollboxNode.onscroll=lang.hitch(this,"onscroll");
}
},_getPageCount:function(_537,_538){
return _537?(Math.ceil(_537/_538)||1):0;
},destroy:function(){
this.invalidateNodes();
delete this.contentNodes;
delete this.contentNode;
delete this.scrollboxNode;
},setKeepInfo:function(_539){
this.keepRows=_539;
this.keepPages=!this.keepRows?this.keepPages:Math.max(Math.ceil(this.keepRows/this.rowsPerPage),2);
},setContentNodes:function(_53a){
this.contentNodes=_53a;
this.colCount=(this.contentNodes?this.contentNodes.length:0);
this.pageNodes=[];
for(var i=0;i<this.colCount;i++){
this.pageNodes[i]=[];
}
},getDefaultNodes:function(){
return this.pageNodes[0]||[];
},invalidate:function(){
this._invalidating=true;
this.invalidateNodes();
this.pageHeights=[];
this.height=(this.pageCount?(this.pageCount-1)*this.defaultPageHeight+this.calcLastPageHeight():0);
this.resize();
this._invalidating=false;
},updateRowCount:function(_53b){
this.invalidateNodes();
this.rowCount=_53b;
var _53c=this.pageCount;
if(_53c===0){
this.height=1;
}
this.pageCount=this._getPageCount(this.rowCount,this.rowsPerPage);
if(this.pageCount<_53c){
for(var i=_53c-1;i>=this.pageCount;i--){
this.height-=this.getPageHeight(i);
delete this.pageHeights[i];
}
}else{
if(this.pageCount>_53c){
this.height+=this.defaultPageHeight*(this.pageCount-_53c-1)+this.calcLastPageHeight();
}
}
this.resize();
},pageExists:function(_53d){
return Boolean(this.getDefaultPageNode(_53d));
},measurePage:function(_53e){
if(this.grid.rowHeight){
var _53f=this.grid.rowHeight+1;
return ((_53e+1)*this.rowsPerPage>this.rowCount?this.rowCount-_53e*this.rowsPerPage:this.rowsPerPage)*_53f;
}
var n=this.getDefaultPageNode(_53e);
return (n&&n.innerHTML)?n.offsetHeight:undefined;
},positionPage:function(_540,_541){
for(var i=0;i<this.colCount;i++){
this.pageNodes[i][_540].style.top=_541+"px";
}
},repositionPages:function(_542){
var _543=this.getDefaultNodes();
var last=0;
for(var i=0;i<this.stack.length;i++){
last=Math.max(this.stack[i],last);
}
var n=_543[_542];
var y=(n?this.getPageNodePosition(n)+this.getPageHeight(_542):0);
for(var p=_542+1;p<=last;p++){
n=_543[p];
if(n){
if(this.getPageNodePosition(n)==y){
return;
}
this.positionPage(p,y);
}
y+=this.getPageHeight(p);
}
},installPage:function(_544){
for(var i=0;i<this.colCount;i++){
this.contentNodes[i].appendChild(this.pageNodes[i][_544]);
}
},preparePage:function(_545,_546){
var p=(_546?this.popPage():null);
for(var i=0;i<this.colCount;i++){
var _547=this.pageNodes[i];
var _548=(p===null?this.createPageNode():this.invalidatePageNode(p,_547));
_548.pageIndex=_545;
_547[_545]=_548;
}
},renderPage:function(_549){
var _54a=[];
var i,j;
for(i=0;i<this.colCount;i++){
_54a[i]=this.pageNodes[i][_549];
}
for(i=0,j=_549*this.rowsPerPage;(i<this.rowsPerPage)&&(j<this.rowCount);i++,j++){
this.renderRow(j,_54a);
}
},removePage:function(_54b){
for(var i=0,j=_54b*this.rowsPerPage;i<this.rowsPerPage;i++,j++){
this.removeRow(j);
}
},destroyPage:function(_54c){
for(var i=0;i<this.colCount;i++){
var n=this.invalidatePageNode(_54c,this.pageNodes[i]);
if(n){
html.destroy(n);
}
}
},pacify:function(_54d){
},pacifying:false,pacifyTicks:200,setPacifying:function(_54e){
if(this.pacifying!=_54e){
this.pacifying=_54e;
this.pacify(this.pacifying);
}
},startPacify:function(){
this.startPacifyTicks=new Date().getTime();
},doPacify:function(){
var _54f=(new Date().getTime()-this.startPacifyTicks)>this.pacifyTicks;
this.setPacifying(true);
this.startPacify();
return _54f;
},endPacify:function(){
this.setPacifying(false);
},resize:function(){
if(this.scrollboxNode){
this.windowHeight=this.scrollboxNode.clientHeight;
}
for(var i=0;i<this.colCount;i++){
util.setStyleHeightPx(this.contentNodes[i],Math.max(1,this.height));
}
var _550=(!this._invalidating);
if(!_550){
var ah=this.grid.get("autoHeight");
if(typeof ah=="number"&&ah<=Math.min(this.rowsPerPage,this.rowCount)){
_550=true;
}
}
if(_550){
this.needPage(this.page,this.pageTop);
}
var _551=(this.page<this.pageCount-1)?this.rowsPerPage:((this.rowCount%this.rowsPerPage)||this.rowsPerPage);
var _552=this.getPageHeight(this.page);
this.averageRowHeight=(_552>0&&_551>0)?(_552/_551):0;
},calcLastPageHeight:function(){
if(!this.pageCount){
return 0;
}
var _553=this.pageCount-1;
var _554=((this.rowCount%this.rowsPerPage)||(this.rowsPerPage))*this.defaultRowHeight;
this.pageHeights[_553]=_554;
return _554;
},updateContentHeight:function(inDh){
this.height+=inDh;
this.resize();
},updatePageHeight:function(_555,_556,_557){
if(this.pageExists(_555)){
var oh=this.getPageHeight(_555);
var h=(this.measurePage(_555));
if(h===undefined){
h=oh;
}
this.pageHeights[_555]=h;
if(oh!=h){
this.updateContentHeight(h-oh);
var ah=this.grid.get("autoHeight");
if((typeof ah=="number"&&ah>this.rowCount)||(ah===true&&!_556)){
if(!_557){
this.grid.sizeChange();
}else{
var ns=this.grid.viewsNode.style;
ns.height=parseInt(ns.height)+h-oh+"px";
this.repositionPages(_555);
}
}else{
this.repositionPages(_555);
}
}
return h;
}
return 0;
},rowHeightChanged:function(_558,_559){
this.updatePageHeight(Math.floor(_558/this.rowsPerPage),false,_559);
},invalidateNodes:function(){
while(this.stack.length){
this.destroyPage(this.popPage());
}
},createPageNode:function(){
var p=document.createElement("div");
html.attr(p,"role","presentation");
p.style.position="absolute";
p.style[this.grid.isLeftToRight()?"left":"right"]="0";
return p;
},getPageHeight:function(_55a){
var ph=this.pageHeights[_55a];
return (ph!==undefined?ph:this.defaultPageHeight);
},pushPage:function(_55b){
return this.stack.push(_55b);
},popPage:function(){
return this.stack.shift();
},findPage:function(_55c){
var i=0,h=0;
for(var ph=0;i<this.pageCount;i++,h+=ph){
ph=this.getPageHeight(i);
if(h+ph>=_55c){
break;
}
}
this.page=i;
this.pageTop=h;
},buildPage:function(_55d,_55e,_55f){
this.preparePage(_55d,_55e);
this.positionPage(_55d,_55f);
this.installPage(_55d);
this.renderPage(_55d);
this.pushPage(_55d);
},needPage:function(_560,_561){
var h=this.getPageHeight(_560),oh=h;
if(!this.pageExists(_560)){
this.buildPage(_560,(!this.grid._autoHeight&&this.keepPages&&(this.stack.length>=this.keepPages)),_561);
h=this.updatePageHeight(_560,true);
}else{
this.positionPage(_560,_561);
}
return h;
},onscroll:function(){
this.scroll(this.scrollboxNode.scrollTop);
},scroll:function(_562){
this.grid.scrollTop=_562;
if(this.colCount){
this.startPacify();
this.findPage(_562);
var h=this.height;
var b=this.getScrollBottom(_562);
for(var p=this.page,y=this.pageTop;(p<this.pageCount)&&((b<0)||(y<b));p++){
y+=this.needPage(p,y);
}
this.firstVisibleRow=this.getFirstVisibleRow(this.page,this.pageTop,_562);
this.lastVisibleRow=this.getLastVisibleRow(p-1,y,b);
if(h!=this.height){
this.repositionPages(p-1);
}
this.endPacify();
}
},getScrollBottom:function(_563){
return (this.windowHeight>=0?_563+this.windowHeight:-1);
},processNodeEvent:function(e,_564){
var t=e.target;
while(t&&(t!=_564)&&t.parentNode&&(t.parentNode.parentNode!=_564)){
t=t.parentNode;
}
if(!t||!t.parentNode||(t.parentNode.parentNode!=_564)){
return false;
}
var page=t.parentNode;
e.topRowIndex=page.pageIndex*this.rowsPerPage;
e.rowIndex=e.topRowIndex+_527(t);
e.rowTarget=t;
return true;
},processEvent:function(e){
return this.processNodeEvent(e,this.contentNode);
},renderRow:function(_565,_566){
},removeRow:function(_567){
},getDefaultPageNode:function(_568){
return this.getDefaultNodes()[_568];
},positionPageNode:function(_569,_56a){
},getPageNodePosition:function(_56b){
return _56b.offsetTop;
},invalidatePageNode:function(_56c,_56d){
var p=_56d[_56c];
if(p){
delete _56d[_56c];
this.removePage(_56c,p);
_529(p);
p.innerHTML="";
}
return p;
},getPageRow:function(_56e){
return _56e*this.rowsPerPage;
},getLastPageRow:function(_56f){
return Math.min(this.rowCount,this.getPageRow(_56f+1))-1;
},getFirstVisibleRow:function(_570,_571,_572){
if(!this.pageExists(_570)){
return 0;
}
var row=this.getPageRow(_570);
var _573=this.getDefaultNodes();
var rows=_531(_573[_570]);
for(var i=0,l=rows.length;i<l&&_571<_572;i++,row++){
_571+=rows[i].offsetHeight;
}
return (row?row-1:row);
},getLastVisibleRow:function(_574,_575,_576){
if(!this.pageExists(_574)){
return 0;
}
var _577=this.getDefaultNodes();
var row=this.getLastPageRow(_574);
var rows=_531(_577[_574]);
for(var i=rows.length-1;i>=0&&_575>_576;i--,row--){
_575-=rows[i].offsetHeight;
}
return row+1;
},findTopRow:function(_578){
var _579=this.getDefaultNodes();
var rows=_531(_579[this.page]);
for(var i=0,l=rows.length,t=this.pageTop,h;i<l;i++){
h=rows[i].offsetHeight;
t+=h;
if(t>=_578){
this.offset=h-(t-_578);
return i+this.page*this.rowsPerPage;
}
}
return -1;
},findScrollTop:function(_57a){
var _57b=Math.floor(_57a/this.rowsPerPage);
var t=0;
var i,l;
for(i=0;i<_57b;i++){
t+=this.getPageHeight(i);
}
this.pageTop=t;
this.page=_57b;
this.needPage(_57b,this.pageTop);
var _57c=this.getDefaultNodes();
var rows=_531(_57c[_57b]);
var r=_57a-this.rowsPerPage*_57b;
for(i=0,l=rows.length;i<l&&i<r;i++){
t+=rows[i].offsetHeight;
}
return t;
},dummy:0});
});
},"dojox/grid/_Events":function(){
define("dojox/grid/_Events",["dojo/keys","dojo/dom-class","dojo/_base/declare","dojo/_base/event","dojo/_base/sniff"],function(keys,_57d,_57e,_57f,has){
return _57e("dojox.grid._Events",null,{cellOverClass:"dojoxGridCellOver",onKeyEvent:function(e){
this.dispatchKeyEvent(e);
},onContentEvent:function(e){
this.dispatchContentEvent(e);
},onHeaderEvent:function(e){
this.dispatchHeaderEvent(e);
},onStyleRow:function(_580){
var i=_580;
i.customClasses+=(i.odd?" dojoxGridRowOdd":"")+(i.selected?" dojoxGridRowSelected":"")+(i.over?" dojoxGridRowOver":"");
this.focus.styleRow(_580);
this.edit.styleRow(_580);
},onKeyDown:function(e){
if(e.altKey||e.metaKey){
return;
}
var _581;
switch(e.keyCode){
case keys.ESCAPE:
this.edit.cancel();
break;
case keys.ENTER:
if(!this.edit.isEditing()){
_581=this.focus.getHeaderIndex();
if(_581>=0){
this.setSortIndex(_581);
break;
}else{
this.selection.clickSelect(this.focus.rowIndex,dojo.isCopyKey(e),e.shiftKey);
}
_57f.stop(e);
}
if(!e.shiftKey){
var _582=this.edit.isEditing();
this.edit.apply();
if(!_582){
this.edit.setEditCell(this.focus.cell,this.focus.rowIndex);
}
}
if(!this.edit.isEditing()){
var _583=this.focus.focusView||this.views.views[0];
_583.content.decorateEvent(e);
this.onRowClick(e);
_57f.stop(e);
}
break;
case keys.SPACE:
if(!this.edit.isEditing()){
_581=this.focus.getHeaderIndex();
if(_581>=0){
this.setSortIndex(_581);
break;
}else{
this.selection.clickSelect(this.focus.rowIndex,dojo.isCopyKey(e),e.shiftKey);
}
_57f.stop(e);
}
break;
case keys.TAB:
this.focus[e.shiftKey?"previousKey":"nextKey"](e);
break;
case keys.LEFT_ARROW:
case keys.RIGHT_ARROW:
if(!this.edit.isEditing()){
var _584=e.keyCode;
_57f.stop(e);
_581=this.focus.getHeaderIndex();
if(_581>=0&&(e.shiftKey&&e.ctrlKey)){
this.focus.colSizeAdjust(e,_581,(_584==keys.LEFT_ARROW?-1:1)*5);
}else{
var _585=(_584==keys.LEFT_ARROW)?1:-1;
if(this.isLeftToRight()){
_585*=-1;
}
this.focus.move(0,_585);
}
}
break;
case keys.UP_ARROW:
if(!this.edit.isEditing()&&this.focus.rowIndex!==0){
_57f.stop(e);
this.focus.move(-1,0);
}
break;
case keys.DOWN_ARROW:
if(!this.edit.isEditing()&&this.focus.rowIndex+1!=this.rowCount){
_57f.stop(e);
this.focus.move(1,0);
}
break;
case keys.PAGE_UP:
if(!this.edit.isEditing()&&this.focus.rowIndex!==0){
_57f.stop(e);
if(this.focus.rowIndex!=this.scroller.firstVisibleRow+1){
this.focus.move(this.scroller.firstVisibleRow-this.focus.rowIndex,0);
}else{
this.setScrollTop(this.scroller.findScrollTop(this.focus.rowIndex-1));
this.focus.move(this.scroller.firstVisibleRow-this.scroller.lastVisibleRow+1,0);
}
}
break;
case keys.PAGE_DOWN:
if(!this.edit.isEditing()&&this.focus.rowIndex+1!=this.rowCount){
_57f.stop(e);
if(this.focus.rowIndex!=this.scroller.lastVisibleRow-1){
this.focus.move(this.scroller.lastVisibleRow-this.focus.rowIndex-1,0);
}else{
this.setScrollTop(this.scroller.findScrollTop(this.focus.rowIndex+1));
this.focus.move(this.scroller.lastVisibleRow-this.scroller.firstVisibleRow-1,0);
}
}
break;
default:
break;
}
},onMouseOver:function(e){
e.rowIndex==-1?this.onHeaderCellMouseOver(e):this.onCellMouseOver(e);
},onMouseOut:function(e){
e.rowIndex==-1?this.onHeaderCellMouseOut(e):this.onCellMouseOut(e);
},onMouseDown:function(e){
e.rowIndex==-1?this.onHeaderCellMouseDown(e):this.onCellMouseDown(e);
},onMouseOverRow:function(e){
if(!this.rows.isOver(e.rowIndex)){
this.rows.setOverRow(e.rowIndex);
e.rowIndex==-1?this.onHeaderMouseOver(e):this.onRowMouseOver(e);
}
},onMouseOutRow:function(e){
if(this.rows.isOver(-1)){
this.onHeaderMouseOut(e);
}else{
if(!this.rows.isOver(-2)){
this.rows.setOverRow(-2);
this.onRowMouseOut(e);
}
}
},onMouseDownRow:function(e){
if(e.rowIndex!=-1){
this.onRowMouseDown(e);
}
},onCellMouseOver:function(e){
if(e.cellNode){
_57d.add(e.cellNode,this.cellOverClass);
}
},onCellMouseOut:function(e){
if(e.cellNode){
_57d.remove(e.cellNode,this.cellOverClass);
}
},onCellMouseDown:function(e){
},onCellClick:function(e){
this._click[0]=this._click[1];
this._click[1]=e;
if(!this.edit.isEditCell(e.rowIndex,e.cellIndex)){
this.focus.setFocusCell(e.cell,e.rowIndex);
}
if(this._click.length>1&&this._click[0]==null){
this._click.shift();
}
this.onRowClick(e);
},onCellDblClick:function(e){
var _586;
if(this._click.length>1&&has("ie")){
_586=this._click[1];
}else{
if(this._click.length>1&&this._click[0].rowIndex!=this._click[1].rowIndex){
_586=this._click[0];
}else{
_586=e;
}
}
this.focus.setFocusCell(_586.cell,_586.rowIndex);
this.onRowClick(_586);
this.edit.setEditCell(_586.cell,_586.rowIndex);
this.onRowDblClick(e);
},onCellContextMenu:function(e){
this.onRowContextMenu(e);
},onCellFocus:function(_587,_588){
this.edit.cellFocus(_587,_588);
},onRowClick:function(e){
this.edit.rowClick(e);
this.selection.clickSelectEvent(e);
},onRowDblClick:function(e){
},onRowMouseOver:function(e){
},onRowMouseOut:function(e){
},onRowMouseDown:function(e){
},onRowContextMenu:function(e){
_57f.stop(e);
},onHeaderMouseOver:function(e){
},onHeaderMouseOut:function(e){
},onHeaderCellMouseOver:function(e){
if(e.cellNode){
_57d.add(e.cellNode,this.cellOverClass);
}
},onHeaderCellMouseOut:function(e){
if(e.cellNode){
_57d.remove(e.cellNode,this.cellOverClass);
}
},onHeaderCellMouseDown:function(e){
},onHeaderClick:function(e){
},onHeaderCellClick:function(e){
this.setSortIndex(e.cell.index);
this.onHeaderClick(e);
},onHeaderDblClick:function(e){
},onHeaderCellDblClick:function(e){
this.onHeaderDblClick(e);
},onHeaderCellContextMenu:function(e){
this.onHeaderContextMenu(e);
},onHeaderContextMenu:function(e){
if(!this.headerMenu){
_57f.stop(e);
}
},onStartEdit:function(_589,_58a){
},onApplyCellEdit:function(_58b,_58c,_58d){
},onCancelEdit:function(_58e){
},onApplyEdit:function(_58f){
},onCanSelect:function(_590){
return true;
},onCanDeselect:function(_591){
return true;
},onSelected:function(_592){
this.updateRowStyles(_592);
},onDeselected:function(_593){
this.updateRowStyles(_593);
},onSelectionChanged:function(){
}});
});
},"dojo/dnd/autoscroll":function(){
define(["../_base/lang","../sniff","../_base/window","../dom-geometry","../dom-style","../window"],function(lang,has,win,_594,_595,_596){
var _597={};
lang.setObject("dojo.dnd.autoscroll",_597);
_597.getViewport=_596.getBox;
_597.V_TRIGGER_AUTOSCROLL=32;
_597.H_TRIGGER_AUTOSCROLL=32;
_597.V_AUTOSCROLL_VALUE=16;
_597.H_AUTOSCROLL_VALUE=16;
var _598,doc=win.doc,_599=Infinity,_59a=Infinity;
_597.autoScrollStart=function(d){
doc=d;
_598=_596.getBox(doc);
var html=win.body(doc).parentNode;
_599=Math.max(html.scrollHeight-_598.h,0);
_59a=Math.max(html.scrollWidth-_598.w,0);
};
_597.autoScroll=function(e){
var v=_598||_596.getBox(doc),html=win.body(doc).parentNode,dx=0,dy=0;
if(e.clientX<_597.H_TRIGGER_AUTOSCROLL){
dx=-_597.H_AUTOSCROLL_VALUE;
}else{
if(e.clientX>v.w-_597.H_TRIGGER_AUTOSCROLL){
dx=Math.min(_597.H_AUTOSCROLL_VALUE,_59a-html.scrollLeft);
}
}
if(e.clientY<_597.V_TRIGGER_AUTOSCROLL){
dy=-_597.V_AUTOSCROLL_VALUE;
}else{
if(e.clientY>v.h-_597.V_TRIGGER_AUTOSCROLL){
dy=Math.min(_597.V_AUTOSCROLL_VALUE,_599-html.scrollTop);
}
}
window.scrollBy(dx,dy);
};
_597._validNodes={"div":1,"p":1,"td":1};
_597._validOverflow={"auto":1,"scroll":1};
_597.autoScrollNodes=function(e){
var b,t,w,h,rx,ry,dx=0,dy=0,_59b,_59c;
for(var n=e.target;n;){
if(n.nodeType==1&&(n.tagName.toLowerCase() in _597._validNodes)){
var s=_595.getComputedStyle(n),_59d=(s.overflow.toLowerCase() in _597._validOverflow),_59e=(s.overflowX.toLowerCase() in _597._validOverflow),_59f=(s.overflowY.toLowerCase() in _597._validOverflow);
if(_59d||_59e||_59f){
b=_594.getContentBox(n,s);
t=_594.position(n,true);
}
if(_59d||_59e){
w=Math.min(_597.H_TRIGGER_AUTOSCROLL,b.w/2);
rx=e.pageX-t.x;
if(has("webkit")||has("opera")){
rx+=win.body().scrollLeft;
}
dx=0;
if(rx>0&&rx<b.w){
if(rx<w){
dx=-w;
}else{
if(rx>b.w-w){
dx=w;
}
}
_59b=n.scrollLeft;
n.scrollLeft=n.scrollLeft+dx;
}
}
if(_59d||_59f){
h=Math.min(_597.V_TRIGGER_AUTOSCROLL,b.h/2);
ry=e.pageY-t.y;
if(has("webkit")||has("opera")){
ry+=win.body().scrollTop;
}
dy=0;
if(ry>0&&ry<b.h){
if(ry<h){
dy=-h;
}else{
if(ry>b.h-h){
dy=h;
}
}
_59c=n.scrollTop;
n.scrollTop=n.scrollTop+dy;
}
}
if(dx||dy){
return;
}
}
try{
n=n.parentNode;
}
catch(x){
n=null;
}
}
_597.autoScroll(e);
};
return _597;
});
},"dijit/registry":function(){
define(["dojo/_base/array","dojo/sniff","dojo/_base/unload","dojo/_base/window","./main"],function(_5a0,has,_5a1,win,_5a2){
var _5a3={},hash={};
var _5a4={length:0,add:function(_5a5){
if(hash[_5a5.id]){
throw new Error("Tried to register widget with id=="+_5a5.id+" but that id is already registered");
}
hash[_5a5.id]=_5a5;
this.length++;
},remove:function(id){
if(hash[id]){
delete hash[id];
this.length--;
}
},byId:function(id){
return typeof id=="string"?hash[id]:id;
},byNode:function(node){
return hash[node.getAttribute("widgetId")];
},toArray:function(){
var ar=[];
for(var id in hash){
ar.push(hash[id]);
}
return ar;
},getUniqueId:function(_5a6){
var id;
do{
id=_5a6+"_"+(_5a6 in _5a3?++_5a3[_5a6]:_5a3[_5a6]=0);
}while(hash[id]);
return _5a2._scopeName=="dijit"?id:_5a2._scopeName+"_"+id;
},findWidgets:function(root,_5a7){
var _5a8=[];
function _5a9(root){
for(var node=root.firstChild;node;node=node.nextSibling){
if(node.nodeType==1){
var _5aa=node.getAttribute("widgetId");
if(_5aa){
var _5ab=hash[_5aa];
if(_5ab){
_5a8.push(_5ab);
}
}else{
if(node!==_5a7){
_5a9(node);
}
}
}
}
};
_5a9(root);
return _5a8;
},_destroyAll:function(){
_5a2._curFocus=null;
_5a2._prevFocus=null;
_5a2._activeStack=[];
_5a0.forEach(_5a4.findWidgets(win.body()),function(_5ac){
if(!_5ac._destroyed){
if(_5ac.destroyRecursive){
_5ac.destroyRecursive();
}else{
if(_5ac.destroy){
_5ac.destroy();
}
}
}
});
},getEnclosingWidget:function(node){
while(node){
var id=node.getAttribute&&node.getAttribute("widgetId");
if(id){
return hash[id];
}
node=node.parentNode;
}
return null;
},_hash:hash};
_5a2.registry=_5a4;
return _5a4;
});
},"dijit/Destroyable":function(){
define(["dojo/_base/array","dojo/aspect","dojo/_base/declare"],function(_5ad,_5ae,_5af){
return _5af("dijit.Destroyable",null,{destroy:function(_5b0){
this._destroyed=true;
},own:function(){
_5ad.forEach(arguments,function(_5b1){
var _5b2="destroyRecursive" in _5b1?"destroyRecursive":"destroy" in _5b1?"destroy":"remove";
_5b1._odh=_5ae.before(this,"destroy",function(_5b3){
_5b1._odh.remove();
_5b1[_5b2](_5b3);
});
_5ae.after(_5b1,_5b2,function(){
_5b1._odh.remove();
});
},this);
return arguments;
}});
});
},"dojox/html/metrics":function(){
define("dojox/html/metrics",["dojo/_base/kernel","dojo/_base/lang","dojo/_base/sniff","dojo/ready","dojo/_base/unload","dojo/_base/window","dojo/dom-geometry"],function(_5b4,lang,has,_5b5,_5b6,_5b7,_5b8){
var dhm=lang.getObject("dojox.html.metrics",true);
var _5b9=lang.getObject("dojox");
dhm.getFontMeasurements=function(){
var _5ba={"1em":0,"1ex":0,"100%":0,"12pt":0,"16px":0,"xx-small":0,"x-small":0,"small":0,"medium":0,"large":0,"x-large":0,"xx-large":0};
if(has("ie")){
_5b7.doc.documentElement.style.fontSize="100%";
}
var div=_5b7.doc.createElement("div");
var ds=div.style;
ds.position="absolute";
ds.left="-100px";
ds.top="0";
ds.width="30px";
ds.height="1000em";
ds.borderWidth="0";
ds.margin="0";
ds.padding="0";
ds.outline="0";
ds.lineHeight="1";
ds.overflow="hidden";
_5b7.body().appendChild(div);
for(var p in _5ba){
ds.fontSize=p;
_5ba[p]=Math.round(div.offsetHeight*12/16)*16/12/1000;
}
_5b7.body().removeChild(div);
div=null;
return _5ba;
};
var _5bb=null;
dhm.getCachedFontMeasurements=function(_5bc){
if(_5bc||!_5bb){
_5bb=dhm.getFontMeasurements();
}
return _5bb;
};
var _5bd=null,_5be={};
dhm.getTextBox=function(text,_5bf,_5c0){
var m,s;
if(!_5bd){
m=_5bd=_5b7.doc.createElement("div");
var c=_5b7.doc.createElement("div");
c.appendChild(m);
s=c.style;
s.overflow="scroll";
s.position="absolute";
s.left="0px";
s.top="-10000px";
s.width="1px";
s.height="1px";
s.visibility="hidden";
s.borderWidth="0";
s.margin="0";
s.padding="0";
s.outline="0";
_5b7.body().appendChild(c);
}else{
m=_5bd;
}
m.className="";
s=m.style;
s.borderWidth="0";
s.margin="0";
s.padding="0";
s.outline="0";
if(arguments.length>1&&_5bf){
for(var i in _5bf){
if(i in _5be){
continue;
}
s[i]=_5bf[i];
}
}
if(arguments.length>2&&_5c0){
m.className=_5c0;
}
m.innerHTML=text;
var box=_5b8.position(m);
box.w=m.parentNode.scrollWidth;
return box;
};
var _5c1={w:16,h:16};
dhm.getScrollbar=function(){
return {w:_5c1.w,h:_5c1.h};
};
dhm._fontResizeNode=null;
dhm.initOnFontResize=function(_5c2){
var f=dhm._fontResizeNode=_5b7.doc.createElement("iframe");
var fs=f.style;
fs.position="absolute";
fs.width="5em";
fs.height="10em";
fs.top="-10000px";
fs.display="none";
if(has("ie")){
f.onreadystatechange=function(){
if(f.contentWindow.document.readyState=="complete"){
f.onresize=f.contentWindow.parent[_5b9._scopeName].html.metrics._fontresize;
}
};
}else{
f.onload=function(){
f.contentWindow.onresize=f.contentWindow.parent[_5b9._scopeName].html.metrics._fontresize;
};
}
f.setAttribute("src","javascript:'<html><head><script>if(\"loadFirebugConsole\" in window){window.loadFirebugConsole();}</script></head><body></body></html>'");
_5b7.body().appendChild(f);
dhm.initOnFontResize=function(){
};
};
dhm.onFontResize=function(){
};
dhm._fontresize=function(){
dhm.onFontResize();
};
_5b6.addOnUnload(function(){
var f=dhm._fontResizeNode;
if(f){
if(has("ie")&&f.onresize){
f.onresize=null;
}else{
if(f.contentWindow&&f.contentWindow.onresize){
f.contentWindow.onresize=null;
}
}
dhm._fontResizeNode=null;
}
});
_5b5(function(){
try{
var n=_5b7.doc.createElement("div");
n.style.cssText="top:0;left:0;width:100px;height:100px;overflow:scroll;position:absolute;visibility:hidden;";
_5b7.body().appendChild(n);
_5c1.w=n.offsetWidth-n.clientWidth;
_5c1.h=n.offsetHeight-n.clientHeight;
_5b7.body().removeChild(n);
delete n;
}
catch(e){
}
if("fontSizeWatch" in _5b4.config&&!!_5b4.config.fontSizeWatch){
dhm.initOnFontResize();
}
});
return dhm;
});
},"dojox/grid/_EditManager":function(){
define(["dojo/_base/lang","dojo/_base/array","dojo/_base/declare","dojo/_base/connect","dojo/_base/sniff","./util"],function(lang,_5c3,_5c4,_5c5,has,util){
return _5c4("dojox.grid._EditManager",null,{constructor:function(_5c6){
this.grid=_5c6;
if(has("ie")){
this.connections=[_5c5.connect(document.body,"onfocus",lang.hitch(this,"_boomerangFocus"))];
}else{
this.connections=[_5c5.connect(this.grid,"onBlur",this,"apply")];
}
},info:{},destroy:function(){
_5c3.forEach(this.connections,_5c5.disconnect);
},cellFocus:function(_5c7,_5c8){
if(this.grid.singleClickEdit||this.isEditRow(_5c8)){
this.setEditCell(_5c7,_5c8);
}else{
this.apply();
}
if(this.isEditing()||(_5c7&&_5c7.editable&&_5c7.alwaysEditing)){
this._focusEditor(_5c7,_5c8);
}
},rowClick:function(e){
if(this.isEditing()&&!this.isEditRow(e.rowIndex)){
this.apply();
}
},styleRow:function(_5c9){
if(_5c9.index==this.info.rowIndex){
_5c9.customClasses+=" dojoxGridRowEditing";
}
},dispatchEvent:function(e){
var c=e.cell,ed=(c&&c["editable"])?c:0;
return ed&&ed.dispatchEvent(e.dispatch,e);
},isEditing:function(){
return this.info.rowIndex!==undefined;
},isEditCell:function(_5ca,_5cb){
return (this.info.rowIndex===_5ca)&&(this.info.cell.index==_5cb);
},isEditRow:function(_5cc){
return this.info.rowIndex===_5cc;
},setEditCell:function(_5cd,_5ce){
if(!this.isEditCell(_5ce,_5cd.index)&&this.grid.canEdit&&this.grid.canEdit(_5cd,_5ce)){
this.start(_5cd,_5ce,this.isEditRow(_5ce)||_5cd.editable);
}
},_focusEditor:function(_5cf,_5d0){
util.fire(_5cf,"focus",[_5d0]);
},focusEditor:function(){
if(this.isEditing()){
this._focusEditor(this.info.cell,this.info.rowIndex);
}
},_boomerangWindow:500,_shouldCatchBoomerang:function(){
return this._catchBoomerang>new Date().getTime();
},_boomerangFocus:function(){
if(this._shouldCatchBoomerang()){
this.grid.focus.focusGrid();
this.focusEditor();
this._catchBoomerang=0;
}
},_doCatchBoomerang:function(){
if(has("ie")){
this._catchBoomerang=new Date().getTime()+this._boomerangWindow;
}
},start:function(_5d1,_5d2,_5d3){
if(!this._isValidInput()){
return;
}
this.grid.beginUpdate();
this.editorApply();
if(this.isEditing()&&!this.isEditRow(_5d2)){
this.applyRowEdit();
this.grid.updateRow(_5d2);
}
if(_5d3){
this.info={cell:_5d1,rowIndex:_5d2};
this.grid.doStartEdit(_5d1,_5d2);
this.grid.updateRow(_5d2);
}else{
this.info={};
}
this.grid.endUpdate();
this.grid.focus.focusGrid();
this._focusEditor(_5d1,_5d2);
this._doCatchBoomerang();
},_editorDo:function(_5d4){
var c=this.info.cell;
if(c&&c.editable){
c[_5d4](this.info.rowIndex);
}
},editorApply:function(){
this._editorDo("apply");
},editorCancel:function(){
this._editorDo("cancel");
},applyCellEdit:function(_5d5,_5d6,_5d7){
if(this.grid.canEdit(_5d6,_5d7)){
this.grid.doApplyCellEdit(_5d5,_5d7,_5d6.field);
}
},applyRowEdit:function(){
this.grid.doApplyEdit(this.info.rowIndex,this.info.cell.field);
},apply:function(){
if(this.isEditing()&&this._isValidInput()){
this.grid.beginUpdate();
this.editorApply();
this.applyRowEdit();
this.info={};
this.grid.endUpdate();
this.grid.focus.focusGrid();
this._doCatchBoomerang();
}
},cancel:function(){
if(this.isEditing()){
this.grid.beginUpdate();
this.editorCancel();
this.info={};
this.grid.endUpdate();
this.grid.focus.focusGrid();
this._doCatchBoomerang();
}
},save:function(_5d8,_5d9){
var c=this.info.cell;
if(this.isEditRow(_5d8)&&(!_5d9||c.view==_5d9)&&c.editable){
c.save(c,this.info.rowIndex);
}
},restore:function(_5da,_5db){
var c=this.info.cell;
if(this.isEditRow(_5db)&&c.view==_5da&&c.editable){
c.restore(this.info.rowIndex);
}
},_isValidInput:function(){
var w=(this.info.cell||{}).widget;
if(!w||!w.isValid){
return true;
}
w.focused=true;
return w.isValid(true);
}});
});
},"dijit/a11y":function(){
define(["dojo/_base/array","dojo/_base/config","dojo/_base/declare","dojo/dom","dojo/dom-attr","dojo/dom-style","dojo/sniff","./main"],function(_5dc,_5dd,_5de,dom,_5df,_5e0,has,_5e1){
var _5e2=(_5e1._isElementShown=function(elem){
var s=_5e0.get(elem);
return (s.visibility!="hidden")&&(s.visibility!="collapsed")&&(s.display!="none")&&(_5df.get(elem,"type")!="hidden");
});
_5e1.hasDefaultTabStop=function(elem){
switch(elem.nodeName.toLowerCase()){
case "a":
return _5df.has(elem,"href");
case "area":
case "button":
case "input":
case "object":
case "select":
case "textarea":
return true;
case "iframe":
var body;
try{
var _5e3=elem.contentDocument;
if("designMode" in _5e3&&_5e3.designMode=="on"){
return true;
}
body=_5e3.body;
}
catch(e1){
try{
body=elem.contentWindow.document.body;
}
catch(e2){
return false;
}
}
return body&&(body.contentEditable=="true"||(body.firstChild&&body.firstChild.contentEditable=="true"));
default:
return elem.contentEditable=="true";
}
};
var _5e4=(_5e1.isTabNavigable=function(elem){
if(_5df.get(elem,"disabled")){
return false;
}else{
if(_5df.has(elem,"tabIndex")){
return _5df.get(elem,"tabIndex")>=0;
}else{
return _5e1.hasDefaultTabStop(elem);
}
}
});
_5e1._getTabNavigable=function(root){
var _5e5,last,_5e6,_5e7,_5e8,_5e9,_5ea={};
function _5eb(node){
return node&&node.tagName.toLowerCase()=="input"&&node.type&&node.type.toLowerCase()=="radio"&&node.name&&node.name.toLowerCase();
};
var _5ec=function(_5ed){
for(var _5ee=_5ed.firstChild;_5ee;_5ee=_5ee.nextSibling){
if(_5ee.nodeType!=1||(has("ie")&&_5ee.scopeName!=="HTML")||!_5e2(_5ee)){
continue;
}
if(_5e4(_5ee)){
var _5ef=+_5df.get(_5ee,"tabIndex");
if(!_5df.has(_5ee,"tabIndex")||_5ef==0){
if(!_5e5){
_5e5=_5ee;
}
last=_5ee;
}else{
if(_5ef>0){
if(!_5e6||_5ef<_5e7){
_5e7=_5ef;
_5e6=_5ee;
}
if(!_5e8||_5ef>=_5e9){
_5e9=_5ef;
_5e8=_5ee;
}
}
}
var rn=_5eb(_5ee);
if(_5df.get(_5ee,"checked")&&rn){
_5ea[rn]=_5ee;
}
}
if(_5ee.nodeName.toUpperCase()!="SELECT"){
_5ec(_5ee);
}
}
};
if(_5e2(root)){
_5ec(root);
}
function rs(node){
return _5ea[_5eb(node)]||node;
};
return {first:rs(_5e5),last:rs(last),lowest:rs(_5e6),highest:rs(_5e8)};
};
_5e1.getFirstInTabbingOrder=function(root,doc){
var _5f0=_5e1._getTabNavigable(dom.byId(root,doc));
return _5f0.lowest?_5f0.lowest:_5f0.first;
};
_5e1.getLastInTabbingOrder=function(root,doc){
var _5f1=_5e1._getTabNavigable(dom.byId(root,doc));
return _5f1.last?_5f1.last:_5f1.highest;
};
return {hasDefaultTabStop:_5e1.hasDefaultTabStop,isTabNavigable:_5e1.isTabNavigable,_getTabNavigable:_5e1._getTabNavigable,getFirstInTabbingOrder:_5e1.getFirstInTabbingOrder,getLastInTabbingOrder:_5e1.getLastInTabbingOrder};
});
},"dijit/CheckedMenuItem":function(){
define(["dojo/_base/declare","dojo/dom-class","./MenuItem","dojo/text!./templates/CheckedMenuItem.html","./hccss"],function(_5f2,_5f3,_5f4,_5f5){
return _5f2("dijit.CheckedMenuItem",_5f4,{templateString:_5f5,checked:false,_setCheckedAttr:function(_5f6){
_5f3.toggle(this.domNode,"dijitCheckedMenuItemChecked",_5f6);
this.domNode.setAttribute("aria-checked",_5f6?"true":"false");
this._set("checked",_5f6);
},iconClass:"",onChange:function(){
},_onClick:function(evt){
if(!this.disabled){
this.set("checked",!this.checked);
this.onChange(this.checked);
}
this.onClick(evt);
}});
});
},"dojo/dnd/Container":function(){
define(["../_base/array","../_base/declare","../_base/event","../_base/kernel","../_base/lang","../_base/window","../dom","../dom-class","../dom-construct","../Evented","../has","../on","../query","../ready","../touch","./common"],function(_5f7,_5f8,_5f9,_5fa,lang,win,dom,_5fb,_5fc,_5fd,has,on,_5fe,_5ff,_600,dnd){
var _601=_5f8("dojo.dnd.Container",_5fd,{skipForm:false,allowNested:false,constructor:function(node,_602){
this.node=dom.byId(node);
if(!_602){
_602={};
}
this.creator=_602.creator||null;
this.skipForm=_602.skipForm;
this.parent=_602.dropParent&&dom.byId(_602.dropParent);
this.map={};
this.current=null;
this.containerState="";
_5fb.add(this.node,"dojoDndContainer");
if(!(_602&&_602._skipStartup)){
this.startup();
}
this.events=[on(this.node,_600.over,lang.hitch(this,"onMouseOver")),on(this.node,_600.out,lang.hitch(this,"onMouseOut")),on(this.node,"dragstart",lang.hitch(this,"onSelectStart")),on(this.node,"selectstart",lang.hitch(this,"onSelectStart"))];
},creator:function(){
},getItem:function(key){
return this.map[key];
},setItem:function(key,data){
this.map[key]=data;
},delItem:function(key){
delete this.map[key];
},forInItems:function(f,o){
o=o||_5fa.global;
var m=this.map,e=dnd._empty;
for(var i in m){
if(i in e){
continue;
}
f.call(o,m[i],i,this);
}
return o;
},clearItems:function(){
this.map={};
},getAllNodes:function(){
return _5fe((this.allowNested?"":"> ")+".dojoDndItem",this.parent);
},sync:function(){
var map={};
this.getAllNodes().forEach(function(node){
if(node.id){
var item=this.getItem(node.id);
if(item){
map[node.id]=item;
return;
}
}else{
node.id=dnd.getUniqueId();
}
var type=node.getAttribute("dndType"),data=node.getAttribute("dndData");
map[node.id]={data:data||node.innerHTML,type:type?type.split(/\s*,\s*/):["text"]};
},this);
this.map=map;
return this;
},insertNodes:function(data,_603,_604){
if(!this.parent.firstChild){
_604=null;
}else{
if(_603){
if(!_604){
_604=this.parent.firstChild;
}
}else{
if(_604){
_604=_604.nextSibling;
}
}
}
var i,t;
if(_604){
for(i=0;i<data.length;++i){
t=this._normalizedCreator(data[i]);
this.setItem(t.node.id,{data:t.data,type:t.type});
_604.parentNode.insertBefore(t.node,_604);
}
}else{
for(i=0;i<data.length;++i){
t=this._normalizedCreator(data[i]);
this.setItem(t.node.id,{data:t.data,type:t.type});
this.parent.appendChild(t.node);
}
}
return this;
},destroy:function(){
_5f7.forEach(this.events,function(_605){
_605.remove();
});
this.clearItems();
this.node=this.parent=this.current=null;
},markupFactory:function(_606,node,Ctor){
_606._skipStartup=true;
return new Ctor(node,_606);
},startup:function(){
if(!this.parent){
this.parent=this.node;
if(this.parent.tagName.toLowerCase()=="table"){
var c=this.parent.getElementsByTagName("tbody");
if(c&&c.length){
this.parent=c[0];
}
}
}
this.defaultCreator=dnd._defaultCreator(this.parent);
this.sync();
},onMouseOver:function(e){
var n=e.relatedTarget;
while(n){
if(n==this.node){
break;
}
try{
n=n.parentNode;
}
catch(x){
n=null;
}
}
if(!n){
this._changeState("Container","Over");
this.onOverEvent();
}
n=this._getChildByEvent(e);
if(this.current==n){
return;
}
if(this.current){
this._removeItemClass(this.current,"Over");
}
if(n){
this._addItemClass(n,"Over");
}
this.current=n;
},onMouseOut:function(e){
for(var n=e.relatedTarget;n;){
if(n==this.node){
return;
}
try{
n=n.parentNode;
}
catch(x){
n=null;
}
}
if(this.current){
this._removeItemClass(this.current,"Over");
this.current=null;
}
this._changeState("Container","");
this.onOutEvent();
},onSelectStart:function(e){
if(!this.skipForm||!dnd.isFormElement(e)){
_5f9.stop(e);
}
},onOverEvent:function(){
},onOutEvent:function(){
},_changeState:function(type,_607){
var _608="dojoDnd"+type;
var _609=type.toLowerCase()+"State";
_5fb.replace(this.node,_608+_607,_608+this[_609]);
this[_609]=_607;
},_addItemClass:function(node,type){
_5fb.add(node,"dojoDndItem"+type);
},_removeItemClass:function(node,type){
_5fb.remove(node,"dojoDndItem"+type);
},_getChildByEvent:function(e){
var node=e.target;
if(node){
for(var _60a=node.parentNode;_60a;node=_60a,_60a=node.parentNode){
if((_60a==this.parent||this.allowNested)&&_5fb.contains(node,"dojoDndItem")){
return node;
}
}
}
return null;
},_normalizedCreator:function(item,hint){
var t=(this.creator||this.defaultCreator).call(this,item,hint);
if(!lang.isArray(t.type)){
t.type=["text"];
}
if(!t.node.id){
t.node.id=dnd.getUniqueId();
}
_5fb.add(t.node,"dojoDndItem");
return t;
}});
dnd._createNode=function(tag){
if(!tag){
return dnd._createSpan;
}
return function(text){
return _5fc.create(tag,{innerHTML:text});
};
};
dnd._createTrTd=function(text){
var tr=_5fc.create("tr");
_5fc.create("td",{innerHTML:text},tr);
return tr;
};
dnd._createSpan=function(text){
return _5fc.create("span",{innerHTML:text});
};
dnd._defaultCreatorNodes={ul:"li",ol:"li",div:"div",p:"div"};
dnd._defaultCreator=function(node){
var tag=node.tagName.toLowerCase();
var c=tag=="tbody"||tag=="thead"?dnd._createTrTd:dnd._createNode(dnd._defaultCreatorNodes[tag]);
return function(item,hint){
var _60b=item&&lang.isObject(item),data,type,n;
if(_60b&&item.tagName&&item.nodeType&&item.getAttribute){
data=item.getAttribute("dndData")||item.innerHTML;
type=item.getAttribute("dndType");
type=type?type.split(/\s*,\s*/):["text"];
n=item;
}else{
data=(_60b&&item.data)?item.data:item;
type=(_60b&&item.type)?item.type:["text"];
n=(hint=="avatar"?dnd._createSpan:c)(String(data));
}
if(!n.id){
n.id=dnd.getUniqueId();
}
return {node:n,data:data,type:type};
};
};
return _601;
});
},"dojo/dnd/common":function(){
define(["../_base/connect","../_base/kernel","../_base/lang","../dom"],function(_60c,_60d,lang,dom){
var _60e={};
_60e.getCopyKeyState=_60c.isCopyKey;
_60e._uniqueId=0;
_60e.getUniqueId=function(){
var id;
do{
id=_60d._scopeName+"Unique"+(++_60e._uniqueId);
}while(dom.byId(id));
return id;
};
_60e._empty={};
_60e.isFormElement=function(e){
var t=e.target;
if(t.nodeType==3){
t=t.parentNode;
}
return " button textarea input select option ".indexOf(" "+t.tagName.toLowerCase()+" ")>=0;
};
lang.mixin(lang.getObject("dojo.dnd",true),_60e);
return _60e;
});
},"dojox/grid/_ViewManager":function(){
define(["dojo/_base/declare","dojo/_base/sniff","dojo/dom-class"],function(_60f,has,_610){
return _60f("dojox.grid._ViewManager",null,{constructor:function(_611){
this.grid=_611;
},defaultWidth:200,views:[],resize:function(){
this.onEach("resize");
},render:function(){
this.onEach("render");
},addView:function(_612){
_612.idx=this.views.length;
this.views.push(_612);
},destroyViews:function(){
for(var i=0,v;v=this.views[i];i++){
v.destroy();
}
this.views=[];
},getContentNodes:function(){
var _613=[];
for(var i=0,v;v=this.views[i];i++){
_613.push(v.contentNode);
}
return _613;
},forEach:function(_614){
for(var i=0,v;v=this.views[i];i++){
_614(v,i);
}
},onEach:function(_615,_616){
_616=_616||[];
for(var i=0,v;v=this.views[i];i++){
if(_615 in v){
v[_615].apply(v,_616);
}
}
},normalizeHeaderNodeHeight:function(){
var _617=[];
for(var i=0,v;(v=this.views[i]);i++){
if(v.headerContentNode.firstChild){
_617.push(v.headerContentNode);
}
}
this.normalizeRowNodeHeights(_617);
},normalizeRowNodeHeights:function(_618){
var h=0;
var _619=[];
if(this.grid.rowHeight){
h=this.grid.rowHeight;
}else{
if(_618.length<=1){
return;
}
for(var i=0,n;(n=_618[i]);i++){
if(!_610.contains(n,"dojoxGridNonNormalizedCell")){
_619[i]=n.firstChild.offsetHeight;
h=Math.max(h,_619[i]);
}
}
h=(h>=0?h:0);
if((has("mozilla")||has("ie")>8)&&h){
h++;
}
}
for(i=0;(n=_618[i]);i++){
if(_619[i]!=h){
n.firstChild.style.height=h+"px";
}
}
},resetHeaderNodeHeight:function(){
for(var i=0,v,n;(v=this.views[i]);i++){
n=v.headerContentNode.firstChild;
if(n){
n.style.height="";
}
}
},renormalizeRow:function(_61a){
var _61b=[];
for(var i=0,v,n;(v=this.views[i])&&(n=v.getRowNode(_61a));i++){
n.firstChild.style.height="";
_61b.push(n);
}
this.normalizeRowNodeHeights(_61b);
},getViewWidth:function(_61c){
return this.views[_61c].getWidth()||this.defaultWidth;
},measureHeader:function(){
this.resetHeaderNodeHeight();
this.forEach(function(_61d){
_61d.headerContentNode.style.height="";
});
var h=0;
this.forEach(function(_61e){
h=Math.max(_61e.headerNode.offsetHeight,h);
});
return h;
},measureContent:function(){
var h=0;
this.forEach(function(_61f){
h=Math.max(_61f.domNode.offsetHeight,h);
});
return h;
},findClient:function(_620){
var c=this.grid.elasticView||-1;
if(c<0){
for(var i=1,v;(v=this.views[i]);i++){
if(v.viewWidth){
for(i=1;(v=this.views[i]);i++){
if(!v.viewWidth){
c=i;
break;
}
}
break;
}
}
}
if(c<0){
c=Math.floor(this.views.length/2);
}
return c;
},arrange:function(l,w){
var i,v,vw,len=this.views.length,self=this;
var c=(w<=0?len:this.findClient());
var _621=function(v,l){
var ds=v.domNode.style;
var hs=v.headerNode.style;
if(!self.grid.isLeftToRight()){
ds.right=l+"px";
if(has("ff")<4){
hs.right=l+v.getScrollbarWidth()+"px";
}else{
hs.right=l+"px";
}
if(!has("webkit")){
hs.width=parseInt(hs.width,10)-v.getScrollbarWidth()+"px";
}
}else{
ds.left=l+"px";
hs.left=l+"px";
}
ds.top=0+"px";
hs.top=0;
};
for(i=0;(v=this.views[i])&&(i<c);i++){
vw=this.getViewWidth(i);
v.setSize(vw,0);
_621(v,l);
if(v.headerContentNode&&v.headerContentNode.firstChild){
vw=v.getColumnsWidth()+v.getScrollbarWidth();
}else{
vw=v.domNode.offsetWidth;
}
l+=vw;
}
i++;
var r=w;
for(var j=len-1;(v=this.views[j])&&(i<=j);j--){
vw=this.getViewWidth(j);
v.setSize(vw,0);
vw=v.domNode.offsetWidth;
r-=vw;
_621(v,r);
}
if(c<len){
v=this.views[c];
vw=Math.max(1,r-l);
v.setSize(vw+"px",0);
_621(v,l);
}
return l;
},renderRow:function(_622,_623,_624){
var _625=[];
for(var i=0,v,n,_626;(v=this.views[i])&&(n=_623[i]);i++){
_626=v.renderRow(_622);
n.appendChild(_626);
_625.push(_626);
}
if(!_624){
this.normalizeRowNodeHeights(_625);
}
},rowRemoved:function(_627){
this.onEach("rowRemoved",[_627]);
},updateRow:function(_628,_629){
for(var i=0,v;v=this.views[i];i++){
v.updateRow(_628);
}
if(!_629){
this.renormalizeRow(_628);
}
},updateRowStyles:function(_62a){
this.onEach("updateRowStyles",[_62a]);
},setScrollTop:function(_62b){
var top=_62b;
for(var i=0,v;v=this.views[i];i++){
top=v.setScrollTop(_62b);
if(has("ie")&&v.headerNode&&v.scrollboxNode){
v.headerNode.scrollLeft=v.scrollboxNode.scrollLeft;
}
}
return top;
},getFirstScrollingView:function(){
for(var i=0,v;(v=this.views[i]);i++){
if(v.hasHScrollbar()||v.hasVScrollbar()){
return v;
}
}
return null;
}});
});
},"dojox/grid/cells":function(){
define("dojox/grid/cells",["../main","./cells/_base"],function(_62c){
return _62c.grid.cells;
});
},"dijit/_Widget":function(){
define(["dojo/aspect","dojo/_base/config","dojo/_base/connect","dojo/_base/declare","dojo/has","dojo/_base/kernel","dojo/_base/lang","dojo/query","dojo/ready","./registry","./_WidgetBase","./_OnDijitClickMixin","./_FocusMixin","dojo/uacss","./hccss"],function(_62d,_62e,_62f,_630,has,_631,lang,_632,_633,_634,_635,_636,_637){
function _638(){
};
function _639(_63a){
return function(obj,_63b,_63c,_63d){
if(obj&&typeof _63b=="string"&&obj[_63b]==_638){
return obj.on(_63b.substring(2).toLowerCase(),lang.hitch(_63c,_63d));
}
return _63a.apply(_62f,arguments);
};
};
_62d.around(_62f,"connect",_639);
if(_631.connect){
_62d.around(_631,"connect",_639);
}
var _63e=_630("dijit._Widget",[_635,_636,_637],{onClick:_638,onDblClick:_638,onKeyDown:_638,onKeyPress:_638,onKeyUp:_638,onMouseDown:_638,onMouseMove:_638,onMouseOut:_638,onMouseOver:_638,onMouseLeave:_638,onMouseEnter:_638,onMouseUp:_638,constructor:function(_63f){
this._toConnect={};
for(var name in _63f){
if(this[name]===_638){
this._toConnect[name.replace(/^on/,"").toLowerCase()]=_63f[name];
delete _63f[name];
}
}
},postCreate:function(){
this.inherited(arguments);
for(var name in this._toConnect){
this.on(name,this._toConnect[name]);
}
delete this._toConnect;
},on:function(type,func){
if(this[this._onMap(type)]===_638){
return _62f.connect(this.domNode,type.toLowerCase(),this,func);
}
return this.inherited(arguments);
},_setFocusedAttr:function(val){
this._focused=val;
this._set("focused",val);
},setAttribute:function(attr,_640){
_631.deprecated(this.declaredClass+"::setAttribute(attr, value) is deprecated. Use set() instead.","","2.0");
this.set(attr,_640);
},attr:function(name,_641){
if(_62e.isDebug){
var _642=arguments.callee._ach||(arguments.callee._ach={}),_643=(arguments.callee.caller||"unknown caller").toString();
if(!_642[_643]){
_631.deprecated(this.declaredClass+"::attr() is deprecated. Use get() or set() instead, called from "+_643,"","2.0");
_642[_643]=true;
}
}
var args=arguments.length;
if(args>=2||typeof name==="object"){
return this.set.apply(this,arguments);
}else{
return this.get(name);
}
},getDescendants:function(){
_631.deprecated(this.declaredClass+"::getDescendants() is deprecated. Use getChildren() instead.","","2.0");
return this.containerNode?_632("[widgetId]",this.containerNode).map(_634.byNode):[];
},_onShow:function(){
this.onShow();
},onShow:function(){
},onHide:function(){
},onClose:function(){
return true;
}});
if(has("dijit-legacy-requires")){
_633(0,function(){
var _644=["dijit/_base"];
require(_644);
});
}
return _63e;
});
},"dijit/_FocusMixin":function(){
define(["./focus","./_WidgetBase","dojo/_base/declare","dojo/_base/lang"],function(_645,_646,_647,lang){
lang.extend(_646,{focused:false,onFocus:function(){
},onBlur:function(){
},_onFocus:function(){
this.onFocus();
},_onBlur:function(){
this.onBlur();
}});
return _647("dijit._FocusMixin",null,{_focusManager:_645});
});
},"dijit/_OnDijitClickMixin":function(){
define(["dojo/on","dojo/_base/array","dojo/keys","dojo/_base/declare","dojo/has","dojo/_base/unload","dojo/_base/window","./a11yclick"],function(on,_648,keys,_649,has,_64a,win,_64b){
var ret=_649("dijit._OnDijitClickMixin",null,{connect:function(obj,_64c,_64d){
return this.inherited(arguments,[obj,_64c=="ondijitclick"?_64b:_64c,_64d]);
}});
ret.a11yclick=_64b;
return ret;
});
},"dojo/cache":function(){
define(["./_base/kernel","./text"],function(dojo){
return dojo.cache;
});
},"dijit/focus":function(){
define(["dojo/aspect","dojo/_base/declare","dojo/dom","dojo/dom-attr","dojo/dom-construct","dojo/Evented","dojo/_base/lang","dojo/on","dojo/ready","dojo/sniff","dojo/Stateful","dojo/_base/unload","dojo/_base/window","dojo/window","./a11y","./registry","./main"],function(_64e,_64f,dom,_650,_651,_652,lang,on,_653,has,_654,_655,win,_656,a11y,_657,_658){
var _659=_64f([_654,_652],{curNode:null,activeStack:[],constructor:function(){
var _65a=lang.hitch(this,function(node){
if(dom.isDescendant(this.curNode,node)){
this.set("curNode",null);
}
if(dom.isDescendant(this.prevNode,node)){
this.set("prevNode",null);
}
});
_64e.before(_651,"empty",_65a);
_64e.before(_651,"destroy",_65a);
},registerIframe:function(_65b){
return this.registerWin(_65b.contentWindow,_65b);
},registerWin:function(_65c,_65d){
var _65e=this;
var _65f=function(evt){
_65e._justMouseDowned=true;
setTimeout(function(){
_65e._justMouseDowned=false;
},0);
if(has("ie")&&evt&&evt.srcElement&&evt.srcElement.parentNode==null){
return;
}
_65e._onTouchNode(_65d||evt.target||evt.srcElement,"mouse");
};
var doc=has("ie")?_65c.document.documentElement:_65c.document;
if(doc){
if(has("ie")){
_65c.document.body.attachEvent("onmousedown",_65f);
var _660=function(evt){
var tag=evt.srcElement.tagName.toLowerCase();
if(tag=="#document"||tag=="body"){
return;
}
if(a11y.isTabNavigable(evt.srcElement)){
_65e._onFocusNode(_65d||evt.srcElement);
}else{
_65e._onTouchNode(_65d||evt.srcElement);
}
};
doc.attachEvent("onfocusin",_660);
var _661=function(evt){
_65e._onBlurNode(_65d||evt.srcElement);
};
doc.attachEvent("onfocusout",_661);
return {remove:function(){
_65c.document.detachEvent("onmousedown",_65f);
doc.detachEvent("onfocusin",_660);
doc.detachEvent("onfocusout",_661);
doc=null;
}};
}else{
doc.body.addEventListener("mousedown",_65f,true);
doc.body.addEventListener("touchstart",_65f,true);
var _662=function(evt){
_65e._onFocusNode(_65d||evt.target);
};
doc.addEventListener("focus",_662,true);
var _663=function(evt){
_65e._onBlurNode(_65d||evt.target);
};
doc.addEventListener("blur",_663,true);
return {remove:function(){
doc.body.removeEventListener("mousedown",_65f,true);
doc.body.removeEventListener("touchstart",_65f,true);
doc.removeEventListener("focus",_662,true);
doc.removeEventListener("blur",_663,true);
doc=null;
}};
}
}
},_onBlurNode:function(node){
if(this._clearFocusTimer){
clearTimeout(this._clearFocusTimer);
}
this._clearFocusTimer=setTimeout(lang.hitch(this,function(){
this.set("prevNode",this.curNode);
this.set("curNode",null);
}),0);
if(this._justMouseDowned){
return;
}
if(this._clearActiveWidgetsTimer){
clearTimeout(this._clearActiveWidgetsTimer);
}
this._clearActiveWidgetsTimer=setTimeout(lang.hitch(this,function(){
delete this._clearActiveWidgetsTimer;
this._setStack([]);
}),0);
},_onTouchNode:function(node,by){
if(this._clearActiveWidgetsTimer){
clearTimeout(this._clearActiveWidgetsTimer);
delete this._clearActiveWidgetsTimer;
}
var _664=[];
try{
while(node){
var _665=_650.get(node,"dijitPopupParent");
if(_665){
node=_657.byId(_665).domNode;
}else{
if(node.tagName&&node.tagName.toLowerCase()=="body"){
if(node===win.body()){
break;
}
node=_656.get(node.ownerDocument).frameElement;
}else{
var id=node.getAttribute&&node.getAttribute("widgetId"),_666=id&&_657.byId(id);
if(_666&&!(by=="mouse"&&_666.get("disabled"))){
_664.unshift(id);
}
node=node.parentNode;
}
}
}
}
catch(e){
}
this._setStack(_664,by);
},_onFocusNode:function(node){
if(!node){
return;
}
if(node.nodeType==9){
return;
}
if(this._clearFocusTimer){
clearTimeout(this._clearFocusTimer);
delete this._clearFocusTimer;
}
this._onTouchNode(node);
if(node==this.curNode){
return;
}
this.set("prevNode",this.curNode);
this.set("curNode",node);
},_setStack:function(_667,by){
var _668=this.activeStack;
this.set("activeStack",_667);
for(var _669=0;_669<Math.min(_668.length,_667.length);_669++){
if(_668[_669]!=_667[_669]){
break;
}
}
var _66a;
for(var i=_668.length-1;i>=_669;i--){
_66a=_657.byId(_668[i]);
if(_66a){
_66a._hasBeenBlurred=true;
_66a.set("focused",false);
if(_66a._focusManager==this){
_66a._onBlur(by);
}
this.emit("widget-blur",_66a,by);
}
}
for(i=_669;i<_667.length;i++){
_66a=_657.byId(_667[i]);
if(_66a){
_66a.set("focused",true);
if(_66a._focusManager==this){
_66a._onFocus(by);
}
this.emit("widget-focus",_66a,by);
}
}
},focus:function(node){
if(node){
try{
node.focus();
}
catch(e){
}
}
}});
var _66b=new _659();
_653(function(){
var _66c=_66b.registerWin(_656.get(win.doc));
if(has("ie")){
_655.addOnWindowUnload(function(){
if(_66c){
_66c.remove();
_66c=null;
}
});
}
});
_658.focus=function(node){
_66b.focus(node);
};
for(var attr in _66b){
if(!/^_/.test(attr)){
_658.focus[attr]=typeof _66b[attr]=="function"?lang.hitch(_66b,attr):_66b[attr];
}
}
_66b.watch(function(attr,_66d,_66e){
_658.focus[attr]=_66e;
});
return _66b;
});
},"dojox/grid/util":function(){
define("dojox/grid/util",["../main","dojo/_base/lang","dojo/dom"],function(_66f,lang,dom){
var dgu=lang.getObject("grid.util",true,_66f);
dgu.na="...";
dgu.rowIndexTag="gridRowIndex";
dgu.gridViewTag="gridView";
dgu.fire=function(ob,ev,args){
var fn=ob&&ev&&ob[ev];
return fn&&(args?fn.apply(ob,args):ob[ev]());
};
dgu.setStyleHeightPx=function(_670,_671){
if(_671>=0){
var s=_670.style;
var v=_671+"px";
if(_670&&s["height"]!=v){
s["height"]=v;
}
}
};
dgu.mouseEvents=["mouseover","mouseout","mousedown","mouseup","click","dblclick","contextmenu"];
dgu.keyEvents=["keyup","keydown","keypress"];
dgu.funnelEvents=function(_672,_673,_674,_675){
var evts=(_675?_675:dgu.mouseEvents.concat(dgu.keyEvents));
for(var i=0,l=evts.length;i<l;i++){
_673.connect(_672,"on"+evts[i],_674);
}
};
dgu.removeNode=function(_676){
_676=dom.byId(_676);
_676&&_676.parentNode&&_676.parentNode.removeChild(_676);
return _676;
};
dgu.arrayCompare=function(inA,inB){
for(var i=0,l=inA.length;i<l;i++){
if(inA[i]!=inB[i]){
return false;
}
}
return (inA.length==inB.length);
};
dgu.arrayInsert=function(_677,_678,_679){
if(_677.length<=_678){
_677[_678]=_679;
}else{
_677.splice(_678,0,_679);
}
};
dgu.arrayRemove=function(_67a,_67b){
_67a.splice(_67b,1);
};
dgu.arraySwap=function(_67c,inI,inJ){
var _67d=_67c[inI];
_67c[inI]=_67c[inJ];
_67c[inJ]=_67d;
};
return dgu;
});
},"url:dijit/templates/MenuItem.html":"<tr class=\"dijitReset dijitMenuItem\" data-dojo-attach-point=\"focusNode\" role=\"menuitem\" tabIndex=\"-1\">\n\t<td class=\"dijitReset dijitMenuItemIconCell\" role=\"presentation\">\n\t\t<img src=\"${_blankGif}\" alt=\"\" class=\"dijitIcon dijitMenuItemIcon\" data-dojo-attach-point=\"iconNode\"/>\n\t</td>\n\t<td class=\"dijitReset dijitMenuItemLabel\" colspan=\"2\" data-dojo-attach-point=\"containerNode\"></td>\n\t<td class=\"dijitReset dijitMenuItemAccelKey\" style=\"display: none\" data-dojo-attach-point=\"accelKeyNode\"></td>\n\t<td class=\"dijitReset dijitMenuArrowCell\" role=\"presentation\">\n\t\t<div data-dojo-attach-point=\"arrowWrapper\" style=\"visibility: hidden\">\n\t\t\t<img src=\"${_blankGif}\" alt=\"\" class=\"dijitMenuExpand\"/>\n\t\t\t<span class=\"dijitMenuExpandA11y\">+</span>\n\t\t</div>\n\t</td>\n</tr>\n","dijit/main":function(){
define(["dojo/_base/kernel"],function(dojo){
return dojo.dijit;
});
},"url:dojox/grid/resources/View.html":"<div class=\"dojoxGridView\" role=\"presentation\">\n\t<div class=\"dojoxGridHeader\" dojoAttachPoint=\"headerNode\" role=\"presentation\">\n\t\t<div dojoAttachPoint=\"headerNodeContainer\" style=\"width:9000em\" role=\"presentation\">\n\t\t\t<div dojoAttachPoint=\"headerContentNode\" role=\"row\"></div>\n\t\t</div>\n\t</div>\n\t<input type=\"checkbox\" class=\"dojoxGridHiddenFocus\" dojoAttachPoint=\"hiddenFocusNode\" role=\"presentation\" />\n\t<input type=\"checkbox\" class=\"dojoxGridHiddenFocus\" role=\"presentation\" />\n\t<div class=\"dojoxGridScrollbox\" dojoAttachPoint=\"scrollboxNode\" role=\"presentation\">\n\t\t<div class=\"dojoxGridContent\" dojoAttachPoint=\"contentNode\" hidefocus=\"hidefocus\" role=\"presentation\"></div>\n\t</div>\n</div>\n","dojox/grid/_FocusManager":function(){
define("dojox/grid/_FocusManager",["dojo/_base/array","dojo/_base/lang","dojo/_base/declare","dojo/_base/connect","dojo/_base/event","dojo/_base/sniff","dojo/query","./util","dojo/_base/html"],function(_67e,lang,_67f,_680,_681,has,_682,util,html){
return _67f("dojox.grid._FocusManager",null,{constructor:function(_683){
this.grid=_683;
this.cell=null;
this.rowIndex=-1;
this._connects=[];
this._headerConnects=[];
this.headerMenu=this.grid.headerMenu;
this._connects.push(_680.connect(this.grid.domNode,"onfocus",this,"doFocus"));
this._connects.push(_680.connect(this.grid.domNode,"onblur",this,"doBlur"));
this._connects.push(_680.connect(this.grid.domNode,"mousedown",this,"_mouseDown"));
this._connects.push(_680.connect(this.grid.domNode,"mouseup",this,"_mouseUp"));
this._connects.push(_680.connect(this.grid.domNode,"oncontextmenu",this,"doContextMenu"));
this._connects.push(_680.connect(this.grid.lastFocusNode,"onfocus",this,"doLastNodeFocus"));
this._connects.push(_680.connect(this.grid.lastFocusNode,"onblur",this,"doLastNodeBlur"));
this._connects.push(_680.connect(this.grid,"_onFetchComplete",this,"_delayedCellFocus"));
this._connects.push(_680.connect(this.grid,"postrender",this,"_delayedHeaderFocus"));
},destroy:function(){
_67e.forEach(this._connects,_680.disconnect);
_67e.forEach(this._headerConnects,_680.disconnect);
delete this.grid;
delete this.cell;
},_colHeadNode:null,_colHeadFocusIdx:null,_contextMenuBindNode:null,tabbingOut:false,focusClass:"dojoxGridCellFocus",focusView:null,initFocusView:function(){
this.focusView=this.grid.views.getFirstScrollingView()||this.focusView||this.grid.views.views[0];
this._initColumnHeaders();
},isFocusCell:function(_684,_685){
return (this.cell==_684)&&(this.rowIndex==_685);
},isLastFocusCell:function(){
if(this.cell){
return (this.rowIndex==this.grid.rowCount-1)&&(this.cell.index==this.grid.layout.cellCount-1);
}
return false;
},isFirstFocusCell:function(){
if(this.cell){
return (this.rowIndex===0)&&(this.cell.index===0);
}
return false;
},isNoFocusCell:function(){
return (this.rowIndex<0)||!this.cell;
},isNavHeader:function(){
return (!!this._colHeadNode);
},getHeaderIndex:function(){
if(this._colHeadNode){
return _67e.indexOf(this._findHeaderCells(),this._colHeadNode);
}else{
return -1;
}
},_focusifyCellNode:function(_686){
var n=this.cell&&this.cell.getNode(this.rowIndex);
if(n){
html.toggleClass(n,this.focusClass,_686);
if(_686){
var sl=this.scrollIntoView();
try{
if(has("webkit")||!this.grid.edit.isEditing()){
util.fire(n,"focus");
if(sl){
this.cell.view.scrollboxNode.scrollLeft=sl;
}
}
}
catch(e){
}
}
}
},_delayedCellFocus:function(){
if(this.isNavHeader()||!this.grid.focused){
return;
}
var n=this.cell&&this.cell.getNode(this.rowIndex);
if(n){
try{
if(!this.grid.edit.isEditing()){
html.toggleClass(n,this.focusClass,true);
if(this._colHeadNode){
this.blurHeader();
}
util.fire(n,"focus");
}
}
catch(e){
}
}
},_delayedHeaderFocus:function(){
if(this.isNavHeader()){
this.focusHeader();
}
},_initColumnHeaders:function(){
_67e.forEach(this._headerConnects,_680.disconnect);
this._headerConnects=[];
var _687=this._findHeaderCells();
for(var i=0;i<_687.length;i++){
this._headerConnects.push(_680.connect(_687[i],"onfocus",this,"doColHeaderFocus"));
this._headerConnects.push(_680.connect(_687[i],"onblur",this,"doColHeaderBlur"));
}
},_findHeaderCells:function(){
var _688=_682("th",this.grid.viewsHeaderNode);
var _689=[];
for(var i=0;i<_688.length;i++){
var _68a=_688[i];
var _68b=html.hasAttr(_68a,"tabIndex");
var _68c=html.attr(_68a,"tabIndex");
if(_68b&&_68c<0){
_689.push(_68a);
}
}
return _689;
},_setActiveColHeader:function(_68d,_68e,_68f){
this.grid.domNode.setAttribute("aria-activedescendant",_68d.id);
if(_68f!=null&&_68f>=0&&_68f!=_68e){
html.toggleClass(this._findHeaderCells()[_68f],this.focusClass,false);
}
html.toggleClass(_68d,this.focusClass,true);
this._colHeadNode=_68d;
this._colHeadFocusIdx=_68e;
this._scrollHeader(this._colHeadFocusIdx);
},scrollIntoView:function(){
var info=(this.cell?this._scrollInfo(this.cell):null);
if(!info||!info.s){
return null;
}
var rt=this.grid.scroller.findScrollTop(this.rowIndex);
if(info.n&&info.sr){
if(info.n.offsetLeft+info.n.offsetWidth>info.sr.l+info.sr.w){
info.s.scrollLeft=info.n.offsetLeft+info.n.offsetWidth-info.sr.w;
}else{
if(info.n.offsetLeft<info.sr.l){
info.s.scrollLeft=info.n.offsetLeft;
}
}
}
if(info.r&&info.sr){
if(rt+info.r.offsetHeight>info.sr.t+info.sr.h){
this.grid.setScrollTop(rt+info.r.offsetHeight-info.sr.h);
}else{
if(rt<info.sr.t){
this.grid.setScrollTop(rt);
}
}
}
return info.s.scrollLeft;
},_scrollInfo:function(cell,_690){
if(cell){
var cl=cell,sbn=cl.view.scrollboxNode,sbnr={w:sbn.clientWidth,l:sbn.scrollLeft,t:sbn.scrollTop,h:sbn.clientHeight},rn=cl.view.getRowNode(this.rowIndex);
return {c:cl,s:sbn,sr:sbnr,n:(_690?_690:cell.getNode(this.rowIndex)),r:rn};
}
return null;
},_scrollHeader:function(_691){
var info=null;
if(this._colHeadNode){
var cell=this.grid.getCell(_691);
if(!cell){
return;
}
info=this._scrollInfo(cell,cell.getNode(0));
}
if(info&&info.s&&info.sr&&info.n){
var _692=info.sr.l+info.sr.w;
if(info.n.offsetLeft+info.n.offsetWidth>_692){
info.s.scrollLeft=info.n.offsetLeft+info.n.offsetWidth-info.sr.w;
}else{
if(info.n.offsetLeft<info.sr.l){
info.s.scrollLeft=info.n.offsetLeft;
}else{
if(has("ie")<=7&&cell&&cell.view.headerNode){
cell.view.headerNode.scrollLeft=info.s.scrollLeft;
}
}
}
}
},_isHeaderHidden:function(){
var _693=this.focusView;
if(!_693){
for(var i=0,_694;(_694=this.grid.views.views[i]);i++){
if(_694.headerNode){
_693=_694;
break;
}
}
}
return (_693&&html.getComputedStyle(_693.headerNode).display=="none");
},colSizeAdjust:function(e,_695,_696){
var _697=this._findHeaderCells();
var view=this.focusView;
if(!view||!view.header.tableMap.map){
for(var i=0,_698;(_698=this.grid.views.views[i]);i++){
if(_698.header.tableMap.map){
view=_698;
break;
}
}
}
var _699=_697[_695];
if(!view||(_695==_697.length-1&&_695===0)){
return;
}
view.content.baseDecorateEvent(e);
e.cellNode=_699;
e.cellIndex=view.content.getCellNodeIndex(e.cellNode);
e.cell=(e.cellIndex>=0?this.grid.getCell(e.cellIndex):null);
if(view.header.canResize(e)){
var _69a={l:_696};
var drag=view.header.colResizeSetup(e,false);
view.header.doResizeColumn(drag,null,_69a);
view.update();
}
},styleRow:function(_69b){
return;
},setFocusIndex:function(_69c,_69d){
this.setFocusCell(this.grid.getCell(_69d),_69c);
},setFocusCell:function(_69e,_69f){
if(_69e&&!this.isFocusCell(_69e,_69f)){
this.tabbingOut=false;
if(this._colHeadNode){
this.blurHeader();
}
this._colHeadNode=this._colHeadFocusIdx=null;
this.focusGridView();
this._focusifyCellNode(false);
this.cell=_69e;
this.rowIndex=_69f;
this._focusifyCellNode(true);
}
if(has("opera")){
setTimeout(lang.hitch(this.grid,"onCellFocus",this.cell,this.rowIndex),1);
}else{
this.grid.onCellFocus(this.cell,this.rowIndex);
}
},next:function(){
if(this.cell){
var row=this.rowIndex,col=this.cell.index+1,cc=this.grid.layout.cellCount-1,rc=this.grid.rowCount-1;
if(col>cc){
col=0;
row++;
}
if(row>rc){
col=cc;
row=rc;
}
if(this.grid.edit.isEditing()){
var _6a0=this.grid.getCell(col);
if(!this.isLastFocusCell()&&(!_6a0.editable||this.grid.canEdit&&!this.grid.canEdit(_6a0,row))){
this.cell=_6a0;
this.rowIndex=row;
this.next();
return;
}
}
this.setFocusIndex(row,col);
}
},previous:function(){
if(this.cell){
var row=(this.rowIndex||0),col=(this.cell.index||0)-1;
if(col<0){
col=this.grid.layout.cellCount-1;
row--;
}
if(row<0){
row=0;
col=0;
}
if(this.grid.edit.isEditing()){
var _6a1=this.grid.getCell(col);
if(!this.isFirstFocusCell()&&!_6a1.editable){
this.cell=_6a1;
this.rowIndex=row;
this.previous();
return;
}
}
this.setFocusIndex(row,col);
}
},move:function(_6a2,_6a3){
var _6a4=_6a3<0?-1:1;
if(this.isNavHeader()){
var _6a5=this._findHeaderCells();
var _6a6=currentIdx=_67e.indexOf(_6a5,this._colHeadNode);
currentIdx+=_6a3;
while(currentIdx>=0&&currentIdx<_6a5.length&&_6a5[currentIdx].style.display=="none"){
currentIdx+=_6a4;
}
if((currentIdx>=0)&&(currentIdx<_6a5.length)){
this._setActiveColHeader(_6a5[currentIdx],currentIdx,_6a6);
}
}else{
if(this.cell){
var sc=this.grid.scroller,r=this.rowIndex,rc=this.grid.rowCount-1,row=Math.min(rc,Math.max(0,r+_6a2));
if(_6a2){
if(_6a2>0){
if(row>sc.getLastPageRow(sc.page)){
this.grid.setScrollTop(this.grid.scrollTop+sc.findScrollTop(row)-sc.findScrollTop(r));
}
}else{
if(_6a2<0){
if(row<=sc.getPageRow(sc.page)){
this.grid.setScrollTop(this.grid.scrollTop-sc.findScrollTop(r)-sc.findScrollTop(row));
}
}
}
}
var cc=this.grid.layout.cellCount-1,i=this.cell.index,col=Math.min(cc,Math.max(0,i+_6a3));
var cell=this.grid.getCell(col);
while(col>=0&&col<cc&&cell&&cell.hidden===true){
col+=_6a4;
cell=this.grid.getCell(col);
}
if(!cell||cell.hidden===true){
col=i;
}
var n=cell.getNode(row);
if(!n&&_6a2){
if((row+_6a2)>=0&&(row+_6a2)<=rc){
this.move(_6a2>0?++_6a2:--_6a2,_6a3);
}
return;
}else{
if((!n||html.style(n,"display")==="none")&&_6a3){
if((col+_6a3)>=0&&(col+_6a3)<=cc){
this.move(_6a2,_6a3>0?++_6a3:--_6a3);
}
return;
}
}
this.setFocusIndex(row,col);
if(_6a2){
this.grid.updateRow(r);
}
}
}
},previousKey:function(e){
if(this.grid.edit.isEditing()){
_681.stop(e);
this.previous();
}else{
if(!this.isNavHeader()&&!this._isHeaderHidden()){
this.grid.domNode.focus();
_681.stop(e);
}else{
this.tabOut(this.grid.domNode);
if(this._colHeadFocusIdx!=null){
html.toggleClass(this._findHeaderCells()[this._colHeadFocusIdx],this.focusClass,false);
this._colHeadFocusIdx=null;
}
this._focusifyCellNode(false);
}
}
},nextKey:function(e){
var _6a7=(this.grid.rowCount===0);
if(e.target===this.grid.domNode&&this._colHeadFocusIdx==null){
this.focusHeader();
_681.stop(e);
}else{
if(this.isNavHeader()){
this.blurHeader();
if(!this.findAndFocusGridCell()){
this.tabOut(this.grid.lastFocusNode);
}
this._colHeadNode=this._colHeadFocusIdx=null;
}else{
if(this.grid.edit.isEditing()){
_681.stop(e);
this.next();
}else{
this.tabOut(this.grid.lastFocusNode);
}
}
}
},tabOut:function(_6a8){
this.tabbingOut=true;
_6a8.focus();
},focusGridView:function(){
util.fire(this.focusView,"focus");
},focusGrid:function(_6a9){
this.focusGridView();
this._focusifyCellNode(true);
},findAndFocusGridCell:function(){
var _6aa=true;
var _6ab=(this.grid.rowCount===0);
if(this.isNoFocusCell()&&!_6ab){
var _6ac=0;
var cell=this.grid.getCell(_6ac);
if(cell.hidden){
_6ac=this.isNavHeader()?this._colHeadFocusIdx:0;
}
this.setFocusIndex(0,_6ac);
}else{
if(this.cell&&!_6ab){
if(this.focusView&&!this.focusView.rowNodes[this.rowIndex]){
this.grid.scrollToRow(this.rowIndex);
}
this.focusGrid();
}else{
_6aa=false;
}
}
this._colHeadNode=this._colHeadFocusIdx=null;
return _6aa;
},focusHeader:function(){
var _6ad=this._findHeaderCells();
var _6ae=this._colHeadFocusIdx;
if(this._isHeaderHidden()){
this.findAndFocusGridCell();
}else{
if(!this._colHeadFocusIdx){
if(this.isNoFocusCell()){
this._colHeadFocusIdx=0;
}else{
this._colHeadFocusIdx=this.cell.index;
}
}
}
this._colHeadNode=_6ad[this._colHeadFocusIdx];
while(this._colHeadNode&&this._colHeadFocusIdx>=0&&this._colHeadFocusIdx<_6ad.length&&this._colHeadNode.style.display=="none"){
this._colHeadFocusIdx++;
this._colHeadNode=_6ad[this._colHeadFocusIdx];
}
if(this._colHeadNode&&this._colHeadNode.style.display!="none"){
if(this.headerMenu&&this._contextMenuBindNode!=this.grid.domNode){
this.headerMenu.unBindDomNode(this.grid.viewsHeaderNode);
this.headerMenu.bindDomNode(this.grid.domNode);
this._contextMenuBindNode=this.grid.domNode;
}
this._setActiveColHeader(this._colHeadNode,this._colHeadFocusIdx,_6ae);
this._scrollHeader(this._colHeadFocusIdx);
this._focusifyCellNode(false);
}else{
this.findAndFocusGridCell();
}
},blurHeader:function(){
html.removeClass(this._colHeadNode,this.focusClass);
html.removeAttr(this.grid.domNode,"aria-activedescendant");
if(this.headerMenu&&this._contextMenuBindNode==this.grid.domNode){
var _6af=this.grid.viewsHeaderNode;
this.headerMenu.unBindDomNode(this.grid.domNode);
this.headerMenu.bindDomNode(_6af);
this._contextMenuBindNode=_6af;
}
},doFocus:function(e){
if(e&&e.target!=e.currentTarget){
_681.stop(e);
return;
}
if(this._clickFocus){
return;
}
if(!this.tabbingOut){
this.focusHeader();
}
this.tabbingOut=false;
_681.stop(e);
},doBlur:function(e){
_681.stop(e);
},doContextMenu:function(e){
if(!this.headerMenu){
_681.stop(e);
}
},doLastNodeFocus:function(e){
if(this.tabbingOut){
this._focusifyCellNode(false);
}else{
if(this.grid.rowCount>0){
if(this.isNoFocusCell()){
this.setFocusIndex(0,0);
}
this._focusifyCellNode(true);
}else{
this.focusHeader();
}
}
this.tabbingOut=false;
_681.stop(e);
},doLastNodeBlur:function(e){
_681.stop(e);
},doColHeaderFocus:function(e){
this._setActiveColHeader(e.target,html.attr(e.target,"idx"),this._colHeadFocusIdx);
this._scrollHeader(this.getHeaderIndex());
_681.stop(e);
},doColHeaderBlur:function(e){
html.toggleClass(e.target,this.focusClass,false);
},_mouseDown:function(e){
this._clickFocus=dojo.some(this.grid.views.views,function(v){
return v.scrollboxNode===e.target;
});
},_mouseUp:function(e){
this._clickFocus=false;
}});
});
},"dijit/MenuItem":function(){
define(["dojo/_base/declare","dojo/dom","dojo/dom-attr","dojo/dom-class","dojo/_base/kernel","dojo/sniff","./_Widget","./_TemplatedMixin","./_Contained","./_CssStateMixin","dojo/text!./templates/MenuItem.html"],function(_6b0,dom,_6b1,_6b2,_6b3,has,_6b4,_6b5,_6b6,_6b7,_6b8){
return _6b0("dijit.MenuItem",[_6b4,_6b5,_6b6,_6b7],{templateString:_6b8,baseClass:"dijitMenuItem",label:"",_setLabelAttr:function(val){
this.containerNode.innerHTML=val;
this._set("label",val);
if(this.textDir==="auto"){
this.applyTextDir(this.focusNode,this.label);
}
},iconClass:"dijitNoIcon",_setIconClassAttr:{node:"iconNode",type:"class"},accelKey:"",disabled:false,_fillContent:function(_6b9){
if(_6b9&&!("label" in this.params)){
this.set("label",_6b9.innerHTML);
}
},buildRendering:function(){
this.inherited(arguments);
var _6ba=this.id+"_text";
_6b1.set(this.containerNode,"id",_6ba);
if(this.accelKeyNode){
_6b1.set(this.accelKeyNode,"id",this.id+"_accel");
_6ba+=" "+this.id+"_accel";
}
this.domNode.setAttribute("aria-labelledby",_6ba);
dom.setSelectable(this.domNode,false);
},onClick:function(){
},focus:function(){
try{
if(has("ie")==8){
this.containerNode.focus();
}
this.focusNode.focus();
}
catch(e){
}
},_onFocus:function(){
this._setSelected(true);
this.getParent()._onItemFocus(this);
this.inherited(arguments);
},_setSelected:function(_6bb){
_6b2.toggle(this.domNode,"dijitMenuItemSelected",_6bb);
},setLabel:function(_6bc){
_6b3.deprecated("dijit.MenuItem.setLabel() is deprecated.  Use set('label', ...) instead.","","2.0");
this.set("label",_6bc);
},setDisabled:function(_6bd){
_6b3.deprecated("dijit.Menu.setDisabled() is deprecated.  Use set('disabled', bool) instead.","","2.0");
this.set("disabled",_6bd);
},_setDisabledAttr:function(_6be){
this.focusNode.setAttribute("aria-disabled",_6be?"true":"false");
this._set("disabled",_6be);
},_setAccelKeyAttr:function(_6bf){
this.accelKeyNode.style.display=_6bf?"":"none";
this.accelKeyNode.innerHTML=_6bf;
_6b1.set(this.containerNode,"colSpan",_6bf?"1":"2");
this._set("accelKey",_6bf);
},_setTextDirAttr:function(_6c0){
if(!this._created||this.textDir!=_6c0){
this._set("textDir",_6c0);
this.applyTextDir(this.focusNode,this.label);
}
}});
});
},"dijit/_TemplatedMixin":function(){
define(["dojo/_base/lang","dojo/touch","./_WidgetBase","dojo/string","dojo/cache","dojo/_base/array","dojo/_base/declare","dojo/dom-construct","dojo/sniff","dojo/_base/unload"],function(lang,_6c1,_6c2,_6c3,_6c4,_6c5,_6c6,_6c7,has,_6c8){
var _6c9=_6c6("dijit._TemplatedMixin",null,{templateString:null,templatePath:null,_skipNodeCache:false,_earlyTemplatedStartup:false,constructor:function(){
this._attachPoints=[];
this._attachEvents=[];
},_stringRepl:function(tmpl){
var _6ca=this.declaredClass,_6cb=this;
return _6c3.substitute(tmpl,this,function(_6cc,key){
if(key.charAt(0)=="!"){
_6cc=lang.getObject(key.substr(1),false,_6cb);
}
if(typeof _6cc=="undefined"){
throw new Error(_6ca+" template:"+key);
}
if(_6cc==null){
return "";
}
return key.charAt(0)=="!"?_6cc:_6cc.toString().replace(/"/g,"&quot;");
},this);
},buildRendering:function(){
if(!this.templateString){
this.templateString=_6c4(this.templatePath,{sanitize:true});
}
var _6cd=_6c9.getCachedTemplate(this.templateString,this._skipNodeCache,this.ownerDocument);
var node;
if(lang.isString(_6cd)){
node=_6c7.toDom(this._stringRepl(_6cd),this.ownerDocument);
if(node.nodeType!=1){
throw new Error("Invalid template: "+_6cd);
}
}else{
node=_6cd.cloneNode(true);
}
this.domNode=node;
this.inherited(arguments);
this._attachTemplateNodes(node,function(n,p){
return n.getAttribute(p);
});
this._beforeFillContent();
this._fillContent(this.srcNodeRef);
},_beforeFillContent:function(){
},_fillContent:function(_6ce){
var dest=this.containerNode;
if(_6ce&&dest){
while(_6ce.hasChildNodes()){
dest.appendChild(_6ce.firstChild);
}
}
},_attachTemplateNodes:function(_6cf,_6d0){
var _6d1=lang.isArray(_6cf)?_6cf:(_6cf.all||_6cf.getElementsByTagName("*"));
var x=lang.isArray(_6cf)?0:-1;
for(;x<0||_6d1[x];x++){
var _6d2=(x==-1)?_6cf:_6d1[x];
if(this.widgetsInTemplate&&(_6d0(_6d2,"dojoType")||_6d0(_6d2,"data-dojo-type"))){
continue;
}
var _6d3=_6d0(_6d2,"dojoAttachPoint")||_6d0(_6d2,"data-dojo-attach-point");
if(_6d3){
var _6d4,_6d5=_6d3.split(/\s*,\s*/);
while((_6d4=_6d5.shift())){
if(lang.isArray(this[_6d4])){
this[_6d4].push(_6d2);
}else{
this[_6d4]=_6d2;
}
this._attachPoints.push(_6d4);
}
}
var _6d6=_6d0(_6d2,"dojoAttachEvent")||_6d0(_6d2,"data-dojo-attach-event");
if(_6d6){
var _6d7,_6d8=_6d6.split(/\s*,\s*/);
var trim=lang.trim;
while((_6d7=_6d8.shift())){
if(_6d7){
var _6d9=null;
if(_6d7.indexOf(":")!=-1){
var _6da=_6d7.split(":");
_6d7=trim(_6da[0]);
_6d9=trim(_6da[1]);
}else{
_6d7=trim(_6d7);
}
if(!_6d9){
_6d9=_6d7;
}
this._attachEvents.push(this.connect(_6d2,_6c1[_6d7]||_6d7,_6d9));
}
}
}
}
},destroyRendering:function(){
_6c5.forEach(this._attachPoints,function(_6db){
delete this[_6db];
},this);
this._attachPoints=[];
_6c5.forEach(this._attachEvents,this.disconnect,this);
this._attachEvents=[];
this.inherited(arguments);
}});
_6c9._templateCache={};
_6c9.getCachedTemplate=function(_6dc,_6dd,doc){
var _6de=_6c9._templateCache;
var key=_6dc;
var _6df=_6de[key];
if(_6df){
try{
if(!_6df.ownerDocument||_6df.ownerDocument==(doc||document)){
return _6df;
}
}
catch(e){
}
_6c7.destroy(_6df);
}
_6dc=_6c3.trim(_6dc);
if(_6dd||_6dc.match(/\$\{([^\}]+)\}/g)){
return (_6de[key]=_6dc);
}else{
var node=_6c7.toDom(_6dc,doc);
if(node.nodeType!=1){
throw new Error("Invalid template: "+_6dc);
}
return (_6de[key]=node);
}
};
if(has("ie")){
_6c8.addOnWindowUnload(function(){
var _6e0=_6c9._templateCache;
for(var key in _6e0){
var _6e1=_6e0[key];
if(typeof _6e1=="object"){
_6c7.destroy(_6e1);
}
delete _6e0[key];
}
});
}
lang.extend(_6c2,{dojoAttachEvent:"",dojoAttachPoint:""});
return _6c9;
});
},"dojox/grid/_SelectionPreserver":function(){
define("dojox/grid/_SelectionPreserver",["dojo/_base/declare","dojo/_base/connect","dojo/_base/lang","dojo/_base/array"],function(_6e2,_6e3,lang,_6e4){
return _6e2("dojox.grid._SelectionPreserver",null,{constructor:function(_6e5){
this.selection=_6e5;
var grid=this.grid=_6e5.grid;
this.reset();
this._connects=[_6e3.connect(grid,"_setStore",this,"reset"),_6e3.connect(grid,"_addItem",this,"_reSelectById"),_6e3.connect(_6e5,"onSelected",lang.hitch(this,"_selectById",true)),_6e3.connect(_6e5,"onDeselected",lang.hitch(this,"_selectById",false)),_6e3.connect(_6e5,"deselectAll",this,"reset")];
},destroy:function(){
this.reset();
_6e4.forEach(this._connects,_6e3.disconnect);
delete this._connects;
},reset:function(){
this._selectedById={};
},_reSelectById:function(item,_6e6){
if(item&&this.grid._hasIdentity){
this.selection.selected[_6e6]=this._selectedById[this.grid.store.getIdentity(item)];
}
},_selectById:function(_6e7,_6e8){
if(this.selection.mode=="none"||!this.grid._hasIdentity){
return;
}
var item=_6e8,g=this.grid;
if(typeof _6e8=="number"||typeof _6e8=="string"){
var _6e9=g._by_idx[_6e8];
item=_6e9&&_6e9.item;
}
if(item){
this._selectedById[g.store.getIdentity(item)]=!!_6e7;
}
return item;
}});
});
},"dojo/window":function(){
define(["./_base/lang","./sniff","./_base/window","./dom","./dom-geometry","./dom-style"],function(lang,has,_6ea,dom,geom,_6eb){
var _6ec={getBox:function(doc){
doc=doc||_6ea.doc;
var _6ed=(doc.compatMode=="BackCompat")?_6ea.body(doc):doc.documentElement,_6ee=geom.docScroll(doc),w,h;
if(has("touch")){
var _6ef=_6ec.get(doc);
w=_6ef.innerWidth||_6ed.clientWidth;
h=_6ef.innerHeight||_6ed.clientHeight;
}else{
w=_6ed.clientWidth;
h=_6ed.clientHeight;
}
return {l:_6ee.x,t:_6ee.y,w:w,h:h};
},get:function(doc){
if(has("ie")&&_6ec!==document.parentWindow){
doc.parentWindow.execScript("document._parentWindow = window;","Javascript");
var win=doc._parentWindow;
doc._parentWindow=null;
return win;
}
return doc.parentWindow||doc.defaultView;
},scrollIntoView:function(node,pos){
try{
node=dom.byId(node);
var doc=node.ownerDocument||_6ea.doc,body=_6ea.body(doc),html=doc.documentElement||body.parentNode,isIE=has("ie"),isWK=has("webkit");
if((!(has("mozilla")||isIE||isWK||has("opera"))||node==body||node==html)&&(typeof node.scrollIntoView!="undefined")){
node.scrollIntoView(false);
return;
}
var _6f0=doc.compatMode=="BackCompat",_6f1=(isIE>=9&&"frameElement" in node.ownerDocument.parentWindow)?((html.clientHeight>0&&html.clientWidth>0&&(body.clientHeight==0||body.clientWidth==0||body.clientHeight>html.clientHeight||body.clientWidth>html.clientWidth))?html:body):(_6f0?body:html),_6f2=isWK?body:_6f1,_6f3=_6f1.clientWidth,_6f4=_6f1.clientHeight,rtl=!geom.isBodyLtr(doc),_6f5=pos||geom.position(node),el=node.parentNode,_6f6=function(el){
return ((isIE<=6||(isIE&&_6f0))?false:(_6eb.get(el,"position").toLowerCase()=="fixed"));
};
if(_6f6(node)){
return;
}
while(el){
if(el==body){
el=_6f2;
}
var _6f7=geom.position(el),_6f8=_6f6(el);
if(el==_6f2){
_6f7.w=_6f3;
_6f7.h=_6f4;
if(_6f2==html&&isIE&&rtl){
_6f7.x+=_6f2.offsetWidth-_6f7.w;
}
if(_6f7.x<0||!isIE){
_6f7.x=0;
}
if(_6f7.y<0||!isIE){
_6f7.y=0;
}
}else{
var pb=geom.getPadBorderExtents(el);
_6f7.w-=pb.w;
_6f7.h-=pb.h;
_6f7.x+=pb.l;
_6f7.y+=pb.t;
var _6f9=el.clientWidth,_6fa=_6f7.w-_6f9;
if(_6f9>0&&_6fa>0){
_6f7.w=_6f9;
_6f7.x+=(rtl&&(isIE||el.clientLeft>pb.l))?_6fa:0;
}
_6f9=el.clientHeight;
_6fa=_6f7.h-_6f9;
if(_6f9>0&&_6fa>0){
_6f7.h=_6f9;
}
}
if(_6f8){
if(_6f7.y<0){
_6f7.h+=_6f7.y;
_6f7.y=0;
}
if(_6f7.x<0){
_6f7.w+=_6f7.x;
_6f7.x=0;
}
if(_6f7.y+_6f7.h>_6f4){
_6f7.h=_6f4-_6f7.y;
}
if(_6f7.x+_6f7.w>_6f3){
_6f7.w=_6f3-_6f7.x;
}
}
var l=_6f5.x-_6f7.x,t=_6f5.y-Math.max(_6f7.y,0),r=l+_6f5.w-_6f7.w,bot=t+_6f5.h-_6f7.h;
if(r*l>0){
var s=Math[l<0?"max":"min"](l,r);
if(rtl&&((isIE==8&&!_6f0)||isIE>=9)){
s=-s;
}
_6f5.x+=el.scrollLeft;
el.scrollLeft+=s;
_6f5.x-=el.scrollLeft;
}
if(bot*t>0){
_6f5.y+=el.scrollTop;
el.scrollTop+=Math[t<0?"max":"min"](t,bot);
_6f5.y-=el.scrollTop;
}
el=(el!=_6f2)&&!_6f8&&el.parentNode;
}
}
catch(error){
console.error("scrollIntoView: "+error);
node.scrollIntoView(false);
}
}};
1&&lang.setObject("dojo.window",_6ec);
return _6ec;
});
},"dojox/grid/_Builder":function(){
define(["../main","dojo/_base/array","dojo/_base/lang","dojo/_base/window","dojo/_base/event","dojo/_base/sniff","dojo/_base/connect","dojo/dnd/Moveable","dojox/html/metrics","./util","dojo/_base/html"],function(_6fb,_6fc,lang,win,_6fd,has,_6fe,_6ff,_700,util,html){
var dg=_6fb.grid;
var _701=function(td){
return td.cellIndex>=0?td.cellIndex:_6fc.indexOf(td.parentNode.cells,td);
};
var _702=function(tr){
return tr.rowIndex>=0?tr.rowIndex:_6fc.indexOf(tr.parentNode.childNodes,tr);
};
var _703=function(_704,_705){
return _704&&((_704.rows||0)[_705]||_704.childNodes[_705]);
};
var _706=function(node){
for(var n=node;n&&n.tagName!="TABLE";n=n.parentNode){
}
return n;
};
var _707=function(_708,_709){
for(var n=_708;n&&_709(n);n=n.parentNode){
}
return n;
};
var _70a=function(_70b){
var name=_70b.toUpperCase();
return function(node){
return node.tagName!=name;
};
};
var _70c=util.rowIndexTag;
var _70d=util.gridViewTag;
var _70e=dg._Builder=lang.extend(function(view){
if(view){
this.view=view;
this.grid=view.grid;
}
},{view:null,_table:"<table class=\"dojoxGridRowTable\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\" role=\"presentation\"",getTableArray:function(){
var html=[this._table];
if(this.view.viewWidth){
html.push([" style=\"width:",this.view.viewWidth,";\""].join(""));
}
html.push(">");
return html;
},generateCellMarkup:function(_70f,_710,_711,_712){
var _713=[],html;
if(_712){
var _714=_70f.index!=_70f.grid.getSortIndex()?"":_70f.grid.sortInfo>0?"aria-sort=\"ascending\"":"aria-sort=\"descending\"";
if(!_70f.id){
_70f.id=this.grid.id+"Hdr"+_70f.index;
}
html=["<th tabIndex=\"-1\" aria-readonly=\"true\" role=\"columnheader\"",_714,"id=\"",_70f.id,"\""];
}else{
var _715=this.grid.editable&&!_70f.editable?"aria-readonly=\"true\"":"";
html=["<td tabIndex=\"-1\" role=\"gridcell\"",_715];
}
if(_70f.colSpan){
html.push(" colspan=\"",_70f.colSpan,"\"");
}
if(_70f.rowSpan){
html.push(" rowspan=\"",_70f.rowSpan,"\"");
}
html.push(" class=\"dojoxGridCell ");
if(_70f.classes){
html.push(_70f.classes," ");
}
if(_711){
html.push(_711," ");
}
_713.push(html.join(""));
_713.push("");
html=["\" idx=\"",_70f.index,"\" style=\""];
if(_710&&_710[_710.length-1]!=";"){
_710+=";";
}
html.push(_70f.styles,_710||"",_70f.hidden?"display:none;":"");
if(_70f.unitWidth){
html.push("width:",_70f.unitWidth,";");
}
_713.push(html.join(""));
_713.push("");
html=["\""];
if(_70f.attrs){
html.push(" ",_70f.attrs);
}
html.push(">");
_713.push(html.join(""));
_713.push("");
_713.push(_712?"</th>":"</td>");
return _713;
},isCellNode:function(_716){
return Boolean(_716&&_716!=win.doc&&html.attr(_716,"idx"));
},getCellNodeIndex:function(_717){
return _717?Number(html.attr(_717,"idx")):-1;
},getCellNode:function(_718,_719){
for(var i=0,row;((row=_703(_718.firstChild,i))&&row.cells);i++){
for(var j=0,cell;(cell=row.cells[j]);j++){
if(this.getCellNodeIndex(cell)==_719){
return cell;
}
}
}
return null;
},findCellTarget:function(_71a,_71b){
var n=_71a;
while(n&&(!this.isCellNode(n)||(n.offsetParent&&_70d in n.offsetParent.parentNode&&n.offsetParent.parentNode[_70d]!=this.view.id))&&(n!=_71b)){
n=n.parentNode;
}
return n!=_71b?n:null;
},baseDecorateEvent:function(e){
e.dispatch="do"+e.type;
e.grid=this.grid;
e.sourceView=this.view;
e.cellNode=this.findCellTarget(e.target,e.rowNode);
e.cellIndex=this.getCellNodeIndex(e.cellNode);
e.cell=(e.cellIndex>=0?this.grid.getCell(e.cellIndex):null);
},findTarget:function(_71c,_71d){
var n=_71c;
while(n&&(n!=this.domNode)&&(!(_71d in n)||(_70d in n&&n[_70d]!=this.view.id))){
n=n.parentNode;
}
return (n!=this.domNode)?n:null;
},findRowTarget:function(_71e){
return this.findTarget(_71e,_70c);
},isIntraNodeEvent:function(e){
try{
return (e.cellNode&&e.relatedTarget&&html.isDescendant(e.relatedTarget,e.cellNode));
}
catch(x){
return false;
}
},isIntraRowEvent:function(e){
try{
var row=e.relatedTarget&&this.findRowTarget(e.relatedTarget);
return !row&&(e.rowIndex==-1)||row&&(e.rowIndex==row.gridRowIndex);
}
catch(x){
return false;
}
},dispatchEvent:function(e){
if(e.dispatch in this){
return this[e.dispatch](e);
}
return false;
},domouseover:function(e){
if(e.cellNode&&(e.cellNode!=this.lastOverCellNode)){
this.lastOverCellNode=e.cellNode;
this.grid.onMouseOver(e);
}
this.grid.onMouseOverRow(e);
},domouseout:function(e){
if(e.cellNode&&(e.cellNode==this.lastOverCellNode)&&!this.isIntraNodeEvent(e,this.lastOverCellNode)){
this.lastOverCellNode=null;
this.grid.onMouseOut(e);
if(!this.isIntraRowEvent(e)){
this.grid.onMouseOutRow(e);
}
}
},domousedown:function(e){
if(e.cellNode){
this.grid.onMouseDown(e);
}
this.grid.onMouseDownRow(e);
}});
var _71f=dg._ContentBuilder=lang.extend(function(view){
_70e.call(this,view);
},_70e.prototype,{update:function(){
this.prepareHtml();
},prepareHtml:function(){
var _720=this.grid.get,_721=this.view.structure.cells;
for(var j=0,row;(row=_721[j]);j++){
for(var i=0,cell;(cell=row[i]);i++){
cell.get=cell.get||(cell.value==undefined)&&_720;
cell.markup=this.generateCellMarkup(cell,cell.cellStyles,cell.cellClasses,false);
if(!this.grid.editable&&cell.editable){
this.grid.editable=true;
}
}
}
},generateHtml:function(_722,_723){
var html=this.getTableArray(),v=this.view,_724=v.structure.cells,item=this.grid.getItem(_723);
util.fire(this.view,"onBeforeRow",[_723,_724]);
for(var j=0,row;(row=_724[j]);j++){
if(row.hidden||row.header){
continue;
}
html.push(!row.invisible?"<tr>":"<tr class=\"dojoxGridInvisible\">");
for(var i=0,cell,m,cc,cs;(cell=row[i]);i++){
m=cell.markup;
cc=cell.customClasses=[];
cs=cell.customStyles=[];
m[5]=cell.format(_723,item);
m[1]=cc.join(" ");
m[3]=cs.join(";");
html.push.apply(html,m);
}
html.push("</tr>");
}
html.push("</table>");
return html.join("");
},decorateEvent:function(e){
e.rowNode=this.findRowTarget(e.target);
if(!e.rowNode){
return false;
}
e.rowIndex=e.rowNode[_70c];
this.baseDecorateEvent(e);
e.cell=this.grid.getCell(e.cellIndex);
return true;
}});
var _725=dg._HeaderBuilder=lang.extend(function(view){
this.moveable=null;
_70e.call(this,view);
},_70e.prototype,{_skipBogusClicks:false,overResizeWidth:4,minColWidth:1,update:function(){
if(this.tableMap){
this.tableMap.mapRows(this.view.structure.cells);
}else{
this.tableMap=new dg._TableMap(this.view.structure.cells);
}
},generateHtml:function(_726,_727){
var html=this.getTableArray(),_728=this.view.structure.cells;
util.fire(this.view,"onBeforeRow",[-1,_728]);
for(var j=0,row;(row=_728[j]);j++){
if(row.hidden){
continue;
}
html.push(!row.invisible?"<tr>":"<tr class=\"dojoxGridInvisible\">");
for(var i=0,cell,_729;(cell=row[i]);i++){
cell.customClasses=[];
cell.customStyles=[];
if(this.view.simpleStructure){
if(cell.draggable){
if(cell.headerClasses){
if(cell.headerClasses.indexOf("dojoDndItem")==-1){
cell.headerClasses+=" dojoDndItem";
}
}else{
cell.headerClasses="dojoDndItem";
}
}
if(cell.attrs){
if(cell.attrs.indexOf("dndType='gridColumn_")==-1){
cell.attrs+=" dndType='gridColumn_"+this.grid.id+"'";
}
}else{
cell.attrs="dndType='gridColumn_"+this.grid.id+"'";
}
}
_729=this.generateCellMarkup(cell,cell.headerStyles,cell.headerClasses,true);
_729[5]=(_727!=undefined?_727:_726(cell));
_729[3]=cell.customStyles.join(";");
_729[1]=cell.customClasses.join(" ");
html.push(_729.join(""));
}
html.push("</tr>");
}
html.push("</table>");
return html.join("");
},getCellX:function(e){
var n,x=e.layerX;
if(has("mozilla")||has("ie")>=9){
n=_707(e.target,_70a("th"));
x-=(n&&n.offsetLeft)||0;
var t=e.sourceView.getScrollbarWidth();
if(!this.grid.isLeftToRight()){
table=_707(n,_70a("table"));
x-=(table&&table.offsetLeft)||0;
}
}
n=_707(e.target,function(){
if(!n||n==e.cellNode){
return false;
}
x+=(n.offsetLeft<0?0:n.offsetLeft);
return true;
});
return x;
},decorateEvent:function(e){
this.baseDecorateEvent(e);
e.rowIndex=-1;
e.cellX=this.getCellX(e);
return true;
},prepareResize:function(e,mod){
do{
var i=e.cellIndex;
e.cellNode=(i?e.cellNode.parentNode.cells[i+mod]:null);
e.cellIndex=(e.cellNode?this.getCellNodeIndex(e.cellNode):-1);
}while(e.cellNode&&e.cellNode.style.display=="none");
return Boolean(e.cellNode);
},canResize:function(e){
if(!e.cellNode||e.cellNode.colSpan>1){
return false;
}
var cell=this.grid.getCell(e.cellIndex);
return !cell.noresize&&cell.canResize();
},overLeftResizeArea:function(e){
if(html.hasClass(win.body(),"dojoDndMove")){
return false;
}
if(has("ie")){
var tN=e.target;
if(html.hasClass(tN,"dojoxGridArrowButtonNode")||html.hasClass(tN,"dojoxGridArrowButtonChar")||html.hasClass(tN,"dojoxGridColCaption")){
return false;
}
}
if(this.grid.isLeftToRight()){
return (e.cellIndex>0)&&(e.cellX>0&&e.cellX<this.overResizeWidth)&&this.prepareResize(e,-1);
}
var t=e.cellNode&&(e.cellX>0&&e.cellX<this.overResizeWidth);
return t;
},overRightResizeArea:function(e){
if(html.hasClass(win.body(),"dojoDndMove")){
return false;
}
if(has("ie")){
var tN=e.target;
if(html.hasClass(tN,"dojoxGridArrowButtonNode")||html.hasClass(tN,"dojoxGridArrowButtonChar")||html.hasClass(tN,"dojoxGridColCaption")){
return false;
}
}
if(this.grid.isLeftToRight()){
return e.cellNode&&(e.cellX>=e.cellNode.offsetWidth-this.overResizeWidth);
}
return (e.cellIndex>0)&&(e.cellX>=e.cellNode.offsetWidth-this.overResizeWidth)&&this.prepareResize(e,-1);
},domousemove:function(e){
if(!this.moveable){
var c=(this.overRightResizeArea(e)?"dojoxGridColResize":(this.overLeftResizeArea(e)?"dojoxGridColResize":""));
if(c&&!this.canResize(e)){
c="dojoxGridColNoResize";
}
html.toggleClass(e.sourceView.headerNode,"dojoxGridColNoResize",(c=="dojoxGridColNoResize"));
html.toggleClass(e.sourceView.headerNode,"dojoxGridColResize",(c=="dojoxGridColResize"));
if(c){
_6fd.stop(e);
}
}
},domousedown:function(e){
if(!this.moveable){
if((this.overRightResizeArea(e)||this.overLeftResizeArea(e))&&this.canResize(e)){
this.beginColumnResize(e);
}else{
this.grid.onMouseDown(e);
this.grid.onMouseOverRow(e);
}
}
},doclick:function(e){
if(this._skipBogusClicks){
_6fd.stop(e);
return true;
}
return false;
},colResizeSetup:function(e,_72a){
var _72b=html.contentBox(e.sourceView.headerNode);
if(_72a){
this.lineDiv=document.createElement("div");
var vw=html.position(e.sourceView.headerNode,true);
var _72c=html.contentBox(e.sourceView.domNode);
var l=e.pageX;
if(!this.grid.isLeftToRight()&&has("ie")<8){
l-=_700.getScrollbar().w;
}
html.style(this.lineDiv,{top:vw.y+"px",left:l+"px",height:(_72c.h+_72b.h)+"px"});
html.addClass(this.lineDiv,"dojoxGridResizeColLine");
this.lineDiv._origLeft=l;
win.body().appendChild(this.lineDiv);
}
var _72d=[],_72e=this.tableMap.findOverlappingNodes(e.cellNode);
for(var i=0,cell;(cell=_72e[i]);i++){
_72d.push({node:cell,index:this.getCellNodeIndex(cell),width:cell.offsetWidth});
}
var view=e.sourceView;
var adj=this.grid.isLeftToRight()?1:-1;
var _72f=e.grid.views.views;
var _730=[];
for(var j=view.idx+adj,_731;(_731=_72f[j]);j=j+adj){
_730.push({node:_731.headerNode,left:window.parseInt(_731.headerNode.style.left)});
}
var _732=view.headerContentNode.firstChild;
var drag={scrollLeft:e.sourceView.headerNode.scrollLeft,view:view,node:e.cellNode,index:e.cellIndex,w:html.contentBox(e.cellNode).w,vw:_72b.w,table:_732,tw:html.contentBox(_732).w,spanners:_72d,followers:_730};
return drag;
},beginColumnResize:function(e){
this.moverDiv=document.createElement("div");
html.style(this.moverDiv,{position:"absolute",left:0});
win.body().appendChild(this.moverDiv);
html.addClass(this.grid.domNode,"dojoxGridColumnResizing");
var m=(this.moveable=new _6ff(this.moverDiv));
var drag=this.colResizeSetup(e,true);
m.onMove=lang.hitch(this,"doResizeColumn",drag);
_6fe.connect(m,"onMoveStop",lang.hitch(this,function(){
this.endResizeColumn(drag);
if(drag.node.releaseCapture){
drag.node.releaseCapture();
}
this.moveable.destroy();
delete this.moveable;
this.moveable=null;
html.removeClass(this.grid.domNode,"dojoxGridColumnResizing");
}));
if(e.cellNode.setCapture){
e.cellNode.setCapture();
}
m.onMouseDown(e);
},doResizeColumn:function(_733,_734,_735){
var _736=_735.l;
var data={deltaX:_736,w:_733.w+(this.grid.isLeftToRight()?_736:-_736),vw:_733.vw+_736,tw:_733.tw+_736};
this.dragRecord={inDrag:_733,mover:_734,leftTop:_735};
if(data.w>=this.minColWidth){
if(!_734){
this.doResizeNow(_733,data);
}else{
html.style(this.lineDiv,"left",(this.lineDiv._origLeft+data.deltaX)+"px");
}
}
},endResizeColumn:function(_737){
if(this.dragRecord){
var _738=this.dragRecord.leftTop;
var _739=this.grid.isLeftToRight()?_738.l:-_738.l;
_739+=Math.max(_737.w+_739,this.minColWidth)-(_737.w+_739);
if(has("webkit")&&_737.spanners.length){
_739+=html._getPadBorderExtents(_737.spanners[0].node).w;
}
var data={deltaX:_739,w:_737.w+_739,vw:_737.vw+_739,tw:_737.tw+_739};
this.doResizeNow(_737,data);
delete this.dragRecord;
}
html.destroy(this.lineDiv);
html.destroy(this.moverDiv);
html.destroy(this.moverDiv);
delete this.moverDiv;
this._skipBogusClicks=true;
_737.view.update();
this._skipBogusClicks=false;
this.grid.onResizeColumn(_737.index);
},doResizeNow:function(_73a,data){
_73a.view.convertColPctToFixed();
if(_73a.view.flexCells&&!_73a.view.testFlexCells()){
var t=_706(_73a.node);
if(t){
(t.style.width="");
}
}
var i,s,sw,f,fl;
for(i=0;(s=_73a.spanners[i]);i++){
sw=s.width+data.deltaX;
if(sw>0){
s.node.style.width=sw+"px";
_73a.view.setColWidth(s.index,sw);
}
}
if(this.grid.isLeftToRight()||!has("ie")){
for(i=0;(f=_73a.followers[i]);i++){
fl=f.left+data.deltaX;
f.node.style.left=fl+"px";
}
}
_73a.node.style.width=data.w+"px";
_73a.view.setColWidth(_73a.index,data.w);
_73a.view.headerNode.style.width=data.vw+"px";
_73a.view.setColumnsWidth(data.tw);
if(!this.grid.isLeftToRight()){
_73a.view.headerNode.scrollLeft=_73a.scrollLeft+data.deltaX;
}
}});
dg._TableMap=lang.extend(function(rows){
this.mapRows(rows);
},{map:null,mapRows:function(_73b){
var _73c=_73b.length;
if(!_73c){
return;
}
this.map=[];
var row;
for(var k=0;(row=_73b[k]);k++){
this.map[k]=[];
}
for(var j=0;(row=_73b[j]);j++){
for(var i=0,x=0,cell,_73d,_73e;(cell=row[i]);i++){
while(this.map[j][x]){
x++;
}
this.map[j][x]={c:i,r:j};
_73e=cell.rowSpan||1;
_73d=cell.colSpan||1;
for(var y=0;y<_73e;y++){
for(var s=0;s<_73d;s++){
this.map[j+y][x+s]=this.map[j][x];
}
}
x+=_73d;
}
}
},dumpMap:function(){
for(var j=0,row,h="";(row=this.map[j]);j++,h=""){
for(var i=0,cell;(cell=row[i]);i++){
h+=cell.r+","+cell.c+"   ";
}
}
},getMapCoords:function(_73f,_740){
for(var j=0,row;(row=this.map[j]);j++){
for(var i=0,cell;(cell=row[i]);i++){
if(cell.c==_740&&cell.r==_73f){
return {j:j,i:i};
}
}
}
return {j:-1,i:-1};
},getNode:function(_741,_742,_743){
var row=_741&&_741.rows[_742];
return row&&row.cells[_743];
},_findOverlappingNodes:function(_744,_745,_746){
var _747=[];
var m=this.getMapCoords(_745,_746);
for(var j=0,row;(row=this.map[j]);j++){
if(j==m.j){
continue;
}
var rw=row[m.i];
var n=(rw?this.getNode(_744,rw.r,rw.c):null);
if(n){
_747.push(n);
}
}
return _747;
},findOverlappingNodes:function(_748){
return this._findOverlappingNodes(_706(_748),_702(_748.parentNode),_701(_748));
}});
return {_Builder:_70e,_HeaderBuilder:_725,_ContentBuilder:_71f};
});
},"dojo/dnd/Source":function(){
define(["../_base/array","../_base/connect","../_base/declare","../_base/kernel","../_base/lang","../dom-class","../dom-geometry","../mouse","../ready","../topic","./common","./Selector","./Manager"],function(_749,_74a,_74b,_74c,lang,_74d,_74e,_74f,_750,_751,dnd,_752,_753){
if(!_74c.isAsync){
_750(0,function(){
var _754=["dojo/dnd/AutoSource","dojo/dnd/Target"];
require(_754);
});
}
var _755=_74b("dojo.dnd.Source",_752,{isSource:true,horizontal:false,copyOnly:false,selfCopy:false,selfAccept:true,skipForm:false,withHandles:false,autoSync:false,delay:0,accept:["text"],generateText:true,constructor:function(node,_756){
lang.mixin(this,lang.mixin({},_756));
var type=this.accept;
if(type.length){
this.accept={};
for(var i=0;i<type.length;++i){
this.accept[type[i]]=1;
}
}
this.isDragging=false;
this.mouseDown=false;
this.targetAnchor=null;
this.targetBox=null;
this.before=true;
this._lastX=0;
this._lastY=0;
this.sourceState="";
if(this.isSource){
_74d.add(this.node,"dojoDndSource");
}
this.targetState="";
if(this.accept){
_74d.add(this.node,"dojoDndTarget");
}
if(this.horizontal){
_74d.add(this.node,"dojoDndHorizontal");
}
this.topics=[_751.subscribe("/dnd/source/over",lang.hitch(this,"onDndSourceOver")),_751.subscribe("/dnd/start",lang.hitch(this,"onDndStart")),_751.subscribe("/dnd/drop",lang.hitch(this,"onDndDrop")),_751.subscribe("/dnd/cancel",lang.hitch(this,"onDndCancel"))];
},checkAcceptance:function(_757,_758){
if(this==_757){
return !this.copyOnly||this.selfAccept;
}
for(var i=0;i<_758.length;++i){
var type=_757.getItem(_758[i].id).type;
var flag=false;
for(var j=0;j<type.length;++j){
if(type[j] in this.accept){
flag=true;
break;
}
}
if(!flag){
return false;
}
}
return true;
},copyState:function(_759,self){
if(_759){
return true;
}
if(arguments.length<2){
self=this==_753.manager().target;
}
if(self){
if(this.copyOnly){
return this.selfCopy;
}
}else{
return this.copyOnly;
}
return false;
},destroy:function(){
_755.superclass.destroy.call(this);
_749.forEach(this.topics,function(t){
t.remove();
});
this.targetAnchor=null;
},onMouseMove:function(e){
if(this.isDragging&&this.targetState=="Disabled"){
return;
}
_755.superclass.onMouseMove.call(this,e);
var m=_753.manager();
if(!this.isDragging){
if(this.mouseDown&&this.isSource&&(Math.abs(e.pageX-this._lastX)>this.delay||Math.abs(e.pageY-this._lastY)>this.delay)){
var _75a=this.getSelectedNodes();
if(_75a.length){
m.startDrag(this,_75a,this.copyState(dnd.getCopyKeyState(e),true));
}
}
}
if(this.isDragging){
var _75b=false;
if(this.current){
if(!this.targetBox||this.targetAnchor!=this.current){
this.targetBox=_74e.position(this.current,true);
}
if(this.horizontal){
_75b=(e.pageX-this.targetBox.x<this.targetBox.w/2)==_74e.isBodyLtr(this.current.ownerDocument);
}else{
_75b=(e.pageY-this.targetBox.y)<(this.targetBox.h/2);
}
}
if(this.current!=this.targetAnchor||_75b!=this.before){
this._markTargetAnchor(_75b);
m.canDrop(!this.current||m.source!=this||!(this.current.id in this.selection));
}
}
},onMouseDown:function(e){
if(!this.mouseDown&&this._legalMouseDown(e)&&(!this.skipForm||!dnd.isFormElement(e))){
this.mouseDown=true;
this._lastX=e.pageX;
this._lastY=e.pageY;
_755.superclass.onMouseDown.call(this,e);
}
},onMouseUp:function(e){
if(this.mouseDown){
this.mouseDown=false;
_755.superclass.onMouseUp.call(this,e);
}
},onDndSourceOver:function(_75c){
if(this!==_75c){
this.mouseDown=false;
if(this.targetAnchor){
this._unmarkTargetAnchor();
}
}else{
if(this.isDragging){
var m=_753.manager();
m.canDrop(this.targetState!="Disabled"&&(!this.current||m.source!=this||!(this.current.id in this.selection)));
}
}
},onDndStart:function(_75d,_75e,copy){
if(this.autoSync){
this.sync();
}
if(this.isSource){
this._changeState("Source",this==_75d?(copy?"Copied":"Moved"):"");
}
var _75f=this.accept&&this.checkAcceptance(_75d,_75e);
this._changeState("Target",_75f?"":"Disabled");
if(this==_75d){
_753.manager().overSource(this);
}
this.isDragging=true;
},onDndDrop:function(_760,_761,copy,_762){
if(this==_762){
this.onDrop(_760,_761,copy);
}
this.onDndCancel();
},onDndCancel:function(){
if(this.targetAnchor){
this._unmarkTargetAnchor();
this.targetAnchor=null;
}
this.before=true;
this.isDragging=false;
this.mouseDown=false;
this._changeState("Source","");
this._changeState("Target","");
},onDrop:function(_763,_764,copy){
if(this!=_763){
this.onDropExternal(_763,_764,copy);
}else{
this.onDropInternal(_764,copy);
}
},onDropExternal:function(_765,_766,copy){
var _767=this._normalizedCreator;
if(this.creator){
this._normalizedCreator=function(node,hint){
return _767.call(this,_765.getItem(node.id).data,hint);
};
}else{
if(copy){
this._normalizedCreator=function(node){
var t=_765.getItem(node.id);
var n=node.cloneNode(true);
n.id=dnd.getUniqueId();
return {node:n,data:t.data,type:t.type};
};
}else{
this._normalizedCreator=function(node){
var t=_765.getItem(node.id);
_765.delItem(node.id);
return {node:node,data:t.data,type:t.type};
};
}
}
this.selectNone();
if(!copy&&!this.creator){
_765.selectNone();
}
this.insertNodes(true,_766,this.before,this.current);
if(!copy&&this.creator){
_765.deleteSelectedNodes();
}
this._normalizedCreator=_767;
},onDropInternal:function(_768,copy){
var _769=this._normalizedCreator;
if(this.current&&this.current.id in this.selection){
return;
}
if(copy){
if(this.creator){
this._normalizedCreator=function(node,hint){
return _769.call(this,this.getItem(node.id).data,hint);
};
}else{
this._normalizedCreator=function(node){
var t=this.getItem(node.id);
var n=node.cloneNode(true);
n.id=dnd.getUniqueId();
return {node:n,data:t.data,type:t.type};
};
}
}else{
if(!this.current){
return;
}
this._normalizedCreator=function(node){
var t=this.getItem(node.id);
return {node:node,data:t.data,type:t.type};
};
}
this._removeSelection();
this.insertNodes(true,_768,this.before,this.current);
this._normalizedCreator=_769;
},onDraggingOver:function(){
},onDraggingOut:function(){
},onOverEvent:function(){
_755.superclass.onOverEvent.call(this);
_753.manager().overSource(this);
if(this.isDragging&&this.targetState!="Disabled"){
this.onDraggingOver();
}
},onOutEvent:function(){
_755.superclass.onOutEvent.call(this);
_753.manager().outSource(this);
if(this.isDragging&&this.targetState!="Disabled"){
this.onDraggingOut();
}
},_markTargetAnchor:function(_76a){
if(this.current==this.targetAnchor&&this.before==_76a){
return;
}
if(this.targetAnchor){
this._removeItemClass(this.targetAnchor,this.before?"Before":"After");
}
this.targetAnchor=this.current;
this.targetBox=null;
this.before=_76a;
if(this.targetAnchor){
this._addItemClass(this.targetAnchor,this.before?"Before":"After");
}
},_unmarkTargetAnchor:function(){
if(!this.targetAnchor){
return;
}
this._removeItemClass(this.targetAnchor,this.before?"Before":"After");
this.targetAnchor=null;
this.targetBox=null;
this.before=true;
},_markDndStatus:function(copy){
this._changeState("Source",copy?"Copied":"Moved");
},_legalMouseDown:function(e){
if(e.type!="touchstart"&&!_74f.isLeft(e)){
return false;
}
if(!this.withHandles){
return true;
}
for(var node=e.target;node&&node!==this.node;node=node.parentNode){
if(_74d.contains(node,"dojoDndHandle")){
return true;
}
if(_74d.contains(node,"dojoDndItem")||_74d.contains(node,"dojoDndIgnore")){
break;
}
}
return false;
}});
return _755;
});
},"dojox/grid/cells/_base":function(){
define("dojox/grid/cells/_base",["dojo/_base/kernel","dojo/_base/declare","dojo/_base/lang","dojo/_base/event","dojo/_base/connect","dojo/_base/array","dojo/_base/sniff","dojo/dom","dojo/dom-attr","dojo/dom-construct","dijit/_Widget","../util"],function(dojo,_76b,lang,_76c,_76d,_76e,has,dom,_76f,_770,_771,util){
var _772=_76b("dojox.grid._DeferredTextWidget",_771,{deferred:null,_destroyOnRemove:true,postCreate:function(){
if(this.deferred){
this.deferred.addBoth(lang.hitch(this,function(text){
if(this.domNode){
this.domNode.innerHTML=text;
}
}));
}
}});
var _773=function(_774){
try{
util.fire(_774,"focus");
util.fire(_774,"select");
}
catch(e){
}
};
var _775=function(){
setTimeout(lang.hitch.apply(dojo,arguments),0);
};
var _776=_76b("dojox.grid.cells._Base",null,{styles:"",classes:"",editable:false,alwaysEditing:false,formatter:null,defaultValue:"...",value:null,hidden:false,noresize:false,draggable:true,_valueProp:"value",_formatPending:false,constructor:function(_777){
this._props=_777||{};
lang.mixin(this,_777);
if(this.draggable===undefined){
this.draggable=true;
}
},_defaultFormat:function(_778,_779){
var s=this.grid.formatterScope||this;
var f=this.formatter;
if(f&&s&&typeof f=="string"){
f=this.formatter=s[f];
}
var v=(_778!=this.defaultValue&&f)?f.apply(s,_779):_778;
if(typeof v=="undefined"){
return this.defaultValue;
}
if(v&&v.addBoth){
v=new _772({deferred:v},_770.create("span",{innerHTML:this.defaultValue}));
}
if(v&&v.declaredClass&&v.startup){
return "<div class='dojoxGridStubNode' linkWidget='"+v.id+"' cellIdx='"+this.index+"'>"+this.defaultValue+"</div>";
}
return v;
},format:function(_77a,_77b){
var f,i=this.grid.edit.info,d=this.get?this.get(_77a,_77b):(this.value||this.defaultValue);
d=(d&&d.replace&&this.grid.escapeHTMLInData)?d.replace(/&/g,"&amp;").replace(/</g,"&lt;"):d;
if(this.editable&&(this.alwaysEditing||(i.rowIndex==_77a&&i.cell==this))){
return this.formatEditing(d,_77a);
}else{
return this._defaultFormat(d,[d,_77a,this]);
}
},formatEditing:function(_77c,_77d){
},getNode:function(_77e){
return this.view.getCellNode(_77e,this.index);
},getHeaderNode:function(){
return this.view.getHeaderCellNode(this.index);
},getEditNode:function(_77f){
return (this.getNode(_77f)||0).firstChild||0;
},canResize:function(){
var uw=this.unitWidth;
return uw&&(uw!=="auto");
},isFlex:function(){
var uw=this.unitWidth;
return uw&&lang.isString(uw)&&(uw=="auto"||uw.slice(-1)=="%");
},applyEdit:function(_780,_781){
if(this.getNode(_781)){
this.grid.edit.applyCellEdit(_780,this,_781);
}
},cancelEdit:function(_782){
this.grid.doCancelEdit(_782);
},_onEditBlur:function(_783){
if(this.grid.edit.isEditCell(_783,this.index)){
this.grid.edit.apply();
}
},registerOnBlur:function(_784,_785){
if(this.commitOnBlur){
_76d.connect(_784,"onblur",function(e){
setTimeout(lang.hitch(this,"_onEditBlur",_785),250);
});
}
},needFormatNode:function(_786,_787){
this._formatPending=true;
_775(this,"_formatNode",_786,_787);
},cancelFormatNode:function(){
this._formatPending=false;
},_formatNode:function(_788,_789){
if(this._formatPending){
this._formatPending=false;
if(!has("ie")){
dom.setSelectable(this.grid.domNode,true);
}
this.formatNode(this.getEditNode(_789),_788,_789);
}
},formatNode:function(_78a,_78b,_78c){
if(has("ie")){
_775(this,"focus",_78c,_78a);
}else{
this.focus(_78c,_78a);
}
},dispatchEvent:function(m,e){
if(m in this){
return this[m](e);
}
},getValue:function(_78d){
return this.getEditNode(_78d)[this._valueProp];
},setValue:function(_78e,_78f){
var n=this.getEditNode(_78e);
if(n){
n[this._valueProp]=_78f;
}
},focus:function(_790,_791){
_773(_791||this.getEditNode(_790));
},save:function(_792){
this.value=this.value||this.getValue(_792);
},restore:function(_793){
this.setValue(_793,this.value);
},_finish:function(_794){
dom.setSelectable(this.grid.domNode,false);
this.cancelFormatNode();
},apply:function(_795){
this.applyEdit(this.getValue(_795),_795);
this._finish(_795);
},cancel:function(_796){
this.cancelEdit(_796);
this._finish(_796);
}});
_776.markupFactory=function(node,_797){
var _798=lang.trim(_76f.get(node,"formatter")||"");
if(_798){
_797.formatter=lang.getObject(_798)||_798;
}
var get=lang.trim(_76f.get(node,"get")||"");
if(get){
_797.get=lang.getObject(get);
}
var _799=function(attr,cell,_79a){
var _79b=lang.trim(_76f.get(node,attr)||"");
if(_79b){
cell[_79a||attr]=!(_79b.toLowerCase()=="false");
}
};
_799("sortDesc",_797);
_799("editable",_797);
_799("alwaysEditing",_797);
_799("noresize",_797);
_799("draggable",_797);
var _79c=lang.trim(_76f.get(node,"loadingText")||_76f.get(node,"defaultValue")||"");
if(_79c){
_797.defaultValue=_79c;
}
var _79d=function(attr,cell,_79e){
var _79f=lang.trim(_76f.get(node,attr)||"")||undefined;
if(_79f){
cell[_79e||attr]=_79f;
}
};
_79d("styles",_797);
_79d("headerStyles",_797);
_79d("cellStyles",_797);
_79d("classes",_797);
_79d("headerClasses",_797);
_79d("cellClasses",_797);
};
var Cell=_76b("dojox.grid.cells.Cell",_776,{constructor:function(){
this.keyFilter=this.keyFilter;
},keyFilter:null,formatEditing:function(_7a0,_7a1){
this.needFormatNode(_7a0,_7a1);
return "<input class=\"dojoxGridInput\" type=\"text\" value=\""+_7a0+"\">";
},formatNode:function(_7a2,_7a3,_7a4){
this.inherited(arguments);
this.registerOnBlur(_7a2,_7a4);
},doKey:function(e){
if(this.keyFilter){
var key=String.fromCharCode(e.charCode);
if(key.search(this.keyFilter)==-1){
_76c.stop(e);
}
}
},_finish:function(_7a5){
this.inherited(arguments);
var n=this.getEditNode(_7a5);
try{
util.fire(n,"blur");
}
catch(e){
}
}});
Cell.markupFactory=function(node,_7a6){
_776.markupFactory(node,_7a6);
var _7a7=lang.trim(_76f.get(node,"keyFilter")||"");
if(_7a7){
_7a6.keyFilter=new RegExp(_7a7);
}
};
var _7a8=_76b("dojox.grid.cells.RowIndex",Cell,{name:"Row",postscript:function(){
this.editable=false;
},get:function(_7a9){
return _7a9+1;
}});
_7a8.markupFactory=function(node,_7aa){
Cell.markupFactory(node,_7aa);
};
var _7ab=_76b("dojox.grid.cells.Select",Cell,{options:null,values:null,returnIndex:-1,constructor:function(_7ac){
this.values=this.values||this.options;
},formatEditing:function(_7ad,_7ae){
this.needFormatNode(_7ad,_7ae);
var h=["<select class=\"dojoxGridSelect\">"];
for(var i=0,o,v;((o=this.options[i])!==undefined)&&((v=this.values[i])!==undefined);i++){
v=v.replace?v.replace(/&/g,"&amp;").replace(/</g,"&lt;"):v;
o=o.replace?o.replace(/&/g,"&amp;").replace(/</g,"&lt;"):o;
h.push("<option",(_7ad==v?" selected":"")," value=\""+v+"\"",">",o,"</option>");
}
h.push("</select>");
return h.join("");
},_defaultFormat:function(_7af,_7b0){
var v=this.inherited(arguments);
if(!this.formatter&&this.values&&this.options){
var i=_76e.indexOf(this.values,v);
if(i>=0){
v=this.options[i];
}
}
return v;
},getValue:function(_7b1){
var n=this.getEditNode(_7b1);
if(n){
var i=n.selectedIndex,o=n.options[i];
return this.returnIndex>-1?i:o.value||o.innerHTML;
}
}});
_7ab.markupFactory=function(node,cell){
Cell.markupFactory(node,cell);
var _7b2=lang.trim(_76f.get(node,"options")||"");
if(_7b2){
var o=_7b2.split(",");
if(o[0]!=_7b2){
cell.options=o;
}
}
var _7b3=lang.trim(_76f.get(node,"values")||"");
if(_7b3){
var v=_7b3.split(",");
if(v[0]!=_7b3){
cell.values=v;
}
}
};
var _7b4=_76b("dojox.grid.cells.AlwaysEdit",Cell,{alwaysEditing:true,_formatNode:function(_7b5,_7b6){
this.formatNode(this.getEditNode(_7b6),_7b5,_7b6);
},applyStaticValue:function(_7b7){
var e=this.grid.edit;
e.applyCellEdit(this.getValue(_7b7),this,_7b7);
e.start(this,_7b7,true);
}});
_7b4.markupFactory=function(node,cell){
Cell.markupFactory(node,cell);
};
var Bool=_76b("dojox.grid.cells.Bool",_7b4,{_valueProp:"checked",formatEditing:function(_7b8,_7b9){
return "<input class=\"dojoxGridInput\" type=\"checkbox\""+(_7b8?" checked=\"checked\"":"")+" style=\"width: auto\" />";
},doclick:function(e){
if(e.target.tagName=="INPUT"){
this.applyStaticValue(e.rowIndex);
}
}});
Bool.markupFactory=function(node,cell){
_7b4.markupFactory(node,cell);
};
return _776;
});
},"dijit/_WidgetBase":function(){
define(["require","dojo/_base/array","dojo/aspect","dojo/_base/config","dojo/_base/connect","dojo/_base/declare","dojo/dom","dojo/dom-attr","dojo/dom-class","dojo/dom-construct","dojo/dom-geometry","dojo/dom-style","dojo/has","dojo/_base/kernel","dojo/_base/lang","dojo/on","dojo/ready","dojo/Stateful","dojo/topic","dojo/_base/window","./Destroyable","./registry"],function(_7ba,_7bb,_7bc,_7bd,_7be,_7bf,dom,_7c0,_7c1,_7c2,_7c3,_7c4,has,_7c5,lang,on,_7c6,_7c7,_7c8,win,_7c9,_7ca){
has.add("dijit-legacy-requires",!_7c5.isAsync);
if(has("dijit-legacy-requires")){
_7c6(0,function(){
var _7cb=["dijit/_base/manager"];
_7ba(_7cb);
});
}
var _7cc={};
function _7cd(obj){
var ret={};
for(var attr in obj){
ret[attr.toLowerCase()]=true;
}
return ret;
};
function _7ce(attr){
return function(val){
_7c0[val?"set":"remove"](this.domNode,attr,val);
this._set(attr,val);
};
};
return _7bf("dijit._WidgetBase",[_7c7,_7c9],{id:"",_setIdAttr:"domNode",lang:"",_setLangAttr:_7ce("lang"),dir:"",_setDirAttr:_7ce("dir"),textDir:"","class":"",_setClassAttr:{node:"domNode",type:"class"},style:"",title:"",tooltip:"",baseClass:"",srcNodeRef:null,domNode:null,containerNode:null,ownerDocument:null,_setOwnerDocumentAttr:function(val){
this._set("ownerDocument",val);
},attributeMap:{},_blankGif:_7bd.blankGif||_7ba.toUrl("dojo/resources/blank.gif"),postscript:function(_7cf,_7d0){
this.create(_7cf,_7d0);
},create:function(_7d1,_7d2){
this.srcNodeRef=dom.byId(_7d2);
this._connects=[];
this._supportingWidgets=[];
if(this.srcNodeRef&&(typeof this.srcNodeRef.id=="string")){
this.id=this.srcNodeRef.id;
}
if(_7d1){
this.params=_7d1;
lang.mixin(this,_7d1);
}
this.postMixInProperties();
if(!this.id){
this.id=_7ca.getUniqueId(this.declaredClass.replace(/\./g,"_"));
if(this.params){
delete this.params.id;
}
}
this.ownerDocument=this.ownerDocument||(this.srcNodeRef?this.srcNodeRef.ownerDocument:win.doc);
this.ownerDocumentBody=win.body(this.ownerDocument);
_7ca.add(this);
this.buildRendering();
var _7d3;
if(this.domNode){
this._applyAttributes();
var _7d4=this.srcNodeRef;
if(_7d4&&_7d4.parentNode&&this.domNode!==_7d4){
_7d4.parentNode.replaceChild(this.domNode,_7d4);
_7d3=true;
}
this.domNode.setAttribute("widgetId",this.id);
}
this.postCreate();
if(_7d3){
delete this.srcNodeRef;
}
this._created=true;
},_applyAttributes:function(){
var ctor=this.constructor,list=ctor._setterAttrs;
if(!list){
list=(ctor._setterAttrs=[]);
for(var attr in this.attributeMap){
list.push(attr);
}
var _7d5=ctor.prototype;
for(var _7d6 in _7d5){
if(_7d6 in this.attributeMap){
continue;
}
var _7d7="_set"+_7d6.replace(/^[a-z]|-[a-zA-Z]/g,function(c){
return c.charAt(c.length-1).toUpperCase();
})+"Attr";
if(_7d7 in _7d5){
list.push(_7d6);
}
}
}
_7bb.forEach(list,function(attr){
if(this.params&&attr in this.params){
}else{
if(this[attr]){
this.set(attr,this[attr]);
}
}
},this);
for(var _7d8 in this.params){
this.set(_7d8,this.params[_7d8]);
}
},postMixInProperties:function(){
},buildRendering:function(){
if(!this.domNode){
this.domNode=this.srcNodeRef||this.ownerDocument.createElement("div");
}
if(this.baseClass){
var _7d9=this.baseClass.split(" ");
if(!this.isLeftToRight()){
_7d9=_7d9.concat(_7bb.map(_7d9,function(name){
return name+"Rtl";
}));
}
_7c1.add(this.domNode,_7d9);
}
},postCreate:function(){
},startup:function(){
if(this._started){
return;
}
this._started=true;
_7bb.forEach(this.getChildren(),function(obj){
if(!obj._started&&!obj._destroyed&&lang.isFunction(obj.startup)){
obj.startup();
obj._started=true;
}
});
},destroyRecursive:function(_7da){
this._beingDestroyed=true;
this.destroyDescendants(_7da);
this.destroy(_7da);
},destroy:function(_7db){
this._beingDestroyed=true;
this.uninitialize();
function _7dc(w){
if(w.destroyRecursive){
w.destroyRecursive(_7db);
}else{
if(w.destroy){
w.destroy(_7db);
}
}
};
_7bb.forEach(this._connects,lang.hitch(this,"disconnect"));
_7bb.forEach(this._supportingWidgets,_7dc);
if(this.domNode){
_7bb.forEach(_7ca.findWidgets(this.domNode,this.containerNode),_7dc);
}
this.destroyRendering(_7db);
_7ca.remove(this.id);
this._destroyed=true;
},destroyRendering:function(_7dd){
if(this.bgIframe){
this.bgIframe.destroy(_7dd);
delete this.bgIframe;
}
if(this.domNode){
if(_7dd){
_7c0.remove(this.domNode,"widgetId");
}else{
_7c2.destroy(this.domNode);
}
delete this.domNode;
}
if(this.srcNodeRef){
if(!_7dd){
_7c2.destroy(this.srcNodeRef);
}
delete this.srcNodeRef;
}
},destroyDescendants:function(_7de){
_7bb.forEach(this.getChildren(),function(_7df){
if(_7df.destroyRecursive){
_7df.destroyRecursive(_7de);
}
});
},uninitialize:function(){
return false;
},_setStyleAttr:function(_7e0){
var _7e1=this.domNode;
if(lang.isObject(_7e0)){
_7c4.set(_7e1,_7e0);
}else{
if(_7e1.style.cssText){
_7e1.style.cssText+="; "+_7e0;
}else{
_7e1.style.cssText=_7e0;
}
}
this._set("style",_7e0);
},_attrToDom:function(attr,_7e2,_7e3){
_7e3=arguments.length>=3?_7e3:this.attributeMap[attr];
_7bb.forEach(lang.isArray(_7e3)?_7e3:[_7e3],function(_7e4){
var _7e5=this[_7e4.node||_7e4||"domNode"];
var type=_7e4.type||"attribute";
switch(type){
case "attribute":
if(lang.isFunction(_7e2)){
_7e2=lang.hitch(this,_7e2);
}
var _7e6=_7e4.attribute?_7e4.attribute:(/^on[A-Z][a-zA-Z]*$/.test(attr)?attr.toLowerCase():attr);
if(_7e5.tagName){
_7c0.set(_7e5,_7e6,_7e2);
}else{
_7e5.set(_7e6,_7e2);
}
break;
case "innerText":
_7e5.innerHTML="";
_7e5.appendChild(this.ownerDocument.createTextNode(_7e2));
break;
case "innerHTML":
_7e5.innerHTML=_7e2;
break;
case "class":
_7c1.replace(_7e5,_7e2,this[attr]);
break;
}
},this);
},get:function(name){
var _7e7=this._getAttrNames(name);
return this[_7e7.g]?this[_7e7.g]():this[name];
},set:function(name,_7e8){
if(typeof name==="object"){
for(var x in name){
this.set(x,name[x]);
}
return this;
}
var _7e9=this._getAttrNames(name),_7ea=this[_7e9.s];
if(lang.isFunction(_7ea)){
var _7eb=_7ea.apply(this,Array.prototype.slice.call(arguments,1));
}else{
var _7ec=this.focusNode&&!lang.isFunction(this.focusNode)?"focusNode":"domNode",tag=this[_7ec].tagName,_7ed=_7cc[tag]||(_7cc[tag]=_7cd(this[_7ec])),map=name in this.attributeMap?this.attributeMap[name]:_7e9.s in this?this[_7e9.s]:((_7e9.l in _7ed&&typeof _7e8!="function")||/^aria-|^data-|^role$/.test(name))?_7ec:null;
if(map!=null){
this._attrToDom(name,_7e8,map);
}
this._set(name,_7e8);
}
return _7eb||this;
},_attrPairNames:{},_getAttrNames:function(name){
var apn=this._attrPairNames;
if(apn[name]){
return apn[name];
}
var uc=name.replace(/^[a-z]|-[a-zA-Z]/g,function(c){
return c.charAt(c.length-1).toUpperCase();
});
return (apn[name]={n:name+"Node",s:"_set"+uc+"Attr",g:"_get"+uc+"Attr",l:uc.toLowerCase()});
},_set:function(name,_7ee){
var _7ef=this[name];
this[name]=_7ee;
if(this._created&&_7ee!==_7ef){
if(this._watchCallbacks){
this._watchCallbacks(name,_7ef,_7ee);
}
this.emit("attrmodified-"+name,{detail:{prevValue:_7ef,newValue:_7ee}});
}
},emit:function(type,_7f0,_7f1){
_7f0=_7f0||{};
if(_7f0.bubbles===undefined){
_7f0.bubbles=true;
}
if(_7f0.cancelable===undefined){
_7f0.cancelable=true;
}
if(!_7f0.detail){
_7f0.detail={};
}
_7f0.detail.widget=this;
var ret,_7f2=this["on"+type];
if(_7f2){
ret=_7f2.apply(this,_7f1?_7f1:[_7f0]);
}
if(this._started&&!this._beingDestroyed){
on.emit(this.domNode,type.toLowerCase(),_7f0);
}
return ret;
},on:function(type,func){
var _7f3=this._onMap(type);
if(_7f3){
return _7bc.after(this,_7f3,func,true);
}
return this.own(on(this.domNode,type,func))[0];
},_onMap:function(type){
var ctor=this.constructor,map=ctor._onMap;
if(!map){
map=(ctor._onMap={});
for(var attr in ctor.prototype){
if(/^on/.test(attr)){
map[attr.replace(/^on/,"").toLowerCase()]=attr;
}
}
}
return map[typeof type=="string"&&type.toLowerCase()];
},toString:function(){
return "[Widget "+this.declaredClass+", "+(this.id||"NO ID")+"]";
},getChildren:function(){
return this.containerNode?_7ca.findWidgets(this.containerNode):[];
},getParent:function(){
return _7ca.getEnclosingWidget(this.domNode.parentNode);
},connect:function(obj,_7f4,_7f5){
return this.own(_7be.connect(obj,_7f4,this,_7f5))[0];
},disconnect:function(_7f6){
_7f6.remove();
},subscribe:function(t,_7f7){
return this.own(_7c8.subscribe(t,lang.hitch(this,_7f7)))[0];
},unsubscribe:function(_7f8){
_7f8.remove();
},isLeftToRight:function(){
return this.dir?(this.dir=="ltr"):_7c3.isBodyLtr(this.ownerDocument);
},isFocusable:function(){
return this.focus&&(_7c4.get(this.domNode,"display")!="none");
},placeAt:function(_7f9,_7fa){
var _7fb=!_7f9.tagName&&_7ca.byId(_7f9);
if(_7fb&&_7fb.addChild&&(!_7fa||typeof _7fa==="number")){
_7fb.addChild(this,_7fa);
}else{
var ref=_7fb?(_7fb.containerNode&&!/after|before|replace/.test(_7fa||"")?_7fb.containerNode:_7fb.domNode):dom.byId(_7f9,this.ownerDocument);
_7c2.place(this.domNode,ref,_7fa);
if(!this._started&&(this.getParent()||{})._started){
this.startup();
}
}
return this;
},getTextDir:function(text,_7fc){
return _7fc;
},applyTextDir:function(){
},defer:function(fcn,_7fd){
var _7fe=setTimeout(lang.hitch(this,function(){
_7fe=null;
if(!this._destroyed){
lang.hitch(this,fcn)();
}
}),_7fd||0);
return {remove:function(){
if(_7fe){
clearTimeout(_7fe);
_7fe=null;
}
return null;
}};
}});
});
},"dojo/dnd/Moveable":function(){
define(["../_base/array","../_base/declare","../_base/event","../_base/lang","../dom","../dom-class","../Evented","../on","../topic","../touch","./common","./Mover","../_base/window"],function(_7ff,_800,_801,lang,dom,_802,_803,on,_804,_805,dnd,_806,win){
var _807=_800("dojo.dnd.Moveable",[_803],{handle:"",delay:0,skip:false,constructor:function(node,_808){
this.node=dom.byId(node);
if(!_808){
_808={};
}
this.handle=_808.handle?dom.byId(_808.handle):null;
if(!this.handle){
this.handle=this.node;
}
this.delay=_808.delay>0?_808.delay:0;
this.skip=_808.skip;
this.mover=_808.mover?_808.mover:_806;
this.events=[on(this.handle,_805.press,lang.hitch(this,"onMouseDown")),on(this.handle,"dragstart",lang.hitch(this,"onSelectStart")),on(this.handle,"selectstart",lang.hitch(this,"onSelectStart"))];
},markupFactory:function(_809,node,Ctor){
return new Ctor(node,_809);
},destroy:function(){
_7ff.forEach(this.events,function(_80a){
_80a.remove();
});
this.events=this.node=this.handle=null;
},onMouseDown:function(e){
if(this.skip&&dnd.isFormElement(e)){
return;
}
if(this.delay){
this.events.push(on(this.handle,_805.move,lang.hitch(this,"onMouseMove")),on(this.handle,_805.release,lang.hitch(this,"onMouseUp")));
this._lastX=e.pageX;
this._lastY=e.pageY;
}else{
this.onDragDetected(e);
}
_801.stop(e);
},onMouseMove:function(e){
if(Math.abs(e.pageX-this._lastX)>this.delay||Math.abs(e.pageY-this._lastY)>this.delay){
this.onMouseUp(e);
this.onDragDetected(e);
}
_801.stop(e);
},onMouseUp:function(e){
for(var i=0;i<2;++i){
this.events.pop().remove();
}
_801.stop(e);
},onSelectStart:function(e){
if(!this.skip||!dnd.isFormElement(e)){
_801.stop(e);
}
},onDragDetected:function(e){
new this.mover(this.node,e,this);
},onMoveStart:function(_80b){
_804.publish("/dnd/move/start",_80b);
_802.add(win.body(),"dojoMove");
_802.add(this.node,"dojoMoveItem");
},onMoveStop:function(_80c){
_804.publish("/dnd/move/stop",_80c);
_802.remove(win.body(),"dojoMove");
_802.remove(this.node,"dojoMoveItem");
},onFirstMove:function(){
},onMove:function(_80d,_80e){
this.onMoving(_80d,_80e);
var s=_80d.node.style;
s.left=_80e.l+"px";
s.top=_80e.t+"px";
this.onMoved(_80d,_80e);
},onMoving:function(){
},onMoved:function(){
}});
return _807;
});
},"*now":function(r){
r(["dojo/i18n!*preload*dojox/grid/nls/DataGrid*[\"ar\",\"ca\",\"cs\",\"da\",\"de\",\"el\",\"en-gb\",\"en-us\",\"es-es\",\"fi-fi\",\"fr-fr\",\"he-il\",\"hu\",\"it-it\",\"ja-jp\",\"ko-kr\",\"nl-nl\",\"nb\",\"pl\",\"pt-br\",\"pt-pt\",\"ru\",\"sk\",\"sl\",\"sv\",\"th\",\"tr\",\"zh-tw\",\"zh-cn\",\"ROOT\"]"]);
}}});
define("dojox/grid/DataGrid",["../main","dojo/_base/array","dojo/_base/lang","dojo/_base/json","dojo/_base/sniff","dojo/_base/declare","./_Grid","./DataSelection","dojo/_base/html"],function(_80f,_810,lang,json,has,_811,_812,_813,html){
var _814=_811("dojox.grid.DataGrid",_812,{store:null,query:null,queryOptions:null,fetchText:"...",sortFields:null,updateDelay:1,items:null,_store_connects:null,_by_idty:null,_by_idx:null,_cache:null,_pages:null,_pending_requests:null,_bop:-1,_eop:-1,_requests:0,rowCount:0,_isLoaded:false,_isLoading:false,keepSelection:false,postCreate:function(){
this._pages=[];
this._store_connects=[];
this._by_idty={};
this._by_idx=[];
this._cache=[];
this._pending_requests={};
this._setStore(this.store);
this.inherited(arguments);
},destroy:function(){
this.selection.destroy();
this.inherited(arguments);
},createSelection:function(){
this.selection=new _813(this);
},get:function(_815,_816){
if(_816&&this.field=="_item"&&!this.fields){
return _816;
}else{
if(_816&&this.fields){
var ret=[];
var s=this.grid.store;
_810.forEach(this.fields,function(f){
ret=ret.concat(s.getValues(_816,f));
});
return ret;
}else{
if(!_816&&typeof _815==="string"){
return this.inherited(arguments);
}
}
}
return (!_816?this.defaultValue:(!this.field?this.value:(this.field=="_item"?_816:this.grid.store.getValue(_816,this.field))));
},_checkUpdateStatus:function(){
if(this.updateDelay>0){
var _817=false;
if(this._endUpdateDelay){
clearTimeout(this._endUpdateDelay);
delete this._endUpdateDelay;
_817=true;
}
if(!this.updating){
this.beginUpdate();
_817=true;
}
if(_817){
var _818=this;
this._endUpdateDelay=setTimeout(function(){
delete _818._endUpdateDelay;
_818.endUpdate();
},this.updateDelay);
}
}
},_onSet:function(item,_819,_81a,_81b){
this._checkUpdateStatus();
var idx=this.getItemIndex(item);
if(idx>-1){
this.updateRow(idx);
}
},_createItem:function(item,_81c){
var idty=this._hasIdentity?this.store.getIdentity(item):json.toJson(this.query)+":idx:"+_81c+":sort:"+json.toJson(this.getSortProps());
var o=this._by_idty[idty]={idty:idty,item:item};
return o;
},_addItem:function(item,_81d,_81e){
this._by_idx[_81d]=this._createItem(item,_81d);
if(!_81e){
this.updateRow(_81d);
}
},_onNew:function(item,_81f){
this._checkUpdateStatus();
var _820=this.get("rowCount");
this._addingItem=true;
this.updateRowCount(_820+1);
this._addingItem=false;
this._addItem(item,_820);
this.showMessage();
},_onDelete:function(item){
this._checkUpdateStatus();
var idx=this._getItemIndex(item,true);
if(idx>=0){
this._pages=[];
this._bop=-1;
this._eop=-1;
var o=this._by_idx[idx];
this._by_idx.splice(idx,1);
delete this._by_idty[o.idty];
this.updateRowCount(this.get("rowCount")-1);
if(this.get("rowCount")===0){
this.showMessage(this.noDataMessage);
}
}
if(this.selection.isSelected(idx)){
this.selection.deselect(idx);
this.selection.selected.splice(idx,1);
}
},_onRevert:function(){
this._refresh();
},setStore:function(_821,_822,_823){
if(this._requestsPending(0)){
return;
}
this._setQuery(_822,_823);
this._setStore(_821);
this._refresh(true);
},setQuery:function(_824,_825){
if(this._requestsPending(0)){
return;
}
this._setQuery(_824,_825);
this._refresh(true);
},setItems:function(_826){
this.items=_826;
this._setStore(this.store);
this._refresh(true);
},_setQuery:function(_827,_828){
this.query=_827;
this.queryOptions=_828||this.queryOptions;
},_setStore:function(_829){
if(this.store&&this._store_connects){
_810.forEach(this._store_connects,this.disconnect,this);
}
this.store=_829;
if(this.store){
var f=this.store.getFeatures();
var h=[];
this._canEdit=!!f["dojo.data.api.Write"]&&!!f["dojo.data.api.Identity"];
this._hasIdentity=!!f["dojo.data.api.Identity"];
if(!!f["dojo.data.api.Notification"]&&!this.items){
h.push(this.connect(this.store,"onSet","_onSet"));
h.push(this.connect(this.store,"onNew","_onNew"));
h.push(this.connect(this.store,"onDelete","_onDelete"));
}
if(this._canEdit){
h.push(this.connect(this.store,"revert","_onRevert"));
}
this._store_connects=h;
}
},_onFetchBegin:function(size,req){
if(!this.scroller){
return;
}
if(this.rowCount!=size){
if(req.isRender){
this.scroller.init(size,this.keepRows,this.rowsPerPage);
this.rowCount=size;
this._setAutoHeightAttr(this.autoHeight,true);
this._skipRowRenormalize=true;
this.prerender();
this._skipRowRenormalize=false;
}else{
this.updateRowCount(size);
}
}
if(!size){
this.views.render();
this._resize();
this.showMessage(this.noDataMessage);
this.focus.initFocusView();
}else{
this.showMessage();
}
},_onFetchComplete:function(_82a,req){
if(!this.scroller){
return;
}
if(_82a&&_82a.length>0){
_810.forEach(_82a,function(item,idx){
this._addItem(item,req.start+idx,true);
},this);
this.updateRows(req.start,_82a.length);
if(req.isRender){
this.setScrollTop(0);
this.postrender();
}else{
if(this._lastScrollTop){
this.setScrollTop(this._lastScrollTop);
}
}
if(has("ie")){
html.setSelectable(this.domNode,this.selectable);
}
}
delete this._lastScrollTop;
if(!this._isLoaded){
this._isLoading=false;
this._isLoaded=true;
}
this._pending_requests[req.start]=false;
},_onFetchError:function(err,req){
delete this._lastScrollTop;
if(!this._isLoaded){
this._isLoading=false;
this._isLoaded=true;
this.showMessage(this.errorMessage);
}
this._pending_requests[req.start]=false;
this.onFetchError(err,req);
},onFetchError:function(err,req){
},_fetch:function(_82b,_82c){
_82b=_82b||0;
if(this.store&&!this._pending_requests[_82b]){
if(!this._isLoaded&&!this._isLoading){
this._isLoading=true;
this.showMessage(this.loadingMessage);
}
this._pending_requests[_82b]=true;
try{
if(this.items){
var _82d=this.items;
var _82e=this.store;
this.rowsPerPage=_82d.length;
var req={start:_82b,count:this.rowsPerPage,isRender:_82c};
this._onFetchBegin(_82d.length,req);
var _82f=0;
_810.forEach(_82d,function(i){
if(!_82e.isItemLoaded(i)){
_82f++;
}
});
if(_82f===0){
this._onFetchComplete(_82d,req);
}else{
var _830=function(item){
_82f--;
if(_82f===0){
this._onFetchComplete(_82d,req);
}
};
_810.forEach(_82d,function(i){
if(!_82e.isItemLoaded(i)){
_82e.loadItem({item:i,onItem:_830,scope:this});
}
},this);
}
}else{
this.store.fetch({start:_82b,count:this.rowsPerPage,query:this.query,sort:this.getSortProps(),queryOptions:this.queryOptions,isRender:_82c,onBegin:lang.hitch(this,"_onFetchBegin"),onComplete:lang.hitch(this,"_onFetchComplete"),onError:lang.hitch(this,"_onFetchError")});
}
}
catch(e){
this._onFetchError(e,{start:_82b,count:this.rowsPerPage});
}
}
},_clearData:function(){
this.updateRowCount(0);
this._by_idty={};
this._by_idx=[];
this._pages=[];
this._bop=this._eop=-1;
this._isLoaded=false;
this._isLoading=false;
},getItem:function(idx){
var data=this._by_idx[idx];
if(!data||(data&&!data.item)){
this._preparePage(idx);
return null;
}
return data.item;
},getItemIndex:function(item){
return this._getItemIndex(item,false);
},_getItemIndex:function(item,_831){
if(!_831&&!this.store.isItem(item)){
return -1;
}
var idty=this._hasIdentity?this.store.getIdentity(item):null;
for(var i=0,l=this._by_idx.length;i<l;i++){
var d=this._by_idx[i];
if(d&&((idty&&d.idty==idty)||(d.item===item))){
return i;
}
}
return -1;
},filter:function(_832,_833){
this.query=_832;
if(_833){
this._clearData();
}
this._fetch();
},_getItemAttr:function(idx,attr){
var item=this.getItem(idx);
return (!item?this.fetchText:this.store.getValue(item,attr));
},_render:function(){
if(this.domNode.parentNode){
this.scroller.init(this.get("rowCount"),this.keepRows,this.rowsPerPage);
this.prerender();
this._fetch(0,true);
}
},_requestsPending:function(_834){
return this._pending_requests[_834];
},_rowToPage:function(_835){
return (this.rowsPerPage?Math.floor(_835/this.rowsPerPage):_835);
},_pageToRow:function(_836){
return (this.rowsPerPage?this.rowsPerPage*_836:_836);
},_preparePage:function(_837){
if((_837<this._bop||_837>=this._eop)&&!this._addingItem){
var _838=this._rowToPage(_837);
this._needPage(_838);
this._bop=_838*this.rowsPerPage;
this._eop=this._bop+(this.rowsPerPage||this.get("rowCount"));
}
},_needPage:function(_839){
if(!this._pages[_839]){
this._pages[_839]=true;
this._requestPage(_839);
}
},_requestPage:function(_83a){
var row=this._pageToRow(_83a);
var _83b=Math.min(this.rowsPerPage,this.get("rowCount")-row);
if(_83b>0){
this._requests++;
if(!this._requestsPending(row)){
setTimeout(lang.hitch(this,"_fetch",row,false),1);
}
}
},getCellName:function(_83c){
return _83c.field;
},_refresh:function(_83d){
this._clearData();
this._fetch(0,_83d);
},sort:function(){
this.edit.apply();
this._lastScrollTop=this.scrollTop;
this._refresh();
},canSort:function(){
return (!this._isLoading);
},getSortProps:function(){
var c=this.getCell(this.getSortIndex());
if(!c){
if(this.sortFields){
return this.sortFields;
}
return null;
}else{
var desc=c["sortDesc"];
var si=!(this.sortInfo>0);
if(typeof desc=="undefined"){
desc=si;
}else{
desc=si?!desc:desc;
}
return [{attribute:c.field,descending:desc}];
}
},styleRowState:function(_83e){
if(this.store&&this.store.getState){
var _83f=this.store.getState(_83e.index),c="";
for(var i=0,ss=["inflight","error","inserting"],s;s=ss[i];i++){
if(_83f[s]){
c=" dojoxGridRow-"+s;
break;
}
}
_83e.customClasses+=c;
}
},onStyleRow:function(_840){
this.styleRowState(_840);
this.inherited(arguments);
},canEdit:function(_841,_842){
return this._canEdit;
},_copyAttr:function(idx,attr){
var row={};
var _843={};
var src=this.getItem(idx);
return this.store.getValue(src,attr);
},doStartEdit:function(_844,_845){
if(!this._cache[_845]){
this._cache[_845]=this._copyAttr(_845,_844.field);
}
this.onStartEdit(_844,_845);
},doApplyCellEdit:function(_846,_847,_848){
this.store.fetchItemByIdentity({identity:this._by_idx[_847].idty,onItem:lang.hitch(this,function(item){
var _849=this.store.getValue(item,_848);
if(typeof _849=="number"){
_846=isNaN(_846)?_846:parseFloat(_846);
}else{
if(typeof _849=="boolean"){
_846=_846=="true"?true:_846=="false"?false:_846;
}else{
if(_849 instanceof Date){
var _84a=new Date(_846);
_846=isNaN(_84a.getTime())?_846:_84a;
}
}
}
this.store.setValue(item,_848,_846);
this.onApplyCellEdit(_846,_847,_848);
})});
},doCancelEdit:function(_84b){
var _84c=this._cache[_84b];
if(_84c){
this.updateRow(_84b);
delete this._cache[_84b];
}
this.onCancelEdit.apply(this,arguments);
},doApplyEdit:function(_84d,_84e){
var _84f=this._cache[_84d];
this.onApplyEdit(_84d);
},removeSelectedRows:function(){
if(this._canEdit){
this.edit.apply();
var fx=lang.hitch(this,function(_850){
if(_850.length){
_810.forEach(_850,this.store.deleteItem,this.store);
this.selection.clear();
}
});
if(this.allItemsSelected){
this.store.fetch({query:this.query,queryOptions:this.queryOptions,onComplete:fx});
}else{
fx(this.selection.getSelected());
}
}
}});
_814.cell_markupFactory=function(_851,node,_852){
var _853=lang.trim(html.attr(node,"field")||"");
if(_853){
_852.field=_853;
}
_852.field=_852.field||_852.name;
var _854=lang.trim(html.attr(node,"fields")||"");
if(_854){
_852.fields=_854.split(",");
}
if(_851){
_851(node,_852);
}
};
_814.markupFactory=function(_855,node,ctor,_856){
return _812.markupFactory(_855,node,ctor,lang.partial(_814.cell_markupFactory,_856));
};
return _814;
});
},"dojo/data/util/sorter":function(){
define("dojo/data/util/sorter",["../../_base/lang"],function(lang){
var _857={};
lang.setObject("dojo.data.util.sorter",_857);
_857.basicComparator=function(a,b){
var r=-1;
if(a===null){
a=undefined;
}
if(b===null){
b=undefined;
}
if(a==b){
r=0;
}else{
if(a>b||a==null){
r=1;
}
}
return r;
};
_857.createSortFunction=function(_858,_859){
var _85a=[];
function _85b(attr,dir,comp,s){
return function(_85c,_85d){
var a=s.getValue(_85c,attr);
var b=s.getValue(_85d,attr);
return dir*comp(a,b);
};
};
var _85e;
var map=_859.comparatorMap;
var bc=_857.basicComparator;
for(var i=0;i<_858.length;i++){
_85e=_858[i];
var attr=_85e.attribute;
if(attr){
var dir=(_85e.descending)?-1:1;
var comp=bc;
if(map){
if(typeof attr!=="string"&&("toString" in attr)){
attr=attr.toString();
}
comp=map[attr]||bc;
}
_85a.push(_85b(attr,dir,comp,_859));
}
}
return function(rowA,rowB){
var i=0;
while(i<_85a.length){
var ret=_85a[i++](rowA,rowB);
if(ret!==0){
return ret;
}
}
return 0;
};
};
return _857;
});
},"davinci/model/Comment":function(){
define(["dojo/_base/declare","davinci/model/Model"],function(_85f,_860){
return _85f("davinci.model.Comment",_860,{constructor:function(){
this.elementType="Comment";
this.nosemicolon=true;
},addComment:function(type,_861,stop,text){
if(this.comments==null){
this.comments=[];
}
this.comments[this.comments.length]={commentType:type,start:_861,stop:stop,s:text};
},appendComment:function(text){
var _862=this.comments[this.comments.length-1];
_862.s+=text;
_862.stop+=text.length;
},getText:function(_863){
var s="";
for(var i=0;i<this.comments.length;i++){
if(this.comments[i].commentType=="line"){
s+="//"+this.comments[i].s+"\n";
}else{
if(this.comments[i].commentType=="block"){
s+="/*"+this.comments[i].s+"*/\n";
}
}
}
return s;
}});
});
},"url:dijit/layout/templates/ScrollingTabController.html":"<div class=\"dijitTabListContainer-${tabPosition}\" style=\"visibility:hidden\">\n\t<div data-dojo-type=\"dijit.layout._ScrollingTabControllerMenuButton\"\n\t\t\tclass=\"tabStripButton-${tabPosition}\"\n\t\t\tid=\"${id}_menuBtn\"\n\t\t\tdata-dojo-props=\"containerId: '${containerId}', iconClass: 'dijitTabStripMenuIcon',\n\t\t\t\t\tdropDownPosition: ['below-alt', 'above-alt']\"\n\t\t\tdata-dojo-attach-point=\"_menuBtn\" showLabel=\"false\" title=\"\">&#9660;</div>\n\t<div data-dojo-type=\"dijit.layout._ScrollingTabControllerButton\"\n\t\t\tclass=\"tabStripButton-${tabPosition}\"\n\t\t\tid=\"${id}_leftBtn\"\n\t\t\tdata-dojo-props=\"iconClass:'dijitTabStripSlideLeftIcon', showLabel:false, title:''\"\n\t\t\tdata-dojo-attach-point=\"_leftBtn\" data-dojo-attach-event=\"onClick: doSlideLeft\">&#9664;</div>\n\t<div data-dojo-type=\"dijit.layout._ScrollingTabControllerButton\"\n\t\t\tclass=\"tabStripButton-${tabPosition}\"\n\t\t\tid=\"${id}_rightBtn\"\n\t\t\tdata-dojo-props=\"iconClass:'dijitTabStripSlideRightIcon', showLabel:false, title:''\"\n\t\t\tdata-dojo-attach-point=\"_rightBtn\" data-dojo-attach-event=\"onClick: doSlideRight\">&#9654;</div>\n\t<div class='dijitTabListWrapper' data-dojo-attach-point='tablistWrapper'>\n\t\t<div role='tablist' data-dojo-attach-event='onkeypress:onkeypress'\n\t\t\t\tdata-dojo-attach-point='containerNode' class='nowrapTabStrip'></div>\n\t</div>\n</div>","davinci/review/actions/CloseVersionAction":function(){
define("davinci/review/actions/CloseVersionAction",["dojo/_base/declare","./_ReviewNavigatorCommon","davinci/Runtime","dojox/widget/Toaster","dojo/i18n!./nls/actions"],function(_864,_865,_866,_867,nls){
var _868=_864("davinci.review.actions.CloseVersionAction",[_865],{run:function(_869){
var _86a=this._getSelection(_869);
if(!_86a||!_86a.length){
return;
}
okToClose=confirm(nls.areYouSureClose);
if(!okToClose){
return;
}
var item=_86a[0].resource.elementType=="ReviewFile"?_86a[0].resource.parent:_86a[0].resource;
dojo.xhrGet({url:"cmd/managerVersion",sync:false,handleAs:"text",content:{"type":"close","vTime":item.timeStamp}}).then(function(_86b){
if(_86b=="OK"){
if(typeof hasToaster=="undefined"){
new _867({position:"br-left",duration:4000,messageTopic:"/davinci/review/resourceChanged"});
hasToaster=true;
}
dojo.publish("/davinci/review/resourceChanged",[{message:nls.closeSuccessful,type:"message"},"closed",item]);
}
});
},isEnabled:function(_86c){
var _86d=this._getSelection(_86c);
if(!_86d||_86d.length==0){
return false;
}
var item=_86d[0].resource.elementType=="ReviewFile"?_86d[0].resource.parent:_86d[0].resource;
if(item.designerId==davinci.Runtime.userName){
if(!item.closed&&!item.isDraft){
return true;
}
}
return false;
}});
return _868;
});
},"davinci/ve/commands/AddCommand":function(){
define(["dojo/_base/declare","davinci/ve/widget","davinci/ve/utils/ImageUtils","davinci/ve/States"],function(_86e,_86f,_870,_871){
return _86e("davinci.ve.commands.AddCommand",null,{name:"add",constructor:function(_872,_873,_874){
if(_872){
if(_872.domNode){
this._id=_872.id;
}else{
this._data=_872;
}
}
this._parentId=_873.id;
this._index=_874;
},execute:function(){
var _875=_86f.byId(this._parentId);
if(!_875){
return;
}
var _876=_875.getContext();
var _877=undefined;
if(this._data){
if(this._id&&this._data.properties){
this._data.properties.id=this._id;
}
_877=_86f.createWidget(this._data);
this._id=_877.id;
}else{
if(this._id){
_877=_86f.byId(this._id,_876);
}
}
if(!_877){
return;
}
this._data=_877.getData();
this._data.properties.id=this._id;
this._data.context=_876;
if(this._index&&typeof this._index!="number"){
if(this._index.domNode){
this._index=_875.indexOf(this._index);
}else{
var w=_86f.byId(this._index.id,_876);
this._index=_875.indexOf(w);
}
}
if(_877.domNode.tagName==="IMG"){
_870.ImageUpdateFocus(_877,_876);
}
_875.addChild(_877,this._index);
if(_876){
_876.attach(_877);
_877.startup();
_877.renderWidget();
_876.widgetAddedOrDeleted();
_876.widgetChanged(_876.WIDGET_ADDED,_877);
}
_871.resetState(_877.domNode);
},undo:function(){
if(!this._id||!this._parentId){
return;
}
var _878=_86f.byId(this._id);
if(!_878){
return;
}
var _879=_86f.byId(this._parentId);
if(!_879){
return;
}
var _87a=_878.getContext();
if(_87a){
_87a.detach(_878);
_87a.deselect(_878);
}
_879.removeChild(_878);
_87a.widgetChanged(_87a.WIDGET_REMOVED,_878);
_878.destroyWidget();
if(_87a){
_87a.widgetAddedOrDeleted();
}
_871.resetState(_878.domNode);
}});
});
},"davinci/ve/actions/_CutCopyAction":function(){
define(["dojo/_base/declare","davinci/Workbench","davinci/ve/actions/ContextAction","davinci/commands/CompoundCommand","davinci/ve/commands/RemoveCommand","davinci/ve/widget"],function(_87b,_87c,_87d,_87e,_87f,_880){
return _87b("davinci.ve.actions.CutAction",[_87d],{run:function(_881){
_881=this.fixupContext(_881);
if(_881){
if(_881.declaredClass=="davinci.ve.PageEditor"&&_881._displayMode=="source"){
this._invokeSourceEditorAction(_881);
return;
}
var _882=this._normalizeSelection(_881);
if(_882.length>0){
var _883=new _87e();
var data=[];
var _884=_881.reorderPreserveSiblingOrder(_882);
dojo.forEach(_884,function(w){
var d=w.getData({identify:false});
if(d){
data.push(d);
}
var _885=w.getHelper();
var c;
if(_885&&_885.getRemoveCommand){
c=_885.getRemoveCommand(w);
if(c.name==="compound"){
var _886=[];
var _887=c._commands;
for(var i=_887.length-1;i>0;i--){
var _888=_887[i];
if(_888.name==="remove"){
var _889=_880.byId(_888._id);
var _88a=_889.getData({identify:false});
_886.push(_88a);
}
}
d.associatedCopiedWidgetData=_886;
}
}else{
c=new _87f(w);
}
_883.add(c);
});
this._executeAction(_881,_882,data,_883);
}
}
},isEnabled:function(_88b){
_88b=this.fixupContext(_88b);
var e=_87c.getOpenEditor();
if(e&&_88b){
var _88c=(_88b.getSelection().length>0);
if(e.declaredClass=="davinci.ve.PageEditor"){
var _88d=e.getDisplayMode();
return _88c&&_88d!="source";
}else{
return _88c;
}
}else{
return false;
}
},shouldShow:function(_88e){
_88e=this.fixupContext(_88e);
var _88f=_88e?_88e.editor:null;
return (_88f&&_88f.declaredClass=="davinci.ve.PageEditor");
},_invokeSourceEditorAction:function(_890){
},_executeAction:function(_891,_892,data,_893){
}});
});
},"dijit/layout/ContentPane":function(){
define("dijit/layout/ContentPane",["dojo/_base/kernel","dojo/_base/lang","../_Widget","../_Container","./_ContentPaneResizeMixin","dojo/string","dojo/html","dojo/i18n!../nls/loading","dojo/_base/array","dojo/_base/declare","dojo/_base/Deferred","dojo/dom","dojo/dom-attr","dojo/_base/xhr","dojo/i18n","dojo/when"],function(_894,lang,_895,_896,_897,_898,html,_899,_89a,_89b,_89c,dom,_89d,xhr,i18n,when){
return _89b("dijit.layout.ContentPane",[_895,_896,_897],{href:"",content:"",extractContent:false,parseOnLoad:true,parserScope:_894._scopeName,preventCache:false,preload:false,refreshOnShow:false,loadingMessage:"<span class='dijitContentPaneLoading'><span class='dijitInline dijitIconLoading'></span>${loadingState}</span>",errorMessage:"<span class='dijitContentPaneError'><span class='dijitInline dijitIconError'></span>${errorState}</span>",isLoaded:false,baseClass:"dijitContentPane",ioArgs:{},onLoadDeferred:null,_setTitleAttr:null,stopParser:true,template:false,create:function(_89e,_89f){
if((!_89e||!_89e.template)&&_89f&&!("href" in _89e)&&!("content" in _89e)){
_89f=dom.byId(_89f);
var df=_89f.ownerDocument.createDocumentFragment();
while(_89f.firstChild){
df.appendChild(_89f.firstChild);
}
_89e=lang.delegate(_89e,{content:df});
}
this.inherited(arguments,[_89e,_89f]);
},postMixInProperties:function(){
this.inherited(arguments);
var _8a0=i18n.getLocalization("dijit","loading",this.lang);
this.loadingMessage=_898.substitute(this.loadingMessage,_8a0);
this.errorMessage=_898.substitute(this.errorMessage,_8a0);
},buildRendering:function(){
this.inherited(arguments);
if(!this.containerNode){
this.containerNode=this.domNode;
}
this.domNode.title="";
if(!_89d.get(this.domNode,"role")){
this.domNode.setAttribute("role","group");
}
},startup:function(){
this.inherited(arguments);
if(this._contentSetter){
_89a.forEach(this._contentSetter.parseResults,function(obj){
if(!obj._started&&!obj._destroyed&&lang.isFunction(obj.startup)){
obj.startup();
obj._started=true;
}
},this);
}
},_startChildren:function(){
_89a.forEach(this.getChildren(),function(obj){
if(!obj._started&&!obj._destroyed&&lang.isFunction(obj.startup)){
obj.startup();
obj._started=true;
}
});
if(this._contentSetter){
_89a.forEach(this._contentSetter.parseResults,function(obj){
if(!obj._started&&!obj._destroyed&&lang.isFunction(obj.startup)){
obj.startup();
obj._started=true;
}
},this);
}
},setHref:function(href){
_894.deprecated("dijit.layout.ContentPane.setHref() is deprecated. Use set('href', ...) instead.","","2.0");
return this.set("href",href);
},_setHrefAttr:function(href){
this.cancel();
this.onLoadDeferred=new _89c(lang.hitch(this,"cancel"));
this.onLoadDeferred.then(lang.hitch(this,"onLoad"));
this._set("href",href);
if(this.preload||(this._created&&this._isShown())){
this._load();
}else{
this._hrefChanged=true;
}
return this.onLoadDeferred;
},setContent:function(data){
_894.deprecated("dijit.layout.ContentPane.setContent() is deprecated.  Use set('content', ...) instead.","","2.0");
this.set("content",data);
},_setContentAttr:function(data){
this._set("href","");
this.cancel();
this.onLoadDeferred=new _89c(lang.hitch(this,"cancel"));
if(this._created){
this.onLoadDeferred.then(lang.hitch(this,"onLoad"));
}
this._setContent(data||"");
this._isDownloaded=false;
return this.onLoadDeferred;
},_getContentAttr:function(){
return this.containerNode.innerHTML;
},cancel:function(){
if(this._xhrDfd&&(this._xhrDfd.fired==-1)){
this._xhrDfd.cancel();
}
delete this._xhrDfd;
this.onLoadDeferred=null;
},destroy:function(){
this.cancel();
this.inherited(arguments);
},destroyRecursive:function(_8a1){
if(this._beingDestroyed){
return;
}
this.inherited(arguments);
},_onShow:function(){
this.inherited(arguments);
if(this.href){
if(!this._xhrDfd&&(!this.isLoaded||this._hrefChanged||this.refreshOnShow)){
return this.refresh();
}
}
},refresh:function(){
this.cancel();
this.onLoadDeferred=new _89c(lang.hitch(this,"cancel"));
this.onLoadDeferred.then(lang.hitch(this,"onLoad"));
this._load();
return this.onLoadDeferred;
},_load:function(){
this._setContent(this.onDownloadStart(),true);
var self=this;
var _8a2={preventCache:(this.preventCache||this.refreshOnShow),url:this.href,handleAs:"text"};
if(lang.isObject(this.ioArgs)){
lang.mixin(_8a2,this.ioArgs);
}
var hand=(this._xhrDfd=(this.ioMethod||xhr.get)(_8a2)),_8a3;
hand.then(function(html){
_8a3=html;
try{
self._isDownloaded=true;
return self._setContent(html,false);
}
catch(err){
self._onError("Content",err);
}
},function(err){
if(!hand.canceled){
self._onError("Download",err);
}
delete self._xhrDfd;
return err;
}).then(function(){
self.onDownloadEnd();
delete self._xhrDfd;
return _8a3;
});
delete this._hrefChanged;
},_onLoadHandler:function(data){
this._set("isLoaded",true);
try{
this.onLoadDeferred.resolve(data);
}
catch(e){
console.error("Error "+this.widgetId+" running custom onLoad code: "+e.message);
}
},_onUnloadHandler:function(){
this._set("isLoaded",false);
try{
this.onUnload();
}
catch(e){
console.error("Error "+this.widgetId+" running custom onUnload code: "+e.message);
}
},destroyDescendants:function(_8a4){
if(this.isLoaded){
this._onUnloadHandler();
}
var _8a5=this._contentSetter;
_89a.forEach(this.getChildren(),function(_8a6){
if(_8a6.destroyRecursive){
_8a6.destroyRecursive(_8a4);
}else{
if(_8a6.destroy){
_8a6.destroy(_8a4);
}
}
_8a6._destroyed=true;
});
if(_8a5){
_89a.forEach(_8a5.parseResults,function(_8a7){
if(!_8a7._destroyed){
if(_8a7.destroyRecursive){
_8a7.destroyRecursive(_8a4);
}else{
if(_8a7.destroy){
_8a7.destroy(_8a4);
}
}
_8a7._destroyed=true;
}
});
delete _8a5.parseResults;
}
if(!_8a4){
html._emptyNode(this.containerNode);
}
delete this._singleChild;
},_setContent:function(cont,_8a8){
this.destroyDescendants();
var _8a9=this._contentSetter;
if(!(_8a9&&_8a9 instanceof html._ContentSetter)){
_8a9=this._contentSetter=new html._ContentSetter({node:this.containerNode,_onError:lang.hitch(this,this._onError),onContentError:lang.hitch(this,function(e){
var _8aa=this.onContentError(e);
try{
this.containerNode.innerHTML=_8aa;
}
catch(e){
console.error("Fatal "+this.id+" could not change content due to "+e.message,e);
}
})});
}
var _8ab=lang.mixin({cleanContent:this.cleanContent,extractContent:this.extractContent,parseContent:!cont.domNode&&this.parseOnLoad,parserScope:this.parserScope,startup:false,dir:this.dir,lang:this.lang,textDir:this.textDir},this._contentSetterParams||{});
var p=_8a9.set((lang.isObject(cont)&&cont.domNode)?cont.domNode:cont,_8ab);
var self=this;
return when(p&&p.then?p:_8a9.parseDeferred,function(){
delete self._contentSetterParams;
if(!_8a8){
if(self._started){
self._startChildren();
self._scheduleLayout();
}
self._onLoadHandler(cont);
}
});
},_onError:function(type,err,_8ac){
this.onLoadDeferred.reject(err);
var _8ad=this["on"+type+"Error"].call(this,err);
if(_8ac){
console.error(_8ac,err);
}else{
if(_8ad){
this._setContent(_8ad,true);
}
}
},onLoad:function(){
},onUnload:function(){
},onDownloadStart:function(){
return this.loadingMessage;
},onContentError:function(){
},onDownloadError:function(){
return this.errorMessage;
},onDownloadEnd:function(){
}});
});
},"davinci/js/JSElement":function(){
define(["dojo/_base/declare","davinci/js/JSModel"],function(_8ae,_8af){
var _8b0=null;
var _8b1=null;
return _8ae("davinci.js.JSElement",_8af,{constructor:function(){
this.elementType="JSElement";
if(_8b0!==null){
this.comment=_8b0;
_8b0=null;
}
if(_8b1!==null){
this.label=_8b1;
_8b1=null;
}
},printNewLine:function(_8b2){
var s="\n";
for(var i=0;i<_8b2.indent;i++){
s=s+" ";
}
return s;
},printStatement:function(_8b3,stmt){
return this.printNewLine(_8b3)+stmt.getText(_8b3)+(stmt.nosemicolon?"":";");
},add:function(e){
this.addChild(e);
},init:function(_8b4,stop,name){
},getLabel:function(){
context={};
context.indent=0;
return this.getText(context);
},getID:function(){
return this.parent.getID()+":"+this.startLine+":"+this.getLabel();
},getSyntaxPositions:function(_8b5){
var _8b6=[];
function add(line,col,_8b7,type){
if((typeof _8b5=="undefined")||_8b5==line){
_8b6.push({line:line,col:col,length:_8b7,type:type});
}
};
function add2(pos,_8b8,type){
if((typeof _8b5=="undefined")||_8b5==pos[0]){
_8b6.push({line:pos[0],col:pos[1],length:_8b8,type:type});
}
};
var _8b9={visit:function(node){
if(node.elementType=="JSFunction"){
add(node.startLine,node.startCol,8,"keyword");
add2(node.leftParenPos,1,"delimiter");
add2(node.rightParenPos,1,"delimiter");
add2(node.leftBracePos,1,"delimiter");
add2(node.rightBracePos,1,"delimiter");
}else{
if(node.elementType=="JSVariableDeclaration"){
add(node.startLine,node.startCol,3,"keyword");
}else{
if(node.elementType=="JSVariableFragment"){
if(node.equalPos){
add2(node.equalPos,1,"operator");
}else{
add(node.startLine,node.startCol,1,"name");
}
}else{
if(node.elementType=="JSNameReference"){
add(node.startLine,node.startCol,node.endCol-node.startCol,"name");
}
}
}
}
},endVisit:function(node){
return true;
}};
this.visit(_8b9);
return _8b6;
}});
});
},"davinci/de/widgets/NewDijit":function(){
define(["dojo/_base/declare","dijit/_Widget","dijit/_Templated","dojo/text!./templates/NewDijit.html","dijit/form/RadioButton","dijit/form/TextBox","dijit/form/Button"],function(_8ba,_8bb,_8bc,_8bd){
return _8ba("davinci.de.widgets.NewDijit",[_8bb,_8bc],{widgetsInTemplate:true,templateString:_8bd,_okButton:null,_dijitName:null,_widgetGroup:null,_replaceSelection:null,postMixInProperties:function(){
this.inherited(arguments);
},postCreate:function(){
this.inherited(arguments);
dojo.connect(this._dijitName,"onkeyup",this,"_checkValid");
},_checkValid:function(){
var name=dojo.attr(this._dijitName,"value");
var _8be=(name!=null);
this._okButton.set("disabled",!_8be);
},okButton:function(){
this.value={"name":dojo.attr(this._dijitName,"value"),"group":dojo.attr(this._widgetGroup,"value"),"replaceSelection":dojo.attr(this._replaceSelection,"value")};
},_getValueAttr:function(){
return this.value;
},cancelButton:function(){
this.cancel=true;
this.onClose();
},onClose:function(){
}});
});
},"url:dijit/layout/templates/TabContainer.html":"<div class=\"dijitTabContainer\">\n\t<div class=\"dijitTabListWrapper\" data-dojo-attach-point=\"tablistNode\"></div>\n\t<div data-dojo-attach-point=\"tablistSpacer\" class=\"dijitTabSpacer ${baseClass}-spacer\"></div>\n\t<div class=\"dijitTabPaneWrapper ${baseClass}-container\" data-dojo-attach-point=\"containerNode\"></div>\n</div>\n","davinci/ui/SelectProjectDialog":function(){
define(["dojo/_base/declare","dijit/_WidgetBase","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","../Workbench","dojo/i18n!davinci/ui/nls/ui","dojo/text!./templates/SelectProjectDialog.html","./widgets/ProjectSelection"],function(_8bf,_8c0,_8c1,_8c2,_8c3,_8c4,_8c5){
return _8bf([_8c0,_8c1,_8c2],{templateString:_8c5,uiNLS:_8c4,postCreate:function(){
this.currentProject=_8c3.getProject();
this.currentProjectName.innerHTML=this.currentProject;
},_onChange:function(e){
if(this.projectSelection.get("value")==this.currentProject){
this._okButton.set("disabled",true);
}else{
this._okButton.set("disabled",false);
}
},okButton:function(){
var _8c6=this.projectSelection.get("value");
if(_8c6){
_8c3.loadProject(_8c6);
}
},cancelButton:function(){
this.onClose();
}});
});
},"davinci/model/parser/Tokenizer":function(){
define("davinci/model/parser/Tokenizer",["dojo/_base/declare","davinci/js/JSExpression"],function(_8c7,_8c8){
return {stringStream:function(_8c9){
var _8ca="";
var pos=0;
var _8cb=0;
var _8cc="";
function _8cd(){
while(pos==_8ca.length){
_8cc+=_8ca;
_8ca="";
pos=0;
try{
_8ca=_8c9.next();
}
catch(e){
if(e!=StopIteration){
throw e;
}else{
return false;
}
}
}
return true;
};
return {peek:function(){
if(!_8cd()){
return null;
}
return _8ca.charAt(pos);
},next:function(){
if(!_8cd()){
if(_8cc.length>0){
throw "End of stringstream reached without emptying buffer ('"+_8cc+"').";
}else{
throw StopIteration;
}
}
return _8ca.charAt(pos++);
},get:function(){
var temp=_8cc;
_8cc="";
if(pos>0){
temp+=_8ca.slice(0,pos);
_8ca=_8ca.slice(pos);
pos=0;
}
_8cb+=temp.length;
return temp;
},getOffset:function(){
return _8cb;
},push:function(str){
_8ca=_8ca.slice(0,pos)+str+_8ca.slice(pos);
_8cb-=str.length;
},lookAhead:function(str,_8ce,_8cf,_8d0){
function _8d1(str){
return _8d0?str.toLowerCase():str;
};
str=_8d1(str);
var _8d2=false;
var _8d3=_8cc,_8d4=pos;
if(_8cf){
this.nextWhileMatches(/[\s\u00a0]/);
}
while(true){
var end=pos+str.length,left=_8ca.length-pos;
if(end<=_8ca.length){
_8d2=str==_8d1(_8ca.slice(pos,end));
pos=end;
break;
}else{
if(str.slice(0,left)==_8d1(_8ca.slice(pos))){
_8cc+=_8ca;
_8ca="";
try{
_8ca=_8c9.next();
}
catch(e){
if(e!=StopIteration){
throw e;
}
break;
}
pos=0;
str=str.slice(left);
}else{
break;
}
}
}
if(!(_8d2&&_8ce)){
_8ca=_8cc.slice(_8d3.length)+_8ca;
pos=_8d4;
_8cc=_8d3;
}
return _8d2;
},lookAheadRegex:function(_8d5,_8d6){
if(_8d5.source.charAt(0)!="^"){
throw new Error("Regexps passed to lookAheadRegex must start with ^");
}
while(_8ca.indexOf("\n",pos)==-1){
try{
_8ca+=_8c9.next();
}
catch(e){
if(e!=StopIteration){
throw e;
break;
}
}
}
var _8d7=_8ca.slice(pos).match(_8d5);
if(_8d7&&_8d6){
pos+=_8d7[0].length;
}
return _8d7;
},more:function(){
return this.peek()!==null;
},applies:function(test){
var next=this.peek();
return (next!==null&&test(next));
},nextWhile:function(test){
var next;
while((next=this.peek())!==null&&test(next)){
this.next();
}
},matches:function(re){
var next=this.peek();
return (next!==null&&re.test(next));
},nextWhileMatches:function(re){
var next;
while((next=this.peek())!==null&&re.test(next)){
this.next();
}
},equals:function(ch){
return ch===this.peek();
},endOfLine:function(){
var next=this.peek();
return next==null||next=="\n";
}};
},tokenizer:function(_8d8,_8d9){
function _8da(ch){
return ch!="\n"&&/^[\s\u00a0]*$/.test(ch);
};
var _8db={state:_8d9,take:function(type){
if(typeof (type)=="string"){
type={style:type,type:type};
}
type.offset=_8d8.getOffset();
type.content=(type.content||"")+_8d8.get();
if(!/\n$/.test(type.content)){
_8d8.nextWhile(_8da);
}
type.value=type.content+_8d8.get();
return type;
},next:function(){
if(!_8d8.more()){
throw StopIteration;
}
var type;
if(_8d8.equals("\n")){
_8d8.next();
return this.take("whitespace");
}
if(_8d8.applies(_8da)){
type="whitespace";
}else{
while(!type){
type=this.state(_8d8,function(s){
_8db.state=s;
});
}
}
return this.take(type);
}};
return _8db;
}};
});
},"davinci/ve/actions/ModifyState":function(){
require({cache:{"url:davinci/ve/actions/templates/ModifyState.html":"<div>\n\t<div class=\"dijitDialogPaneContentArea\">\n\t\t<div class='modify_state_container'>\n\t\t\t<div data-dojo-type=\"dijit.form.DropDownButton\" label='${veNls.renameLabel}' dojoAttachPoint=\"renameButton\" class=\"modify_state_rename_button\">\n\t\t\t\t\t<div data-dojo-type=\"dijit.TooltipDialog\" class='modify_state_rename_container' id='state_rename_tooltip_dialog'>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<label for=\"state_rename_new_name\">${veNls.newStateLabel}</label>\n\t\t\t\t\t\t\t<input data-dojo-type=\"dijit.form.ValidationTextBox\" id=\"state_rename_new_name\" name=\"state_rename_new_name\"></input>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<button id=\"state_rename_do_it\" dojoType='dijit.form.Button' label='${veNls.renameLabel}'></button>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t${veNls.stateLabel}: <span id='modify_state_old_name'>aaa</span>\n\t\t</div>\n\t\t<div class='initial_state_row'>\n\t\t\t<input data-dojo-type=\"dijit.form.CheckBox\" dojoAttachPoint=\"initialState\" id=\"modify_state_initial_state\" name=\"modify_state_initial_state\"></input>\n\t\t\t<label for='modify_state_initial_state'>${veNls.initialStateCheckBoxLabel}</label>\n\t\t</div>\n\t</div>\n\t\t\t\t\n\t<div class=\"dijitDialogPaneActionBar\">\n\t\t<button dojoType='dijit.form.Button' dojoAttachPoint=\"okButton\" label='${veNls.modifyLabel}' class=\"maqPrimaryButton\"></button>\n\t\t<button dojoType='dijit.form.Button' dojoAttachPoint=\"cancelButton\" label='${commonNls.buttonCancel}' class=\"maqSecondaryButton\"></button>\n\t</div>\n</div>\n"}});
define("davinci/ve/actions/ModifyState",["dojo/_base/declare","dojo/Deferred","dojo/_base/connect","dijit/_WidgetBase","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","dijit/popup","dijit/focus","davinci/ve/States","davinci/ui/Dialog","davinci/Runtime","davinci/Workbench","davinci/actions/Action","dojo/i18n!davinci/ve/nls/ve","dojo/i18n!dijit/nls/common","dojo/text!./templates/ModifyState.html","dijit/form/TextBox","dijit/form/ValidationTextBox"],function(_8dc,_8dd,_8de,_8df,_8e0,_8e1,_8e2,_8e3,_8e4,_8e5,_8e6,_8e7,_8e8,_8e9,_8ea,_8eb,_8ec){
var _8ed=null;
var _8ee=_8dc("davinci.ve.actions.ModifyStateWidget",[_8df,_8e0,_8e1],{templateString:_8eb,widgetsInTemplate:true,veNls:_8e9,commonNls:_8ea,isNormalState:false,newName:null,oldInitialStateOn:null,postCreate:function(){
this._connections=[];
var _8ef=dijit.byId("state_rename_tooltip_dialog");
_8ed.then(function(){
if(!this._statesFocus.state||this._statesFocus.state===_8e4.NORMAL){
this.isNormalState=true;
}
var _8f0=dojo.byId("modify_state_old_name");
if(_8f0){
if(this._statesFocus&&this._statesFocus.state&&!this.isNormalState){
_8f0.innerHTML=this._statesFocus.state;
}else{
_8f0.innerHTML="<i>"+_8e4.NORMAL+"</i>";
this.renameButton.set("disabled",true);
}
}
var _8f1=(_8e4.getInitial(this._statesFocus.stateContainerNode)===this._statesFocus.state);
this.oldInitialStateOn=_8f1;
this.initialState.set("checked",_8f1);
if(_8f1&&this.isNormalState){
this.initialState.set("disabled",true);
}
this._dialog.connect(this._dialog,"hide",function(e){
this.onClose();
}.bind(this));
this.okButton.connect(this.okButton,"onClick",dojo.hitch(this,function(e){
this.onOk(e);
}));
this.cancelButton.connect(this.cancelButton,"onClick",dojo.hitch(this,function(e){
this.onCancel(e);
}));
var _8f2=dijit.byId("state_rename_tooltip_dialog");
if(_8f2){
_8f2.connect(_8f2,"onShow",function(e){
this.renameStateShowTooltipDialog(e);
}.bind(this));
_8f2.connect(_8f2,"onHide",function(e){
this.renameStateHideTooltipDialog(e);
}.bind(this));
}
}.bind(this));
},renameStateShowTooltipDialog:function(e){
var _8f3=dojo.byId("modify_state_old_name");
var _8f4=dojo.byId("state_rename_new_name");
var _8f5=dijit.byId("state_rename_new_name");
if(_8f3&&_8f5){
var _8f6=_8f3.innerText;
_8f5.set("value",_8f6);
}
_8e3.focus(_8f4);
var _8f7=dijit.byId("state_rename_do_it");
_8f7.connect(_8f7,"onMouseDown",function(e){
e.stopPropagation();
});
_8f7.connect(_8f7,"onClick",function(e){
this.renameStateDoIt(e);
}.bind(this));
},renameStateDoIt:function(e){
var _8f8=dojo.byId("modify_state_old_name");
var _8f9=dijit.byId("state_rename_new_name");
var _8fa=_8f9?_8f9.get("value"):null;
var _8fb=dijit.byId("state_rename_tooltip_dialog");
if(_8f8&&_8fa){
_8f8.innerHTML=_8fa;
this.newName=_8fa;
}
if(_8fb){
_8e2.close(_8fb);
}
},renameStateHideTooltipDialog:function(e){
},onOk:function(e){
var _8fc,_8fd;
if(_8e6.currentEditor&&_8e6.currentEditor.currentEditor&&_8e6.currentEditor.currentEditor.context){
_8fd=_8e6.currentEditor;
_8fc=_8e6.currentEditor.currentEditor.context;
}else{
return;
}
var _8fe=_8e4.getFocus(_8fc.rootNode);
if(!_8fe||!_8fe.stateContainerNode){
return;
}
if(this.newName&&this.newName!==this._statesFocus.state){
_8e4.rename(_8fe.stateContainerNode,{oldName:this._statesFocus.state,newName:this.newName});
var _8ff=_8fe.stateContainerNode._dvWidget&&_8fe.stateContainerNode._dvWidget._srcElement;
if(_8ff){
var _900=null;
var _901=false;
var _902=/^(.*davinci.states.setState\s*\(\s*)('[^']*'|"[^"]*")([^\)]*\).*)$/;
var _903=/^(['"])(.*)(['"])$/;
_8ff.visit({visit:dojo.hitch(this,function(node){
if(node.elementType=="HTMLElement"){
_900=node;
}else{
if(node.elementType=="HTMLAttribute"){
var _904=node.name;
if(_904&&_904.substr(0,2).toLowerCase()=="on"){
var _905=node.value;
var _906=_905.match(_902);
if(_906){
var _907=_906[2].match(_903);
if(_907){
if(_907[2]==this._statesFocus.state){
var _908=_906[1]+_907[1]+this.newName+_907[3]+_906[3];
_900.setAttribute(_904,_908);
_901=true;
}
}
}
}
}
}
})});
if(_901){
_8fd._visualChanged();
}
}
}
var _909=this.initialState.get("checked");
if(_909!==this.oldInitialStateOn){
_8fe=_8e4.getFocus(_8fc.rootNode);
var _90a=_909?_8fe.state:null;
_8e4.setState(_8fe.state,_8fe.stateContainerNode,{initial:_90a,updateWhenCurrent:true});
}
this.onClose();
},onCancel:function(){
this.onClose();
},onClose:function(e){
var _90b;
while(_90b=this._connections.pop()){
_8de.disconnect(_90b);
}
}});
return _8dc("davinci.ve.actions.ModifyState",[_8e8],{run:function(){
var _90c;
if(_8e6.currentEditor&&_8e6.currentEditor.currentEditor&&_8e6.currentEditor.currentEditor.context){
_90c=_8e6.currentEditor.currentEditor.context;
}else{
return;
}
var _90d=_8e4.getFocus(_90c.rootNode);
if(!_90d){
return;
}
_8ed=new _8dd();
var w=new davinci.ve.actions.ModifyStateWidget();
var _90e=_8e7.showModal(w,_8e9.modifyState);
this._dialog=w._dialog=_90e;
w._statesFocus=_90d;
_8ed.resolve();
}});
});
},"orion/textview/keyBinding":function(){
define("orion/textview/keyBinding",[],function(){
var _90f=window.navigator.platform.indexOf("Mac")!==-1;
function _910(_911,mod1,mod2,mod3,mod4){
if(typeof (_911)==="string"){
this.keyCode=_911.toUpperCase().charCodeAt(0);
}else{
this.keyCode=_911;
}
this.mod1=mod1!==undefined&&mod1!==null?mod1:false;
this.mod2=mod2!==undefined&&mod2!==null?mod2:false;
this.mod3=mod3!==undefined&&mod3!==null?mod3:false;
this.mod4=mod4!==undefined&&mod4!==null?mod4:false;
};
_910.prototype={match:function(e){
if(this.keyCode===e.keyCode){
var mod1=_90f?e.metaKey:e.ctrlKey;
if(this.mod1!==mod1){
return false;
}
if(this.mod2!==e.shiftKey){
return false;
}
if(this.mod3!==e.altKey){
return false;
}
if(_90f&&this.mod4!==e.ctrlKey){
return false;
}
return true;
}
return false;
},equals:function(kb){
if(!kb){
return false;
}
if(this.keyCode!==kb.keyCode){
return false;
}
if(this.mod1!==kb.mod1){
return false;
}
if(this.mod2!==kb.mod2){
return false;
}
if(this.mod3!==kb.mod3){
return false;
}
if(this.mod4!==kb.mod4){
return false;
}
return true;
}};
return {KeyBinding:_910};
});
},"url:davinci/ui/templates/ThemeSetsDialog.html":"<div>\n\t<div class=\"dijitDialogPaneContentArea\">\n\t\t<table style=\"width: 90%\">\n\t\t\t<tr>\n\t\t\t\t\t<td style=\"width:40%; vertical-align: top;\">\n\t\t\t\t\t\t\t<table> \n\t\t\t\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t\t\t\t\t<td style=\" vertical-align: top;\" >\n\t\t\t\t\t\t\t\t\t\t\t\t\t<label>${uiNLS.themeSets}</label><select  id=\"theme_select_themeset_theme_select\" name=\"theme_select_themeset_theme_select\" size=\"10\" style=\"margin-bottom: 5px; width: 190px;\" ></select>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<div id=\"toolbar1\" data-dojo-type=\"dijit.Toolbar\" class=\"toolbaredContainer_toolbarDiv davinciToolbar\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div data-dojo-type=\"dijit.form.Button\" id=\"theme_select_themeset_add\" data-dojo-props=\"iconClass:'viewActionIcon addThemeSetIcon', showLabel:false \">${uiNLS.addThemeSet}</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span data-dojo-type=\"dijit.ToolbarSeparator\"></span>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div data-dojo-type=\"dijit.form.Button\" id=\"theme_select_themeset_delete\" data-dojo-props=\"iconClass:'viewActionIcon removeThemeSetIcon', showLabel:false \">${uiNLS.deleteThemeSet}</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t </div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t\t\t\t\t<td><div style=\"border-right: 1px solid #ccc; width: 1px; height: 250px; margin-left: 10px; margin-top: 10px;\"></div></td>\n\t\t\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t\t\t\t\t<td></td><td></td>\n\t\t\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t\t</table>\n\t\t\t\t\t</td>\n\t\t\t\t\t<td>\n\t\t\t\t\t\t\t<table style=\"width: 100%; margin-left:10px; margin-right:10px;\">\n\t\t\t\t\t\t\t\t\t<tr><td colspan=\"2\">${uiNLS.currentlySelectedThemeSet}</td><tr>\n\t\t\t\t\t\t\t\t\t<tr><td style=\"width: 18%;\">${uiNLS.themeSetName}</td><td style=\"text-align: center;\"><input dojoType=\"dijit.form.TextBox\" id=\"theme_select_themeset_theme_select_textbox\" readonly= \"true\" style=\"width: 175px;\" ></input><input type=\"button\" dojoType=\"dijit.form.Button\" id=\"theme_select_rename_button\" label=\"Rename\" style=\"margin-left: 5px;\"></td></tr>\n\t\t\t\t\t\t\t</table>\n\t\t\t\t\t\t\t<div style=\"border-top: 1px solid; top: 231px; border-top-color: #ccc; left: 429px; width: 300px; height: 11px; margin-top: 6px; margin-left:10px;\"></div>\n\t\t\t\t\t\t\t<table style=\"margin-left: 15px; width: 100%;\">\n\t\t\t\t\t\t\t\t\t<tr><td style=\"width: 139px;\">${uiNLS.desktopTheme}</td><td><select dojoType=\"dijit.form.Select\" id=\"theme_select_desktop_theme_select\"type=\"text\"  style=\"width: 175px;\"  ></select></td></tr>\n\t\t\t\t\t\t\t\t\t<tr><td>${uiNLS.mobileTheme}</td><td><select dojoType=\"dijit.form.Select\" id=\"theme_select_mobile_theme_select\"type=\"text\"  style=\"width: 175px;\" ></select></td></tr>\n\t\t\t\t\t\t\t</table>\n\t\t\t\t\t\t\t<table id=\"theme_select_devices_table\" style=\"margin-left:30px; border-collapse: separate; border-spacing: 0 0; width: 100%\">\n\t\t\t\t\t\t\t<tr><td style=\"width: 129px;\">${uiNLS.android}</td><td><select dojoType=\"dijit.form.Select\" id=\"theme_select_android_select\" type=\"text\"  style=\"width: 150px;\"></select></td></tr>\n\t\t\t\t\t\t\t<tr><td>${uiNLS.blackberry}</td><td><select dojoType=\"dijit.form.Select\" id=\"theme_select_blackberry_select\" type=\"text\"  style=\"width: 150px;\"></select></td></tr>\n\t\t\t\t\t\t\t<tr><td>${uiNLS.ipad}</td><td><select dojoType=\"dijit.form.Select\" id=\"theme_select_ipad_select\" type=\"text\"  style=\"width: 150px;\"></select></td></tr>\n\t\t\t\t\t\t\t<tr><td>${uiNLS.iphone}</td><td><select dojoType=\"dijit.form.Select\" id=\"theme_select_iphone_select\" type=\"text\"  style=\"width: 150px;\"></select></td></tr>\n\t\t\t\t\t\t\t<tr><td>${uiNLS.other}</td><td><select dojoType=\"dijit.form.Select\" id=\"theme_select_other_select\" type=\"text\"  style=\"width: 150px;\"></select></td></tr>\n\t\t\t\t\t\t\t</table>\n\t\t\n\t\t\t\t\t </td>\n\t\t\t </tr>\n\t\t</table>\n\t</div>\n\t<div class=\"dijitDialogPaneActionBar\">\n\t\t<button dojoType=\"dijit.form.Button\" id=\"theme_select_ok_button\" label=\"${uiNLS.save}\" class=\"maqPrimaryButton\" type=\"submit\"></button>\n\t\t<button dojoType=\"dijit.form.Button\" id=\"theme_select_cancel_button\" label=\"${commonNLS.buttonCancel}\" class=\"maqSecondaryButton\"></button>\n\t</div>\n</div>\n","dojox/timing/_base":function(){
define("dojox/timing/_base",["dojo/_base/kernel","dojo/_base/lang"],function(dojo){
dojo.experimental("dojox.timing");
dojo.getObject("timing",true,dojox);
dojox.timing.Timer=function(_912){
this.timer=null;
this.isRunning=false;
this.interval=_912;
this.onStart=null;
this.onStop=null;
};
dojo.extend(dojox.timing.Timer,{onTick:function(){
},setInterval:function(_913){
if(this.isRunning){
window.clearInterval(this.timer);
}
this.interval=_913;
if(this.isRunning){
this.timer=window.setInterval(dojo.hitch(this,"onTick"),this.interval);
}
},start:function(){
if(typeof this.onStart=="function"){
this.onStart();
}
this.isRunning=true;
this.timer=window.setInterval(dojo.hitch(this,"onTick"),this.interval);
},stop:function(){
if(typeof this.onStop=="function"){
this.onStop();
}
this.isRunning=false;
window.clearInterval(this.timer);
}});
return dojox.timing;
});
},"dojo/dnd/Avatar":function(){
define("dojo/dnd/Avatar",["../_base/declare","../_base/window","../dom","../dom-attr","../dom-class","../dom-construct","../hccss","../query"],function(_914,win,dom,_915,_916,_917,has,_918){
return _914("dojo.dnd.Avatar",null,{constructor:function(_919){
this.manager=_919;
this.construct();
},construct:function(){
var a=_917.create("table",{"class":"dojoDndAvatar",style:{position:"absolute",zIndex:"1999",margin:"0px"}}),_91a=this.manager.source,node,b=_917.create("tbody",null,a),tr=_917.create("tr",null,b),td=_917.create("td",null,tr),k=Math.min(5,this.manager.nodes.length),i=0;
if(has("highcontrast")){
_917.create("span",{id:"a11yIcon",innerHTML:this.manager.copy?"+":"<"},td);
}
_917.create("span",{innerHTML:_91a.generateText?this._generateText():""},td);
_915.set(tr,{"class":"dojoDndAvatarHeader",style:{opacity:0.9}});
for(;i<k;++i){
if(_91a.creator){
node=_91a._normalizedCreator(_91a.getItem(this.manager.nodes[i].id).data,"avatar").node;
}else{
node=this.manager.nodes[i].cloneNode(true);
if(node.tagName.toLowerCase()=="tr"){
var _91b=_917.create("table"),_91c=_917.create("tbody",null,_91b);
_91c.appendChild(node);
node=_91b;
}
}
node.id="";
tr=_917.create("tr",null,b);
td=_917.create("td",null,tr);
td.appendChild(node);
_915.set(tr,{"class":"dojoDndAvatarItem",style:{opacity:(9-i)/10}});
}
this.node=a;
},destroy:function(){
_917.destroy(this.node);
this.node=false;
},update:function(){
_916.toggle(this.node,"dojoDndAvatarCanDrop",this.manager.canDropFlag);
if(has("highcontrast")){
var icon=dom.byId("a11yIcon");
var text="+";
if(this.manager.canDropFlag&&!this.manager.copy){
text="< ";
}else{
if(!this.manager.canDropFlag&&!this.manager.copy){
text="o";
}else{
if(!this.manager.canDropFlag){
text="x";
}
}
}
icon.innerHTML=text;
}
_918(("tr.dojoDndAvatarHeader td span"+(has("highcontrast")?" span":"")),this.node).forEach(function(node){
node.innerHTML=this.manager.source.generateText?this._generateText():"";
},this);
},_generateText:function(){
return this.manager.nodes.length.toString();
}});
});
},"orion/textview/textView":function(){
define("orion/textview/textView",["orion/textview/textModel","orion/textview/keyBinding","orion/textview/eventTarget"],function(_91d,_91e,_91f){
function _920(node,type,_921,_922){
if(typeof node.addEventListener==="function"){
node.addEventListener(type,_921,_922===true);
}else{
node.attachEvent("on"+type,_921);
}
};
function _923(node,type,_924,_925){
if(typeof node.removeEventListener==="function"){
node.removeEventListener(type,_924,_925===true);
}else{
node.detachEvent("on"+type,_924);
}
};
var _926=navigator.userAgent;
var isIE;
if(document.selection&&window.ActiveXObject&&/MSIE/.test(_926)){
isIE=document.documentMode?document.documentMode:7;
}
var _927=parseFloat(_926.split("Firefox/")[1]||_926.split("Minefield/")[1])||undefined;
var _928=_926.indexOf("Opera")!==-1;
var _929=_926.indexOf("Chrome")!==-1;
var _92a=_926.indexOf("Safari")!==-1&&!_929;
var _92b=_926.indexOf("WebKit")!==-1;
var _92c=_926.indexOf("iPad")!==-1;
var _92d=navigator.platform.indexOf("Mac")!==-1;
var _92e=navigator.platform.indexOf("Win")!==-1;
var _92f=navigator.platform.indexOf("Linux")!==-1;
var _930=typeof window.document.documentElement.addEventListener==="function";
var _931=(!isIE||isIE>=9)&&typeof window.document.createRange().getBoundingClientRect==="function";
var _932=_92e?"\r\n":"\n";
function _933(_934,end,_935){
this.start=_934;
this.end=end;
this.caret=_935;
};
_933.prototype={clone:function(){
return new _933(this.start,this.end,this.caret);
},collapse:function(){
if(this.caret){
this.end=this.start;
}else{
this.start=this.end;
}
},extend:function(_936){
if(this.caret){
this.start=_936;
}else{
this.end=_936;
}
if(this.start>this.end){
var tmp=this.start;
this.start=this.end;
this.end=tmp;
this.caret=!this.caret;
}
},setCaret:function(_937){
this.start=_937;
this.end=_937;
this.caret=false;
},getCaret:function(){
return this.caret?this.start:this.end;
},toString:function(){
return "start="+this.start+" end="+this.end+(this.caret?" caret is at start":" caret is at end");
},isEmpty:function(){
return this.start===this.end;
},equals:function(_938){
return this.caret===_938.caret&&this.start===_938.start&&this.end===_938.end;
}};
function _939(_93a){
this._init(_93a);
};
_939.prototype={addRuler:function(_93b,_93c){
_93b.setView(this);
var _93d=this._rulers;
if(_93c!==undefined){
var i,_93e;
for(i=0,_93e=0;i<_93d.length&&_93e<_93c;i++){
if(_93b.getLocation()===_93d[i].getLocation()){
_93e++;
}
}
_93d.splice(_93e,0,_93b);
_93c=_93e;
}else{
_93d.push(_93b);
}
this._createRuler(_93b,_93c);
this._updatePage();
},computeSize:function(){
var w=0,h=0;
var _93f=this._model,_940=this._clientDiv;
if(!_940){
return {width:w,height:h};
}
var _941=_940.style.width;
if(_92b){
_940.style.width="auto";
}
var _942=_93f.getLineCount();
for(var _943=0;_943<_942;_943++){
var _944=this._getLineNode(_943),_945=null;
if(!_944||_944.lineChanged||_944.lineRemoved){
_944=_945=this._createLine(_940,null,document,_943,_93f);
}
var rect=this._getLineBoundingClientRect(_944);
w=Math.max(w,rect.right-rect.left);
h+=rect.bottom-rect.top;
if(_945){
_940.removeChild(_945);
}
}
if(_92b){
_940.style.width=_941;
}
var _946=this._getViewPadding();
w+=_946.right+_946.left;
h+=_946.bottom+_946.top;
return {width:w,height:h};
},convert:function(rect,from,to){
if(!this._clientDiv){
return;
}
var _947=this._getScroll();
var _948=this._getViewPadding();
var _949=this._viewDiv.getBoundingClientRect();
if(from==="document"){
if(rect.x!==undefined){
rect.x+=-_947.x+_949.left+_948.left;
}
if(rect.y!==undefined){
rect.y+=-_947.y+_949.top+_948.top;
}
}
if(to==="document"){
if(rect.x!==undefined){
rect.x+=_947.x-_949.left-_948.left;
}
if(rect.y!==undefined){
rect.y+=_947.y-_949.top-_948.top;
}
}
return rect;
},destroy:function(){
for(var i=0;i<this._rulers.length;i++){
this._rulers[i].setView(null);
}
this.rulers=null;
this._destroyView();
var e={type:"Destroy"};
this.onDestroy(e);
this._parent=null;
this._model=null;
this._selection=null;
this._doubleClickSelection=null;
this._keyBindings=null;
this._actions=null;
},focus:function(){
if(!this._clientDiv){
return;
}
this._updateDOMSelection();
if(_928){
this._clientDiv.blur();
}
this._clientDiv.focus();
this._updateDOMSelection();
},hasFocus:function(){
return this._hasFocus;
},getActionDescription:function(_94a){
var _94b=this._actions[_94a];
if(_94b){
return _94b.actionDescription;
}
return undefined;
},getActions:function(_94c){
var _94d=[];
var _94e=this._actions;
for(var i in _94e){
if(_94e.hasOwnProperty(i)){
if(!_94c&&_94e[i].defaultHandler){
continue;
}
_94d.push(i);
}
}
return _94d;
},getBottomIndex:function(_94f){
if(!this._clientDiv){
return 0;
}
return this._getBottomIndex(_94f);
},getBottomPixel:function(){
if(!this._clientDiv){
return 0;
}
return this._getScroll().y+this._getClientHeight();
},getCaretOffset:function(){
var s=this._getSelection();
return s.getCaret();
},getClientArea:function(){
if(!this._clientDiv){
return {x:0,y:0,width:0,height:0};
}
var _950=this._getScroll();
return {x:_950.x,y:_950.y,width:this._getClientWidth(),height:this._getClientHeight()};
},getHorizontalPixel:function(){
if(!this._clientDiv){
return 0;
}
return this._getScroll().x;
},getKeyBindings:function(_951){
var _952=[];
var _953=this._keyBindings;
for(var i=0;i<_953.length;i++){
if(_953[i].actionID===_951){
_952.push(_953[i].keyBinding);
}
}
return _952;
},getLineHeight:function(_954){
if(!this._clientDiv){
return 0;
}
return this._getLineHeight();
},getLinePixel:function(_955){
if(!this._clientDiv){
return 0;
}
_955=Math.min(Math.max(0,_955),this._model.getLineCount());
var _956=this._getLineHeight();
return _956*_955;
},getLocationAtOffset:function(_957){
if(!this._clientDiv){
return {x:0,y:0};
}
var _958=this._model;
_957=Math.min(Math.max(0,_957),_958.getCharCount());
var _959=_958.getLineAtOffset(_957);
var _95a=this._getScroll();
var _95b=this._viewDiv.getBoundingClientRect();
var _95c=this._getViewPadding();
var x=this._getOffsetToX(_957)+_95a.x-_95b.left-_95c.left;
var y=this.getLinePixel(_959);
return {x:x,y:y};
},getOptions:function(){
var _95d;
if(arguments.length===0){
_95d=this._defaultOptions();
}else{
if(arguments.length===1){
var arg=arguments[0];
if(typeof arg==="string"){
return this._clone(this["_"+arg]);
}
_95d=arg;
}else{
_95d={};
for(var _95e in arguments){
if(arguments.hasOwnProperty(_95e)){
_95d[arguments[_95e]]=undefined;
}
}
}
}
for(var _95f in _95d){
if(_95d.hasOwnProperty(_95f)){
_95d[_95f]=this._clone(this["_"+_95f]);
}
}
return _95d;
},getModel:function(){
return this._model;
},getOffsetAtLocation:function(x,y){
if(!this._clientDiv){
return 0;
}
var _960=this._getScroll();
var _961=this._viewDiv.getBoundingClientRect();
var _962=this._getViewPadding();
var _963=this._getYToLine(y-_960.y+_961.top+_962.top);
x+=-_960.x+_961.left+_962.left;
var _964=this._getXToOffset(_963,x);
return _964;
},getRulers:function(){
return this._rulers.slice(0);
},getSelection:function(){
var s=this._getSelection();
return {start:s.start,end:s.end};
},getText:function(_965,end){
var _966=this._model;
return _966.getText(_965,end);
},getTopIndex:function(_967){
if(!this._clientDiv){
return 0;
}
return this._getTopIndex(_967);
},getTopPixel:function(){
if(!this._clientDiv){
return 0;
}
return this._getScroll().y;
},invokeAction:function(_968,_969){
if(!this._clientDiv){
return;
}
var _96a=this._actions[_968];
if(_96a){
if(!_969&&_96a.handler){
if(_96a.handler()){
return;
}
}
if(_96a.defaultHandler){
return _96a.defaultHandler();
}
}
return false;
},isDestroyed:function(){
return !this._clientDiv;
},onContextMenu:function(_96b){
return this.dispatchEvent(_96b);
},onDragStart:function(_96c){
return this.dispatchEvent(_96c);
},onDrag:function(_96d){
return this.dispatchEvent(_96d);
},onDragEnd:function(_96e){
return this.dispatchEvent(_96e);
},onDragEnter:function(_96f){
return this.dispatchEvent(_96f);
},onDragOver:function(_970){
return this.dispatchEvent(_970);
},onDragLeave:function(_971){
return this.dispatchEvent(_971);
},onDrop:function(_972){
return this.dispatchEvent(_972);
},onDestroy:function(_973){
return this.dispatchEvent(_973);
},onLineStyle:function(_974){
return this.dispatchEvent(_974);
},onModelChanged:function(_975){
return this.dispatchEvent(_975);
},onModelChanging:function(_976){
return this.dispatchEvent(_976);
},onModify:function(_977){
return this.dispatchEvent(_977);
},onMouseDown:function(_978){
return this.dispatchEvent(_978);
},onMouseUp:function(_979){
return this.dispatchEvent(_979);
},onMouseMove:function(_97a){
return this.dispatchEvent(_97a);
},onMouseOver:function(_97b){
return this.dispatchEvent(_97b);
},onMouseOut:function(_97c){
return this.dispatchEvent(_97c);
},onSelection:function(_97d){
return this.dispatchEvent(_97d);
},onScroll:function(_97e){
return this.dispatchEvent(_97e);
},onVerify:function(_97f){
return this.dispatchEvent(_97f);
},onFocus:function(_980){
return this.dispatchEvent(_980);
},onBlur:function(_981){
return this.dispatchEvent(_981);
},redraw:function(){
if(this._redrawCount>0){
return;
}
var _982=this._model.getLineCount();
var _983=this.getRulers();
for(var i=0;i<_983.length;i++){
this.redrawLines(0,_982,_983[i]);
}
this.redrawLines(0,_982);
},redrawLines:function(_984,_985,_986){
if(this._redrawCount>0){
return;
}
if(_984===undefined){
_984=0;
}
if(_985===undefined){
_985=this._model.getLineCount();
}
if(_984===_985){
return;
}
var div=this._clientDiv;
if(!div){
return;
}
if(_986){
var _987=_986.getLocation();
var _988=_987==="left"?this._leftDiv:this._rightDiv;
var _989=_988.firstChild.rows[0].cells;
for(var i=0;i<_989.length;i++){
if(_989[i].firstChild._ruler===_986){
div=_989[i].firstChild;
break;
}
}
}
if(_986){
div.rulerChanged=true;
}
if(!_986||_986.getOverview()==="page"){
var _98a=div.firstChild;
while(_98a){
var _98b=_98a.lineIndex;
if(_984<=_98b&&_98b<_985){
_98a.lineChanged=true;
}
_98a=_98a.nextSibling;
}
}
if(!_986){
if(_984<=this._maxLineIndex&&this._maxLineIndex<_985){
this._checkMaxLineIndex=this._maxLineIndex;
this._maxLineIndex=-1;
this._maxLineWidth=0;
}
}
this._queueUpdatePage();
},redrawRange:function(_98c,end){
if(this._redrawCount>0){
return;
}
var _98d=this._model;
if(_98c===undefined){
_98c=0;
}
if(end===undefined){
end=_98d.getCharCount();
}
var _98e=_98d.getLineAtOffset(_98c);
var _98f=_98d.getLineAtOffset(Math.max(_98c,end-1))+1;
this.redrawLines(_98e,_98f);
},removeRuler:function(_990){
var _991=this._rulers;
for(var i=0;i<_991.length;i++){
if(_991[i]===_990){
_991.splice(i,1);
_990.setView(null);
this._destroyRuler(_990);
this._updatePage();
break;
}
}
},resize:function(){
if(!this._clientDiv){
return;
}
this._handleResize(null);
},setAction:function(_992,_993,_994){
if(!_992){
return;
}
var _995=this._actions;
var _996=_995[_992];
if(!_996){
_996=_995[_992]={};
}
_996.handler=_993;
_996.actionDescription=_994;
},setKeyBinding:function(_997,_998){
var _999=this._keyBindings;
for(var i=0;i<_999.length;i++){
var kb=_999[i];
if(kb.keyBinding.equals(_997)){
if(_998){
kb.actionID=_998;
}else{
if(kb.predefined){
kb.actionID=null;
}else{
_999.splice(i,1);
}
}
return;
}
}
if(_998){
_999.push({keyBinding:_997,actionID:_998});
}
},setCaretOffset:function(_99a,show){
var _99b=this._model.getCharCount();
_99a=Math.max(0,Math.min(_99a,_99b));
var _99c=new _933(_99a,_99a,false);
this._setSelection(_99c,show===undefined||show);
},setHorizontalPixel:function(_99d){
if(!this._clientDiv){
return;
}
_99d=Math.max(0,_99d);
this._scrollView(_99d-this._getScroll().x,0);
},setRedraw:function(_99e){
if(_99e){
if(--this._redrawCount===0){
this.redraw();
}
}else{
this._redrawCount++;
}
},setModel:function(_99f){
if(!_99f){
return;
}
if(_99f===this._model){
return;
}
this._model.removeEventListener("Changing",this._modelListener.onChanging);
this._model.removeEventListener("Changed",this._modelListener.onChanged);
var _9a0=this._model.getLineCount();
var _9a1=this._model.getCharCount();
var _9a2=_99f.getLineCount();
var _9a3=_99f.getCharCount();
var _9a4=_99f.getText();
var e={type:"ModelChanging",text:_9a4,start:0,removedCharCount:_9a1,addedCharCount:_9a3,removedLineCount:_9a0,addedLineCount:_9a2};
this.onModelChanging(e);
this._model=_99f;
e={type:"ModelChanged",start:0,removedCharCount:_9a1,addedCharCount:_9a3,removedLineCount:_9a0,addedLineCount:_9a2};
this.onModelChanged(e);
this._model.addEventListener("Changing",this._modelListener.onChanging);
this._model.addEventListener("Changed",this._modelListener.onChanged);
this._reset();
this._updatePage();
},setOptions:function(_9a5){
var _9a6=this._defaultOptions();
for(var _9a7 in _9a5){
if(_9a5.hasOwnProperty(_9a7)){
var _9a8=_9a5[_9a7],_9a9=this["_"+_9a7];
if(this._compare(_9a9,_9a8)){
continue;
}
var _9aa=_9a6[_9a7]?_9a6[_9a7].update:null;
if(_9aa){
_9aa.call(this,_9a8);
continue;
}
this["_"+_9a7]=this._clone(_9a8);
}
}
},setSelection:function(_9ab,end,show){
var _9ac=_9ab>end;
if(_9ac){
var tmp=_9ab;
_9ab=end;
end=tmp;
}
var _9ad=this._model.getCharCount();
_9ab=Math.max(0,Math.min(_9ab,_9ad));
end=Math.max(0,Math.min(end,_9ad));
var _9ae=new _933(_9ab,end,_9ac);
this._setSelection(_9ae,show===undefined||show);
},setText:function(text,_9af,end){
var _9b0=_9af===undefined&&end===undefined;
if(_9af===undefined){
_9af=0;
}
if(end===undefined){
end=this._model.getCharCount();
}
this._modifyContent({text:text,start:_9af,end:end,_code:true},!_9b0);
if(_9b0){
this._columnX=-1;
this._setSelection(new _933(0,0,false),true);
if(_927){
this._fixCaret();
}
}
},setTopIndex:function(_9b1){
if(!this._clientDiv){
return;
}
var _9b2=this._model;
if(_9b2.getCharCount()===0){
return;
}
var _9b3=_9b2.getLineCount();
var _9b4=this._getLineHeight();
var _9b5=Math.max(1,Math.min(_9b3,Math.floor(this._getClientHeight()/_9b4)));
if(_9b1<0){
_9b1=0;
}else{
if(_9b1>_9b3-_9b5){
_9b1=_9b3-_9b5;
}
}
var _9b6=_9b1*_9b4-this._getScroll().y;
this._scrollView(0,_9b6);
},setTopPixel:function(_9b7){
if(!this._clientDiv){
return;
}
var _9b8=this._getLineHeight();
var _9b9=this._getClientHeight();
var _9ba=this._model.getLineCount();
_9b7=Math.min(Math.max(0,_9b7),_9b8*_9ba-_9b9);
this._scrollView(0,_9b7-this._getScroll().y);
},showSelection:function(){
return this._showCaret(true);
},update:function(_9bb,sync){
if(!this._clientDiv){
return;
}
if(_9bb){
this._updateStyle();
}
if(sync===undefined||sync){
this._updatePage();
}else{
this._queueUpdatePage();
}
},_handleRootMouseDown:function(e){
if(!e){
e=window.event;
}
if(_927&&e.which===1){
this._clientDiv.contentEditable=false;
(this._overlayDiv||this._clientDiv).draggable=true;
this._ignoreBlur=true;
}
var _9bc=this._overlayDiv||this._clientDiv;
if(isIE<9){
_9bc=this._viewDiv;
}
var temp=e.target?e.target:e.srcElement;
while(temp){
if(_9bc===temp){
return;
}
temp=temp.parentNode;
}
if(e.preventDefault){
e.preventDefault();
}
if(e.stopPropagation){
e.stopPropagation();
}
if(!_930){
var self=this;
setTimeout(function(){
self._clientDiv.focus();
},0);
}
},_handleRootMouseUp:function(e){
if(!e){
e=window.event;
}
if(_927&&e.which===1){
this._clientDiv.contentEditable=true;
(this._overlayDiv||this._clientDiv).draggable=false;
this._fixCaret();
this._ignoreBlur=false;
}
},_handleBlur:function(e){
if(!e){
e=window.event;
}
if(this._ignoreBlur){
return;
}
this._hasFocus=false;
if(isIE<9){
if(!this._getSelection().isEmpty()){
var _9bd=document.createElement("DIV");
var _9be=this._rootDiv;
_9be.appendChild(_9bd);
_9be.removeChild(_9bd);
}
}
if(this._selDiv1){
var _9bf="lightgray";
this._selDiv1.style.background=_9bf;
this._selDiv2.style.background=_9bf;
this._selDiv3.style.background=_9bf;
var temp;
if(window.getSelection){
var sel=window.getSelection();
temp=sel.anchorNode;
while(temp){
if(temp===this._clientDiv){
if(sel.rangeCount>0){
sel.removeAllRanges();
}
break;
}
temp=temp.parentNode;
}
}else{
if(document.selection){
this._ignoreSelect=false;
temp=document.selection.createRange().parentElement();
while(temp){
if(temp===this._clientDiv){
document.selection.empty();
break;
}
temp=temp.parentNode;
}
this._ignoreSelect=true;
}
}
}
if(!this._ignoreFocus){
this.onBlur({type:"Blur"});
}
},_handleContextMenu:function(e){
if(!e){
e=window.event;
}
if(isIE&&this._lastMouseButton===3){
this._updateDOMSelection();
}
var _9c0=true;
if(this.isListening("ContextMenu")){
var evt=this._createMouseEvent("ContextMenu",e);
evt.screenX=e.screenX;
evt.screenY=e.screenY;
evt.preventDefault=true;
this.onContextMenu(evt);
_9c0=evt.preventDefault;
}
if(_9c0){
if(e.preventDefault){
e.preventDefault();
}
return false;
}
},_handleCopy:function(e){
if(this._ignoreCopy){
return;
}
if(!e){
e=window.event;
}
if(this._doCopy(e)){
if(e.preventDefault){
e.preventDefault();
}
return false;
}
},_handleCut:function(e){
if(!e){
e=window.event;
}
if(this._doCut(e)){
if(e.preventDefault){
e.preventDefault();
}
return false;
}
},_handleDataModified:function(e){
this._startIME();
},_handleDblclick:function(e){
if(!e){
e=window.event;
}
var time=e.timeStamp?e.timeStamp:new Date().getTime();
this._lastMouseTime=time;
if(this._clickCount!==2){
this._clickCount=2;
this._handleMouse(e);
}
},_handleDragStart:function(e){
if(!e){
e=window.event;
}
if(_927){
var self=this;
setTimeout(function(){
self._clientDiv.contentEditable=true;
self._clientDiv.draggable=false;
self._ignoreBlur=false;
},0);
}
if(this.isListening("DragStart")&&this._dragOffset!==-1){
this._isMouseDown=false;
this.onDragStart(this._createMouseEvent("DragStart",e));
this._dragOffset=-1;
}else{
if(e.preventDefault){
e.preventDefault();
}
return false;
}
},_handleDrag:function(e){
if(!e){
e=window.event;
}
if(this.isListening("Drag")){
this.onDrag(this._createMouseEvent("Drag",e));
}
},_handleDragEnd:function(e){
if(!e){
e=window.event;
}
this._dropTarget=false;
this._dragOffset=-1;
if(this.isListening("DragEnd")){
this.onDragEnd(this._createMouseEvent("DragEnd",e));
}
if(_927){
this._fixCaret();
if(e.dataTransfer.dropEffect==="none"&&!e.dataTransfer.mozUserCancelled){
this._fixCaret();
}
}
},_handleDragEnter:function(e){
if(!e){
e=window.event;
}
var _9c1=true;
this._dropTarget=true;
if(this.isListening("DragEnter")){
_9c1=false;
this.onDragEnter(this._createMouseEvent("DragEnter",e));
}
if(_92b||_9c1){
if(e.preventDefault){
e.preventDefault();
}
return false;
}
},_handleDragOver:function(e){
if(!e){
e=window.event;
}
var _9c2=true;
if(this.isListening("DragOver")){
_9c2=false;
this.onDragOver(this._createMouseEvent("DragOver",e));
}
if(_92b||_9c2){
if(_9c2){
e.dataTransfer.dropEffect="none";
}
if(e.preventDefault){
e.preventDefault();
}
return false;
}
},_handleDragLeave:function(e){
if(!e){
e=window.event;
}
this._dropTarget=false;
if(this.isListening("DragLeave")){
this.onDragLeave(this._createMouseEvent("DragLeave",e));
}
},_handleDrop:function(e){
if(!e){
e=window.event;
}
this._dropTarget=false;
if(this.isListening("Drop")){
this.onDrop(this._createMouseEvent("Drop",e));
}
if(e.preventDefault){
e.preventDefault();
}
return false;
},_handleFocus:function(e){
if(!e){
e=window.event;
}
this._hasFocus=true;
if(_92c&&this._lastTouchOffset!==undefined){
this.setCaretOffset(this._lastTouchOffset,true);
this._lastTouchOffset=undefined;
}else{
this._updateDOMSelection();
}
if(this._selDiv1){
var _9c3=this._highlightRGB;
this._selDiv1.style.background=_9c3;
this._selDiv2.style.background=_9c3;
this._selDiv3.style.background=_9c3;
}
if(!this._ignoreFocus){
this.onFocus({type:"Focus"});
}
},_handleKeyDown:function(e){
if(!e){
e=window.event;
}
var _9c4=false;
switch(e.keyCode){
case 16:
case 17:
case 18:
case 91:
_9c4=true;
break;
default:
this._setLinksVisible(false);
}
if(e.keyCode===229){
if(this._readonly){
if(e.preventDefault){
e.preventDefault();
}
return false;
}
var _9c5=true;
if(_92a&&_92d){
if(e.ctrlKey){
_9c5=false;
}
}
if(_9c5){
this._startIME();
}
}else{
if(!_9c4){
this._commitIME();
}
}
if(((_92d||_92f)&&_927<4)||_928){
this._keyDownEvent=e;
return true;
}
if(this._doAction(e)){
if(e.preventDefault){
e.preventDefault();
e.stopPropagation();
}else{
e.cancelBubble=true;
e.returnValue=false;
e.keyCode=0;
}
return false;
}
},_handleKeyPress:function(e){
if(!e){
e=window.event;
}
if(_92d&&_92b){
if((63232<=e.keyCode&&e.keyCode<=63487)||e.keyCode===13||e.keyCode===8){
if(e.preventDefault){
e.preventDefault();
}
return false;
}
}
if(((_92d||_92f)&&_927<4)||_928){
if(this._doAction(this._keyDownEvent)){
if(e.preventDefault){
e.preventDefault();
}
return false;
}
}
var _9c6=_92d?e.metaKey:e.ctrlKey;
if(e.charCode!==undefined){
if(_9c6){
switch(e.charCode){
case 99:
case 118:
case 120:
return true;
}
}
}
var _9c7=false;
if(_92d){
if(e.ctrlKey||e.metaKey){
_9c7=true;
}
}else{
if(_927){
if(e.ctrlKey||e.altKey){
_9c7=true;
}
}else{
if(e.ctrlKey^e.altKey){
_9c7=true;
}
}
}
if(!_9c7){
var key=_928?e.which:(e.charCode!==undefined?e.charCode:e.keyCode);
if(key>31){
this._doContent(String.fromCharCode(key));
if(e.preventDefault){
e.preventDefault();
}
return false;
}
}
},_handleKeyUp:function(e){
if(!e){
e=window.event;
}
var _9c8=_92d?e.metaKey:e.ctrlKey;
if(!_9c8){
this._setLinksVisible(false);
}
if(e.keyCode===13){
this._commitIME();
}
},_handleLinkClick:function(e){
if(!e){
e=window.event;
}
var _9c9=_92d?e.metaKey:e.ctrlKey;
if(!_9c9){
if(e.preventDefault){
e.preventDefault();
}
return false;
}
},_handleMouse:function(e){
var _9ca=true;
var _9cb=window;
if(isIE||(_927&&!this._overlayDiv)){
_9cb=this._clientDiv;
}
if(this._overlayDiv){
if(this._hasFocus){
this._ignoreFocus=true;
}
var self=this;
setTimeout(function(){
self.focus();
self._ignoreFocus=false;
},0);
}
if(this._clickCount===1){
_9ca=this._setSelectionTo(e.clientX,e.clientY,e.shiftKey,!_928&&this._hasFocus&&this.isListening("DragStart"));
if(_9ca){
this._setGrab(_9cb);
}
}else{
if(_930){
this._setGrab(_9cb);
}
this._doubleClickSelection=null;
this._setSelectionTo(e.clientX,e.clientY,e.shiftKey);
this._doubleClickSelection=this._getSelection();
}
return _9ca;
},_handleMouseDown:function(e){
if(!e){
e=window.event;
}
if(this.isListening("MouseDown")){
this.onMouseDown(this._createMouseEvent("MouseDown",e));
}
if(this._linksVisible){
var _9cc=e.target||e.srcElement;
if(_9cc.tagName!=="A"){
this._setLinksVisible(false);
}else{
return;
}
}
this._commitIME();
var _9cd=e.which;
if(!_9cd){
if(e.button===4){
_9cd=2;
}
if(e.button===2){
_9cd=3;
}
if(e.button===1){
_9cd=1;
}
}
var time=_9cd!==2&&e.timeStamp?e.timeStamp:new Date().getTime();
var _9ce=time-this._lastMouseTime;
var _9cf=Math.abs(this._lastMouseX-e.clientX);
var _9d0=Math.abs(this._lastMouseY-e.clientY);
var _9d1=this._lastMouseButton===_9cd;
this._lastMouseX=e.clientX;
this._lastMouseY=e.clientY;
this._lastMouseTime=time;
this._lastMouseButton=_9cd;
if(_9cd===1){
this._isMouseDown=true;
if(_9d1&&_9ce<=this._clickTime&&_9cf<=this._clickDist&&_9d0<=this._clickDist){
this._clickCount++;
}else{
this._clickCount=1;
}
if(this._handleMouse(e)&&(isIE>=9||_928||_929||(_927&&!this._overlayDiv))){
if(!this._hasFocus){
this.focus();
}
e.preventDefault();
}
}
if(_927&&this._lastMouseButton===3){
this._updateDOMSelection();
}
},_handleMouseOver:function(e){
if(!e){
e=window.event;
}
if(this.isListening("MouseOver")){
this.onMouseOver(this._createMouseEvent("MouseOver",e));
}
},_handleMouseOut:function(e){
if(!e){
e=window.event;
}
if(this.isListening("MouseOut")){
this.onMouseOut(this._createMouseEvent("MouseOut",e));
}
},_handleMouseMove:function(e){
if(!e){
e=window.event;
}
var _9d2=this._isClientDiv(e);
if(this.isListening("MouseMove")){
if(_9d2){
this.onMouseMove(this._createMouseEvent("MouseMove",e));
}
}
if(this._dropTarget){
return;
}
var _9d3=this._linksVisible||this._lastMouseMoveX!==e.clientX||this._lastMouseMoveY!==e.clientY;
this._lastMouseMoveX=e.clientX;
this._lastMouseMoveY=e.clientY;
this._setLinksVisible(_9d3&&!this._isMouseDown&&(_92d?e.metaKey:e.ctrlKey));
if(!_930){
if(e.button===0){
this._setGrab(null);
return true;
}
if(!this._isMouseDown&&e.button===1&&(this._clickCount&1)!==0&&_9d2){
this._clickCount=2;
return this._handleMouse(e,this._clickCount);
}
}
if(!this._isMouseDown||this._dragOffset!==-1){
return;
}
var x=e.clientX;
var y=e.clientY;
var _9d4=this._getViewPadding();
var _9d5=this._viewDiv.getBoundingClientRect();
var _9d6=this._getClientWidth(),_9d7=this._getClientHeight();
var _9d8=_9d5.left+_9d4.left;
var _9d9=_9d5.top+_9d4.top;
var _9da=_9d5.left+_9d4.left+_9d6;
var _9db=_9d5.top+_9d4.top+_9d7;
var _9dc=this._model;
var _9dd=_9dc.getLineAtOffset(this._getSelection().getCaret());
if(y<_9d9&&_9dd!==0){
this._doAutoScroll("up",x,y-_9d9);
}else{
if(y>_9db&&_9dd!==_9dc.getLineCount()-1){
this._doAutoScroll("down",x,y-_9db);
}else{
if(x<_9d8){
this._doAutoScroll("left",x-_9d8,y);
}else{
if(x>_9da){
this._doAutoScroll("right",x-_9da,y);
}else{
this._endAutoScroll();
this._setSelectionTo(x,y,true);
}
}
}
}
},_isClientDiv:function(e){
var _9de=this._overlayDiv||this._clientDiv;
var temp=e.target?e.target:e.srcElement;
while(temp){
if(_9de===temp){
return true;
}
temp=temp.parentNode;
}
return false;
},_createMouseEvent:function(type,e){
var _9df=this._getScroll();
var _9e0=this._viewDiv.getBoundingClientRect();
var _9e1=this._getViewPadding();
var x=e.clientX+_9df.x-_9e0.left-_9e1.left;
var y=e.clientY+_9df.y-_9e0.top-_9e1.top;
return {type:type,event:e,x:x,y:y};
},_handleMouseUp:function(e){
if(!e){
e=window.event;
}
var left=e.which?e.button===0:e.button===1;
if(this.isListening("MouseUp")){
if(this._isClientDiv(e)||(left&&this._isMouseDown)){
this.onMouseUp(this._createMouseEvent("MouseUp",e));
}
}
if(this._linksVisible){
return;
}
if(left&&this._isMouseDown){
if(this._dragOffset!==-1){
var _9e2=this._getSelection();
_9e2.extend(this._dragOffset);
_9e2.collapse();
this._setSelection(_9e2,true,true);
this._dragOffset=-1;
}
this._isMouseDown=false;
this._endAutoScroll();
if(_930){
this._setGrab(null);
}
if(_927){
e.preventDefault();
}
}
},_handleMouseWheel:function(e){
if(!e){
e=window.event;
}
var _9e3=this._getLineHeight();
var _9e4=0,_9e5=0;
if(isIE||_928){
_9e5=(-e.wheelDelta/40)*_9e3;
}else{
if(_927){
var _9e6;
if(_92d){
_9e6=e.detail*3;
}else{
var _9e7=256;
_9e6=Math.max(-_9e7,Math.min(_9e7,e.detail))*_9e3;
}
if(e.axis===e.HORIZONTAL_AXIS){
_9e4=_9e6;
}else{
_9e5=_9e6;
}
}else{
if(_92d){
var _9e8=40,_9e9=40;
if(e.wheelDeltaX%120!==0){
_9e8=1;
}
if(e.wheelDeltaY%120!==0){
_9e9=1;
}
_9e4=-e.wheelDeltaX/_9e8;
if(-1<_9e4&&_9e4<0){
_9e4=-1;
}
if(0<_9e4&&_9e4<1){
_9e4=1;
}
_9e5=-e.wheelDeltaY/_9e9;
if(-1<_9e5&&_9e5<0){
_9e5=-1;
}
if(0<_9e5&&_9e5<1){
_9e5=1;
}
}else{
_9e4=-e.wheelDeltaX;
var _9ea=8;
_9e5=(-e.wheelDeltaY/120*_9ea)*_9e3;
}
}
}
if(_92a){
var _9eb=e.target;
while(_9eb&&_9eb.lineIndex===undefined){
_9eb=_9eb.parentNode;
}
this._mouseWheelLine=_9eb;
}
var _9ec=this._getScroll();
this._scrollView(_9e4,_9e5);
var _9ed=this._getScroll();
if(_9ec.x!==_9ed.x||_9ec.y!==_9ed.y){
if(e.preventDefault){
e.preventDefault();
}
return false;
}
},_handlePaste:function(e){
if(this._ignorePaste){
return;
}
if(!e){
e=window.event;
}
if(this._doPaste(e)){
if(isIE){
var self=this;
this._ignoreFocus=true;
setTimeout(function(){
self._updateDOMSelection();
this._ignoreFocus=false;
},0);
}
if(e.preventDefault){
e.preventDefault();
}
return false;
}
},_handleResize:function(e){
if(!e){
e=window.event;
}
var _9ee=this._parent.clientWidth;
var _9ef=this._parent.clientHeight;
if(this._parentWidth!==_9ee||this._parentHeight!==_9ef){
this._parentWidth=_9ee;
this._parentHeight=_9ef;
if(isIE<9){
this._queueUpdatePage();
}else{
this._updatePage();
}
}
},_handleRulerEvent:function(e){
if(!e){
e=window.event;
}
var _9f0=e.target?e.target:e.srcElement;
var _9f1=_9f0.lineIndex;
var _9f2=_9f0;
while(_9f2&&!_9f2._ruler){
if(_9f1===undefined&&_9f2.lineIndex!==undefined){
_9f1=_9f2.lineIndex;
}
_9f2=_9f2.parentNode;
}
var _9f3=_9f2?_9f2._ruler:null;
if(_9f1===undefined&&_9f3&&_9f3.getOverview()==="document"){
var _9f4=this._getClientHeight();
var _9f5=this._model.getLineCount();
var _9f6=this._getViewPadding();
var _9f7=this._viewDiv.getBoundingClientRect();
var _9f8=_9f4+_9f6.top+_9f6.bottom-2*this._metrics.scrollWidth;
_9f1=Math.floor(((e.clientY-_9f7.top)-this._metrics.scrollWidth)*_9f5/_9f8);
if(!(0<=_9f1&&_9f1<_9f5)){
_9f1=undefined;
}
}
if(_9f3){
switch(e.type){
case "click":
if(_9f3.onClick){
_9f3.onClick(_9f1,e);
}
break;
case "dblclick":
if(_9f3.onDblClick){
_9f3.onDblClick(_9f1,e);
}
break;
case "mousemove":
if(_9f3.onMouseMove){
_9f3.onMouseMove(_9f1,e);
}
break;
case "mouseover":
if(_9f3.onMouseOver){
_9f3.onMouseOver(_9f1,e);
}
break;
case "mouseout":
if(_9f3.onMouseOut){
_9f3.onMouseOut(_9f1,e);
}
break;
}
}
},_handleScroll:function(){
var _9f9=this._getScroll();
var oldX=this._hScroll;
var oldY=this._vScroll;
if(oldX!==_9f9.x||oldY!==_9f9.y){
this._hScroll=_9f9.x;
this._vScroll=_9f9.y;
this._commitIME();
this._updatePage(oldY===_9f9.y);
var e={type:"Scroll",oldValue:{x:oldX,y:oldY},newValue:_9f9};
this.onScroll(e);
}
},_handleSelectStart:function(e){
if(!e){
e=window.event;
}
if(this._ignoreSelect){
if(e&&e.preventDefault){
e.preventDefault();
}
return false;
}
},_getModelOffset:function(node,_9fa){
if(!node){
return;
}
var _9fb;
if(node.tagName==="DIV"){
_9fb=node;
}else{
_9fb=node.parentNode.parentNode;
}
var _9fc=0;
var _9fd=_9fb.lineIndex;
if(node.tagName!=="DIV"){
var _9fe=_9fb.firstChild;
while(_9fe){
var _9ff=_9fe.firstChild;
if(_9ff===node){
if(_9fe.ignoreChars){
_9fc-=_9fe.ignoreChars;
}
_9fc+=_9fa;
break;
}
if(_9fe.ignoreChars){
_9fc-=_9fe.ignoreChars;
}
_9fc+=_9ff.data.length;
_9fe=_9fe.nextSibling;
}
}
return Math.max(0,_9fc)+this._model.getLineStart(_9fd);
},_handleSelectionChange:function(e){
var _a00=window.getSelection();
var _a01=this._getModelOffset(_a00.anchorNode,_a00.anchorOffset);
var end=this._getModelOffset(_a00.focusNode,_a00.focusOffset);
if(_a01===undefined||end===undefined){
return;
}
this._setSelection(new _933(_a01,end),false,false,false);
},_handleTouchStart:function(e){
if(this._touchScrollTimer){
this._vScrollDiv.style.display="none";
this._hScrollDiv.style.display="none";
clearInterval(this._touchScrollTimer);
this._touchScrollTimer=null;
}
var _a02=e.touches;
if(_a02.length===1){
var _a03=_a02[0];
this._touchStartX=_a03.clientX;
this._touchStartY=_a03.clientY;
this._lastTouchOffset=this._getXToOffset(this._getYToLine(_a03.clientY),_a03.clientX);
this._touchStartTime=e.timeStamp;
this._touching=true;
}
},_handleTouchMove:function(e){
var _a04=e.touches;
if(_a04.length===1){
var _a05=_a04[0];
this._touchCurrentX=_a05.clientX;
this._touchCurrentY=_a05.clientY;
var _a06=10;
if(!this._touchScrollTimer&&(e.timeStamp-this._touchStartTime)<(_a06*20)){
this._vScrollDiv.style.display="block";
this._hScrollDiv.style.display="block";
var self=this;
this._touchScrollTimer=setInterval(function(){
var _a07=0,_a08=0;
if(self._touching){
_a07=self._touchStartX-self._touchCurrentX;
_a08=self._touchStartY-self._touchCurrentY;
self._touchSpeedX=_a07/_a06;
self._touchSpeedY=_a08/_a06;
self._touchStartX=self._touchCurrentX;
self._touchStartY=self._touchCurrentY;
}else{
if(Math.abs(self._touchSpeedX)<0.1&&Math.abs(self._touchSpeedY)<0.1){
self._vScrollDiv.style.display="none";
self._hScrollDiv.style.display="none";
clearInterval(self._touchScrollTimer);
self._touchScrollTimer=null;
return;
}else{
_a07=self._touchSpeedX*_a06;
_a08=self._touchSpeedY*_a06;
self._touchSpeedX*=0.95;
self._touchSpeedY*=0.95;
}
}
self._scrollView(_a07,_a08);
},_a06);
}
if(this._touchScrollTimer){
e.preventDefault();
}
}
},_handleTouchEnd:function(e){
var _a09=e.touches;
if(_a09.length===0){
this._touching=false;
}
},_doAction:function(e){
var _a0a=this._keyBindings;
for(var i=0;i<_a0a.length;i++){
var kb=_a0a[i];
if(kb.keyBinding.match(e)){
if(kb.actionID){
var _a0b=this._actions;
var _a0c=_a0b[kb.actionID];
if(_a0c){
if(_a0c.handler){
if(!_a0c.handler()){
if(_a0c.defaultHandler){
return typeof (_a0c.defaultHandler())==="boolean";
}else{
return false;
}
}
}else{
if(_a0c.defaultHandler){
return typeof (_a0c.defaultHandler())==="boolean";
}
}
}
}
return true;
}
}
return false;
},_doBackspace:function(args){
var _a0d=this._getSelection();
if(_a0d.isEmpty()){
var _a0e=this._model;
var _a0f=_a0d.getCaret();
var _a10=_a0e.getLineAtOffset(_a0f);
var _a11=_a0e.getLineStart(_a10);
if(_a0f===_a11){
if(_a10>0){
_a0d.extend(_a0e.getLineEnd(_a10-1));
}
}else{
var _a12=false;
if(this._expandTab&&args.unit==="character"&&(_a0f-_a11)%this._tabSize===0){
var _a13=_a0e.getText(_a11,_a0f);
_a12=!/[^ ]/.test(_a13);
}
if(_a12){
_a0d.extend(_a0f-this._tabSize);
}else{
_a0d.extend(this._getOffset(_a0f,args.unit,-1));
}
}
}
this._modifyContent({text:"",start:_a0d.start,end:_a0d.end},true);
return true;
},_doContent:function(text){
var _a14=this._getSelection();
this._modifyContent({text:text,start:_a14.start,end:_a14.end,_ignoreDOMSelection:true},true);
},_doCopy:function(e){
var _a15=this._getSelection();
if(!_a15.isEmpty()){
var text=this._getBaseText(_a15.start,_a15.end);
return this._setClipboardText(text,e);
}
return true;
},_doCursorNext:function(args){
if(!args.select){
if(this._clearSelection("next")){
return true;
}
}
var _a16=this._model;
var _a17=this._getSelection();
var _a18=_a17.getCaret();
var _a19=_a16.getLineAtOffset(_a18);
if(_a18===_a16.getLineEnd(_a19)){
if(_a19+1<_a16.getLineCount()){
_a17.extend(_a16.getLineStart(_a19+1));
}
}else{
_a17.extend(this._getOffset(_a18,args.unit,1));
}
if(!args.select){
_a17.collapse();
}
this._setSelection(_a17,true);
return true;
},_doCursorPrevious:function(args){
if(!args.select){
if(this._clearSelection("previous")){
return true;
}
}
var _a1a=this._model;
var _a1b=this._getSelection();
var _a1c=_a1b.getCaret();
var _a1d=_a1a.getLineAtOffset(_a1c);
if(_a1c===_a1a.getLineStart(_a1d)){
if(_a1d>0){
_a1b.extend(_a1a.getLineEnd(_a1d-1));
}
}else{
_a1b.extend(this._getOffset(_a1c,args.unit,-1));
}
if(!args.select){
_a1b.collapse();
}
this._setSelection(_a1b,true);
return true;
},_doCut:function(e){
var _a1e=this._getSelection();
if(!_a1e.isEmpty()){
var text=this._getBaseText(_a1e.start,_a1e.end);
this._doContent("");
return this._setClipboardText(text,e);
}
return true;
},_doDelete:function(args){
var _a1f=this._getSelection();
if(_a1f.isEmpty()){
var _a20=this._model;
var _a21=_a1f.getCaret();
var _a22=_a20.getLineAtOffset(_a21);
if(_a21===_a20.getLineEnd(_a22)){
if(_a22+1<_a20.getLineCount()){
_a1f.extend(_a20.getLineStart(_a22+1));
}
}else{
_a1f.extend(this._getOffset(_a21,args.unit,1));
}
}
this._modifyContent({text:"",start:_a1f.start,end:_a1f.end},true);
return true;
},_doEnd:function(args){
var _a23=this._getSelection();
var _a24=this._model;
if(args.ctrl){
_a23.extend(_a24.getCharCount());
}else{
var _a25=_a24.getLineAtOffset(_a23.getCaret());
_a23.extend(_a24.getLineEnd(_a25));
}
if(!args.select){
_a23.collapse();
}
this._setSelection(_a23,true);
return true;
},_doEnter:function(args){
var _a26=this._model;
var _a27=this._getSelection();
this._doContent(_a26.getLineDelimiter());
if(args&&args.noCursor){
_a27.end=_a27.start;
this._setSelection(_a27);
}
return true;
},_doHome:function(args){
var _a28=this._getSelection();
var _a29=this._model;
if(args.ctrl){
_a28.extend(0);
}else{
var _a2a=_a29.getLineAtOffset(_a28.getCaret());
_a28.extend(_a29.getLineStart(_a2a));
}
if(!args.select){
_a28.collapse();
}
this._setSelection(_a28,true);
return true;
},_doLineDown:function(args){
var _a2b=this._model;
var _a2c=this._getSelection();
var _a2d=_a2c.getCaret();
var _a2e=_a2b.getLineAtOffset(_a2d);
var x=this._columnX;
var _a2f=this._getScroll().x;
if(x===-1||args.wholeLine||(args.select&&isIE)){
var _a30=args.wholeLine?_a2b.getLineEnd(_a2e+1):_a2d;
x=this._getOffsetToX(_a30)+_a2f;
}
if(_a2e+1<_a2b.getLineCount()){
_a2c.extend(this._getXToOffset(_a2e+1,x-_a2f));
if(!args.select){
_a2c.collapse();
}
this._setSelection(_a2c,true,true);
}else{
if(args.select){
_a2c.extend(_a2b.getCharCount());
this._setSelection(_a2c,true,true);
}
}
this._columnX=x;
return true;
},_doLineUp:function(args){
var _a31=this._model;
var _a32=this._getSelection();
var _a33=_a32.getCaret();
var _a34=_a31.getLineAtOffset(_a33);
var x=this._columnX;
var _a35=this._getScroll().x;
if(x===-1||args.wholeLine||(args.select&&isIE)){
var _a36=args.wholeLine?_a31.getLineStart(_a34-1):_a33;
x=this._getOffsetToX(_a36)+_a35;
}
if(_a34>0){
_a32.extend(this._getXToOffset(_a34-1,x-_a35));
if(!args.select){
_a32.collapse();
}
this._setSelection(_a32,true,true);
}else{
if(args.select){
_a32.extend(0);
this._setSelection(_a32,true,true);
}
}
this._columnX=x;
return true;
},_doPageDown:function(args){
var _a37=this._model;
var _a38=this._getSelection();
var _a39=_a38.getCaret();
var _a3a=_a37.getLineAtOffset(_a39);
var _a3b=_a37.getLineCount();
if(_a3a<_a3b-1){
var _a3c=this._getScroll();
var _a3d=this._getClientHeight();
var _a3e=this._getLineHeight();
var _a3f=Math.floor(_a3d/_a3e);
var _a40=Math.min(_a3b-_a3a-1,_a3f);
_a40=Math.max(1,_a40);
var x=this._columnX;
if(x===-1||(args.select&&isIE)){
x=this._getOffsetToX(_a39)+_a3c.x;
}
_a38.extend(this._getXToOffset(_a3a+_a40,x-_a3c.x));
if(!args.select){
_a38.collapse();
}
var _a41=_a3b*_a3e;
var _a42=_a3c.y+_a40*_a3e;
if(_a42+_a3d>_a41){
_a42=_a41-_a3d;
}
this._setSelection(_a38,true,true,_a42-_a3c.y);
this._columnX=x;
}
return true;
},_doPageUp:function(args){
var _a43=this._model;
var _a44=this._getSelection();
var _a45=_a44.getCaret();
var _a46=_a43.getLineAtOffset(_a45);
if(_a46>0){
var _a47=this._getScroll();
var _a48=this._getClientHeight();
var _a49=this._getLineHeight();
var _a4a=Math.floor(_a48/_a49);
var _a4b=Math.max(1,Math.min(_a46,_a4a));
var x=this._columnX;
if(x===-1||(args.select&&isIE)){
x=this._getOffsetToX(_a45)+_a47.x;
}
_a44.extend(this._getXToOffset(_a46-_a4b,x-_a47.x));
if(!args.select){
_a44.collapse();
}
var _a4c=Math.max(0,_a47.y-_a4b*_a49);
this._setSelection(_a44,true,true,_a4c-_a47.y);
this._columnX=x;
}
return true;
},_doPaste:function(e){
var self=this;
var _a4d=this._getClipboardText(e,function(text){
if(text){
if(_92f&&self._lastMouseButton===2){
var _a4e=new Date().getTime()-self._lastMouseTime;
if(_a4e<=self._clickTime){
self._setSelectionTo(self._lastMouseX,self._lastMouseY);
}
}
self._doContent(text);
}
});
return _a4d!==null;
},_doScroll:function(args){
var type=args.type;
var _a4f=this._model;
var _a50=_a4f.getLineCount();
var _a51=this._getClientHeight();
var _a52=this._getLineHeight();
var _a53=_a50*_a52;
var _a54=this._getScroll().y;
var _a55;
switch(type){
case "textStart":
_a55=0;
break;
case "textEnd":
_a55=_a53-_a51;
break;
case "pageDown":
_a55=_a54+_a51;
break;
case "pageUp":
_a55=_a54-_a51;
break;
case "centerLine":
var _a56=this._getSelection();
var _a57=_a4f.getLineAtOffset(_a56.start);
var _a58=_a4f.getLineAtOffset(_a56.end);
var _a59=(_a58-_a57+1)*_a52;
_a55=(_a57*_a52)-(_a51/2)+(_a59/2);
break;
}
if(_a55!==undefined){
_a55=Math.min(Math.max(0,_a55),_a53-_a51);
this._scrollView(0,_a55-_a54);
}
return true;
},_doSelectAll:function(args){
var _a5a=this._model;
var _a5b=this._getSelection();
_a5b.setCaret(0);
_a5b.extend(_a5a.getCharCount());
this._setSelection(_a5b,false);
return true;
},_doTab:function(args){
if(!this._tabMode||this._readonly){
return;
}
var text="\t";
if(this._expandTab){
var _a5c=this._model;
var _a5d=this._getSelection().getCaret();
var _a5e=_a5c.getLineAtOffset(_a5d);
var _a5f=_a5c.getLineStart(_a5e);
var _a60=this._tabSize-((_a5d-_a5f)%this._tabSize);
text=(new Array(_a60+1)).join(" ");
}
this._doContent(text);
return true;
},_doShiftTab:function(args){
if(!this._tabMode||this._readonly){
return;
}
return true;
},_doTabMode:function(args){
this._tabMode=!this._tabMode;
return true;
},_applyStyle:function(_a61,node,_a62){
if(_a62){
node.className="";
var _a63=node.attributes;
for(var i=_a63.length;i-->0;){
if(_a63[i].specified){
node.removeAttributeNode(_a63[i]);
}
}
}
if(!_a61){
return;
}
if(_a61.styleClass){
node.className=_a61.styleClass;
}
var _a64=_a61.style;
if(_a64){
for(var s in _a64){
if(_a64.hasOwnProperty(s)){
node.style[s]=_a64[s];
}
}
}
var _a65=_a61.attributes;
if(_a65){
for(var a in _a65){
if(_a65.hasOwnProperty(a)){
node.setAttribute(a,_a65[a]);
}
}
}
},_autoScroll:function(){
var _a66=this._getSelection();
var line;
var x=this._autoScrollX;
if(this._autoScrollDir==="up"||this._autoScrollDir==="down"){
var _a67=this._autoScrollY/this._getLineHeight();
_a67=_a67<0?Math.floor(_a67):Math.ceil(_a67);
line=this._model.getLineAtOffset(_a66.getCaret());
line=Math.max(0,Math.min(this._model.getLineCount()-1,line+_a67));
}else{
if(this._autoScrollDir==="left"||this._autoScrollDir==="right"){
line=this._getYToLine(this._autoScrollY);
x+=this._getOffsetToX(_a66.getCaret());
}
}
_a66.extend(this._getXToOffset(line,x));
this._setSelection(_a66,true);
},_autoScrollTimer:function(){
this._autoScroll();
var self=this;
this._autoScrollTimerID=setTimeout(function(){
self._autoScrollTimer();
},this._AUTO_SCROLL_RATE);
},_calculateMetrics:function(){
var _a68=this._clientDiv;
var c=" ";
var line=document.createElement("DIV");
line.style.lineHeight="normal";
var _a69=this._model;
var _a6a=_a69.getLine(0);
var e={type:"LineStyle",textView:this,0:0,lineText:_a6a,lineStart:0};
this.onLineStyle(e);
this._applyStyle(e.style,line);
line.style.position="fixed";
line.style.left="-1000px";
var _a6b=document.createElement("SPAN");
_a6b.appendChild(document.createTextNode(c));
line.appendChild(_a6b);
var _a6c=document.createElement("SPAN");
_a6c.style.fontStyle="italic";
_a6c.appendChild(document.createTextNode(c));
line.appendChild(_a6c);
var _a6d=document.createElement("SPAN");
_a6d.style.fontWeight="bold";
_a6d.appendChild(document.createTextNode(c));
line.appendChild(_a6d);
var _a6e=document.createElement("SPAN");
_a6e.style.fontWeight="bold";
_a6e.style.fontStyle="italic";
_a6e.appendChild(document.createTextNode(c));
line.appendChild(_a6e);
_a68.appendChild(line);
var _a6f=line.getBoundingClientRect();
var _a70=_a6b.getBoundingClientRect();
var _a71=_a6c.getBoundingClientRect();
var _a72=_a6d.getBoundingClientRect();
var _a73=_a6e.getBoundingClientRect();
var h1=_a70.bottom-_a70.top;
var h2=_a71.bottom-_a71.top;
var h3=_a72.bottom-_a72.top;
var h4=_a73.bottom-_a73.top;
var _a74=0;
var _a75=Math.max(1,_a6f.bottom-_a6f.top);
if(h2>h1){
_a74=1;
}
if(h3>h2){
_a74=2;
}
if(h4>h3){
_a74=3;
}
var _a76;
if(_a74!==0){
_a76={style:{}};
if((_a74&1)!==0){
_a76.style.fontStyle="italic";
}
if((_a74&2)!==0){
_a76.style.fontWeight="bold";
}
}
var trim=this._getLineTrim(line);
_a68.removeChild(line);
var pad=this._getPadding(this._viewDiv);
var div1=document.createElement("DIV");
div1.style.position="fixed";
div1.style.left="-1000px";
div1.style.paddingLeft=pad.left+"px";
div1.style.paddingTop=pad.top+"px";
div1.style.paddingRight=pad.right+"px";
div1.style.paddingBottom=pad.bottom+"px";
div1.style.width="100px";
div1.style.height="100px";
var div2=document.createElement("DIV");
div2.style.width="100%";
div2.style.height="100%";
div1.appendChild(div2);
_a68.appendChild(div1);
var _a77=div1.getBoundingClientRect();
var _a78=div2.getBoundingClientRect();
div1.style.overflow="hidden";
div2.style.height="200px";
var w1=div1.clientWidth;
div1.style.overflow="scroll";
var w2=div1.clientWidth;
_a68.removeChild(div1);
var _a79=w1-w2;
pad={left:_a78.left-_a77.left,top:_a78.top-_a77.top,right:_a77.right-_a78.right,bottom:_a77.bottom-_a78.bottom};
return {lineHeight:_a75,largestFontStyle:_a76,lineTrim:trim,viewPadding:pad,scrollWidth:_a79};
},_clearSelection:function(_a7a){
var _a7b=this._getSelection();
if(_a7b.isEmpty()){
return false;
}
if(_a7a==="next"){
_a7b.start=_a7b.end;
}else{
_a7b.end=_a7b.start;
}
this._setSelection(_a7b,true);
return true;
},_clone:function(obj){
if(obj instanceof Array){
return obj.slice(0);
}
return obj;
},_compare:function(s1,s2){
if(s1===s2){
return true;
}
if(s1&&!s2||!s1&&s2){
return false;
}
if((s1&&s1.constructor===String)||(s2&&s2.constructor===String)){
return false;
}
if(s1 instanceof Array||s2 instanceof Array){
if(!(s1 instanceof Array&&s2 instanceof Array)){
return false;
}
if(s1.length!==s2.length){
return false;
}
for(var i=0;i<s1.length;i++){
if(!this._compare(s1[i],s2[i])){
return false;
}
}
return true;
}
if(!(s1 instanceof Object)||!(s2 instanceof Object)){
return false;
}
var p;
for(p in s1){
if(s1.hasOwnProperty(p)){
if(!s2.hasOwnProperty(p)){
return false;
}
if(!this._compare(s1[p],s2[p])){
return false;
}
}
}
for(p in s2){
if(!s1.hasOwnProperty(p)){
return false;
}
}
return true;
},_commitIME:function(){
if(this._imeOffset===-1){
return;
}
this._scrollDiv.focus();
this._clientDiv.focus();
var _a7c=this._model;
var _a7d=_a7c.getLineAtOffset(this._imeOffset);
var _a7e=_a7c.getLineStart(_a7d);
var _a7f=this._getDOMText(_a7d);
var _a80=_a7c.getLine(_a7d);
var _a81=this._imeOffset-_a7e;
var end=_a81+_a7f.length-_a80.length;
if(_a81!==end){
var _a82=_a7f.substring(_a81,end);
this._doContent(_a82);
}
this._imeOffset=-1;
},_convertDelimiter:function(text,_a83,_a84){
var cr=0,lf=0,_a85=0,_a86=text.length;
while(_a85<_a86){
if(cr!==-1&&cr<=_a85){
cr=text.indexOf("\r",_a85);
}
if(lf!==-1&&lf<=_a85){
lf=text.indexOf("\n",_a85);
}
var _a87=_a85,end;
if(lf===-1&&cr===-1){
_a83(text.substring(_a85));
break;
}
if(cr!==-1&&lf!==-1){
if(cr+1===lf){
end=cr;
_a85=lf+1;
}else{
end=cr<lf?cr:lf;
_a85=(cr<lf?cr:lf)+1;
}
}else{
if(cr!==-1){
end=cr;
_a85=cr+1;
}else{
end=lf;
_a85=lf+1;
}
}
_a83(text.substring(_a87,end));
_a84();
}
},_createActions:function(){
var _a88=_91e.KeyBinding;
var _a89=this._keyBindings=[];
_a89.push({actionID:"lineUp",keyBinding:new _a88(38),predefined:true});
_a89.push({actionID:"lineDown",keyBinding:new _a88(40),predefined:true});
_a89.push({actionID:"charPrevious",keyBinding:new _a88(37),predefined:true});
_a89.push({actionID:"charNext",keyBinding:new _a88(39),predefined:true});
if(_92d){
_a89.push({actionID:"scrollPageUp",keyBinding:new _a88(33),predefined:true});
_a89.push({actionID:"scrollPageDown",keyBinding:new _a88(34),predefined:true});
_a89.push({actionID:"pageUp",keyBinding:new _a88(33,null,null,true),predefined:true});
_a89.push({actionID:"pageDown",keyBinding:new _a88(34,null,null,true),predefined:true});
_a89.push({actionID:"lineStart",keyBinding:new _a88(37,true),predefined:true});
_a89.push({actionID:"lineEnd",keyBinding:new _a88(39,true),predefined:true});
_a89.push({actionID:"wordPrevious",keyBinding:new _a88(37,null,null,true),predefined:true});
_a89.push({actionID:"wordNext",keyBinding:new _a88(39,null,null,true),predefined:true});
_a89.push({actionID:"scrollTextStart",keyBinding:new _a88(36),predefined:true});
_a89.push({actionID:"scrollTextEnd",keyBinding:new _a88(35),predefined:true});
_a89.push({actionID:"textStart",keyBinding:new _a88(38,true),predefined:true});
_a89.push({actionID:"textEnd",keyBinding:new _a88(40,true),predefined:true});
_a89.push({actionID:"scrollPageUp",keyBinding:new _a88(38,null,null,null,true),predefined:true});
_a89.push({actionID:"scrollPageDown",keyBinding:new _a88(40,null,null,null,true),predefined:true});
_a89.push({actionID:"lineStart",keyBinding:new _a88(37,null,null,null,true),predefined:true});
_a89.push({actionID:"lineEnd",keyBinding:new _a88(39,null,null,null,true),predefined:true});
_a89.push({actionID:"lineStart",keyBinding:new _a88(38,null,null,true),predefined:true});
_a89.push({actionID:"lineEnd",keyBinding:new _a88(40,null,null,true),predefined:true});
}else{
_a89.push({actionID:"pageUp",keyBinding:new _a88(33),predefined:true});
_a89.push({actionID:"pageDown",keyBinding:new _a88(34),predefined:true});
_a89.push({actionID:"lineStart",keyBinding:new _a88(36),predefined:true});
_a89.push({actionID:"lineEnd",keyBinding:new _a88(35),predefined:true});
_a89.push({actionID:"wordPrevious",keyBinding:new _a88(37,true),predefined:true});
_a89.push({actionID:"wordNext",keyBinding:new _a88(39,true),predefined:true});
_a89.push({actionID:"textStart",keyBinding:new _a88(36,true),predefined:true});
_a89.push({actionID:"textEnd",keyBinding:new _a88(35,true),predefined:true});
}
if(_927&&_92f){
_a89.push({actionID:"lineUp",keyBinding:new _a88(38,true),predefined:true});
_a89.push({actionID:"lineDown",keyBinding:new _a88(40,true),predefined:true});
}
_a89.push({actionID:"selectLineUp",keyBinding:new _a88(38,null,true),predefined:true});
_a89.push({actionID:"selectLineDown",keyBinding:new _a88(40,null,true),predefined:true});
_a89.push({actionID:"selectCharPrevious",keyBinding:new _a88(37,null,true),predefined:true});
_a89.push({actionID:"selectCharNext",keyBinding:new _a88(39,null,true),predefined:true});
_a89.push({actionID:"selectPageUp",keyBinding:new _a88(33,null,true),predefined:true});
_a89.push({actionID:"selectPageDown",keyBinding:new _a88(34,null,true),predefined:true});
if(_92d){
_a89.push({actionID:"selectLineStart",keyBinding:new _a88(37,true,true),predefined:true});
_a89.push({actionID:"selectLineEnd",keyBinding:new _a88(39,true,true),predefined:true});
_a89.push({actionID:"selectWordPrevious",keyBinding:new _a88(37,null,true,true),predefined:true});
_a89.push({actionID:"selectWordNext",keyBinding:new _a88(39,null,true,true),predefined:true});
_a89.push({actionID:"selectTextStart",keyBinding:new _a88(36,null,true),predefined:true});
_a89.push({actionID:"selectTextEnd",keyBinding:new _a88(35,null,true),predefined:true});
_a89.push({actionID:"selectTextStart",keyBinding:new _a88(38,true,true),predefined:true});
_a89.push({actionID:"selectTextEnd",keyBinding:new _a88(40,true,true),predefined:true});
_a89.push({actionID:"selectLineStart",keyBinding:new _a88(37,null,true,null,true),predefined:true});
_a89.push({actionID:"selectLineEnd",keyBinding:new _a88(39,null,true,null,true),predefined:true});
_a89.push({actionID:"selectLineStart",keyBinding:new _a88(38,null,true,true),predefined:true});
_a89.push({actionID:"selectLineEnd",keyBinding:new _a88(40,null,true,true),predefined:true});
}else{
if(_92f){
_a89.push({actionID:"selectWholeLineUp",keyBinding:new _a88(38,true,true),predefined:true});
_a89.push({actionID:"selectWholeLineDown",keyBinding:new _a88(40,true,true),predefined:true});
}
_a89.push({actionID:"selectLineStart",keyBinding:new _a88(36,null,true),predefined:true});
_a89.push({actionID:"selectLineEnd",keyBinding:new _a88(35,null,true),predefined:true});
_a89.push({actionID:"selectWordPrevious",keyBinding:new _a88(37,true,true),predefined:true});
_a89.push({actionID:"selectWordNext",keyBinding:new _a88(39,true,true),predefined:true});
_a89.push({actionID:"selectTextStart",keyBinding:new _a88(36,true,true),predefined:true});
_a89.push({actionID:"selectTextEnd",keyBinding:new _a88(35,true,true),predefined:true});
}
_a89.push({actionID:"deletePrevious",keyBinding:new _a88(8),predefined:true});
_a89.push({actionID:"deletePrevious",keyBinding:new _a88(8,null,true),predefined:true});
_a89.push({actionID:"deleteNext",keyBinding:new _a88(46),predefined:true});
_a89.push({actionID:"deleteWordPrevious",keyBinding:new _a88(8,true),predefined:true});
_a89.push({actionID:"deleteWordPrevious",keyBinding:new _a88(8,true,true),predefined:true});
_a89.push({actionID:"deleteWordNext",keyBinding:new _a88(46,true),predefined:true});
_a89.push({actionID:"tab",keyBinding:new _a88(9),predefined:true});
_a89.push({actionID:"shiftTab",keyBinding:new _a88(9,null,true),predefined:true});
_a89.push({actionID:"enter",keyBinding:new _a88(13),predefined:true});
_a89.push({actionID:"enter",keyBinding:new _a88(13,null,true),predefined:true});
_a89.push({actionID:"selectAll",keyBinding:new _a88("a",true),predefined:true});
_a89.push({actionID:"toggleTabMode",keyBinding:new _a88("m",true),predefined:true});
if(_92d){
_a89.push({actionID:"deleteNext",keyBinding:new _a88(46,null,true),predefined:true});
_a89.push({actionID:"deleteWordPrevious",keyBinding:new _a88(8,null,null,true),predefined:true});
_a89.push({actionID:"deleteWordNext",keyBinding:new _a88(46,null,null,true),predefined:true});
}
if(!_927){
var _a8a=_92d&&_929;
_a89.push({actionID:null,keyBinding:new _a88("u",!_a8a,false,false,_a8a),predefined:true});
_a89.push({actionID:null,keyBinding:new _a88("i",!_a8a,false,false,_a8a),predefined:true});
_a89.push({actionID:null,keyBinding:new _a88("b",!_a8a,false,false,_a8a),predefined:true});
}
if(_927){
_a89.push({actionID:"copy",keyBinding:new _a88(45,true),predefined:true});
_a89.push({actionID:"paste",keyBinding:new _a88(45,null,true),predefined:true});
_a89.push({actionID:"cut",keyBinding:new _a88(46,null,true),predefined:true});
}
if(_92d){
_a89.push({actionID:"lineStart",keyBinding:new _a88("a",false,false,false,true),predefined:true});
_a89.push({actionID:"lineEnd",keyBinding:new _a88("e",false,false,false,true),predefined:true});
_a89.push({actionID:"lineUp",keyBinding:new _a88("p",false,false,false,true),predefined:true});
_a89.push({actionID:"lineDown",keyBinding:new _a88("n",false,false,false,true),predefined:true});
_a89.push({actionID:"charPrevious",keyBinding:new _a88("b",false,false,false,true),predefined:true});
_a89.push({actionID:"charNext",keyBinding:new _a88("f",false,false,false,true),predefined:true});
_a89.push({actionID:"deletePrevious",keyBinding:new _a88("h",false,false,false,true),predefined:true});
_a89.push({actionID:"deleteNext",keyBinding:new _a88("d",false,false,false,true),predefined:true});
_a89.push({actionID:"deleteLineEnd",keyBinding:new _a88("k",false,false,false,true),predefined:true});
if(_927){
_a89.push({actionID:"scrollPageDown",keyBinding:new _a88("v",false,false,false,true),predefined:true});
_a89.push({actionID:"deleteLineStart",keyBinding:new _a88("u",false,false,false,true),predefined:true});
_a89.push({actionID:"deleteWordPrevious",keyBinding:new _a88("w",false,false,false,true),predefined:true});
}else{
_a89.push({actionID:"pageDown",keyBinding:new _a88("v",false,false,false,true),predefined:true});
_a89.push({actionID:"centerLine",keyBinding:new _a88("l",false,false,false,true),predefined:true});
_a89.push({actionID:"enterNoCursor",keyBinding:new _a88("o",false,false,false,true),predefined:true});
}
}
var self=this;
this._actions={"lineUp":{defaultHandler:function(){
return self._doLineUp({select:false});
}},"lineDown":{defaultHandler:function(){
return self._doLineDown({select:false});
}},"lineStart":{defaultHandler:function(){
return self._doHome({select:false,ctrl:false});
}},"lineEnd":{defaultHandler:function(){
return self._doEnd({select:false,ctrl:false});
}},"charPrevious":{defaultHandler:function(){
return self._doCursorPrevious({select:false,unit:"character"});
}},"charNext":{defaultHandler:function(){
return self._doCursorNext({select:false,unit:"character"});
}},"pageUp":{defaultHandler:function(){
return self._doPageUp({select:false});
}},"pageDown":{defaultHandler:function(){
return self._doPageDown({select:false});
}},"scrollPageUp":{defaultHandler:function(){
return self._doScroll({type:"pageUp"});
}},"scrollPageDown":{defaultHandler:function(){
return self._doScroll({type:"pageDown"});
}},"wordPrevious":{defaultHandler:function(){
return self._doCursorPrevious({select:false,unit:"word"});
}},"wordNext":{defaultHandler:function(){
return self._doCursorNext({select:false,unit:"word"});
}},"textStart":{defaultHandler:function(){
return self._doHome({select:false,ctrl:true});
}},"textEnd":{defaultHandler:function(){
return self._doEnd({select:false,ctrl:true});
}},"scrollTextStart":{defaultHandler:function(){
return self._doScroll({type:"textStart"});
}},"scrollTextEnd":{defaultHandler:function(){
return self._doScroll({type:"textEnd"});
}},"centerLine":{defaultHandler:function(){
return self._doScroll({type:"centerLine"});
}},"selectLineUp":{defaultHandler:function(){
return self._doLineUp({select:true});
}},"selectLineDown":{defaultHandler:function(){
return self._doLineDown({select:true});
}},"selectWholeLineUp":{defaultHandler:function(){
return self._doLineUp({select:true,wholeLine:true});
}},"selectWholeLineDown":{defaultHandler:function(){
return self._doLineDown({select:true,wholeLine:true});
}},"selectLineStart":{defaultHandler:function(){
return self._doHome({select:true,ctrl:false});
}},"selectLineEnd":{defaultHandler:function(){
return self._doEnd({select:true,ctrl:false});
}},"selectCharPrevious":{defaultHandler:function(){
return self._doCursorPrevious({select:true,unit:"character"});
}},"selectCharNext":{defaultHandler:function(){
return self._doCursorNext({select:true,unit:"character"});
}},"selectPageUp":{defaultHandler:function(){
return self._doPageUp({select:true});
}},"selectPageDown":{defaultHandler:function(){
return self._doPageDown({select:true});
}},"selectWordPrevious":{defaultHandler:function(){
return self._doCursorPrevious({select:true,unit:"word"});
}},"selectWordNext":{defaultHandler:function(){
return self._doCursorNext({select:true,unit:"word"});
}},"selectTextStart":{defaultHandler:function(){
return self._doHome({select:true,ctrl:true});
}},"selectTextEnd":{defaultHandler:function(){
return self._doEnd({select:true,ctrl:true});
}},"deletePrevious":{defaultHandler:function(){
return self._doBackspace({unit:"character"});
}},"deleteNext":{defaultHandler:function(){
return self._doDelete({unit:"character"});
}},"deleteWordPrevious":{defaultHandler:function(){
return self._doBackspace({unit:"word"});
}},"deleteWordNext":{defaultHandler:function(){
return self._doDelete({unit:"word"});
}},"deleteLineStart":{defaultHandler:function(){
return self._doBackspace({unit:"line"});
}},"deleteLineEnd":{defaultHandler:function(){
return self._doDelete({unit:"line"});
}},"tab":{defaultHandler:function(){
return self._doTab();
}},"shiftTab":{defaultHandler:function(){
return self._doShiftTab();
}},"enter":{defaultHandler:function(){
return self._doEnter();
}},"enterNoCursor":{defaultHandler:function(){
return self._doEnter({noCursor:true});
}},"selectAll":{defaultHandler:function(){
return self._doSelectAll();
}},"copy":{defaultHandler:function(){
return self._doCopy();
}},"cut":{defaultHandler:function(){
return self._doCut();
}},"paste":{defaultHandler:function(){
return self._doPaste();
}},"toggleTabMode":{defaultHandler:function(){
return self._doTabMode();
}}};
},_createLine:function(_a8b,div,_a8c,_a8d,_a8e){
var _a8f=_a8e.getLine(_a8d);
var _a90=_a8e.getLineStart(_a8d);
var e={type:"LineStyle",textView:this,lineIndex:_a8d,lineText:_a8f,lineStart:_a90};
this.onLineStyle(e);
var _a91=div||_a8c.createElement("DIV");
if(!div||!this._compare(div.viewStyle,e.style)){
this._applyStyle(e.style,_a91,div);
if(div){
div._trim=null;
}
_a91.viewStyle=e.style;
_a91.setAttribute("role","presentation");
}
_a91.lineIndex=_a8d;
var _a92=[];
var data={tabOffset:0,ranges:_a92};
this._createRanges(e.ranges,_a8f,0,_a8f.length,_a90,data);
var c=" ";
if(!this._fullSelection&&isIE<9){
c="";
}
if(_92b){
c="";
}
_a92.push({text:c,style:this._metrics.largestFontStyle,ignoreChars:1});
var _a93,span,_a94,_a95,_a96,text,_a97,end=0,_a98=0,next;
var _a99,_a9a;
if(div){
var _a9b=div.modelChangedEvent;
if(_a9b){
if(_a9b.removedLineCount===0&&_a9b.addedLineCount===0){
_a9a=_a9b.start-_a90;
_a99=_a9b.addedCharCount-_a9b.removedCharCount;
}else{
_a9a=-1;
}
div.modelChangedEvent=undefined;
}
_a95=div.firstChild;
}
for(var i=0;i<_a92.length;i++){
_a93=_a92[i];
text=_a93.text;
end+=text.length;
_a94=_a93.style;
if(_a95){
_a97=_a95.firstChild.data;
_a96=_a95.viewStyle;
if(_a97===text&&this._compare(_a94,_a96)){
_a98+=_a97.length;
_a95._rectsCache=undefined;
span=_a95=_a95.nextSibling;
continue;
}else{
while(_a95){
if(_a9a!==-1){
var _a9c=end;
if(_a9c>=_a9a){
_a9c-=_a99;
}
var t=_a95.firstChild.data;
var _a9d=t?t.length:0;
if(_a98+_a9d>_a9c){
break;
}
_a98+=_a9d;
}
next=_a95.nextSibling;
_a91.removeChild(_a95);
_a95=next;
}
}
}
span=this._createSpan(_a91,_a8c,text,_a94,_a93.ignoreChars);
if(_a95){
_a91.insertBefore(span,_a95);
}else{
_a91.appendChild(span);
}
if(div){
div.lineWidth=undefined;
}
}
if(div){
var tmp=span?span.nextSibling:null;
while(tmp){
next=tmp.nextSibling;
div.removeChild(tmp);
tmp=next;
}
}else{
_a8b.appendChild(_a91);
}
return _a91;
},_createRanges:function(_a9e,text,_a9f,end,_aa0,data){
if(_a9f>=end){
return;
}
if(_a9e){
for(var i=0;i<_a9e.length;i++){
var _aa1=_a9e[i];
if(_aa1.end<=_aa0+_a9f){
continue;
}
var _aa2=Math.max(_aa0+_a9f,_aa1.start)-_aa0;
if(_aa2>=end){
break;
}
var _aa3=Math.min(_aa0+end,_aa1.end)-_aa0;
if(_aa2<_aa3){
_aa2=Math.max(_a9f,_aa2);
_aa3=Math.min(end,_aa3);
if(_a9f<_aa2){
this._createRange(text,_a9f,_aa2,null,data);
}
while(i+1<_a9e.length&&_a9e[i+1].start-_aa0===_aa3&&this._compare(_aa1.style,_a9e[i+1].style)){
_aa1=_a9e[i+1];
_aa3=Math.min(_aa0+end,_aa1.end)-_aa0;
i++;
}
this._createRange(text,_aa2,_aa3,_aa1.style,data);
_a9f=_aa3;
}
}
}
if(_a9f<end){
this._createRange(text,_a9f,end,null,data);
}
},_createRange:function(text,_aa4,end,_aa5,data){
if(_aa4>=end){
return;
}
var _aa6=this._customTabSize,_aa7;
if(_aa6&&_aa6!==8){
var _aa8=text.indexOf("\t",_aa4);
while(_aa8!==-1&&_aa8<end){
if(_aa4<_aa8){
_aa7={text:text.substring(_aa4,_aa8),style:_aa5};
data.ranges.push(_aa7);
data.tabOffset+=_aa7.text.length;
}
var _aa9=_aa6-(data.tabOffset%_aa6);
if(_aa9>0){
var _aaa="";
for(var i=1;i<_aa9;i++){
_aaa+=" ";
}
_aa7={text:_aaa,style:_aa5,ignoreChars:_aa9-1};
data.ranges.push(_aa7);
data.tabOffset+=_aa7.text.length;
}
_aa4=_aa8+1;
_aa8=text.indexOf("\t",_aa4);
}
}
if(_aa4<end){
_aa7={text:text.substring(_aa4,end),style:_aa5};
data.ranges.push(_aa7);
data.tabOffset+=_aa7.text.length;
}
},_createSpan:function(_aab,_aac,text,_aad,_aae){
var _aaf=_aad&&_aad.tagName==="A";
if(_aaf){
_aab.hasLink=true;
}
var _ab0=_aaf&&this._linksVisible?"A":"SPAN";
var _ab1=_aac.createElement(_ab0);
_ab1.appendChild(_aac.createTextNode(text));
this._applyStyle(_aad,_ab1);
if(_ab0==="A"){
var self=this;
_920(_ab1,"click",function(e){
return self._handleLinkClick(e);
},false);
}
_ab1.viewStyle=_aad;
if(_aae){
_ab1.ignoreChars=_aae;
}
return _ab1;
},_createRuler:function(_ab2,_ab3){
if(!this._clientDiv){
return;
}
var side=_ab2.getLocation();
var _ab4=side==="left"?this._leftDiv:this._rightDiv;
_ab4.style.display="block";
var div=document.createElement("DIV");
div._ruler=_ab2;
div.rulerChanged=true;
div.style.position="relative";
var row=_ab4.firstChild.rows[0];
var _ab5=row.cells.length;
_ab3=_ab3===undefined||_ab3<0||_ab3>_ab5?_ab5:_ab3;
var cell=row.insertCell(_ab3);
cell.vAlign="top";
cell.appendChild(div);
},_createView:function(){
if(this._clientDiv){
return;
}
var _ab6=this._parent;
while(_ab6.hasChildNodes()){
_ab6.removeChild(_ab6.lastChild);
}
var _ab7=document.createElement("DIV");
this._rootDiv=_ab7;
_ab7.tabIndex=-1;
_ab7.style.position="relative";
_ab7.style.overflow="hidden";
_ab7.style.width="100%";
_ab7.style.height="100%";
_ab6.style.overflow="hidden";
_ab7.setAttribute("role","application");
_ab6.appendChild(_ab7);
var _ab8=document.createElement("DIV");
_ab8.className="textviewLeftRuler";
this._leftDiv=_ab8;
_ab8.tabIndex=-1;
_ab8.style.overflow="hidden";
_ab8.style.MozUserSelect="none";
_ab8.style.WebkitUserSelect="none";
_ab8.style.position="absolute";
_ab8.style.cursor="default";
_ab8.style.display="none";
_ab8.setAttribute("aria-hidden","true");
var _ab9=document.createElement("TABLE");
_ab8.appendChild(_ab9);
_ab9.cellPadding="0px";
_ab9.cellSpacing="0px";
_ab9.border="0px";
_ab9.insertRow(0);
_ab7.appendChild(_ab8);
var _aba=document.createElement("DIV");
_aba.className="textview";
this._viewDiv=_aba;
_aba.tabIndex=-1;
_aba.style.overflow="auto";
_aba.style.position="absolute";
_aba.style.top="0px";
_aba.style.borderWidth="0px";
_aba.style.margin="0px";
_aba.style.outline="none";
_ab7.appendChild(_aba);
var _abb=document.createElement("DIV");
_abb.className="textviewRightRuler";
this._rightDiv=_abb;
_abb.tabIndex=-1;
_abb.style.display="none";
_abb.style.overflow="hidden";
_abb.style.MozUserSelect="none";
_abb.style.WebkitUserSelect="none";
_abb.style.position="absolute";
_abb.style.cursor="default";
_abb.setAttribute("aria-hidden","true");
_ab9=document.createElement("TABLE");
_abb.appendChild(_ab9);
_ab9.cellPadding="0px";
_ab9.cellSpacing="0px";
_ab9.border="0px";
_ab9.insertRow(0);
_ab7.appendChild(_abb);
var _abc=document.createElement("DIV");
this._scrollDiv=_abc;
_abc.style.margin="0px";
_abc.style.borderWidth="0px";
_abc.style.padding="0px";
_aba.appendChild(_abc);
if(_927){
var _abd=document.createElement("DIV");
this._clipboardDiv=_abd;
_abd.style.position="fixed";
_abd.style.whiteSpace="pre";
_abd.style.left="-1000px";
_ab7.appendChild(_abd);
}
if(!isIE&&!_92c){
var _abe=document.createElement("DIV");
this._clipDiv=_abe;
_abe.style.position="absolute";
_abe.style.overflow="hidden";
_abe.style.margin="0px";
_abe.style.borderWidth="0px";
_abe.style.padding="0px";
_ab7.appendChild(_abe);
var _abf=document.createElement("DIV");
this._clipScrollDiv=_abf;
_abf.style.position="absolute";
_abf.style.height="1px";
_abf.style.top="-1000px";
_abe.appendChild(_abf);
}
this._setFullSelection(this._fullSelection,true);
var _ac0=document.createElement("DIV");
_ac0.className="textviewContent";
this._clientDiv=_ac0;
_ac0.style.whiteSpace="pre";
_ac0.style.position="absolute";
_ac0.style.borderWidth="0px";
_ac0.style.margin="0px";
_ac0.style.padding="0px";
_ac0.style.outline="none";
_ac0.style.zIndex="1";
_ac0.style.WebkitUserSelect="text";
_ac0.setAttribute("spellcheck","false");
if(_92c){
_ac0.style.WebkitTapHighlightColor="transparent";
}
(this._clipDiv||_ab7).appendChild(_ac0);
if(_92c){
var _ac1=document.createElement("DIV");
this._vScrollDiv=_ac1;
_ac1.style.position="absolute";
_ac1.style.borderWidth="1px";
_ac1.style.borderColor="white";
_ac1.style.borderStyle="solid";
_ac1.style.borderRadius="4px";
_ac1.style.backgroundColor="black";
_ac1.style.opacity="0.5";
_ac1.style.margin="0px";
_ac1.style.padding="0px";
_ac1.style.outline="none";
_ac1.style.zIndex="3";
_ac1.style.width="8px";
_ac1.style.display="none";
_ab7.appendChild(_ac1);
var _ac2=document.createElement("DIV");
this._hScrollDiv=_ac2;
_ac2.style.position="absolute";
_ac2.style.borderWidth="1px";
_ac2.style.borderColor="white";
_ac2.style.borderStyle="solid";
_ac2.style.borderRadius="4px";
_ac2.style.backgroundColor="black";
_ac2.style.opacity="0.5";
_ac2.style.margin="0px";
_ac2.style.padding="0px";
_ac2.style.outline="none";
_ac2.style.zIndex="3";
_ac2.style.height="8px";
_ac2.style.display="none";
_ab7.appendChild(_ac2);
}
if(_927&&!_ac0.setCapture){
var _ac3=document.createElement("DIV");
this._overlayDiv=_ac3;
_ac3.style.position=_ac0.style.position;
_ac3.style.borderWidth=_ac0.style.borderWidth;
_ac3.style.margin=_ac0.style.margin;
_ac3.style.padding=_ac0.style.padding;
_ac3.style.cursor="text";
_ac3.style.zIndex="2";
(this._clipDiv||_ab7).appendChild(_ac3);
}
_ac0.contentEditable="true";
_ac0.setAttribute("role","textbox");
_ac0.setAttribute("aria-multiline","true");
this._setReadOnly(this._readonly);
this._setThemeClass(this._themeClass,true);
this._setTabSize(this._tabSize,true);
if(!document.getElementById("_textviewStyle")){
var _ac4="";
if(_92b&&this._metrics.scrollWidth>0){
_ac4+="\n.textviewContainer ::-webkit-scrollbar-corner {background: #eeeeee;}";
}
if(_927&&_92d&&this._highlightRGB&&this._highlightRGB!=="Highlight"){
_ac4+="\n.textviewContainer ::-moz-selection {background: "+this._highlightRGB+";}";
}
if(_ac4){
var _ac5=document.createElement("STYLE");
_ac5.id="_textviewStyle";
var head=document.getElementsByTagName("HEAD")[0]||document.documentElement;
_ac5.appendChild(document.createTextNode(_ac4));
head.insertBefore(_ac5,head.firstChild);
}
}
this._hookEvents();
var _ac6=this._rulers;
for(var i=0;i<_ac6.length;i++){
this._createRuler(_ac6[i]);
}
this._updatePage();
},_defaultOptions:function(){
return {parent:{value:undefined,update:null},model:{value:undefined,update:this.setModel},readonly:{value:false,update:this._setReadOnly},fullSelection:{value:true,update:this._setFullSelection},tabMode:{value:true,update:null},tabSize:{value:8,update:this._setTabSize},expandTab:{value:false,update:null},themeClass:{value:undefined,update:this._setThemeClass}};
},_destroyRuler:function(_ac7){
var side=_ac7.getLocation();
var _ac8=side==="left"?this._leftDiv:this._rightDiv;
if(_ac8){
var row=_ac8.firstChild.rows[0];
var _ac9=row.cells;
for(var _aca=0;_aca<_ac9.length;_aca++){
var cell=_ac9[_aca];
if(cell.firstChild._ruler===_ac7){
break;
}
}
if(_aca===_ac9.length){
return;
}
row.cells[_aca]._ruler=undefined;
row.deleteCell(_aca);
if(_ac9.length!==0){
_ac8.style.display="none";
}
}
},_destroyView:function(){
var _acb=this._clientDiv;
if(!_acb){
return;
}
this._setGrab(null);
this._unhookEvents();
if(this._autoScrollTimerID){
clearTimeout(this._autoScrollTimerID);
this._autoScrollTimerID=null;
}
if(this._updateTimer){
clearTimeout(this._updateTimer);
this._updateTimer=null;
}
var _acc=this._rootDiv;
_acc.parentNode.removeChild(_acc);
this._selDiv1=null;
this._selDiv2=null;
this._selDiv3=null;
this._clipboardDiv=null;
this._rootDiv=null;
this._scrollDiv=null;
this._viewDiv=null;
this._clipDiv=null;
this._clipScrollDiv=null;
this._clientDiv=null;
this._overlayDiv=null;
this._leftDiv=null;
this._rightDiv=null;
this._vScrollDiv=null;
this._hScrollDiv=null;
},_doAutoScroll:function(_acd,x,y){
this._autoScrollDir=_acd;
this._autoScrollX=x;
this._autoScrollY=y;
if(!this._autoScrollTimerID){
this._autoScrollTimer();
}
},_endAutoScroll:function(){
if(this._autoScrollTimerID){
clearTimeout(this._autoScrollTimerID);
}
this._autoScrollDir=undefined;
this._autoScrollTimerID=undefined;
},_fixCaret:function(){
var _ace=this._clientDiv;
if(_ace){
var _acf=this._hasFocus;
this._ignoreFocus=true;
if(_acf){
_ace.blur();
}
_ace.contentEditable=false;
_ace.contentEditable=true;
if(_acf){
_ace.focus();
}
this._ignoreFocus=false;
}
},_getBaseText:function(_ad0,end){
var _ad1=this._model;
if(_ad1.getBaseModel){
_ad0=_ad1.mapOffset(_ad0);
end=_ad1.mapOffset(end);
_ad1=_ad1.getBaseModel();
}
return _ad1.getText(_ad0,end);
},_getBorder:function(node){
var left,top,_ad2,_ad3;
if(window.getComputedStyle){
var _ad4=window.getComputedStyle(node,null);
left=_ad4.getPropertyValue("border-left-width");
top=_ad4.getPropertyValue("border-top-width");
_ad2=_ad4.getPropertyValue("border-right-width");
_ad3=_ad4.getPropertyValue("border-bottom-width");
}else{
if(node.currentStyle){
left=node.currentStyle.borderLeftWidth;
top=node.currentStyle.borderTopWidth;
_ad2=node.currentStyle.borderRightWidth;
_ad3=node.currentStyle.borderBottomWidth;
}
}
return {left:parseInt(left,10)||0,top:parseInt(top,10)||0,right:parseInt(_ad2,10)||0,bottom:parseInt(_ad3,10)||0};
},_getBoundsAtOffset:function(_ad5){
var _ad6=this._model;
var _ad7=this._clientDiv;
var _ad8=_ad6.getLineAtOffset(_ad5);
var _ad9;
var _ada=this._getLineNode(_ad8);
if(!_ada){
_ada=_ad9=this._createLine(_ad7,null,document,_ad8,_ad6);
}
var _adb=null;
if(_ad5<_ad6.getLineEnd(_ad8)){
var _adc=_ad6.getLineStart(_ad8);
var _add=_ada.firstChild;
while(_add){
var _ade=_add.firstChild;
var _adf=_ade.length;
if(_add.ignoreChars){
_adf-=_add.ignoreChars;
}
if(_adc+_adf>_ad5){
var _ae0=_ad5-_adc;
var _ae1;
if(_931){
_ae1=document.createRange();
_ae1.setStart(_ade,_ae0);
_ae1.setEnd(_ade,_ae0+1);
_adb=_ae1.getBoundingClientRect();
}else{
if(isIE){
_ae1=document.body.createTextRange();
_ae1.moveToElementText(_add);
_ae1.collapse();
_ae1.moveEnd("character",_ae0+1);
_ae1.moveStart("character",_ae0);
_adb=_ae1.getBoundingClientRect();
}else{
var text=_ade.data;
_add.removeChild(_ade);
_add.appendChild(document.createTextNode(text.substring(0,_ae0)));
var span=document.createElement("SPAN");
span.appendChild(document.createTextNode(text.substring(_ae0,_ae0+1)));
_add.appendChild(span);
_add.appendChild(document.createTextNode(text.substring(_ae0+1)));
_adb=span.getBoundingClientRect();
_add.innerHTML="";
_add.appendChild(_ade);
if(!_ad9){
var s=this._getSelection();
if((_adc<=s.start&&s.start<_adc+_adf)||(_adc<=s.end&&s.end<_adc+_adf)){
this._updateDOMSelection();
}
}
}
}
if(isIE){
var _ae2=window.screen.logicalXDPI;
var _ae3=window.screen.deviceXDPI;
_adb.left=_adb.left*_ae2/_ae3;
_adb.right=_adb.right*_ae2/_ae3;
}
break;
}
_adc+=_adf;
_add=_add.nextSibling;
}
}
if(!_adb){
var rect=this._getLineBoundingClientRect(_ada);
_adb={left:rect.right,right:rect.right};
}
if(_ad9){
_ad7.removeChild(_ad9);
}
return _adb;
},_getBottomIndex:function(_ae4){
var _ae5=this._bottomChild;
if(_ae4&&this._getClientHeight()>this._getLineHeight()){
var rect=_ae5.getBoundingClientRect();
var _ae6=this._clientDiv.getBoundingClientRect();
if(rect.bottom>_ae6.bottom){
_ae5=this._getLinePrevious(_ae5)||_ae5;
}
}
return _ae5.lineIndex;
},_getClientHeight:function(){
var _ae7=this._getViewPadding();
return Math.max(0,this._viewDiv.clientHeight-_ae7.top-_ae7.bottom);
},_getClientWidth:function(){
var _ae8=this._getViewPadding();
return Math.max(0,this._viewDiv.clientWidth-_ae8.left-_ae8.right);
},_getClipboardText:function(_ae9,_aea){
var _aeb=this._model.getLineDelimiter();
var _aec,text;
if(window.clipboardData){
_aec=[];
text=window.clipboardData.getData("Text");
this._convertDelimiter(text,function(t){
_aec.push(t);
},function(){
_aec.push(_aeb);
});
text=_aec.join("");
if(_aea){
_aea(text);
}
return text;
}
if(_927){
this._ignoreFocus=true;
var _aed=this._clipboardDiv;
_aed.innerHTML="<pre contenteditable=''></pre>";
_aed.firstChild.focus();
var self=this;
var _aee=function(){
var _aef=self._getTextFromElement(_aed);
_aed.innerHTML="";
_aec=[];
self._convertDelimiter(_aef,function(t){
_aec.push(t);
},function(){
_aec.push(_aeb);
});
return _aec.join("");
};
var _af0=false;
this._ignorePaste=true;
if(!_92f||this._lastMouseButton!==2){
try{
_af0=document.execCommand("paste",false,null);
}
catch(ex){
_af0=_aed.childNodes.length>1||_aed.firstChild&&_aed.firstChild.childNodes.length>0;
}
}
this._ignorePaste=false;
if(!_af0){
if(_ae9){
setTimeout(function(){
self.focus();
text=_aee();
if(text&&_aea){
_aea(text);
}
self._ignoreFocus=false;
},0);
return null;
}else{
this.focus();
this._ignoreFocus=false;
return "";
}
}
this.focus();
this._ignoreFocus=false;
text=_aee();
if(text&&_aea){
_aea(text);
}
return text;
}
if(_ae9&&_ae9.clipboardData){
_aec=[];
text=_ae9.clipboardData.getData("text/plain");
this._convertDelimiter(text,function(t){
_aec.push(t);
},function(){
_aec.push(_aeb);
});
text=_aec.join("");
if(text&&_aea){
_aea(text);
}
return text;
}else{
}
return "";
},_getDOMText:function(_af1){
var _af2=this._getLineNode(_af1);
var _af3=_af2.firstChild;
var text="";
while(_af3){
var _af4=_af3.firstChild;
while(_af4){
if(_af3.ignoreChars){
for(var i=0;i<_af4.length;i++){
var ch=_af4.data.substring(i,i+1);
if(ch!==" "){
text+=ch;
}
}
}else{
text+=_af4.data;
}
_af4=_af4.nextSibling;
}
_af3=_af3.nextSibling;
}
return text;
},_getTextFromElement:function(_af5){
var _af6=_af5.ownerDocument;
var _af7=_af6.defaultView;
if(!_af7.getSelection){
return _af5.innerText||_af5.textContent;
}
var _af8=_af6.createRange();
_af8.selectNode(_af5);
var _af9=_af7.getSelection();
var _afa=[],i;
for(i=0;i<_af9.rangeCount;i++){
_afa.push(_af9.getRangeAt(i));
}
this._ignoreSelect=true;
_af9.removeAllRanges();
_af9.addRange(_af8);
var text=_af9.toString();
_af9.removeAllRanges();
for(i=0;i<_afa.length;i++){
_af9.addRange(_afa[i]);
}
this._ignoreSelect=false;
return text;
},_getViewPadding:function(){
return this._metrics.viewPadding;
},_getLineTrim:function(line){
var trim=line._trim;
if(!trim){
trim=this._getPadding(line);
var _afb=this._getBorder(line);
trim.left+=_afb.left;
trim.top+=_afb.top;
trim.right+=_afb.right;
trim.bottom+=_afb.bottom;
line._trim=trim;
}
return trim;
},_getLineBoundingClientRect:function(_afc,_afd){
var rect=_afc.getBoundingClientRect();
rect={left:rect.left,top:rect.top,right:rect.left,bottom:rect.bottom};
var _afe=_afc.lastChild;
while(_afe&&_afe.ignoreChars===_afe.firstChild.length){
_afe=_afe.previousSibling;
}
if(_afe){
var _aff=_afe.getBoundingClientRect();
rect.right=_aff.right+this._getLineTrim(_afc).right;
}
if(_afd){
var _b00=this._getLineTrim(_afc);
rect.left=rect.left+_b00.left;
rect.right=rect.right-_b00.right;
}
return rect;
},_getLineHeight:function(){
return this._metrics.lineHeight;
},_getLineNode:function(_b01){
var _b02=this._clientDiv;
var _b03=_b02.firstChild;
while(_b03){
if(_b01===_b03.lineIndex){
return _b03;
}
_b03=_b03.nextSibling;
}
return undefined;
},_getLineNext:function(_b04){
var node=_b04?_b04.nextSibling:this._clientDiv.firstChild;
while(node&&node.lineIndex===-1){
node=node.nextSibling;
}
return node;
},_getLinePrevious:function(_b05){
var node=_b05?_b05.previousSibling:this._clientDiv.lastChild;
while(node&&node.lineIndex===-1){
node=node.previousSibling;
}
return node;
},_getOffset:function(_b06,unit,_b07){
if(unit==="line"){
var _b08=this._model;
var _b09=_b08.getLineAtOffset(_b06);
if(_b07>0){
return _b08.getLineEnd(_b09);
}
return _b08.getLineStart(_b09);
}
if(unit==="wordend"){
return this._getOffset_W3C(_b06,unit,_b07);
}
return isIE?this._getOffset_IE(_b06,unit,_b07):this._getOffset_W3C(_b06,unit,_b07);
},_getOffset_W3C:function(_b0a,unit,_b0b){
function _b0c(c){
return (33<=c&&c<=47)||(58<=c&&c<=64)||(91<=c&&c<=94)||c===96||(123<=c&&c<=126);
};
function _b0d(c){
return c===32||c===9;
};
if(unit==="word"||unit==="wordend"){
var _b0e=this._model;
var _b0f=_b0e.getLineAtOffset(_b0a);
var _b10=_b0e.getLine(_b0f);
var _b11=_b0e.getLineStart(_b0f);
var _b12=_b0e.getLineEnd(_b0f);
var _b13=_b10.length;
var _b14=_b0a-_b11;
var c,_b15,_b16,_b17,_b18;
if(_b0b>0){
if(_b14===_b13){
return _b12;
}
c=_b10.charCodeAt(_b14);
_b15=_b0c(c);
_b16=!_b15&&!_b0d(c);
_b14++;
while(_b14<_b13){
c=_b10.charCodeAt(_b14);
_b17=_b0c(c);
if(unit==="wordend"){
if(!_b17&&_b15){
break;
}
}else{
if(_b17&&!_b15){
break;
}
}
_b18=!_b17&&!_b0d(c);
if(unit==="wordend"){
if(!_b18&&_b16){
break;
}
}else{
if(_b18&&!_b16){
break;
}
}
_b16=_b18;
_b15=_b17;
_b14++;
}
}else{
if(_b14===0){
return _b11;
}
_b14--;
c=_b10.charCodeAt(_b14);
_b15=_b0c(c);
_b16=!_b15&&!_b0d(c);
while(0<_b14){
c=_b10.charCodeAt(_b14-1);
_b17=_b0c(c);
if(unit==="wordend"){
if(_b17&&!_b15){
break;
}
}else{
if(!_b17&&_b15){
break;
}
}
_b18=!_b17&&!_b0d(c);
if(unit==="wordend"){
if(_b18&&!_b16){
break;
}
}else{
if(!_b18&&_b16){
break;
}
}
_b16=_b18;
_b15=_b17;
_b14--;
}
}
return _b11+_b14;
}
return _b0a+_b0b;
},_getOffset_IE:function(_b19,unit,_b1a){
var _b1b=this._model;
var _b1c=_b1b.getLineAtOffset(_b19);
var _b1d=this._clientDiv;
var _b1e;
var _b1f=this._getLineNode(_b1c);
if(!_b1f){
_b1f=_b1e=this._createLine(_b1d,null,document,_b1c,_b1b);
}
var _b20=0,_b21,_b22;
var _b23=_b1b.getLineStart(_b1c);
if(_b19===_b1b.getLineEnd(_b1c)){
_b21=document.body.createTextRange();
_b21.moveToElementText(_b1f.lastChild);
_b22=_b21.text.length;
_b21.moveEnd(unit,_b1a);
_b20=_b19+_b21.text.length-_b22;
}else{
if(_b19===_b23&&_b1a<0){
_b20=_b23;
}else{
var _b24=_b1f.firstChild;
while(_b24){
var _b25=_b24.firstChild;
var _b26=_b25.length;
if(_b24.ignoreChars){
_b26-=_b24.ignoreChars;
}
if(_b23+_b26>_b19){
_b21=document.body.createTextRange();
if(_b19===_b23&&_b1a<0){
_b21.moveToElementText(_b24.previousSibling);
}else{
_b21.moveToElementText(_b24);
_b21.collapse();
_b21.moveEnd("character",_b19-_b23);
}
_b22=_b21.text.length;
_b21.moveEnd(unit,_b1a);
_b20=_b19+_b21.text.length-_b22;
break;
}
_b23=_b26+_b23;
_b24=_b24.nextSibling;
}
}
}
if(_b1e){
_b1d.removeChild(_b1e);
}
return _b20;
},_getOffsetToX:function(_b27){
return this._getBoundsAtOffset(_b27).left;
},_getPadding:function(node){
var left,top,_b28,_b29;
if(window.getComputedStyle){
var _b2a=window.getComputedStyle(node,null);
left=_b2a.getPropertyValue("padding-left");
top=_b2a.getPropertyValue("padding-top");
_b28=_b2a.getPropertyValue("padding-right");
_b29=_b2a.getPropertyValue("padding-bottom");
}else{
if(node.currentStyle){
left=node.currentStyle.paddingLeft;
top=node.currentStyle.paddingTop;
_b28=node.currentStyle.paddingRight;
_b29=node.currentStyle.paddingBottom;
}
}
return {left:parseInt(left,10)||0,top:parseInt(top,10)||0,right:parseInt(_b28,10)||0,bottom:parseInt(_b29,10)||0};
},_getScroll:function(){
var _b2b=this._viewDiv;
return {x:_b2b.scrollLeft,y:_b2b.scrollTop};
},_getSelection:function(){
return this._selection.clone();
},_getTopIndex:function(_b2c){
var _b2d=this._topChild;
if(_b2c&&this._getClientHeight()>this._getLineHeight()){
var rect=_b2d.getBoundingClientRect();
var _b2e=this._getViewPadding();
var _b2f=this._viewDiv.getBoundingClientRect();
if(rect.top<_b2f.top+_b2e.top){
_b2d=this._getLineNext(_b2d)||_b2d;
}
}
return _b2d.lineIndex;
},_getXToOffset:function(_b30,x){
var _b31=this._model;
var _b32=_b31.getLineStart(_b30);
var _b33=_b31.getLineEnd(_b30);
if(_b32===_b33){
return _b32;
}
var _b34=this._clientDiv;
var _b35;
var _b36=this._getLineNode(_b30);
if(!_b36){
_b36=_b35=this._createLine(_b34,null,document,_b30,_b31);
}
var _b37=this._getLineBoundingClientRect(_b36,true);
if(x<_b37.left){
x=_b37.left;
}
if(x>_b37.right){
x=_b37.right;
}
var _b38=0,_b39;
if(isIE<9){
_b39=_b36.getClientRects();
var _b3a=_b39[0].left;
for(var i=1;i<_b39.length;i++){
_b3a=Math.min(_b39[i].left,_b3a);
}
_b38=_b3a-_b37.left-this._getLineTrim(_b36).left;
}
var _b3b=this._getScroll().x;
function _b3c(_b3d){
var _b3e,_b3f,i,r;
if(!_b3d._rectsCache){
_b3e=_b3d.getClientRects();
_b3f=[_b3e.length];
for(i=0;i<_b3e.length;i++){
r=_b3e[i];
_b3f[i]={left:r.left-_b38+_b3b,top:r.top,right:r.right-_b38+_b3b,bottom:r.bottom};
}
_b3d._rectsCache=_b3f;
}
_b3e=_b3d._rectsCache;
_b3f=[_b3e.length];
for(i=0;i<_b3e.length;i++){
r=_b3e[i];
_b3f[i]={left:r.left-_b3b,top:r.top,right:r.right-_b3b,bottom:r.bottom};
}
return _b3f;
};
var _b40=isIE?window.screen.logicalXDPI:1;
var _b41=isIE?window.screen.deviceXDPI:1;
var _b42=_b32;
var _b43=_b36.firstChild;
done:
while(_b43){
var _b44=_b43.firstChild;
var _b45=_b44.length;
if(_b43.ignoreChars){
_b45-=_b43.ignoreChars;
}
_b39=_b3c(_b43);
for(var j=0;j<_b39.length;j++){
var rect=_b39[j];
if(rect.left<=x&&x<rect.right){
var _b46,_b47,end;
if(isIE||_931){
_b46=_931?document.createRange():document.body.createTextRange();
var high=_b45;
var low=-1;
while((high-low)>1){
var mid=Math.floor((high+low)/2);
_b47=low+1;
end=mid===_b45-1&&_b43.ignoreChars?_b44.length:mid+1;
if(_931){
_b46.setStart(_b44,_b47);
_b46.setEnd(_b44,end);
}else{
_b46.moveToElementText(_b43);
_b46.move("character",_b47);
_b46.moveEnd("character",end-_b47);
}
_b39=_b46.getClientRects();
var _b48=false;
for(var k=0;k<_b39.length;k++){
rect=_b39[k];
var _b49=rect.left*_b40/_b41-_b38;
var _b4a=rect.right*_b40/_b41-_b38;
if(_b49<=x&&x<_b4a){
_b48=true;
break;
}
}
if(_b48){
high=mid;
}else{
low=mid;
}
}
_b42+=high;
_b47=high;
end=high===_b45-1&&_b43.ignoreChars?_b44.length:Math.min(high+1,_b44.length);
if(_931){
_b46.setStart(_b44,_b47);
_b46.setEnd(_b44,end);
}else{
_b46.moveToElementText(_b43);
_b46.move("character",_b47);
_b46.moveEnd("character",end-_b47);
}
rect=_b46.getClientRects()[0];
if(x>((rect.left*_b40/_b41-_b38)+((rect.right-rect.left)*_b40/_b41/2))){
_b42++;
}
}else{
var _b4b=[];
for(var q=0;q<_b45;q++){
_b4b.push("<span>");
if(q===_b45-1){
_b4b.push(_b44.data.substring(q));
}else{
_b4b.push(_b44.data.substring(q,q+1));
}
_b4b.push("</span>");
}
_b43.innerHTML=_b4b.join("");
var _b4c=_b43.firstChild;
while(_b4c){
rect=_b4c.getBoundingClientRect();
if(rect.left<=x&&x<rect.right){
if(x>rect.left+(rect.right-rect.left)/2){
_b42++;
}
break;
}
_b42++;
_b4c=_b4c.nextSibling;
}
if(!_b35){
_b43.innerHTML="";
_b43.appendChild(_b44);
var s=this._getSelection();
if((_b42<=s.start&&s.start<_b42+_b45)||(_b42<=s.end&&s.end<_b42+_b45)){
this._updateDOMSelection();
}
}
}
break done;
}
}
_b42+=_b45;
_b43=_b43.nextSibling;
}
if(_b35){
_b34.removeChild(_b35);
}
return Math.min(_b33,Math.max(_b32,_b42));
},_getYToLine:function(y){
var _b4d=this._getViewPadding();
var _b4e=this._viewDiv.getBoundingClientRect();
y-=_b4e.top+_b4d.top;
var _b4f=this._getLineHeight();
var _b50=Math.floor((y+this._getScroll().y)/_b4f);
var _b51=this._model.getLineCount();
return Math.max(0,Math.min(_b51-1,_b50));
},_hookEvents:function(){
var self=this;
this._modelListener={onChanging:function(_b52){
self._onModelChanging(_b52);
},onChanged:function(_b53){
self._onModelChanged(_b53);
}};
this._model.addEventListener("Changing",this._modelListener.onChanging);
this._model.addEventListener("Changed",this._modelListener.onChanged);
var _b54=this._handlers=[];
var _b55=this._clientDiv,_b56=this._viewDiv,_b57=this._rootDiv;
var _b58=this._overlayDiv||_b55;
var _b59=isIE?document:window;
_b54.push({target:window,type:"resize",handler:function(e){
return self._handleResize(e);
}});
_b54.push({target:_b55,type:"blur",handler:function(e){
return self._handleBlur(e);
}});
_b54.push({target:_b55,type:"focus",handler:function(e){
return self._handleFocus(e);
}});
_b54.push({target:_b56,type:"focus",handler:function(e){
_b55.focus();
}});
_b54.push({target:_b56,type:"scroll",handler:function(e){
return self._handleScroll(e);
}});
_b54.push({target:_b55,type:"keydown",handler:function(e){
return self._handleKeyDown(e);
}});
_b54.push({target:_b55,type:"keypress",handler:function(e){
return self._handleKeyPress(e);
}});
_b54.push({target:_b55,type:"keyup",handler:function(e){
return self._handleKeyUp(e);
}});
_b54.push({target:_b55,type:"selectstart",handler:function(e){
return self._handleSelectStart(e);
}});
_b54.push({target:_b55,type:"contextmenu",handler:function(e){
return self._handleContextMenu(e);
}});
_b54.push({target:_b55,type:"copy",handler:function(e){
return self._handleCopy(e);
}});
_b54.push({target:_b55,type:"cut",handler:function(e){
return self._handleCut(e);
}});
_b54.push({target:_b55,type:"paste",handler:function(e){
return self._handlePaste(e);
}});
if(_92c){
_b54.push({target:document,type:"selectionchange",handler:function(e){
return self._handleSelectionChange(e);
}});
_b54.push({target:_b55,type:"touchstart",handler:function(e){
return self._handleTouchStart(e);
}});
_b54.push({target:_b55,type:"touchmove",handler:function(e){
return self._handleTouchMove(e);
}});
_b54.push({target:_b55,type:"touchend",handler:function(e){
return self._handleTouchEnd(e);
}});
}else{
_b54.push({target:_b55,type:"mousedown",handler:function(e){
return self._handleMouseDown(e);
}});
_b54.push({target:_b55,type:"mouseover",handler:function(e){
return self._handleMouseOver(e);
}});
_b54.push({target:_b55,type:"mouseout",handler:function(e){
return self._handleMouseOut(e);
}});
_b54.push({target:_b59,type:"mouseup",handler:function(e){
return self._handleMouseUp(e);
}});
_b54.push({target:_b59,type:"mousemove",handler:function(e){
return self._handleMouseMove(e);
}});
_b54.push({target:_b57,type:"mousedown",handler:function(e){
return self._handleRootMouseDown(e);
}});
_b54.push({target:_b57,type:"mouseup",handler:function(e){
return self._handleRootMouseUp(e);
}});
_b54.push({target:_b58,type:"dragstart",handler:function(e){
return self._handleDragStart(e);
}});
_b54.push({target:_b58,type:"drag",handler:function(e){
return self._handleDrag(e);
}});
_b54.push({target:_b58,type:"dragend",handler:function(e){
return self._handleDragEnd(e);
}});
_b54.push({target:_b58,type:"dragenter",handler:function(e){
return self._handleDragEnter(e);
}});
_b54.push({target:_b58,type:"dragover",handler:function(e){
return self._handleDragOver(e);
}});
_b54.push({target:_b58,type:"dragleave",handler:function(e){
return self._handleDragLeave(e);
}});
_b54.push({target:_b58,type:"drop",handler:function(e){
return self._handleDrop(e);
}});
_b54.push({target:this._clientDiv,type:_927?"DOMMouseScroll":"mousewheel",handler:function(e){
return self._handleMouseWheel(e);
}});
if(_927&&!_92e){
var _b5a=window.MutationObserver||window.MozMutationObserver;
if(_b5a){
this._mutationObserver=new _b5a(function(_b5b){
self._handleDataModified(_b5b);
});
this._mutationObserver.observe(_b55,{subtree:true,characterData:true});
}else{
_b54.push({target:this._clientDiv,type:"DOMCharacterDataModified",handler:function(e){
return self._handleDataModified(e);
}});
}
}
if(this._overlayDiv){
_b54.push({target:this._overlayDiv,type:"mousedown",handler:function(e){
return self._handleMouseDown(e);
}});
_b54.push({target:this._overlayDiv,type:"mouseover",handler:function(e){
return self._handleMouseOver(e);
}});
_b54.push({target:this._overlayDiv,type:"mouseout",handler:function(e){
return self._handleMouseOut(e);
}});
_b54.push({target:this._overlayDiv,type:"contextmenu",handler:function(e){
return self._handleContextMenu(e);
}});
}
if(!_930){
_b54.push({target:this._clientDiv,type:"dblclick",handler:function(e){
return self._handleDblclick(e);
}});
}
}
var _b5c=this._leftDiv,_b5d=this._rightDiv;
if(isIE){
_b54.push({target:_b5c,type:"selectstart",handler:function(){
return false;
}});
}
_b54.push({target:_b5c,type:_927?"DOMMouseScroll":"mousewheel",handler:function(e){
return self._handleMouseWheel(e);
}});
_b54.push({target:_b5c,type:"click",handler:function(e){
self._handleRulerEvent(e);
}});
_b54.push({target:_b5c,type:"dblclick",handler:function(e){
self._handleRulerEvent(e);
}});
_b54.push({target:_b5c,type:"mousemove",handler:function(e){
self._handleRulerEvent(e);
}});
_b54.push({target:_b5c,type:"mouseover",handler:function(e){
self._handleRulerEvent(e);
}});
_b54.push({target:_b5c,type:"mouseout",handler:function(e){
self._handleRulerEvent(e);
}});
if(isIE){
_b54.push({target:_b5d,type:"selectstart",handler:function(){
return false;
}});
}
_b54.push({target:_b5d,type:_927?"DOMMouseScroll":"mousewheel",handler:function(e){
return self._handleMouseWheel(e);
}});
_b54.push({target:_b5d,type:"click",handler:function(e){
self._handleRulerEvent(e);
}});
_b54.push({target:_b5d,type:"dblclick",handler:function(e){
self._handleRulerEvent(e);
}});
_b54.push({target:_b5d,type:"mousemove",handler:function(e){
self._handleRulerEvent(e);
}});
_b54.push({target:_b5d,type:"mouseover",handler:function(e){
self._handleRulerEvent(e);
}});
_b54.push({target:_b5d,type:"mouseout",handler:function(e){
self._handleRulerEvent(e);
}});
for(var i=0;i<_b54.length;i++){
var h=_b54[i];
_920(h.target,h.type,h.handler,h.capture);
}
},_init:function(_b5e){
var _b5f=_b5e.parent;
if(typeof (_b5f)==="string"){
_b5f=window.document.getElementById(_b5f);
}
if(!_b5f){
throw "no parent";
}
_b5e.parent=_b5f;
_b5e.model=_b5e.model||new _91d.TextModel();
var _b60=this._defaultOptions();
for(var _b61 in _b60){
if(_b60.hasOwnProperty(_b61)){
var _b62;
if(_b5e[_b61]!==undefined){
_b62=_b5e[_b61];
}else{
_b62=_b60[_b61].value;
}
this["_"+_b61]=_b62;
}
}
this._rulers=[];
this._selection=new _933(0,0,false);
this._linksVisible=false;
this._redrawCount=0;
this._maxLineWidth=0;
this._maxLineIndex=-1;
this._ignoreSelect=true;
this._ignoreFocus=false;
this._hasFocus=false;
this._columnX=-1;
this._dragOffset=-1;
this._autoScrollX=null;
this._autoScrollY=null;
this._autoScrollTimerID=null;
this._AUTO_SCROLL_RATE=50;
this._grabControl=null;
this._moseMoveClosure=null;
this._mouseUpClosure=null;
this._lastMouseX=0;
this._lastMouseY=0;
this._lastMouseTime=0;
this._clickCount=0;
this._clickTime=250;
this._clickDist=5;
this._isMouseDown=false;
this._doubleClickSelection=null;
this._hScroll=0;
this._vScroll=0;
this._imeOffset=-1;
this._createActions();
this._createView();
},_isLinkURL:function(_b63){
return _b63.toLowerCase().lastIndexOf(".css")===_b63.length-4;
},_modifyContent:function(e,_b64){
if(this._readonly&&!e._code){
return;
}
e.type="Verify";
this.onVerify(e);
if(e.text===null||e.text===undefined){
return;
}
var _b65=this._model;
try{
if(e._ignoreDOMSelection){
this._ignoreDOMSelection=true;
}
_b65.setText(e.text,e.start,e.end);
}
finally{
if(e._ignoreDOMSelection){
this._ignoreDOMSelection=false;
}
}
if(_b64){
var _b66=this._getSelection();
_b66.setCaret(e.start+e.text.length);
this._setSelection(_b66,true);
}
this.onModify({type:"Modify"});
},_onModelChanged:function(_b67){
_b67.type="ModelChanged";
this.onModelChanged(_b67);
_b67.type="Changed";
var _b68=_b67.start;
var _b69=_b67.addedCharCount;
var _b6a=_b67.removedCharCount;
var _b6b=_b67.addedLineCount;
var _b6c=_b67.removedLineCount;
var _b6d=this._getSelection();
if(_b6d.end>_b68){
if(_b6d.end>_b68&&_b6d.start<_b68+_b6a){
_b6d.setCaret(_b68+_b69);
}else{
_b6d.start+=_b69-_b6a;
_b6d.end+=_b69-_b6a;
}
this._setSelection(_b6d,false,false);
}
var _b6e=this._model;
var _b6f=_b6e.getLineAtOffset(_b68);
var _b70=this._getLineNext();
while(_b70){
var _b71=_b70.lineIndex;
if(_b6f<=_b71&&_b71<=_b6f+_b6c){
if(_b6f===_b71&&!_b70.modelChangedEvent&&!_b70.lineRemoved){
_b70.modelChangedEvent=_b67;
_b70.lineChanged=true;
}else{
_b70.lineRemoved=true;
_b70.lineChanged=false;
_b70.modelChangedEvent=null;
}
}
if(_b71>_b6f+_b6c){
_b70.lineIndex=_b71+_b6b-_b6c;
}
_b70=this._getLineNext(_b70);
}
if(_b6f<=this._maxLineIndex&&this._maxLineIndex<=_b6f+_b6c){
this._checkMaxLineIndex=this._maxLineIndex;
this._maxLineIndex=-1;
this._maxLineWidth=0;
}
this._updatePage();
},_onModelChanging:function(_b72){
_b72.type="ModelChanging";
this.onModelChanging(_b72);
_b72.type="Changing";
},_queueUpdatePage:function(){
if(this._updateTimer){
return;
}
var self=this;
this._updateTimer=setTimeout(function(){
self._updateTimer=null;
self._updatePage();
},0);
},_resetLineWidth:function(){
var _b73=this._clientDiv;
if(_b73){
var _b74=_b73.firstChild;
while(_b74){
_b74.lineWidth=undefined;
_b74=_b74.nextSibling;
}
}
},_reset:function(){
this._maxLineIndex=-1;
this._maxLineWidth=0;
this._columnX=-1;
this._topChild=null;
this._bottomChild=null;
this._partialY=0;
this._setSelection(new _933(0,0,false),false,false);
if(this._viewDiv){
this._viewDiv.scrollLeft=0;
this._viewDiv.scrollTop=0;
}
var _b75=this._clientDiv;
if(_b75){
var _b76=_b75.firstChild;
while(_b76){
_b76.lineRemoved=true;
_b76=_b76.nextSibling;
}
if(_927){
this._ignoreFocus=false;
var _b77=this._hasFocus;
if(_b77){
_b75.blur();
}
_b75.contentEditable=false;
_b75.contentEditable=true;
if(_b77){
_b75.focus();
}
this._ignoreFocus=false;
}
}
},_scrollView:function(_b78,_b79){
this._ensureCaretVisible=false;
var _b7a=this._viewDiv;
if(_b78){
_b7a.scrollLeft+=_b78;
}
if(_b79){
_b7a.scrollTop+=_b79;
}
},_setClipboardText:function(text,_b7b){
var _b7c;
if(window.clipboardData){
_b7c=[];
this._convertDelimiter(text,function(t){
_b7c.push(t);
},function(){
_b7c.push(_932);
});
return window.clipboardData.setData("Text",_b7c.join(""));
}
if(_b7b&&_b7b.clipboardData){
_b7c=[];
this._convertDelimiter(text,function(t){
_b7c.push(t);
},function(){
_b7c.push(_932);
});
if(_b7b.clipboardData.setData("text/plain",_b7c.join(""))){
return true;
}
}
var _b7d=document.createElement("PRE");
_b7d.style.position="fixed";
_b7d.style.left="-1000px";
this._convertDelimiter(text,function(t){
_b7d.appendChild(document.createTextNode(t));
},function(){
_b7d.appendChild(document.createElement("BR"));
});
_b7d.appendChild(document.createTextNode(" "));
this._clientDiv.appendChild(_b7d);
var _b7e=document.createRange();
_b7e.setStart(_b7d.firstChild,0);
_b7e.setEndBefore(_b7d.lastChild);
var sel=window.getSelection();
if(sel.rangeCount>0){
sel.removeAllRanges();
}
sel.addRange(_b7e);
var self=this;
var _b7f=function(){
if(_b7d&&_b7d.parentNode===self._clientDiv){
self._clientDiv.removeChild(_b7d);
}
self._updateDOMSelection();
};
var _b80=false;
this._ignoreCopy=true;
try{
_b80=document.execCommand("copy",false,null);
}
catch(e){
}
this._ignoreCopy=false;
if(!_b80){
if(_b7b){
setTimeout(_b7f,0);
return false;
}
}
_b7f();
return true;
},_setDOMSelection:function(_b81,_b82,_b83,_b84){
var _b85,_b86,_b87,_b88;
var _b89=0;
var _b8a=_b81.firstChild;
var node,_b8b,_b8c=this._model;
var _b8d=_b8c.getLine(_b81.lineIndex).length;
while(_b8a){
node=_b8a.firstChild;
_b8b=node.length;
if(_b8a.ignoreChars){
_b8b-=_b8a.ignoreChars;
}
if(_b89+_b8b>_b82||_b89+_b8b>=_b8d){
_b85=node;
_b86=_b82-_b89;
if(_b8a.ignoreChars&&_b8b>0&&_b86===_b8b){
_b86+=_b8a.ignoreChars;
}
break;
}
_b89+=_b8b;
_b8a=_b8a.nextSibling;
}
_b89=0;
_b8a=_b83.firstChild;
var _b8e=this._model.getLine(_b83.lineIndex).length;
while(_b8a){
node=_b8a.firstChild;
_b8b=node.length;
if(_b8a.ignoreChars){
_b8b-=_b8a.ignoreChars;
}
if(_b8b+_b89>_b84||_b89+_b8b>=_b8e){
_b87=node;
_b88=_b84-_b89;
if(_b8a.ignoreChars&&_b8b>0&&_b88===_b8b){
_b88+=_b8a.ignoreChars;
}
break;
}
_b89+=_b8b;
_b8a=_b8a.nextSibling;
}
this._setDOMFullSelection(_b81,_b82,_b8d,_b83,_b84,_b8e);
if(!this._hasFocus){
return;
}
var _b8f;
if(window.getSelection){
_b8f=document.createRange();
_b8f.setStart(_b85,_b86);
_b8f.setEnd(_b87,_b88);
var sel=window.getSelection();
this._ignoreSelect=false;
if(sel.rangeCount>0){
sel.removeAllRanges();
}
sel.addRange(_b8f);
this._ignoreSelect=true;
}else{
if(document.selection){
var body=document.body;
var _b90=document.createElement("DIV");
body.appendChild(_b90);
body.removeChild(_b90);
_b8f=body.createTextRange();
_b8f.moveToElementText(_b85.parentNode);
_b8f.moveStart("character",_b86);
var _b91=body.createTextRange();
_b91.moveToElementText(_b87.parentNode);
_b91.moveStart("character",_b88);
_b8f.setEndPoint("EndToStart",_b91);
this._ignoreSelect=false;
_b8f.select();
this._ignoreSelect=true;
}
}
},_setDOMFullSelection:function(_b92,_b93,_b94,_b95,_b96,_b97){
if(!this._selDiv1){
return;
}
var _b98=this._selDiv1;
_b98.style.width="0px";
_b98.style.height="0px";
_b98=this._selDiv2;
_b98.style.width="0px";
_b98.style.height="0px";
_b98=this._selDiv3;
_b98.style.width="0px";
_b98.style.height="0px";
if(_b92===_b95&&_b93===_b96){
return;
}
var _b99=this._model;
var _b9a=this._getViewPadding();
var _b9b=this._clientDiv.getBoundingClientRect();
var _b9c=this._viewDiv.getBoundingClientRect();
var left=_b9c.left+_b9a.left;
var _b9d=_b9b.right;
var top=_b9c.top+_b9a.top;
var _b9e=_b9b.bottom;
var hd=0,vd=0;
if(this._clipDiv){
var _b9f=this._clipDiv.getBoundingClientRect();
hd=_b9f.left-this._clipDiv.scrollLeft;
vd=_b9f.top;
}else{
var _ba0=this._rootDiv.getBoundingClientRect();
hd=_ba0.left;
vd=_ba0.top;
}
var _ba1,l;
_ba1=this._getLineBoundingClientRect(_b92);
if(_b93===0){
l=_ba1.left;
}else{
if(_b93>=_b94){
l=_ba1.right;
}else{
this._ignoreDOMSelection=true;
l=this._getBoundsAtOffset(_b99.getLineStart(_b92.lineIndex)+_b93).left;
this._ignoreDOMSelection=false;
}
}
var r;
var _ba2=this._getLineBoundingClientRect(_b95);
if(_b96===0){
r=_ba2.left;
}else{
if(_b96>=_b97){
r=_ba2.right;
}else{
this._ignoreDOMSelection=true;
r=this._getBoundsAtOffset(_b99.getLineStart(_b95.lineIndex)+_b96).left;
this._ignoreDOMSelection=false;
}
}
var _ba3=this._selDiv1;
var _ba4=Math.min(_b9d,Math.max(left,l));
var _ba5=Math.min(_b9e,Math.max(top,_ba1.top));
var _ba6=_b9d;
var _ba7=Math.min(_b9e,Math.max(top,_ba1.bottom));
_ba3.style.left=(_ba4-hd)+"px";
_ba3.style.top=(_ba5-vd)+"px";
_ba3.style.width=Math.max(0,_ba6-_ba4)+"px";
_ba3.style.height=Math.max(0,_ba7-_ba5)+"px";
if(_b92===_b95){
_ba6=Math.min(r,_b9d);
_ba3.style.width=Math.max(0,_ba6-_ba4)+"px";
}else{
var _ba8=left;
var _ba9=Math.min(_b9e,Math.max(top,_ba2.top));
var _baa=Math.min(_b9d,Math.max(left,r));
var _bab=Math.min(_b9e,Math.max(top,_ba2.bottom));
var _bac=this._selDiv3;
_bac.style.left=(_ba8-hd)+"px";
_bac.style.top=(_ba9-vd)+"px";
_bac.style.width=Math.max(0,_baa-_ba8)+"px";
_bac.style.height=Math.max(0,_bab-_ba9)+"px";
if(_ba9-_ba7>0){
var _bad=this._selDiv2;
_bad.style.left=(left-hd)+"px";
_bad.style.top=(_ba7-vd)+"px";
_bad.style.width=Math.max(0,_b9d-left)+"px";
_bad.style.height=Math.max(0,_ba9-_ba7)+"px";
}
}
},_setGrab:function(_bae){
if(_bae===this._grabControl){
return;
}
if(_bae){
if(_bae.setCapture){
_bae.setCapture();
}
this._grabControl=_bae;
}else{
if(this._grabControl.releaseCapture){
this._grabControl.releaseCapture();
}
this._grabControl=null;
}
},_setLinksVisible:function(_baf){
if(this._linksVisible===_baf){
return;
}
this._linksVisible=_baf;
if(isIE&&_baf){
this._hadFocus=this._hasFocus;
}
var _bb0=this._clientDiv;
_bb0.contentEditable=!_baf;
if(this._hadFocus&&!_baf){
_bb0.focus();
}
if(this._overlayDiv){
this._overlayDiv.style.zIndex=_baf?"-1":"1";
}
var line=this._getLineNext();
while(line){
if(line.hasLink){
var _bb1=line.firstChild;
while(_bb1){
var next=_bb1.nextSibling;
var _bb2=_bb1.viewStyle;
if(_bb2&&_bb2.tagName==="A"){
line.replaceChild(this._createSpan(line,document,_bb1.firstChild.data,_bb2),_bb1);
}
_bb1=next;
}
}
line=this._getLineNext(line);
}
},_setSelection:function(_bb3,_bb4,_bb5,_bb6){
if(_bb3){
this._columnX=-1;
if(_bb5===undefined){
_bb5=true;
}
var _bb7=this._selection;
if(!_bb7.equals(_bb3)){
this._selection=_bb3;
var e={type:"Selection",oldValue:{start:_bb7.start,end:_bb7.end},newValue:{start:_bb3.start,end:_bb3.end}};
this.onSelection(e);
}
if(_bb4){
_bb5=!this._showCaret(false,_bb6);
}
if(_bb5){
this._updateDOMSelection();
}
}
},_setSelectionTo:function(x,y,_bb8,drag){
var _bb9=this._model,_bba;
var _bbb=this._getSelection();
var _bbc=this._getYToLine(y);
if(this._clickCount===1){
_bba=this._getXToOffset(_bbc,x);
if(drag&&!_bb8){
if(_bbb.start<=_bba&&_bba<_bbb.end){
this._dragOffset=_bba;
return false;
}
}
_bbb.extend(_bba);
if(!_bb8){
_bbb.collapse();
}
}else{
var word=(this._clickCount&1)===0;
var _bbd,end;
if(word){
_bba=this._getXToOffset(_bbc,x);
if(this._doubleClickSelection){
if(_bba>=this._doubleClickSelection.start){
_bbd=this._doubleClickSelection.start;
end=this._getOffset(_bba,"wordend",+1);
}else{
_bbd=this._getOffset(_bba,"word",-1);
end=this._doubleClickSelection.end;
}
}else{
_bbd=this._getOffset(_bba,"word",-1);
end=this._getOffset(_bbd,"wordend",+1);
}
}else{
if(this._doubleClickSelection){
var _bbe=_bb9.getLineAtOffset(this._doubleClickSelection.start);
if(_bbc>=_bbe){
_bbd=_bb9.getLineStart(_bbe);
end=_bb9.getLineEnd(_bbc);
}else{
_bbd=_bb9.getLineStart(_bbc);
end=_bb9.getLineEnd(_bbe);
}
}else{
_bbd=_bb9.getLineStart(_bbc);
end=_bb9.getLineEnd(_bbc);
}
}
_bbb.setCaret(_bbd);
_bbb.extend(end);
}
this._setSelection(_bbb,true,true);
return true;
},_setFullSelection:function(_bbf,init){
this._fullSelection=_bbf;
if(_92b){
this._fullSelection=true;
}
var _bc0=this._clipDiv||this._rootDiv;
if(!_bc0){
return;
}
if(!this._fullSelection){
if(this._selDiv1){
_bc0.removeChild(this._selDiv1);
this._selDiv1=null;
}
if(this._selDiv2){
_bc0.removeChild(this._selDiv2);
this._selDiv2=null;
}
if(this._selDiv3){
_bc0.removeChild(this._selDiv3);
this._selDiv3=null;
}
return;
}
if(!this._selDiv1&&(this._fullSelection&&!_92c)){
this._highlightRGB=_92b?"transparent":"Highlight";
var _bc1=document.createElement("DIV");
this._selDiv1=_bc1;
_bc1.style.position="absolute";
_bc1.style.borderWidth="0px";
_bc1.style.margin="0px";
_bc1.style.padding="0px";
_bc1.style.outline="none";
_bc1.style.background=this._highlightRGB;
_bc1.style.width="0px";
_bc1.style.height="0px";
_bc1.style.zIndex="0";
_bc0.appendChild(_bc1);
var _bc2=document.createElement("DIV");
this._selDiv2=_bc2;
_bc2.style.position="absolute";
_bc2.style.borderWidth="0px";
_bc2.style.margin="0px";
_bc2.style.padding="0px";
_bc2.style.outline="none";
_bc2.style.background=this._highlightRGB;
_bc2.style.width="0px";
_bc2.style.height="0px";
_bc2.style.zIndex="0";
_bc0.appendChild(_bc2);
var _bc3=document.createElement("DIV");
this._selDiv3=_bc3;
_bc3.style.position="absolute";
_bc3.style.borderWidth="0px";
_bc3.style.margin="0px";
_bc3.style.padding="0px";
_bc3.style.outline="none";
_bc3.style.background=this._highlightRGB;
_bc3.style.width="0px";
_bc3.style.height="0px";
_bc3.style.zIndex="0";
_bc0.appendChild(_bc3);
if(_927&&_92d){
var _bc4=window.getComputedStyle(_bc3,null);
var rgb=_bc4.getPropertyValue("background-color");
switch(rgb){
case "rgb(119, 141, 168)":
rgb="rgb(199, 208, 218)";
break;
case "rgb(127, 127, 127)":
rgb="rgb(198, 198, 198)";
break;
case "rgb(255, 193, 31)":
rgb="rgb(250, 236, 115)";
break;
case "rgb(243, 70, 72)":
rgb="rgb(255, 176, 139)";
break;
case "rgb(255, 138, 34)":
rgb="rgb(255, 209, 129)";
break;
case "rgb(102, 197, 71)":
rgb="rgb(194, 249, 144)";
break;
case "rgb(140, 78, 184)":
rgb="rgb(232, 184, 255)";
break;
default:
rgb="rgb(180, 213, 255)";
break;
}
this._highlightRGB=rgb;
_bc1.style.background=rgb;
_bc2.style.background=rgb;
_bc3.style.background=rgb;
}
if(!init){
this._updateDOMSelection();
}
}
},_setReadOnly:function(_bc5){
this._readonly=_bc5;
this._clientDiv.setAttribute("aria-readonly",_bc5?"true":"false");
},_setTabSize:function(_bc6,init){
this._tabSize=_bc6;
this._customTabSize=undefined;
var _bc7=this._clientDiv;
if(_928){
if(_bc7){
_bc7.style.OTabSize=this._tabSize+"";
}
}else{
if(_927>=4){
if(_bc7){
_bc7.style.MozTabSize=this._tabSize+"";
}
}else{
if(this._tabSize!==8){
this._customTabSize=this._tabSize;
}
}
}
if(!init){
this.redrawLines();
this._resetLineWidth();
}
},_setThemeClass:function(_bc8,init){
this._themeClass=_bc8;
var _bc9="textviewContainer";
if(this._themeClass){
_bc9+=" "+this._themeClass;
}
this._rootDiv.className=_bc9;
this._updateStyle(init);
},_showCaret:function(_bca,_bcb){
if(!this._clientDiv){
return;
}
var _bcc=this._model;
var _bcd=this._getSelection();
var _bce=this._getScroll();
var _bcf=_bcd.getCaret();
var _bd0=_bcd.start;
var end=_bcd.end;
var _bd1=_bcc.getLineAtOffset(_bd0);
var _bd2=_bcc.getLineAtOffset(end);
var _bd3=Math.max(Math.max(_bd0,_bcc.getLineStart(_bd2)),end-1);
var _bd4=this._getViewPadding();
var _bd5=this._getClientWidth();
var _bd6=_bd4.left;
var _bd7=_bd4.left+_bd5;
var _bd8=this._getBoundsAtOffset(_bcf===_bd0?_bd0:_bd3);
var left=_bd8.left;
var _bd9=_bd8.right;
var _bda=_bd5/4;
if(_bca&&!_bcd.isEmpty()&&_bd1===_bd2){
_bd8=this._getBoundsAtOffset(_bcf===end?_bd0:_bd3);
var _bdb=_bcf===_bd0?_bd8.right-left:_bd9-_bd8.left;
if((_bd5-_bda)>_bdb){
if(left>_bd8.left){
left=_bd8.left;
}
if(_bd9<_bd8.right){
_bd9=_bd8.right;
}
}
}
var _bdc=this._viewDiv.getBoundingClientRect();
left-=_bdc.left;
_bd9-=_bdc.left;
var _bdd=0;
if(left<_bd6){
_bdd=Math.min(left-_bd6,-_bda);
}
if(_bd9>_bd7){
var _bde=this._scrollDiv.scrollWidth-_bce.x-_bd5;
_bdd=Math.min(_bde,Math.max(_bd9-_bd7,_bda));
}
var _bdf=0;
var _be0=this._getTopIndex(true);
var _be1=this._getBottomIndex(true);
var _be2=_bcc.getLineAtOffset(_bcf);
var _be3=this._getClientHeight();
if(!(_be0<=_be2&&_be2<=_be1)){
var _be4=this._getLineHeight();
var _be5=_bca?(_bd2-_bd1)*_be4:0;
_bdf=_be2*_be4;
_bdf-=_bce.y;
if(_bdf+_be4>_be3){
_bdf-=_be3-_be4;
if(_bcf===_bd0&&_bd0!==end){
_bdf+=Math.min(_be3-_be4,_be5);
}
}else{
if(_bcf===end){
_bdf-=Math.min(_be3-_be4,_be5);
}
}
if(_bcb){
if(_bcb>0){
if(_bdf>0){
_bdf=Math.max(_bdf,_bcb);
}
}else{
if(_bdf<0){
_bdf=Math.min(_bdf,_bcb);
}
}
}
}
if(_bdd!==0||_bdf!==0){
this._scrollView(_bdd,_bdf);
if(_be3!==this._getClientHeight()||_bd5!==this._getClientWidth()){
this._showCaret();
}else{
this._ensureCaretVisible=true;
}
return true;
}
return false;
},_startIME:function(){
if(this._imeOffset!==-1){
return;
}
var _be6=this._getSelection();
if(!_be6.isEmpty()){
this._modifyContent({text:"",start:_be6.start,end:_be6.end},true);
}
this._imeOffset=_be6.start;
},_unhookEvents:function(){
this._model.removeEventListener("Changing",this._modelListener.onChanging);
this._model.removeEventListener("Changed",this._modelListener.onChanged);
this._modelListener=null;
for(var i=0;i<this._handlers.length;i++){
var h=this._handlers[i];
_923(h.target,h.type,h.handler);
}
this._handlers=null;
if(this._mutationObserver){
this._mutationObserver.disconnect();
this._mutationObserver=null;
}
},_updateDOMSelection:function(){
if(this._ignoreDOMSelection){
return;
}
if(!this._clientDiv){
return;
}
var _be7=this._getSelection();
var _be8=this._model;
var _be9=_be8.getLineAtOffset(_be7.start);
var _bea=_be8.getLineAtOffset(_be7.end);
var _beb=this._getLineNext();
if(!_beb){
return;
}
var _bec=this._getLinePrevious();
var _bed,_bee,_bef,_bf0;
if(_be9<_beb.lineIndex){
_bed=_beb;
_bef=0;
}else{
if(_be9>_bec.lineIndex){
_bed=_bec;
_bef=0;
}else{
_bed=this._getLineNode(_be9);
_bef=_be7.start-_be8.getLineStart(_be9);
}
}
if(_bea<_beb.lineIndex){
_bee=_beb;
_bf0=0;
}else{
if(_bea>_bec.lineIndex){
_bee=_bec;
_bf0=0;
}else{
_bee=this._getLineNode(_bea);
_bf0=_be7.end-_be8.getLineStart(_bea);
}
}
this._setDOMSelection(_bed,_bef,_bee,_bf0);
},_updatePage:function(_bf1){
if(this._redrawCount>0){
return;
}
if(this._updateTimer){
clearTimeout(this._updateTimer);
this._updateTimer=null;
_bf1=false;
}
var _bf2=this._clientDiv;
if(!_bf2){
return;
}
var _bf3=this._model;
var _bf4=this._getScroll();
var _bf5=this._getViewPadding();
var _bf6=_bf3.getLineCount();
var _bf7=this._getLineHeight();
var _bf8=Math.max(0,_bf4.y)/_bf7;
var _bf9=Math.floor(_bf8);
var _bfa=Math.max(0,_bf9-1);
var top=Math.round((_bf8-_bfa)*_bf7);
var _bfb=this._partialY=Math.round((_bf8-_bf9)*_bf7);
var _bfc,_bfd=_bf6*_bf7;
var _bfe,_bff,_c00,_c01;
if(_bf1){
_c00=this._getClientWidth();
_c01=this._getClientHeight();
_bfe=0;
if(this._leftDiv){
_bff=this._leftDiv.getBoundingClientRect();
_bfe=_bff.right-_bff.left;
}
_bfc=Math.max(this._maxLineWidth,_c00);
}else{
var _c02=this._parent;
var _c03=this._rootDiv;
var _c04=_c02.clientWidth;
var _c05=_c02.clientHeight;
var _c06=this._viewDiv;
_c06.style.height=Math.max(0,(_c05-_bf5.top-_bf5.bottom))+"px";
_c01=this._getClientHeight();
var _c07=Math.floor((_c01+_bfb)/_bf7);
var _c08=Math.min(_bf9+_c07,_bf6-1);
var _c09=Math.min(_c08+1,_bf6-1);
var _c0a,_c0b;
var _c0c=_bf2.firstChild;
while(_c0c){
_c0a=_c0c.lineIndex;
var _c0d=_c0c.nextSibling;
if(!(_bfa<=_c0a&&_c0a<=_c09)||_c0c.lineRemoved||_c0c.lineIndex===-1){
if(this._mouseWheelLine===_c0c){
_c0c.style.display="none";
_c0c.lineIndex=-1;
}else{
_bf2.removeChild(_c0c);
}
}
_c0c=_c0d;
}
_c0c=this._getLineNext();
var frag=document.createDocumentFragment();
for(_c0a=_bfa;_c0a<=_c09;_c0a++){
if(!_c0c||_c0c.lineIndex>_c0a){
this._createLine(frag,null,document,_c0a,_bf3);
}else{
if(frag.firstChild){
_bf2.insertBefore(frag,_c0c);
frag=document.createDocumentFragment();
}
if(_c0c&&_c0c.lineChanged){
_c0c=this._createLine(frag,_c0c,document,_c0a,_bf3);
_c0c.lineChanged=false;
}
_c0c=this._getLineNext(_c0c);
}
}
if(frag.firstChild){
_bf2.insertBefore(frag,_c0c);
}
if(_92b){
_bf2.style.width="auto";
}
var rect;
_c0c=this._getLineNext();
while(_c0c){
_c0b=_c0c.lineWidth;
if(_c0b===undefined){
rect=this._getLineBoundingClientRect(_c0c);
_c0b=_c0c.lineWidth=Math.ceil(rect.right-rect.left);
}
if(_c0b>=this._maxLineWidth){
this._maxLineWidth=_c0b;
this._maxLineIndex=_c0c.lineIndex;
}
if(_c0c.lineIndex===_bf9){
this._topChild=_c0c;
}
if(_c0c.lineIndex===_c08){
this._bottomChild=_c0c;
}
if(this._checkMaxLineIndex===_c0c.lineIndex){
this._checkMaxLineIndex=-1;
}
_c0c=this._getLineNext(_c0c);
}
if(this._checkMaxLineIndex!==-1){
_c0a=this._checkMaxLineIndex;
this._checkMaxLineIndex=-1;
if(0<=_c0a&&_c0a<_bf6){
var _c0e=this._createLine(_bf2,null,document,_c0a,_bf3);
rect=this._getLineBoundingClientRect(_c0e);
_c0b=rect.right-rect.left;
if(_c0b>=this._maxLineWidth){
this._maxLineWidth=_c0b;
this._maxLineIndex=_c0a;
}
_bf2.removeChild(_c0e);
}
}
this._updateRuler(this._leftDiv,_bf9,_c08);
this._updateRuler(this._rightDiv,_bf9,_c08);
_bfe=0;
if(this._leftDiv){
_bff=this._leftDiv.getBoundingClientRect();
_bfe=_bff.right-_bff.left;
}
var _c0f=0;
if(this._rightDiv){
var _c10=this._rightDiv.getBoundingClientRect();
_c0f=_c10.right-_c10.left;
}
_c06.style.left=_bfe+"px";
_c06.style.width=Math.max(0,_c04-_bfe-_c0f-_bf5.left-_bf5.right)+"px";
if(this._rightDiv){
this._rightDiv.style.left=(_c04-_c0f)+"px";
}
var _c11=this._scrollDiv;
_c11.style.height=_bfd+"px";
_c00=this._getClientWidth();
var _c12=Math.max(this._maxLineWidth,_c00);
_bfc=_c12;
if(!isIE||isIE>=9){
_c12+=_bf5.right;
}
_c11.style.width=_c12+"px";
if(this._clipScrollDiv){
this._clipScrollDiv.style.width=_c12+"px";
}
_bf4=this._getScroll();
var _c13=_c01+_bf5.top+_bf5.bottom;
this._updateRulerSize(this._leftDiv,_c13);
this._updateRulerSize(this._rightDiv,_c13);
}
if(this._vScrollDiv){
var _c14=_c01-8;
var _c15=Math.max(15,Math.ceil(Math.min(1,_c14/(_bfd+_bf5.top+_bf5.bottom))*_c14));
this._vScrollDiv.style.left=(_bfe+_c00-8)+"px";
this._vScrollDiv.style.top=Math.floor(Math.max(0,(_bf4.y*_c14/_bfd)))+"px";
this._vScrollDiv.style.height=_c15+"px";
}
if(this._hScrollDiv){
var _c16=_c00-8;
var _c17=Math.max(15,Math.ceil(Math.min(1,_c16/(this._maxLineWidth+_bf5.left+_bf5.right))*_c16));
this._hScrollDiv.style.left=_bfe+Math.floor(Math.max(0,Math.floor(_bf4.x*_c16/this._maxLineWidth)))+"px";
this._hScrollDiv.style.top=(_c01-9)+"px";
this._hScrollDiv.style.width=_c17+"px";
}
var left=_bf4.x;
var _c18=this._clipDiv;
var _c19=this._overlayDiv;
var _c1a,_c1b;
if(_c18){
_c18.scrollLeft=left;
_c1a=_bfe+_bf5.left;
_c1b=_bf5.top;
var _c1c=_c00;
var _c1d=_c01;
var _c1e=0,_c1f=-top;
if(_bf4.x===0){
_c1a-=_bf5.left;
_c1c+=_bf5.left;
_c1e=_bf5.left;
}
if(_bf4.x+_c00===_bfc){
_c1c+=_bf5.right;
}
if(_bf4.y===0){
_c1b-=_bf5.top;
_c1d+=_bf5.top;
_c1f+=_bf5.top;
}
if(_bf4.y+_c01===_bfd){
_c1d+=_bf5.bottom;
}
_c18.style.left=_c1a+"px";
_c18.style.top=_c1b+"px";
_c18.style.width=_c1c+"px";
_c18.style.height=_c1d+"px";
_bf2.style.left=_c1e+"px";
_bf2.style.top=_c1f+"px";
_bf2.style.width=_bfc+"px";
_bf2.style.height=(_c01+top)+"px";
if(_c19){
_c19.style.left=_bf2.style.left;
_c19.style.top=_bf2.style.top;
_c19.style.width=_bf2.style.width;
_c19.style.height=_bf2.style.height;
}
}else{
_c1a=left;
_c1b=top;
var _c20=left+_c00;
var _c21=top+_c01;
if(_c1a===0){
_c1a-=_bf5.left;
}
if(_c1b===0){
_c1b-=_bf5.top;
}
if(_c20===_bfc){
_c20+=_bf5.right;
}
if(_bf4.y+_c01===_bfd){
_c21+=_bf5.bottom;
}
_bf2.style.clip="rect("+_c1b+"px,"+_c20+"px,"+_c21+"px,"+_c1a+"px)";
_bf2.style.left=(-left+_bfe+_bf5.left)+"px";
_bf2.style.width=(_92b?_bfc:_c00+left)+"px";
if(!_bf1){
_bf2.style.top=(-top+_bf5.top)+"px";
_bf2.style.height=(_c01+top)+"px";
}
if(_c19){
_c19.style.clip=_bf2.style.clip;
_c19.style.left=_bf2.style.left;
_c19.style.width=_bf2.style.width;
if(!_bf1){
_c19.style.top=_bf2.style.top;
_c19.style.height=_bf2.style.height;
}
}
}
this._updateDOMSelection();
var _c22=this._ensureCaretVisible;
this._ensureCaretVisible=false;
if(_c01!==this._getClientHeight()){
this._updatePage();
if(_c22){
this._showCaret();
}
}
},_updateRulerSize:function(_c23,_c24){
if(!_c23){
return;
}
var _c25=this._partialY;
var _c26=this._getLineHeight();
var _c27=_c23.firstChild.rows[0].cells;
for(var i=0;i<_c27.length;i++){
var div=_c27[i].firstChild;
var _c28=_c26;
if(div._ruler.getOverview()==="page"){
_c28+=_c25;
}
div.style.top=-_c28+"px";
div.style.height=(_c24+_c28)+"px";
div=div.nextSibling;
}
_c23.style.height=_c24+"px";
},_updateRuler:function(_c29,_c2a,_c2b){
if(!_c29){
return;
}
var _c2c=_c29.firstChild.rows[0].cells;
var _c2d=this._getLineHeight();
var _c2e=this._getViewPadding();
for(var i=0;i<_c2c.length;i++){
var div=_c2c[i].firstChild;
var _c2f=div._ruler;
if(div.rulerChanged){
this._applyStyle(_c2f.getRulerStyle(),div);
}
var _c30;
var _c31=div.firstChild;
if(_c31){
_c30=_c31;
_c31=_c31.nextSibling;
}else{
_c30=document.createElement("DIV");
_c30.style.visibility="hidden";
div.appendChild(_c30);
}
var _c32,_c33;
if(div.rulerChanged){
if(_c30){
_c32=-1;
_c33=_c2f.getWidestAnnotation();
if(_c33){
this._applyStyle(_c33.style,_c30);
if(_c33.html){
_c30.innerHTML=_c33.html;
}
}
_c30.lineIndex=_c32;
_c30.style.height=(_c2d+_c2e.top)+"px";
}
}
var _c34=_c2f.getOverview(),_c35,frag,_c36;
if(_c34==="page"){
_c36=_c2f.getAnnotations(_c2a,_c2b+1);
while(_c31){
_c32=_c31.lineIndex;
var _c37=_c31.nextSibling;
if(!(_c2a<=_c32&&_c32<=_c2b)||_c31.lineChanged){
div.removeChild(_c31);
}
_c31=_c37;
}
_c31=div.firstChild.nextSibling;
frag=document.createDocumentFragment();
for(_c32=_c2a;_c32<=_c2b;_c32++){
if(!_c31||_c31.lineIndex>_c32){
_c35=document.createElement("DIV");
_c33=_c36[_c32];
if(_c33){
this._applyStyle(_c33.style,_c35);
if(_c33.html){
_c35.innerHTML=_c33.html;
}
_c35.annotation=_c33;
}
_c35.lineIndex=_c32;
_c35.style.height=_c2d+"px";
frag.appendChild(_c35);
}else{
if(frag.firstChild){
div.insertBefore(frag,_c31);
frag=document.createDocumentFragment();
}
if(_c31){
_c31=_c31.nextSibling;
}
}
}
if(frag.firstChild){
div.insertBefore(frag,_c31);
}
}else{
var _c38=this._getClientHeight();
var _c39=this._model.getLineCount();
var _c3a=_c2d*_c39;
var _c3b=_c38+_c2e.top+_c2e.bottom-2*this._metrics.scrollWidth;
var _c3c;
if(_c3a<_c3b){
_c3c=_c2d;
}else{
_c3c=_c3b/_c39;
}
if(div.rulerChanged){
var _c3d=div.childNodes.length;
while(_c3d>1){
div.removeChild(div.lastChild);
_c3d--;
}
_c36=_c2f.getAnnotations(0,_c39);
frag=document.createDocumentFragment();
for(var prop in _c36){
_c32=prop>>>0;
if(_c32<0){
continue;
}
_c35=document.createElement("DIV");
_c33=_c36[prop];
this._applyStyle(_c33.style,_c35);
_c35.style.position="absolute";
_c35.style.top=this._metrics.scrollWidth+_c2d+Math.floor(_c32*_c3c)+"px";
if(_c33.html){
_c35.innerHTML=_c33.html;
}
_c35.annotation=_c33;
_c35.lineIndex=_c32;
frag.appendChild(_c35);
}
div.appendChild(frag);
}else{
if(div._oldTrackHeight!==_c3b){
_c35=div.firstChild?div.firstChild.nextSibling:null;
while(_c35){
_c35.style.top=this._metrics.scrollWidth+_c2d+Math.floor(_c35.lineIndex*_c3c)+"px";
_c35=_c35.nextSibling;
}
}
}
div._oldTrackHeight=_c3b;
}
div.rulerChanged=false;
div=div.nextSibling;
}
},_updateStyle:function(init){
if(!init&&isIE){
this._rootDiv.style.lineHeight="normal";
}
var _c3e=this._metrics=this._calculateMetrics();
if(isIE){
this._rootDiv.style.lineHeight=(_c3e.lineHeight-(_c3e.lineTrim.top+_c3e.lineTrim.bottom))+"px";
}else{
this._rootDiv.style.lineHeight="normal";
}
if(!init){
this.redraw();
this._resetLineWidth();
}
}};
_91f.EventTarget.addMixin(_939.prototype);
return {TextView:_939};
});
},"davinci/review/model/resource/Empty":function(){
define(["dojo/_base/declare","davinci/model/resource/Resource"],function(_c3f,_c40){
return _c3f("davinci.review.model.resource.Empty",_c40,{constructor:function(args){
this.elementType="Folder";
this.name="root";
this.parent=null;
},getChildren:function(){
return this.children;
}});
});
},"davinci/html/HTMLText":function(){
define(["dojo/_base/declare","davinci/html/HTMLItem"],function(_c41,_c42){
return _c41("davinci.html.HTMLText",_c42,{constructor:function(_c43){
this.elementType="HTMLText";
this.value=_c43||"";
},getText:function(_c44){
return this.value;
},setText:function(_c45){
if(this.wasParsed||(this.parent&&this.parent.wasParsed)){
var _c46=_c45.length-this.value.length;
if(_c46>0){
this.getHTMLFile().updatePositions(this.startOffset+1,_c46);
}
}
this.value=_c45;
},getLabel:function(){
if(this.value.length<15){
return this.value;
}
return this.value.substring(0,15)+"...";
}});
});
},"url:davinci/ui/widgets/templates/projectToolbar.html":"<div class='projectToolbar'>\t \n\t<table cellSpacing=\"0\" cellPadding=\"0\" border=\"0\">\n\t<tr>\n\t<td width=\"16px\"><td width=\"4px\"></td></td>\n\t<td width=\"100%\">\n\t<div class=\"projectSelection\" dojoType=\"davinci.ui.widgets.ProjectSelection\" dojoAttachPoint=\"_projectSelection\"></div>\n\t</td>\n\t\n\t\n\t<td width=\"16px\">\n\t<div class=\"projectToolbarDeleteIcon\" dojoAttachPoint=\"_projectDelete\" dojoAttachEvent=\"onclick:_delete\"></div>\n\t</td>\n\t<td width=\"16px\">\n\t<div class=\"projectToolbarRenameIcon\" dojoAttachPoint=\"_projectRename\" dojoAttachEvent=\"onclick:_rename\"></div>\n\t</td>\n\t<td width=\"16px\">&nbsp;</td>\n\t</tr>\n\t</table>\n</div>","dojo/html":function(){
define("dojo/html",["./_base/kernel","./_base/lang","./_base/array","./_base/declare","./dom","./dom-construct","./parser"],function(_c47,lang,_c48,_c49,dom,_c4a,_c4b){
var html={};
lang.setObject("dojo.html",html);
var _c4c=0;
html._secureForInnerHtml=function(cont){
return cont.replace(/(?:\s*<!DOCTYPE\s[^>]+>|<title[^>]*>[\s\S]*?<\/title>)/ig,"");
};
html._emptyNode=_c4a.empty;
html._setNodeContent=function(node,cont){
_c4a.empty(node);
if(cont){
if(typeof cont=="string"){
cont=_c4a.toDom(cont,node.ownerDocument);
}
if(!cont.nodeType&&lang.isArrayLike(cont)){
for(var _c4d=cont.length,i=0;i<cont.length;i=_c4d==cont.length?i+1:0){
_c4a.place(cont[i],node,"last");
}
}else{
_c4a.place(cont,node,"last");
}
}
return node;
};
html._ContentSetter=_c49("dojo.html._ContentSetter",null,{node:"",content:"",id:"",cleanContent:false,extractContent:false,parseContent:false,parserScope:_c47._scopeName,startup:true,constructor:function(_c4e,node){
lang.mixin(this,_c4e||{});
node=this.node=dom.byId(this.node||node);
if(!this.id){
this.id=["Setter",(node)?node.id||node.tagName:"",_c4c++].join("_");
}
},set:function(cont,_c4f){
if(undefined!==cont){
this.content=cont;
}
if(_c4f){
this._mixin(_c4f);
}
this.onBegin();
this.setContent();
var ret=this.onEnd();
if(ret&&ret.then){
return ret;
}else{
return this.node;
}
},setContent:function(){
var node=this.node;
if(!node){
throw new Error(this.declaredClass+": setContent given no node");
}
try{
node=html._setNodeContent(node,this.content);
}
catch(e){
var _c50=this.onContentError(e);
try{
node.innerHTML=_c50;
}
catch(e){
console.error("Fatal "+this.declaredClass+".setContent could not change content due to "+e.message,e);
}
}
this.node=node;
},empty:function(){
if(this.parseDeferred){
if(!this.parseDeferred.isResolved()){
this.parseDeferred.cancel();
}
delete this.parseDeferred;
}
if(this.parseResults&&this.parseResults.length){
_c48.forEach(this.parseResults,function(w){
if(w.destroy){
w.destroy();
}
});
delete this.parseResults;
}
html._emptyNode(this.node);
},onBegin:function(){
var cont=this.content;
if(lang.isString(cont)){
if(this.cleanContent){
cont=html._secureForInnerHtml(cont);
}
if(this.extractContent){
var _c51=cont.match(/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im);
if(_c51){
cont=_c51[1];
}
}
}
this.empty();
this.content=cont;
return this.node;
},onEnd:function(){
if(this.parseContent){
this._parse();
}
return this.node;
},tearDown:function(){
delete this.parseResults;
delete this.parseDeferred;
delete this.node;
delete this.content;
},onContentError:function(err){
return "Error occurred setting content: "+err;
},onExecError:function(err){
return "Error occurred executing scripts: "+err;
},_mixin:function(_c52){
var _c53={},key;
for(key in _c52){
if(key in _c53){
continue;
}
this[key]=_c52[key];
}
},_parse:function(){
var _c54=this.node;
try{
var _c55={};
_c48.forEach(["dir","lang","textDir"],function(name){
if(this[name]){
_c55[name]=this[name];
}
},this);
var self=this;
this.parseDeferred=_c4b.parse({rootNode:_c54,noStart:!this.startup,inherited:_c55,scope:this.parserScope}).then(function(_c56){
return self.parseResults=_c56;
});
}
catch(e){
this._onError("Content",e,"Error parsing in _ContentSetter#"+this.id);
}
},_onError:function(type,err,_c57){
var _c58=this["on"+type+"Error"].call(this,err);
if(_c57){
console.error(_c57,err);
}else{
if(_c58){
html._setNodeContent(this.node,_c58,true);
}
}
}});
html.set=function(node,cont,_c59){
if(undefined==cont){
console.warn("dojo.html.set: no cont argument provided, using empty string");
cont="";
}
if(!_c59){
return html._setNodeContent(node,cont,true);
}else{
var op=new html._ContentSetter(lang.mixin(_c59,{content:cont,node:node}));
return op.set();
}
};
return html;
});
},"davinci/review/widgets/OpenReviewDialog":function(){
define(["dojo/_base/declare","dijit/_Templated","dijit/_Widget","dijit/Tree","davinci/review/view/CommentExplorerView","davinci/review/model/ReviewTreeModel","davinci/Workbench","dojo/i18n!davinci/ui/nls/ui","dojo/i18n!dijit/nls/common","dojo/text!./templates/OpenReviewDialog.html","dijit/form/Button","dijit/layout/ContentPane"],function(_c5a,_c5b,_c5c,Tree,_c5d,_c5e,_c5f,_c60,_c61,_c62){
return _c5a("davinci.ui.widgets.OpenFile",[_c5c,_c5b],{widgetsInTemplate:true,templateString:_c62,fileDialogFileName:null,fileDialogParentFolder:null,postMixInProperties:function(){
dojo.mixin(this,_c60);
dojo.mixin(this,_c61);
if(!this.finishButtonLabel){
this.finishButtonLabel=_c60.open;
}
this.inherited(arguments);
},postCreate:function(){
this.inherited(arguments);
var _c63=new _c5e();
this.model=_c63;
var tree=this.tree=new Tree({id:"openReviewDialogTree",persist:false,showRoot:false,model:_c63,labelAttr:"name",childrenAttrs:"children",getIconClass:_c5d.getIconClass,getLabelClass:_c5d.getLabelClass,transforms:_c5d.getSortTransforms()});
this.treeContentPane.set("content",tree);
tree.watch("selectedItems",dojo.hitch(this,this._updateFields));
},startup:function(){
this.tree.startup();
},_updateFields:function(){
this.okButton.set("disabled",true);
this._selectedResource=null;
var _c64=this.tree.get("selectedItems");
if(_c64&&_c64.length==1){
var _c65=_c64[0];
if(_c65.elementType=="ReviewFile"){
this.okButton.set("disabled",false);
this._selectedResource=_c65;
}
}
},_okButton:function(){
if(this._selectedResource){
var item=this._selectedResource;
davinci.Workbench.openEditor({fileName:item,content:item.getText()});
this.cancel=false;
}
},_cancelButton:function(){
this.onClose();
},resize:function(_c66){
this.treeContentPane.resize(_c66);
},onClose:function(){
}});
});
},"davinci/review/actions/ViewFileAction":function(){
define(["dojo/_base/declare","./_ReviewNavigatorCommon","davinci/Runtime",],function(_c67,_c68,_c69){
var _c6a=_c67("davinci.review.actions.ViewFileAction",[_c68],{run:function(_c6b){
var _c6c=this._getSelection(_c6b);
if(!_c6c||!_c6c.length){
return;
}
var item=_c6c[0].resource;
davinci.Workbench.openEditor({fileName:item,content:item.getText()});
},shouldShow:function(_c6d){
return true;
},isEnabled:function(_c6e){
var _c6f=this._getSelection(_c6e);
if(!_c6f||_c6f.length===0){
return false;
}
var item=_c6f[0].resource;
return item.elementType=="ReviewFile";
}});
return _c6a;
});
},"davinci/ve/actions/DeleteAction":function(){
define("davinci/ve/actions/DeleteAction",["dojo/_base/declare","davinci/Workbench","davinci/ve/actions/ContextAction","davinci/commands/CompoundCommand","davinci/ve/commands/RemoveCommand"],function(_c70,_c71,_c72,_c73,_c74){
return _c70("davinci.ve.actions.DeleteAction",[_c72],{run:function(_c75){
_c75=this.fixupContext(_c75);
if(_c75){
var _c76=this._normalizeSelection(_c75);
if(_c76.length>0){
var _c77=undefined;
if(_c76.length===1){
var w=_c76[0];
var _c78=w.getHelper();
if(_c78&&_c78.getRemoveCommand){
_c77=_c78.getRemoveCommand(w);
}else{
_c77=new _c74(w);
}
}else{
_c77=new _c73();
dojo.forEach(_c76,function(w){
var c;
var _c79=w.getHelper();
if(_c79&&_c79.getRemoveCommand){
c=_c79.getRemoveCommand(w);
}else{
c=new _c74(w);
}
_c77.add(c);
});
}
_c75.select(null);
_c75.getCommandStack().execute(_c77);
}
}
},isEnabled:function(_c7a){
_c7a=this.fixupContext(_c7a);
var e=_c71.getOpenEditor();
if(e&&_c7a){
var _c7b=(_c7a.getSelection().length>0);
if(e.declaredClass=="davinci.ve.PageEditor"){
var _c7c=e.getDisplayMode();
return _c7b&&_c7c!="source";
}else{
return _c7b;
}
}else{
return false;
}
},shouldShow:function(_c7d){
_c7d=this.fixupContext(_c7d);
var _c7e=_c7d?_c7d.editor:null;
return (_c7e&&_c7e.declaredClass=="davinci.ve.PageEditor");
}});
});
},"davinci/ui/ThemeSetsDialog":function(){
require({cache:{"url:davinci/ui/templates/ThemeSetsDialog.html":"<div>\n\t<div class=\"dijitDialogPaneContentArea\">\n\t\t<table style=\"width: 90%\">\n\t\t\t<tr>\n\t\t\t\t\t<td style=\"width:40%; vertical-align: top;\">\n\t\t\t\t\t\t\t<table> \n\t\t\t\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t\t\t\t\t<td style=\" vertical-align: top;\" >\n\t\t\t\t\t\t\t\t\t\t\t\t\t<label>${uiNLS.themeSets}</label><select  id=\"theme_select_themeset_theme_select\" name=\"theme_select_themeset_theme_select\" size=\"10\" style=\"margin-bottom: 5px; width: 190px;\" ></select>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<div id=\"toolbar1\" data-dojo-type=\"dijit.Toolbar\" class=\"toolbaredContainer_toolbarDiv davinciToolbar\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div data-dojo-type=\"dijit.form.Button\" id=\"theme_select_themeset_add\" data-dojo-props=\"iconClass:'viewActionIcon addThemeSetIcon', showLabel:false \">${uiNLS.addThemeSet}</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span data-dojo-type=\"dijit.ToolbarSeparator\"></span>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div data-dojo-type=\"dijit.form.Button\" id=\"theme_select_themeset_delete\" data-dojo-props=\"iconClass:'viewActionIcon removeThemeSetIcon', showLabel:false \">${uiNLS.deleteThemeSet}</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t </div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t\t\t\t\t<td><div style=\"border-right: 1px solid #ccc; width: 1px; height: 250px; margin-left: 10px; margin-top: 10px;\"></div></td>\n\t\t\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t\t\t\t\t<td></td><td></td>\n\t\t\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t\t</table>\n\t\t\t\t\t</td>\n\t\t\t\t\t<td>\n\t\t\t\t\t\t\t<table style=\"width: 100%; margin-left:10px; margin-right:10px;\">\n\t\t\t\t\t\t\t\t\t<tr><td colspan=\"2\">${uiNLS.currentlySelectedThemeSet}</td><tr>\n\t\t\t\t\t\t\t\t\t<tr><td style=\"width: 18%;\">${uiNLS.themeSetName}</td><td style=\"text-align: center;\"><input dojoType=\"dijit.form.TextBox\" id=\"theme_select_themeset_theme_select_textbox\" readonly= \"true\" style=\"width: 175px;\" ></input><input type=\"button\" dojoType=\"dijit.form.Button\" id=\"theme_select_rename_button\" label=\"Rename\" style=\"margin-left: 5px;\"></td></tr>\n\t\t\t\t\t\t\t</table>\n\t\t\t\t\t\t\t<div style=\"border-top: 1px solid; top: 231px; border-top-color: #ccc; left: 429px; width: 300px; height: 11px; margin-top: 6px; margin-left:10px;\"></div>\n\t\t\t\t\t\t\t<table style=\"margin-left: 15px; width: 100%;\">\n\t\t\t\t\t\t\t\t\t<tr><td style=\"width: 139px;\">${uiNLS.desktopTheme}</td><td><select dojoType=\"dijit.form.Select\" id=\"theme_select_desktop_theme_select\"type=\"text\"  style=\"width: 175px;\"  ></select></td></tr>\n\t\t\t\t\t\t\t\t\t<tr><td>${uiNLS.mobileTheme}</td><td><select dojoType=\"dijit.form.Select\" id=\"theme_select_mobile_theme_select\"type=\"text\"  style=\"width: 175px;\" ></select></td></tr>\n\t\t\t\t\t\t\t</table>\n\t\t\t\t\t\t\t<table id=\"theme_select_devices_table\" style=\"margin-left:30px; border-collapse: separate; border-spacing: 0 0; width: 100%\">\n\t\t\t\t\t\t\t<tr><td style=\"width: 129px;\">${uiNLS.android}</td><td><select dojoType=\"dijit.form.Select\" id=\"theme_select_android_select\" type=\"text\"  style=\"width: 150px;\"></select></td></tr>\n\t\t\t\t\t\t\t<tr><td>${uiNLS.blackberry}</td><td><select dojoType=\"dijit.form.Select\" id=\"theme_select_blackberry_select\" type=\"text\"  style=\"width: 150px;\"></select></td></tr>\n\t\t\t\t\t\t\t<tr><td>${uiNLS.ipad}</td><td><select dojoType=\"dijit.form.Select\" id=\"theme_select_ipad_select\" type=\"text\"  style=\"width: 150px;\"></select></td></tr>\n\t\t\t\t\t\t\t<tr><td>${uiNLS.iphone}</td><td><select dojoType=\"dijit.form.Select\" id=\"theme_select_iphone_select\" type=\"text\"  style=\"width: 150px;\"></select></td></tr>\n\t\t\t\t\t\t\t<tr><td>${uiNLS.other}</td><td><select dojoType=\"dijit.form.Select\" id=\"theme_select_other_select\" type=\"text\"  style=\"width: 150px;\"></select></td></tr>\n\t\t\t\t\t\t\t</table>\n\t\t\n\t\t\t\t\t </td>\n\t\t\t </tr>\n\t\t</table>\n\t</div>\n\t<div class=\"dijitDialogPaneActionBar\">\n\t\t<button dojoType=\"dijit.form.Button\" id=\"theme_select_ok_button\" label=\"${uiNLS.save}\" class=\"maqPrimaryButton\" type=\"submit\"></button>\n\t\t<button dojoType=\"dijit.form.Button\" id=\"theme_select_cancel_button\" label=\"${commonNLS.buttonCancel}\" class=\"maqSecondaryButton\"></button>\n\t</div>\n</div>\n","url:davinci/ui/templates/ThemeSetsRenameDialog.html":"<div>\n\t<div class=\"dijitDialogPaneContentArea\">\n\t\t${uiNLS.themeSetName} <input data-dojo-type=\"dijit.form.ValidationTextBox\" data-dojo-props=\"regExp:'[a-zA-z0-9_]+', required:true, invalidMessage:'Invalid Text.'\" id=\"theme_select_themeset_rename_textbox\" style=\"width: 175px;\"/>\n\t</div>\n\n\t<div class=\"dijitDialogPaneActionBar\">\n\t\t<button type=\"button\" dojoType=\"dijit.form.Button\" id=\"theme_set_rename_ok_button\" label=\"${uiNLS.renameButtonLabel}\" class=\"maqPrimaryButton\" type=\"submit\"></button>\n\t\t<button type=\"button\" dojoType=\"dijit.form.Button\" id=\"theme_set_rename_cancel_button\" label=\"${commonNLS.buttonCancel}\" class=\"maqSecondaryButton\"></button>\n\t</div>\n</div>\n"}});
define("davinci/ui/ThemeSetsDialog",["dojo/_base/declare","davinci/ui/Dialog","dijit/_Widget","dijit/_Templated","davinci/workbench/Preferences","davinci/Workbench","davinci/library","dojo/text!./templates/ThemeSetsDialog.html","dojo/text!./templates/ThemeSetsRenameDialog.html","dojo/i18n!davinci/ui/nls/ui","dojo/i18n!dijit/nls/common","davinci/Theme","dijit/form/ValidationTextBox","dijit/form/Button","dijit/Toolbar"],function(_c7f,_c80,_c81,_c82,_c83,_c84,_c85,_c86,_c87,_c88,_c89,_c8a){
_c7f("davinci.ui.ThemeSetsDialogWidget",[_c81,_c82],{templateString:_c86,widgetsInTemplate:true,uiNLS:_c88,commonNLS:_c89});
_c7f("davinci.ui.ThemeSetsDialogRenameWidget",[_c81,_c82],{templateString:_c87,widgetsInTemplate:true,uiNLS:_c88,commonNLS:_c89});
return dojo.declare("davinci.ui.ThemeSetsDialog",null,{constructor:function(){
this._connections=[];
this._dialog=new _c80({id:"manageThemeSets",title:_c88.themeSetsDialog,contentStyle:{width:580}});
dojo.connect(this._dialog,"onCancel",this,"onClose");
this._dojoThemeSets=_c83.getPreferences("maqetta.dojo.themesets",_c84.getProject());
if(!this._dojoThemeSets){
this._dojoThemeSets=_c8a.dojoThemeSets;
_c83.savePreferences("maqetta.dojo.themesets",_c84.getProject(),this._dojoThemeSets);
}
if(!this._dojoThemeSets.themeSets[0]){
this._dojoThemeSets.themeSets.push(dojo.clone(_c8a.custom_themeset));
_c83.savePreferences("maqetta.dojo.themesets",_c84.getProject(),this._dojoThemeSets);
}
this._dojoThemeSets=dojo.clone(this._dojoThemeSets);
this._dialog.attr("content",new davinci.ui.ThemeSetsDialogWidget({}));
this._connections.push(dojo.connect(dojo.byId("theme_select_themeset_theme_select"),"onchange",this,"onChange"));
this._connections.push(dojo.connect(dijit.byId("theme_select_themeset_add"),"onClick",this,"addThemeSet"));
this._connections.push(dojo.connect(dijit.byId("theme_select_themeset_delete"),"onClick",this,"deleteThemeSet"));
this._connections.push(dojo.connect(dijit.byId("theme_select_rename_button"),"onClick",this,"renameThemeSet"));
this._connections.push(dojo.connect(dijit.byId("theme_select_desktop_theme_select"),"onChange",this,"onDesktopChange"));
this._connections.push(dojo.connect(dijit.byId("theme_select_mobile_theme_select"),"onChange",this,"onMobileChange"));
this._connections.push(dojo.connect(dijit.byId("theme_select_ok_button"),"_onSubmit",this,"onOk"));
this._connections.push(dojo.connect(dijit.byId("theme_select_cancel_button"),"onClick",this,"onClose"));
this._connections.push(dojo.connect(dijit.byId("theme_select_android_select"),"onChange",this,"onAndroidThemeChange"));
this._connections.push(dojo.connect(dijit.byId("theme_select_blackberry_select"),"onChange",this,"onBlackberryThemeChange"));
this._connections.push(dojo.connect(dijit.byId("theme_select_ipad_select"),"onChange",this,"oniPadThemeChange"));
this._connections.push(dojo.connect(dijit.byId("theme_select_iphone_select"),"onChange",this,"oniPhoneThemeChange"));
this._connections.push(dojo.connect(dijit.byId("theme_select_other_select"),"onChange",this,"onOtherThemeChange"));
this.addThemeSets();
this._selectedThemeSet=this._dojoThemeSets.themeSets[0];
dijit.byId("theme_select_themeset_theme_select_textbox").attr("value",this._selectedThemeSet.name);
this.addThemes(this._selectedThemeSet);
this._dialog.show();
},addThemeSets:function(){
var _c8b=dojo.byId("theme_select_themeset_theme_select");
for(var i=0;i<this._dojoThemeSets.themeSets.length;i++){
var c=dojo.doc.createElement("option");
c.innerHTML=this._dojoThemeSets.themeSets[i].name;
c.value=this._dojoThemeSets.themeSets[i].name;
if(i===0){
c.selected="1";
}
_c8b.appendChild(c);
}
},addThemes:function(_c8c){
this._themeData=_c85.getThemes(_c84.getProject(),this.workspaceOnly);
var _c8d=dijit.byId("theme_select_desktop_theme_select");
_c8d.options=[];
var _c8e=dijit.byId("theme_select_android_select");
_c8e.options=[];
var _c8f=dijit.byId("theme_select_blackberry_select");
_c8f.options=[];
var _c90=dijit.byId("theme_select_ipad_select");
_c90.options=[];
var _c91=dijit.byId("theme_select_iphone_select");
_c91.options=[];
var _c92=dijit.byId("theme_select_other_select");
_c92.options=[];
var _c93=dijit.byId("theme_select_mobile_theme_select");
_c8d.options=[];
_c93.options=[];
_c93.addOption({value:_c8a.default_theme,label:_c8a.default_theme});
this._themeCount=this._themeData.length;
for(var i=0;i<this._themeData.length;i++){
var opt={value:this._themeData[i].name,label:this._themeData[i].name};
if(this._themeData[i].type==="dojox.mobile"){
_c93.addOption(opt);
_c8e.addOption(opt);
_c8f.addOption(opt);
_c90.addOption(opt);
_c91.addOption(opt);
_c92.addOption(opt);
}else{
_c8d.addOption(opt);
}
}
_c8d.attr("value",_c8c.desktopTheme);
for(var d=0;d<_c8c.mobileTheme.length;d++){
var _c94=_c8c.mobileTheme[d].device.toLowerCase();
switch(_c94){
case "android":
_c8e.attr("value",_c8c.mobileTheme[d].theme);
break;
case "blackberry":
_c8f.attr("value",_c8c.mobileTheme[d].theme);
break;
case "ipad":
_c90.attr("value",_c8c.mobileTheme[d].theme);
break;
case "iphone":
_c91.attr("value",_c8c.mobileTheme[d].theme);
break;
case "other":
_c92.attr("value",_c8c.mobileTheme[d].theme);
break;
}
}
if(_c8a.singleMobileTheme(_c8c)){
_c93.attr("value",_c8c.mobileTheme[_c8c.mobileTheme.length-1].theme);
}else{
_c93.attr("value",_c8a.default_theme);
this.onMobileChange(_c8a.default_theme);
}
},addThemeSet:function(e){
var _c95;
if(this._selectedThemeSet){
_c95=dojo.clone(this._selectedThemeSet);
}else{
_c95=dojo.clone(_c8a.default_themeset);
}
var _c96=_c95.name;
var _c97=0;
for(var n=0;n<this._dojoThemeSets.themeSets.length;n++){
if(this._dojoThemeSets.themeSets[n].name==_c96){
_c97++;
_c96=_c95.name+"_"+_c97;
n=-1;
}
}
_c95.name=_c96;
this._dojoThemeSets.themeSets.push(_c95);
var _c98=dojo.byId("theme_select_themeset_theme_select");
var c=dojo.doc.createElement("option");
c.innerHTML=_c95.name;
c.value=_c95.name;
_c98.appendChild(c);
},deleteThemeSet:function(e){
var _c99=dojo.byId("theme_select_themeset_theme_select");
var node=_c99[_c99.selectedIndex];
if(!node){
return;
}
for(var n=0;n<this._dojoThemeSets.themeSets.length;n++){
if(this._dojoThemeSets.themeSets[n].name==node.value){
this._dojoThemeSets.themeSets.splice(n,1);
break;
}
}
this._selectedThemeSet=null;
_c99.removeChild(node);
dijit.byId("theme_select_themeset_theme_select_textbox").attr("value","");
var _c9a=dijit.byId("theme_select_rename_button");
var _c9b=dijit.byId("theme_select_desktop_theme_select");
var _c9c=dijit.byId("theme_select_mobile_theme_select");
var _c9d=dijit.byId("theme_select_android_select");
var _c9e=dijit.byId("theme_select_blackberry_select");
var _c9f=dijit.byId("theme_select_ipad_select");
var _ca0=dijit.byId("theme_select_iphone_select");
var _ca1=dijit.byId("theme_select_other_select");
_c9a.set("disabled",true);
_c9b.set("disabled",true);
_c9c.set("disabled",true);
_c9d.set("disabled",true);
_c9e.set("disabled",true);
_c9f.set("disabled",true);
_ca0.set("disabled",true);
_ca1.set("disabled",true);
},renameThemeSet:function(e){
var _ca2=_c88;
var loc=_c89;
var _ca3=dojo.byId("theme_select_themeset_theme_select");
this._renameDialog=new _c80({id:"rename",title:_ca2.renameThemeSet,contentStyle:{width:300},content:new davinci.ui.ThemeSetsDialogRenameWidget({})});
this._renameDialog._themesetConnections=[];
this._renameDialog._themesetConnections.push(dojo.connect(dijit.byId("theme_set_rename_ok_button"),"onClick",this,"onOkRename"));
this._renameDialog._themesetConnections.push(dojo.connect(dijit.byId("theme_set_rename_cancel_button"),"onClick",this,"onCloseRename"));
this._renameDialog._themesetConnections.push(dojo.connect(this._renameDialog,"onCancel",this,"onCloseRename"));
this._renameDialog.show();
var _ca4=dijit.byId("theme_select_themeset_rename_textbox");
_ca4.attr("value",this._selectedThemeSet.name);
dijit.selectInputText(_ca4);
},onOkRename:function(e){
var _ca5=dijit.byId("theme_select_themeset_rename_textbox").attr("value");
if(_ca5){
for(var n=0;n<this._dojoThemeSets.themeSets.length;n++){
if(this._dojoThemeSets.themeSets[n].name==_ca5){
alert("Theme set name already use");
return;
}
}
var _ca6=dojo.byId("theme_select_themeset_theme_select");
var node=_ca6[_ca6.selectedIndex];
var _ca7=this._selectedThemeSet.name;
node.innerHTML=_ca5;
node.value=_ca5;
this._selectedThemeSet.name=_ca5;
dijit.byId("theme_select_themeset_theme_select_textbox").attr("value",this._selectedThemeSet.name);
}
this.onCloseRename(e);
},onCloseRename:function(e){
while(connection=this._renameDialog._themesetConnections.pop()){
dojo.disconnect(connection);
}
this._renameDialog.destroyDescendants();
this._renameDialog.destroy();
delete this._renameDialog;
},onClick:function(e){
e.target.setAttribute("selected",false);
var _ca8=dojo.byId("theme_select_themeset_theme_select");
_ca8.setAttribute("value",this._selectedThemeSet.name);
},onChange:function(e){
var name=e.target[e.target.selectedIndex].value;
for(var i=0;i<this._dojoThemeSets.themeSets.length;i++){
if(this._dojoThemeSets.themeSets[i].name==name){
this._selectedThemeSet=this._dojoThemeSets.themeSets[i];
this.addThemes(this._dojoThemeSets.themeSets[i]);
dijit.byId("theme_select_themeset_theme_select_textbox").attr("value",this._selectedThemeSet.name);
var _ca9=dijit.byId("theme_select_rename_button");
var _caa=dijit.byId("theme_select_desktop_theme_select");
var _cab=dijit.byId("theme_select_mobile_theme_select");
_ca9.set("disabled",false);
_caa.set("disabled",false);
_cab.set("disabled",false);
break;
}
}
},onDesktopChange:function(e){
this._selectedThemeSet.desktopTheme=e;
},onMobileChange:function(e){
var _cac=dijit.byId("theme_select_android_select");
var _cad=dijit.byId("theme_select_blackberry_select");
var _cae=dijit.byId("theme_select_ipad_select");
var _caf=dijit.byId("theme_select_iphone_select");
var _cb0=dijit.byId("theme_select_other_select");
function _cb1(_cb2,_cb3,_cb4){
switch(_cb2){
case "android":
_cac.attr("value",_cb3);
_cac.set("disabled",_cb4);
break;
case "blackberry":
_cad.attr("value",_cb3);
_cad.set("disabled",_cb4);
break;
case "ipad":
_cae.attr("value",_cb3);
_cae.set("disabled",_cb4);
break;
case "iphone":
_caf.attr("value",_cb3);
_caf.set("disabled",_cb4);
break;
case "other":
_cb0.attr("value",_cb3);
_cb0.set("disabled",_cb4);
break;
}
};
if((e==="(device-specific)")){
for(var d=0;d<this._selectedThemeSet.mobileTheme.length;d++){
var _cb5=this._selectedThemeSet.mobileTheme[d].device.toLowerCase();
_cb1(_cb5,this._selectedThemeSet.mobileTheme[d].theme,false);
}
}else{
for(var d=0;d<this._selectedThemeSet.mobileTheme.length;d++){
var _cb5=this._selectedThemeSet.mobileTheme[d].device.toLowerCase();
this._selectedThemeSet.mobileTheme[d].theme=e;
_cb1(_cb5,this._selectedThemeSet.mobileTheme[d].theme,true);
}
}
},onDeviceThemeChange:function(_cb6,e){
for(var d=0;d<this._selectedThemeSet.mobileTheme.length;d++){
if(this._selectedThemeSet.mobileTheme[d].device.toLowerCase()===_cb6.toLowerCase()){
this._selectedThemeSet.mobileTheme[d].theme=e;
break;
}
}
},onAndroidThemeChange:function(e){
this.onDeviceThemeChange("android",e);
},onBlackberryThemeChange:function(e){
this.onDeviceThemeChange("blackberry",e);
},oniPadThemeChange:function(e){
this.onDeviceThemeChange("ipad",e);
},oniPhoneThemeChange:function(e){
this.onDeviceThemeChange("iphone",e);
},onOtherThemeChange:function(e){
this.onDeviceThemeChange("other",e);
},onOk:function(e){
_c83.savePreferences("maqetta.dojo.themesets",_c84.getProject(),this._dojoThemeSets);
this.onClose(e);
},onClose:function(e){
while(connection=this._connections.pop()){
dojo.disconnect(connection);
}
this._dialog.destroyDescendants();
this._dialog.destroy();
delete this._dialog;
},onDeleteThemeSet:function(e){
for(var i=0;i<this._dojoThemeSets.themeSets.length;i++){
if(this._dojoThemeSets.themeSets[i].name===this._currentThemeSet.name){
var _cb7=this._dojoThemeSets.themeSets[i-1].name;
var cb=dijit.byId("theme_select");
cb.store.fetchItemByIdentity({identity:this._dojoThemeSets.themeSets[i].name,onItem:function(item){
cb.store.deleteItem(item);
cb.store.save();
}});
this._dojoThemeSets.themeSets.splice(i,1);
this._currentThemeSet=null;
cb.attr("value",_cb7);
break;
}
}
}});
});
},"dojox/grid/_ViewManager":function(){
define("dojox/grid/_ViewManager",["dojo/_base/declare","dojo/_base/sniff","dojo/dom-class"],function(_cb8,has,_cb9){
return _cb8("dojox.grid._ViewManager",null,{constructor:function(_cba){
this.grid=_cba;
},defaultWidth:200,views:[],resize:function(){
this.onEach("resize");
},render:function(){
this.onEach("render");
},addView:function(_cbb){
_cbb.idx=this.views.length;
this.views.push(_cbb);
},destroyViews:function(){
for(var i=0,v;v=this.views[i];i++){
v.destroy();
}
this.views=[];
},getContentNodes:function(){
var _cbc=[];
for(var i=0,v;v=this.views[i];i++){
_cbc.push(v.contentNode);
}
return _cbc;
},forEach:function(_cbd){
for(var i=0,v;v=this.views[i];i++){
_cbd(v,i);
}
},onEach:function(_cbe,_cbf){
_cbf=_cbf||[];
for(var i=0,v;v=this.views[i];i++){
if(_cbe in v){
v[_cbe].apply(v,_cbf);
}
}
},normalizeHeaderNodeHeight:function(){
var _cc0=[];
for(var i=0,v;(v=this.views[i]);i++){
if(v.headerContentNode.firstChild){
_cc0.push(v.headerContentNode);
}
}
this.normalizeRowNodeHeights(_cc0);
},normalizeRowNodeHeights:function(_cc1){
var h=0;
var _cc2=[];
if(this.grid.rowHeight){
h=this.grid.rowHeight;
}else{
if(_cc1.length<=1){
return;
}
for(var i=0,n;(n=_cc1[i]);i++){
if(!_cb9.contains(n,"dojoxGridNonNormalizedCell")){
_cc2[i]=n.firstChild.offsetHeight;
h=Math.max(h,_cc2[i]);
}
}
h=(h>=0?h:0);
if((has("mozilla")||has("ie")>8)&&h){
h++;
}
}
for(i=0;(n=_cc1[i]);i++){
if(_cc2[i]!=h){
n.firstChild.style.height=h+"px";
}
}
},resetHeaderNodeHeight:function(){
for(var i=0,v,n;(v=this.views[i]);i++){
n=v.headerContentNode.firstChild;
if(n){
n.style.height="";
}
}
},renormalizeRow:function(_cc3){
var _cc4=[];
for(var i=0,v,n;(v=this.views[i])&&(n=v.getRowNode(_cc3));i++){
n.firstChild.style.height="";
_cc4.push(n);
}
this.normalizeRowNodeHeights(_cc4);
},getViewWidth:function(_cc5){
return this.views[_cc5].getWidth()||this.defaultWidth;
},measureHeader:function(){
this.resetHeaderNodeHeight();
this.forEach(function(_cc6){
_cc6.headerContentNode.style.height="";
});
var h=0;
this.forEach(function(_cc7){
h=Math.max(_cc7.headerNode.offsetHeight,h);
});
return h;
},measureContent:function(){
var h=0;
this.forEach(function(_cc8){
h=Math.max(_cc8.domNode.offsetHeight,h);
});
return h;
},findClient:function(_cc9){
var c=this.grid.elasticView||-1;
if(c<0){
for(var i=1,v;(v=this.views[i]);i++){
if(v.viewWidth){
for(i=1;(v=this.views[i]);i++){
if(!v.viewWidth){
c=i;
break;
}
}
break;
}
}
}
if(c<0){
c=Math.floor(this.views.length/2);
}
return c;
},arrange:function(l,w){
var i,v,vw,len=this.views.length,self=this;
var c=(w<=0?len:this.findClient());
var _cca=function(v,l){
var ds=v.domNode.style;
var hs=v.headerNode.style;
if(!self.grid.isLeftToRight()){
ds.right=l+"px";
if(has("ff")<4){
hs.right=l+v.getScrollbarWidth()+"px";
}else{
hs.right=l+"px";
}
if(!has("webkit")){
hs.width=parseInt(hs.width,10)-v.getScrollbarWidth()+"px";
}
}else{
ds.left=l+"px";
hs.left=l+"px";
}
ds.top=0+"px";
hs.top=0;
};
for(i=0;(v=this.views[i])&&(i<c);i++){
vw=this.getViewWidth(i);
v.setSize(vw,0);
_cca(v,l);
if(v.headerContentNode&&v.headerContentNode.firstChild){
vw=v.getColumnsWidth()+v.getScrollbarWidth();
}else{
vw=v.domNode.offsetWidth;
}
l+=vw;
}
i++;
var r=w;
for(var j=len-1;(v=this.views[j])&&(i<=j);j--){
vw=this.getViewWidth(j);
v.setSize(vw,0);
vw=v.domNode.offsetWidth;
r-=vw;
_cca(v,r);
}
if(c<len){
v=this.views[c];
vw=Math.max(1,r-l);
v.setSize(vw+"px",0);
_cca(v,l);
}
return l;
},renderRow:function(_ccb,_ccc,_ccd){
var _cce=[];
for(var i=0,v,n,_ccf;(v=this.views[i])&&(n=_ccc[i]);i++){
_ccf=v.renderRow(_ccb);
n.appendChild(_ccf);
_cce.push(_ccf);
}
if(!_ccd){
this.normalizeRowNodeHeights(_cce);
}
},rowRemoved:function(_cd0){
this.onEach("rowRemoved",[_cd0]);
},updateRow:function(_cd1,_cd2){
for(var i=0,v;v=this.views[i];i++){
v.updateRow(_cd1);
}
if(!_cd2){
this.renormalizeRow(_cd1);
}
},updateRowStyles:function(_cd3){
this.onEach("updateRowStyles",[_cd3]);
},setScrollTop:function(_cd4){
var top=_cd4;
for(var i=0,v;v=this.views[i];i++){
top=v.setScrollTop(_cd4);
if(has("ie")&&v.headerNode&&v.scrollboxNode){
v.headerNode.scrollLeft=v.scrollboxNode.scrollLeft;
}
}
return top;
},getFirstScrollingView:function(){
for(var i=0,v;(v=this.views[i]);i++){
if(v.hasHScrollbar()||v.hasVScrollbar()){
return v;
}
}
return null;
}});
});
},"davinci/ve/actions/RemoveState":function(){
define(["dojo/_base/declare","davinci/Runtime","davinci/ve/States","davinci/actions/Action"],function(_cd5,_cd6,_cd7,_cd8){
return _cd5("davinci.ve.actions.RemoveState",[_cd8],{run:function(){
var _cd9;
if(_cd6.currentEditor&&_cd6.currentEditor.currentEditor&&_cd6.currentEditor.currentEditor.context){
_cd9=_cd6.currentEditor.currentEditor.context;
}else{
return;
}
var _cda=_cd7.getFocus(_cd9.rootNode);
if(!_cda||!_cda.state||_cda.state===_cd7.NORMAL){
return;
}
var node=_cda.stateContainerNode;
var _cdb=_cdb=davinci.ve.states.getState(node);
_cd7.remove(node,_cdb);
}});
});
},"davinci/ve/themeEditor/metadata/CSSThemeProvider":function(){
define(["dojo/_base/declare","davinci/ve/utils/URLRewrite"],function(_cdc,_cdd){
return _cdc("davinci.ve.themeEditor.metadata.CSSThemeProvider",null,{module:"davinci.lib",path:"theme/tundra.json",constructor:function(_cde,_cdf){
this._theme=_cdf;
this.url=_cdd.encodeURI(_cde[0].getURL());
this.getWidgets();
},getWidgets:function(){
if(!this._widgets){
var _ce0=undefined;
dojo.xhrGet({url:""+this.url,handleAs:"json",sync:true,load:function(_ce1){
_ce0=_ce1;
}});
this._widgets=_ce0;
this._createDefaults();
}
return this._widgets;
},_createDefaults:function(){
var ret=true;
for(var a in this._widgets){
var _ce2=this._widgets[a];
for(var b in _ce2){
var _ce3=_ce2[b];
for(var c in _ce3.states){
var _ce4=_ce3.states[c];
var _ce5=this.getStyleSelectors(a+"."+b,c);
}
for(var sw in _ce3.subwidgets){
var _ce6=_ce3.subwidgets[sw];
for(var c in _ce6.states){
var _ce4=_ce6.states[c];
var _ce5=this.getStyleSelectors(a+"."+b,c,sw);
}
}
}
}
return;
},getRelativeStyleSelectorsText:function(_ce7,_ce8,_ce9,_cea,_ceb){
var _cec=this.getStyleSelectors(_ce7,_ce8,_ce9);
var _ced=new Array();
for(s in _cec){
_cea.forEach(function(_cee){
var _cef=false;
for(var p=0;!_cef&&p<_cec[s].length;p++){
if(_cec[s][p]==_cee||_cec[s][p]=="$std_10"){
_cef=true;
}
}
if(_cef){
var text=""+s;
var _cf0=text.split(" ");
text="";
_cf0.forEach(function(c){
if(c!="."+_ceb){
text+=" "+c;
}
}.bind(this));
_ced.push(text.replace(/^\s*/,"").replace(/\s*$/,""));
return;
}
}.bind(this));
}
return _ced;
},getStyleSelectors:function(_cf1,_cf2,_cf3){
if(!_cf1){
return;
}
if(!_cf2){
_cf2="Normal";
}
var _cf4;
var p=_cf1.split(".");
var w=p[0];
var n=p[p.length-1];
if(_cf3&&(w in this._widgets)&&(n in this._widgets[w])){
var sw=(_cf3.id)?_cf3.id:_cf3;
if(!this._widgets[w][n].subwidgets[""+sw].states[""+_cf2]){
return null;
}
_cf4=this._widgets[w][n].subwidgets[""+sw].states[""+_cf2].selectors;
if(!_cf4||_cf4=="$auto"){
_cf4=this._createDefaultSelectors(""+w+sw,_cf2);
this._widgets[w][n].subwidgets[""+sw].states[""+_cf2].selectors=_cf4;
}
}else{
if(this._widgets&&(w in this._widgets)&&(n in this._widgets[w])){
if(this._widgets[w][n].states[""+_cf2]){
_cf4=this._widgets[w][n].states[""+_cf2].selectors;
if(!_cf4||_cf4=="$auto"){
_cf4=this._createDefaultSelectors(""+w+n,_cf2);
this._widgets[w][n].states[""+_cf2].selectors=_cf4;
}
}
}else{
}
}
return _cf4;
},getElementStyleProperties:function(_cf5,_cf6,_cf7){
if(!_cf5){
return;
}
if(!_cf6){
_cf6="Normal";
}
var _cf8;
var p=_cf5.split(".");
var w=p[0];
var n=p[p.length-1];
if(_cf7&&(w in this._widgets)&&(n in this._widgets[w])){
var sw=(_cf7.id)?_cf7.id:_cf7;
if(!(this._widgets[w][n].subwidgets[""+sw].states[""+_cf6])||!(this._widgets[w][n].subwidgets[""+sw].states[""+_cf6].element)||!(this._widgets[w][n].subwidgets[""+sw].states[""+_cf6].element.style)){
return null;
}
_cf8=this._widgets[w][n].subwidgets[""+sw].states[""+_cf6].element.style;
}else{
if(this._widgets&&(w in this._widgets)&&(n in this._widgets[w])){
if(this._widgets[w][n].states[""+_cf6]&&this._widgets[w][n].states[""+_cf6].element&&this._widgets[w][n].states[""+_cf6].element.style){
_cf8=this._widgets[w][n].states[""+_cf6].element.style;
}
}else{
}
}
return _cf8;
},_createDefaultSelectors:function(_cf9,_cfa){
var _cfb;
if(_cfa=="Normal"){
_cfb="."+this._theme.className+" ."+_cf9;
}else{
_cfb="."+this._theme.className+" ."+_cf9+_cfa;
}
var _cfc=new Object();
_cfc[_cfb]=["$std_10"];
return _cfc;
},_createDefaultQuery:function(_cfd,_cfe){
var _cff;
_cff="."+_cfd;
return _cff;
},_simulateState:function(q,s,mode,_d00){
var _d01=[];
if(!(q instanceof Array)){
_d01.push(q);
}else{
_d01=q;
}
var _d02=[];
if(!(s instanceof Array)){
_d02.push(s);
}else{
_d02=s;
}
for(var i=0;i<_d02.length;i++){
var _d03=_d02[i];
var _d04=_d01[i];
var _d05;
var _d06;
var _d07;
if((_d05=_d03.indexOf(":"))>-1){
_d06=_d03.substring(_d05+1);
_d03=_d03.substring(0,_d05);
_d05=_d06.indexOf("=");
if(_d05>-1){
_d07=_d06.substring(_d05+1);
_d06=_d06.substring(0,_d05);
}else{
_d07=_d06;
}
}
var _d08=dojo.query(_d04,_d00.domNode);
var n=_d08[0];
if(!n){
n=_d00.domNode;
}
try{
if(mode=="add"){
if(_d06){
n.setAttribute(_d06,_d07);
}
if(_d03){
dojo.addClass(n,_d03);
}
}else{
if(_d06){
n.removeAttribute(_d06);
}
if(_d03){
dojo.removeClass(n,_d03);
}
}
}
catch(e){
console.error("CSSThemeProvider._simulateState invalid simulate in metadata for "+_d00.type+" "+q+": "+s);
}
}
},_updateStyle:function(_d09,_d0a,_d0b,mode){
if(_d09.id==="all"){
return;
}
var init=false;
if(!_d0b){
_d0b="Normal";
init=true;
}
if(!this._widgets){
return null;
}
if(!_d0a){
_d0a=_d09.type;
}
var p=_d0a.split(".");
var w=p[0];
var n=p[p.length-1];
var _d0c;
var _d0d;
var _d0e=this._widgets[w][n];
if(_d0b==="Normal"&&init==true&&mode==="remove"&&this._widgets[w][n].startState){
_d0b=this._widgets[w][n].startState;
}
if(this._widgets[w][n].states[""+_d0b]){
var q=this._widgets[w][n].states[""+_d0b].query;
if(!q||q=="$auto"){
q=this._createDefaultQuery(w+n,_d0b);
_d0e.states[""+_d0b].query=q;
}
var s=this._widgets[w][n].states[""+_d0b].simulate;
if(!s){
s=" ";
var _d0f=this.getStyleSelectors(_d0a,_d0b);
var _d10="";
for(var _d11 in _d0f){
_d10=_d11.replace(/\./g,"");
_d10=_d10.replace(this._theme.className,"");
s=s+" "+_d10;
}
if(_d0b!="Normal"){
s=w+_d0b+" "+s;
}
}
if(_d0b!="Normal"){
this._simulateState(q,s,mode,_d09);
}
}
for(var sub in _d0e.subwidgets){
var _d12=_d0e.subwidgets[sub];
if(_d0b==="Normal"&&init==true&&mode==="remove"&&_d12.startState){
_d0b=_d12.startState;
}
if(_d12.states[""+_d0b]){
var q=_d12.states[""+_d0b].query;
var s=_d12.states[""+_d0b].simulate;
if(!q||q=="$auto"){
q=this._createDefaultQuery(w+sub,_d0b);
_d12.states[""+_d0b].query=q;
}
if(!s){
var _d0f=this.getStyleSelectors(_d0a,_d0b,sub);
var _d10="";
s=" ";
for(var _d11 in _d0f){
_d10=_d11.replace(/\./g,"");
_d10=_d10.replace(this._theme.className,"");
s=s+" "+_d10;
}
if(_d0b!="Normal"){
s=w+_d0b+" "+s;
}
}
if(_d0b!="Normal"){
this._simulateState(q,s,mode,_d09);
}
}
}
return;
},setStyleValues:function(node,_d13,_d14,_d15){
this._updateStyle(node,_d13,_d14,"add");
},removeStyleValues:function(node,_d16,_d17,_d18){
if(_d17&&_d17!="Normal"){
this._updateStyle(node,_d16,_d17,"remove");
}
},setWidgetStyleValues:function(node,_d19){
var _d1a=davinci.ve.widget.getWidget(node);
this._updateStyle(node,null,_d19,"add");
},removeWidgetStyleValues:function(node,_d1b){
this._updateStyle(node,null,_d1b,"remove");
},getDomNode:function(node,_d1c,_d1d,_d1e){
if(!this._widgets){
return null;
}
if(!_d1e){
_d1e="Normal";
}
var p=_d1c.split(".");
var w=p[0];
var n=p[p.length-1];
var _d1f;
try{
if(_d1d){
_d1f=this._widgets[w][n].subwidgets[""+_d1d].states[""+_d1e].query;
if(!_d1f||_d1f=="$auto"){
_d1f=this._createDefaultQuery(w+_d1d,_d1e);
this._widgets[w][n].subwidgets[""+_d1d].states[""+_d1e].query=_d1f;
}
}else{
_d1f=this._widgets[w][n].states[""+_d1e].query;
if(!_d1f||_d1f=="$auto"){
_d1f=this._createDefaultQuery(w+n,_d1e);
this._widgets[w][n].states[""+_d1e].query=_d1f;
}
}
}
catch(e){
return null;
}
var q;
if(_d1f instanceof Array){
q=_d1f[0];
}else{
q=_d1f;
}
var _d20=dojo.query(q,node);
var n=_d20[0];
if(!n){
n=node;
}
return n;
},getMetadata:function(_d21){
if(!_d21){
return undefined;
}
var p=_d21.split(".");
var w=p[0];
var n=p[p.length-1];
var s=this._widgets&&this._widgets[w]&&this._widgets[w][n];
return s;
},getWidgetType:function(_d22){
var _d23;
_d23=_d22.type;
var id=_d22.id;
if(id.indexOf("all")===0){
_d23=_d23+".$"+id;
}
return _d23;
},isPropertyVaildForWidgetRule:function(rule,_d24,_d25,_d26,_d27){
var _d28=this.getWidgetType(_d25);
var _d29=this.getMetadata(_d28);
if(_d26){
_d29=_d29.subwidgets[_d26];
}
if(_d27){
_d29=_d29.states[_d27];
}else{
_d29=_d29.states["Normal"];
}
var _d2a=rule.getSelectorText();
for(var _d2b in _d29.selectors){
var _d2c=_d29.selectors[_d2b];
if(_d2a==_d2b){
for(var i=0;i<_d2c.length;i++){
var prop=_d2c[i];
if(prop=="$std_10"||prop==_d24){
return true;
}
}
}
}
return false;
},isPropertyRuleValid:function(rule,_d2d,_d2e){
var _d2f=rule.getSelectorText();
for(var c in _d2e.states){
var _d30=_d2e.states[c];
for(var _d31 in _d30.selectors){
var _d32=_d30.selectors[_d31];
if(_d2f==_d31){
for(var i=0;i<_d32.length;i++){
var prop=_d32[i];
if(prop=="$std_10"||prop==_d2d){
return true;
}
}
}
}
}
for(var sw in _d2e.subwidgets){
var _d33=_d2e.subwidgets[sw];
for(var c in _d33.states){
var _d30=_d33.states[c];
for(var _d31 in _d30.selectors){
var _d32=_d30.selectors[_d31];
if(_d2f==_d31){
for(var i=0;i<_d32.length;i++){
var prop=_d32[i];
if(prop=="$std_10"||prop==_d2d){
return true;
}
}
}
}
}
}
return false;
function _d34(rule,_d35){
for(var i=0;i<rule.selectors.length;i++){
var _d36=rule.selectors[i].getText();
if(_d36==_d35){
return true;
}
}
return false;
};
},isPropertyValidForRule:function(rule,_d37){
var ret=false;
var _d38=rule.getSelectorText();
for(var a in this._widgets){
var _d39=this._widgets[a];
for(var b in _d39){
var _d3a=_d39[b];
if(this.isPropertyRuleValid(rule,_d37,_d3a)){
return true;
}
}
}
return ret;
},getStatesForAllWidgets:function(){
if(!this._widgets){
return null;
}
states=new Array();
for(var a in this._widgets){
var _d3b=this._widgets[a];
for(var b in _d3b){
if(b.indexOf("$all")!=0){
var _d3c=_d3b[b];
for(var c in _d3c.states){
states[c]=c;
}
for(var sw in _d3c.subwidgets){
var _d3d=_d3c.subwidgets[sw];
for(var c in _d3d.states){
states[c]=c;
}
}
}
}
}
retStates=new Array();
for(var s in states){
retStates.push(s);
}
return retStates.sort();
},isStateValid:function(_d3e,_d3f,subW){
if(!this._widgets){
return false;
}
if(_d3e.id==="all"&&_d3f!="Normal"){
return false;
}
var _d40=_d3e.type;
var _d41=this.getMetadata(_d40);
if(_d41.states[_d3f]&&!subW){
return true;
}
if(!subW){
for(var sw in _d41.subwidgets){
var _d42=_d41.subwidgets[sw];
if(_d42.states[_d3f]){
return true;
}
}
}else{
var _d42=_d41.subwidgets[subW];
if(_d42&&_d42.states[_d3f]){
return true;
}
}
return false;
}});
});
},"davinci/ve/actions/EnableApplicationStates":function(){
define(["dojo/_base/declare","dojo/_base/connect","dojo/dom-class","dijit/_WidgetBase","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","davinci/Runtime","davinci/Workbench","davinci/ve/metadata","davinci/ve/widget","davinci/ve/States","davinci/actions/Action","dojo/i18n!davinci/ve/nls/ve","dojo/i18n!dijit/nls/common","dojo/text!./templates/EnableApplicationStates.html","dijit/form/TextBox"],function(_d43,_d44,_d45,_d46,_d47,_d48,_d49,_d4a,_d4b,_d4c,_d4d,_d4e,_d4f,_d50,_d51){
var _d52=function(){
if(_d49.currentEditor&&_d49.currentEditor.currentEditor&&_d49.currentEditor.currentEditor.context){
context=_d49.currentEditor.currentEditor.context;
var _d53=context.getSelection();
if(_d53.length==1){
var _d54=_d53[0];
return (_d4b.getAllowedChild(_d54.type)=="ANY");
}
}
return false;
};
var _d55=_d43("davinci.ve.actions.EnableApplicationStatesWidget",[_d46,_d47,_d48],{templateString:_d51,widgetsInTemplate:true,veNls:_d4f,commonNls:_d50,oldValue:null,widget:null,postCreate:function(){
if(_d49.currentEditor&&_d49.currentEditor.currentEditor&&_d49.currentEditor.currentEditor.context){
editor=this.editor=_d49.currentEditor;
context=this.context=_d49.currentEditor.currentEditor.context;
}else{
return;
}
var _d56=context.getSelection();
if(_d56.length>0){
var _d57=this.widget=_d56[0];
var _d58=_d4c.getLabel(_d57);
this.widgetLabel.innerHTML=_d58;
this.oldValue=_d4d.isStateContainer(_d57.domNode);
this.checkBoxWidget.set("checked",this.oldValue);
if(this.oldValue){
var _d59=_d4f.DisableAsStateContainerDescription;
var _d5a=_d4d.getStates(_d57.domNode);
if(_d5a.length>1){
_d5a.splice(0,1);
this.statesListDiv.innerHTML=_d4f.EnableApplicationStatesCurrentStates+": "+_d5a.join(", ");
_d59+=" "+_d4f.DisableAsStateContainerDataLoss;
}else{
this.statesListDiv.innerHTML=_d4f.EnableApplicationStatesCurrentStates+": "+_d4f.EnableApplicationStatesNone;
}
this.description.innerHTML=_d4f.DisableAsStateContainerDescription;
}else{
this.description.innerHTML=_d4f.EnableAsStateContainerDescription;
this.statesListDiv.innerHTML="";
}
}
this.okButton.connect(this.okButton,"onClick",dojo.hitch(this,function(e){
this.onOk(e);
}));
this.cancelButton.connect(this.cancelButton,"onClick",dojo.hitch(this,function(e){
this.onCancel(e);
}));
},_onKeyPress:function(e){
if(e.keyCode==dojo.keys.ENTER){
this.onOk();
}
},onOk:function(){
var _d5b=this.checkBoxWidget.get("checked");
if(_d5b!=this.oldValue){
var node=this.widget.domNode;
if(_d5b){
node._maqAppStates={};
var o=_d4d.serialize(node);
this.widget._srcElement.addAttribute(_d4d.APPSTATES_ATTRIBUTE,o.maqAppStates);
}else{
delete node._maqAppStates;
this.widget._srcElement.removeAttribute(_d4d.APPSTATES_ATTRIBUTE);
_d4d.removeUnusedStates(this.context);
}
this.editor._visualChanged();
_d44.publish("/maqetta/appstates/state/containerChange",[]);
}
this.onClose();
},onCancel:function(){
this.onClose();
}});
return _d43("davinci.ve.actions.EnableApplicationStates",[_d4e],{run:function(){
if(!_d52()){
return;
}
var _d5c;
if(_d49.currentEditor&&_d49.currentEditor.currentEditor&&_d49.currentEditor.currentEditor.context){
_d5c=_d49.currentEditor.currentEditor.context;
}else{
return;
}
var w=new davinci.ve.actions.EnableApplicationStatesWidget();
_d4a.showModal(w,_d4f.EnableApplicationStates,{width:"370px"});
},isEnabled:function(){
return _d52();
}});
});
},"dojox/html/ellipsis":function(){
define("dojox/html/ellipsis",["dojo/_base/kernel","dojo/_base/lang","dojo/_base/array","dojo/_base/Color","dojo/colors"],function(d){
if(d.isFF<7){
var _d5d=1;
if("dojoxFFEllipsisDelay" in d.config){
_d5d=Number(d.config.dojoxFFEllipsisDelay);
if(isNaN(_d5d)){
_d5d=1;
}
}
try{
var _d5e=(function(){
var sNS="http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul";
var xml=document.createElementNS(sNS,"window");
var _d5f=document.createElementNS(sNS,"description");
_d5f.setAttribute("crop","end");
xml.appendChild(_d5f);
return function(n){
var x=xml.cloneNode(true);
x.firstChild.setAttribute("value",n.textContent);
n.innerHTML="";
n.appendChild(x);
};
})();
}
catch(e){
}
var _d60=d.create;
var dd=d.doc;
var dp=d.place;
var _d61=_d60("iframe",{className:"dojoxEllipsisIFrame",src:"javascript:'<html><head><script>if(\"loadFirebugConsole\" in window){window.loadFirebugConsole();}</script></head><body></body></html>'",style:{display:"none"}});
var _d62=function(r,cnt){
if(r.collapsed){
return;
}
if(cnt>0){
do{
_d62(r);
cnt--;
}while(cnt);
return;
}
if(r.endContainer.nodeType==3&&r.endOffset>0){
r.setEnd(r.endContainer,r.endOffset-1);
}else{
if(r.endContainer.nodeType==3){
r.setEndBefore(r.endContainer);
_d62(r);
return;
}else{
if(r.endOffset&&r.endContainer.childNodes.length>=r.endOffset){
var _d63=r.endContainer.childNodes[r.endOffset-1];
if(_d63.nodeType==3){
r.setEnd(_d63,_d63.length-1);
}else{
if(_d63.childNodes.length){
r.setEnd(_d63,_d63.childNodes.length);
_d62(r);
return;
}else{
r.setEndBefore(_d63);
_d62(r);
return;
}
}
}else{
r.setEndBefore(r.endContainer);
_d62(r);
return;
}
}
}
};
var _d64=function(n){
var c=_d60("div",{className:"dojoxEllipsisContainer"});
var e=_d60("div",{className:"dojoxEllipsisShown",style:{display:"none"}});
n.parentNode.replaceChild(c,n);
c.appendChild(n);
c.appendChild(e);
var i=_d61.cloneNode(true);
var ns=n.style;
var es=e.style;
var _d65;
var _d66=function(){
ns.display="";
es.display="none";
if(n.scrollWidth<=n.offsetWidth){
return;
}
var r=dd.createRange();
r.selectNodeContents(n);
ns.display="none";
es.display="";
var done=false;
do{
var _d67=1;
dp(r.cloneContents(),e,"only");
var sw=e.scrollWidth,ow=e.offsetWidth;
done=(sw<=ow);
var pct=(1-((ow*1)/sw));
if(pct>0){
_d67=Math.max(Math.round(e.textContent.length*pct)-1,1);
}
_d62(r,_d67);
}while(!r.collapsed&&!done);
};
i.onload=function(){
i.contentWindow.onresize=_d66;
_d66();
};
c.appendChild(i);
};
var hc=d.hasClass;
var doc=d.doc;
var s,fn,opt;
if(doc.querySelectorAll){
s=doc;
fn="querySelectorAll";
opt=".dojoxEllipsis";
}else{
if(doc.getElementsByClassName){
s=doc;
fn="getElementsByClassName";
opt="dojoxEllipsis";
}else{
s=d;
fn="query";
opt=".dojoxEllipsis";
}
}
fx=function(){
d.forEach(s[fn].apply(s,[opt]),function(n){
if(!n||n._djx_ellipsis_done){
return;
}
n._djx_ellipsis_done=true;
if(_d5e&&n.textContent==n.innerHTML&&!hc(n,"dojoxEllipsisSelectable")){
_d5e(n);
}else{
_d64(n);
}
});
};
d.addOnLoad(function(){
var t=null;
var c=null;
var _d68=function(){
if(c){
d.disconnect(c);
c=null;
}
if(t){
clearTimeout(t);
}
t=setTimeout(function(){
t=null;
fx();
c=d.connect(d.body(),"DOMSubtreeModified",_d68);
},_d5d);
};
_d68();
});
}
});
},"url:davinci/de/widgets/templates/NewDijit.html":"<div>\n\t<div class=\"dijitDialogPaneContentArea\">\n\t\t<table>\n\t\t<tr>\n\t\t<td class=\"NewProjectDialogLabel\">Widget Group:</td><td><input class='templateInput' type='text' dojoAttachPoint=\"_widgetGroup\" vaule='MyWidgets'></input></td><td><div dojoAttachPoint='_error3'></div></td>\n\t\t\n\t\t</tr>\n\t\t\n\t\t<tr>\n\t\t<td class=\"NewProjectDialogLabel\">Widget Name:</td><td><input class='templateInput' type='text' dojoAttachPoint=\"_dijitName\"></input></td><td><div dojoAttachPoint='_error4'></div></td>\n\t\t</tr>\n\t\t<tr style='display:none;'>\n\t\t<td class=\"NewProjectDialogLabel\">Replace Selection with new Widget</td><td><input class='templateInput' type='checkbox' dojoAttachPoint=\"_replaceSelection\"></input></td><td><div dojoAttachPoint='_error5'></div></td>\n\t\t</tr>\n\t\t</table>\n\t</div>\n\n\t<div class=\"dijitDialogPaneActionBar\">\n\t\t<button dojoType='dijit.form.Button' dojoAttachPoint=\"_okButton\" dojoAttachEvent='onClick:okButton' label='OK' type=\"submit\" class=\"maqPrimaryButton\" disabled></button> \n\t\t<button dojoType='dijit.form.Button' dojoAttachEvent='onClick:cancelButton' label='Cancel' class=\"maqSecondaryButton\"></button>\n\t</div>\t\t\n</div>","davinci/commands/OrderedCompoundCommand":function(){
define(["dojo/_base/declare","davinci/commands/CompoundCommand"],function(_d69,_d6a){
return _d69("davinci.commands.OrderedCompoundCommand",_d6a,{undo:function(){
if(!this._commands){
return;
}
for(var i=0;i<this._commands.length;i++){
this._commands[i].undo();
}
}});
});
},"davinci/version":function(){
define("davinci/version",[],"7");
},"dojo/data/ItemFileReadStore":function(){
define("dojo/data/ItemFileReadStore",["../_base/kernel","../_base/lang","../_base/declare","../_base/array","../_base/xhr","../Evented","./util/filter","./util/simpleFetch","../date/stamp"],function(_d6b,lang,_d6c,_d6d,xhr,_d6e,_d6f,_d70,_d71){
var _d72=_d6c("dojo.data.ItemFileReadStore",[_d6e],{constructor:function(_d73){
this._arrayOfAllItems=[];
this._arrayOfTopLevelItems=[];
this._loadFinished=false;
this._jsonFileUrl=_d73.url;
this._ccUrl=_d73.url;
this.url=_d73.url;
this._jsonData=_d73.data;
this.data=null;
this._datatypeMap=_d73.typeMap||{};
if(!this._datatypeMap["Date"]){
this._datatypeMap["Date"]={type:Date,deserialize:function(_d74){
return _d71.fromISOString(_d74);
}};
}
this._features={"dojo.data.api.Read":true,"dojo.data.api.Identity":true};
this._itemsByIdentity=null;
this._storeRefPropName="_S";
this._itemNumPropName="_0";
this._rootItemPropName="_RI";
this._reverseRefMap="_RRM";
this._loadInProgress=false;
this._queuedFetches=[];
if(_d73.urlPreventCache!==undefined){
this.urlPreventCache=_d73.urlPreventCache?true:false;
}
if(_d73.hierarchical!==undefined){
this.hierarchical=_d73.hierarchical?true:false;
}
if(_d73.clearOnClose){
this.clearOnClose=true;
}
if("failOk" in _d73){
this.failOk=_d73.failOk?true:false;
}
},url:"",_ccUrl:"",data:null,typeMap:null,clearOnClose:false,urlPreventCache:false,failOk:false,hierarchical:true,_assertIsItem:function(item){
if(!this.isItem(item)){
throw new Error(this.declaredClass+": Invalid item argument.");
}
},_assertIsAttribute:function(_d75){
if(typeof _d75!=="string"){
throw new Error(this.declaredClass+": Invalid attribute argument.");
}
},getValue:function(item,_d76,_d77){
var _d78=this.getValues(item,_d76);
return (_d78.length>0)?_d78[0]:_d77;
},getValues:function(item,_d79){
this._assertIsItem(item);
this._assertIsAttribute(_d79);
return (item[_d79]||[]).slice(0);
},getAttributes:function(item){
this._assertIsItem(item);
var _d7a=[];
for(var key in item){
if((key!==this._storeRefPropName)&&(key!==this._itemNumPropName)&&(key!==this._rootItemPropName)&&(key!==this._reverseRefMap)){
_d7a.push(key);
}
}
return _d7a;
},hasAttribute:function(item,_d7b){
this._assertIsItem(item);
this._assertIsAttribute(_d7b);
return (_d7b in item);
},containsValue:function(item,_d7c,_d7d){
var _d7e=undefined;
if(typeof _d7d==="string"){
_d7e=_d6f.patternToRegExp(_d7d,false);
}
return this._containsValue(item,_d7c,_d7d,_d7e);
},_containsValue:function(item,_d7f,_d80,_d81){
return _d6d.some(this.getValues(item,_d7f),function(_d82){
if(_d82!==null&&!lang.isObject(_d82)&&_d81){
if(_d82.toString().match(_d81)){
return true;
}
}else{
if(_d80===_d82){
return true;
}
}
});
},isItem:function(_d83){
if(_d83&&_d83[this._storeRefPropName]===this){
if(this._arrayOfAllItems[_d83[this._itemNumPropName]]===_d83){
return true;
}
}
return false;
},isItemLoaded:function(_d84){
return this.isItem(_d84);
},loadItem:function(_d85){
this._assertIsItem(_d85.item);
},getFeatures:function(){
return this._features;
},getLabel:function(item){
if(this._labelAttr&&this.isItem(item)){
return this.getValue(item,this._labelAttr);
}
return undefined;
},getLabelAttributes:function(item){
if(this._labelAttr){
return [this._labelAttr];
}
return null;
},filter:function(_d86,_d87,_d88){
var _d89=[],i,key;
if(_d86.query){
var _d8a,_d8b=_d86.queryOptions?_d86.queryOptions.ignoreCase:false;
var _d8c={};
for(key in _d86.query){
_d8a=_d86.query[key];
if(typeof _d8a==="string"){
_d8c[key]=_d6f.patternToRegExp(_d8a,_d8b);
}else{
if(_d8a instanceof RegExp){
_d8c[key]=_d8a;
}
}
}
for(i=0;i<_d87.length;++i){
var _d8d=true;
var _d8e=_d87[i];
if(_d8e===null){
_d8d=false;
}else{
for(key in _d86.query){
_d8a=_d86.query[key];
if(!this._containsValue(_d8e,key,_d8a,_d8c[key])){
_d8d=false;
}
}
}
if(_d8d){
_d89.push(_d8e);
}
}
_d88(_d89,_d86);
}else{
for(i=0;i<_d87.length;++i){
var item=_d87[i];
if(item!==null){
_d89.push(item);
}
}
_d88(_d89,_d86);
}
},_fetchItems:function(_d8f,_d90,_d91){
var self=this;
if(this._loadFinished){
this.filter(_d8f,this._getItemsArray(_d8f.queryOptions),_d90);
}else{
if(this._jsonFileUrl!==this._ccUrl){
_d6b.deprecated(this.declaredClass+": ","To change the url, set the url property of the store,"+" not _jsonFileUrl.  _jsonFileUrl support will be removed in 2.0");
this._ccUrl=this._jsonFileUrl;
this.url=this._jsonFileUrl;
}else{
if(this.url!==this._ccUrl){
this._jsonFileUrl=this.url;
this._ccUrl=this.url;
}
}
if(this.data!=null){
this._jsonData=this.data;
this.data=null;
}
if(this._jsonFileUrl){
if(this._loadInProgress){
this._queuedFetches.push({args:_d8f,filter:lang.hitch(self,"filter"),findCallback:lang.hitch(self,_d90)});
}else{
this._loadInProgress=true;
var _d92={url:self._jsonFileUrl,handleAs:"json-comment-optional",preventCache:this.urlPreventCache,failOk:this.failOk};
var _d93=xhr.get(_d92);
_d93.addCallback(function(data){
try{
self._getItemsFromLoadedData(data);
self._loadFinished=true;
self._loadInProgress=false;
self.filter(_d8f,self._getItemsArray(_d8f.queryOptions),_d90);
self._handleQueuedFetches();
}
catch(e){
self._loadFinished=true;
self._loadInProgress=false;
_d91(e,_d8f);
}
});
_d93.addErrback(function(_d94){
self._loadInProgress=false;
_d91(_d94,_d8f);
});
var _d95=null;
if(_d8f.abort){
_d95=_d8f.abort;
}
_d8f.abort=function(){
var df=_d93;
if(df&&df.fired===-1){
df.cancel();
df=null;
}
if(_d95){
_d95.call(_d8f);
}
};
}
}else{
if(this._jsonData){
try{
this._loadFinished=true;
this._getItemsFromLoadedData(this._jsonData);
this._jsonData=null;
self.filter(_d8f,this._getItemsArray(_d8f.queryOptions),_d90);
}
catch(e){
_d91(e,_d8f);
}
}else{
_d91(new Error(this.declaredClass+": No JSON source data was provided as either URL or a nested Javascript object."),_d8f);
}
}
}
},_handleQueuedFetches:function(){
if(this._queuedFetches.length>0){
for(var i=0;i<this._queuedFetches.length;i++){
var _d96=this._queuedFetches[i],_d97=_d96.args,_d98=_d96.filter,_d99=_d96.findCallback;
if(_d98){
_d98(_d97,this._getItemsArray(_d97.queryOptions),_d99);
}else{
this.fetchItemByIdentity(_d97);
}
}
this._queuedFetches=[];
}
},_getItemsArray:function(_d9a){
if(_d9a&&_d9a.deep){
return this._arrayOfAllItems;
}
return this._arrayOfTopLevelItems;
},close:function(_d9b){
if(this.clearOnClose&&this._loadFinished&&!this._loadInProgress){
if(((this._jsonFileUrl==""||this._jsonFileUrl==null)&&(this.url==""||this.url==null))&&this.data==null){
}
this._arrayOfAllItems=[];
this._arrayOfTopLevelItems=[];
this._loadFinished=false;
this._itemsByIdentity=null;
this._loadInProgress=false;
this._queuedFetches=[];
}
},_getItemsFromLoadedData:function(_d9c){
var _d9d=false,self=this;
function _d9e(_d9f){
return (_d9f!==null)&&(typeof _d9f==="object")&&(!lang.isArray(_d9f)||_d9d)&&(!lang.isFunction(_d9f))&&(_d9f.constructor==Object||lang.isArray(_d9f))&&(typeof _d9f._reference==="undefined")&&(typeof _d9f._type==="undefined")&&(typeof _d9f._value==="undefined")&&self.hierarchical;
};
function _da0(_da1){
self._arrayOfAllItems.push(_da1);
for(var _da2 in _da1){
var _da3=_da1[_da2];
if(_da3){
if(lang.isArray(_da3)){
var _da4=_da3;
for(var k=0;k<_da4.length;++k){
var _da5=_da4[k];
if(_d9e(_da5)){
_da0(_da5);
}
}
}else{
if(_d9e(_da3)){
_da0(_da3);
}
}
}
}
};
this._labelAttr=_d9c.label;
var i,item;
this._arrayOfAllItems=[];
this._arrayOfTopLevelItems=_d9c.items;
for(i=0;i<this._arrayOfTopLevelItems.length;++i){
item=this._arrayOfTopLevelItems[i];
if(lang.isArray(item)){
_d9d=true;
}
_da0(item);
item[this._rootItemPropName]=true;
}
var _da6={},key;
for(i=0;i<this._arrayOfAllItems.length;++i){
item=this._arrayOfAllItems[i];
for(key in item){
if(key!==this._rootItemPropName){
var _da7=item[key];
if(_da7!==null){
if(!lang.isArray(_da7)){
item[key]=[_da7];
}
}else{
item[key]=[null];
}
}
_da6[key]=key;
}
}
while(_da6[this._storeRefPropName]){
this._storeRefPropName+="_";
}
while(_da6[this._itemNumPropName]){
this._itemNumPropName+="_";
}
while(_da6[this._reverseRefMap]){
this._reverseRefMap+="_";
}
var _da8;
var _da9=_d9c.identifier;
if(_da9){
this._itemsByIdentity={};
this._features["dojo.data.api.Identity"]=_da9;
for(i=0;i<this._arrayOfAllItems.length;++i){
item=this._arrayOfAllItems[i];
_da8=item[_da9];
var _daa=_da8[0];
if(!Object.hasOwnProperty.call(this._itemsByIdentity,_daa)){
this._itemsByIdentity[_daa]=item;
}else{
if(this._jsonFileUrl){
throw new Error(this.declaredClass+":  The json data as specified by: ["+this._jsonFileUrl+"] is malformed.  Items within the list have identifier: ["+_da9+"].  Value collided: ["+_daa+"]");
}else{
if(this._jsonData){
throw new Error(this.declaredClass+":  The json data provided by the creation arguments is malformed.  Items within the list have identifier: ["+_da9+"].  Value collided: ["+_daa+"]");
}
}
}
}
}else{
this._features["dojo.data.api.Identity"]=Number;
}
for(i=0;i<this._arrayOfAllItems.length;++i){
item=this._arrayOfAllItems[i];
item[this._storeRefPropName]=this;
item[this._itemNumPropName]=i;
}
for(i=0;i<this._arrayOfAllItems.length;++i){
item=this._arrayOfAllItems[i];
for(key in item){
_da8=item[key];
for(var j=0;j<_da8.length;++j){
_da7=_da8[j];
if(_da7!==null&&typeof _da7=="object"){
if(("_type" in _da7)&&("_value" in _da7)){
var type=_da7._type;
var _dab=this._datatypeMap[type];
if(!_dab){
throw new Error("dojo.data.ItemFileReadStore: in the typeMap constructor arg, no object class was specified for the datatype '"+type+"'");
}else{
if(lang.isFunction(_dab)){
_da8[j]=new _dab(_da7._value);
}else{
if(lang.isFunction(_dab.deserialize)){
_da8[j]=_dab.deserialize(_da7._value);
}else{
throw new Error("dojo.data.ItemFileReadStore: Value provided in typeMap was neither a constructor, nor a an object with a deserialize function");
}
}
}
}
if(_da7._reference){
var _dac=_da7._reference;
if(!lang.isObject(_dac)){
_da8[j]=this._getItemByIdentity(_dac);
}else{
for(var k=0;k<this._arrayOfAllItems.length;++k){
var _dad=this._arrayOfAllItems[k],_dae=true;
for(var _daf in _dac){
if(_dad[_daf]!=_dac[_daf]){
_dae=false;
}
}
if(_dae){
_da8[j]=_dad;
}
}
}
if(this.referenceIntegrity){
var _db0=_da8[j];
if(this.isItem(_db0)){
this._addReferenceToMap(_db0,item,key);
}
}
}else{
if(this.isItem(_da7)){
if(this.referenceIntegrity){
this._addReferenceToMap(_da7,item,key);
}
}
}
}
}
}
}
},_addReferenceToMap:function(_db1,_db2,_db3){
},getIdentity:function(item){
var _db4=this._features["dojo.data.api.Identity"];
if(_db4===Number){
return item[this._itemNumPropName];
}else{
var _db5=item[_db4];
if(_db5){
return _db5[0];
}
}
return null;
},fetchItemByIdentity:function(_db6){
var item,_db7;
if(!this._loadFinished){
var self=this;
if(this._jsonFileUrl!==this._ccUrl){
_d6b.deprecated(this.declaredClass+": ","To change the url, set the url property of the store,"+" not _jsonFileUrl.  _jsonFileUrl support will be removed in 2.0");
this._ccUrl=this._jsonFileUrl;
this.url=this._jsonFileUrl;
}else{
if(this.url!==this._ccUrl){
this._jsonFileUrl=this.url;
this._ccUrl=this.url;
}
}
if(this.data!=null&&this._jsonData==null){
this._jsonData=this.data;
this.data=null;
}
if(this._jsonFileUrl){
if(this._loadInProgress){
this._queuedFetches.push({args:_db6});
}else{
this._loadInProgress=true;
var _db8={url:self._jsonFileUrl,handleAs:"json-comment-optional",preventCache:this.urlPreventCache,failOk:this.failOk};
var _db9=xhr.get(_db8);
_db9.addCallback(function(data){
var _dba=_db6.scope?_db6.scope:_d6b.global;
try{
self._getItemsFromLoadedData(data);
self._loadFinished=true;
self._loadInProgress=false;
item=self._getItemByIdentity(_db6.identity);
if(_db6.onItem){
_db6.onItem.call(_dba,item);
}
self._handleQueuedFetches();
}
catch(error){
self._loadInProgress=false;
if(_db6.onError){
_db6.onError.call(_dba,error);
}
}
});
_db9.addErrback(function(_dbb){
self._loadInProgress=false;
if(_db6.onError){
var _dbc=_db6.scope?_db6.scope:_d6b.global;
_db6.onError.call(_dbc,_dbb);
}
});
}
}else{
if(this._jsonData){
self._getItemsFromLoadedData(self._jsonData);
self._jsonData=null;
self._loadFinished=true;
item=self._getItemByIdentity(_db6.identity);
if(_db6.onItem){
_db7=_db6.scope?_db6.scope:_d6b.global;
_db6.onItem.call(_db7,item);
}
}
}
}else{
item=this._getItemByIdentity(_db6.identity);
if(_db6.onItem){
_db7=_db6.scope?_db6.scope:_d6b.global;
_db6.onItem.call(_db7,item);
}
}
},_getItemByIdentity:function(_dbd){
var item=null;
if(this._itemsByIdentity){
if(Object.hasOwnProperty.call(this._itemsByIdentity,_dbd)){
item=this._itemsByIdentity[_dbd];
}
}else{
if(Object.hasOwnProperty.call(this._arrayOfAllItems,_dbd)){
item=this._arrayOfAllItems[_dbd];
}
}
if(item===undefined){
item=null;
}
return item;
},getIdentityAttributes:function(item){
var _dbe=this._features["dojo.data.api.Identity"];
if(_dbe===Number){
return null;
}else{
return [_dbe];
}
},_forceLoad:function(){
var self=this;
if(this._jsonFileUrl!==this._ccUrl){
_d6b.deprecated(this.declaredClass+": ","To change the url, set the url property of the store,"+" not _jsonFileUrl.  _jsonFileUrl support will be removed in 2.0");
this._ccUrl=this._jsonFileUrl;
this.url=this._jsonFileUrl;
}else{
if(this.url!==this._ccUrl){
this._jsonFileUrl=this.url;
this._ccUrl=this.url;
}
}
if(this.data!=null){
this._jsonData=this.data;
this.data=null;
}
if(this._jsonFileUrl){
var _dbf={url:this._jsonFileUrl,handleAs:"json-comment-optional",preventCache:this.urlPreventCache,failOk:this.failOk,sync:true};
var _dc0=xhr.get(_dbf);
_dc0.addCallback(function(data){
try{
if(self._loadInProgress!==true&&!self._loadFinished){
self._getItemsFromLoadedData(data);
self._loadFinished=true;
}else{
if(self._loadInProgress){
throw new Error(this.declaredClass+":  Unable to perform a synchronous load, an async load is in progress.");
}
}
}
catch(e){
throw e;
}
});
_dc0.addErrback(function(_dc1){
throw _dc1;
});
}else{
if(this._jsonData){
self._getItemsFromLoadedData(self._jsonData);
self._jsonData=null;
self._loadFinished=true;
}
}
}});
lang.extend(_d72,_d70);
return _d72;
});
},"dojo/dnd/Selector":function(){
define("dojo/dnd/Selector",["../_base/array","../_base/declare","../_base/event","../_base/kernel","../_base/lang","../dom","../dom-construct","../mouse","../_base/NodeList","../on","../touch","./common","./Container"],function(_dc2,_dc3,_dc4,_dc5,lang,dom,_dc6,_dc7,_dc8,on,_dc9,dnd,_dca){
var _dcb=_dc3("dojo.dnd.Selector",_dca,{constructor:function(node,_dcc){
if(!_dcc){
_dcc={};
}
this.singular=_dcc.singular;
this.autoSync=_dcc.autoSync;
this.selection={};
this.anchor=null;
this.simpleSelection=false;
this.events.push(on(this.node,_dc9.press,lang.hitch(this,"onMouseDown")),on(this.node,_dc9.release,lang.hitch(this,"onMouseUp")));
},singular:false,getSelectedNodes:function(){
var t=new _dc8();
var e=dnd._empty;
for(var i in this.selection){
if(i in e){
continue;
}
t.push(dom.byId(i));
}
return t;
},selectNone:function(){
return this._removeSelection()._removeAnchor();
},selectAll:function(){
this.forInItems(function(data,id){
this._addItemClass(dom.byId(id),"Selected");
this.selection[id]=1;
},this);
return this._removeAnchor();
},deleteSelectedNodes:function(){
var e=dnd._empty;
for(var i in this.selection){
if(i in e){
continue;
}
var n=dom.byId(i);
this.delItem(i);
_dc6.destroy(n);
}
this.anchor=null;
this.selection={};
return this;
},forInSelectedItems:function(f,o){
o=o||_dc5.global;
var s=this.selection,e=dnd._empty;
for(var i in s){
if(i in e){
continue;
}
f.call(o,this.getItem(i),i,this);
}
},sync:function(){
_dcb.superclass.sync.call(this);
if(this.anchor){
if(!this.getItem(this.anchor.id)){
this.anchor=null;
}
}
var t=[],e=dnd._empty;
for(var i in this.selection){
if(i in e){
continue;
}
if(!this.getItem(i)){
t.push(i);
}
}
_dc2.forEach(t,function(i){
delete this.selection[i];
},this);
return this;
},insertNodes:function(_dcd,data,_dce,_dcf){
var _dd0=this._normalizedCreator;
this._normalizedCreator=function(item,hint){
var t=_dd0.call(this,item,hint);
if(_dcd){
if(!this.anchor){
this.anchor=t.node;
this._removeItemClass(t.node,"Selected");
this._addItemClass(this.anchor,"Anchor");
}else{
if(this.anchor!=t.node){
this._removeItemClass(t.node,"Anchor");
this._addItemClass(t.node,"Selected");
}
}
this.selection[t.node.id]=1;
}else{
this._removeItemClass(t.node,"Selected");
this._removeItemClass(t.node,"Anchor");
}
return t;
};
_dcb.superclass.insertNodes.call(this,data,_dce,_dcf);
this._normalizedCreator=_dd0;
return this;
},destroy:function(){
_dcb.superclass.destroy.call(this);
this.selection=this.anchor=null;
},onMouseDown:function(e){
if(this.autoSync){
this.sync();
}
if(!this.current){
return;
}
if(!this.singular&&!dnd.getCopyKeyState(e)&&!e.shiftKey&&(this.current.id in this.selection)){
this.simpleSelection=true;
if(_dc7.isLeft(e)){
_dc4.stop(e);
}
return;
}
if(!this.singular&&e.shiftKey){
if(!dnd.getCopyKeyState(e)){
this._removeSelection();
}
var c=this.getAllNodes();
if(c.length){
if(!this.anchor){
this.anchor=c[0];
this._addItemClass(this.anchor,"Anchor");
}
this.selection[this.anchor.id]=1;
if(this.anchor!=this.current){
var i=0,node;
for(;i<c.length;++i){
node=c[i];
if(node==this.anchor||node==this.current){
break;
}
}
for(++i;i<c.length;++i){
node=c[i];
if(node==this.anchor||node==this.current){
break;
}
this._addItemClass(node,"Selected");
this.selection[node.id]=1;
}
this._addItemClass(this.current,"Selected");
this.selection[this.current.id]=1;
}
}
}else{
if(this.singular){
if(this.anchor==this.current){
if(dnd.getCopyKeyState(e)){
this.selectNone();
}
}else{
this.selectNone();
this.anchor=this.current;
this._addItemClass(this.anchor,"Anchor");
this.selection[this.current.id]=1;
}
}else{
if(dnd.getCopyKeyState(e)){
if(this.anchor==this.current){
delete this.selection[this.anchor.id];
this._removeAnchor();
}else{
if(this.current.id in this.selection){
this._removeItemClass(this.current,"Selected");
delete this.selection[this.current.id];
}else{
if(this.anchor){
this._removeItemClass(this.anchor,"Anchor");
this._addItemClass(this.anchor,"Selected");
}
this.anchor=this.current;
this._addItemClass(this.current,"Anchor");
this.selection[this.current.id]=1;
}
}
}else{
if(!(this.current.id in this.selection)){
this.selectNone();
this.anchor=this.current;
this._addItemClass(this.current,"Anchor");
this.selection[this.current.id]=1;
}
}
}
}
_dc4.stop(e);
},onMouseUp:function(){
if(!this.simpleSelection){
return;
}
this.simpleSelection=false;
this.selectNone();
if(this.current){
this.anchor=this.current;
this._addItemClass(this.anchor,"Anchor");
this.selection[this.current.id]=1;
}
},onMouseMove:function(){
this.simpleSelection=false;
},onOverEvent:function(){
this.onmousemoveEvent=on(this.node,_dc9.move,lang.hitch(this,"onMouseMove"));
},onOutEvent:function(){
if(this.onmousemoveEvent){
this.onmousemoveEvent.remove();
delete this.onmousemoveEvent;
}
},_removeSelection:function(){
var e=dnd._empty;
for(var i in this.selection){
if(i in e){
continue;
}
var node=dom.byId(i);
if(node){
this._removeItemClass(node,"Selected");
}
}
this.selection={};
return this;
},_removeAnchor:function(){
if(this.anchor){
this._removeItemClass(this.anchor,"Anchor");
this.anchor=null;
}
return this;
}});
return _dcb;
});
},"url:davinci/ui/templates/Rename.html":"<div>\n\t<div class=\"dijitDialogPaneContentArea\">\n\t\t<table>\n\t\t\t<tr>\n\t\t\t\t<td class=\"NewProjectDialogLabel\">${renameNewLabel}</td><td><input class='templateInput' type='text' dojoAttachPoint=\"_newName\"></input></td><td><div dojoAttachPoint='_error4'></div></td>\n\t\t\t</tr>\t\t\n\t\t</table>\n\t</div>\n\n\t<div class=\"dijitDialogPaneActionBar\">\n\t\t<button dojoType='dijit.form.Button' dojoAttachPoint=\"_okButton\" dojoAttachEvent='onClick:okButton' label='${renameButtonLabel}' class=\"maqPrimaryButton\" type=\"submit\" disabled></button>\n\t\t<button dojoType='dijit.form.Button' dojoAttachEvent='onClick:cancelButton' label='${buttonCancel}' class=\"maqSecondaryButton\"></button>\n\t</div>\n</div>","davinci/actions/LogoutAction":function(){
define("davinci/actions/LogoutAction",["dojo/_base/declare","./Action","dojo/i18n!davinci/ui/nls/ui"],function(_dd1,_dd2,_dd3){
return _dd1("davinci.actions.LogoutAction",_dd2,{run:function(){
var _dd4=new XMLHttpRequest();
_dd4.onreadystatechange=function(){
location.href="/maqetta/";
};
var _dd5="";
_dd4.open("POST","../logout",false);
_dd4.setRequestHeader("Content-type","application/x-www-form-urlencoded");
_dd4.setRequestHeader("Orion-Version","1");
_dd4.send(_dd5);
},isEnabled:function(_dd6){
return true;
}});
});
},"davinci/ve/actions/ReplaceAction":function(){
define(["dojo/_base/declare","dojo/dom-style","davinci/ve/actions/ContextAction","davinci/commands/CompoundCommand","davinci/ve/commands/AddCommand","davinci/ve/commands/MoveCommand","davinci/ve/widget","davinci/ve/utils/GeomUtils"],function(_dd7,_dd8,_dd9,_dda,_ddb,_ddc,_ddd,_dde){
return _dd7("davinci.ve.actions.ReplaceAction",[_dd9],{run:function(_ddf,_de0){
_ddf=this.fixupContext(_ddf);
if(_ddf){
if(_ddf.declaredClass!=="davinci.ve.Context"){
return;
}
var _de1=this._normalizeSelection(_ddf);
if(!this.selectionSameParent(_de1)){
return;
}
var _de2=[];
var _de3={"type":_de0,"context":_ddf};
if(_de1.length>0){
var _de4=new _dda();
dojo.forEach(_de1,function(w){
var _de5;
var d=w.getData({identify:false});
if(d){
d.context=_ddf;
dojo.withDoc(_ddf.getDocument(),function(){
_de5=_ddd.createWidget(_de3);
},this);
if(_de5){
_de4.add(new _ddb(_de5,w.getParent(),undefined));
_de2.push(_de5);
var _de6=(w&&w.domNode)?_dd8.get(w.domNode,"position"):null;
var _de7=(_de6=="absolute");
if(_de7){
var box=_dde.getMarginBoxPageCoords(w.domNode);
box.l+=25;
_de4.add(new _ddc(_de5,box.l,box.t,undefined,undefined,undefined,true));
}
}
}
});
_ddf.getCommandStack().execute(_de4);
dojo.forEach(_de2,function(w,i){
_ddf.select(w,i>0);
},this);
}
}
},isEnabled:function(_de8){
_de8=this.fixupContext(_de8);
var _de9=(_de8&&_de8.getSelection)?_de8.getSelection():[];
if(_de9.length===0){
return false;
}
if(!this.selectionSameParent(_de9)){
return false;
}
return true;
},shouldShow:function(_dea){
_dea=this.fixupContext(_dea);
var _deb=_dea?_dea.editor:null;
return (_deb&&_deb.declaredClass=="davinci.ve.PageEditor");
},selectionSameParent:function(_dec){
if(_dec.length===0){
return false;
}
var _ded=_dec[0].getParent();
for(var i=0;i<_dec.length;i++){
var _dee=_dec[i];
if(_dee.getParent()!=_ded){
return false;
}
}
return true;
}});
});
},"davinci/html/CSSFile":function(){
define("davinci/html/CSSFile",["dojo/_base/declare","davinci/html/CSSElement","davinci/html/CSSRule","davinci/html/CSSSelector"],function(_def,_df0,_df1,_df2){
return _def("davinci.html.CSSFile",_df0,{constructor:function(args){
this.elementType="CSSFile";
dojo.mixin(this,args);
if(!this.options){
this.options={xmode:"style",css:true,expandShorthand:false};
}
var txt=null;
if(this.url&&this.loader){
txt=this.loader(this.url);
}else{
if(this.url){
var file=this.getResource();
if(file){
txt=file.getText();
this.setDirty(file.isDirty());
}
}
}
if(txt){
this.setText(txt);
}
},save:function(_df3){
var _df4;
var file=this.getResource();
if(file){
var text=this.getText();
_df4=file.setContents(text,_df3);
}
return _df4;
},close:function(){
this.visit({visit:function(node){
if(node.elementType=="CSSImport"){
node.close();
}
}});
require(["dojo/_base/connect"],function(_df5){
_df5.publish("davinci/model/closeModel",[this]);
});
},getResource:function(_df6){
return system.resource.findResource(this.url);
},addRule:function(_df7){
var rule=new _df1();
rule.setText(_df7);
this.addChild(rule);
this.setDirty(true);
return rule;
},setText:function(text){
var _df8=this.children;
this.children=[];
var _df9=require("davinci/html/CSSParser").parse(text,this);
if(_df9.errors.length>0){
}
this.errors=_df9.errors;
if(this.errors.length>0&&this.errors[this.errors.length-1].isException){
this.children=_df8;
}
if(this.includeImports){
for(var i=0;i<this.children.length;i++){
if(this.children[i].elementType=="CSSImport"){
this.children[i].load();
}
}
}
this.onChange();
},getText:function(_dfa){
_dfa=_dfa||{};
_dfa.indent=0;
var s="";
for(var i=0;i<this.children.length;i++){
s=s+this.children[i].getText(_dfa);
}
return s;
},getCSSFile:function(){
return this;
},getID:function(){
return this.fileName;
},getMatchingRules:function(_dfb,_dfc,_dfd){
_dfb=this._convertNode(_dfb);
_dfc=_dfc||[];
_dfd=_dfd||[];
for(var i=0;i<this.children.length;i++){
var _dfe=this.children[i];
if(_dfe.elementType=="CSSRule"){
var _dff=_dfe.matches(_dfb);
if(_dff){
for(var j=0;j<_dfd.length;j++){
if(_dff>=_dfd[j]){
_dfc.splice(j,0,_dfe);
_dfd.splice(j,0,_dff);
break;
}
}
if(_dfc.length==0){
_dfc.push(_dfe);
_dfd.push(_dff);
}
}
}else{
if(_dfe.elementType=="CSSImport"&&_dfe.cssFile){
_dfe.cssFile.getMatchingRules(_dfb,_dfc,_dfd);
}
}
}
return _dfc;
},getRule:function(_e00){
var _e01;
if(!_e00){
return [];
}
var _e02=_df2.parseSelectors(_e00);
for(var i=0;i<this.children.length;i++){
var _e03=this.children[i];
if(_e03.elementType=="CSSRule"){
if(_e03.matchesSelectors(_e02)){
_e01=_e03;
break;
}
}else{
if(_e03.elementType=="CSSImport"&&_e03.cssFile){
_e01=_e03.cssFile.getRule(_e02)||_e01;
}
}
}
return _e01;
},getRules:function(_e04){
var _e05=_df2.parseSelectors(_e04);
var _e06=new Array();
for(var i=0;i<this.children.length;i++){
var _e07=this.children[i];
if(_e07.elementType=="CSSRule"){
if(_e07.matchesSelectors(_e05)){
_e06.push(_e07);
}
}else{
if(_e07.elementType=="CSSImport"&&_e07.cssFile){
_e06=_e06.concat(_e07.cssFile.getRules(_e05));
}
}
}
return _e06;
},getStyleValue:function(_e08,_e09){
var _e0a=[];
var _e0b=[];
_e09=this._convertNode(_e09);
this.getMatchingRules(_e09,_e0a,_e0b);
function _e0c(_e0d){
var _e0e=0;
var _e0f,prop;
for(var i=0;i<_e0a.length;i++){
if((prop=_e0a[i].getProperty(_e0d))){
if(_e0b[i]>_e0e){
_e0f=prop;
_e0e=_e0b[i];
}
}
}
return _e0f;
};
if(dojo.isString(_e08)){
return _e0c(_e08);
}
var _e10=[];
for(var i=0;i<_e08.length;i++){
_e10.push(_e0c(_e08[i]));
}
return _e10;
}});
});
},"dijit/MenuBarItem":function(){
require({cache:{"url:dijit/templates/MenuBarItem.html":"<div class=\"dijitReset dijitInline dijitMenuItem dijitMenuItemLabel\" data-dojo-attach-point=\"focusNode\"\n\t \trole=\"menuitem\" tabIndex=\"-1\">\n\t<span data-dojo-attach-point=\"containerNode\"></span>\n</div>\n"}});
define("dijit/MenuBarItem",["dojo/_base/declare","./MenuItem","dojo/text!./templates/MenuBarItem.html"],function(_e11,_e12,_e13){
var _e14=_e11("dijit._MenuBarItemMixin",null,{templateString:_e13,_setIconClassAttr:null});
var _e15=_e11("dijit.MenuBarItem",[_e12,_e14],{});
_e15._MenuBarItemMixin=_e14;
return _e15;
});
},"dojox/data/QueryReadStore":function(){
define("dojox/data/QueryReadStore",["dojo","dojox","dojo/data/util/sorter","dojo/string"],function(dojo,_e16){
dojo.declare("dojox.data.QueryReadStore",null,{url:"",requestMethod:"get",_className:"dojox.data.QueryReadStore",_items:[],_lastServerQuery:null,_numRows:-1,lastRequestHash:null,doClientPaging:false,doClientSorting:false,_itemsByIdentity:null,_identifier:null,_features:{"dojo.data.api.Read":true,"dojo.data.api.Identity":true},_labelAttr:"label",constructor:function(_e17){
dojo.mixin(this,_e17);
},getValue:function(item,_e18,_e19){
this._assertIsItem(item);
if(!dojo.isString(_e18)){
throw new Error(this._className+".getValue(): Invalid attribute, string expected!");
}
if(!this.hasAttribute(item,_e18)){
if(_e19){
return _e19;
}
}
return item.i[_e18];
},getValues:function(item,_e1a){
this._assertIsItem(item);
var ret=[];
if(this.hasAttribute(item,_e1a)){
ret.push(item.i[_e1a]);
}
return ret;
},getAttributes:function(item){
this._assertIsItem(item);
var ret=[];
for(var i in item.i){
ret.push(i);
}
return ret;
},hasAttribute:function(item,_e1b){
return this.isItem(item)&&typeof item.i[_e1b]!="undefined";
},containsValue:function(item,_e1c,_e1d){
var _e1e=this.getValues(item,_e1c);
var len=_e1e.length;
for(var i=0;i<len;i++){
if(_e1e[i]==_e1d){
return true;
}
}
return false;
},isItem:function(_e1f){
if(_e1f){
return typeof _e1f.r!="undefined"&&_e1f.r==this;
}
return false;
},isItemLoaded:function(_e20){
return this.isItem(_e20);
},loadItem:function(args){
if(this.isItemLoaded(args.item)){
return;
}
},fetch:function(_e21){
_e21=_e21||{};
if(!_e21.store){
_e21.store=this;
}
var self=this;
var _e22=function(_e23,_e24){
if(_e24.onError){
var _e25=_e24.scope||dojo.global;
_e24.onError.call(_e25,_e23,_e24);
}
};
var _e26=function(_e27,_e28,_e29){
var _e2a=_e28.abort||null;
var _e2b=false;
var _e2c=_e28.start?_e28.start:0;
if(self.doClientPaging==false){
_e2c=0;
}
var _e2d=_e28.count?(_e2c+_e28.count):_e27.length;
_e28.abort=function(){
_e2b=true;
if(_e2a){
_e2a.call(_e28);
}
};
var _e2e=_e28.scope||dojo.global;
if(!_e28.store){
_e28.store=self;
}
if(_e28.onBegin){
_e28.onBegin.call(_e2e,_e29,_e28);
}
if(_e28.sort&&self.doClientSorting){
_e27.sort(dojo.data.util.sorter.createSortFunction(_e28.sort,self));
}
if(_e28.onItem){
for(var i=_e2c;(i<_e27.length)&&(i<_e2d);++i){
var item=_e27[i];
if(!_e2b){
_e28.onItem.call(_e2e,item,_e28);
}
}
}
if(_e28.onComplete&&!_e2b){
var _e2f=null;
if(!_e28.onItem){
_e2f=_e27.slice(_e2c,_e2d);
}
_e28.onComplete.call(_e2e,_e2f,_e28);
}
};
this._fetchItems(_e21,_e26,_e22);
return _e21;
},getFeatures:function(){
return this._features;
},close:function(_e30){
},getLabel:function(item){
if(this._labelAttr&&this.isItem(item)){
return this.getValue(item,this._labelAttr);
}
return undefined;
},getLabelAttributes:function(item){
if(this._labelAttr){
return [this._labelAttr];
}
return null;
},_xhrFetchHandler:function(data,_e31,_e32,_e33){
data=this._filterResponse(data);
if(data.label){
this._labelAttr=data.label;
}
var _e34=data.numRows||-1;
this._items=[];
dojo.forEach(data.items,function(e){
this._items.push({i:e,r:this});
},this);
var _e35=data.identifier;
this._itemsByIdentity={};
if(_e35){
this._identifier=_e35;
var i;
for(i=0;i<this._items.length;++i){
var item=this._items[i].i;
var _e36=item[_e35];
if(!this._itemsByIdentity[_e36]){
this._itemsByIdentity[_e36]=item;
}else{
throw new Error(this._className+":  The json data as specified by: ["+this.url+"] is malformed.  Items within the list have identifier: ["+_e35+"].  Value collided: ["+_e36+"]");
}
}
}else{
this._identifier=Number;
for(i=0;i<this._items.length;++i){
this._items[i].n=i;
}
}
_e34=this._numRows=(_e34===-1)?this._items.length:_e34;
_e32(this._items,_e31,_e34);
this._numRows=_e34;
},_fetchItems:function(_e37,_e38,_e39){
var _e3a=_e37.serverQuery||_e37.query||{};
if(!this.doClientPaging){
_e3a.start=_e37.start||0;
if(_e37.count){
_e3a.count=_e37.count;
}
}
if(!this.doClientSorting&&_e37.sort){
var _e3b=[];
dojo.forEach(_e37.sort,function(sort){
if(sort&&sort.attribute){
_e3b.push((sort.descending?"-":"")+sort.attribute);
}
});
_e3a.sort=_e3b.join(",");
}
if(this.doClientPaging&&this._lastServerQuery!==null&&dojo.toJson(_e3a)==dojo.toJson(this._lastServerQuery)){
this._numRows=(this._numRows===-1)?this._items.length:this._numRows;
_e38(this._items,_e37,this._numRows);
}else{
var _e3c=this.requestMethod.toLowerCase()=="post"?dojo.xhrPost:dojo.xhrGet;
var _e3d=_e3c({url:this.url,handleAs:"json-comment-optional",content:_e3a,failOk:true});
_e37.abort=function(){
_e3d.cancel();
};
_e3d.addCallback(dojo.hitch(this,function(data){
this._xhrFetchHandler(data,_e37,_e38,_e39);
}));
_e3d.addErrback(function(_e3e){
_e39(_e3e,_e37);
});
this.lastRequestHash=new Date().getTime()+"-"+String(Math.random()).substring(2);
this._lastServerQuery=dojo.mixin({},_e3a);
}
},_filterResponse:function(data){
return data;
},_assertIsItem:function(item){
if(!this.isItem(item)){
throw new Error(this._className+": Invalid item argument.");
}
},_assertIsAttribute:function(_e3f){
if(typeof _e3f!=="string"){
throw new Error(this._className+": Invalid attribute argument ('"+_e3f+"').");
}
},fetchItemByIdentity:function(_e40){
if(this._itemsByIdentity){
var item=this._itemsByIdentity[_e40.identity];
if(!(item===undefined)){
if(_e40.onItem){
var _e41=_e40.scope?_e40.scope:dojo.global;
_e40.onItem.call(_e41,{i:item,r:this});
}
return;
}
}
var _e42=function(_e43,_e44){
var _e45=_e40.scope?_e40.scope:dojo.global;
if(_e40.onError){
_e40.onError.call(_e45,_e43);
}
};
var _e46=function(_e47,_e48){
var _e49=_e40.scope?_e40.scope:dojo.global;
try{
var item=null;
if(_e47&&_e47.length==1){
item=_e47[0];
}
if(_e40.onItem){
_e40.onItem.call(_e49,item);
}
}
catch(error){
if(_e40.onError){
_e40.onError.call(_e49,error);
}
}
};
var _e4a={serverQuery:{id:_e40.identity}};
this._fetchItems(_e4a,_e46,_e42);
},getIdentity:function(item){
var _e4b=null;
if(this._identifier===Number){
_e4b=item.n;
}else{
_e4b=item.i[this._identifier];
}
return _e4b;
},getIdentityAttributes:function(item){
return [this._identifier];
}});
return _e16.data.QueryReadStore;
});
},"davinci/model/resource/Resource":function(){
define(["dojo/_base/declare","dojo/_base/xhr","dojo/_base/connect","dojo/Deferred","dijit/registry","davinci/Runtime","davinci/model/Model","davinci/model/Path","davinci/ve/utils/URLRewrite"],function(_e4c,xhr,_e4d,_e4e,_e4f,_e50,_e51,Path,_e52){
return _e4c("davinci.model.resource.Resource",_e51,{constructor:function(){
this.elementType="Resource";
this.name="";
this.parent=null;
this._id=dijit.getUniqueId("maqFileResource");
},getName:function(){
return this.name;
},getPath:function(){
if(this.parent){
return this.parent.getPath()+"/"+this.name;
}
return this.name;
},readOnly:function(){
if(this.hasOwnProperty("_readOnly")){
return this._readOnly||(this.parent!=null&&this.parent.readOnly());
}
if(this.parent){
return this.parent.readOnly();
}
return false;
},getURL:function(){
var path=this.getPath();
if(path.indexOf("./")==0){
path=path.substring(2,path.length);
}
var _e53=_e50.getUserWorkspaceUrl();
return _e53+path;
},rename:function(_e54){
var _e55=new Path(this.getPath()).removeLastSegments().append(_e54);
return xhr.get({url:"cmd/rename",handleAs:"text",content:{oldName:this.getPath(),newName:_e55.toString()}}).then(function(){
this.name=_e54;
_e4d.publish("/davinci/resource/resourceChanged",["renamed",this]);
}.bind(this));
},getParentFolder:function(){
if(this.elementType=="File"){
return this.parent;
}
return this;
},isVirtual:function(){
return !!this.libraryId;
},visit:function(_e56,_e57){
var _e58=_e56.visit(this);
if(!this._isLoaded&&this.elementType=="Folder"&&!_e57){
this.getChildren(dojo.hitch(this,function(){
dojo.forEach(this.children,function(_e59){
_e59.visit(_e56,_e57);
});
}));
}else{
if(this.children&&!_e58){
dojo.forEach(this.children,function(_e5a){
_e5a.visit(_e56,_e57);
});
}
}
},deleteResource:function(_e5b){
var _e5c,_e5d=function(){
var name=this.getName();
this.parent.children.some(function(_e5e,i,_e5f){
if(_e5e.getName()==name){
_e5f.splice(i,1);
return true;
}
});
_e4d.publish("/davinci/resource/resourceChanged",["deleted",this]);
}.bind(this);
if(_e5b){
_e5c=new _e4e();
_e5d();
_e5c.resolve();
}else{
_e5c=xhr.get({url:"cmd/deleteResource",handleAs:"text",content:{path:this.getPath()}}).then(_e5d,function(){
});
}
return _e5c;
},getId:function(){
return this._id;
}});
});
},"dijit/form/CheckBox":function(){
require({cache:{"url:dijit/form/templates/CheckBox.html":"<div class=\"dijit dijitReset dijitInline\" role=\"presentation\"\n\t><input\n\t \t${!nameAttrSetting} type=\"${type}\" ${checkedAttrSetting}\n\t\tclass=\"dijitReset dijitCheckBoxInput\"\n\t\tdata-dojo-attach-point=\"focusNode\"\n\t \tdata-dojo-attach-event=\"onclick:_onClick\"\n/></div>\n"}});
define("dijit/form/CheckBox",["require","dojo/_base/declare","dojo/dom-attr","dojo/has","dojo/query","dojo/ready","./ToggleButton","./_CheckBoxMixin","dojo/text!./templates/CheckBox.html","dojo/NodeList-dom"],function(_e60,_e61,_e62,has,_e63,_e64,_e65,_e66,_e67){
if(has("dijit-legacy-requires")){
_e64(0,function(){
var _e68=["dijit/form/RadioButton"];
_e60(_e68);
});
}
return _e61("dijit.form.CheckBox",[_e65,_e66],{templateString:_e67,baseClass:"dijitCheckBox",_setValueAttr:function(_e69,_e6a){
if(typeof _e69=="string"){
this.inherited(arguments);
_e69=true;
}
if(this._created){
this.set("checked",_e69,_e6a);
}
},_getValueAttr:function(){
return (this.checked?this.value:false);
},_setIconClassAttr:null,postMixInProperties:function(){
this.inherited(arguments);
this.checkedAttrSetting=this.checked?"checked":"";
},_fillContent:function(){
},_onFocus:function(){
if(this.id){
_e63("label[for='"+this.id+"']").addClass("dijitFocusedLabel");
}
this.inherited(arguments);
},_onBlur:function(){
if(this.id){
_e63("label[for='"+this.id+"']").removeClass("dijitFocusedLabel");
}
this.inherited(arguments);
}});
});
},"dojox/html/entities":function(){
define("dojox/html/entities",["dojo/_base/lang"],function(lang){
var dhe=lang.getObject("dojox.html.entities",true);
var _e6b=function(str,map){
var _e6c,_e6d;
if(map._encCache&&map._encCache.regexp&&map._encCache.mapper&&map.length==map._encCache.length){
_e6c=map._encCache.mapper;
_e6d=map._encCache.regexp;
}else{
_e6c={};
_e6d=["["];
var i;
for(i=0;i<map.length;i++){
_e6c[map[i][0]]="&"+map[i][1]+";";
_e6d.push(map[i][0]);
}
_e6d.push("]");
_e6d=new RegExp(_e6d.join(""),"g");
map._encCache={mapper:_e6c,regexp:_e6d,length:map.length};
}
str=str.replace(_e6d,function(c){
return _e6c[c];
});
return str;
};
var _e6e=function(str,map){
var _e6f,_e70;
if(map._decCache&&map._decCache.regexp&&map._decCache.mapper&&map.length==map._decCache.length){
_e6f=map._decCache.mapper;
_e70=map._decCache.regexp;
}else{
_e6f={};
_e70=["("];
var i;
for(i=0;i<map.length;i++){
var e="&"+map[i][1]+";";
if(i){
_e70.push("|");
}
_e6f[e]=map[i][0];
_e70.push(e);
}
_e70.push(")");
_e70=new RegExp(_e70.join(""),"g");
map._decCache={mapper:_e6f,regexp:_e70,length:map.length};
}
str=str.replace(_e70,function(c){
return _e6f[c];
});
return str;
};
dhe.html=[["&","amp"],["\"","quot"],["<","lt"],[">","gt"],["","nbsp"]];
dhe.latin=[["","iexcl"],["","cent"],["","pound"],["","euro"],["","curren"],["","yen"],["","brvbar"],["","sect"],["","uml"],["","copy"],["","ordf"],["","laquo"],["","not"],["","shy"],["","reg"],["","macr"],["","deg"],["","plusmn"],["","sup2"],["","sup3"],["","acute"],["","micro"],["","para"],["","middot"],["","cedil"],["","sup1"],["","ordm"],["","raquo"],["","frac14"],["","frac12"],["","frac34"],["","iquest"],["","Agrave"],["","Aacute"],["","Acirc"],["","Atilde"],["","Auml"],["","Aring"],["","AElig"],["","Ccedil"],["","Egrave"],["","Eacute"],["","Ecirc"],["","Euml"],["","Igrave"],["","Iacute"],["","Icirc"],["","Iuml"],["","ETH"],["","Ntilde"],["","Ograve"],["","Oacute"],["","Ocirc"],["","Otilde"],["","Ouml"],["","times"],["","Oslash"],["","Ugrave"],["","Uacute"],["","Ucirc"],["","Uuml"],["","Yacute"],["","THORN"],["","szlig"],["","agrave"],["","aacute"],["","acirc"],["","atilde"],["","auml"],["","aring"],["","aelig"],["","ccedil"],["","egrave"],["","eacute"],["","ecirc"],["","euml"],["","igrave"],["","iacute"],["","icirc"],["","iuml"],["","eth"],["","ntilde"],["","ograve"],["","oacute"],["","ocirc"],["","otilde"],["","ouml"],["","divide"],["","oslash"],["","ugrave"],["","uacute"],["","ucirc"],["","uuml"],["","yacute"],["","thorn"],["","yuml"],["","fnof"],["","Alpha"],["","Beta"],["","Gamma"],["","Delta"],["","Epsilon"],["","Zeta"],["","Eta"],["","Theta"],["","Iota"],["","Kappa"],["","Lambda"],["","Mu"],["","Nu"],["","Xi"],["","Omicron"],["","Pi"],["","Rho"],["","Sigma"],["","Tau"],["","Upsilon"],["","Phi"],["","Chi"],["","Psi"],["","Omega"],["","alpha"],["","beta"],["","gamma"],["","delta"],["","epsilon"],["","zeta"],["","eta"],["","theta"],["","iota"],["","kappa"],["","lambda"],["","mu"],["","nu"],["","xi"],["","omicron"],["","pi"],["","rho"],["","sigmaf"],["","sigma"],["","tau"],["","upsilon"],["","phi"],["","chi"],["","psi"],["","omega"],["","thetasym"],["","upsih"],["","piv"],["","bull"],["","hellip"],["","prime"],["","Prime"],["","oline"],["","frasl"],["","weierp"],["","image"],["","real"],["","trade"],["","alefsym"],["","larr"],["","uarr"],["","rarr"],["","darr"],["","harr"],["","crarr"],["","lArr"],["","uArr"],["","rArr"],["","dArr"],["","hArr"],["","forall"],["","part"],["","exist"],["","empty"],["","nabla"],["","isin"],["","notin"],["","ni"],["","prod"],["","sum"],["","minus"],["","lowast"],["","radic"],["","prop"],["","infin"],["","ang"],["","and"],["","or"],["","cap"],["","cup"],["","int"],["","there4"],["","sim"],["","cong"],["","asymp"],["","ne"],["","equiv"],["","le"],["","ge"],["","sub"],["","sup"],["","nsub"],["","sube"],["","supe"],["","oplus"],["","otimes"],["","perp"],["","sdot"],["","lceil"],["","rceil"],["","lfloor"],["","rfloor"],["","lang"],["","rang"],["","loz"],["","spades"],["","clubs"],["","hearts"],["","diams"],["","Elig"],["","oelig"],["","Scaron"],["","scaron"],["","Yuml"],["","circ"],["","tilde"],["","ensp"],["","emsp"],["","thinsp"],["","zwnj"],["","zwj"],["","lrm"],["","rlm"],["","ndash"],["","mdash"],["","lsquo"],["","rsquo"],["","sbquo"],["","ldquo"],["","rdquo"],["","bdquo"],["","dagger"],["","Dagger"],["","permil"],["","lsaquo"],["","rsaquo"]];
dhe.encode=function(str,m){
if(str){
if(!m){
str=_e6b(str,dhe.html);
str=_e6b(str,dhe.latin);
}else{
str=_e6b(str,m);
}
}
return str;
};
dhe.decode=function(str,m){
if(str){
if(!m){
str=_e6e(str,dhe.html);
str=_e6e(str,dhe.latin);
}else{
str=_e6e(str,m);
}
}
return str;
};
return dhe;
});
},"davinci/ui/widgets/FileFieldDialog":function(){
require({cache:{"url:davinci/ui/widgets/templates/FileFieldDialog.html":"<div>\n\t<div style='float:right;'>\n\t\t<button type='button' style='font-size:.75em;float:right;' dojoType=\"dijit.form.Button\" dojoAttachPoint=\"button\" dojoAttachEvent=\"onClick:_showFileSelectionDialog\">...</button>\n\t</div>\n\t<div style='margin-right:35px;'>\n\t\t<input style='width:100%;' type='text' dojoType=\"dijit.form.TextBox\" dojoAttachPoint=\"textField\" dojoAttachEvent=\"onChange:_onChange\"></input>\n\t</div>\n</div>\n\n"}});
define("davinci/ui/widgets/FileFieldDialog",["dojo/_base/declare","dijit/_WidgetBase","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","davinci/Workbench","davinci/ui/widgets/OpenFile","dijit/form/Button","davinci/model/Path","dojo/i18n!davinci/ui/nls/ui","dojo/i18n!dijit/nls/common","dojo/text!./templates/FileFieldDialog.html","dijit/form/TextBox",],function(_e71,_e72,_e73,_e74,_e75,_e76,_e77,Path,_e78,_e79,_e7a){
var _e7b="davinci_ui_widgets_filefielddialog_generated";
var _e7c=0;
var _e7d=function(){
return _e7b+(_e7c++);
};
return _e71("davinci.ui.widgets.FileFieldDialog",[_e72,_e73,_e74],{templateString:_e7a,widgetsInTemplate:true,_fileSelectionDialog:null,_showFileSelectionDialog:function(){
var _e7e=function(){
var tree=_e7f.fileTree;
if(tree.selectedItem){
var _e80=tree.selectedItem.getPath();
var path=new Path(_e80);
var _e81=path.relativeTo(new Path(this._baseLocation),true).toString();
this.textField.set("value",_e81);
this._onChange();
}
};
var _e7f=new _e76({finishButtonLabel:_e78.select});
_e75.showModal(_e7f,_e78.selectFile,{width:275,height:220},dojo.hitch(this,_e7e),true);
},_setBaseLocationAttr:function(_e82){
this._baseLocation=_e82;
},_setValueAttr:function(_e83){
if(this.value!=_e83){
this.value=_e83;
this.textField.set("value",_e83);
}
},_setDisabledAttr:function(_e84){
this.textField.set("disabled",_e84);
this.button.set("disabled",_e84);
this.inherited(arguments);
},_setIntermediateChangesAttr:function(_e85){
this.textField.set("intermediateChanges",_e85);
this.inherited(arguments);
},_onChange:function(){
var _e86=this.textField.get("value");
if(this.value!=_e86){
this.value=_e86;
this.textField.set("value",this.value);
this.onChange(_e86);
}
},onChange:function(_e87){
},_getValueAttr:function(){
return this.textField.get("value");
}});
});
},"dijit/form/DateTextBox":function(){
define("dijit/form/DateTextBox",["dojo/_base/declare","../Calendar","./_DateTimeTextBox"],function(_e88,_e89,_e8a){
return _e88("dijit.form.DateTextBox",_e8a,{baseClass:"dijitTextBox dijitComboBox dijitDateTextBox",popupClass:_e89,_selector:"date",value:new Date("")});
});
},"dijit/Calendar":function(){
define("dijit/Calendar",["dojo/_base/array","dojo/date","dojo/date/locale","dojo/_base/declare","dojo/dom-attr","dojo/dom-class","dojo/_base/event","dojo/_base/kernel","dojo/keys","dojo/_base/lang","dojo/sniff","./CalendarLite","./_Widget","./_CssStateMixin","./_TemplatedMixin","./form/DropDownButton"],function(_e8b,date,_e8c,_e8d,_e8e,_e8f,_e90,_e91,keys,lang,has,_e92,_e93,_e94,_e95,_e96){
var _e97=_e8d("dijit.Calendar",[_e92,_e93,_e94],{cssStateNodes:{"decrementMonth":"dijitCalendarArrow","incrementMonth":"dijitCalendarArrow","previousYearLabelNode":"dijitCalendarPreviousYear","nextYearLabelNode":"dijitCalendarNextYear"},setValue:function(_e98){
_e91.deprecated("dijit.Calendar:setValue() is deprecated.  Use set('value', ...) instead.","","2.0");
this.set("value",_e98);
},_createMonthWidget:function(){
return new _e97._MonthDropDownButton({id:this.id+"_mddb",tabIndex:-1,onMonthSelect:lang.hitch(this,"_onMonthSelect"),lang:this.lang,dateLocaleModule:this.dateLocaleModule},this.monthNode);
},postCreate:function(){
this.inherited(arguments);
this.connect(this.domNode,"onkeydown","_onKeyDown");
this.connect(this.dateRowsNode,"onmouseover","_onDayMouseOver");
this.connect(this.dateRowsNode,"onmouseout","_onDayMouseOut");
this.connect(this.dateRowsNode,"onmousedown","_onDayMouseDown");
this.connect(this.dateRowsNode,"onmouseup","_onDayMouseUp");
},_onMonthSelect:function(_e99){
var date=new this.dateClassObj(this.currentFocus);
date.setDate(1);
date.setMonth(_e99);
var _e9a=this.dateModule.getDaysInMonth(date);
var _e9b=this.currentFocus.getDate();
date.setDate(Math.min(_e9b,_e9a));
this._setCurrentFocusAttr(date);
},_onDayMouseOver:function(evt){
var node=_e8f.contains(evt.target,"dijitCalendarDateLabel")?evt.target.parentNode:evt.target;
if(node&&((node.dijitDateValue&&!_e8f.contains(node,"dijitCalendarDisabledDate"))||node==this.previousYearLabelNode||node==this.nextYearLabelNode)){
_e8f.add(node,"dijitCalendarHoveredDate");
this._currentNode=node;
}
},_onDayMouseOut:function(evt){
if(!this._currentNode){
return;
}
if(evt.relatedTarget&&evt.relatedTarget.parentNode==this._currentNode){
return;
}
var cls="dijitCalendarHoveredDate";
if(_e8f.contains(this._currentNode,"dijitCalendarActiveDate")){
cls+=" dijitCalendarActiveDate";
}
_e8f.remove(this._currentNode,cls);
this._currentNode=null;
},_onDayMouseDown:function(evt){
var node=evt.target.parentNode;
if(node&&node.dijitDateValue&&!_e8f.contains(node,"dijitCalendarDisabledDate")){
_e8f.add(node,"dijitCalendarActiveDate");
this._currentNode=node;
}
},_onDayMouseUp:function(evt){
var node=evt.target.parentNode;
if(node&&node.dijitDateValue){
_e8f.remove(node,"dijitCalendarActiveDate");
}
},handleKey:function(evt){
var _e9c=-1,_e9d,_e9e=this.currentFocus;
switch(evt.keyCode){
case keys.RIGHT_ARROW:
_e9c=1;
case keys.LEFT_ARROW:
_e9d="day";
if(!this.isLeftToRight()){
_e9c*=-1;
}
break;
case keys.DOWN_ARROW:
_e9c=1;
case keys.UP_ARROW:
_e9d="week";
break;
case keys.PAGE_DOWN:
_e9c=1;
case keys.PAGE_UP:
_e9d=evt.ctrlKey||evt.altKey?"year":"month";
break;
case keys.END:
_e9e=this.dateModule.add(_e9e,"month",1);
_e9d="day";
case keys.HOME:
_e9e=new this.dateClassObj(_e9e);
_e9e.setDate(1);
break;
case keys.ENTER:
case keys.SPACE:
this.set("value",this.currentFocus);
break;
default:
return true;
}
if(_e9d){
_e9e=this.dateModule.add(_e9e,_e9d,_e9c);
}
this._setCurrentFocusAttr(_e9e);
return false;
},_onKeyDown:function(evt){
if(!this.handleKey(evt)){
_e90.stop(evt);
}
},onValueSelected:function(){
},onChange:function(_e9f){
this.onValueSelected(_e9f);
},getClassForDate:function(){
}});
_e97._MonthDropDownButton=_e8d("dijit.Calendar._MonthDropDownButton",_e96,{onMonthSelect:function(){
},postCreate:function(){
this.inherited(arguments);
this.dropDown=new _e97._MonthDropDown({id:this.id+"_mdd",onChange:this.onMonthSelect});
},_setMonthAttr:function(_ea0){
var _ea1=this.dateLocaleModule.getNames("months","wide","standAlone",this.lang,_ea0);
this.dropDown.set("months",_ea1);
this.containerNode.innerHTML=(has("ie")==6?"":"<div class='dijitSpacer'>"+this.dropDown.domNode.innerHTML+"</div>")+"<div class='dijitCalendarMonthLabel dijitCalendarCurrentMonthLabel'>"+_ea1[_ea0.getMonth()]+"</div>";
}});
_e97._MonthDropDown=_e8d("dijit.Calendar._MonthDropDown",[_e93,_e95],{months:[],templateString:"<div class='dijitCalendarMonthMenu dijitMenu' "+"data-dojo-attach-event='onclick:_onClick,onmouseover:_onMenuHover,onmouseout:_onMenuHover'></div>",_setMonthsAttr:function(_ea2){
this.domNode.innerHTML=_e8b.map(_ea2,function(_ea3,idx){
return _ea3?"<div class='dijitCalendarMonthLabel' month='"+idx+"'>"+_ea3+"</div>":"";
}).join("");
},_onClick:function(evt){
this.onChange(_e8e.get(evt.target,"month"));
},onChange:function(){
},_onMenuHover:function(evt){
_e8f.toggle(evt.target,"dijitCalendarMonthLabelHover",evt.type=="mouseover");
}});
return _e97;
});
},"dojox/form/Uploader":function(){
require({cache:{"url:dojox/form/resources/Uploader.html":"<span class=\"dijit dijitReset dijitInline\"\n\t><span class=\"dijitReset dijitInline dijitButtonNode\"\n\t\tdojoAttachEvent=\"ondijitclick:_onClick\"\n\t\t><span class=\"dijitReset dijitStretch dijitButtonContents\"\n\t\t\tdojoAttachPoint=\"titleNode,focusNode\"\n\t\t\trole=\"button\" aria-labelledby=\"${id}_label\"\n\t\t\t><span class=\"dijitReset dijitInline dijitIcon\" dojoAttachPoint=\"iconNode\"></span\n\t\t\t><span class=\"dijitReset dijitToggleButtonIconChar\">&#x25CF;</span\n\t\t\t><span class=\"dijitReset dijitInline dijitButtonText\"\n\t\t\t\tid=\"${id}_label\"\n\t\t\t\tdojoAttachPoint=\"containerNode\"\n\t\t\t></span\n\t\t></span\n\t></span\n\t><!--no need to have this for Uploader \n\t<input ${!nameAttrSetting} type=\"${type}\" value=\"${value}\" class=\"dijitOffScreen\" tabIndex=\"-1\"\n\t\tdojoAttachPoint=\"valueNode\"\n/--></span>\n"}});
define("dojox/form/Uploader",["dojo/_base/kernel","dojo/_base/declare","dojo/_base/lang","dojo/_base/array","dojo/_base/connect","dojo/_base/window","dojo/dom-style","dojo/dom-geometry","dojo/dom-attr","dojo/dom-construct","dojo/dom-form","dijit","dijit/form/Button","dojox/form/uploader/Base","dojo/i18n!./nls/Uploader","dojo/text!./resources/Uploader.html"],function(_ea4,_ea5,lang,_ea6,_ea7,win,_ea8,_ea9,_eaa,_eab,_eac,_ead,_eae,_eaf,res,_eb0){
_ea4.experimental("dojox.form.Uploader");
_ea5("dojox.form.Uploader",[_eaf,_eae],{uploadOnSelect:false,tabIndex:0,multiple:false,label:res.label,url:"",name:"uploadedfile",flashFieldName:"",uploadType:"form",showInput:"",_nameIndex:0,templateString:_eb0,baseClass:"dijitUploader "+_eae.prototype.baseClass,postMixInProperties:function(){
this._inputs=[];
this._cons=[];
this.inherited(arguments);
},buildRendering:function(){
this.inherited(arguments);
_ea8.set(this.domNode,{overflow:"hidden",position:"relative"});
this._buildDisplay();
_eaa.set(this.titleNode,"tabIndex",-1);
},_buildDisplay:function(){
if(this.showInput){
this.displayInput=dojo.create("input",{"class":"dijitUploadDisplayInput","tabIndex":-1,"autocomplete":"off"},this.containerNode,this.showInput);
this._attachPoints.push("displayInput");
this.connect(this,"onChange",function(_eb1){
var i=0,l=_eb1.length,f,r=[];
while((f=_eb1[i++])){
if(f&&f.name){
r.push(f.name);
}
}
this.displayInput.value=r.join(", ");
});
this.connect(this,"reset",function(){
this.displayInput.value="";
});
}
},startup:function(){
if(this._buildInitialized){
return;
}
this._buildInitialized=true;
this._getButtonStyle(this.domNode);
this._setButtonStyle();
this.inherited(arguments);
},onChange:function(_eb2){
},onBegin:function(_eb3){
},onProgress:function(_eb4){
},onComplete:function(_eb5){
this.reset();
},onCancel:function(){
},onAbort:function(){
},onError:function(_eb6){
},upload:function(_eb7){
},submit:function(form){
form=!!form?form.tagName?form:this.getForm():this.getForm();
var data=_eac.toObject(form);
this.upload(data);
},reset:function(){
delete this._files;
this._disconnectButton();
_ea6.forEach(this._inputs,_eab.destroy,dojo);
this._inputs=[];
this._nameIndex=0;
this._createInput();
},getFileList:function(){
var _eb8=[];
if(this.supports("multiple")){
_ea6.forEach(this._files,function(f,i){
_eb8.push({index:i,name:f.name,size:f.size,type:f.type});
},this);
}else{
_ea6.forEach(this._inputs,function(n,i){
if(n.value){
_eb8.push({index:i,name:n.value.substring(n.value.lastIndexOf("\\")+1),size:0,type:n.value.substring(n.value.lastIndexOf(".")+1)});
}
},this);
}
return _eb8;
},_getValueAttr:function(){
return this.getFileList();
},_setValueAttr:function(_eb9){
console.error("Uploader value is read only");
},_setDisabledAttr:function(_eba){
if(this._disabled==_eba){
return;
}
this.inherited(arguments);
_ea8.set(this.inputNode,"display",_eba?"none":"");
},_getButtonStyle:function(node){
this.btnSize={w:_ea8.get(node,"width"),h:_ea8.get(node,"height")};
},_setButtonStyle:function(){
this.inputNodeFontSize=Math.max(2,Math.max(Math.ceil(this.btnSize.w/60),Math.ceil(this.btnSize.h/15)));
this._createInput();
},_getFileFieldName:function(){
var name;
if(this.multiple&&this.supports("multiple")){
name=this.name+"s[]";
}else{
name=this.name+(this.multiple?this._nameIndex:"");
}
return name;
},_createInput:function(){
if(this._inputs.length){
_ea8.set(this.inputNode,{top:"500px"});
this._disconnectButton();
this._nameIndex++;
}
var name=this._getFileFieldName();
this.focusNode=this.inputNode=_eab.create("input",{type:"file",name:name},this.domNode,"first");
if(this.supports("multiple")&&this.multiple){
_eaa.set(this.inputNode,"multiple",true);
}
this._inputs.push(this.inputNode);
_ea8.set(this.inputNode,{position:"absolute",fontSize:this.inputNodeFontSize+"em",top:"-3px",right:"-3px",opacity:0});
this._connectButton();
},_connectButton:function(){
this._cons.push(_ea7.connect(this.inputNode,"change",this,function(evt){
this._files=this.inputNode.files;
this.onChange(this.getFileList(evt));
if(!this.supports("multiple")&&this.multiple){
this._createInput();
}
}));
if(this.tabIndex>-1){
this.inputNode.tabIndex=this.tabIndex;
this._cons.push(_ea7.connect(this.inputNode,"focus",this,function(){
this.titleNode.style.outline="1px dashed #ccc";
}));
this._cons.push(_ea7.connect(this.inputNode,"blur",this,function(){
this.titleNode.style.outline="";
}));
}
},_disconnectButton:function(){
_ea6.forEach(this._cons,_ea7.disconnect);
this._cons.splice(0,this._cons.length);
}});
dojox.form.UploaderOrg=dojox.form.Uploader;
var _ebb=[dojox.form.UploaderOrg];
dojox.form.addUploaderPlugin=function(plug){
_ebb.push(plug);
_ea5("dojox.form.Uploader",_ebb,{});
};
return dojox.form.Uploader;
});
},"dijit/form/Button":function(){
require({cache:{"url:dijit/form/templates/Button.html":"<span class=\"dijit dijitReset dijitInline\" role=\"presentation\"\n\t><span class=\"dijitReset dijitInline dijitButtonNode\"\n\t\tdata-dojo-attach-event=\"ondijitclick:_onClick\" role=\"presentation\"\n\t\t><span class=\"dijitReset dijitStretch dijitButtonContents\"\n\t\t\tdata-dojo-attach-point=\"titleNode,focusNode\"\n\t\t\trole=\"button\" aria-labelledby=\"${id}_label\"\n\t\t\t><span class=\"dijitReset dijitInline dijitIcon\" data-dojo-attach-point=\"iconNode\"></span\n\t\t\t><span class=\"dijitReset dijitToggleButtonIconChar\">&#x25CF;</span\n\t\t\t><span class=\"dijitReset dijitInline dijitButtonText\"\n\t\t\t\tid=\"${id}_label\"\n\t\t\t\tdata-dojo-attach-point=\"containerNode\"\n\t\t\t></span\n\t\t></span\n\t></span\n\t><input ${!nameAttrSetting} type=\"${type}\" value=\"${value}\" class=\"dijitOffScreen\"\n\t\ttabIndex=\"-1\" role=\"presentation\" data-dojo-attach-point=\"valueNode\"\n/></span>\n"}});
define("dijit/form/Button",["require","dojo/_base/declare","dojo/dom-class","dojo/has","dojo/_base/kernel","dojo/_base/lang","dojo/ready","./_FormWidget","./_ButtonMixin","dojo/text!./templates/Button.html"],function(_ebc,_ebd,_ebe,has,_ebf,lang,_ec0,_ec1,_ec2,_ec3){
if(has("dijit-legacy-requires")){
_ec0(0,function(){
var _ec4=["dijit/form/DropDownButton","dijit/form/ComboButton","dijit/form/ToggleButton"];
_ebc(_ec4);
});
}
return _ebd("dijit.form.Button",[_ec1,_ec2],{showLabel:true,iconClass:"dijitNoIcon",_setIconClassAttr:{node:"iconNode",type:"class"},baseClass:"dijitButton",templateString:_ec3,_setValueAttr:"valueNode",_onClick:function(e){
var ok=this.inherited(arguments);
if(ok){
if(this.valueNode){
this.valueNode.click();
e.preventDefault();
e.stopPropagation();
}
}
return ok;
},_fillContent:function(_ec5){
if(_ec5&&(!this.params||!("label" in this.params))){
var _ec6=lang.trim(_ec5.innerHTML);
if(_ec6){
this.label=_ec6;
}
}
},_setShowLabelAttr:function(val){
if(this.containerNode){
_ebe.toggle(this.containerNode,"dijitDisplayNone",!val);
}
this._set("showLabel",val);
},setLabel:function(_ec7){
_ebf.deprecated("dijit.form.Button.setLabel() is deprecated.  Use set('label', ...) instead.","","2.0");
this.set("label",_ec7);
},_setLabelAttr:function(_ec8){
this.inherited(arguments);
if(!this.showLabel&&!("title" in this.params)){
this.titleNode.title=lang.trim(this.containerNode.innerText||this.containerNode.textContent||"");
}
}});
});
},"davinci/review/model/ReviewTreeModel":function(){
define(["dojo/_base/declare","davinci/review/model/Resource"],function(_ec9,_eca){
return _ec9("davinci.review.model.ReviewTreeModel",null,{foldersOnly:false,constructor:function(args){
this.root=_eca.getRoot();
this.subscription=[dojo.subscribe("/davinci/review/resourceChanged",this,this.resourceChanged)];
},destroy:function(){
this.subscriptions.forEach(dojo.unsubscribe);
},getRoot:function(_ecb){
_ecb(this.root);
},mayHaveChildren:function(item){
return item.elementType=="ReviewVersion"&&!item.isDraft;
},getChildren:function(_ecc,_ecd,_ece){
_ecc.getChildren(_ecd,_ece);
},getIdentity:function(item){
return item.getPath();
},resourceChanged:function(_ecf,type,_ed0){
if(_ed0){
if(_ed0._isLoaded){
_ed0.getChildren(function(_ed1){
_ed1.forEach(this.onDelete,this);
}.bind(this),true);
}
this.onDelete(_ed0);
}
var _ed2=this.root;
_ed2._isLoaded=false;
_ed2.getChildren(function(_ed3){
this.onChildrenChange(_ed2,_ed3);
}.bind(this));
},getLabel:function(item){
var _ed4=item.getName();
if(item.elementType=="ReviewVersion"&&item.isDraft){
_ed4+=" (Draft)";
}
if(item.elementType=="ReviewFile"){
var path=new davinci.model.Path(_ed4);
var _ed5=path.getSegments();
var _ed6=davinci.Runtime.getExtension("davinci.editor",function(_ed7){
return _ed7.id==="davinci.review.CommentReviewEditor";
});
var _ed8="."+_ed6.extensions;
_ed4=_ed5[_ed5.length-1]+_ed8;
}
return _ed4;
},newItem:function(args,_ed9){
},pasteItem:function(_eda,_edb,_edc,_edd){
},onChange:function(item){
},onDelete:function(item){
},onChildrenChange:function(_ede,_edf){
}});
});
},"davinci/actions/SelectLayoutAction":function(){
define(["dojo/_base/declare","dijit/_WidgetBase","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","./Action","../Workbench","dojo/i18n!./nls/actions","dojo/text!../ui/templates/SwitchLayout.html",],function(_ee0,_ee1,_ee2,_ee3,_ee4,_ee5,_ee6,_ee7){
_ee0("davinci.actions.SelectLayoutActionContent",[_ee1,_ee2,_ee3],{templateString:_ee7,langObj:_ee6,combobox:null,flowLayout:null,postCreate:function(){
this.combobox.set("value",this.flowLayout?_ee6.flow:_ee6.abs);
},getValue:function(){
return this.combobox.get("value")==_ee6.flow?"Flow positioning":"Absolute positioning";
}});
return _ee0("davinci.actions.SelectLayoutAction",_ee4,{run:function(_ee8){
if(!this.isEnabled(null)){
return;
}
this.showLayouts();
},isEnabled:function(_ee9){
return _ee5.getOpenEditor().declaredClass=="davinci.ve.PageEditor";
},_changeLayoutCommand:function(_eea){
var d=dijit.byId("selectLayout");
if(d){
d.destroyRecursive(false);
}
var e=_ee5.getOpenEditor();
if(e&&e.getContext){
var _eeb=true;
if(_eea==="absolute"||_eea==="Absolute positioning"){
_eeb=false;
}
var c=e.getContext();
c.setFlowLayout(_eeb);
e._visualChanged();
}
},showLayouts:function(){
var e=_ee5.getOpenEditor();
var c=e.getContext();
var _eec=c.getFlowLayout();
e._visualChanged();
var ui=new davinci.actions.SelectLayoutActionContent({flowLayout:_eec});
function _eed(){
this._changeLayoutCommand(ui.getValue());
};
_ee5.showDialog(_ee6.newWidgetsShouldUse,ui,{width:200},dojo.hitch(this,_eed),_ee6.select);
}});
});
},"davinci/ve/palette/Palette":function(){
define("davinci/ve/palette/Palette",["dojo/_base/declare","dijit/_WidgetBase","davinci/Workbench","dijit/_KeyNavContainer","dijit/Tooltip","dijit/form/TextBox","davinci/ui/dnd/DragSource","davinci/ve/metadata","davinci/library","./PaletteFolder","./PaletteItem","dojo/i18n!davinci/ve/nls/common","davinci/ve/tools/CreateTool"],function(_eee,_eef,_ef0,_ef1,_ef2,_ef3,_ef4,_ef5,_ef6,_ef7,_ef8,_ef9,_efa){
return _eee("davinci.ve.palette.Palette",[_eef,_ef1],{descriptors:"",_folders:{},_folderNodes:{},postMixInProperties:function(){
this._resource=_ef9;
},postCreate:function(){
dojo.addClass(this.domNode,"dojoyPalette");
this.refresh();
this.connectKeyNavHandlers([dojo.keys.UP_ARROW],[dojo.keys.DOWN_ARROW]);
dojo.subscribe("/davinci/ui/libraryChanged",this,"refresh");
dojo.subscribe("/davinci/ui/addedCustomWidget",this,"addCustomWidget");
},addCustomWidget:function(lib){
if(!this._loaded){
return;
}
var _efb={};
dojo.mixin(_efb,{custom:lib});
var _efc={};
for(var name in _efb){
if(_efb.hasOwnProperty(name)){
var _efd=_efb[name].$wm;
if(!_efd){
continue;
}
dojo.forEach(_efd.widgets,function(item){
var _efe=_efd.categories[item.category];
if(!_efc[_efe.name]){
_efc[_efe.name]=dojo.clone(_efe);
_efc[_efe.name].items=[];
}
var _eff=dojo.clone(item);
_eff.$library=_efd;
_efc[_efe.name].items.push(_eff);
});
}
}
this._generateCssRules(_efc);
for(var name in _efc){
var _f00=_efc[name];
var _f01="ve/resources/images/";
var _f02="fldr_obj.gif";
var _f03=_f02;
var _f04=_f01+_f03;
var _f05=this._getIconUri(_f00.icon,_f04);
var opt={paletteId:this.id,icon:_f05,displayName:_f00.name};
var _f06=this._createFolder(opt);
dojo.forEach(_f00.items,function(item){
if(item.hidden||this._hasItem(item.type)){
return;
}
var opt={icon:item.iconBase64||this._getIconUri(item.icon,"ve/resources/images/file_obj.gif"),displayName:item.$library._maqGetString(item.type)||item.$library._maqGetString(item.name)||item.name,description:item.$library._maqGetString(item.type+"_description")||item.$library._maqGetString(item.name+"_description")||item.description||item.type,name:item.name,paletteId:this.id,type:item.type,data:item.data||{name:item.name,type:item.type,properties:item.properties,children:item.children},tool:item.tool,category:name};
this._createItem(opt,_f06);
},this);
}
},setContext:function(_f07){
this._context=_f07;
this._loadPalette();
this.startupKeyNavChildren();
this.filterField.set("value","");
this._filter();
},refresh:function(){
delete this._loaded;
this._createFolderTemplate();
this._createItemTemplate();
this._createHeader();
if(this._context){
this._loadPalette();
this.startupKeyNavChildren();
}
},_loadPalette:function(){
if(this._loaded){
return;
}
var _f08=_ef5.getLibrary();
var _f09=_ef6.getUserLibs(_ef0.getProject());
var _f0a={};
function _f0b(name,_f0c){
for(var n in _f08){
if(_f08.hasOwnProperty(n)){
var lib=_f08[n];
if(lib.name===name&&lib.version===_f0c){
var ro={};
ro[name]=_f08[n];
return ro;
}
}
}
return null;
};
_f09.forEach(function(ulib){
var _f0d=_f0b(ulib.id,ulib.version);
if(_f0d){
dojo.mixin(_f0a,_f0d);
}
});
var _f0e=_ef6.getCustomWidgets(_ef0.getProject());
if(_f0e){
dojo.mixin(_f0a,_f0e);
}
var _f0f={};
for(var name in _f0a){
if(_f0a.hasOwnProperty(name)){
var lib=_f0a[name].$wm;
if(!lib){
continue;
}
dojo.forEach(lib.widgets,function(item){
if(item.category=="untested"){
return;
}
var _f10=lib.categories[item.category];
if(!_f0f[_f10.name]){
_f0f[_f10.name]=dojo.clone(_f10);
_f0f[_f10.name].items=[];
}
var _f11=dojo.clone(item);
_f11.$library=lib;
_f0f[_f10.name].items.push(_f11);
});
}
}
var _f12=[];
var _f13=["Dojo Containers","Dojo Controls","HTML","Dojox Mobile","Clip Art","Drawing Tools","Untested Dojo & HTML"];
dojo.forEach(_f13,function(name){
if(_f0f[name]){
_f12.push(_f0f[name]);
delete _f0f[name];
}
});
for(var _f14 in _f0f){
_f12.push(_f0f[_f14]);
delete _f0f[_f14];
}
this._generateCssRules(_f12);
dojo.forEach(_f12,function(_f15){
if(_f15.name&&!this._folders[_f15.name]){
this._createPalette(_f15);
this._folders[_f15.name]=true;
}
},this);
this._loaded=true;
},_generateCssRules:function(_f16){
var _f17=dojo.doc.styleSheets[0];
if(!_f17){
return;
}
dojo.forEach(_f16,function(_f18){
dojo.forEach(_f18.items,function(item){
var _f19=item.iconBase64||this._getIconUri(item.icon,"ve/resources/images/file_obj.gif");
var _f1a="img.davinci_"+item.type.replace(/\./g,"_");
var rule="{background-image: url("+_f19+")}";
if(dojo.isIE){
_f17.addRule(_f1a,rule);
}else{
_f17.insertRule(_f1a+rule,_f17.cssRules.length);
}
},this);
},this);
},_createPalette:function(_f1b){
var _f1c="ve/resources/images/";
var _f1d={"Dojo Containers":"dojo-objects.png","Dojo Controls":"dojo-objects.png","HTML":"html-widgets.png","Drawing Tools":"drawing-tools-widgets.png","Clip Art":"clipart-widgets.png","Untested Dojo & HTML":"untested.gif","Lotus One UI":"lts-widgets.gif","Dojox Mobile":"dojox.mobile.cat.gif"};
var _f1e="fldr_obj.gif";
var _f1f=_f1d[_f1b.name];
if(!_f1f){
_f1f=_f1e;
}
var _f20=_f1c+_f1f;
var _f21=this._getIconUri(_f1b.icon,_f20);
var opt={paletteId:this.id,icon:_f21,displayName:_f1b.name};
this._createFolder(opt);
dojo.forEach(_f1b.items,function(item){
if(item.hidden){
return;
}
var opt={icon:item.iconBase64||this._getIconUri(item.icon,"ve/resources/images/file_obj.gif"),displayName:item.$library._maqGetString(item.type)||item.$library._maqGetString(item.name)||item.name,description:item.$library._maqGetString(item.type+"_description")||item.$library._maqGetString(item.name+"_description")||item.description||item.type,name:item.name,paletteId:this.id,type:item.type,data:item.data||{name:item.name,type:item.type,properties:item.properties,children:item.children},category:_f1b.name};
this._createItem(opt);
},this);
},_getIconUri:function(uri,_f22){
if(uri){
if(uri.indexOf("http")==0){
return uri;
}
return _ef0.location()+uri;
}
return require.toUrl("davinci/"+_f22);
},_createFolder:function(opt){
if(this._folderNodes[opt.displayName]!=null){
return this._folderNodes[opt.displayName];
}
this._folderNodes[opt.displayName]=new _ef7(opt);
this.addChild(this._folderNodes[opt.displayName]);
return this._folderNodes[opt.displayName];
},_createFolderTemplate:function(){
this.folderTemplate=dojo.create("div",{className:"dojoyPaletteCommon dojoyPaletteFolder dojoyPaletteFolderLow",innerHTML:"<a href=\"javascript:void(0)\"><img border=\"0\"/></a>"});
},_createItemTemplate:function(){
this.itemTemplate=dojo.create("div",{className:"dojoyPaletteCommon dojoyPaletteItem",innerHTML:"<a href=\"javascript:void(0)\"><img border=\"0\"/></a>"});
},_createHeader:function(){
var div=dojo.doc.createElement("div");
div.className="dojoyPaletteCommon";
var _f23=dojo.doc.createElement("input");
div.appendChild(_f23);
this.domNode.appendChild(div);
var _f24=this._resource["filter"]+"...";
this.filterField=new _ef3({style:"width: 99%",placeHolder:_f24},_f23);
dojo.connect(this.filterField,"onKeyUp",this,"_filter");
},_filter:function(e){
var _f25=this.filterField.get("value"),re=new RegExp(_f25,"i"),_f26;
function _f27(_f28){
if(_f28.declaredClass!="dijit.form.TextBox"){
var _f29=_f28.declaredClass==="davinci.ve.palette.PaletteFolder"?"block":"none";
dojo.style(_f28.domNode,"display",_f29);
}
};
function _f2a(_f2b){
if(_f2b.declaredClass=="dijit.form.TextBox"){
}else{
if(_f2b.declaredClass==="davinci.ve.palette.PaletteFolder"){
dojo.style(_f2b.domNode,"display","none");
}else{
if(_f2b.name&&re.test(_f2b.name)){
dojo.style(_f2b.domNode,"display","block");
}else{
dojo.style(_f2b.domNode,"display","none");
}
}
}
};
if(_f25===""){
_f26=_f27;
dojo.removeClass(this.domNode,"maqWidgetsFiltered");
}else{
_f26=_f2a;
dojo.addClass(this.domNode,"maqWidgetsFiltered");
}
this.getChildren().forEach(_f26);
},_hasItem:function(type){
var _f2c=this.getChildren();
for(var i=0;i<_f2c.length;i++){
if(_f2c[i].type==type){
return true;
}
}
return false;
},_createItem:function(opt,_f2d){
var node=new _ef8(opt);
if(!_f2d){
this.addChild(node);
}else{
_f2d.addChild(node);
}
var ds=new _ef4(node.domNode,"component",node);
ds.targetShouldShowCaret=true;
ds.returnCloneOnFailure=false;
this.connect(ds,"onDragStart",dojo.hitch(this,function(e){
this.onDragStart(e);
}));
this.connect(ds,"onDragEnd",dojo.hitch(this,function(e){
this.onDragEnd(e);
}));
node.tooltip=new _ef2({label:opt.description,connectId:[node.id]});
return node;
},onDragStart:function(e){
var data=e.dragSource.data;
_ef5.getHelper(data.type,"tool").then(function(_f2e){
var tool=new (_f2e||_efa)(dojo.clone(data.data));
this._context.setActiveTool(tool);
}.bind(this));
this._context.blockChange(false);
if(e._dragClone){
dojo.create("div",{className:"maqCandidateParents"},e._dragClone);
}
this._context.setActiveDragDiv(e._dragClone);
this._dragKeyDownListener=dojo.connect(document,"onkeydown",dojo.hitch(this,function(_f2f){
var tool=this._context.getActiveTool();
if(tool&&tool.onKeyDown){
tool.onKeyDown(_f2f);
}
}));
this._dragKeyUpListener=dojo.connect(document,"onkeyup",dojo.hitch(this,function(_f30){
var tool=this._context.getActiveTool();
if(tool&&tool.onKeyUp){
tool.onKeyUp(_f30);
}
}));
},onDragEnd:function(e){
this.pushedItem=null;
this._context.setActiveTool(null);
this._context.setActiveDragDiv(null);
dojo.disconnect(this._dragKeyDownListener);
dojo.disconnect(this._dragKeyUpListener);
},onDragMove:function(e){
},nop:function(){
return false;
},__dummy__:null});
});
},"orion/editor/editorFeatures":function(){
define("orion/editor/editorFeatures",["i18n!orion/editor/nls/messages","orion/textview/undoStack","orion/textview/keyBinding","orion/textview/rulers","orion/textview/annotations","orion/textview/tooltip","orion/textview/textDND","orion/editor/regex","orion/textview/i18nUtil"],function(_f31,_f32,_f33,_f34,_f35,_f36,_f37,_f38,_f39){
function _f3a(){
};
_f3a.prototype={createUndoStack:function(_f3b){
var _f3c=_f3b.getTextView();
var _f3d=new _f32.UndoStack(_f3c,200);
_f3c.setKeyBinding(new _f33.KeyBinding("z",true),"undo");
_f3c.setAction("undo",function(){
_f3d.undo();
return true;
},{name:_f31.undo});
var _f3e=navigator.platform.indexOf("Mac")!==-1;
_f3c.setKeyBinding(_f3e?new _f33.KeyBinding("z",true,true):new _f33.KeyBinding("y",true),"redo");
_f3c.setAction("redo",function(){
_f3d.redo();
return true;
},{name:_f31.redo});
return _f3d;
}};
function _f3f(){
};
_f3f.prototype={createLineNumberRuler:function(_f40){
return new _f34.LineNumberRuler(_f40,"left",{styleClass:"ruler lines"},{styleClass:"rulerLines odd"},{styleClass:"rulerLines even"});
}};
function _f41(){
};
_f41.prototype={createFoldingRuler:function(_f42){
return new _f34.FoldingRuler(_f42,"left",{styleClass:"ruler folding"});
}};
function _f43(){
};
_f43.prototype={createAnnotationModel:function(_f44){
return new _f35.AnnotationModel(_f44);
},createAnnotationStyler:function(_f45,view){
return new _f35.AnnotationStyler(_f45,view);
},createAnnotationRulers:function(_f46){
var _f47=new _f34.AnnotationRuler(_f46,"left",{styleClass:"ruler annotations"});
var _f48=new _f34.OverviewRuler(_f46,"right",{styleClass:"ruler overview"});
return {annotationRuler:_f47,overviewRuler:_f48};
}};
function _f49(){
};
_f49.prototype={createTextDND:function(_f4a,_f4b){
return new _f37.TextDND(_f4a.getTextView(),_f4b);
}};
function _f4c(_f4d,_f4e,_f4f){
this.editor=_f4d;
this.textView=_f4d.getTextView();
this.undoStack=_f4e;
this._incrementalFindActive=false;
this._incrementalFindSuccess=true;
this._incrementalFindIgnoreSelection=false;
this._incrementalFindPrefix="";
this._searcher=_f4f;
this._lastEditLocation=null;
this.init();
};
_f4c.prototype={init:function(){
var self=this;
this._incrementalFindListener={onVerify:function(e){
var _f50=self.editor;
var _f51=_f50.getModel();
var _f52=_f50.mapOffset(e.start),end=_f50.mapOffset(e.end);
var txt=_f51.getText(_f52,end);
var _f53=self._incrementalFindPrefix;
var _f54=_f53.match(new RegExp("^"+_f38.escape(txt),"i"));
if(_f54&&_f54.length>0){
_f53=self._incrementalFindPrefix+=e.text;
self.editor.reportStatus(_f39.formatMessage(_f31.incrementalFind,_f53));
var _f55=_f50.getSelection().start;
var _f56=_f50.getModel().find({string:_f53,start:_f55,caseInsensitive:_f53.toLowerCase()===_f53}).next();
if(_f56){
self._incrementalFindSuccess=true;
self._incrementalFindIgnoreSelection=true;
_f50.moveSelection(_f56.start,_f56.end);
self._incrementalFindIgnoreSelection=false;
}else{
_f50.reportStatus(_f39.formatMessage(_f31.incrementalFindNotFound,_f53),"error");
self._incrementalFindSuccess=false;
}
e.text=null;
}else{
}
},onSelection:function(){
if(!self._incrementalFindIgnoreSelection){
self.toggleIncrementalFind();
}
}};
this._lastEditListener={onModelChanged:function(e){
if(self.editor.isDirty()){
self._lastEditLocation=e.start+e.addedCharCount;
}
}};
this.textView.addEventListener("ModelChanged",this._lastEditListener.onModelChanged);
this.textView.setKeyBinding(new _f33.KeyBinding("k",true),"findNext");
this.textView.setAction("findNext",function(){
if(this._searcher){
var _f57=this.textView.getSelection();
if(_f57.start<_f57.end){
this._searcher.findNext(true,this.textView.getText(_f57.start,_f57.end));
}else{
this._searcher.findNext(true);
}
return true;
}
return false;
}.bind(this),{name:_f31.findNext});
this.textView.setKeyBinding(new _f33.KeyBinding("k",true,true),"findPrevious");
this.textView.setAction("findPrevious",function(){
if(this._searcher){
var _f58=this.textView.getSelection();
if(_f58.start<_f58.end){
this._searcher.findNext(false,this.textView.getText(_f58.start,_f58.end));
}else{
this._searcher.findNext(false);
}
return true;
}
return false;
}.bind(this),{name:_f31.findPrevious});
this.textView.setKeyBinding(new _f33.KeyBinding("j",true),"incrementalFind");
this.textView.setAction("incrementalFind",function(){
if(this._searcher&&this._searcher.visible()){
return true;
}
var _f59=this.editor;
if(!this._incrementalFindActive){
_f59.setCaretOffset(_f59.getCaretOffset());
this.toggleIncrementalFind();
}else{
var _f5a=this._incrementalFindPrefix;
if(_f5a.length!==0){
var _f5b;
var _f5c=0;
if(this._incrementalFindSuccess){
_f5c=_f59.getSelection().start+1;
}
_f5b=_f59.getModel().find({string:_f5a,start:_f5c,caseInsensitive:_f5a.toLowerCase()===_f5a}).next();
if(_f5b){
this._incrementalFindSuccess=true;
this._incrementalFindIgnoreSelection=true;
_f59.moveSelection(_f5b.start,_f5b.end);
this._incrementalFindIgnoreSelection=false;
_f59.reportStatus(_f39.formatMessage(_f31.incrementalFind,_f5a));
}else{
_f59.reportStatus(_f39.formatMessage(_f31.incrementalFindNotFound,_f5a),"error");
this._incrementalFindSuccess=false;
}
}
}
return true;
}.bind(this),{name:_f31.incrementalFindKey});
this.textView.setAction("deletePrevious",function(){
if(this._incrementalFindActive){
var _f5d=this.editor;
var _f5e=this._incrementalFindPrefix;
_f5e=this._incrementalFindPrefix=_f5e.substring(0,_f5e.length-1);
if(_f5e.length===0){
this._incrementalFindSuccess=true;
this._incrementalFindIgnoreSelection=true;
_f5d.setCaretOffset(_f5d.getSelection().start);
this._incrementalFindIgnoreSelection=false;
this.toggleIncrementalFind();
return true;
}
_f5d.reportStatus(_f39.formatMessage(_f31.incrementalFind,_f5e));
var _f5f=_f5d.getModel().find({string:_f5e,start:_f5d.getCaretOffset()-_f5e.length-1,reverse:true,caseInsensitive:_f5e.toLowerCase()===_f5e}).next();
if(_f5f){
this._incrementalFindSuccess=true;
this._incrementalFindIgnoreSelection=true;
_f5d.moveSelection(_f5f.start,_f5f.end);
this._incrementalFindIgnoreSelection=false;
}else{
_f5d.reportStatus(_f39.formatMessage(_f31.incrementalFindNotFound,_f5e),"error");
}
return true;
}
return false;
}.bind(this));
this.textView.setAction("tab",function(){
if(!this.textView.getOptions("tabMode")){
return;
}
var _f60=this.editor;
var _f61=_f60.getModel();
var _f62=_f60.getSelection();
var _f63=_f61.getLineAtOffset(_f62.start);
var _f64=_f61.getLineAtOffset(_f62.end>_f62.start?_f62.end-1:_f62.end);
if(_f63!==_f64){
var _f65=[];
_f65.push("");
for(var i=_f63;i<=_f64;i++){
_f65.push(_f61.getLine(i,true));
}
var _f66=_f61.getLineStart(_f63);
var _f67=_f61.getLineEnd(_f64,true);
var _f68=this.textView.getOptions("tabSize","expandTab");
var text=_f68.expandTab?new Array(_f68.tabSize+1).join(" "):"\t";
_f60.setText(_f65.join(text),_f66,_f67);
_f60.setSelection(_f66===_f62.start?_f62.start:_f62.start+text.length,_f62.end+((_f64-_f63+1)*text.length));
return true;
}
var _f69=_f60.getKeyModes();
for(var j=0;j<_f69.length;j++){
if(_f69[j].isActive()){
return _f69[j].tab();
}
}
return false;
}.bind(this));
this.textView.setAction("shiftTab",function(){
if(!this.textView.getOptions("tabMode")){
return;
}
var _f6a=this.editor;
var _f6b=_f6a.getModel();
var _f6c=_f6a.getSelection();
var _f6d=_f6b.getLineAtOffset(_f6c.start);
var _f6e=_f6b.getLineAtOffset(_f6c.end>_f6c.start?_f6c.end-1:_f6c.end);
var _f6f=this.textView.getOptions("tabSize");
var _f70=new Array(_f6f+1).join(" ");
var _f71=[],_f72=0,_f73=0;
for(var i=_f6d;i<=_f6e;i++){
var line=_f6b.getLine(i,true);
if(_f6b.getLineStart(i)!==_f6b.getLineEnd(i)){
if(line.indexOf("\t")===0){
line=line.substring(1);
_f72++;
}else{
if(line.indexOf(_f70)===0){
line=line.substring(_f6f);
_f72+=_f6f;
}else{
return true;
}
}
}
if(i===_f6d){
_f73=_f72;
}
_f71.push(line);
}
var _f74=_f6b.getLineStart(_f6d);
var _f75=_f6b.getLineEnd(_f6e,true);
var _f76=_f6b.getLineStart(_f6e);
_f6a.setText(_f71.join(""),_f74,_f75);
_f6a.setSelection(_f74===_f6c.start?_f6c.start:_f6c.start-_f73,_f6c.end-_f72+(_f6c.end===_f76+1?1:0));
return true;
}.bind(this),{name:_f31.unindentLines});
this.textView.setKeyBinding(new _f33.KeyBinding(38,false,false,true),"moveLinesUp");
this.textView.setAction("moveLinesUp",function(){
var _f77=this.editor;
var _f78=_f77.getModel();
var _f79=_f77.getSelection();
var _f7a=_f78.getLineAtOffset(_f79.start);
if(_f7a===0){
return true;
}
var _f7b=_f78.getLineAtOffset(_f79.end>_f79.start?_f79.end-1:_f79.end);
var _f7c=_f78.getLineCount();
var _f7d=_f78.getLineStart(_f7a-1);
var _f7e=_f78.getLineStart(_f7a);
var _f7f=_f78.getLineEnd(_f7b,true);
var text=_f78.getText(_f7e,_f7f);
var _f80=0;
if(_f7b===_f7c-1){
var _f81=_f78.getLineEnd(_f7a-1);
var _f82=_f78.getLineEnd(_f7a-1,true);
text+=_f78.getText(_f81,_f82);
_f7e=_f81;
_f80=_f82-_f81;
}
this.startUndo();
_f77.setText("",_f7e,_f7f);
_f77.setText(text,_f7d,_f7d);
_f77.setSelection(_f7d,_f7d+text.length-_f80);
this.endUndo();
return true;
}.bind(this),{name:_f31.moveLinesUp});
this.textView.setKeyBinding(new _f33.KeyBinding(40,false,false,true),"moveLinesDown");
this.textView.setAction("moveLinesDown",function(){
var _f83=this.editor;
var _f84=_f83.getModel();
var _f85=_f83.getSelection();
var _f86=_f84.getLineAtOffset(_f85.start);
var _f87=_f84.getLineAtOffset(_f85.end>_f85.start?_f85.end-1:_f85.end);
var _f88=_f84.getLineCount();
if(_f87===_f88-1){
return true;
}
var _f89=_f84.getLineStart(_f86);
var _f8a=_f84.getLineEnd(_f87,true);
var _f8b=_f84.getLineEnd(_f87+1,true)-(_f8a-_f89);
var text,_f8c=0;
if(_f87!==_f88-2){
text=_f84.getText(_f89,_f8a);
}else{
var _f8d=_f84.getLineEnd(_f87);
text=_f84.getText(_f8d,_f8a)+_f84.getText(_f89,_f8d);
_f8c+=_f8a-_f8d;
}
this.startUndo();
_f83.setText("",_f89,_f8a);
_f83.setText(text,_f8b,_f8b);
_f83.setSelection(_f8b+_f8c,_f8b+_f8c+text.length);
this.endUndo();
return true;
}.bind(this),{name:_f31.moveLinesDown});
this.textView.setKeyBinding(new _f33.KeyBinding(38,true,false,true),"copyLinesUp");
this.textView.setAction("copyLinesUp",function(){
var _f8e=this.editor;
var _f8f=_f8e.getModel();
var _f90=_f8e.getSelection();
var _f91=_f8f.getLineAtOffset(_f90.start);
var _f92=_f8f.getLineAtOffset(_f90.end>_f90.start?_f90.end-1:_f90.end);
var _f93=_f8f.getLineStart(_f91);
var _f94=_f8f.getLineEnd(_f92,true);
var _f95=_f8f.getLineCount();
var _f96="";
var text=_f8f.getText(_f93,_f94);
if(_f92===_f95-1){
text+=(_f96=_f8f.getLineDelimiter());
}
var _f97=_f93;
_f8e.setText(text,_f97,_f97);
_f8e.setSelection(_f97,_f97+text.length-_f96.length);
return true;
}.bind(this),{name:_f31.copyLinesUp});
this.textView.setKeyBinding(new _f33.KeyBinding(40,true,false,true),"copyLinesDown");
this.textView.setAction("copyLinesDown",function(){
var _f98=this.editor;
var _f99=_f98.getModel();
var _f9a=_f98.getSelection();
var _f9b=_f99.getLineAtOffset(_f9a.start);
var _f9c=_f99.getLineAtOffset(_f9a.end>_f9a.start?_f9a.end-1:_f9a.end);
var _f9d=_f99.getLineStart(_f9b);
var _f9e=_f99.getLineEnd(_f9c,true);
var _f9f=_f99.getLineCount();
var _fa0="";
var text=_f99.getText(_f9d,_f9e);
if(_f9c===_f9f-1){
text=(_fa0=_f99.getLineDelimiter())+text;
}
var _fa1=_f9e;
_f98.setText(text,_fa1,_fa1);
_f98.setSelection(_fa1+_fa0.length,_fa1+text.length);
return true;
}.bind(this),{name:_f31.copyLinesDown});
this.textView.setKeyBinding(new _f33.KeyBinding("d",true,false,false),"deleteLines");
this.textView.setAction("deleteLines",function(){
var _fa2=this.editor;
var _fa3=_fa2.getSelection();
var _fa4=_fa2.getModel();
var _fa5=_fa4.getLineAtOffset(_fa3.start);
var _fa6=_fa4.getLineAtOffset(_fa3.end>_fa3.start?_fa3.end-1:_fa3.end);
var _fa7=_fa4.getLineStart(_fa5);
var _fa8=_fa4.getLineEnd(_fa6,true);
_fa2.setText("",_fa7,_fa8);
return true;
}.bind(this),{name:_f31.deleteLines});
this.textView.setKeyBinding(new _f33.KeyBinding("l",true),"gotoLine");
this.textView.setAction("gotoLine",function(){
var _fa9=this.editor;
var _faa=_fa9.getModel();
var line=_faa.getLineAtOffset(_fa9.getCaretOffset());
line=prompt(_f31.gotoLinePrompty,line+1);
if(line){
line=parseInt(line,10);
_fa9.onGotoLine(line-1,0);
}
return true;
}.bind(this),{name:_f31.gotoLine});
this.textView.setKeyBinding(new _f33.KeyBinding(190,true),"nextAnnotation");
this.textView.setAction("nextAnnotation",function(){
var _fab=this.editor;
var _fac=_fab.getAnnotationModel();
if(!_fac){
return true;
}
var _fad=_fab.getModel();
var _fae=_fab.getCaretOffset();
var _faf=_fac.getAnnotations(_fae,_fad.getCharCount());
while(_faf.hasNext()){
var _fb0=_faf.next();
if(_fb0.start<=_fae){
continue;
}
if(_fb0.type!==_f35.AnnotationType.ANNOTATION_ERROR&&_fb0.type!==_f35.AnnotationType.ANNOTATION_WARNING&&_fb0.type!==_f35.AnnotationType.ANNOTATION_TASK){
continue;
}
var _fb1=_f36.Tooltip.getTooltip(this.textView);
if(!_fb1){
_fab.moveSelection(_fb0.start);
return true;
}
var _fb2=_fad.getLineAtOffset(_fb0.start);
var view=this.textView;
var _fb3=function(){
setTimeout(function(){
_fb1.setTarget({getTooltipInfo:function(){
var _fb4=view.convert({x:view.getLocationAtOffset(_fb0.start).x,y:view.getLocationAtOffset(_fad.getLineStart(_fb2)).y},"document","page");
return {contents:[_fb0],x:_fb4.x,y:_fb4.y+Math.floor(view.getLineHeight(_fb2)*1.33)};
}},0);
},0);
};
_fab.moveSelection(_fb0.start,_fb0.start,_fb3);
break;
}
return true;
}.bind(this),{name:_f31.nextAnnotation});
this.textView.setKeyBinding(new _f33.KeyBinding(188,true),"previousAnnotation");
this.textView.setAction("previousAnnotation",function(){
var _fb5=this.editor;
var _fb6=_fb5.getAnnotationModel();
if(!_fb6){
return true;
}
var _fb7=_fb5.getModel();
var _fb8=_fb5.getCaretOffset();
var _fb9=_fb6.getAnnotations(0,_fb8);
var _fba=null;
while(_fb9.hasNext()){
var _fbb=_fb9.next();
if(_fbb.start>=_fb8){
continue;
}
if(_fbb.type!==_f35.AnnotationType.ANNOTATION_ERROR&&_fbb.type!==_f35.AnnotationType.ANNOTATION_WARNING&&_fbb.type!==_f35.AnnotationType.ANNOTATION_TASK){
continue;
}
_fba=_fbb;
}
if(_fba){
var _fbc=_fb7.getLineAtOffset(_fba.start);
var _fbd=_f36.Tooltip.getTooltip(this.textView);
if(!_fbd){
_fb5.moveSelection(_fba.start);
return true;
}
var view=this.textView;
var _fbe=function(){
setTimeout(function(){
_fbd.setTarget({getTooltipInfo:function(){
var _fbf=view.convert({x:view.getLocationAtOffset(_fba.start).x,y:view.getLocationAtOffset(_fb7.getLineStart(_fbc)).y},"document","page");
return {contents:[_fba],x:_fbf.x,y:_fbf.y+Math.floor(view.getLineHeight(_fbc)*1.33)};
}},0);
},0);
};
_fb5.moveSelection(_fba.start,_fba.start,_fbe);
}
return true;
}.bind(this),{name:_f31.prevAnnotation});
var _fc0=navigator.platform.indexOf("Mac")!==-1;
this.textView.setKeyBinding(new _f33.KeyBinding("q",!_fc0,false,false,_fc0),"lastEdit");
this.textView.setAction("lastEdit",function(){
if(typeof this._lastEditLocation==="number"){
this.editor.showSelection(this._lastEditLocation);
}
return true;
}.bind(this),{name:_f31.lastEdit});
},toggleIncrementalFind:function(){
this._incrementalFindActive=!this._incrementalFindActive;
if(this._incrementalFindActive){
this.editor.reportStatus(_f39.formatMessage(_f31.incrementalFind,this._incrementalFindPrefix));
this.textView.addEventListener("Verify",this._incrementalFindListener.onVerify);
this.textView.addEventListener("Selection",this._incrementalFindListener.onSelection);
}else{
this._incrementalFindPrefix="";
this.editor.reportStatus("");
this.textView.removeEventListener("Verify",this._incrementalFindListener.onVerify);
this.textView.removeEventListener("Selection",this._incrementalFindListener.onSelection);
this.textView.setCaretOffset(this.textView.getCaretOffset());
}
},startUndo:function(){
if(this.undoStack){
this.undoStack.startCompoundChange();
}
},endUndo:function(){
if(this.undoStack){
this.undoStack.endCompoundChange();
}
},cancel:function(){
this.toggleIncrementalFind();
},isActive:function(){
return this._incrementalFindActive;
},isStatusActive:function(){
return this._incrementalFindActive;
},lineUp:function(){
if(this._incrementalFindActive){
var _fc1=this._incrementalFindPrefix;
if(_fc1.length===0){
return false;
}
var _fc2=this.editor;
var _fc3=_fc2.getModel();
var _fc4;
if(this._incrementalFindSuccess){
_fc4=_fc2.getCaretOffset()-_fc1.length-1;
}else{
_fc4=_fc3.getCharCount()-1;
}
var _fc5=_fc2.getModel().find({string:_fc1,start:_fc4,reverse:true,caseInsensitive:_fc1.toLowerCase()===_fc1}).next();
if(_fc5){
this._incrementalFindSuccess=true;
this._incrementalFindIgnoreSelection=true;
_fc2.moveSelection(_fc5.start,_fc5.end);
this._incrementalFindIgnoreSelection=false;
_fc2.reportStatus(_f39.formatMessage(_f31.incrementalFind,_fc1));
}else{
_fc2.reportStatus(_f39.formatMessage(_f31.incrementalFindNotFound,_fc1),"error");
this._incrementalFindSuccess=false;
}
return true;
}
return false;
},lineDown:function(){
if(this._incrementalFindActive){
var _fc6=this._incrementalFindPrefix;
if(_fc6.length===0){
return false;
}
var _fc7=this.editor;
var _fc8=0;
if(this._incrementalFindSuccess){
_fc8=_fc7.getSelection().start+1;
}
var _fc9=_fc7.getModel().find({string:_fc6,start:_fc8,caseInsensitive:_fc6.toLowerCase()===_fc6}).next();
if(_fc9){
this._incrementalFindSuccess=true;
this._incrementalFindIgnoreSelection=true;
_fc7.moveSelection(_fc9.start,_fc9.end);
this._incrementalFindIgnoreSelection=false;
_fc7.reportStatus(_f39.formatMessage(_f31.incrementalFind,_fc6));
}else{
_fc7.reportStatus(_f39.formatMessage(_f31.incrementalFindNotFound,_fc6),"error");
this._incrementalFindSuccess=false;
}
return true;
}
return false;
},enter:function(){
return false;
}};
function _fca(_fcb,_fcc,_fcd,_fce){
this.editor=_fcb;
this.textView=_fcb.getTextView();
this.undoStack=_fcc;
this.contentAssist=_fcd;
this.linkedMode=_fce;
if(this.contentAssist){
this.contentAssist.addEventListener("ProposalApplied",this.contentAssistProposalApplied.bind(this));
}
this.init();
};
_fca.prototype={startUndo:function(){
if(this.undoStack){
this.undoStack.startCompoundChange();
}
},endUndo:function(){
if(this.undoStack){
this.undoStack.endCompoundChange();
}
},init:function(){
this.textView.setAction("lineStart",function(){
var _fcf=this.editor;
var _fd0=_fcf.getModel();
var _fd1=_fcf.getCaretOffset();
var _fd2=_fd0.getLineAtOffset(_fd1);
var _fd3=_fd0.getLineStart(_fd2);
var _fd4=_fd0.getLine(_fd2);
var _fd5;
for(_fd5=0;_fd5<_fd4.length;_fd5++){
var c=_fd4.charCodeAt(_fd5);
if(!(c===32||c===9)){
break;
}
}
_fd5+=_fd3;
if(_fd1!==_fd5){
_fcf.setSelection(_fd5,_fd5);
return true;
}
return false;
}.bind(this));
this.textView.setKeyBinding(new _f33.KeyBinding(191,true),"toggleLineComment");
this.textView.setAction("toggleLineComment",function(){
var _fd6=this.editor;
var _fd7=_fd6.getModel();
var _fd8=_fd6.getSelection();
var _fd9=_fd7.getLineAtOffset(_fd8.start);
var _fda=_fd7.getLineAtOffset(_fd8.end>_fd8.start?_fd8.end-1:_fd8.end);
var _fdb=true,_fdc=[],_fdd,_fde;
for(var i=_fd9;i<=_fda;i++){
_fdd=_fd7.getLine(i,true);
_fdc.push(_fdd);
if(!_fdb||(_fde=_fdd.indexOf("//"))===-1){
_fdb=false;
}else{
if(_fde!==0){
var j;
for(j=0;j<_fde;j++){
var c=_fdd.charCodeAt(j);
if(!(c===32||c===9)){
break;
}
}
_fdb=j===_fde;
}
}
}
var text,_fdf,_fe0;
var _fe1=_fd7.getLineStart(_fd9);
var _fe2=_fd7.getLineEnd(_fda,true);
if(_fdb){
for(var k=0;k<_fdc.length;k++){
_fdd=_fdc[k];
_fde=_fdd.indexOf("//");
_fdc[k]=_fdd.substring(0,_fde)+_fdd.substring(_fde+2);
}
text=_fdc.join("");
var _fe3=_fd7.getLineStart(_fda);
_fdf=_fe1===_fd8.start?_fd8.start:_fd8.start-2;
_fe0=_fd8.end-(2*(_fda-_fd9+1))+(_fd8.end===_fe3+1?2:0);
}else{
_fdc.splice(0,0,"");
text=_fdc.join("//");
_fdf=_fe1===_fd8.start?_fd8.start:_fd8.start+2;
_fe0=_fd8.end+(2*(_fda-_fd9+1));
}
_fd6.setText(text,_fe1,_fe2);
_fd6.setSelection(_fdf,_fe0);
return true;
}.bind(this),{name:_f31.toggleLineComment});
function _fe4(_fe5,_fe6,end){
var open="/*",_fe7="*/";
var _fe8=_fe5.getLineAtOffset(_fe6);
var _fe9=_fe5.getLineAtOffset(end);
var i,line,_fea,_feb,_fec;
var _fed,_fee;
for(i=_fe8;i>=0;i--){
line=_fe5.getLine(i);
_fea=(i===_fe8)?_fe6-_fe5.getLineStart(_fe8):line.length;
_feb=line.lastIndexOf(open,_fea);
_fec=line.lastIndexOf(_fe7,_fea);
if(_fec>_feb){
break;
}else{
if(_feb!==-1){
_fed=_fe5.getLineStart(i)+_feb;
break;
}
}
}
for(i=_fe9;i<_fe5.getLineCount();i++){
line=_fe5.getLine(i);
_fea=(i===_fe9)?end-_fe5.getLineStart(_fe9):0;
_feb=line.indexOf(open,_fea);
_fec=line.indexOf(_fe7,_fea);
if(_feb!==-1&&_feb<_fec){
break;
}else{
if(_fec!==-1){
_fee=_fe5.getLineStart(i)+_fec;
break;
}
}
}
return {commentStart:_fed,commentEnd:_fee};
};
var _fef=navigator.platform.indexOf("Mac")!==-1;
this.textView.setKeyBinding(new _f33.KeyBinding(191,true,!_fef,false,_fef),"addBlockComment");
this.textView.setAction("addBlockComment",function(){
var _ff0=this.editor;
var _ff1=_ff0.getModel();
var _ff2=_ff0.getSelection();
var open="/*",_ff3="*/",_ff4=new RegExp("/\\*"+"|"+"\\*/","g");
var _ff5=_fe4(_ff1,_ff2.start,_ff2.end);
if(_ff5.commentStart!==undefined&&_ff5.commentEnd!==undefined){
return true;
}
var text=_ff1.getText(_ff2.start,_ff2.end);
if(text.length===0){
return true;
}
var _ff6=text.length;
text=text.replace(_ff4,"");
var _ff7=text.length;
_ff0.setText(open+text+_ff3,_ff2.start,_ff2.end);
_ff0.setSelection(_ff2.start+open.length,_ff2.end+open.length+(_ff7-_ff6));
return true;
}.bind(this),{name:_f31.addBlockComment});
this.textView.setKeyBinding(new _f33.KeyBinding(220,true,!_fef,false,_fef),"removeBlockComment");
this.textView.setAction("removeBlockComment",function(){
var _ff8=this.editor;
var _ff9=_ff8.getModel();
var _ffa=_ff8.getSelection();
var open="/*",_ffb="*/";
var _ffc=_ff9.getText(_ffa.start,_ffa.end);
var _ffd,_ffe;
var i;
for(i=0;i<_ffc.length;i++){
if(_ffc.substring(i,i+open.length)===open){
_ffd=_ffa.start+i;
break;
}
}
for(;i<_ffc.length;i++){
if(_ffc.substring(i,i+_ffb.length)===_ffb){
_ffe=_ffa.start+i;
break;
}
}
if(_ffd!==undefined&&_ffe!==undefined){
_ff8.setText(_ff9.getText(_ffd+open.length,_ffe),_ffd,_ffe+_ffb.length);
_ff8.setSelection(_ffd,_ffe);
}else{
var _fff=_fe4(_ff9,_ffa.start,_ffa.end);
if(_fff.commentStart===undefined||_fff.commentEnd===undefined){
return true;
}
var text=_ff9.getText(_fff.commentStart+open.length,_fff.commentEnd);
_ff8.setText(text,_fff.commentStart,_fff.commentEnd+_ffb.length);
_ff8.setSelection(_ffa.start-open.length,_ffa.end-_ffb.length);
}
return true;
}.bind(this),{name:_f31.removeBlockComment});
},contentAssistProposalApplied:function(event){
var _1000=event.data.proposal;
if(_1000.positions&&this.linkedMode){
var _1001=[];
for(var i=0;i<_1000.positions.length;++i){
_1001[i]={positions:[{offset:_1000.positions[i].offset,length:_1000.positions[i].length}]};
}
var _1002={groups:_1001,escapePosition:_1000.escapePosition};
this.linkedMode.enterLinkedMode(_1002);
}else{
if(_1000.escapePosition){
this.textView.setCaretOffset(_1000.escapePosition);
}
}
return true;
},cancel:function(){
return false;
},isActive:function(){
return true;
},isStatusActive:function(){
return false;
},lineUp:function(){
return false;
},lineDown:function(){
return false;
},enter:function(){
var _1003=this.editor;
var _1004=_1003.getSelection();
if(_1004.start===_1004.end){
var model=_1003.getModel();
var _1005=model.getLineAtOffset(_1004.start);
var _1006=model.getLine(_1005,true);
var _1007=model.getLineStart(_1005);
var index=0,end=_1004.start-_1007,c;
while(index<end&&((c=_1006.charCodeAt(index))===32||c===9)){
index++;
}
if(index>0){
var _1008=_1006.substring(0,index);
index=end;
while(index<_1006.length&&((c=_1006.charCodeAt(index++))===32||c===9)){
_1004.end++;
}
_1003.setText(model.getLineDelimiter()+_1008,_1004.start,_1004.end);
return true;
}
}
return false;
},tab:function(){
return false;
}};
function _1009(_100a){
this.editor=_100a;
this.textView=_100a.getTextView();
this.linkedModeActive=false;
this.linkedModePositions=[];
this.linkedModeCurrentPositionIndex=0;
this.linkedModeEscapePosition=0;
this.linkedModeListener={onVerify:function(event){
var _100b=false;
var _100c=0;
for(var i=0;i<this.linkedModePositions.length;++i){
var _100d=this.linkedModePositions[i];
if(_100b){
_100d.offset+=_100c;
}else{
if(event.start>=_100d.offset&&event.end<=_100d.offset+_100d.length){
var _100e=_100d.length;
_100d.length=(event.start-_100d.offset)+event.text.length+(_100d.offset+_100d.length-event.end);
_100c=_100d.length-_100e;
_100b=true;
}
}
}
if(_100b){
this.linkedModeEscapePosition+=_100c;
}else{
this.cancel();
}
}.bind(this)};
};
_1009.prototype={enterLinkedMode:function(_100f){
if(this.linkedModeActive){
return;
}
this.linkedModeActive=true;
this.linkedModePositions=[];
for(var i=0;i<_100f.groups.length;++i){
var group=_100f.groups[i];
this.linkedModePositions[i]={offset:group.positions[0].offset,length:group.positions[0].length};
}
this.linkedModeEscapePosition=_100f.escapePosition;
this.linkedModeCurrentPositionIndex=0;
this.selectTextForLinkedModePosition(this.linkedModePositions[this.linkedModeCurrentPositionIndex]);
this.textView.addEventListener("Verify",this.linkedModeListener.onVerify);
this.textView.setKeyBinding(new _f33.KeyBinding(9),"nextLinkedModePosition");
this.textView.setAction("nextLinkedModePosition",function(){
this.linkedModeCurrentPositionIndex=++this.linkedModeCurrentPositionIndex%this.linkedModePositions.length;
this.selectTextForLinkedModePosition(this.linkedModePositions[this.linkedModeCurrentPositionIndex]);
return true;
}.bind(this));
this.textView.setKeyBinding(new _f33.KeyBinding(9,false,true),"previousLinkedModePosition");
this.textView.setAction("previousLinkedModePosition",function(){
this.linkedModeCurrentPositionIndex=this.linkedModeCurrentPositionIndex>0?this.linkedModeCurrentPositionIndex-1:this.linkedModePositions.length-1;
this.selectTextForLinkedModePosition(this.linkedModePositions[this.linkedModeCurrentPositionIndex]);
return true;
}.bind(this));
this.editor.reportStatus(_f31.linkedModeEntered,null,true);
},isActive:function(){
return this.linkedModeActive;
},isStatusActive:function(){
return this.linkedModeActive;
},enter:function(){
this.cancel();
return true;
},cancel:function(){
if(!this.linkedModeActive){
return;
}
this.linkedModeActive=false;
this.textView.removeEventListener("Verify",this.linkedModeListener.onVerify);
this.textView.setKeyBinding(new _f33.KeyBinding(9),"tab");
this.textView.setKeyBinding(new _f33.KeyBinding(9,false,true),"shiftTab");
this.textView.setCaretOffset(this.linkedModeEscapePosition,false);
this.editor.reportStatus(_f31.linkedModeExited,null,true);
},selectTextForLinkedModePosition:function(_1010){
this.textView.setSelection(_1010.offset,_1010.offset+_1010.length);
}};
return {UndoFactory:_f3a,LineNumberRulerFactory:_f3f,FoldingRulerFactory:_f41,AnnotationFactory:_f43,TextDNDFactory:_f49,TextActions:_f4c,SourceCodeActions:_fca,LinkedMode:_1009};
});
},"davinci/ve/utils/CssUtils":function(){
define(["dojo/_base/Color","davinci/ve/utils/URLRewrite"],function(Color,_1011){
var names=[];
for(var name in Color.named){
if(name!="transparent"){
names.push(name);
}
}
names.sort(function(a,b){
if(b.indexOf(a)==0){
return 1;
}else{
if(a.indexOf(b)==0){
return -1;
}else{
return a<b?-1:1;
}
}
});
var _1012=[];
names.forEach(function(name){
_1012.push(name);
var val=Color.named[name];
var hex="#"+((1<<24)+(val[0]<<16)+(val[1]<<8)+val[2]).toString(16).slice(1);
_1012.push(hex);
});
var _1013="(?:\\d*\\.\\d+|\\d+)";
var num="\\-?"+_1013;
var hex="[0-9A-Fa-f]";
var _1014="\\#(?:"+hex+"{6}|"+hex+"{3})";
var _1015="(?:"+_1013+"%?)";
var _1016="(?:"+num+"%?)";
var angle="(?:"+num+"deg)";
var _1017="(?:"+num+"(?:in|cm|mm|pt|pc|px|%)|0)";
var _1018="(?:"+_1017+"|(?:left|center|right|top|bottom))";
var posn="\\s*"+_1018+"(?:\\s*"+_1018+")?";
var _1019="(?:closest-side|farthest-side|closest-corner|farthest-corner|contain|cover)";
var _101a="(?:"+_1019+"|(?:"+_1017+"(?:\\s+"+_1017+"\\s*)?))";
var _101b="(?:("+_1019+")|(?:("+_1017+")(?:\\s+("+_1017+")\\s*)?))";
var _101c=new RegExp(_101b);
var shape="circle|ellipse";
var side="(?:\\s*left\\s*|\\s*right\\s*|\\s*top\\s*|\\s*bottom\\s*){1,2}";
var _101d="to\\s+("+side+")";
var dir="(?:"+_101d+"|("+side+")|("+angle+"))";
var _101e="(?:"+_101d+"|("+angle+"))";
var _101f="(?:"+dir+"\\s*,\\s*)?";
var _1020="(?:rgb|hsl)\\s*\\(\\s*"+_1015+"\\s*,\\s*"+_1015+"\\s*,\\s*"+_1015+"\\s*\\)";
var _1021="(?:rgba|hsla)\\s*\\(\\s*"+_1015+"\\s*,\\s*"+_1015+"\\s*,\\s*"+_1015+"\\s*,\\s*"+_1013+"\\s*\\)";
var _1022="(?:\\s*("+shape+")\\s*("+_101a+")\\s*|\\s*("+_101a+")\\s*("+shape+")\\s*|\\s*("+shape+")\\s*|\\s*("+_101a+")\\s*)";
var _1023="(?:\\s*("+posn+")\\s*("+angle+")\\s*|\\s*("+posn+")\\s*|\\s*("+angle+")\\s*)";
var _1024="(?:\\s*"+_1023+"\\s*,\\s*)?";
var _1025="(?:\\s*"+_1022+"\\s*,\\s*)?";
var _1026=new RegExp("^"+num+"$");
var _1027="^\\s*"+_101e+"\\s*$";
var _1028="^\\s*"+_1017+"\\s*$";
var _1029="^\\s*"+posn+"\\s*$";
var _102a="^\\s*"+shape+"\\s*$";
var _102b="^\\s*"+_101a+"\\s*$";
var _102c="(?:";
for(var i=0;i<_1012.length;i+=2){
if(i!=0){
_102c+="|";
}
var _102d=_1012[i];
_102c+=_102d;
}
_102c+=")";
var color="(?:"+_102c+"|"+_1014+"|"+_1020+"|"+_1021+")";
var _102e="(?:"+color+"(?:\\s+"+_1017+")?)";
var _102f="(?:\\s*("+color+")\\s*("+_1017+")?\\s*,?(.*))";
var _1030=new RegExp(_102f);
var _1031="("+_102e+"(?:\\s*,\\s*"+_102e+")*"+")";
var _1032="(?:-moz-linear-gradient|-webkit-linear-gradient|-ms-linear-gradient|-o-linear-gradient|linear-gradient)";
var _1033="(?:-moz-radial-gradient|-webkit-radial-gradient|-ms-radial-gradient|-o-radial-gradient|radial-gradient)";
var _1034="\\'([^\\']*)\\'*";
var _1035="\\\"([^\\\"]*)\\\"";
var _1036="([^\\'\\\"]*)";
var _1037="(?:"+_1034+"|"+_1035+"|"+_1036+")";
var url="^\\s*"+"(url)"+"\\s*\\(\\s*"+_1037+"\\s*\\)\\s*$";
var _1038=new RegExp(url);
var _1039="\\s*"+color+"\\s*";
var _103a="\\s*"+_1017+"\\s*";
var _103b="^\\s*("+_1032+")\\s*\\(\\s*"+_101f+"\\s*"+_1031+"\\s*\\)\\s*$";
var _103c=new RegExp(_103b);
var _103d="^\\s*("+_1033+")\\s*\\(\\s*"+_1024+"\\s*"+_1025+"\\s*"+_1031+"\\s*\\)\\s*$";
var _103e=new RegExp(_103d);
var coord="(?:top|bottom|left|right|center|"+_1016+")";
var point="(?:\\s*"+coord+"\\s+"+coord+"\\s*)";
var _103f="(?:\\s*("+coord+")\\s+("+coord+")\\s*)";
var _1040=new RegExp(_103f);
var _1041="(?:\\s*,\\s*("+point+")\\s*)";
var _1042="(?:\\s*,\\s*("+_1013+")\\s*)";
var _1043="(?:color-stop\\s*\\(\\s*"+_1016+"\\s*,\\s*"+color+"\\s*\\)\\s*)";
var _1044="(?:(color-stop)\\s*\\(\\s*("+_1016+")\\s*,\\s*("+color+")\\s*\\)\\s*)";
var _1045="(?:from\\s*\\(\\s*"+color+"\\s*\\)\\s*)";
var _1046="(?:(from)\\s*\\(\\s*("+color+")\\s*\\)\\s*)";
var _1047="(?:to\\s*\\(\\s*"+color+"\\s*\\)\\s*)";
var _1048="(?:(to)\\s*\\(\\s*("+color+")\\s*\\)\\s*)";
var _1049="(?:"+_1043+"|"+_1045+"|"+_1047+")";
var _104a="(?:"+_1044+"|"+_1046+"|"+_1048+")";
var _104b="(?:\\s*,\\s*"+_1049+"\\s*)";
var _104c="(?:\\s*,\\s*"+_104a+"\\s*)";
var _104d="("+_104b+"+)";
var _104e=_104c+"(.*)";
var _104f=new RegExp(_104e);
var _1050="(?:\\s*(-webkit-gradient)\\s*\\(\\s*(linear)\\s*"+_1041+_1041+_104d+"\\s*\\)\\s*)";
var _1051=new RegExp(_1050);
var _1052="(?:\\s*(-webkit-gradient)\\s*\\(\\s*(radial)\\s*"+"(?:"+_1041+_1042+_1041+_1042+"?)"+_104d+"\\s*\\)\\s*)";
var _1053=new RegExp(_1052);
var _1054=function(_1055){
var stops=[];
do{
var _1056=_1055.match(_1030);
if(_1056){
stops.push({color:_1056[1],pos:_1056[2]});
_1055=_1056[3];
}
}while(_1056);
return stops;
};
var _1057=function(_1058){
var stops=[];
var _1059=[];
var from;
var to;
do{
var _105a=_1058.match(_104f);
if(_105a){
if(_105a[4]){
from={color:_105a[5]};
}else{
if(_105a[6]){
to={color:_105a[7]};
}else{
var pos=_105a[2].match(_1026)?(_105a[2]*100)+"%":_105a[2];
_1059.push({color:_105a[3],pos:pos});
}
}
_1058=_105a[8];
}
}while(_105a);
if(from){
stops.push(from);
}
for(var i=0;i<_1059.length;i++){
stops.push(_1059[i]);
}
if(to){
stops.push(to);
}
return stops;
};
var _105b=function(posn){
var _105c=posn.match(_1040);
var s;
if(_105c){
var _105d=_105c[1];
if(_105d.match(/^\d+$/)){
_105d+="px";
}
var _105e=_105c[2];
if(_105e.match(/^\d+$/)){
_105e+="px";
}
s=_105d+" "+_105e;
return s;
}else{
return posn;
}
};
return {regstr_posn:_1029,regstr_len_or_pct:_1028,regstr_angle:_1027,regstr_shape:_102a,regstr_extent:_102b,regstr_stop_color:_1039,regstr_stop_pos:_103a,parseBackgroundImage:function(_105f){
var o={};
var _1060=_105f.match(/^\s*$/);
if(_1060){
o.type="emptystring";
}else{
var _1060=_105f.match(/^\s*none\s*$/);
if(_1060){
o.type="none";
}else{
var _1060=_105f.match(_1038);
if(_1060){
o.type="url";
o.func=_1060[1];
o.url=_1060[2]?_1060[2]:(_1060[3]?_1060[3]:_1060[4]);
}else{
_1060=_105f.match(_1051);
if(_1060){
o.type="linear";
o.func=_1060[1];
o.webkitGradType=_1060[2];
o.webKitPosn1=_1060[3];
o.webKitPosn2=_1060[4];
var _1061=o.webKitPosn1;
var _1062=o.webKitPosn2;
var L1=(_1061.indexOf("left")>=0);
var T1=(_1061.indexOf("top")>=0);
var R1=(_1061.indexOf("right")>=0);
var B1=(_1061.indexOf("bottom")>=0);
var L2=(_1062.indexOf("left")>=0);
var T2=(_1062.indexOf("top")>=0);
var R2=(_1062.indexOf("right")>=0);
var B2=(_1062.indexOf("bottom")>=0);
if(T1&&B2&&((L1&&L2)||(R1&&R2))){
o.angle="to bottom";
}else{
if(B1&&T2&&((L1&&L2)||(R1&&R2))){
o.angle="to top";
}else{
if(L1&&R2&&((T1&&T2)||(B1&&B2))){
o.angle="to right";
}else{
if(L2&&R1&&((T1&&T2)||(B1&&B2))){
o.angle="to left";
}else{
if(L1&&T1&&R2&&B2){
o.angle="to bottom right";
}else{
if(L1&&B1&&R2&&T2){
o.angle="to top right";
}else{
if(R1&&T1&&L2&&B2){
o.angle="to bottom left";
}else{
if(R1&&B1&&L2&&T2){
o.angle="to top left";
}
}
}
}
}
}
}
}
o.stops=_1057(_1060[5]);
}else{
_1060=_105f.match(_1053);
if(_1060){
o.type="radial";
o.func=_1060[1];
o.webkitGradType=_1060[2];
o.webKitPosn1=_1060[3];
o.webKitRadius1=_1060[4];
o.webKitPosn2=_1060[5];
o.webKitRadius2=_1060[6];
o.shape=(o.webKitPosn1==o.webKitPosn2)?"circle":"ellipse";
o.posn=_105b(o.webKitPosn1);
o.extent=o.webKitRadius2?o.webKitRadius2+"px":(o.webKitRadius1?o.webKitRadius1+"px":"farthest-corner");
o.stops=_1057(_1060[7]);
}else{
_1060=_105f.match(_103c);
if(_1060){
o.type="linear";
o.func=_1060[1];
o.angle=_1060[2]?"to "+_1060[2]:(_1060[3]?"to "+_1060[3]:_1060[4]);
o.stops=_1054(_1060[5]);
}else{
_1060=_105f.match(_103e);
if(_1060){
o.type="radial";
o.func=_1060[1];
o.posn=_1060[2]?_1060[2]:_1060[4];
o.angle=_1060[3]?_1060[3]:_1060[5];
o.shape=_1060[6]?_1060[6]:(_1060[9]?_1060[9]:_1060[10]);
o.extent=_1060[7]?_1060[7]:(_1060[8]?_1060[8]:_1060[11]);
o.stops=_1054(_1060[12]);
}
}
}
}
}
}
}
if(!_1060){
o.type="unknown";
}
return o;
},buildBackgroundImage:function(o){
var a=[];
if(o.type=="emptystring"){
a.push("");
}else{
if(o.type=="none"){
a.push("none");
}else{
if(o.type=="url"){
if(typeof o.url=="string"&&o.url.length>0){
var _1063=_1011.getUrl(o.url);
if(!_1063){
_1063=_1011.stripQuotes(o.url);
}
a.push("url('"+_1063+"')");
}
}else{
if(o.type=="linear"||o.type=="radial"){
var _1064="";
var _1065,_1066;
var _1067=[];
for(var i=0;i<o.stops.length;i++){
var stop=o.stops[i];
var pos=(typeof stop.pos=="string"&&stop.pos.length>0)?stop.pos:"";
if(i>0){
_1064+=", ";
}
_1064+=stop.color;
if((i>0&&i<o.stops.length-1)||(i==0&&!(pos.length==0||pos=="0%"||(pos-0)==0))||(i==o.stops.length-1&&!(pos.length==0||pos=="100%"||(pos-0)==1))){
_1064+=" "+pos;
}
if(i==0&&(pos.length==0||pos=="0%"||(pos-0)==0)){
_1065="from("+stop.color+")";
}else{
if(i==o.stops.length-1&&(pos.length==0||pos=="100%"||(pos-0)==1)){
_1066="to("+stop.color+")";
}else{
_1067.push("color-stop("+pos+", "+stop.color+")");
}
}
}
var _1068="";
var _1069=false;
if(_1065){
_1068+=_1065;
_1069=true;
}
if(_1066){
if(_1069){
_1068+=", ";
}
_1068+=_1066;
_1069=true;
}
for(var i=0;i<_1067.length;i++){
if(_1069){
_1068+=", ";
}
_1068+=_1067[i];
_1069=true;
}
if(o.type=="linear"){
var w3c="(";
var angle=o.angle;
var _106a=(typeof angle=="string"&&angle.length>0)?angle.match(new RegExp(_1027)):null;
if(!_106a){
angle="to bottom";
}
if(angle!="to bottom"){
w3c+=angle+",";
}
var _106b="(linear,";
var L=(angle.indexOf("left")>=0);
var T=(angle.indexOf("top")>=0);
var R=(angle.indexOf("right")>=0);
var B=(angle.indexOf("bottom")>=0);
if(L&&T){
_106b+=" right bottom, left top, ";
}else{
if(L&&B){
_106b+=" right top, left bottom, ";
}else{
if(R&&T){
_106b+=" left bottom, right top, ";
}else{
if(R&&B){
_106b+=" left top, right bottom, ";
}else{
if(L){
_106b+=" right top, left top, ";
}else{
if(R){
_106b+=" left top, right top, ";
}else{
if(T){
_106b+=" left bottom, left top, ";
}else{
if(B){
_106b+=" left top, left bottom, ";
}else{
var _106c=parseFloat(_106a[4]);
var _106d=90-_106c;
var _106e=_106d*180/Math.PI;
var cos=Math.cos(_106e);
var sin=Math.sin(_106e);
if(cos>=0&&sin>=0){
_106b+="0% 100%,";
if(Math.abs(cos)>Math.abs(sin)){
_106b+="100% "+((1-(Math.abs(sin)/Math.abs(cos)))*100)+"%";
}else{
_106b+=((Math.abs(cos)/Math.abs(sin))*100)+"%"+" 100%";
}
}else{
if(cos>=0&&sin<0){
_106b+="0% 0%,";
if(Math.abs(cos)>Math.abs(sin)){
_106b+="100% "+((Math.abs(-sin)/Math.abs(cos))*100)+"%";
}else{
_106b+=((Math.abs(cos)/Math.abs(sin))*100)+"%"+" 100%";
}
}else{
if(cos<0&&sin>=0){
_106b+="100% 100%,";
if(Math.abs(cos)>Math.abs(sin)){
_106b+="0% "+((1-(Math.abs(sin)/Math.abs(cos)))*100)+"%";
}else{
_106b+=((Math.abs(cos)/Math.abs(sin))*100)+"%"+" 100%";
}
}else{
_106b+="100% 0%,";
if(Math.abs(cos)>Math.abs(sin)){
_106b+="0% "+((Math.abs(-sin)/Math.abs(cos))*100)+"%";
}else{
_106b+=((Math.abs(cos)/Math.abs(sin))*100)+"%"+" 100%";
}
}
}
}
_106b+=", ";
}
}
}
}
}
}
}
}
w3c+=_1064+")";
_106b+=_1068+")";
a.push("-webkit-gradient"+_106b);
a.push("-o-linear-gradient"+w3c);
a.push("-ms-linear-gradient"+w3c);
a.push("-moz-linear-gradient"+w3c);
a.push("-webkit-linear-gradient"+w3c);
a.push("linear-gradient"+w3c);
}else{
var w3c="(";
if(o.posn!="center"&&o.posn!="center center"){
w3c+=o.posn+", ";
}
if(o.shape!="circle"){
w3c+=o.shape+", ";
}
if(o.extent!="farthest-corner"){
w3c+=o.extent+", ";
}
var _106b="(radial, center center, 10, center center, ";
w3c+=_1064+")";
_106b+=_1068+")";
a.push("-webkit-gradient"+_106b);
a.push("-o-radial-gradient"+w3c);
a.push("-ms-radial-gradient"+w3c);
a.push("-moz-radial-gradient"+w3c);
a.push("-webkit-radial-gradient"+w3c);
a.push("radial-gradient"+w3c);
}
}
}
}
}
return a;
}};
});
},"davinci/Runtime":function(){
define(["dojo/i18n!./nls/webContent","dijit/Dialog","dijit/form/Button","dijit/form/TextBox","./commands/CommandStack","./ui.plugin","./html/html.plugin","./js/js.plugin","./ve/ve.plugin","./ve/themeEditor/themeEditor.plugin","./review/review.plugin","./UserActivityMonitor"],function(_106f,_1070,_1071,_1072,_1073,_1074,_1075,_1076,_1077,_1078,_1079,_107a){
var _107b=[_1074,_1075,_1076,_1077,_1078,_1079];
var _107c={plugins:[],extensionPoints:[],subscriptions:[],currentSelection:[],commandStack:new _1073(),addPlugin:function(_107d){
url=_107d+".plugin";
dojo.xhrGet({url:url,handleAs:"json",sync:true,load:function(_107e,_107f){
_107c._loadPlugin(_107e,url);
}});
},getUser:function(){
if(this._userInfo){
return this._userInfo;
}
this._userInfo=_107c.serverJSONRequest({url:"cmd/getUserInfo",handleAs:"json",content:{},sync:true});
return this._userInfo;
},getUserDisplayName:function(_1080){
if(!_1080){
_1080=this.getUser();
}
var _1081=_1080.userFirstName;
if(!_1080.userFirstName){
_1081=_1080.email;
}
return _1081;
},getUserDisplayNamePlusEmail:function(_1082){
if(!_1082){
_1082=this.getUser();
}
var _1083=this.getUserDisplayName(_1082);
if(_1083!=_1082.email){
_1083+=" &lt;"+_1082.email+"&gt;";
}
return _1083;
},loadPlugins:function(){
_107b.forEach(function(_1084){
var _1085=_1084.id;
_107c.plugins[_1085]=_1084;
for(var id in _1084){
var _1086=_1084[id];
if(typeof _1086!="string"){
if(_1086 instanceof Array){
_1086.forEach(function(ext){
_107c._addExtension(id,ext,_1085);
});
}else{
_107c._addExtension(id,_1086,_1085);
}
}
}
});
},singleUserMode:function(){
return _107c.isLocalInstall;
},location:function(){
return document.location.href.split("?")[0];
},getUserWorkspaceUrl:function(){
var loc=this.location();
if(loc.charAt(loc.length-1)=="/"){
loc=loc.substring(0,loc.length-1);
}
var _1087=loc+"/user/"+_107c.userName+"/ws/workspace/";
return _1087;
},run:function(){
if(dojo.isMac){
dojo.addClass(document.documentElement,"isMac");
}
var _1088=document.body.style;
_107c.supportsCSS3Transitions=_1088.WebkitTransition!==undefined||_1088.MozTransition!==undefined||_1088.OTransition!==undefined||_1088.transition!==undefined;
_107c.subscribe("/davinci/ui/selectionChanged",_107c._selectionChanged);
dojo.connect(dojo.doc.documentElement,"onkeypress",function(e){
if(e.charOrCode==8){
window.davinciBackspaceKeyTime=Date.now();
}
});
_107a.setUpInActivityMonitor(dojo.doc);
dojo.connect(dojo.doc.documentElement,"onkeydown",this,"_handleGlobalDocumentKeyEvent");
dojo.addOnUnload(function(e){
var _1089=null;
var _108a=davinci.Workbench.editorTabs.getChildren();
var _108b=0;
for(var i=0;i<_108a.length;i++){
var _108c=_108a[i];
if(_108c.editor){
var _108d=_108c.editor.getOnUnloadWarningMessage();
if(_108d){
if(!_1089){
_1089=_108d;
}
_108b++;
}
}
}
if(_108b>1){
_1089=dojo.string.substitute(_106f.multipleFilesUnsaved,[_1089,_108b]);
}
if(!_1089){
var _108e=Date.now()-window.davinciBackspaceKeyTime<100;
if(_108e){
_1089=_106f.careful;
}
}
if(_1089){
if(e=e||window.event){
e.returnValue=_1089;
}
return _1089;
}
});
},subscribe:function(topic,func){
_107c.subscriptions.push(dojo.subscribe(topic,this,func));
},destroy:function(){
dojo.forEach(_107c.subscriptions,dojo.unsubscribe);
_107a.destroy();
},_addExtension:function(id,_108f,_1090){
if(_108f.id){
_108f.id=_1090+"."+_108f.id;
}
_107c.extensionPoints[id]=_107c.extensionPoints[id]||[];
var _1091=_107c.extensionPoints[id];
_1091.push(_108f);
_107c.extensionPoints[id]=_1091;
},getExtensions:function(_1092,_1093){
var _1094=_107c.extensionPoints[_1092];
if(_1093){
var _1095=[];
var _1096=_1093 instanceof Function;
if(_1094){
return _1094.filter(function(ext){
return (_1096&&_1093(ext))||ext.id==_1093;
});
}
}
return _1094;
},getExtension:function(_1097,_1098){
return _107c.getExtensions(_1097,_1098)[0];
},handleError:function(error){
var _1099="welcome";
if(_107c.singleUserMode()){
_1099=".";
}
window.document.body.innerHTML=dojo.string.substitute(_106f.serverConnectError,{redirectUrl:_1099,error:error});
},executeCommand:function(cmdID){
var cmd=_107c.getExtension("davinci.commands",cmdID);
if(cmd&&cmd.run){
cmd.run();
}
},_selectionChanged:function(_109a){
_107c.currentSelection=_109a;
},getSelection:function(){
return _107c.currentSelection;
},doLogin:function(){
var retry=true;
var _109b="<table>"+"<tr><td><label for=\"username\">User: </label></td>"+"<td><input dojoType=dijit.form.TextBox type=\"text\" name=\"username\" id='username' ></input></td></tr>"+"<tr><td><label for=\"password\">Password: </label></td> <td><input dojoType=\"dijit.form.TextBox\" type=\"password\" name=\"password\" id='password'></input></td></tr>"+"<tr><td colspan=\"2\" align=\"center\"><button dojoType=\"dijit.form.Button\" type=\"submit\" >Login</button></td>"+"</tr></table>";
do{
var _109c=false;
var _109d=new _1070({id:"connectDialog",title:"Please login",onExecute:function(){
dojo.xhrGet({url:"cmd/login",sync:true,handleAs:"text",content:{userName:dojo.byId("username").value,password:dojo.byId("password").value,noRedirect:true}}).then(function(_109e){
if(_109e=="OK"){
window.location.href="welcome";
}else{
console.warn("Unknown error: result="+_109e);
}
},function(error){
console.warn("Login error",error);
});
_109c=true;
},onCancel:function(){
_109c=true;
_107c.destroyRecursive(false);
}});
_109d.setContent(_109b);
_109d.show();
}while(retry);
},serverJSONRequest:function(_109f){
var _10a0;
var args={handleAs:"json"};
dojo.mixin(args,_109f);
dojo.xhrGet(args).then(function(_10a1){
if(_10a1){
_10a0=_10a1;
}
});
return _10a0;
},logoff:function(args){
var _10a2=dojo.create("div",null,dojo.body(),"first");
_10a2.innerHTML="<table><tr><td><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>&nbsp;Logging off...</td></tr></table>";
dojo.addClass(_10a2,"loading");
require("davinci/Workbench").unload();
_107c.serverJSONRequest({url:"cmd/logoff",handleAs:"text",sync:true});
var _10a3=_107c.location();
var _10a4=_10a3.length-1;
if(_10a3.charAt(_10a4)=="/"){
_10a3=_10a3.substr(0,_10a4);
}
location.href=_10a3+"/welcome";
},registerKeyBinding:function(_10a5,_10a6){
if(!this._globalKeyBindings){
this._globalKeyBindings=[];
}
this._globalKeyBindings.push({keyBinding:_10a5,action:_10a6});
},handleKeyEvent:function(e){
this._handleKeyEvent(e,true);
},_handleGlobalDocumentKeyEvent:function(e){
this._handleKeyEvent(e);
},_handleKeyEvent:function(e,_10a7){
if(!this._globalKeyBindings){
return;
}
var _10a8=false;
_10a8=dojo.some(this._globalKeyBindings,dojo.hitch(this,function(_10a9){
if(_107c.isKeyEqualToEvent(_10a9.keyBinding,e)){
davinci.Workbench._runAction(_10a9.action);
return true;
}
}));
if(_10a8){
dojo.stopEvent(e);
}else{
if(!_10a7){
if(this.currentEditor&&this.currentEditor.handleKeyEvent){
this.currentEditor.handleKeyEvent(e,true);
}
}
}
},isKeyEqualToEvent:function(_10aa,e){
var equal=true;
var _10ab=((e.ctrlKey&&!dojo.isMac)||(dojo.isMac&&e.metaKey));
var _10ac=((e.altKey&&!dojo.isMac)||(dojo.isMac&&e.ctrlKey));
if(!!_10aa.accel!==_10ab){
equal=false;
}
if(!!_10aa.meta!==_10ac){
equal=false;
}
if(!!_10aa.shift!==e.shiftKey){
equal=false;
}
if(equal&&_10aa.charOrCode&&e.which){
if(dojo.isArray(_10aa.charOrCode)){
equal=dojo.some(_10aa.charOrCode,dojo.hitch(this,function(_10ad){
return this._comparecharOrCode(_10ad,e);
}));
}else{
equal=this._comparecharOrCode(_10aa.charOrCode,e);
}
}
return equal;
},_comparecharOrCode:function(_10ae,e){
var equal;
if(dojo.isString(_10ae)){
equal=(_10ae.toLowerCase()===String.fromCharCode(e.which).toLowerCase());
}else{
equal=(_10ae===e.which);
}
return equal;
}};
davinci.Runtime=_107c;
return _107c;
});
},"davinci/html/ui/HTMLOutline":function(){
define(["dojo/_base/declare","davinci/html/ui/HTMLOutlineModel"],function(_10af,_10b0){
return _10af("davinci/html/ui/HTMLOutline",null,{constructor:function(model){
this._htmlModel=model;
},getModel:function(){
this._model=new _10b0(this._htmlModel);
return this._model;
}});
});
},"dojox/timing/doLater":function(){
define("dojox/timing/doLater",["./_base"],function(dxt){
dojo.experimental("dojox.timing.doLater");
dxt.doLater=function(_10b1,_10b2,_10b3){
if(_10b1){
return false;
}
var _10b4=dxt.doLater.caller,args=dxt.doLater.caller.arguments;
_10b3=_10b3||100;
_10b2=_10b2||dojo.global;
setTimeout(function(){
_10b4.apply(_10b2,args);
},_10b3);
return true;
};
return dxt.doLater;
});
},"davinci/html/CSSAtRule":function(){
define("davinci/html/CSSAtRule",["dojo/_base/declare","davinci/html/CSSElement"],function(_10b5,_10b6){
return _10b5("davinci.html.CSSAtRule",_10b6,{constructor:function(){
this.elementType="CSSAtRule";
},getCSSFile:function(){
return this.parent;
},getText:function(_10b7){
s="@";
s=s+this.name+" "+this.value+"\n";
return s;
}});
});
},"davinci/html/CSSParser":function(){
define(["dojo/_base/declare","davinci/html/CSSSelector","davinci/html/CSSCombinedSelector","davinci/html/CSSRule","davinci/html/CSSProperty","davinci/html/CSSAtRule","davinci/html/CSSImport","davinci/model/parser/Tokenizer","davinci/model/Comment"],function(_10b8,_10b9,_10ba,_10bb,_10bc,_10bd,_10be,_10bf,_10c0){
var _10c1=null;
var _10c2=(function(){
var _10c3=(function(){
function _10c4(_10c5,_10c6){
var ch=_10c5.next();
if(ch=="@"){
_10c5.nextWhileMatches(/[a-zA-Z0-9_-]/);
return "css-at";
}else{
if(ch=="/"&&_10c5.equals("*")){
_10c6(_10c7);
return null;
}else{
if(ch=="<"&&_10c5.equals("!")){
_10c6(_10c8);
return null;
}else{
if(ch=="="){
return "css-compare";
}else{
if(_10c5.equals("=")&&(ch=="~"||ch=="|")){
_10c5.next();
return "css-compare";
}else{
if(ch=="\""||ch=="'"){
_10c6(_10c9(ch));
return null;
}else{
if(ch=="#"){
_10c5.nextWhileMatches(/[\w-]/);
return "css-hash";
}else{
if(ch=="!"){
_10c5.nextWhileMatches(/[ \t]/);
_10c5.nextWhileMatches(/\w/);
return "css-important";
}else{
if(/\d/.test(ch)){
_10c5.nextWhileMatches(/[\w.%]/);
return "css-unit";
}else{
if(/[,.+>*\/]/.test(ch)){
return "css-select-op";
}else{
if(/[;{}:\[\]]/.test(ch)){
return "css-punctuation";
}else{
_10c5.nextWhileMatches(/[\w\\\-_]/);
return "css-identifier";
}
}
}
}
}
}
}
}
}
}
}
};
function _10c7(_10ca,_10cb){
var _10cc=false;
while(!_10ca.endOfLine()){
var ch=_10ca.next();
if(_10cc&&ch=="/"){
_10cb(_10c4);
break;
}
_10cc=(ch=="*");
}
return "css-comment";
};
function _10c8(_10cd,_10ce){
var _10cf=0;
while(!_10cd.endOfLine()){
var ch=_10cd.next();
if(_10cf>=2&&ch==">"){
_10ce(_10c4);
break;
}
_10cf=(ch=="-")?_10cf+1:0;
}
return "css-comment";
};
function _10c9(quote){
return function(_10d0,_10d1){
var _10d2=false;
while(!_10d0.endOfLine()){
var ch=_10d0.next();
if(ch==quote&&!_10d2){
break;
}
_10d2=!_10d2&&ch=="\\";
}
if(!_10d2){
_10d1(_10c4);
}
return "css-string";
};
};
return function(_10d3,_10d4){
return _10bf.tokenizer(_10d3,_10d4||_10c4);
};
})();
function _10d5(_10d6,_10d7,base){
return function(_10d8){
if(!_10d6||/^\}/.test(_10d8)){
return base;
}else{
if(_10d7){
return base+indentUnit*2;
}else{
return base+indentUnit;
}
}
};
};
function _10d9(_10da,_10db){
_10db=_10db||0;
var _10dc=_10c3(_10da);
var _10dd=false,_10de=false,_10df=false;
var iter={next:function(){
var token=_10dc.next(),style=token.style,_10e0=token.content;
if(style=="css-hash"){
style=token.style=_10de?"css-colorcode":"css-identifier";
}
if(style=="css-identifier"){
if(_10de){
token.style="css-value";
}else{
if(!_10dd&&!_10df){
token.style="css-selector";
}
}
}
if(_10e0=="\n"){
token.indentation=_10d5(_10dd,_10de,_10db);
}
if(_10e0=="{"&&_10df=="@media"){
_10df=false;
}else{
if(_10e0=="{"){
_10dd=true;
}else{
if(_10e0=="}"){
_10dd=_10de=_10df=false;
}else{
if(_10e0==";"){
_10de=_10df=false;
}else{
if(_10dd&&style!="css-comment"&&style!="whitespace"){
_10de=true;
}else{
if(!_10dd&&style=="css-at"){
_10df=_10e0;
}
}
}
}
}
}
return token;
},copy:function(){
var _10e1=_10dd,_10e2=_10de,_10e3=_10dc.state;
return function(_10e4){
_10dc=_10c3(_10e4,_10e3);
_10dd=_10e1;
_10de=_10e2;
return iter;
};
}};
return iter;
};
return {make:_10d9,electricChars:"}"};
})();
_10c2.parse=function(text,_10e5){
var _10e6,_10e7;
if(typeof text=="string"){
var _10e8={next:function(){
if(++this.count==1){
return text;
}else{
throw StopIteration;
}
},count:0,text:text};
_10e6=_10bf.stringStream(_10e8);
}else{
_10e6=text;
_10e7=true;
}
var _10e9=_10c2.make(_10e6);
var token;
var _10ea;
var _10eb;
var _10ec=" ";
var _10ed=[];
var _10ee=[];
var model,_10ef;
function error(text){
_10ed.push(text);
};
function _10f0(){
var start,stop,s;
token=_10e9.next();
var _10f1=false;
while(token.style=="css-comment"||token.style=="whitespace"){
if(token.style=="css-comment"||_10f1){
if(!_10c1){
_10c1=new _10c0();
}
s=token.content;
if(token.content.indexOf("/*")===0){
s=s.substring(2);
_10f1=true;
_10c1.addComment("block",start,stop,"");
}
if((s.lastIndexOf("*/")>-1)&&(s.lastIndexOf("*/")==s.length-2)){
s=s.substring(0,s.length-2);
_10f1=false;
}
_10c1.appendComment(s);
}
token=_10e9.next();
}
return token;
};
function _10f2(){
_10ea=new _10b9();
_10ea.startOffset=token.offset;
_10ea.parent=model;
if(_10eb){
_10eb.selectors.push(_10ea);
_10ea.parent=_10eb;
}else{
model.selectors.push(_10ea);
}
};
function _10f3(){
var prev=_10ea;
prev.endOffset=token.offset-1;
if(!_10eb){
_10eb=new _10ba();
_10eb.parent=model;
_10eb.selectors.push(prev);
_10ea.startOffset=prev.startOffset;
model.selectors[model.selectors.length-1]=_10eb;
}
_10f2();
_10eb.combiners.push(_10ec);
_10ec=" ";
};
var _10f4;
try{
do{
_10f0();
switch(token.style){
case "css-selector":
case "css-select-op":
if(_10e7&&token.content=="<"){
_10e6.push("<");
throw StopIteration;
}
model=new _10bb();
_10ee.push(model);
model.startOffset=token.offset;
if(_10e5){
_10e5.addChild(model,undefined,true);
}
_10ef=false;
_10eb=undefined;
_10ec=" ";
_10f2();
selectorLoop:
for(;;){
switch(token.style){
case "css-select-op":
switch(token.content){
case ",":
_10eb=undefined;
_10f4=false;
_10f2();
break;
case ".":
if(_10ef){
_10f3();
}
_10f0();
if(_10ea.cls){
_10ea.cls=_10ea.cls+"."+token.content;
}else{
_10ea.cls=token.content;
}
_10ef=token.value.length>token.content.length;
break;
case "*":
if(_10ea.element||_10ea.cls){
_10f3();
}
_10ea.element="*";
break;
case "+":
case ">":
_10ec=token.content;
_10f3();
break;
}
break;
case "css-selector":
if(token.type=="css-identifier"){
if(_10ea.element||_10ea.cls){
_10f3();
}
_10ea.element=token.content;
}else{
if(token.type=="css-hash"){
if(_10ea.id||_10ef){
_10f3();
}
_10ea.id=token.content.substring(1);
}
}
_10ef=token.value.length>token.content.length;
break;
case "css-punctuation":
if(token.content=="{"){
break selectorLoop;
}else{
if(token.content==":"){
_10f0();
if(token.content==":"){
_10f0();
_10ea.pseudoElement=token.content;
}else{
_10ea.pseudoRule=token.content;
_10ef=true;
}
}else{
if(token.content=="["){
_10f0();
_10ea.attribute={name:token.content};
_10f0();
if(token.content==="="||token.content==="~="||token.content==="|="){
_10ea.attribute.type=token.content;
_10f0();
_10ea.attribute.value=token.content.substring(1,token.content.length-1);
_10f0();
}
}
}
}
break;
}
_10f4=true;
_10f0();
}
if(_10c1){
model.comment=_10c1;
_10c1=null;
}
_10ea.endOffset=token.offset-1;
while(_10f0().content!="}"){
var _10f5=token.offset;
var _10f6=token.content;
var _10f7=false;
if(token.type=="css-hash"){
_10f0();
if(token.type=="css-identifier"){
_10f6+=token.content;
}else{
_10f7=true;
}
}else{
if(token.type!="css-identifier"){
if(token.content!="*"){
error("expecting identifier around "+_10ea.getText()+"{ "+_10f8.name+": "+propery.value);
}else{
_10f0();
_10f6+=token.content;
}
}
}
var _10f8=new _10bc();
_10f8.startOffset=_10f5;
_10f8.parent=model;
if(_10c1){
_10f8.comment=_10c1;
_10c1=null;
}
model.properties.push(_10f8);
model.addChild(_10f8,undefined,true);
_10f8.name=_10f6;
if(!_10f7){
if(_10f0().content!=":"){
error("expecting ':' "+_10ea.getText()+"{ "+_10f8.name+": "+propery.value);
}
}
_10f0();
_10f8.value=token.value;
if(_10f8.value=="url"){
while((_10f0()).content!=")"){
_10f8.value+=token.value;
}
_10f8.value+=token.value;
}
while((_10f0()).content!=";"&&token.content!="}"){
_10f8.value+=token.value;
}
if(_10c1){
_10f8.postComment=_10c1;
_10c1=null;
}
_10f8.endOffset=token.offset-1;
if(token.content=="}"){
break;
}
}
if(_10c1){
_10f8.postComment=_10c1;
_10c1=null;
}
model.endOffset=token.offset;
break;
case "css-at":
var _10f9=token.content.substring(1);
var _10fa=(_10f9=="import")?new _10be():new _10bd();
_10fa.startOffset=token.offset;
if(_10e5){
_10e5.addChild(_10fa,undefined,true);
}
if(_10f9=="import"){
var _10fb=_10fa;
_10f0();
if(token.content=="url"){
_10fb.isURL=true;
_10f0();
_10f0();
}
_10fb.url=token.content.substring(1,token.content.length-1);
if(_10fb.isURL){
_10f0();
}
_10f0();
}else{
if(_10f9.indexOf("keyframes")>=0){
var _10fc="";
var _10fd="";
var _10fe=false;
var _10ff="\t\t";
_10f0();
_10fc=token.content;
if(_10fc=="."){
_10f0();
_10fc+=token.content;
}
_10f0();
_10fa.value=token.content+"\n";
_10f0();
if(token.content.indexOf("from")>=0||token.content.indexOf("to")>=0||token.content.indexOf("%")>=0){
outerLoop:
for(;;){
_10fa.value+="\t"+token.content+" ";
_10f0();
_10fa.value+=token.content+"\n";
while((_10f0()).content!="}"){
if(_10fe){
_10ff="\t\t";
_10fe=false;
}
if(token.content==";"){
_10fd="\n";
_10fe=true;
}else{
if(token.content==":"||token.content==")"){
_10fd=" ";
}
}
_10fa.value+=_10ff+token.content+_10fd;
_10fd="";
_10ff="";
}
_10fa.value+="\t"+token.content+"\n";
_10f0();
if(token.content=="}"){
break outerLoop;
}
}
}else{
error("inside keyframes decl expecting from/to blocks or nn% blocks");
}
_10fa.value+=token.content;
_10fa.name=_10f9+" "+_10fc;
}else{
_10fa.name=_10f9;
_10fa.value="";
while((_10f0()).content!=";"){
_10fa.value+=token.content;
}
}
}
_10fa.endOffset=token.offset;
break;
}
}while(true);
}
catch(e){
if(_10c1&&model){
model.postComment=_10c1;
_10c1=null;
}
}
return {errors:_10ed,model:_10ee};
};
return _10c2;
});
},"davinci/html/ui/CSSEditor":function(){
define(["dojo/_base/declare","davinci/ui/ModelEditor","davinci/html/CSSEditorContext","davinci/html/ui/CSSOutline","davinci/html/CSSFile",],function(_1100,_1101,_1102,_1103,_1104){
return _1100(_1101,{constructor:function(_1105){
this.cssFile=new _1104();
this.model=this.cssFile;
},destroy:function(){
this.cssFile.close();
this.inherited(arguments);
},getOutline:function(){
if(!this.outline){
this.outline=new _1103(this.model);
}
return this.outline;
},getDefaultContent:function(){
return "";
},getContext:function(){
if(!this.context){
this.context=new _1102(this);
}
return this.context;
}});
});
},"davinci/ui/widgets/NewHTMLFileOptions":function(){
define(["dojo/_base/declare","dijit/_Templated","dijit/_Widget","davinci/library","system/resource","davinci/workbench/Preferences","davinci/Runtime","davinci/Workbench","dijit/Menu","dijit/MenuItem","davinci/model/Path","dijit/Tooltip","dijit/form/DropDownButton","dojo/i18n!davinci/ui/nls/ui","dojo/i18n!dijit/nls/common","dojo/text!./templates/NewHTMLFileOptions.html","dijit/form/Button","davinci/ui/widgets/ThemeSetSelection","davinci/Theme","dijit/form/TextBox","dijit/form/RadioButton"],function(_1106,_1107,_1108,_1109,_110a,_110b,_110c,_110d,Menu,_110e,Path,_110f,_1110,uiNLS,_1111,_1112,_1113,_1114,Theme){
return _1106("davinci.ui.widgets.NewHTMLFileOptions",[_1108,_1107],{widgetsInTemplate:true,templateString:_1112,device:null,themeSet:null,dialogSpecificClassOptions:null,standardDevices:[{type:"mobile",value:"android_340x480",device:"android_340x480",layout:"flow"},{type:"mobile",value:"android_480x800",device:"android_480x800",layout:"flow"},{type:"mobile",value:"androidtablet",device:"androidtablet",layout:"flow"},{type:"mobile",value:"blackberry",device:"blackberry",layout:"flow"},{type:"mobile",value:"ipad",device:"ipad",layout:"flow"},{type:"mobile",value:"iphone",device:"iphone",layout:"flow"}],postCreate:function(){
this.inherited(arguments);
var _1115=this.dialogSpecificClassOptions;
var _1116=_1115?_1115.showDevices:false;
var _1117=_1115?_1115.showThemeSetsButton:false;
var _1118=this.langObj=uiNLS;
this.deviceLabel.innerHTML=_1118.nhfoDevice;
if(!_1116){
this.nhfo_outer2.style.display="none";
}
var _1119=_110d.workbenchStateCustomPropGet("nhfo");
this._selectedThemeSet=_1119?_1119.themeSet:undefined;
if(this._selectedThemeSet&&this._selectedThemeSet.name!=Theme.none_themeset_name){
var _111a=this._selectedThemeSet.name;
this._selectedThemeSet=dojo.clone(Theme.none_themeset);
var _111b=_110b.getPreferences("maqetta.dojo.themesets",_110d.getProject());
if(_111b){
for(var s=0;s<_111b.themeSets.length;s++){
if(_111b.themeSets[s].name===_111a){
this._selectedThemeSet=dojo.clone(_111b.themeSets[s]);
break;
}
}
}
}
_updateWithLastDialogValue=function(_111c,opts,_111d,_111e){
for(var i=0;i<opts.length;i++){
var opt=opts[i];
if(opt.value==_111d){
_111c.attr("value",_111d);
return true;
}
}
_111c.attr("value",_111e);
return false;
};
var _111f=[];
for(var i=0;i<this.standardDevices.length;i++){
var o=this.standardDevices[i];
if(o.type=="separator"){
_111f.push({type:o.type});
}else{
if(o.type=="mobile"){
var value=o.value;
var label=o.value;
_111f.push({value:value,label:label});
}else{
var value=o.value;
var label=_1118["nhfoDVMenu_"+value];
_111f.push({value:value,label:label});
}
}
}
this.deviceSelect.addOption(_111f);
var _1120=this;
function _1121(){
if(_1120.ctTooltip&&_1120.ctTooltip.close){
_1120.ctTooltip.close();
}
};
this.connect(this.deviceSelect,"onFocus",dojo.hitch(this,function(){
_1121();
}));
this.connect(this.deviceSelect.dropDown,"onOpen",dojo.hitch(this,function(){
_1121();
}));
this.connect(this.deviceSelect.dropDown,"onClose",dojo.hitch(this,function(){
_1121();
}));
var _1122=_1119?_1119.device:undefined;
_updateWithLastDialogValue(this.deviceSelect,_111f,_1122,"iphone");
this.connect(this.deviceSelect,"onChange",dojo.hitch(this,function(){
this._update_comp_type();
}));
this._update_comp_type();
if(_1117){
var input=document.createElement("input");
this.dialogSpecificButtonsSpan.appendChild(input);
this.themeButton=new _1113({label:this.langObj.nhfoThemeButtonLabel,title:this.langObj.nhfoThemeButtonTitle},input);
this.connect(this.themeButton,"onClick",dojo.hitch(this,function(e){
this._themeSelectionDialog=new _1114({newFile:true});
this._themeSelectionDialog.buildRendering();
this.connect(this._themeSelectionDialog,"onOk",dojo.hitch(this,function(e){
this._selectedThemeSet=this._themeSelectionDialog._selectedThemeSet;
this._updateThemesAndThemeSets();
}));
}));
}
},startup:function(){
var label=this.deviceLabel;
var _1123=this.deviceSelect;
var idNum=0,_1124;
do{
idNum++;
_1124="device"+idNum;
}while(dojo.byId(_1124));
label.id=_1124;
this.ctTooltip=new _110f({connectId:[_1124,_1123.id],position:["below","below"],label:this.langObj.nhfoDeviceTooltip});
},_update_comp_type:function(){
var o=this._currentDeviceObject("_update_comp_type");
if(o.device=="desktop"){
delete this._selectedTheme;
delete this._selectedThemeSet;
}
},getOptions:function(){
var o=this._currentDeviceObject("getOptions");
return {device:o.value,device:o.device,layout:o.layout,theme:this._selectedTheme?this._selectedTheme:o.theme,themeSet:this._selectedThemeSet};
},_updateThemesAndThemeSets:function(e){
var _1125=this._selectedThemeSet.name;
if(_1125==Theme.none_themeset_name){
var o=this._currentDeviceObject("_updateThemesAndThemeSets");
var _1126=o.device;
if(_1126=="desktop"){
_1125=this._selectedThemeSet.desktopTheme;
}else{
for(var x=0;x<this._selectedThemeSet.mobileTheme.length;x++){
if(_1126.toLowerCase().indexOf(this._selectedThemeSet.mobileTheme[x].device.toLowerCase())>-1){
_1125=this._selectedThemeSet.mobileTheme[x].theme;
break;
}
}
}
}
this._selectedTheme=_1125;
},_currentDeviceObject:function(_1127){
var _1128=this.deviceSelect.attr("value");
var found=false;
for(var i=0;i<this.standardDevices.length;i++){
var o=this.standardDevices[i];
if(o.value==_1128){
found=true;
break;
}
}
if(!found){
console.error("NewHTMLFileOptions. "+_1127+": invalid device="+_1128);
o=this.standardDevices[0];
}
return o;
}});
});
},"davinci/ve/actions/UnselectAllAction":function(){
define(["dojo/_base/declare","davinci/ve/actions/ContextAction"],function(_1129,_112a){
return _1129("davinci.ve.actions.SelectParentAction",[_112a],{run:function(_112b){
_112b=this.fixupContext(_112b);
var _112c=(_112b&&_112b.getSelection());
if(_112c.length>0){
_112b.deselect();
}
},isEnabled:function(_112d){
_112d=this.fixupContext(_112d);
var _112e=(_112d&&_112d.getSelection());
return (_112e&&_112e.length>0);
}});
});
},"dojox/main":function(){
define("dojox/main",["dojo/_base/kernel"],function(dojo){
return dojo.dojox;
});
},"dojox/grid/_Scroller":function(){
define("dojox/grid/_Scroller",["dijit/registry","dojo/_base/declare","dojo/_base/lang","./util","dojo/_base/html"],function(_112f,_1130,lang,util,html){
var _1131=function(_1132){
var i=0,n,p=_1132.parentNode;
while((n=p.childNodes[i++])){
if(n==_1132){
return i-1;
}
}
return -1;
};
var _1133=function(_1134){
if(!_1134){
return;
}
dojo.forEach(_112f.toArray(),function(w){
if(w.domNode&&html.isDescendant(w.domNode,_1134,true)){
w.destroy();
}
});
};
var _1135=function(_1136){
var node=html.byId(_1136);
return (node&&node.tagName?node.tagName.toLowerCase():"");
};
var _1137=function(_1138,inTag){
var _1139=[];
var i=0,n;
while((n=_1138.childNodes[i])){
i++;
if(_1135(n)==inTag){
_1139.push(n);
}
}
return _1139;
};
var _113a=function(_113b){
return _1137(_113b,"div");
};
return _1130("dojox.grid._Scroller",null,{constructor:function(_113c){
this.setContentNodes(_113c);
this.pageHeights=[];
this.pageNodes=[];
this.stack=[];
},rowCount:0,defaultRowHeight:32,keepRows:100,contentNode:null,scrollboxNode:null,defaultPageHeight:0,keepPages:10,pageCount:0,windowHeight:0,firstVisibleRow:0,lastVisibleRow:0,averageRowHeight:0,page:0,pageTop:0,init:function(_113d,_113e,_113f){
switch(arguments.length){
case 3:
this.rowsPerPage=_113f;
case 2:
this.keepRows=_113e;
case 1:
this.rowCount=_113d;
default:
break;
}
this.defaultPageHeight=this.defaultRowHeight*this.rowsPerPage;
this.pageCount=this._getPageCount(this.rowCount,this.rowsPerPage);
this.setKeepInfo(this.keepRows);
this.invalidate();
if(this.scrollboxNode){
this.scrollboxNode.scrollTop=0;
this.scroll(0);
this.scrollboxNode.onscroll=lang.hitch(this,"onscroll");
}
},_getPageCount:function(_1140,_1141){
return _1140?(Math.ceil(_1140/_1141)||1):0;
},destroy:function(){
this.invalidateNodes();
delete this.contentNodes;
delete this.contentNode;
delete this.scrollboxNode;
},setKeepInfo:function(_1142){
this.keepRows=_1142;
this.keepPages=!this.keepRows?this.keepPages:Math.max(Math.ceil(this.keepRows/this.rowsPerPage),2);
},setContentNodes:function(_1143){
this.contentNodes=_1143;
this.colCount=(this.contentNodes?this.contentNodes.length:0);
this.pageNodes=[];
for(var i=0;i<this.colCount;i++){
this.pageNodes[i]=[];
}
},getDefaultNodes:function(){
return this.pageNodes[0]||[];
},invalidate:function(){
this._invalidating=true;
this.invalidateNodes();
this.pageHeights=[];
this.height=(this.pageCount?(this.pageCount-1)*this.defaultPageHeight+this.calcLastPageHeight():0);
this.resize();
this._invalidating=false;
},updateRowCount:function(_1144){
this.invalidateNodes();
this.rowCount=_1144;
var _1145=this.pageCount;
if(_1145===0){
this.height=1;
}
this.pageCount=this._getPageCount(this.rowCount,this.rowsPerPage);
if(this.pageCount<_1145){
for(var i=_1145-1;i>=this.pageCount;i--){
this.height-=this.getPageHeight(i);
delete this.pageHeights[i];
}
}else{
if(this.pageCount>_1145){
this.height+=this.defaultPageHeight*(this.pageCount-_1145-1)+this.calcLastPageHeight();
}
}
this.resize();
},pageExists:function(_1146){
return Boolean(this.getDefaultPageNode(_1146));
},measurePage:function(_1147){
if(this.grid.rowHeight){
var _1148=this.grid.rowHeight+1;
return ((_1147+1)*this.rowsPerPage>this.rowCount?this.rowCount-_1147*this.rowsPerPage:this.rowsPerPage)*_1148;
}
var n=this.getDefaultPageNode(_1147);
return (n&&n.innerHTML)?n.offsetHeight:undefined;
},positionPage:function(_1149,inPos){
for(var i=0;i<this.colCount;i++){
this.pageNodes[i][_1149].style.top=inPos+"px";
}
},repositionPages:function(_114a){
var nodes=this.getDefaultNodes();
var last=0;
for(var i=0;i<this.stack.length;i++){
last=Math.max(this.stack[i],last);
}
var n=nodes[_114a];
var y=(n?this.getPageNodePosition(n)+this.getPageHeight(_114a):0);
for(var p=_114a+1;p<=last;p++){
n=nodes[p];
if(n){
if(this.getPageNodePosition(n)==y){
return;
}
this.positionPage(p,y);
}
y+=this.getPageHeight(p);
}
},installPage:function(_114b){
for(var i=0;i<this.colCount;i++){
this.contentNodes[i].appendChild(this.pageNodes[i][_114b]);
}
},preparePage:function(_114c,_114d){
var p=(_114d?this.popPage():null);
for(var i=0;i<this.colCount;i++){
var nodes=this.pageNodes[i];
var new_p=(p===null?this.createPageNode():this.invalidatePageNode(p,nodes));
new_p.pageIndex=_114c;
nodes[_114c]=new_p;
}
},renderPage:function(_114e){
var nodes=[];
var i,j;
for(i=0;i<this.colCount;i++){
nodes[i]=this.pageNodes[i][_114e];
}
for(i=0,j=_114e*this.rowsPerPage;(i<this.rowsPerPage)&&(j<this.rowCount);i++,j++){
this.renderRow(j,nodes);
}
},removePage:function(_114f){
for(var i=0,j=_114f*this.rowsPerPage;i<this.rowsPerPage;i++,j++){
this.removeRow(j);
}
},destroyPage:function(_1150){
for(var i=0;i<this.colCount;i++){
var n=this.invalidatePageNode(_1150,this.pageNodes[i]);
if(n){
html.destroy(n);
}
}
},pacify:function(_1151){
},pacifying:false,pacifyTicks:200,setPacifying:function(_1152){
if(this.pacifying!=_1152){
this.pacifying=_1152;
this.pacify(this.pacifying);
}
},startPacify:function(){
this.startPacifyTicks=new Date().getTime();
},doPacify:function(){
var _1153=(new Date().getTime()-this.startPacifyTicks)>this.pacifyTicks;
this.setPacifying(true);
this.startPacify();
return _1153;
},endPacify:function(){
this.setPacifying(false);
},resize:function(){
if(this.scrollboxNode){
this.windowHeight=this.scrollboxNode.clientHeight;
}
for(var i=0;i<this.colCount;i++){
util.setStyleHeightPx(this.contentNodes[i],Math.max(1,this.height));
}
var _1154=(!this._invalidating);
if(!_1154){
var ah=this.grid.get("autoHeight");
if(typeof ah=="number"&&ah<=Math.min(this.rowsPerPage,this.rowCount)){
_1154=true;
}
}
if(_1154){
this.needPage(this.page,this.pageTop);
}
var _1155=(this.page<this.pageCount-1)?this.rowsPerPage:((this.rowCount%this.rowsPerPage)||this.rowsPerPage);
var _1156=this.getPageHeight(this.page);
this.averageRowHeight=(_1156>0&&_1155>0)?(_1156/_1155):0;
},calcLastPageHeight:function(){
if(!this.pageCount){
return 0;
}
var _1157=this.pageCount-1;
var _1158=((this.rowCount%this.rowsPerPage)||(this.rowsPerPage))*this.defaultRowHeight;
this.pageHeights[_1157]=_1158;
return _1158;
},updateContentHeight:function(inDh){
this.height+=inDh;
this.resize();
},updatePageHeight:function(_1159,_115a,_115b){
if(this.pageExists(_1159)){
var oh=this.getPageHeight(_1159);
var h=(this.measurePage(_1159));
if(h===undefined){
h=oh;
}
this.pageHeights[_1159]=h;
if(oh!=h){
this.updateContentHeight(h-oh);
var ah=this.grid.get("autoHeight");
if((typeof ah=="number"&&ah>this.rowCount)||(ah===true&&!_115a)){
if(!_115b){
this.grid.sizeChange();
}else{
var ns=this.grid.viewsNode.style;
ns.height=parseInt(ns.height)+h-oh+"px";
this.repositionPages(_1159);
}
}else{
this.repositionPages(_1159);
}
}
return h;
}
return 0;
},rowHeightChanged:function(_115c,_115d){
this.updatePageHeight(Math.floor(_115c/this.rowsPerPage),false,_115d);
},invalidateNodes:function(){
while(this.stack.length){
this.destroyPage(this.popPage());
}
},createPageNode:function(){
var p=document.createElement("div");
html.attr(p,"role","presentation");
p.style.position="absolute";
p.style[this.grid.isLeftToRight()?"left":"right"]="0";
return p;
},getPageHeight:function(_115e){
var ph=this.pageHeights[_115e];
return (ph!==undefined?ph:this.defaultPageHeight);
},pushPage:function(_115f){
return this.stack.push(_115f);
},popPage:function(){
return this.stack.shift();
},findPage:function(inTop){
var i=0,h=0;
for(var ph=0;i<this.pageCount;i++,h+=ph){
ph=this.getPageHeight(i);
if(h+ph>=inTop){
break;
}
}
this.page=i;
this.pageTop=h;
},buildPage:function(_1160,_1161,inPos){
this.preparePage(_1160,_1161);
this.positionPage(_1160,inPos);
this.installPage(_1160);
this.renderPage(_1160);
this.pushPage(_1160);
},needPage:function(_1162,inPos){
var h=this.getPageHeight(_1162),oh=h;
if(!this.pageExists(_1162)){
this.buildPage(_1162,(!this.grid._autoHeight&&this.keepPages&&(this.stack.length>=this.keepPages)),inPos);
h=this.updatePageHeight(_1162,true);
}else{
this.positionPage(_1162,inPos);
}
return h;
},onscroll:function(){
this.scroll(this.scrollboxNode.scrollTop);
},scroll:function(inTop){
this.grid.scrollTop=inTop;
if(this.colCount){
this.startPacify();
this.findPage(inTop);
var h=this.height;
var b=this.getScrollBottom(inTop);
for(var p=this.page,y=this.pageTop;(p<this.pageCount)&&((b<0)||(y<b));p++){
y+=this.needPage(p,y);
}
this.firstVisibleRow=this.getFirstVisibleRow(this.page,this.pageTop,inTop);
this.lastVisibleRow=this.getLastVisibleRow(p-1,y,b);
if(h!=this.height){
this.repositionPages(p-1);
}
this.endPacify();
}
},getScrollBottom:function(inTop){
return (this.windowHeight>=0?inTop+this.windowHeight:-1);
},processNodeEvent:function(e,_1163){
var t=e.target;
while(t&&(t!=_1163)&&t.parentNode&&(t.parentNode.parentNode!=_1163)){
t=t.parentNode;
}
if(!t||!t.parentNode||(t.parentNode.parentNode!=_1163)){
return false;
}
var page=t.parentNode;
e.topRowIndex=page.pageIndex*this.rowsPerPage;
e.rowIndex=e.topRowIndex+_1131(t);
e.rowTarget=t;
return true;
},processEvent:function(e){
return this.processNodeEvent(e,this.contentNode);
},renderRow:function(_1164,_1165){
},removeRow:function(_1166){
},getDefaultPageNode:function(_1167){
return this.getDefaultNodes()[_1167];
},positionPageNode:function(_1168,inPos){
},getPageNodePosition:function(_1169){
return _1169.offsetTop;
},invalidatePageNode:function(_116a,_116b){
var p=_116b[_116a];
if(p){
delete _116b[_116a];
this.removePage(_116a,p);
_1133(p);
p.innerHTML="";
}
return p;
},getPageRow:function(_116c){
return _116c*this.rowsPerPage;
},getLastPageRow:function(_116d){
return Math.min(this.rowCount,this.getPageRow(_116d+1))-1;
},getFirstVisibleRow:function(_116e,_116f,_1170){
if(!this.pageExists(_116e)){
return 0;
}
var row=this.getPageRow(_116e);
var nodes=this.getDefaultNodes();
var rows=_113a(nodes[_116e]);
for(var i=0,l=rows.length;i<l&&_116f<_1170;i++,row++){
_116f+=rows[i].offsetHeight;
}
return (row?row-1:row);
},getLastVisibleRow:function(_1171,_1172,_1173){
if(!this.pageExists(_1171)){
return 0;
}
var nodes=this.getDefaultNodes();
var row=this.getLastPageRow(_1171);
var rows=_113a(nodes[_1171]);
for(var i=rows.length-1;i>=0&&_1172>_1173;i--,row--){
_1172-=rows[i].offsetHeight;
}
return row+1;
},findTopRow:function(_1174){
var nodes=this.getDefaultNodes();
var rows=_113a(nodes[this.page]);
for(var i=0,l=rows.length,t=this.pageTop,h;i<l;i++){
h=rows[i].offsetHeight;
t+=h;
if(t>=_1174){
this.offset=h-(t-_1174);
return i+this.page*this.rowsPerPage;
}
}
return -1;
},findScrollTop:function(inRow){
var _1175=Math.floor(inRow/this.rowsPerPage);
var t=0;
var i,l;
for(i=0;i<_1175;i++){
t+=this.getPageHeight(i);
}
this.pageTop=t;
this.page=_1175;
this.needPage(_1175,this.pageTop);
var nodes=this.getDefaultNodes();
var rows=_113a(nodes[_1175]);
var r=inRow-this.rowsPerPage*_1175;
for(i=0,l=rows.length;i<l&&i<r;i++){
t+=rows[i].offsetHeight;
}
return t;
},dummy:0});
});
},"davinci/ve/commands/ModifyCommand":function(){
define(["dojo/_base/declare","../widget","../utils/ImageUtils","../States"],function(_1176,_1177,_1178,_1179){
return _1176("davinci.ve.commands.ModifyCommand",null,{name:"modify",constructor:function(_117a,_117b,_117c,_117d,_117e){
this._oldId=(_117a?_117a.id:undefined);
this._properties=_117b=(_117b||{});
this._children=(_117c||typeof _117c=="string")?_117c:_117b._children;
this._context=_117d||_117a.getContext();
this._scripts=_117e;
delete this._properties._children;
},setContext:function(_117f){
this._context=_117f;
},add:function(_1180){
if(!_1180||_1180._oldId!=this._oldId){
return;
}
if(_1180._properties){
dojo.mixin(this._properties,_1180._properties);
}
if(_1180._children){
this._children=_1180._children;
}
},execute:function(){
if(!this._oldId||!this._properties){
return;
}
var _1181=_1177.byId(this._oldId),_1182=this._context;
if(!_1181){
return;
}
this._oldData=_1181.getData();
this._oldData.context=_1182;
this._newData={type:this._oldData.type,properties:dojo.mixin({},this._oldData.properties,this._properties),children:(this._children||typeof this._children=="string")?this._children:this._oldData.children,scripts:dojo.mixin({},this._oldData.scripts,this._scripts),states:this._oldData.states,context:_1182};
if(this._doRefreshFromSource(_1181)){
_1181.setProperties(this._newData.properties,true);
setTimeout(function(){
_1182.visualEditor.refresh();
},0);
return;
}
if(_1182){
_1182.detach(_1181);
}
if(!this._oldData.properties.isTempID||this._properties.id){
delete this._newData.properties.isTempID;
}
var _1183=_1181.getParent();
var _1184=null;
var index=_1183.indexOf(_1181);
_1183.removeChild(_1181);
_1181.destroyWidget();
_1184=_1177.createWidget(this._newData);
if(!_1184){
return;
}
if(_1184.domNode.tagName==="IMG"){
_1178.ImageUpdateFocus(_1184,_1182);
}
_1183.addChild(_1184,index);
this._newId=_1184.id;
if(_1182){
_1182.attach(_1184);
_1184.startup();
_1184.renderWidget();
_1182.widgetAddedOrDeleted();
if(this._oldId!=this._newId){
_1182.widgetChanged(_1182.WIDGET_ID_CHANGED,_1184,this._oldId);
}
_1182.widgetChanged(_1182.WIDGET_MODIFIED,_1184);
}
this.newWidget=_1184;
dojo.publish("/davinci/ui/widget/replaced",[_1184,_1181]);
_1179.resetState(_1184.domNode);
if(this._isRefreshParentOnPropChange(_1181)){
var _1185=new davinci.ve.commands.ModifyCommand(_1183,null,null,_1183._edit_context);
_1185.execute();
}
dojo.publish("/davinci/ui/widgetPropertiesChanged",[[_1184]]);
},_doRefreshFromSource:function(_1186){
var props=this._properties,name,p,_1187=false;
for(name in props){
if(props.hasOwnProperty(name)){
p=_1186.metadata.property[name];
if(p&&p.refreshFromSource){
_1187=true;
break;
}
}
}
return _1187;
},_isRefreshParentOnPropChange:function(_1188){
return davinci.ve.metadata.queryDescriptor(_1188.type,"refreshParentOnPropChange");
},undo:function(){
if(!this._newId||!this._oldData){
return;
}
var _1189=_1177.byId(this._newId);
if(!_1189){
return;
}
var _118a=_1189.getParent();
if(!_118a){
return;
}
var index=dojo.indexOf(_118a.getChildren(),_1189);
if(index<0){
return;
}
var _118b=_118a.getContext();
if(_118b){
_118b.detach(_1189);
}
_118a.removeChild(_1189);
_1189.destroyWidget();
newWidget=_1177.createWidget(this._oldData);
if(!newWidget){
return;
}
this._oldData=newWidget.getData();
this._oldData.context=this._context;
_118a.addChild(newWidget,index);
if(_118b){
_118b.attach(newWidget);
newWidget.startup();
newWidget.renderWidget();
_118b.widgetAddedOrDeleted();
_118b.widgetChanged(_118b.WIDGET_MODIFIED,newWidget);
}
dojo.publish("/davinci/ui/widget/replaced",[newWidget,_1189]);
_1179.resetState(newWidget.domNode);
if(this._isRefreshParentOnPropChange(_1189)){
var _118c=new davinci.ve.commands.ModifyCommand(_118a,null,null,_118a._edit_context);
_118c.execute();
}
dojo.publish("/davinci/ui/widgetPropertiesChanged",[[newWidget]]);
}});
});
},"dijit/form/_ComboBoxMenuMixin":function(){
define("dijit/form/_ComboBoxMenuMixin",["dojo/_base/array","dojo/_base/declare","dojo/dom-attr","dojo/i18n","dojo/i18n!./nls/ComboBox"],function(array,_118d,_118e,i18n){
return _118d("dijit.form._ComboBoxMenuMixin",null,{_messages:null,postMixInProperties:function(){
this.inherited(arguments);
this._messages=i18n.getLocalization("dijit.form","ComboBox",this.lang);
},buildRendering:function(){
this.inherited(arguments);
this.previousButton.innerHTML=this._messages["previousMessage"];
this.nextButton.innerHTML=this._messages["nextMessage"];
},_setValueAttr:function(value){
this.value=value;
this.onChange(value);
},onClick:function(node){
if(node==this.previousButton){
this._setSelectedAttr(null);
this.onPage(-1);
}else{
if(node==this.nextButton){
this._setSelectedAttr(null);
this.onPage(1);
}else{
this.onChange(node);
}
}
},onChange:function(){
},onPage:function(){
},onClose:function(){
this._setSelectedAttr(null);
},_createOption:function(item,_118f){
var _1190=this._createMenuItem();
var _1191=_118f(item);
if(_1191.html){
_1190.innerHTML=_1191.label;
}else{
_1190.appendChild(_1190.ownerDocument.createTextNode(_1191.label));
}
if(_1190.innerHTML==""){
_1190.innerHTML="&#160;";
}
this.applyTextDir(_1190,(_1190.innerText||_1190.textContent||""));
return _1190;
},createOptions:function(_1192,_1193,_1194){
this.items=_1192;
this.previousButton.style.display=(_1193.start==0)?"none":"";
_118e.set(this.previousButton,"id",this.id+"_prev");
array.forEach(_1192,function(item,i){
var _1195=this._createOption(item,_1194);
_1195.setAttribute("item",i);
_118e.set(_1195,"id",this.id+i);
this.nextButton.parentNode.insertBefore(_1195,this.nextButton);
},this);
var _1196=false;
if(_1192.total&&!_1192.total.then&&_1192.total!=-1){
if((_1193.start+_1193.count)<_1192.total){
_1196=true;
}else{
if((_1193.start+_1193.count)>_1192.total&&_1193.count==_1192.length){
_1196=true;
}
}
}else{
if(_1193.count==_1192.length){
_1196=true;
}
}
this.nextButton.style.display=_1196?"":"none";
_118e.set(this.nextButton,"id",this.id+"_next");
},clearResultList:function(){
var _1197=this.containerNode;
while(_1197.childNodes.length>2){
_1197.removeChild(_1197.childNodes[_1197.childNodes.length-2]);
}
this._setSelectedAttr(null);
},highlightFirstOption:function(){
this.selectFirstNode();
},highlightLastOption:function(){
this.selectLastNode();
},selectFirstNode:function(){
this.inherited(arguments);
if(this.getHighlightedOption()==this.previousButton){
this.selectNextNode();
}
},selectLastNode:function(){
this.inherited(arguments);
if(this.getHighlightedOption()==this.nextButton){
this.selectPreviousNode();
}
},getHighlightedOption:function(){
return this.selected;
}});
});
},"dijit/form/ToggleButton":function(){
define("dijit/form/ToggleButton",["dojo/_base/declare","dojo/_base/kernel","./Button","./_ToggleButtonMixin"],function(_1198,_1199,_119a,_119b){
return _1198("dijit.form.ToggleButton",[_119a,_119b],{baseClass:"dijitToggleButton",setChecked:function(_119c){
_1199.deprecated("setChecked("+_119c+") is deprecated. Use set('checked',"+_119c+") instead.","","2.0");
this.set("checked",_119c);
}});
});
},"url:dijit/templates/MenuSeparator.html":"<tr class=\"dijitMenuSeparator\">\n\t<td class=\"dijitMenuSeparatorIconCell\">\n\t\t<div class=\"dijitMenuSeparatorTop\"></div>\n\t\t<div class=\"dijitMenuSeparatorBottom\"></div>\n\t</td>\n\t<td colspan=\"3\" class=\"dijitMenuSeparatorLabelCell\">\n\t\t<div class=\"dijitMenuSeparatorTop dijitMenuSeparatorLabel\"></div>\n\t\t<div class=\"dijitMenuSeparatorBottom\"></div>\n\t</td>\n</tr>","dijit/MenuItem":function(){
require({cache:{"url:dijit/templates/MenuItem.html":"<tr class=\"dijitReset dijitMenuItem\" data-dojo-attach-point=\"focusNode\" role=\"menuitem\" tabIndex=\"-1\">\n\t<td class=\"dijitReset dijitMenuItemIconCell\" role=\"presentation\">\n\t\t<img src=\"${_blankGif}\" alt=\"\" class=\"dijitIcon dijitMenuItemIcon\" data-dojo-attach-point=\"iconNode\"/>\n\t</td>\n\t<td class=\"dijitReset dijitMenuItemLabel\" colspan=\"2\" data-dojo-attach-point=\"containerNode\"></td>\n\t<td class=\"dijitReset dijitMenuItemAccelKey\" style=\"display: none\" data-dojo-attach-point=\"accelKeyNode\"></td>\n\t<td class=\"dijitReset dijitMenuArrowCell\" role=\"presentation\">\n\t\t<div data-dojo-attach-point=\"arrowWrapper\" style=\"visibility: hidden\">\n\t\t\t<img src=\"${_blankGif}\" alt=\"\" class=\"dijitMenuExpand\"/>\n\t\t\t<span class=\"dijitMenuExpandA11y\">+</span>\n\t\t</div>\n\t</td>\n</tr>\n"}});
define("dijit/MenuItem",["dojo/_base/declare","dojo/dom","dojo/dom-attr","dojo/dom-class","dojo/_base/kernel","dojo/sniff","./_Widget","./_TemplatedMixin","./_Contained","./_CssStateMixin","dojo/text!./templates/MenuItem.html"],function(_119d,dom,_119e,_119f,_11a0,has,_11a1,_11a2,_11a3,_11a4,_11a5){
return _119d("dijit.MenuItem",[_11a1,_11a2,_11a3,_11a4],{templateString:_11a5,baseClass:"dijitMenuItem",label:"",_setLabelAttr:function(val){
this.containerNode.innerHTML=val;
this._set("label",val);
if(this.textDir==="auto"){
this.applyTextDir(this.focusNode,this.label);
}
},iconClass:"dijitNoIcon",_setIconClassAttr:{node:"iconNode",type:"class"},accelKey:"",disabled:false,_fillContent:function(_11a6){
if(_11a6&&!("label" in this.params)){
this.set("label",_11a6.innerHTML);
}
},buildRendering:function(){
this.inherited(arguments);
var label=this.id+"_text";
_119e.set(this.containerNode,"id",label);
if(this.accelKeyNode){
_119e.set(this.accelKeyNode,"id",this.id+"_accel");
label+=" "+this.id+"_accel";
}
this.domNode.setAttribute("aria-labelledby",label);
dom.setSelectable(this.domNode,false);
},onClick:function(){
},focus:function(){
try{
if(has("ie")==8){
this.containerNode.focus();
}
this.focusNode.focus();
}
catch(e){
}
},_onFocus:function(){
this._setSelected(true);
this.getParent()._onItemFocus(this);
this.inherited(arguments);
},_setSelected:function(_11a7){
_119f.toggle(this.domNode,"dijitMenuItemSelected",_11a7);
},setLabel:function(_11a8){
_11a0.deprecated("dijit.MenuItem.setLabel() is deprecated.  Use set('label', ...) instead.","","2.0");
this.set("label",_11a8);
},setDisabled:function(_11a9){
_11a0.deprecated("dijit.Menu.setDisabled() is deprecated.  Use set('disabled', bool) instead.","","2.0");
this.set("disabled",_11a9);
},_setDisabledAttr:function(value){
this.focusNode.setAttribute("aria-disabled",value?"true":"false");
this._set("disabled",value);
},_setAccelKeyAttr:function(value){
this.accelKeyNode.style.display=value?"":"none";
this.accelKeyNode.innerHTML=value;
_119e.set(this.containerNode,"colSpan",value?"1":"2");
this._set("accelKey",value);
},_setTextDirAttr:function(_11aa){
if(!this._created||this.textDir!=_11aa){
this._set("textDir",_11aa);
this.applyTextDir(this.focusNode,this.label);
}
}});
});
},"url:davinci/ui/templates/ThemeSetsRenameDialog.html":"<div>\n\t<div class=\"dijitDialogPaneContentArea\">\n\t\t${uiNLS.themeSetName} <input data-dojo-type=\"dijit.form.ValidationTextBox\" data-dojo-props=\"regExp:'[a-zA-z0-9_]+', required:true, invalidMessage:'Invalid Text.'\" id=\"theme_select_themeset_rename_textbox\" style=\"width: 175px;\"/>\n\t</div>\n\n\t<div class=\"dijitDialogPaneActionBar\">\n\t\t<button type=\"button\" dojoType=\"dijit.form.Button\" id=\"theme_set_rename_ok_button\" label=\"${uiNLS.renameButtonLabel}\" class=\"maqPrimaryButton\" type=\"submit\"></button>\n\t\t<button type=\"button\" dojoType=\"dijit.form.Button\" id=\"theme_set_rename_cancel_button\" label=\"${commonNLS.buttonCancel}\" class=\"maqSecondaryButton\"></button>\n\t</div>\n</div>\n","dijit/layout/_TabContainerBase":function(){
require({cache:{"url:dijit/layout/templates/TabContainer.html":"<div class=\"dijitTabContainer\">\n\t<div class=\"dijitTabListWrapper\" data-dojo-attach-point=\"tablistNode\"></div>\n\t<div data-dojo-attach-point=\"tablistSpacer\" class=\"dijitTabSpacer ${baseClass}-spacer\"></div>\n\t<div class=\"dijitTabPaneWrapper ${baseClass}-container\" data-dojo-attach-point=\"containerNode\"></div>\n</div>\n"}});
define("dijit/layout/_TabContainerBase",["dojo/text!./templates/TabContainer.html","./StackContainer","./utils","../_TemplatedMixin","dojo/_base/declare","dojo/dom-class","dojo/dom-geometry","dojo/dom-style"],function(_11ab,_11ac,_11ad,_11ae,_11af,_11b0,_11b1,_11b2){
return _11af("dijit.layout._TabContainerBase",[_11ac,_11ae],{tabPosition:"top",baseClass:"dijitTabContainer",tabStrip:false,nested:false,templateString:_11ab,postMixInProperties:function(){
this.baseClass+=this.tabPosition.charAt(0).toUpperCase()+this.tabPosition.substr(1).replace(/-.*/,"");
this.srcNodeRef&&_11b2.set(this.srcNodeRef,"visibility","hidden");
this.inherited(arguments);
},buildRendering:function(){
this.inherited(arguments);
this.tablist=this._makeController(this.tablistNode);
if(!this.doLayout){
_11b0.add(this.domNode,"dijitTabContainerNoLayout");
}
if(this.nested){
_11b0.add(this.domNode,"dijitTabContainerNested");
_11b0.add(this.tablist.containerNode,"dijitTabContainerTabListNested");
_11b0.add(this.tablistSpacer,"dijitTabContainerSpacerNested");
_11b0.add(this.containerNode,"dijitTabPaneWrapperNested");
}else{
_11b0.add(this.domNode,"tabStrip-"+(this.tabStrip?"enabled":"disabled"));
}
},_setupChild:function(tab){
_11b0.add(tab.domNode,"dijitTabPane");
this.inherited(arguments);
},startup:function(){
if(this._started){
return;
}
this.tablist.startup();
this.inherited(arguments);
},layout:function(){
if(!this._contentBox||typeof (this._contentBox.l)=="undefined"){
return;
}
var sc=this.selectedChildWidget;
if(this.doLayout){
var _11b3=this.tabPosition.replace(/-h/,"");
this.tablist.layoutAlign=_11b3;
var _11b4=[this.tablist,{domNode:this.tablistSpacer,layoutAlign:_11b3},{domNode:this.containerNode,layoutAlign:"client"}];
_11ad.layoutChildren(this.domNode,this._contentBox,_11b4);
this._containerContentBox=_11ad.marginBox2contentBox(this.containerNode,_11b4[2]);
if(sc&&sc.resize){
sc.resize(this._containerContentBox);
}
}else{
if(this.tablist.resize){
var s=this.tablist.domNode.style;
s.width="0";
var width=_11b1.getContentBox(this.domNode).w;
s.width="";
this.tablist.resize({w:width});
}
if(sc&&sc.resize){
sc.resize();
}
}
},destroy:function(){
if(this.tablist){
this.tablist.destroy();
}
this.inherited(arguments);
}});
});
},"dijit/Dialog":function(){
require({cache:{"url:dijit/templates/Dialog.html":"<div class=\"dijitDialog\" role=\"dialog\" aria-labelledby=\"${id}_title\">\n\t<div data-dojo-attach-point=\"titleBar\" class=\"dijitDialogTitleBar\">\n\t\t<span data-dojo-attach-point=\"titleNode\" class=\"dijitDialogTitle\" id=\"${id}_title\"\n\t\t\t\trole=\"header\" level=\"1\"></span>\n\t\t<span data-dojo-attach-point=\"closeButtonNode\" class=\"dijitDialogCloseIcon\" data-dojo-attach-event=\"ondijitclick: onCancel\" title=\"${buttonCancel}\" role=\"button\" tabIndex=\"-1\">\n\t\t\t<span data-dojo-attach-point=\"closeText\" class=\"closeText\" title=\"${buttonCancel}\">x</span>\n\t\t</span>\n\t</div>\n\t<div data-dojo-attach-point=\"containerNode\" class=\"dijitDialogPaneContent\"></div>\n</div>\n"}});
define("dijit/Dialog",["require","dojo/_base/array","dojo/_base/connect","dojo/_base/declare","dojo/_base/Deferred","dojo/dom","dojo/dom-class","dojo/dom-geometry","dojo/dom-style","dojo/_base/event","dojo/_base/fx","dojo/i18n","dojo/keys","dojo/_base/lang","dojo/on","dojo/ready","dojo/sniff","dojo/window","dojo/dnd/Moveable","dojo/dnd/TimedMoveable","./focus","./_base/manager","./_Widget","./_TemplatedMixin","./_CssStateMixin","./form/_FormMixin","./_DialogMixin","./DialogUnderlay","./layout/ContentPane","dojo/text!./templates/Dialog.html","./main","dojo/i18n!./nls/common"],function(_11b5,array,_11b6,_11b7,_11b8,dom,_11b9,_11ba,_11bb,event,fx,i18n,keys,lang,on,ready,has,_11bc,_11bd,_11be,focus,_11bf,_11c0,_11c1,_11c2,_11c3,_11c4,_11c5,_11c6,_11c7,dijit){
var _11c8=_11b7("dijit._DialogBase",[_11c1,_11c3,_11c4,_11c2],{templateString:_11c7,baseClass:"dijitDialog",cssStateNodes:{closeButtonNode:"dijitDialogCloseIcon"},_setTitleAttr:[{node:"titleNode",type:"innerHTML"},{node:"titleBar",type:"attribute"}],open:false,duration:_11bf.defaultDuration,refocus:true,autofocus:true,_firstFocusItem:null,_lastFocusItem:null,doLayout:false,draggable:true,_setDraggableAttr:function(val){
this._set("draggable",val);
},"aria-describedby":"",maxRatio:0.9,postMixInProperties:function(){
var _11c9=i18n.getLocalization("dijit","common");
lang.mixin(this,_11c9);
this.inherited(arguments);
},postCreate:function(){
_11bb.set(this.domNode,{display:"none",position:"absolute"});
this.ownerDocumentBody.appendChild(this.domNode);
this.inherited(arguments);
this.connect(this,"onExecute","hide");
this.connect(this,"onCancel","hide");
this._modalconnects=[];
},onLoad:function(){
this._position();
if(this.autofocus&&_11ca.isTop(this)){
this._getFocusItems(this.domNode);
focus.focus(this._firstFocusItem);
}
this.inherited(arguments);
},_endDrag:function(){
var _11cb=_11ba.position(this.domNode),_11cc=_11bc.getBox(this.ownerDocument);
_11cb.y=Math.min(Math.max(_11cb.y,0),(_11cc.h-_11cb.h));
_11cb.x=Math.min(Math.max(_11cb.x,0),(_11cc.w-_11cb.w));
this._relativePosition=_11cb;
this._position();
},_setup:function(){
var node=this.domNode;
if(this.titleBar&&this.draggable){
this._moveable=new ((has("ie")==6)?_11be:_11bd)(node,{handle:this.titleBar});
this.connect(this._moveable,"onMoveStop","_endDrag");
}else{
_11b9.add(node,"dijitDialogFixed");
}
this.underlayAttrs={dialogId:this.id,"class":array.map(this["class"].split(/\s/),function(s){
return s+"_underlay";
}).join(" "),ownerDocument:this.ownerDocument};
},_size:function(){
this._checkIfSingleChild();
if(this._singleChild){
if(typeof this._singleChildOriginalStyle!="undefined"){
this._singleChild.domNode.style.cssText=this._singleChildOriginalStyle;
delete this._singleChildOriginalStyle;
}
}else{
_11bb.set(this.containerNode,{width:"auto",height:"auto"});
}
var bb=_11ba.position(this.domNode);
var _11cd=_11bc.getBox(this.ownerDocument);
_11cd.w*=this.maxRatio;
_11cd.h*=this.maxRatio;
if(bb.w>=_11cd.w||bb.h>=_11cd.h){
var _11ce=_11ba.position(this.containerNode),w=Math.min(bb.w,_11cd.w)-(bb.w-_11ce.w),h=Math.min(bb.h,_11cd.h)-(bb.h-_11ce.h);
if(this._singleChild&&this._singleChild.resize){
if(typeof this._singleChildOriginalStyle=="undefined"){
this._singleChildOriginalStyle=this._singleChild.domNode.style.cssText;
}
this._singleChild.resize({w:w,h:h});
}else{
_11bb.set(this.containerNode,{width:w+"px",height:h+"px",overflow:"auto",position:"relative"});
}
}else{
if(this._singleChild&&this._singleChild.resize){
this._singleChild.resize();
}
}
},_position:function(){
if(!_11b9.contains(this.ownerDocumentBody,"dojoMove")){
var node=this.domNode,_11cf=_11bc.getBox(this.ownerDocument),p=this._relativePosition,bb=p?null:_11ba.position(node),l=Math.floor(_11cf.l+(p?p.x:(_11cf.w-bb.w)/2)),t=Math.floor(_11cf.t+(p?p.y:(_11cf.h-bb.h)/2));
_11bb.set(node,{left:l+"px",top:t+"px"});
}
},_onKey:function(evt){
if(evt.charOrCode){
var node=evt.target;
if(evt.charOrCode===keys.TAB){
this._getFocusItems(this.domNode);
}
var _11d0=(this._firstFocusItem==this._lastFocusItem);
if(node==this._firstFocusItem&&evt.shiftKey&&evt.charOrCode===keys.TAB){
if(!_11d0){
focus.focus(this._lastFocusItem);
}
event.stop(evt);
}else{
if(node==this._lastFocusItem&&evt.charOrCode===keys.TAB&&!evt.shiftKey){
if(!_11d0){
focus.focus(this._firstFocusItem);
}
event.stop(evt);
}else{
while(node){
if(node==this.domNode||_11b9.contains(node,"dijitPopup")){
if(evt.charOrCode==keys.ESCAPE){
this.onCancel();
}else{
return;
}
}
node=node.parentNode;
}
if(evt.charOrCode!==keys.TAB){
event.stop(evt);
}else{
if(!has("opera")){
try{
this._firstFocusItem.focus();
}
catch(e){
}
}
}
}
}
}
},show:function(){
if(this.open){
return;
}
if(!this._started){
this.startup();
}
if(!this._alreadyInitialized){
this._setup();
this._alreadyInitialized=true;
}
if(this._fadeOutDeferred){
this._fadeOutDeferred.cancel();
}
var win=_11bc.get(this.ownerDocument);
this._modalconnects.push(on(win,"scroll",lang.hitch(this,"resize")));
this._modalconnects.push(on(this.domNode,_11b6._keypress,lang.hitch(this,"_onKey")));
_11bb.set(this.domNode,{opacity:0,display:""});
this._set("open",true);
this._onShow();
this._size();
this._position();
var _11d1;
this._fadeInDeferred=new _11b8(lang.hitch(this,function(){
_11d1.stop();
delete this._fadeInDeferred;
}));
_11d1=fx.fadeIn({node:this.domNode,duration:this.duration,beforeBegin:lang.hitch(this,function(){
_11ca.show(this,this.underlayAttrs);
}),onEnd:lang.hitch(this,function(){
if(this.autofocus&&_11ca.isTop(this)){
this._getFocusItems(this.domNode);
focus.focus(this._firstFocusItem);
}
this._fadeInDeferred.resolve(true);
delete this._fadeInDeferred;
})}).play();
return this._fadeInDeferred;
},hide:function(){
if(!this._alreadyInitialized||!this.open){
return;
}
if(this._fadeInDeferred){
this._fadeInDeferred.cancel();
}
var _11d2;
this._fadeOutDeferred=new _11b8(lang.hitch(this,function(){
_11d2.stop();
delete this._fadeOutDeferred;
}));
this._fadeOutDeferred.then(lang.hitch(this,"onHide"));
_11d2=fx.fadeOut({node:this.domNode,duration:this.duration,onEnd:lang.hitch(this,function(){
this.domNode.style.display="none";
_11ca.hide(this);
this._fadeOutDeferred.resolve(true);
delete this._fadeOutDeferred;
})}).play();
if(this._scrollConnected){
this._scrollConnected=false;
}
var h;
while(h=this._modalconnects.pop()){
h.remove();
}
if(this._relativePosition){
delete this._relativePosition;
}
this._set("open",false);
return this._fadeOutDeferred;
},resize:function(){
if(this.domNode.style.display!="none"){
if(_11c5._singleton){
_11c5._singleton.layout();
}
this._position();
this._size();
}
},destroy:function(){
if(this._fadeInDeferred){
this._fadeInDeferred.cancel();
}
if(this._fadeOutDeferred){
this._fadeOutDeferred.cancel();
}
if(this._moveable){
this._moveable.destroy();
}
var h;
while(h=this._modalconnects.pop()){
h.remove();
}
_11ca.hide(this);
this.inherited(arguments);
}});
var _11d3=_11b7("dijit.Dialog",[_11c6,_11c8],{});
_11d3._DialogBase=_11c8;
var _11ca=_11d3._DialogLevelManager={_beginZIndex:950,show:function(_11d4,_11d5){
ds[ds.length-1].focus=focus.curNode;
var _11d6=_11c5._singleton;
if(!_11d6||_11d6._destroyed){
_11d6=dijit._underlay=_11c5._singleton=new _11c5(_11d5);
}else{
_11d6.set(_11d4.underlayAttrs);
}
var _11d7=ds[ds.length-1].dialog?ds[ds.length-1].zIndex+2:_11d3._DialogLevelManager._beginZIndex;
if(ds.length==1){
_11d6.show();
}
_11bb.set(_11c5._singleton.domNode,"zIndex",_11d7-1);
_11bb.set(_11d4.domNode,"zIndex",_11d7);
ds.push({dialog:_11d4,underlayAttrs:_11d5,zIndex:_11d7});
},hide:function(_11d8){
if(ds[ds.length-1].dialog==_11d8){
ds.pop();
var pd=ds[ds.length-1];
if(!_11c5._singleton._destroyed){
if(ds.length==1){
_11c5._singleton.hide();
}else{
_11bb.set(_11c5._singleton.domNode,"zIndex",pd.zIndex-1);
_11c5._singleton.set(pd.underlayAttrs);
}
}
if(_11d8.refocus){
var focus=pd.focus;
if(pd.dialog&&(!focus||!dom.isDescendant(focus,pd.dialog.domNode))){
pd.dialog._getFocusItems(pd.dialog.domNode);
focus=pd.dialog._firstFocusItem;
}
if(focus){
try{
focus.focus();
}
catch(e){
}
}
}
}else{
var idx=array.indexOf(array.map(ds,function(elem){
return elem.dialog;
}),_11d8);
if(idx!=-1){
ds.splice(idx,1);
}
}
},isTop:function(_11d9){
return ds[ds.length-1].dialog==_11d9;
}};
var ds=_11d3._dialogStack=[{dialog:null,focus:null,underlayAttrs:null}];
if(has("dijit-legacy-requires")){
ready(0,function(){
var _11da=["dijit/TooltipDialog"];
_11b5(_11da);
});
}
return _11d3;
});
},"davinci/ve/widgets/ChangeWillModify":function(){
define(["dojo/_base/declare","dijit/_WidgetBase","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","dojo/i18n!../nls/ve","dojo/i18n!davinci/ui/nls/ui","dojo/text!./templates/ChangeWillModify.html","dijit/form/CheckBox",],function(_11db,_11dc,_11dd,_11de,veNLS,uiNLS,_11df){
return _11db([_11dc,_11dd,_11de],{templateString:_11df,langObj:veNLS,uiNLS:uiNLS,buildRendering:function(){
var _11e0="<a href='app/docs/index.html#CreatingStyleRulesWithAppCss' target='_blank'>"+veNLS.creatingStyleRules+"</a>";
this.insteadOfChanging=dojo.string.substitute(veNLS.insteadOfChanging,[_11e0]);
this.inherited(arguments);
},postCreate:function(){
}});
});
},"url:dijit/form/templates/ComboButton.html":"<table class=\"dijit dijitReset dijitInline dijitLeft\"\n\tcellspacing='0' cellpadding='0' role=\"presentation\"\n\t><tbody role=\"presentation\"><tr role=\"presentation\"\n\t\t><td class=\"dijitReset dijitStretch dijitButtonNode\" data-dojo-attach-point=\"buttonNode\" data-dojo-attach-event=\"ondijitclick:_onClick,onkeypress:_onButtonKeyPress\"\n\t\t><div id=\"${id}_button\" class=\"dijitReset dijitButtonContents\"\n\t\t\tdata-dojo-attach-point=\"titleNode\"\n\t\t\trole=\"button\" aria-labelledby=\"${id}_label\"\n\t\t\t><div class=\"dijitReset dijitInline dijitIcon\" data-dojo-attach-point=\"iconNode\" role=\"presentation\"></div\n\t\t\t><div class=\"dijitReset dijitInline dijitButtonText\" id=\"${id}_label\" data-dojo-attach-point=\"containerNode\" role=\"presentation\"></div\n\t\t></div\n\t\t></td\n\t\t><td id=\"${id}_arrow\" class='dijitReset dijitRight dijitButtonNode dijitArrowButton'\n\t\t\tdata-dojo-attach-point=\"_popupStateNode,focusNode,_buttonNode\"\n\t\t\tdata-dojo-attach-event=\"onkeypress:_onArrowKeyPress\"\n\t\t\ttitle=\"${optionsTitle}\"\n\t\t\trole=\"button\" aria-haspopup=\"true\"\n\t\t\t><div class=\"dijitReset dijitArrowButtonInner\" role=\"presentation\"></div\n\t\t\t><div class=\"dijitReset dijitArrowButtonChar\" role=\"presentation\">&#9660;</div\n\t\t></td\n\t\t><td style=\"display:none !important;\"\n\t\t\t><input ${!nameAttrSetting} type=\"${type}\" value=\"${value}\" data-dojo-attach-point=\"valueNode\" role=\"presentation\"\n\t\t/></td></tr></tbody\n></table>\n","davinci/ve/actions/ViewSourceMenuAction":function(){
define(["dojo/_base/declare","davinci/ve/actions/ContextAction"],function(_11e1,_11e2){
return _11e1("davinci.ve.actions.ViewSourceMenuAction",[_11e2],{run:function(_11e3){
_11e3=this.fixupContext(_11e3);
if(_11e3&&_11e3.editor&&_11e3.editor.switchDisplayModeSource){
_11e3.editor.switchDisplayModeSource();
}
}});
});
},"davinci/css":function(){
define("davinci/css",["dojo/_base/window","dojo/dom-construct","dojo/dom-attr"],function(_11e4,_11e5){
var head=_11e4.doc.getElementsByTagName("head")[0],cache={};
return {load:function(id,_11e6,_11e7){
var url=_11e6.toUrl(id);
if(url in cache){
_11e7();
return;
}
_11e5.create("link",{rel:"stylesheet",type:"text/css",href:url},head);
cache[url]=1;
_11e7();
}};
});
},"davinci/ve/actions/OtherAction":function(){
define("davinci/ve/actions/OtherAction",["dojo/_base/declare","./_ReorderAction","davinci/commands/CompoundCommand","davinci/ve/commands/ReparentCommand"],function(_11e8,_11e9,_11ea,_11eb){
return _11e8("davinci.ve.actions.OtherAction",[_11e9],{run:function(_11ec){
},isEnabled:function(_11ed){
return true;
},shouldShow:function(_11ee){
_11ee=this.fixupContext(_11ee);
var _11ef=_11ee?_11ee.editor:null;
return (_11ef&&_11ef.declaredClass=="davinci.ve.PageEditor");
}});
});
},"orion/textview/tooltip":function(){
define("orion/textview/tooltip",["i18n!orion/textview/nls/messages","orion/textview/textView","orion/textview/textModel","orion/textview/projectionTextModel"],function(_11f0,_11f1,_11f2,_11f3){
function _11f4(view){
this._view=view;
this._create(view.getOptions("parent").ownerDocument);
view.addEventListener("Destroy",this,this.destroy);
};
_11f4.getTooltip=function(view){
if(!view._tooltip){
view._tooltip=new _11f4(view);
}
return view._tooltip;
};
_11f4.prototype={_create:function(_11f5){
if(this._tooltipDiv){
return;
}
var _11f6=this._tooltipDiv=_11f5.createElement("DIV");
_11f6.className="textviewTooltip";
_11f6.setAttribute("aria-live","assertive");
_11f6.setAttribute("aria-atomic","true");
var _11f7=this._tooltipContents=_11f5.createElement("DIV");
_11f6.appendChild(_11f7);
_11f5.body.appendChild(_11f6);
this.hide();
},destroy:function(){
if(!this._tooltipDiv){
return;
}
this.hide();
var _11f8=this._tooltipDiv.parentNode;
if(_11f8){
_11f8.removeChild(this._tooltipDiv);
}
this._tooltipDiv=null;
},hide:function(){
if(this._contentsView){
this._contentsView.destroy();
this._contentsView=null;
}
if(this._tooltipContents){
this._tooltipContents.innerHTML="";
}
if(this._tooltipDiv){
this._tooltipDiv.style.visibility="hidden";
}
if(this._showTimeout){
clearTimeout(this._showTimeout);
this._showTimeout=null;
}
if(this._hideTimeout){
clearTimeout(this._hideTimeout);
this._hideTimeout=null;
}
if(this._fadeTimeout){
clearInterval(this._fadeTimeout);
this._fadeTimeout=null;
}
},isVisible:function(){
return this._tooltipDiv&&this._tooltipDiv.style.visibility==="visible";
},setTarget:function(_11f9,delay){
if(this.target===_11f9){
return;
}
this._target=_11f9;
this.hide();
if(_11f9){
var self=this;
if(delay===0){
self.show(true);
}else{
self._showTimeout=setTimeout(function(){
self.show(true);
},delay?delay:500);
}
}
},show:function(_11fa){
if(!this._target){
return;
}
var info=this._target.getTooltipInfo();
if(!info){
return;
}
var _11fb=this._tooltipDiv,_11fc=this._tooltipContents;
_11fb.style.left=_11fb.style.right=_11fb.style.width=_11fb.style.height=_11fc.style.width=_11fc.style.height="auto";
var _11fd=info.contents;
if(_11fd instanceof Array){
_11fd=this._getAnnotationContents(_11fd);
}
if(typeof _11fd==="string"){
_11fc.innerHTML=_11fd;
}else{
if(this._isNode(_11fd)){
_11fc.appendChild(_11fd);
}else{
if(_11fd instanceof _11f3.ProjectionTextModel){
var view=this._view;
var _11fe=view.getOptions();
_11fe.parent=_11fc;
var _11ff="tooltip";
var theme=_11fe.themeClass;
if(theme){
theme=theme.replace(_11ff,"");
if(theme){
theme=" "+theme;
}
theme=_11ff+theme;
}else{
theme=_11ff;
}
_11fe.themeClass=theme;
var _1200=this._contentsView=new _11f1.TextView(_11fe);
_1200._clientDiv.contentEditable=false;
var _1201={onLineStyle:function(e){
view.onLineStyle(e);
}};
_1200.addEventListener("LineStyle",_1201.onLineStyle);
_1200.setModel(_11fd);
var size=_1200.computeSize();
_11fc.style.width=(size.width+20)+"px";
_11fc.style.height=size.height+"px";
_1200.resize();
}else{
return;
}
}
}
var _1202=_11fb.ownerDocument.documentElement;
if(info.anchor==="right"){
var right=_1202.clientWidth-info.x;
_11fb.style.right=right+"px";
_11fb.style.maxWidth=(_1202.clientWidth-right-10)+"px";
}else{
var left=parseInt(this._getNodeStyle(_11fb,"padding-left","0"),10);
left+=parseInt(this._getNodeStyle(_11fb,"border-left-width","0"),10);
left=info.x-left;
_11fb.style.left=left+"px";
_11fb.style.maxWidth=(_1202.clientWidth-left-10)+"px";
}
var top=parseInt(this._getNodeStyle(_11fb,"padding-top","0"),10);
top+=parseInt(this._getNodeStyle(_11fb,"border-top-width","0"),10);
top=info.y-top;
_11fb.style.top=top+"px";
_11fb.style.maxHeight=(_1202.clientHeight-top-10)+"px";
_11fb.style.opacity="1";
_11fb.style.visibility="visible";
if(_11fa){
var self=this;
self._hideTimeout=setTimeout(function(){
var _1203=parseFloat(self._getNodeStyle(_11fb,"opacity","1"));
self._fadeTimeout=setInterval(function(){
if(_11fb.style.visibility==="visible"&&_1203>0){
_1203-=0.1;
_11fb.style.opacity=_1203;
return;
}
self.hide();
},50);
},5000);
}
},_getAnnotationContents:function(_1204){
if(_1204.length===0){
return null;
}
var model=this._view.getModel(),_1205;
var _1206=model.getBaseModel?model.getBaseModel():model;
function _1207(start,end){
var _1208=_1206.getLineStart(_1206.getLineAtOffset(start));
var _1209=_1206.getLineEnd(_1206.getLineAtOffset(end),true);
return _1206.getText(_1208,_1209);
};
function _120a(_120b){
var title=_120b.title;
if(title===""){
return null;
}
var _120c="<div>";
if(_120b.html){
_120c+=_120b.html+"&nbsp;";
}
if(!title){
title=_1207(_120b.start,_120b.end);
}
title=title.replace(/</g,"&lt;").replace(/>/g,"&gt;");
_120c+="<span style='vertical-align:middle;'>"+title+"</span><div>";
return _120c;
};
if(_1204.length===1){
_1205=_1204[0];
if(_1205.title!==undefined){
return _120a(_1205);
}else{
var _120d=new _11f3.ProjectionTextModel(_1206);
var _120e=_1206.getLineStart(_1206.getLineAtOffset(_1205.start));
var _120f=_1206.getCharCount();
if(_1205.end!==_120f){
_120d.addProjection({start:_1205.end,end:_120f});
}
if(_120e>0){
_120d.addProjection({start:0,end:_120e});
}
return _120d;
}
}else{
var _1210="<div><em>"+_11f0.multipleAnnotations+"</em></div>";
for(var i=0;i<_1204.length;i++){
_1205=_1204[i];
var html=_120a(_1205);
if(html){
_1210+=html;
}
}
return _1210;
}
},_getNodeStyle:function(node,prop,_1211){
var value;
if(node){
value=node.style[prop];
if(!value){
if(node.currentStyle){
var index=0,p=prop;
while((index=p.indexOf("-",index))!==-1){
p=p.substring(0,index)+p.substring(index+1,index+2).toUpperCase()+p.substring(index+2);
}
value=node.currentStyle[p];
}else{
var css=node.ownerDocument.defaultView.getComputedStyle(node,null);
value=css?css.getPropertyValue(prop):null;
}
}
}
return value||_1211;
},_isNode:function(obj){
return typeof Node==="object"?obj instanceof Node:obj&&typeof obj==="object"&&typeof obj.nodeType==="number"&&typeof obj.nodeName==="string";
}};
return {Tooltip:_11f4};
});
},"dijit/TooltipDialog":function(){
require({cache:{"url:dijit/templates/TooltipDialog.html":"<div role=\"presentation\" tabIndex=\"-1\">\n\t<div class=\"dijitTooltipContainer\" role=\"presentation\">\n\t\t<div class =\"dijitTooltipContents dijitTooltipFocusNode\" data-dojo-attach-point=\"containerNode\" role=\"dialog\"></div>\n\t</div>\n\t<div class=\"dijitTooltipConnector\" role=\"presentation\" data-dojo-attach-point=\"connectorNode\"></div>\n</div>\n"}});
define("dijit/TooltipDialog",["dojo/_base/declare","dojo/dom-class","dojo/_base/event","dojo/keys","dojo/_base/lang","./focus","./layout/ContentPane","./_DialogMixin","./form/_FormMixin","./_TemplatedMixin","dojo/text!./templates/TooltipDialog.html","./main"],function(_1212,_1213,event,keys,lang,focus,_1214,_1215,_1216,_1217,_1218,dijit){
return _1212("dijit.TooltipDialog",[_1214,_1217,_1216,_1215],{title:"",doLayout:false,autofocus:true,baseClass:"dijitTooltipDialog",_firstFocusItem:null,_lastFocusItem:null,templateString:_1218,_setTitleAttr:function(title){
this.containerNode.title=title;
this._set("title",title);
},postCreate:function(){
this.inherited(arguments);
this.connect(this.containerNode,"onkeypress","_onKey");
},orient:function(node,_1219,_121a){
var newC={"MR-ML":"dijitTooltipRight","ML-MR":"dijitTooltipLeft","TM-BM":"dijitTooltipAbove","BM-TM":"dijitTooltipBelow","BL-TL":"dijitTooltipBelow dijitTooltipABLeft","TL-BL":"dijitTooltipAbove dijitTooltipABLeft","BR-TR":"dijitTooltipBelow dijitTooltipABRight","TR-BR":"dijitTooltipAbove dijitTooltipABRight","BR-BL":"dijitTooltipRight","BL-BR":"dijitTooltipLeft"}[_1219+"-"+_121a];
_1213.replace(this.domNode,newC,this._currentOrientClass||"");
this._currentOrientClass=newC;
},focus:function(){
this._getFocusItems(this.containerNode);
focus.focus(this._firstFocusItem);
},onOpen:function(pos){
this.orient(this.domNode,pos.aroundCorner,pos.corner);
var _121b=pos.aroundNodePos;
if(pos.corner.charAt(0)=="M"&&pos.aroundCorner.charAt(0)=="M"){
this.connectorNode.style.top=_121b.y+((_121b.h-this.connectorNode.offsetHeight)>>1)-pos.y+"px";
this.connectorNode.style.left="";
}else{
if(pos.corner.charAt(1)=="M"&&pos.aroundCorner.charAt(1)=="M"){
this.connectorNode.style.left=_121b.x+((_121b.w-this.connectorNode.offsetWidth)>>1)-pos.x+"px";
}
}
this._onShow();
},onClose:function(){
this.onHide();
},_onKey:function(evt){
var node=evt.target;
if(evt.charOrCode===keys.TAB){
this._getFocusItems(this.containerNode);
}
var _121c=(this._firstFocusItem==this._lastFocusItem);
if(evt.charOrCode==keys.ESCAPE){
this.defer("onCancel");
event.stop(evt);
}else{
if(node==this._firstFocusItem&&evt.shiftKey&&evt.charOrCode===keys.TAB){
if(!_121c){
focus.focus(this._lastFocusItem);
}
event.stop(evt);
}else{
if(node==this._lastFocusItem&&evt.charOrCode===keys.TAB&&!evt.shiftKey){
if(!_121c){
focus.focus(this._firstFocusItem);
}
event.stop(evt);
}else{
if(evt.charOrCode===keys.TAB){
evt.stopPropagation();
}
}
}
}
}});
});
},"davinci/ve/widgets/FontDataStore":function(){
define(["dojo/_base/declare","dojo/data/ItemFileReadStore","dojo/i18n!davinci/ve/nls/ve","dojo/i18n!dijit/nls/common"],function(_121d,_121e){
var _121f=_121d("davinci.ve.widgets.FontDataStore",_121e,{_allValues:[],constructor:function(args){
this.setValues(args.values||davinci.ve.widgets.FontDataStore.fonts);
},setValues:function(_1220){
this._allValues=this._allValues.concat(_1220);
this._jsonData={label:"name",identifier:"value",items:this._allValues};
this._loadFinished=false;
},contains:function(value){
for(var i=0;i<this._allValues.length;i++){
if(this._allValues[i].value==value){
return i;
}
if(this._allValues[i].name==value){
return i;
}
}
return false;
},clearValues:function(){
this._allValues=[];
this._loadFinished=false;
},lookupValue:function(_1221){
var index=this.contains(_1221);
return this._allValues[index].value[0];
}});
return dojo.mixin(_121f,{fonts:[{name:"",value:""},{name:"Arial,Helvetica,sans-serif",value:"Arial,Helvetica,sans-serif"},{name:"'Arial Black,Gadget',sans-serif",value:"'Arial Black,Gadget',sans-serif"},{name:"'Comic Sans MS',cursive",value:"'Comic Sans MS',cursive"},{name:"'Courier New',Courier,monospace",value:"'Courier New',Courier,monospace"},{name:"Geneva,Tahoma,sans-serif",value:"Geneva,Tahoma,sans-serif"},{name:"Georgia,serif",value:"Georgia,serif"},{name:"'Helvetica,Trebuchet MS',sans-serif",value:"'Helvetica,Trebuchet MS',sans-serif"},{name:"Impact,Charcoal,sans-serif",value:"Impact,Charcoal,sans-serif"},{name:"'Lucida Console',Monaco,monospace",value:"'Lucida Console',Monaco,monospace"},{name:"'Lucida Sans Unicode','Lucida Grande',sans-serif",value:"'Lucida Sans Unicode','Lucida Grande',sans-serif"},{name:"'Lucida Console', Monaco, monospace",value:"'Lucida Console', Monaco, monospace"},{name:"'Palatino Linotype','Book Antiqua',Palatino,serif",value:"'Palatino Linotype','Book Antiqua',Palatino,serif"},{name:"Symbol",value:"Symbol"},{name:"Tahoma,Geneva,sans-serif",value:"Tahoma,Geneva,sans-serif"},{name:"'Times New Roman',Times,serif",value:"'Times New Roman',Times,serif"},{name:"'Trebuchet MS',Helvetica,sans-serif",value:"'Trebuchet MS',Helvetica,sans-serif"},{name:"Verdana,Geneva,sans-serif",value:"Verdana,Geneva,sans-serif"},{name:"Webdings",value:"Webdings"},{name:"Wingdings, 'Zapf Dingbats'",value:"Wingdings, 'Zapf Dingbats'"},{name:"'Zapf Dingbats', Wingdings",value:"'Zapf Dingbats', Wingdings"},{name:"sans-serif",value:"sans-serif"},{name:"serif",value:"serif"},{name:"monospace",value:"monospace"},{name:"cursive",value:"cursive"}]});
});
},"dijit/form/_SearchMixin":function(){
define("dijit/form/_SearchMixin",["dojo/data/util/filter","dojo/_base/declare","dojo/_base/event","dojo/keys","dojo/_base/lang","dojo/query","dojo/sniff","dojo/string","dojo/when","../registry"],function(_1222,_1223,event,keys,lang,query,has,_1224,when,_1225){
return _1223("dijit.form._SearchMixin",null,{pageSize:Infinity,store:null,fetchProperties:{},query:{},searchDelay:200,searchAttr:"name",queryExpr:"${0}*",ignoreCase:true,_abortQuery:function(){
if(this.searchTimer){
this.searchTimer=this.searchTimer.remove();
}
if(this._queryDeferHandle){
this._queryDeferHandle=this._queryDeferHandle.remove();
}
if(this._fetchHandle){
if(this._fetchHandle.abort){
this._cancelingQuery=true;
this._fetchHandle.abort();
this._cancelingQuery=false;
}
if(this._fetchHandle.cancel){
this._cancelingQuery=true;
this._fetchHandle.cancel();
this._cancelingQuery=false;
}
this._fetchHandle=null;
}
},_processInput:function(evt){
if(this.disabled||this.readOnly){
return;
}
var key=evt.charOrCode;
if(evt.altKey||((evt.ctrlKey||evt.metaKey)&&(key!="x"&&key!="v"))||key==keys.SHIFT){
return;
}
var _1226=false;
this._prev_key_backspace=false;
switch(key){
case keys.DELETE:
case keys.BACKSPACE:
this._prev_key_backspace=true;
this._maskValidSubsetError=true;
_1226=true;
break;
default:
_1226=typeof key=="string"||key==229;
}
if(_1226){
if(!this.store){
this.onSearch();
}else{
this.searchTimer=this.defer("_startSearchFromInput",1);
}
}
},onSearch:function(){
},_startSearchFromInput:function(){
this._startSearch(this.focusNode.value.replace(/([\\\*\?])/g,"\\$1"));
},_startSearch:function(text){
this._abortQuery();
var _1227=this,query=lang.clone(this.query),_1228={start:0,count:this.pageSize,queryOptions:{ignoreCase:this.ignoreCase,deep:true}},qs=_1224.substitute(this.queryExpr,[text]),q,_1229=function(){
var _122a=_1227._fetchHandle=_1227.store.query(query,_1228);
if(_1227.disabled||_1227.readOnly||(q!==_1227._lastQuery)){
return;
}
when(_122a,function(res){
_1227._fetchHandle=null;
if(!_1227.disabled&&!_1227.readOnly&&(q===_1227._lastQuery)){
when(_122a.total,function(total){
res.total=total;
var _122b=_1227.pageSize;
if(isNaN(_122b)||_122b>res.total){
_122b=res.total;
}
res.nextPage=function(_122c){
_1228.direction=_122c=_122c!==false;
_1228.count=_122b;
if(_122c){
_1228.start+=res.length;
if(_1228.start>=res.total){
_1228.count=0;
}
}else{
_1228.start-=_122b;
if(_1228.start<0){
_1228.count=Math.max(_122b+_1228.start,0);
_1228.start=0;
}
}
if(_1228.count<=0){
res.length=0;
_1227.onSearch(res,query,_1228);
}else{
_1229();
}
};
_1227.onSearch(res,query,_1228);
});
}
},function(err){
_1227._fetchHandle=null;
if(!_1227._cancelingQuery){
console.error(_1227.declaredClass+" "+err.toString());
}
});
};
lang.mixin(_1228,this.fetchProperties);
if(this.store._oldAPI){
q=qs;
}else{
q=_1222.patternToRegExp(qs,this.ignoreCase);
q.toString=function(){
return qs;
};
}
this._lastQuery=query[this.searchAttr]=q;
this._queryDeferHandle=this.defer(_1229,this.searchDelay);
},constructor:function(){
this.query={};
this.fetchProperties={};
},postMixInProperties:function(){
if(!this.store){
var list=this.list;
if(list){
this.store=_1225.byId(list);
}
}
this.inherited(arguments);
}});
});
},"davinci/review/widgets/PublishWizard":function(){
require({cache:{"url:davinci/review/widgets/templates/PublishWizard.html":"<div class='publishWizard'>\r\n\t<div class=\"dijitDialogPaneContentArea\">\r\n\t\t<div class='steps'>\r\n\t\t\t<div dojoAttachPoint=\"navPage1\" dojoAttachEvent=\"onclick:select\" class=\"crumbs current sep\">\r\n\t\t\t\t<div dojoAttachPoint=\"navPage1Icon\" class=\"done\"></div>\r\n\t\t\t\t1.${generalInfo}\r\n\t\t\t</div>\r\n\t\t\t<div dojoAttachPoint=\"navPage2\" dojoAttachEvent=\"onclick:select\" class=\"crumbs sep\">\r\n\t\t\t\t<div dojoAttachPoint=\"navPage2Icon\" class=\"todo\"></div>\r\n\t\t\t\t2.${selectRevFiles}\r\n\t\t\t</div>\r\n\t\t\t<div dojoAttachPoint=\"navPage3\" dojoAttachEvent=\"onclick:select\" class=\"crumbs\">\r\n\t\t\t\t<div dojoAttachPoint=\"navPage3Icon\" class=\"todo\"></div>\r\n\t\t\t\t3.${addReviewers}\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t\t<div dojoAttachPoint=\"reviewerStackContainer\" class='mainSection'>\r\n\t\t</div>\r\n\t\t<table cellspacing=\"10\" dojoAttachPoint=\"page1Node\">\r\n\t\t\t<tr>\r\n\t\t\t\t<td><label for=\"versionTitle\">${title}:</label></td>\r\n\t\t\t\t<td><input dojoAttachPoint=\"versionTitle\"></input></td>\r\n\t\t\t\t<td><input dojoAttachPoint=\"receiveEmail\"></input><label class='emailLabel' for=\"receiveEmail\">${notifyMe}</label></td>\r\n\t\t\t</tr>\r\n\t\t\t<tr>\r\n\t\t\t\t<td valign=\"top\"><label for=\"descriptions\">${description}:</label></td>\r\n\t\t\t\t<td colspan=\"2\"><input dojoAttachPoint=\"descriptions\"></input></td>\r\n\t\t\t</tr>\r\n\t\t\t<tr>\r\n\t\t\t\t<td><label>${windowSize}:</label></td>\r\n\t\t\t\t<td colspan=\"2\"><input dojoAttachPoint=\"desireWidth\"></input><label>*</label><input dojoAttachPoint=\"desireHeight\"/></td>\r\n\t\t\t</tr>\r\n\t\t\t<tr>\r\n\t\t\t\t<td><label for=\"dueDate\">${dueDate}:</label></td>\r\n\t\t\t\t<td><input dojoAttachPoint=\"dueDate\" /></td>\r\n\t\t\t\t<td class=\"review-tips\"><label>${leaveBlank}</label></td>\r\n\t\t\t</tr>\r\n\t\t</table>\r\n\t\t\r\n\t\t<table cellspacing=\"10\" dojoAttachPoint=\"page2Node\">\r\n\t\t\t<tr>\r\n\t\t\t\t<td>${availableFiles}:</td>\r\n\t\t\t\t<td></td>\r\n\t\t\t\t<td>${selectedFiles}:</td>\r\n\t\t\t</tr>\r\n\t\t\t<tr>\r\n\t\t\t\t<td>\r\n\t\t\t\t\t<div dojoAttachPoint=\"sourceTreeNode\" class='sourceTree'>\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</td>\r\n\t\t\t\t<td>\r\n\t\t\t\t\t<a href=\"javascript:void(0);\" dojoAttachEvent=\"onclick:addSelectFiles\"><img src=\"app/davinci/review/resources/img/forward_nav.gif\"/></a>\r\n\t\t\t\t</td>\r\n\t\t\t\t<td>\r\n\t\t\t\t\t<div dojoAttachPoint=\"targetTreeNode\" class='sourceTree'>\r\n\t\t\t\t\t\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</td>\r\n\t\t\t</tr>\r\n\t\t</table>\r\n\t\t\r\n\t\t<table cellspacing=\"10\" dojoAttachPoint=\"page3Node\">\r\n\t\t\t<tr valign=\"top\">\r\n\t\t\t\t<td align=\"left\" rowspan=2><div class='reviewers'>${reviewers}:</div></td>\r\n\t\t\t\t<td colspan=2><div dojoAttachPoint=\"userGrid\" class='reviewerList'></div></td>\r\n\t\t\t</tr>\r\n\t\t\t<tr>\r\n\t\t\t\t<td class='reviewerBox'>\r\n\t\t\t\t\t<div dojoAttachPoint=\"addReviewerCombox\"></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t<td align=\"left\"><button dojoAttachPoint=\"addReviewerButton\"></button></td>\r\n\t\t\t</tr>\r\n\t\t</table>\r\n\t</div>\r\n\r\n\t\t<div class='dijitDialogPaneActionBar dialogButtonContainerOverride'>\r\n\t\t\t<div dojoAttachPoint=\"reviewMsg\" class=\"reviewMsg\"></div>\r\n\t\t\t<a class='cancelButton' href=\"javascript:void(0);\" dojoAttachEvent=\"onclick:onClose\">${buttonCancel}</a>\r\n\t\t\t<button class='maqSecondaryButton' dojoAttachPoint=\"saveDt\">${saveAsDraft}</button>\r\n\t\t\t<button class='maqSecondaryButton' dojoAttachPoint=\"prev\">&lt ${back}</button>\r\n\t\t\t<button class='maqSecondaryButton' dojoAttachPoint=\"next\">${next} &gt</button>\r\n\t\t\t<button class='maqPrimaryButton' dojoAttachPoint=\"invite\">${publishReview}</button>\r\n\t\t</div>\r\n</div>","url:davinci/review/widgets/templates/MailFailureDialogContent.html":"<div>\r\n<div class='mailFailureInfo'>${inviteNotSent}</div>\r\n<div class='mailFailureExtraInfo'>${mailFailureMsg}</div>\r\n<div class='mailFailureContent'>${htmlContent}</div>\r\n</div>\r\n"}});
define("davinci/review/widgets/PublishWizard",["dojo/_base/declare","dijit/_WidgetBase","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","dijit/layout/StackContainer","dijit/layout/ContentPane","dijit/form/SimpleTextarea","dijit/form/NumberTextBox","dijit/form/ValidationTextBox","dijit/form/DateTextBox","dijit/form/Button","dijit/form/ComboBox","dojo/data/ItemFileWriteStore","dijit/form/CheckBox","dojox/grid/DataGrid","dojox/data/QueryReadStore","dojox/widget/Toaster","dojox/validate/regexp","dojo/string","dojo/fx","dojo/date/stamp","dijit/Tree","dojo/Deferred","dojo/promise/all","system/resource","davinci/Runtime","davinci/Workbench","davinci/model/resource/Folder","davinci/model/resource/File","davinci/review/model/resource/Empty","davinci/review/model/resource/root","dijit/tree/TreeStoreModel","davinci/review/model/store/GeneralReviewReadStore","dojo/i18n!./nls/widgets","dojo/i18n!dijit/nls/common","dojo/text!./templates/PublishWizard.html","dojo/text!./templates/MailFailureDialogContent.html"],function(_122d,_122e,_122f,_1230,_1231,_1232,_1233,_1234,_1235,_1236,_1237,_1238,_1239,_123a,_123b,_123c,_123d,_123e,_123f,_1240,stamp,Tree,_1241,all,_1242,_1243,_1244,_1245,File,Empty,_1246,_1247,_1248,_1249,_124a,_124b,_124c){
var _124d=_122d(dijit._TreeNode,{postCreate:function(){
this.inherited(arguments);
var _124e=dojo.create("img",{src:"app/dojo/resources/blank.gif","class":"deleteImg"});
dojo.connect(_124e,"onclick",this,dojo.hitch(this,function(){
dojo.publish("/davinci/review/deleteReviewFile",[this.item]);
}));
dojo.place(_124e,this.rowNode,"first");
dojo.style(this.rowNode,{width:"99%"});
dojo.style(this.containerNode,{display:"block"});
}});
var _124f=_122d(Tree,{_createTreeNode:function(args){
return new _124d(args);
}});
return _122d("davinci.review.widgets.PublishWizard",[_122e,_122f],{templateString:_124b,postMixInProperties:function(){
this.inherited(arguments);
dojo.mixin(this,_1249);
dojo.mixin(this,_124a);
},postCreate:function(){
var sc=this.reviewerStackContainer=new _1231({},this.reviewerStackContainer);
var page1=this.page1=new _1232({style:"overflow:hidden;"});
var page2=this.page2=new _1232({style:"overflow:hidden;"});
var page3=this.page3=new _1232({style:"overflow:hidden;"});
this.reviewerStackContainer.addChild(page1);
this.reviewerStackContainer.addChild(page2);
this.reviewerStackContainer.addChild(page3);
this._initPage1();
this._initPage2();
this._initPage3();
this._initButtons();
dojo.place(this.page1Node,page1.domNode);
dojo.place(this.page2Node,page2.domNode);
dojo.place(this.page3Node,page3.domNode);
sc.startup();
this._subs=[dojo.subscribe(sc.id+"-selectChild",dojo.hitch(this,this._onPageSelected)),dojo.subscribe("/davinci/review/publish/valueChanged",dojo.hitch(this,this.updateSubmit)),dojo.subscribe("/davinci/review/deleteReviewFile",dojo.hitch(this,this.delFiles)),dojo.subscribe("/davinci/review/deleteReviewer",dojo.hitch(this,this.delRow))];
},_initPage1:function(){
this.versionTitle=new _1235({onChange:this._onValueChange,required:true},this.versionTitle);
this.receiveEmail=new _123a({checked:true},this.receiveEmail);
this.descriptions=new _1233({style:"width:460px;height:100px;font-family:Verdana, Arial, Helvetica, sans-serif;font-size:100%;"},this.descriptions);
this.desireWidth=new _1234({constraints:{min:0,places:0},value:1024,style:"width:85px"},this.desireWidth);
this.desireHeight=new _1234({constraints:{min:0,places:0},value:768,style:"width:85px"},this.desireHeight);
var _1250=new Date();
this.dueDate=new _1236({onChange:this._onValueChange,type:"text",constraints:{min:new Date(_1250.getFullYear(),_1250.getMonth(),_1250.getDate())}},this.dueDate);
},_initPage2:function(){
var _1251=[];
var _1252=this.fileIndex=1;
this.reviewFiles=_1251;
var _1253=this.sourceTreeModel=new _1247({deferItemLoadingUntilExpand:true,store:new _1248({root:new _1245(_1244.getProject(),null),getLabel:function(item){
var label=item.getName();
if(item.link){
label=label+"  ["+item.link+"]";
}
return label;
}})});
var _1254=function(item){
this.addFiles([item]);
};
var _1255=this.sourceTree=new Tree({id:"reviewWizardSourceTree",persist:false,showRoot:false,model:_1253,labelAttr:"name",getIconClass:dojo.hitch(this,this._getIconClass),isMultiSelect:true,onDblClick:dojo.hitch(this,_1254),transforms:[function(items){
return items.sort(function(a,b){
a=a.name.toLowerCase();
b=b.name.toLowerCase();
return a<b?-1:(a>b?1:0);
});
}]});
this.sourceTreeNode.appendChild(_1255.domNode);
_1255.startup();
var _1256=this.targetTreeModel=new _1247({store:new _1248({root:new Empty(),getLabel:function(item){
var label=item.getName();
if(item.link){
label=label+"  ["+item.link+"]";
}
return label;
}})});
var _1257=this.targetTree=new _124f({id:"reviewWizardTargetTree",showRoot:false,model:_1256,labelAttr:"name",getIconClass:dojo.hitch(this,this._getIconClass),isMultiSelect:true});
this.targetTreeNode.appendChild(_1257.domNode);
_1257.startup();
},_initPage3:function(){
var _1258=function(_1259){
if(!this.photoRepositoryUrl){
this.photoRepositoryUrl=_1243.serverJSONRequest({url:"cmd/getBluePageInfo",handleAs:"text",content:{"type":"photo"},sync:true,});
}
if(this.photoRepositoryUrl===""||this.photoRepositoryUrl=="not-implemented"){
this.photoRepositoryUrl="app/davinci/review/resources/img/profileNoPhoto.gif?";
}
return "<img src=\""+this.photoRepositoryUrl+_1259+"\" width=\"35px\" height=\"35px\" alt=\"User Photo\"></img>";
}.bind(this);
var _125a=function(_125b){
return "<a href=\"javascript:dojo.publish('/davinci/review/deleteReviewer',[])\"><img class=\"delImg\" src=\"app/davinci/review/resources/img/del.gif\"/></a>";
};
var _125c=[{cells:[{name:_1249.user,field:"email",formatter:_1258,width:"70px",styles:"text-align: center;"},{name:_1249.emailAddress,field:"displayName",width:"320px"},{name:_1249.action,field:"action",formatter:_125a,width:"70px",styles:"text-align: center;"}]}];
var _125d={identifier:"email",label:"name",items:[]};
this.userData=_125d.items;
var _125e=new _1239({data:_125d});
this.jsonStore=_125e;
var grid=new _123b({elasticView:"1",store:_125e,structure:_125c,style:"height:100%;width:100%;",canSort:function(index){
if(index==1){
return false;
}
return true;
},canResize:function(){
return false;
},delRow:function(e){
this.removeSelectedRows();
_125e.save();
}});
this.grid=grid;
this.userGrid.appendChild(grid.domNode);
grid.startup();
this.addReviewerButton=new _1237({disabled:true,onClick:dojo.hitch(this,this.addReviewer),label:"<div style='width:75px;height:10px;margin:-6px 0 0 0'>"+_1249.add+"</div>"},this.addReviewerButton);
var _125f=new _123c({url:"cmd/getBluePageInfo",fetch:function(_1260){
var _1261=_1260.query.displayName;
_1261=_1261.substring(0,_1261.length-1);
_1260.serverQuery={searchname:_1261};
return this.inherited("fetch",arguments);
}});
this.addReviewerCombox=new _1238({regExpGen:dojo.hitch(this,this._emailAddress),required:true,store:_125f,searchAttr:"displayName",name:"displayName",autoComplete:false,hasDownArrow:false,highlightMatch:"all",style:"width:220px",onChange:dojo.hitch(this,this._reviewerComboxValueChanged),onKeyUp:dojo.hitch(this,this._updateAddButton),pageSize:10,searchDelay:500,placeHolder:_1249.enterNameOrEmail},this.addReviewerCombox);
},_emailAddress:function(flags){
if(this.addReviewerCombox.item){
return ".*";
}
flags=(typeof flags=="object")?flags:{};
if(typeof flags.allowCruft!="boolean"){
flags.allowCruft=false;
}
flags.allowPort=false;
var _1262="([!#-'*+\\-\\/-9=?A-Z^-~]+[.])*[!#-'*+\\-\\/-9=?A-Z^-~]+";
var _1263=_1262+"@"+_123e.host(flags);
if(flags.allowCruft){
_1263="<?(mailto\\:)?"+_1263+">?";
}
return _1263;
},_initButtons:function(){
this.invite=new _1237({disabled:true,onClick:dojo.hitch(this,function(){
this.publish();
})},this.invite);
this.next=new _1237({onClick:dojo.hitch(this,function(){
this.reviewerStackContainer.forward();
})},this.next);
this.prev=new _1237({onClick:dojo.hitch(this,function(){
this.reviewerStackContainer.back();
})},this.prev);
this.saveDt=new _1237({onClick:dojo.hitch(this,function(){
this.publish(true);
})},this.saveDt);
},_reviewerComboxValueChanged:function(){
if(this.addReviewerCombox.item){
this.addReviewer();
}
},_updateAddButton:function(e){
var valid=this.addReviewerCombox.isValid();
this.addReviewerButton.set("disabled",!valid);
if(e.keyCode==13&&valid){
this.addReviewer();
}
},delRow:function(){
this.grid.delRow();
dojo.publish("/davinci/review/publish/valueChanged");
},addReviewer:function(){
var item=this.addReviewerCombox.item;
var _1264,email,name;
if(item){
_1264=this.addReviewerCombox.value.split(",").join("");
email=item.i.emailaddress;
name=item.i.name;
name=name.split(",").join("");
}else{
name=email=_1264=this.addReviewerCombox.get("value");
}
this.jsonStore.fetchItemByIdentity({identity:email,onItem:function(i){
item=i;
}});
var grid=this.grid;
if(item){
var index=grid.getItemIndex(item);
grid.scrollToRow(index);
var node=grid.getRowNode(index);
dojo.fx.chain([dojo.fadeOut({node:node,duration:300}),dojo.fadeIn({node:node,duration:700}),dojo.fadeOut({node:node,duration:300}),dojo.fadeIn({node:node,duration:700})]).play();
node.removeAttribute("style");
}else{
this.jsonStore.newItem({name:name,email:email,displayName:_1264});
grid.scrollToRow(grid.get("rowCount"));
this.addReviewerCombox.item=null;
this.addReviewerCombox.reset();
this.addReviewerButton.set("disabled",true);
dojo.publish("/davinci/review/publish/valueChanged");
}
},_onValueChange:function(){
dojo.publish("/davinci/review/publish/valueChanged");
},_onPageSelected:function(page){
this.prev.set("disabled",page.isFirstChild);
this.next.set("disabled",page.isLastChild);
dojo.removeClass(this.navPage1,"current");
dojo.removeClass(this.navPage2,"current");
dojo.removeClass(this.navPage3,"current");
if(page==this.page1){
dojo.addClass(this.navPage1,"current");
}
if(page==this.page2){
dojo.addClass(this.navPage2,"current");
}
if(page==this.page3){
dojo.addClass(this.navPage3,"current");
}
},updateSubmit:function(){
var valid=this.versionTitle.isValid()&&this.dueDate.isValid();
var _1265=this.reviewFiles&&this.reviewFiles.length>0;
var _1266=this.userData.length>0;
dojo.removeClass(this.navPage1Icon,valid?"todo":"done");
dojo.addClass(this.navPage1Icon,valid?"done":"todo");
dojo.removeClass(this.navPage2Icon,_1265?"todo":"done");
dojo.addClass(this.navPage2Icon,_1265?"done":"todo");
dojo.removeClass(this.navPage3Icon,_1266?"todo":"done");
dojo.addClass(this.navPage3Icon,_1266?"done":"todo");
this.invite.set("disabled",!(valid&&_1265&&_1266));
var _1267="";
if(!_1266){
_1267=_1249.noReviewersSelected;
}
if(!_1265){
_1267=_1249.noFilesSelected;
}
if(!this.dueDate.isValid()){
_1267=_1249.dueDateIncorrect;
}
if(!this.versionTitle.isValid()){
_1267=_1249.titleRequired;
}
this.reviewMsg.innerHTML=_1267;
},select:function(evt){
var _1268=evt.target;
var _1269=this.reviewerStackContainer;
if(_1268==this.navPage1||_1268==this.navPage1Icon){
_1269.selectChild(this.page1,true);
}else{
if(_1268==this.navPage2||_1268==this.navPage2Icon){
_1269.selectChild(this.page2,true);
}else{
if(_1268==this.navPage3||_1268==this.navPage3Icon){
_1269.selectChild(this.page3,true);
}
}
}
},update:function(){
var _126a=this.targetTreeModel;
_126a.onChildrenChange(_126a.root,_126a.root.children);
},containReviewFile:function(index){
var _126b=this.reviewFiles||[];
if(!isNaN(index)){
for(var i=0;i<_126b.length;i++){
if(_126b[i].index==index){
return true;
}
}
}else{
for(var i=0;i<_126b.length;i++){
if(_126b[i]==index){
return true;
}
}
}
return false;
},getChildrenFiles:function(item){
var _126c=this.reviewFiles||[];
var _126d=this.targetTreeModel;
if(item.elementType=="File"){
if(!this.containReviewFile(item)){
item.index=this.fileIndex++;
_126c.push(item);
var file=new File(item.name,_126d.root);
file.index=item.index;
_126d.root.children.push(file);
}
}else{
if(item.elementType=="Folder"){
item.getChildren(function(_126e){
dojo.forEach(_126e,dojo.hitch(this,function(item){
if(item.elementType=="File"){
this.getChildrenFiles(item);
}
}.bind(this)));
}.bind(this));
}
}
},addSelectFiles:function(){
var _126f=this.sourceTree.get("selectedItems");
this.addFiles(_126f);
},addFiles:function(files){
var _1270=this.sourceTree.get("selectedItems");
if(files){
_1270=files;
}
dojo.forEach(_1270,this.getChildrenFiles,this);
this.update();
dojo.publish("/davinci/review/publish/valueChanged");
},delFiles:function(item){
var _1271=this.reviewFiles,_1272=this.targetTree.get("selectedItems");
if(item){
_1272=[item];
}
dojo.forEach(_1272,dojo.hitch(this,function(item){
if(item.index){
var tmp,i;
for(i=0;i<_1271.length;i++){
if(item.index==_1271[i].index){
tmp=_1271[i];
_1271.splice(i,1);
break;
}
}
if(!tmp){
return;
}
var list=item.parent.children;
for(i=0;i<list.length;i++){
if(item==list[i]){
item.parent.children.splice(i,1);
break;
}
}
this.update(tmp);
}
}));
dojo.publish("/davinci/review/publish/valueChanged");
},_getIconClass:function(item,_1273){
if(item.elementType=="Folder"){
return _1273?"dijitFolderOpened":"dijitFolderClosed";
}
if(item.elementType=="File"){
var icon;
var _1274=item.getExtension();
var _1275=_1243.getExtension("davinci.fileType",function(_1276){
return _1276.extension==_1274;
});
if(_1275){
icon=_1275.iconClass;
}
return icon||"dijitLeaf";
}
return "dijitLeaf";
},initData:function(node,_1277){
var _1278=new _1241();
this.node=node;
this.isRestart=_1277;
if(!node){
var _1279=_1243.serverJSONRequest({url:"cmd/getLatestVersionId",sync:true});
this.versionTitle.set("value",dojo.string.substitute(_1249.defaultReviewTitle,[_1279]));
}
if(node){
var vName=!_1277?node.name:node.name+" (R)";
this.versionTitle.set("value",vName);
if(!this.isRestart){
this.dueDate.set("value",node.dueDate=="infinite"?new Date(""):node.dueDate);
}
this.desireWidth.set("value",node.width===0?"":node.width);
this.desireHeight.set("value",node.height===0?"":node.height);
if(node.description){
this.descriptions.set("value",node.description);
}
this.receiveEmail.set("value",node.receiveEmail);
node.getChildren(function(_127a){
dojo.forEach(_127a,function(item){
var file=_1242.findResource(item.name);
if(file!=null){
this.addFiles([file]);
}
}.bind(this));
for(var i=0;i<node.reviewers.length;i++){
if(node.reviewers[i].email!=node.designerEmail){
var _127b=_1243.getUserDisplayNamePlusEmail({email:node.reviewers[i].email,userId:node.reviewers[i].name});
this.jsonStore.newItem({name:node.reviewers[i].name,email:node.reviewers[i].email,displayName:_127b});
}
}
_1278.resolve();
}.bind(this));
}else{
_1278.resolve();
}
return _1278;
},publish:function(_127c){
var _127d="";
for(var i=0;i<this.userData.length;i++){
_127d=_127d+this.userData[i].email+",";
}
var _127e=this.descriptions;
var _127f=_127e.value;
var _1280=this.versionTitle.value;
var _1281=this.dueDate.get("value");
var _1282=_1281?stamp.toISOString(_1281,{zulu:true}):"infinite";
var _1283=this.desireWidth.value||0;
var _1284=this.desireHeight.value||0;
var _1285=dojo.map(this.reviewFiles,function(item){
var path=item.getPath();
if(path.length>2&&path.indexOf("./")==0){
path=path.substring(2);
}
return path;
});
var _1286=this.receiveEmail.get("value")=="on"?"true":"false";
var _1287={isUpdate:this.node&&!this.isRestart,isRestart:this.isRestart,vTime:this.node?this.node.timeStamp:null,emails:_127d,message:_127f,versionTitle:_1280,resources:_1285,desireWidth:_1283,desireHeight:_1284,savingDraft:_127c,dueDate:_1282,receiveEmail:_1286};
var _1288=dojo.objectToQuery(_1287);
dojo.xhrPost({url:"cmd/publish"+"?"+_1288,sync:false,handleAs:"json",error:function(_1289){
var msg=_1289.responseText;
msg=msg.substring(msg.indexOf("<title>")+7,msg.indexOf("</title>"));
_1243.handleError(_123f.substitute(_1249.errorPublish,[_1289,msg]));
}}).then(function(_128a){
if(typeof hasToaster=="undefined"){
new _123d({position:"br-left",duration:4000,messageTopic:"/davinci/review/resourceChanged"});
hasToaster=true;
}
if(_128a.length>0){
var _128b=_128a[0];
if(_128b.result=="OK"){
if(_127c){
dojo.publish("/davinci/review/resourceChanged",[{message:_1249.draftSaved,type:"message"},"draft",this.node]);
}else{
if(_128b.emailResult){
if(_128b.emailResult=="OK"){
dojo.publish("/davinci/review/resourceChanged",[{message:_1249.inviteSuccessful,type:"message"},"create",this.node]);
}else{
var _128c=_123f.substitute(_124c,{htmlContent:_128b.emailResult,inviteNotSent:_1249.inviteNotSent,mailFailureMsg:_1249.mailFailureMsg,});
dojo.publish("/davinci/review/resourceChanged",[{message:_1249.inviteFailed,type:"warning"},"create",this.node]);
_1244.showMessage(_1249.warning,_128c);
}
var _128d=_128b.version;
var _128e=_128b.designer;
if(_128d&&_128e){
_1246.findVersion(_128e,_128d).then(function(node){
if(node){
node.getChildren(function(_128f){
if(_128f.length>1){
return;
}
dojo.forEach(_128f,function(child){
davinci.Workbench.openEditor({fileName:child,content:node.getText()});
});
}.bind(this));
}
}.bind(this));
}
}
}
}
}
}.bind(this));
this.onClose();
},onClose:function(){
},destroy:function(){
this.inherited(arguments);
this._subs.forEach(dojo.unsubscribe);
delete this._subs;
this.sourceTree.destroyRecursive();
this.targetTree.destroyRecursive();
}});
});
},"davinci/review/model/resource/File":function(){
define("davinci/review/model/resource/File",["dojo/_base/declare","davinci/model/resource/File","davinci/model/Path","dojo/Deferred"],function(_1290,File,Path,_1291){
return _1290("davinci.review.model.resource.File",File,{constructor:function(name,_1292){
this.elementType="ReviewFile";
this.name=name;
this.parent=_1292;
this.extension="rev";
},getLabel:function(){
var path=new Path(this.name);
var _1293=path.getSegments();
var _1294=davinci.Runtime.getExtension("davinci.editor",function(_1295){
return _1295.id==="davinci.review.CommentReviewEditor";
});
var _1296="."+_1294.extensions;
return label=_1293[_1293.length-1]+_1296;
},getContentSync:function(){
return "";
},getContent:function(){
return new _1291().resolve("");
},removeWorkingCopy:function(){
return;
}});
});
},"davinci/ve/Focus":function(){
define(["require","dojo/_base/declare","dijit/_WidgetBase","dojo/dnd/Mover","dojo/dnd/Moveable","./metadata","davinci/ve/States","davinci/ve/utils/GeomUtils"],function(_1297,_1298,_1299,Mover,_129a,_129b,_129c,_129d){
var LEFT=0,RIGHT=1,TOP=2,_129e=3,_129f=4,_12a0=5,_12a1=6,_12a2=7;
return _1298("davinci.ve.Focus",_1299,{nobSize:11,frameSize:6,postCreate:function(){
dojo.addClass(this.domNode,"maqFocus");
dojo.style(this.domNode,{position:"absolute",display:"none"});
this._stdChrome=dojo.create("div",{"class":"editFocusStdChrome"},this.domNode);
this._frames=[];
for(var i=0;i<4;i++){
var frame=dojo.create("div",{"class":"editFocusFrame"},this._stdChrome);
this._frames.push(frame);
this.connect(frame,"onmousedown","onMouseDown");
}
dojo.addClass(this._frames[LEFT],"editFocusFrameLEFT");
dojo.addClass(this._frames[RIGHT],"editFocusFrameRIGHT");
dojo.addClass(this._frames[TOP],"editFocusFrameTOP");
dojo.addClass(this._frames[_129e],"editFocusFrameBOTTOM");
this._nobs=[];
var _12a3=(dojo.isIE?0:2);
for(var i=0;i<8;i++){
var nob=dojo.create("div",{"class":"editFocusNob"},this._stdChrome);
this._nobs.push(nob);
this.connect(nob,"onmousedown","onMouseDown");
}
this._nobIndex=-1;
this._frameIndex=-1;
this._custom=dojo.create("div",{"class":"editFocusCustom"},this.domNode);
},resize:function(box,_12a4){
if(_12a4){
this._selectedWidget=_12a4;
}
this._moverCurrent=dojo.mixin({},box);
this._moverCurrentConstrained=dojo.mixin({},this._moverCurrent);
this._updateFocusChrome(this._moverCurrent,true);
if(this._contexDiv){
var x=box.w+10;
this._contexDiv.style.left=x+"px";
this._updateSubwidgetList();
}
this._box=box;
},getBounds:function(){
return this._moverCurrent;
},show:function(_12a5,_12a6){
var _12a7=_12a6&&_12a6.inline;
if(!_12a5){
return;
}
this._custom.innerHTML="";
var _12a8=_129b.queryDescriptor(_12a5.type,"showStandardSelectionChrome");
this._stdChrome.style.display=(_12a8===false)?"none":"block";
this.domNode.style.display="block";
this._selectedWidget=_12a5;
var _12a9=_12a5.getHelper();
var _12aa=true;
if(_12a9&&_12a9.onShowSelection){
_12a9.onShowSelection({widget:_12a5,customDiv:this._custom});
}
if(_12a7){
this.showInline(_12a5);
_12aa=false;
}
if(_12aa){
delete this._inline;
}
},showInline:function(_12ab){
this._selectedWidget=_12ab;
var _12ac=this._context;
var self=this;
_129b.getSmartInput(_12ab.type).then(function(_12ad){
if(!_12ad){
return;
}
self._inline=_12ad;
if(_12ad.useParent){
var _12ae=_12ab.getParent();
if(_12ae){
_12ac.deselect(_12ab);
_12ac.select(_12ae);
var _12af=_12ac.getFocus(_12ae);
_12af.showInline(_12ae);
}
}else{
if(_12ad.show){
_12ad.show(_12ab.id);
}
}
});
},inlineEditActive:function(){
if(this._inline&&this._inline.inlineEditActive){
return this._inline.inlineEditActive();
}else{
return false;
}
},hide:function(_12b0){
var _12b1=this._selectedWidget;
var _12b2=_12b1?_12b1.getHelper():undefined;
if(_12b2&&_12b2.onHideSelection){
_12b2.onHideSelection({widget:_12b1,customDiv:this._custom});
}
this.domNode.style.display="none";
this._selectedWidget=null;
this._displayedWidget=null;
if(this._inline){
this._inline.hide();
delete this._inline;
}
},allow:function(op){
if(!op){
return;
}
this._op=op;
this._resizeWidth=op.resizeWidth;
this._resizeHeight=op.resizeHeight;
var _12b3=(op.resizeWidth&&!op.resizeHeight)?"block":"none";
var _12b4=(op.resizeHeight&&!op.resizeWidth)?"block":"none";
var _12b5=(op.resizeWidth&&op.resizeHeight)?"block":"none";
this._nobs[LEFT].style.display=_12b3;
this._nobs[RIGHT].style.display=_12b3;
this._nobs[TOP].style.display=_12b4;
this._nobs[_129e].style.display=_12b4;
this._nobs[_129f].style.display=_12b5;
this._nobs[_12a0].style.display=_12b5;
this._nobs[_12a1].style.display=_12b5;
this._nobs[_12a2].style.display=_12b5;
if(op.resizeWidth){
this._nobs[LEFT].style.cursor=this._frames[LEFT].style.cursor="w-resize";
this._nobs[RIGHT].style.cursor=this._frames[RIGHT].style.cursor="e-resize";
}else{
this._nobs[LEFT].style.cursor=this._nobs[RIGHT].style.cursor=this._frames[LEFT].style.cursor=this._frames[RIGHT].style.cursor="auto";
}
if(op.resizeHeight){
this._nobs[TOP].style.cursor=this._frames[TOP].style.cursor="n-resize";
this._nobs[_129e].style.cursor=this._frames[_129e].style.cursor="s-resize";
}else{
this._nobs[TOP].style.cursor=this._nobs[_129e].style.cursor=this._frames[TOP].style.cursor=this._frames[_129e].style.cursor="auto";
}
if(op.resizeWidth&&op.resizeHeight){
this._nobs[_129f].style.cursor="nw-resize";
this._nobs[_12a0].style.cursor="sw-resize";
this._nobs[_12a1].style.cursor="ne-resize";
this._nobs[_12a2].style.cursor="se-resize";
}else{
this._nobs[_129f].style.cursor=this._nobs[_12a0].style.cursor=this._nobs[_12a1].style.cursor=this._nobs[_12a2].style.cursor="auto";
}
},_updateFocusChrome:function(rect,_12b6){
var _12b7=this.nobSize+1;
var _12b8=this.frameSize+1;
var _12b9=-6;
var _12ba=-6;
var _12bb=-11;
var _12bc=-11;
var _12bd=4;
var _12be=4;
var _12bf=dojo.byId("focusContainer");
var _12c0=_129d.getBorderBoxPageCoords(_12bf);
var _12c1=this._context;
var _12c2=_12c1.getParentIframeBounds();
rect.l+=_12c2.l;
rect.t+=_12c2.t;
var _12c3=_12c1.getParentIframe();
var _12c4=_12c3.contentDocument.documentElement;
var _12c5=_12c3.contentDocument.body;
rect.l-=_129d.getScrollLeft(_12c5);
rect.t-=_129d.getScrollTop(_12c5);
_12b6=false;
this.domNode.style.left=(rect.l-_12c0.l)+"px";
this.domNode.style.top=(rect.t-_12c0.t)+"px";
var _12c6=_12bb;
var _12c7=_12bc;
var _12c8=rect.w;
var _12c9=rect.h;
var _12ca=rect.w;
var _12cb=rect.h;
var _12cc=_12b9;
var _12cd=_12ba;
var _12ce=rect.w;
var _12cf=rect.h;
var _12d0=rect.w+_12bd+_12be;
var _12d1=rect.h+_12bd+_12be;
var doc=this.domNode&&this.domNode.ownerDocument;
var body=doc&&doc.body;
if(_12b6&&body){
var _12d2,_12d3,_12d4,_12d5;
var _12d6=_129d.getScrollLeft(body);
var _12d7=_129d.getScrollTop(body);
var _12d8=_12d6+body.clientWidth;
var _12d9=_12d7+body.clientHeight;
farthestLeft=rect.l-_12b7;
_12d3=rect.t-_12b7;
var _12da=farthestLeft<_12d6?_12d6-farthestLeft:0;
var _12db=_12d3<_12d7?_12d7-_12d3:0;
_12c6+=_12da;
_12c7+=_12db;
_12d4=rect.l+rect.w+_12b7;
_12d5=rect.t+rect.h+_12b7;
var _12dc=_12d4>_12d8?_12d8-_12d4:0;
var _12dd=_12d5>_12d9?_12d9-_12d5:0;
_12c8+=_12dc;
_12c9+=_12dd;
farthestLeft=rect.l-_12b8;
_12d3=rect.t-_12b8;
var _12de=farthestLeft<_12d6?_12d6-farthestLeft:0;
var _12df=_12d3<_12d7?_12d7-_12d3:0;
_12cc+=_12de;
_12cd+=_12df;
_12d0-=_12de;
_12d1-=_12df;
_12d4=rect.l+rect.w+_12b8;
_12d5=rect.t+rect.h+_12b8;
var _12e0=_12d4>_12d8?_12d8-_12d4:0;
var _12e1=_12d5>_12d9?_12d9-_12d5:0;
_12ce+=_12e0;
_12cf+=_12e1;
_12d4=_12de+_12d0;
_12d5=_12df+_12d1;
var _12e2=(_12d4+_12be)>_12d8?_12d8-(_12d4+_12be):0;
var _12e3=(_12d5+_12be)>_12d9?_12d9-(_12d5+_12be):0;
_12d0+=_12e2;
_12d1+=_12e3;
}
this._frames[LEFT].style.left=this._frames[TOP].style.left=this._frames[_129e].style.left=_12cc+"px";
this._frames[LEFT].style.top=this._frames[TOP].style.top=this._frames[RIGHT].style.top=_12cd+"px";
this._frames[LEFT].style.height=_12d1+"px";
this._frames[RIGHT].style.height=_12d1+"px";
this._frames[RIGHT].style.left=_12ce+"px";
this._frames[TOP].style.width=_12d0+"px";
this._frames[_129e].style.top=_12cf+"px";
this._frames[_129e].style.width=_12d0+"px";
var l=Math.round(_12ca/2-this.nobSize/2);
var t=Math.round(_12cb/2-this.nobSize/2);
this._nobs[LEFT].style.left=this._nobs[_129f].style.left=this._nobs[_12a0].style.left=_12c6+"px";
this._nobs[TOP].style.top=this._nobs[_129f].style.top=this._nobs[_12a1].style.top=_12c7+"px";
this._nobs[LEFT].style.top=t+"px";
this._nobs[RIGHT].style.left=_12c8+"px";
this._nobs[RIGHT].style.top=t+"px";
this._nobs[TOP].style.left=l+"px";
this._nobs[_129e].style.left=l+"px";
this._nobs[_129e].style.top=_12c9+"px";
this._nobs[_12a0].style.top=_12c9+"px";
this._nobs[_12a1].style.left=_12c8+"px";
this._nobs[_12a2].style.left=_12c8+"px";
this._nobs[_12a2].style.top=_12c9+"px";
this.domNode.style.opacity=0.95;
setTimeout(function(){
this.domNode.style.opacity=1;
}.bind(this),1);
},onMouseDown:function(event){
this._removeKeyHandlers();
if(!this._selectedWidget||!this._selectedWidget.domNode){
return;
}
if(event.button===2||event.ctrlKey){
return;
}
if(this._context._activeTool.declaredClass!="davinci.ve.tools.SelectTool"){
return;
}
this._shiftKey=event.shiftKey;
this._sKey=false;
this._nobIndex=dojo.indexOf(this._nobs,event.target);
this._frameIndex=dojo.indexOf(this._frames,event.target);
var _12e4=800;
var _12e5=400;
var l=event.pageX-_12e5;
var t=event.pageY-_12e5;
var _12e6=null;
var _12e7=this._selectedWidget.getHelper();
if(_12e7&&_12e7.getMarginBoxPageCoords){
_12e6=_12e7.getMarginBoxPageCoords(this._selectedWidget);
}else{
var node=this._selectedWidget.domNode;
_12e6=_129d.getMarginBoxPageCoords(node);
}
var _12e8=this._context.getParentIframeBounds();
this._moverStart={moverLeft:l,moverTop:t,l:_12e6.l+_12e8.l,t:_12e6.t+_12e8.t,w:_12e6.w,h:_12e6.h};
var _12e9=document.body;
this._moverCurrent=dojo.mixin({},this._moverStart);
this._moverDragDiv=dojo.create("div",{className:"focusDragDiv",style:"position:absolute;left:"+l+"px;top:"+t+"px;width:"+_12e4+"px;height:"+_12e4+"px"},_12e9);
this._mover=new Mover(this._moverDragDiv,event,this);
dojo.stopEvent(event);
this._mouseDownInfo={widget:this._selectedWidget,pageX:event.pageX+_12e8.l,pageY:event.pageY+_12e8.t,dateValue:(new Date()).valueOf()};
this._moverMouseDownEvent=event;
this._moverMouseUpEvent=null;
this._moverMouseUpHandler=dojo.connect(this._moverDragDiv,"onmouseup",dojo.hitch(this,function(e){
this.onMouseUp(e);
}));
var _12ea=this._context.getDocument();
document.getElementById("davinci-help-dropdown").focus();
_12ea.defaultView.focus();
this._keyDownHandler=dojo.connect(_12ea,"onkeydown",dojo.hitch(this,function(e){
this.onKeyDown(e);
}));
this._keyUpHandler=dojo.connect(_12ea,"onkeyup",dojo.hitch(this,function(e){
this.onKeyUp(e);
}));
},onMove:function(mover,box,event){
this._mouseDownInfo=null;
if(this._moverDragDiv){
this._moverDragDiv.style.left=box.l+"px";
this._moverDragDiv.style.top=box.t+"px";
}
if(((this._frameIndex===LEFT||this._frameIndex===RIGHT)&&!this._resizeWidth)||((this._frameIndex===TOP||this._frameIndex===_129e)&&!this._resizeHeight)){
return;
}
var start=this._moverStart;
var dx=box.l-start.moverLeft;
var dy=box.t-start.moverTop;
if(this._frameIndex===LEFT||this._nobIndex===_129f||this._nobIndex===LEFT||this._nobIndex===_12a0){
this._moverCurrent.l=start.l+dx;
this._moverCurrent.w=start.w-dx;
}else{
if(this._frameIndex===RIGHT||this._nobIndex===_12a1||this._nobIndex===RIGHT||this._nobIndex===_12a2){
this._moverCurrent.w=start.w+dx;
}
}
if(this._frameIndex===TOP||this._nobIndex===_129f||this._nobIndex===TOP||this._nobIndex===_12a1){
this._moverCurrent.t=start.t+dy;
this._moverCurrent.h=start.h-dy;
}else{
if(this._frameIndex===_129e||this._nobIndex===_12a0||this._nobIndex===_129e||this._nobIndex===_12a2){
this._moverCurrent.h=start.h+dy;
}
}
var _12eb=this._moverCurrent.w;
var _12ec=this._moverCurrent.h;
var _12ed=false;
if(this._selectedWidget&&this._selectedWidget.domNode.nodeName==="IMG"){
var _12ee=this._selectedWidget.domNode;
var _12ef=_12ee.naturalWidth;
var _12f0=_12ee.naturalHeight;
if(typeof _12f0=="number"&&_12f0>0&&typeof _12ef=="number"&&_12ef>0){
var _12f1=_12ef/_12f0;
if(_12eb<_12f1*_12ec){
_12eb=_12ec*_12f1;
}else{
_12ec=_12eb/_12f1;
}
_12ed=true;
}
}
if(!_12ed){
if(this._frameIndex===LEFT||this._nobIndex===LEFT||this._frameIndex===RIGHT||this._nobIndex===RIGHT){
_12ec=_12eb;
}else{
if(this._frameIndex===TOP||this._nobIndex===TOP||this._frameIndex===_129e||this._nobIndex===_129e){
_12eb=_12ec;
}else{
if(_12eb>_12ec){
_12ec=_12eb;
}else{
_12eb=_12ec;
}
}
}
}
this._moverCurrentConstrained={l:this._moverCurrent.l,t:this._moverCurrent.t,w:_12eb,h:_12ec};
if(this._frameIndex===LEFT||this._nobIndex===LEFT||this._frameIndex===RIGHT||this._nobIndex===RIGHT){
this._moverCurrentConstrained.t-=(this._moverCurrentConstrained.h-this._moverCurrent.h)/2;
}
if(this._frameIndex===TOP||this._nobIndex===TOP||this._frameIndex===_129e||this._nobIndex===_129e){
this._moverCurrentConstrained.l-=(this._moverCurrentConstrained.w-this._moverCurrent.w)/2;
}
var rect=dojo.mixin({},this._shiftKey?this._moverCurrentConstrained:this._moverCurrent);
var _12f2=this._context.getParentIframeBounds();
rect.l-=_12f2.l;
rect.t-=_12f2.t;
this._updateFocusChrome(rect,false);
},onFirstMove:function(mover){
},onMoveStart:function(mover){
},_moverDoneCleanup:function(){
var _12f3=this._context;
var cp=_12f3._chooseParent;
this._lastEventTarget=null;
this._removeKeyHandlers();
_12f3.dragMoveCleanup();
cp.parentListDivDelete();
this._mover=undefined;
this._nobIndex=-1;
this._frameIndex=-1;
},onMoveStop:function(mover){
if(this._moverDragDiv){
var _12f4=this._moverDragDiv.parentNode;
if(_12f4){
_12f4.removeChild(this._moverDragDiv);
}
this._moverDragDiv=null;
if(this._moverCurrent.l!=this._moverStart.l||this._moverCurrent.t!=this._moverStart.t||this._moverCurrent.w!=this._moverStart.w||this._moverCurrent.h!=this._moverStart.h){
var _12f5=undefined;
if(this._selectedWidget&&this._selectedWidget.domNode){
if(this._sKey){
var _12f6=_129c.getStatesListCurrent(this._selectedWidget.domNode);
for(var i=0;i<_12f6.length;i++){
if(_12f6[i]){
_12f5=_12f6[i];
break;
}
}
}else{
_12f5=_129c.propertyDefinedForAnyCurrentState(this._selectedWidget.domNode,["width","height"]);
}
}
var _12f7=this._shiftKey?this._moverCurrentConstrained:this._moverCurrent;
if(_12f7.w==this._moverStart.w){
delete _12f7.w;
}
if(_12f7.h==this._moverStart.h){
delete _12f7.h;
}
if(typeof _12f7.l!="number"){
_12f7.l=this._moverStart.l;
}
if(typeof _12f7.t!="number"){
_12f7.t=this._moverStart.t;
}
if(_12f7.l==this._moverStart.l&&_12f7.t==this._moverStart.t){
delete _12f7.l;
delete _12f7.t;
}
var rect=dojo.mixin({},_12f7);
if(rect.hasOwnProperty("l")){
var _12f8=this._context.getParentIframeBounds();
rect.l-=_12f8.l;
rect.t-=_12f8.t;
}
this.onExtentChange(this,this._moverStart,rect,_12f5);
}
}
this._moverDoneCleanup();
var event=(this._moverMouseUpEvent||this._moverMouseDownEvent);
this._moverMouseDownEvent=null;
this._moverMouseUpEvent=null;
if(event&&event.target){
var _12f9=750;
var _12fa=750;
var _12fb=10;
var _12fc=(new Date()).valueOf();
this._mouseDownInfo=null;
if(this._lastMouseUp){
if(Math.abs(event.pageX-this._lastMouseUp.pageX)<=_12fb&&Math.abs(event.pageY-this._lastMouseUp.pageY)<=_12fb&&(_12fc-this._lastMouseUp.dateValue)<=_12fa){
this.onDblClick(event);
}
}
this._lastMouseUp={pageX:event.pageX,pageY:event.pageY,dateValue:_12fc};
dojo.stopEvent(event);
}
},onMouseUp:function(event){
this._moverMouseUpEvent=event;
},onDblClick:function(event){
this.showInline(this._selectedWidget);
event.stopPropagation();
},onKeyDown:function(event){
if(event&&this._moverDragDiv){
dojo.stopEvent(event);
if(event.keyCode==dojo.keys.SHIFT){
this._shiftKey=true;
this._updateFocusChrome(this._shiftKey?this._moverCurrentConstrained:this._moverCurrent,false);
}else{
if(event.keyCode==83){
this._sKey=true;
}
}
}else{
this._removeKeyHandlers();
}
},onKeyUp:function(event){
if(event&&this._moverDragDiv){
dojo.stopEvent(event);
if(event.keyCode==dojo.keys.SHIFT){
this._shiftKey=false;
this._updateFocusChrome(this._shiftKey?this._moverCurrentConstrained:this._moverCurrent,false);
}else{
if(event.keyCode==83){
this._sKey=false;
}
}
}else{
this._removeKeyHandlers();
}
},_removeKeyHandlers:function(){
if(this._keyDownHandler){
dojo.disconnect(this._keyDownHandler);
this._keyDownHandler=null;
}
if(this._keyUpHandler){
dojo.disconnect(this._keyUpHandler);
this._keyUpHandler=null;
}
},onExtentChange:function(focus,_12fd,_12fe,_12ff){
},isFocusNode:function(node){
if(dojo.hasClass(node,"focusDragDiv")||dojo.hasClass(node,"editFocusNob")||dojo.hasClass(node,"editFocusFrame")||dojo.hasClass(node,"maqFocus")||dojo.hasClass(node,"editFocusStdChrome")){
return true;
}else{
return false;
}
},showContext:function(_1300,_1301){
if(this._context.editor.declaredClass=="davinci.ve.themeEditor.ThemeEditor"){
if(!this._contexDiv){
this._context=_1300;
this._createContextPopUp();
}
this._contexDiv.style.display="block";
}
},hideContext:function(){
if(this._context.editor.declaredClass=="davinci.ve.themeEditor.ThemeEditor"){
if(this._contexDiv){
this._contexDiv.style.display="none";
}
}
},_createContextPopUp:function(){
var _1302=dojo.doc.createElement("div");
_1302.id="ieb";
this._contexDiv=_1302;
this.domNode.appendChild(_1302);
},_createSubwidgetList:function(){
var _1303=this._context._selectedWidget;
if(!_1303){
return;
}
var _1304=this._context.getThemeMeta().metadata;
var _1305=_1304.getWidgetType(_1303);
var _1306=_1304.getMetadata(_1305);
var _1307=_1306?_1306.subwidgets:null;
this._displayedWidget=_1303;
if(_1307){
var _1308=this._contexDiv;
_1308.innerHTML="<span></span>";
_1308.style.position="absolute";
var x=this._box.w+10;
_1308.style.left=x+"px";
_1308.className="themeSubwidgetMenu";
dojo.connect(_1308,"onmousedown",this,"stopPropagation");
_1308.style.display="none";
this._contexDiv=_1308;
this.domNode.appendChild(_1308);
var span=this._contexDiv.firstElementChild,_1309=this._context.theme.name+"_subwidgetmenu",pMenu=dijit.byId(_1309);
if(pMenu){
pMenu.destroyRecursive(false);
}
var _130a=this._context.getDijit();
pMenu=new _130a.Menu({id:_1309},span);
var _130b=false;
if(!_1303.subwidget){
_130b=true;
}
var item=new _130a.CheckedMenuItem({label:"WidgetOuterContainer",id:this._context.theme.name+"_WidgetOuterContainer",checked:_130b,onClick:dojo.hitch(this,"_subwidgetSelected",this._context.theme.name+"_WidgetOuterContainer")});
pMenu.addChild(item);
this._currentItem=item;
for(var s in _1307){
_130b=(_1303.subwidget===s);
var _130c=new _130a.CheckedMenuItem({label:s,id:this._context.theme.name+"_"+s,checked:_130b,onClick:dojo.hitch(this,"_subwidgetSelected",this._context.theme.name+"_"+s)});
pMenu.addChild(_130c);
if(_130b){
this._currentItem=_130c;
}
}
pMenu.startup();
this._cm=pMenu;
this._updateSubwidgetListForState();
this._connections=[];
this._connections.push(dojo.subscribe("/davinci/ui/subwidgetSelectionChanged",dojo.hitch(this,this._subwidgetSelectedChange)));
this._connections.push(dojo.subscribe("/davinci/states/state/changed",dojo.hitch(this,this._updateSubwidgetListForState)));
}else{
this._contexDiv.innerHTML="";
}
},stopPropagation:function(e){
e.stopPropagation();
},_subwidgetSelected:function(id,e){
e.stopPropagation();
var _130d=this._context.getDijit();
var item=_130d.byId(id);
var _130e;
if(item.checked){
if(this._currentItem&&item!=this._currentItem){
this._currentItem.set("checked",false);
}
this._currentItem=item;
_130e=this._currentItem.label;
}else{
this._currentItem=_130d.byId(this._context.theme.name+"_WidgetOuterContainer");
if(this._currentItem){
this._currentItem.set("checked",true);
}
_130e=null;
}
if(e.currentTarget.id===(this._context.theme.name+"_WidgetOuterContainer")){
_130e=null;
}
dojo.publish("/davinci/ui/subwidgetSelectionChanged",[{subwidget:_130e,origin:this.declaredClass}]);
},_subwidgetSelectedChange:function(e){
var _130f=this._context.getDijit();
if(e.origin===this.declaredClass){
return;
}else{
if(this._currentItem){
this._currentItem.set("checked",false);
}
if(e.subwidget){
this._currentItem=_130f.byId(this._context.theme.name+"_"+e.subwidget);
if(this._currentItem){
this._currentItem.set("checked",true);
}
}else{
this._currentItem=_130f.byId(this._context.theme.name+"_WidgetOuterContainer");
if(this._currentItem){
this._currentItem.set("checked",true);
}
}
}
},_updateSubwidgetListForState:function(){
if(this._context.editor!=davinci.Runtime.currentEditor){
return;
}
if(this._context._selectedWidget&&this._displayedWidget===this._context._selectedWidget){
var _1310=davinci.Runtime.currentEditor,_1311=_1310._theme;
this._cm.getChildren().forEach(function(child){
var _1312=child.label;
if(_1312==="WidgetOuterContainer"){
_1312=null;
}
child.setDisabled(!_1311.isStateValid(this._displayedWidget,_1310._currentState,_1312));
},this);
}else{
this._clearList();
this._createSubwidgetList();
}
},_updateSubwidgetList:function(){
if(this._displayedWidget===this._context._selectedWidget){
return;
}
this._clearList();
this._createSubwidgetList();
},_clearList:function(){
if(this._cm){
this._cm.destroyRecursive(false);
delete this._cm;
while(connection=this._connections.pop()){
dojo.unsubscribe(connection);
}
}
this._currentItem=null;
},dojoStyle:function(node,name,value){
if(node&&node.ownerDocument&&node.ownerDocument.defaultView){
var win=node.ownerDocument.defaultView;
var cs=win.getComputedStyle(node);
if(cs){
return dojo.style.apply(dojo,arguments);
}
}
}});
});
},"davinci/ve/commands/ResizeCommand":function(){
define(["dojo/_base/declare","dojo/dom-geometry","davinci/ve/widget","davinci/ve/States","davinci/ve/utils/StyleArray"],function(_1313,_1314,_1315,_1316,_1317){
return _1313("davinci.ve.commands.ResizeCommand",null,{name:"resize",constructor:function(_1318,width,_1319,_131a){
this._id=(_1318?_1318.id:undefined);
var _131b=/^\s*[-+]?[0-9]*\.?[0-9]+\s*$/;
if(_131b.test(width)){
width=parseFloat(width);
}
if(_131b.test(_1319)){
_1319=parseFloat(_1319);
}
this._newBox={w:width,h:_1319};
this._applyToStateIndex=(!_131a||_131a=="Normal"||_131a=="undefined")?"undefined":_131a;
},execute:function(){
if(!this._id||!this._newBox){
return;
}
var _131c=_1315.byId(this._id);
if(!_131c||!_131c.domNode){
return;
}
var node=_131c.domNode;
var cs=node.ownerDocument.defaultView.getComputedStyle(node);
var _131d=_1314.getContentBox(node,cs);
this._oldBox={w:_131d.w,h:_131d.h};
var w=this._newBox.w;
var h=this._newBox.h;
if(this._usesBorderBox(node)){
var pb=_1314.getPadBorderExtents(node,cs);
if(typeof w=="number"&&w>=0){
w+=pb.w;
}
if(typeof h=="number"&&h>=0){
h+=pb.h;
}
}
var _131e=[{}];
if(typeof w=="number"){
_131e[0].width=w+"px";
}else{
if(typeof w=="string"){
_131e[0].width=w;
}
}
if(typeof h=="number"){
_131e[0].height=h+"px";
}else{
if(typeof h=="string"){
_131e[0].height=h;
}
}
var _131f=_131c.getStyleValuesAllStates();
this._oldStyleValuesAllStates=dojo.clone(_131f);
if(this._oldBox){
this._oldStyleValuesAllStates[this._applyToStateIndex]=_1317.mergeStyleArrays(this._oldStyleValuesAllStates[this._applyToStateIndex],[{width:this._oldBox.w+"px"},{height:this._oldBox.h+"px"}]);
}
if(_131f[this._applyToStateIndex]){
_131f[this._applyToStateIndex]=_1317.mergeStyleArrays(_131f[this._applyToStateIndex],_131e);
}else{
_131f[this._applyToStateIndex]=_131e;
}
_131c.setStyleValuesAllStates(_131f);
var _1320=_1316.getStatesListCurrent(_131c.domNode);
var _1321=_1317.mergeStyleArrays([],_131f["undefined"]);
for(var i=0;i<_1320.length;i++){
if(_131f[_1320[i]]){
_1321=_1317.mergeStyleArrays(_1321,_131f[_1320[i]]);
}
}
_131c.setStyleValuesCanvas(_1321);
_131c.setStyleValuesModel(_131f["undefined"]);
this._resize(_131c);
_1316.resetState(_131c.domNode);
dojo.publish("/davinci/ui/widgetPropertiesChanged",[[_131c]]);
},setContext:function(_1322){
this._context=_1322;
},undo:function(){
if(!this._id){
return;
}
var _1323=_1315.byId(this._id);
if(!_1323){
return;
}
var _1324=this._oldStyleValuesAllStates;
var _1325=this._applyToStateIndex;
_1323.setStyleValuesAllStates(_1324);
var _1326=_1317.mergeStyleArrays(_1324["undefined"],_1324[_1325]);
_1323.setStyleValuesCanvas(_1326);
_1323.setStyleValuesModel(this._oldStyleValuesAllStates["undefined"]);
this._resize(_1323);
_1316.resetState(_1323.domNode);
dojo.publish("/davinci/ui/widgetPropertiesChanged",[[_1323]]);
},_usesBorderBox:function(node){
var _1327=node.tagName.toLowerCase();
var type=node.getAttribute("type");
if(type){
type=type.toLowerCase(type);
}
return _1327=="table"||_1327=="button"||(_1327=="input"&&type=="button");
},_resize:function(_1328){
var _1329=_1328.getParent();
if(_1329&&_1329.dijitWidget&&_1329.dijitWidget.isLayoutContainer){
_1329.resize();
}else{
if(_1328.resize){
_1328.resize();
}
}
_1328.renderWidget();
_1328._updateSrcStyle();
}});
});
},"davinci/ve/palette/ImageDragSource":function(){
define("davinci/ve/palette/ImageDragSource",["dojo/_base/declare","davinci/ve/tools/CreateTool","davinci/ui/dnd/DragManager","davinci/ve/metadata","davinci/model/Path","davinci/Workbench",],function(_132a,_132b,_132c,_132d,Path,_132e){
return _132a("davinci.ve.palette.ImageDragSource",null,{constructor:function(data){
this.data=data;
},initDrag:function(){
var _132f=_132e.getOpenEditor();
if(_132f&&_132f.currentEditor&&_132f.currentEditor.context){
this.context=_132f.currentEditor.context;
_132c.document=this.context.getDocument();
var _1330=this.context.frameNode;
if(_1330){
var _1331=dojo.coords(_1330);
var _1332=this.context.getContainerNode();
_132c.documentX=_1331.x-_1332.scrollLeft;
_132c.documentY=_1331.y-_1332.scrollTop;
}
}else{
this.context=null;
}
},dragStart:function(){
if(this.context){
var _1333,_1334=this.context.getPath(),_1335=new Path(this.data.getPath()),_1336=_1335.relativeTo(_1334,true).toString();
if(this.data.getExtension()==="json"){
_1333={type:"dojo.data.ItemFileWriteStore",properties:{jsId:"myDataStore",url:_1336}};
}else{
_1333={children:[],properties:{src:_1336},type:"html.img"};
}
_1333.fileDragCreate=true;
_132d.getHelper(_1333.type,"tool").then(function(_1337){
var tool=new (_1337||_132b)(_1333);
this.context.setActiveTool(tool);
}.bind(this));
}
},dragEnd:function(){
if(this.context){
this.context.setActiveTool(null);
}
},createDragClone:function(){
var img=dojo.create("img",{src:this.data.getURL()});
dojo.connect(img,"onload",dojo.hitch(this,function(e){
var image=e.target;
var style=image.style;
style.width=image.naturalWidth+"px";
style.height=image.naturalHeight+"px";
}));
return img;
}});
});
},"davinci/js/JSFile":function(){
define(["dojo/_base/declare","davinci/js/JSElement"],function(_1338,_1339){
return _1338("davinci.js.JSFile",_1339,{constructor:function(_133a){
this.elementType="JSFile";
this.nosemicolon=true;
this._textContent="";
if(_133a){
this.origin=_133a;
}
},getText:function(_133b){
return this._textContent;
},setText:function(text){
this._textContent=text;
},getLabel:function(){
return this.fileName;
},getID:function(){
return this.fileName;
},visit:function(_133c){
var _133d;
_133d=_133c.visit(this);
if(!_133d){
for(var i=0;i<this.children.length;i++){
this.children[i].visit(_133c);
}
}
if(_133c.endVisit){
_133c.endVisit(this);
}
}});
});
},"url:davinci/ui/widgets/templates/NewFolder.html":"<div>\n\t<div class=\"dijitDialogPaneContentArea\">\n\t\t<table>\n\t\t<tr>\n\t\t\t<td class=\"NewProjectDialogLabel\">${uiNLS.parentFolder}</td><td><div class='templateInput'  dojoAttachPoint=\"fileDialogParentFolder\"  ></input></td>\n\t\t</tr>\n\t\t<tr>\n\t\t<td class=\"NewProjectDialogLabel\">${uiNLS.newFolderName}</td><td><input dojoType=\"dijit.form.TextBox\" type=\"text\" dojoAttachPoint=\"folderName\"></input></td><td><div dojoAttachPoint='_error4'></div></td>\n\t\t</tr>\n\t\t</table>\n\t</div>\n\t<div class=\"dijitDialogPaneActionBar\">\n\t\t<button dojoType='dijit.form.Button' dojoAttachPoint=\"okButton\" class=\"maqPrimaryButton\" type=\"submit\">${uiNLS.create}</button>\n\t\t<button dojoType='dijit.form.Button' dojoAttachEvent='onClick:_cancelButton' class=\"maqSecondaryButton\">${uiNLS.cancelButtonLabel}</button>\t\t\n\t</div>\t\t\n</div>","dojo/dnd/Moveable":function(){
define("dojo/dnd/Moveable",["../_base/array","../_base/declare","../_base/event","../_base/lang","../dom","../dom-class","../Evented","../on","../topic","../touch","./common","./Mover","../_base/window"],function(array,_133e,event,lang,dom,_133f,_1340,on,topic,touch,dnd,Mover,win){
var _1341=_133e("dojo.dnd.Moveable",[_1340],{handle:"",delay:0,skip:false,constructor:function(node,_1342){
this.node=dom.byId(node);
if(!_1342){
_1342={};
}
this.handle=_1342.handle?dom.byId(_1342.handle):null;
if(!this.handle){
this.handle=this.node;
}
this.delay=_1342.delay>0?_1342.delay:0;
this.skip=_1342.skip;
this.mover=_1342.mover?_1342.mover:Mover;
this.events=[on(this.handle,touch.press,lang.hitch(this,"onMouseDown")),on(this.handle,"dragstart",lang.hitch(this,"onSelectStart")),on(this.handle,"selectstart",lang.hitch(this,"onSelectStart"))];
},markupFactory:function(_1343,node,Ctor){
return new Ctor(node,_1343);
},destroy:function(){
array.forEach(this.events,function(_1344){
_1344.remove();
});
this.events=this.node=this.handle=null;
},onMouseDown:function(e){
if(this.skip&&dnd.isFormElement(e)){
return;
}
if(this.delay){
this.events.push(on(this.handle,touch.move,lang.hitch(this,"onMouseMove")),on(this.handle,touch.release,lang.hitch(this,"onMouseUp")));
this._lastX=e.pageX;
this._lastY=e.pageY;
}else{
this.onDragDetected(e);
}
event.stop(e);
},onMouseMove:function(e){
if(Math.abs(e.pageX-this._lastX)>this.delay||Math.abs(e.pageY-this._lastY)>this.delay){
this.onMouseUp(e);
this.onDragDetected(e);
}
event.stop(e);
},onMouseUp:function(e){
for(var i=0;i<2;++i){
this.events.pop().remove();
}
event.stop(e);
},onSelectStart:function(e){
if(!this.skip||!dnd.isFormElement(e)){
event.stop(e);
}
},onDragDetected:function(e){
new this.mover(this.node,e,this);
},onMoveStart:function(mover){
topic.publish("/dnd/move/start",mover);
_133f.add(win.body(),"dojoMove");
_133f.add(this.node,"dojoMoveItem");
},onMoveStop:function(mover){
topic.publish("/dnd/move/stop",mover);
_133f.remove(win.body(),"dojoMove");
_133f.remove(this.node,"dojoMoveItem");
},onFirstMove:function(){
},onMove:function(mover,_1345){
this.onMoving(mover,_1345);
var s=mover.node.style;
s.left=_1345.l+"px";
s.top=_1345.t+"px";
this.onMoved(mover,_1345);
},onMoving:function(){
},onMoved:function(){
}});
return _1341;
});
},"url:davinci/ve/widgets/templates/WidgetToolBar.html":"<div class=\"propertiesTitleBar\" style=\"display: none\">\n\t<div class='propertiesWidgetDescription'>\n\t\t<span class='propertiesWidgetDescriptionFor'>${veNLS.toolBarFor}</span>\n\t\t<span data-dojo-attach-point=\"descNode\">${veNLS.noSelection}</span>\n\t</div>\n\n\t<div class=\"propertiesTitleBarPropertiesContainer\">\n\t\t<table width=\"100%\" cellspacing=\"0\" cellpadding=\"0\" border=\"0\" align=\"center\" class=\"propertiesTitleBarProperties property_table_stretchable\">\n\t\t\t<colgroup><col style=\"width:10px;\"><col class=\"gap02\"><col class=\"gap03\"><col style=\"width:10px;\"><col style=\"width:6px;\"></colgroup>\n\t\t\t<tbody>\n\t\t\t\t<tr class=\"cssPropertySection\">\n\t\t\t\t\t<td></td>\n\t\t\t\t\t<td class=\"propertyDisplayName\">${veNLS.toolBarClass}&nbsp;</td>\n\t\t\t\t\t<td class=\"propertyInputField\">\n\t\t\t\t\t  <input data-dojo-type=\"dijit.form.ComboBox\" data-dojo-attach-point=\"classComboBox\" label=\"\" data-dojo-attach-event=\"onChange:_onChangeClassAttribute,onFocus:_onFieldFocus,onBlur:_onFieldBlur\" style=\"width: 100%\" searchAttr=\"name\"/>\n\t\t\t\t\t</td>\n\t\t\t\t\t<td nowrap=\"true\" class=\"propertyExtra\"></td>\n\t\t\t\t\t<td></td>\n\t\t\t\t</tr>\n\t\n\t\t\t\t<tr class=\"cssPropertySection\">\n\t\t\t\t\t<td></td>\n\t\t\t\t\t<td class=\"propertyDisplayName\">${veNLS.toolBarId}&nbsp;</td>\n\t\t\t\t\t<td class=\"propertyInputField\">\n\t\t\t\t\t  <input data-dojo-type=\"dijit.form.ValidationTextBox\" data-dojo-attach-point=\"idTextBox\" label=\"\" data-dojo-attach-event=\"onChange:_onChangeIDAttribute,onKeyPress:_onKeyPress,onFocus:_onFieldFocus,onBlur:_onFieldBlur\" style=\"width: 100%\"/>\n\t\t\t\t\t</td>\n\t\t\t\t\t<td nowrap=\"true\" class=\"propertyExtra\"></td>\n\t\t\t\t\t<td></td>\n\t\t\t\t</tr>\n\t\t\t</tbody>\n\t\t</table>\n\t</div>\n</div>\n","davinci/ve/widgets/MutableStore":function(){
define("davinci/ve/widgets/MutableStore",["dojo/_base/declare","dojo/data/ItemFileReadStore","dojo/i18n!davinci/ve/nls/ve","dojo/i18n!dijit/nls/common"],function(_1346,_1347,veNLS,_1348){
return _1346("davinci.ve.widgets.MutableStore",_1347,{constructor:function(args){
this.clearValues();
if(args.divider){
this.divider=args.divider;
}
if(args.values){
this.setValues(args.values);
}
},setValues:function(_1349){
var items=[];
var _134a=0;
if(_1349){
this._values=_1349;
}
dojo.forEach(this._values,dojo.hitch(this,function(v){
items.push({name:v,value:v,id:_134a++});
}));
this._jsonData={identifier:"id",items:items};
this._loadFinished=false;
},modifyItem:function(_134b,_134c){
for(var i=0;i<this._values.length;i++){
if(this._values[i]==_134b){
this._values[i]=_134c;
}
}
this.setValues();
},insert:function(_134d,value){
this._values.splice(_134d,0,value);
this.setValues();
},contains:function(item){
for(var i=0;i<this._values.length;i++){
if(this._values[i]==item){
return true;
}
}
return false;
},findSimilar:function(value){
var _134e=new RegExp(/(\D*)(-?)(\d+)(\D*)/);
var _134f=_134e.exec(value);
if(!_134f){
return;
}
var _1350=new RegExp((_134f.length>0?_134f[1]:"")+"(-?)(\\d+)"+(_134f.length>3?_134f[4]:""));
for(var i=0;i<this._values.length;i++){
if(_1350.test(this._values[i])){
return this._values[i];
}
}
},getItemNumber:function(index){
return this._values[index];
},clearValues:function(){
this._loadFinished=false;
}});
});
},"dijit/form/RangeBoundTextBox":function(){
define("dijit/form/RangeBoundTextBox",["dojo/_base/declare","dojo/i18n","./MappedTextBox"],function(_1351,i18n,_1352){
var _1353=_1351("dijit.form.RangeBoundTextBox",_1352,{rangeMessage:"",rangeCheck:function(_1354,_1355){
return ("min" in _1355?(this.compare(_1354,_1355.min)>=0):true)&&("max" in _1355?(this.compare(_1354,_1355.max)<=0):true);
},isInRange:function(){
return this.rangeCheck(this.get("value"),this.constraints);
},_isDefinitelyOutOfRange:function(){
var val=this.get("value");
if(val==null){
return false;
}
var _1356=false;
if("min" in this.constraints){
var min=this.constraints.min;
_1356=this.compare(val,((typeof min=="number")&&min>=0&&val!=0)?0:min)<0;
}
if(!_1356&&("max" in this.constraints)){
var max=this.constraints.max;
_1356=this.compare(val,((typeof max!="number")||max>0)?max:0)>0;
}
return _1356;
},_isValidSubset:function(){
return this.inherited(arguments)&&!this._isDefinitelyOutOfRange();
},isValid:function(_1357){
return this.inherited(arguments)&&((this._isEmpty(this.textbox.value)&&!this.required)||this.isInRange(_1357));
},getErrorMessage:function(_1358){
var v=this.get("value");
if(v!=null&&v!==""&&(typeof v!="number"||!isNaN(v))&&!this.isInRange(_1358)){
return this.rangeMessage;
}
return this.inherited(arguments);
},postMixInProperties:function(){
this.inherited(arguments);
if(!this.rangeMessage){
this.messages=i18n.getLocalization("dijit.form","validate",this.lang);
this.rangeMessage=this.messages.rangeMessage;
}
},_setConstraintsAttr:function(_1359){
this.inherited(arguments);
if(this.focusNode){
if(this.constraints.min!==undefined){
this.focusNode.setAttribute("aria-valuemin",this.constraints.min);
}else{
this.focusNode.removeAttribute("aria-valuemin");
}
if(this.constraints.max!==undefined){
this.focusNode.setAttribute("aria-valuemax",this.constraints.max);
}else{
this.focusNode.removeAttribute("aria-valuemax");
}
}
},_setValueAttr:function(value,_135a){
this.focusNode.setAttribute("aria-valuenow",value);
this.inherited(arguments);
},applyTextDir:function(){
}});
return _1353;
});
},"davinci/ve/commands/ChangeThemeCommand":function(){
define("davinci/ve/commands/ChangeThemeCommand",["dojo/_base/declare","dojo/_base/lang","dojo/query","davinci/Theme","davinci/Workbench","davinci/library","davinci/html/CSSImport","davinci/html/HTMLElement","davinci/html/HTMLText","preview/silhouetteiframe","davinci/model/Factory",],function(_135b,lang,query,Theme,_135c,_135d,_135e,_135f,_1360,_1361,_1362){
return _135b("davinci.ve.commands.ChangeThemeCommand",null,{name:"changeTheme",constructor:function(_1363,_1364){
this._newTheme=_1363;
this._context=_1364;
this._oldTheme=Theme.getThemeSet(this._context);
if(!this._oldTheme){
this._oldTheme=Theme.dojoThemeSets.themeSets[0];
}
},execute:function(){
this._changeTheme(this._newTheme,this._oldTheme);
},undo:function(){
this._changeTheme(this._oldTheme,this._newTheme);
},_changeTheme:function(_1365,_1366){
if(!_1366.desktopTheme){
this.removeTheme(_1366);
}else{
this.removeThemeSet(_1366);
}
if(!_1365.desktopTheme){
this.addTheme(_1365);
}else{
this.addThemeSet(_1365);
}
var _1367=this._context,_1368=_1367.editor,text=_1367.getModel().getText();
_1368.setContent(_1368.fileName,text);
_1367.widgetAddedOrDeleted(true);
_1367._configDojoxMobile();
var _1369=_1367.getMobileDevice()||"none";
if(_1369!="none"){
_1369=_1361.themeMap[_1369+".svg"];
}
var dm=lang.getObject("dojox.mobile",true,_1367.getGlobal());
if(dm&&dm.loadDeviceTheme){
dm.loadDeviceTheme(_1369);
}
window.setTimeout(function(){
this._context.resizeAllWidgets();
}.bind(this),50);
},removeTheme:function(_136a){
var _136b=Theme.getHelper(_136a);
if(_136b&&_136b.removeTheme){
_136b.removeTheme(this._context,_136a);
}else{
var _136c=this._context.getModel().getDocumentElement(),_136d=_136c.getChildElement("head"),_136e=_136c.getChildElement("body"),_136f=dojo.clone(this._context.getHeader());
function _1370(_1371,file){
return (_1371.indexOf(file)>-1);
};
var files=_136a.files;
if(_136a.conditionalFiles){
files=files.concat(_136a.conditionalFiles);
}
for(var x=0;x<files.length;x++){
var _1372=files[x];
for(var y=0;y<_136f.styleSheets.length;y++){
if(_1370(_136f.styleSheets[y],_1372)){
var _1373=_136e.getAttribute("class");
if(_1373){
_1373=_1373.replace(_136a.className,"");
_136f.bodyClasses=_1373;
_136e.removeAttribute("class");
if(_1373.length>0){
_136e.addAttribute("class",_1373,false);
}
}
this._context.setHeader(_136f);
var _1374=_136d.find({elementType:"CSSImport"});
for(var i=0;i<_1374.length;i++){
if(_1370(_1374[i].url,_1372)){
var url=_1374[i].url,doc=this._context.getDocument();
_1374[i].url="x";
_1374[i].parent.removeChild(_1374[i]);
_1374[i].close();
query("link[href=\""+url+"\"]",doc).orphan();
this._context.theme=null;
break;
}
}
}
}
}
}
},addTheme:function(_1375){
var _1376=Theme.getHelper(_1375);
if(_1376&&_1376.addTheme){
_1376.addTheme(this._context,_1375);
}else{
var _1377=this._context.getModel().getDocumentElement();
var _1378=_1377.getChildElement("head");
var _1379=_1377.getChildElement("body");
var _137a=dojo.clone(this._context.getHeader());
var _137b=this._context.getFullResourcePath();
var _137c=new davinci.model.Path(_1375.file.parent.getPath()).append(_1375.files[0]);
var _137d=_137c.relativeTo(_137b,true);
var _137e=_137d.toString();
_137a.styleSheets[_137a.styleSheets.length]=_137e;
var _137f=_1379.getAttribute("class");
if(!_137f){
_137f=" ";
}
_137f=_137f+" "+_1375.className;
_137f=_137f.trim();
_137a.bodyClasses=_137f;
_1379.removeAttribute("class");
_1379.addAttribute("class",_137f,false);
this._context.setHeader(_137a);
var style=_1378.getChildElement("style");
if(!style){
style=new _135f("style");
_1378.addChild(style);
}
var css=new _135e();
css.url=_137e;
var _1380=_1362.getModel({url:Theme.getBase()+"/"+css.url,includeImports:true,});
css.cssFile=_1380;
style.addChild(css,0);
this._context.theme=_1375;
}
},removeThemeSet:function(_1381){
var _1382=_135d.getThemes(_135c.getProject(),this.workspaceOnly,true);
if(_1381.desktopTheme){
for(var i=0;i<_1382.length;i++){
if(_1382[i].name===_1381.desktopTheme){
this.removeTheme(_1382[i]);
}
}
}
if(_1381.mobileTheme&&(!Theme.themeSetEquals(_1381.mobileTheme,Theme.dojoMobileDefault))){
this._context.close();
this._dojoxMobileRemoveTheme(this._context);
}
},addThemeSet:function(_1383){
var _1384=_135d.getThemes(_135c.getProject(),this.workspaceOnly,true);
if(_1383.desktopTheme){
for(var i=0;i<_1384.length;i++){
if(_1384[i].name===_1383.desktopTheme){
this.addTheme(_1384[i]);
}
}
}
if(_1383.mobileTheme){
this._dojoxMobileAddTheme(this._context,_1383.mobileTheme);
}
},_dojoxMobileRemoveTheme:function(_1385){
_1385._updateDojoConfig({themeMap:null,mblLoadCompatPattern:null,mblThemeFiles:null});
},_dojoxMobileAddTheme:function(_1386,theme,_1387){
if(Theme.themeSetEquals(theme,Theme.dojoMobileDefault)){
this._dojoxMobileRemoveTheme(_1386);
return;
}
var _1388=Theme.getThemeLocation().toString().replace(/\//g,"\\/");
var re="/\\/"+_1388+"\\/.*\\.css$/";
_1386._updateDojoConfig({themeMap:Theme.getDojoxMobileThemeMap(_1386,theme),mblLoadCompatPattern:re,mblThemeFiles:[]});
}});
});
},"davinci/ve/commands/RemoveCommand":function(){
define(["dojo/_base/declare","davinci/ve/widget","davinci/ve/States"],function(_1389,_138a,_138b){
return _1389("davinci.ve.commands.RemoveCommand",null,{name:"remove",constructor:function(_138c){
this._id=(_138c?_138c.id:undefined);
},execute:function(){
if(!this._id){
return;
}
var _138d=_138a.byId(this._id);
if(!_138d){
return;
}
var _138e=_138d.getContext(),_138f=_138d.getParent()||_138e.getContainerNode();
var _1390;
var _1391=_138d.getHelper();
if(_1391&&_1391.onRemove){
_1390=_1391.onRemove(_138d);
}
if(!this._data){
this._index=dojo.indexOf(_138f.getChildren(),_138d);
if(this._index<0){
return;
}
this._data=_138d.getData();
this._parentId=_138f.id;
}
this._data.context=_138e;
if(_138e){
_138e.detach(_138d);
}
_138f.removeChild(_138d);
if(_138e){
_138e.widgetChanged(_138e.WIDGET_REMOVED,_138d);
}
_138d.destroyWidget();
if(_138e){
_138e.widgetAddedOrDeleted();
}
_138b.resetState(_138d.domNode);
if(_1390){
_1390();
}
},undo:function(){
if(!this._data||!this._parentId){
return;
}
var _1392=_138a.byId(this._parentId);
if(!_1392){
return;
}
var _1393=_138a.createWidget(this._data);
if(!_1393){
return;
}
_1392.addChild(_1393,this._index);
var _1394=_1392.getContext();
if(_1394){
_1394.attach(_1393);
_1393.startup();
_1393.renderWidget();
_1394.widgetAddedOrDeleted();
_1394.widgetChanged(_1394.WIDGET_ADDED,_1393);
_138b.resetState(_1393.domNode);
}
}});
});
},"dojo/dnd/Container":function(){
define("dojo/dnd/Container",["../_base/array","../_base/declare","../_base/event","../_base/kernel","../_base/lang","../_base/window","../dom","../dom-class","../dom-construct","../Evented","../has","../on","../query","../ready","../touch","./common"],function(array,_1395,event,_1396,lang,win,dom,_1397,_1398,_1399,has,on,query,ready,touch,dnd){
var _139a=_1395("dojo.dnd.Container",_1399,{skipForm:false,allowNested:false,constructor:function(node,_139b){
this.node=dom.byId(node);
if(!_139b){
_139b={};
}
this.creator=_139b.creator||null;
this.skipForm=_139b.skipForm;
this.parent=_139b.dropParent&&dom.byId(_139b.dropParent);
this.map={};
this.current=null;
this.containerState="";
_1397.add(this.node,"dojoDndContainer");
if(!(_139b&&_139b._skipStartup)){
this.startup();
}
this.events=[on(this.node,touch.over,lang.hitch(this,"onMouseOver")),on(this.node,touch.out,lang.hitch(this,"onMouseOut")),on(this.node,"dragstart",lang.hitch(this,"onSelectStart")),on(this.node,"selectstart",lang.hitch(this,"onSelectStart"))];
},creator:function(){
},getItem:function(key){
return this.map[key];
},setItem:function(key,data){
this.map[key]=data;
},delItem:function(key){
delete this.map[key];
},forInItems:function(f,o){
o=o||_1396.global;
var m=this.map,e=dnd._empty;
for(var i in m){
if(i in e){
continue;
}
f.call(o,m[i],i,this);
}
return o;
},clearItems:function(){
this.map={};
},getAllNodes:function(){
return query((this.allowNested?"":"> ")+".dojoDndItem",this.parent);
},sync:function(){
var map={};
this.getAllNodes().forEach(function(node){
if(node.id){
var item=this.getItem(node.id);
if(item){
map[node.id]=item;
return;
}
}else{
node.id=dnd.getUniqueId();
}
var type=node.getAttribute("dndType"),data=node.getAttribute("dndData");
map[node.id]={data:data||node.innerHTML,type:type?type.split(/\s*,\s*/):["text"]};
},this);
this.map=map;
return this;
},insertNodes:function(data,_139c,_139d){
if(!this.parent.firstChild){
_139d=null;
}else{
if(_139c){
if(!_139d){
_139d=this.parent.firstChild;
}
}else{
if(_139d){
_139d=_139d.nextSibling;
}
}
}
var i,t;
if(_139d){
for(i=0;i<data.length;++i){
t=this._normalizedCreator(data[i]);
this.setItem(t.node.id,{data:t.data,type:t.type});
_139d.parentNode.insertBefore(t.node,_139d);
}
}else{
for(i=0;i<data.length;++i){
t=this._normalizedCreator(data[i]);
this.setItem(t.node.id,{data:t.data,type:t.type});
this.parent.appendChild(t.node);
}
}
return this;
},destroy:function(){
array.forEach(this.events,function(_139e){
_139e.remove();
});
this.clearItems();
this.node=this.parent=this.current=null;
},markupFactory:function(_139f,node,Ctor){
_139f._skipStartup=true;
return new Ctor(node,_139f);
},startup:function(){
if(!this.parent){
this.parent=this.node;
if(this.parent.tagName.toLowerCase()=="table"){
var c=this.parent.getElementsByTagName("tbody");
if(c&&c.length){
this.parent=c[0];
}
}
}
this.defaultCreator=dnd._defaultCreator(this.parent);
this.sync();
},onMouseOver:function(e){
var n=e.relatedTarget;
while(n){
if(n==this.node){
break;
}
try{
n=n.parentNode;
}
catch(x){
n=null;
}
}
if(!n){
this._changeState("Container","Over");
this.onOverEvent();
}
n=this._getChildByEvent(e);
if(this.current==n){
return;
}
if(this.current){
this._removeItemClass(this.current,"Over");
}
if(n){
this._addItemClass(n,"Over");
}
this.current=n;
},onMouseOut:function(e){
for(var n=e.relatedTarget;n;){
if(n==this.node){
return;
}
try{
n=n.parentNode;
}
catch(x){
n=null;
}
}
if(this.current){
this._removeItemClass(this.current,"Over");
this.current=null;
}
this._changeState("Container","");
this.onOutEvent();
},onSelectStart:function(e){
if(!this.skipForm||!dnd.isFormElement(e)){
event.stop(e);
}
},onOverEvent:function(){
},onOutEvent:function(){
},_changeState:function(type,_13a0){
var _13a1="dojoDnd"+type;
var state=type.toLowerCase()+"State";
_1397.replace(this.node,_13a1+_13a0,_13a1+this[state]);
this[state]=_13a0;
},_addItemClass:function(node,type){
_1397.add(node,"dojoDndItem"+type);
},_removeItemClass:function(node,type){
_1397.remove(node,"dojoDndItem"+type);
},_getChildByEvent:function(e){
var node=e.target;
if(node){
for(var _13a2=node.parentNode;_13a2;node=_13a2,_13a2=node.parentNode){
if((_13a2==this.parent||this.allowNested)&&_1397.contains(node,"dojoDndItem")){
return node;
}
}
}
return null;
},_normalizedCreator:function(item,hint){
var t=(this.creator||this.defaultCreator).call(this,item,hint);
if(!lang.isArray(t.type)){
t.type=["text"];
}
if(!t.node.id){
t.node.id=dnd.getUniqueId();
}
_1397.add(t.node,"dojoDndItem");
return t;
}});
dnd._createNode=function(tag){
if(!tag){
return dnd._createSpan;
}
return function(text){
return _1398.create(tag,{innerHTML:text});
};
};
dnd._createTrTd=function(text){
var tr=_1398.create("tr");
_1398.create("td",{innerHTML:text},tr);
return tr;
};
dnd._createSpan=function(text){
return _1398.create("span",{innerHTML:text});
};
dnd._defaultCreatorNodes={ul:"li",ol:"li",div:"div",p:"div"};
dnd._defaultCreator=function(node){
var tag=node.tagName.toLowerCase();
var c=tag=="tbody"||tag=="thead"?dnd._createTrTd:dnd._createNode(dnd._defaultCreatorNodes[tag]);
return function(item,hint){
var isObj=item&&lang.isObject(item),data,type,n;
if(isObj&&item.tagName&&item.nodeType&&item.getAttribute){
data=item.getAttribute("dndData")||item.innerHTML;
type=item.getAttribute("dndType");
type=type?type.split(/\s*,\s*/):["text"];
n=item;
}else{
data=(isObj&&item.data)?item.data:item;
type=(isObj&&item.type)?item.type:["text"];
n=(hint=="avatar"?dnd._createSpan:c)(String(data));
}
if(!n.id){
n.id=dnd.getUniqueId();
}
return {node:n,data:data,type:type};
};
};
return _139a;
});
},"davinci/ui/ModelEditor":function(){
define("davinci/ui/ModelEditor",["dojo/_base/declare","./TextEditor"],function(_13a3,_13a4){
return _13a3(_13a4,{constructor:function(_13a5,_13a6){
this.subscribe("/davinci/ui/selectionChanged",this.selectModel);
},colorize:function(text){
return null;
},setContent:function(_13a7,_13a8){
this.inherited(arguments);
this.model.fileName=_13a7;
this.model.setText(_13a8);
},getHoverText:function(x,y){
var _13a9=this.convertMouseToLine(x,y);
var _13aa=this.model.findChildAtPosition({startOffset:_13a9.row,endOffset:_13a9.col});
return _13aa.getLabel();
},handleChange:function(text){
this.inherited(arguments);
this.model.setText(text);
var _13ab={newModel:this.model};
dojo.publish("/davinci/ui/modelChanged",[_13ab]);
},selectModel:function(_13ac,_13ad){
if(this.publishingSelect||(_13ad&&this!=_13ad)){
return;
}
if(_13ac.length&&_13ac[0].model){
var model=_13ac[0].model;
if(model.elementType){
var sobj=this.model.mapPositions(model);
this.select(sobj);
}
}
},selectionChange:function(_13ae){
var _13af=this.model.mapPositions(this.model);
var diff=this.model.endOffset-_13af.endOffset;
var _13b0={startOffset:_13ae.startOffset+diff,endOffset:_13ae.endOffset+diff-1};
var _13b1=this.model.findChildAtPosition(_13b0);
_13ae.model=_13b1;
if(_13b1!=this._selectedModel){
try{
this.publishingSelect=true;
dojo.publish("/davinci/ui/selectionChanged",[[_13ae],this]);
}
finally{
this.publishingSelect=false;
}
}
this._selectedModel=_13b1;
},getSyntaxPositions:function(text,_13b2){
this.model.setText(text);
if(this.model.getSyntaxPositions){
var _13b3=this.model.getSyntaxPositions(_13b2);
function _13b4(a,b){
if(a.line!=b.line){
return a.line-b.line;
}
return a.col-b.col;
};
_13b3=_13b3.sort(_13b4);
return _13b3;
}
},save:function(){
this.model.setText(this.getText());
this.inherited(arguments);
},getErrors:function(){
return this.model.errors||[];
}});
});
},"davinci/workbench/WidgetLite":function(){
define("davinci/workbench/WidgetLite",["dojo/_base/declare","dijit/_WidgetBase","dojo/parser"],function(_13b5,_13b6,_13b7){
return _13b5("davinci.workbench.WidgetLite",[_13b6],{buildRendering:function(){
if(!this.domNode){
this.domNode=dojo.create("div");
}
if(/dojotype/i.test(this.domNode.innerHTML||"")){
var qry,attr;
if(_13b7._query!="[dojoType]"){
qry=_13b7._query;
attr=_13b7._attrName;
_13b7._query="[dojoType]";
_13b7._attrName="dojoType";
}
this._startupWidgets=dojo.parser.parse(this.domNode,{noStart:!this._earlyTemplatedStartup,inherited:{dir:this.dir,lang:this.lang}});
if(qry){
_13b7._query=qry;
_13b7._attrName=attr;
}
}
},_destroyContent:function(){
var _13b8=(this.containerNode||this.domNode);
dojo.forEach(dojo.query("[widgetId]",_13b8).map(dijit.byNode),function(w){
w.destroy();
});
while(_13b8.firstChild){
dojo._destroyElement(_13b8.firstChild);
}
dojo.forEach(this._tooltips,function(t){
t.destroy();
});
delete this._tooltips;
},startup:function(){
dojo.forEach(this._startupWidgets,function(w){
if(w&&!w._started&&w.startup){
w.startup();
}
});
this.inherited(arguments);
}});
});
},"dojox/color/_base":function(){
define("dojox/color/_base",["../main","dojo/_base/lang","dojo/_base/Color","dojo/colors"],function(dojox,lang,Color,_13b9){
var cx=lang.getObject("color",true,dojox);
cx.Color=Color;
cx.blend=Color.blendColors;
cx.fromRgb=Color.fromRgb;
cx.fromHex=Color.fromHex;
cx.fromArray=Color.fromArray;
cx.fromString=Color.fromString;
cx.greyscale=_13b9.makeGrey;
lang.mixin(cx,{fromCmy:function(cyan,_13ba,_13bb){
if(lang.isArray(cyan)){
_13ba=cyan[1],_13bb=cyan[2],cyan=cyan[0];
}else{
if(lang.isObject(cyan)){
_13ba=cyan.m,_13bb=cyan.y,cyan=cyan.c;
}
}
cyan/=100,_13ba/=100,_13bb/=100;
var r=1-cyan,g=1-_13ba,b=1-_13bb;
return new Color({r:Math.round(r*255),g:Math.round(g*255),b:Math.round(b*255)});
},fromCmyk:function(cyan,_13bc,_13bd,black){
if(lang.isArray(cyan)){
_13bc=cyan[1],_13bd=cyan[2],black=cyan[3],cyan=cyan[0];
}else{
if(lang.isObject(cyan)){
_13bc=cyan.m,_13bd=cyan.y,black=cyan.b,cyan=cyan.c;
}
}
cyan/=100,_13bc/=100,_13bd/=100,black/=100;
var r,g,b;
r=1-Math.min(1,cyan*(1-black)+black);
g=1-Math.min(1,_13bc*(1-black)+black);
b=1-Math.min(1,_13bd*(1-black)+black);
return new Color({r:Math.round(r*255),g:Math.round(g*255),b:Math.round(b*255)});
},fromHsl:function(hue,_13be,_13bf){
if(lang.isArray(hue)){
_13be=hue[1],_13bf=hue[2],hue=hue[0];
}else{
if(lang.isObject(hue)){
_13be=hue.s,_13bf=hue.l,hue=hue.h;
}
}
_13be/=100;
_13bf/=100;
while(hue<0){
hue+=360;
}
while(hue>=360){
hue-=360;
}
var r,g,b;
if(hue<120){
r=(120-hue)/60,g=hue/60,b=0;
}else{
if(hue<240){
r=0,g=(240-hue)/60,b=(hue-120)/60;
}else{
r=(hue-240)/60,g=0,b=(360-hue)/60;
}
}
r=2*_13be*Math.min(r,1)+(1-_13be);
g=2*_13be*Math.min(g,1)+(1-_13be);
b=2*_13be*Math.min(b,1)+(1-_13be);
if(_13bf<0.5){
r*=_13bf,g*=_13bf,b*=_13bf;
}else{
r=(1-_13bf)*r+2*_13bf-1;
g=(1-_13bf)*g+2*_13bf-1;
b=(1-_13bf)*b+2*_13bf-1;
}
return new Color({r:Math.round(r*255),g:Math.round(g*255),b:Math.round(b*255)});
}});
cx.fromHsv=function(hue,_13c0,value){
if(lang.isArray(hue)){
_13c0=hue[1],value=hue[2],hue=hue[0];
}else{
if(lang.isObject(hue)){
_13c0=hue.s,value=hue.v,hue=hue.h;
}
}
if(hue==360){
hue=0;
}
_13c0/=100;
value/=100;
var r,g,b;
if(_13c0==0){
r=value,b=value,g=value;
}else{
var hTemp=hue/60,i=Math.floor(hTemp),f=hTemp-i;
var p=value*(1-_13c0);
var q=value*(1-(_13c0*f));
var t=value*(1-(_13c0*(1-f)));
switch(i){
case 0:
r=value,g=t,b=p;
break;
case 1:
r=q,g=value,b=p;
break;
case 2:
r=p,g=value,b=t;
break;
case 3:
r=p,g=q,b=value;
break;
case 4:
r=t,g=p,b=value;
break;
case 5:
r=value,g=p,b=q;
break;
}
}
return new Color({r:Math.round(r*255),g:Math.round(g*255),b:Math.round(b*255)});
};
lang.extend(Color,{toCmy:function(){
var cyan=1-(this.r/255),_13c1=1-(this.g/255),_13c2=1-(this.b/255);
return {c:Math.round(cyan*100),m:Math.round(_13c1*100),y:Math.round(_13c2*100)};
},toCmyk:function(){
var cyan,_13c3,_13c4,black;
var r=this.r/255,g=this.g/255,b=this.b/255;
black=Math.min(1-r,1-g,1-b);
cyan=(1-r-black)/(1-black);
_13c3=(1-g-black)/(1-black);
_13c4=(1-b-black)/(1-black);
return {c:Math.round(cyan*100),m:Math.round(_13c3*100),y:Math.round(_13c4*100),b:Math.round(black*100)};
},toHsl:function(){
var r=this.r/255,g=this.g/255,b=this.b/255;
var min=Math.min(r,b,g),max=Math.max(r,g,b);
var delta=max-min;
var h=0,s=0,l=(min+max)/2;
if(l>0&&l<1){
s=delta/((l<0.5)?(2*l):(2-2*l));
}
if(delta>0){
if(max==r&&max!=g){
h+=(g-b)/delta;
}
if(max==g&&max!=b){
h+=(2+(b-r)/delta);
}
if(max==b&&max!=r){
h+=(4+(r-g)/delta);
}
h*=60;
}
return {h:h,s:Math.round(s*100),l:Math.round(l*100)};
},toHsv:function(){
var r=this.r/255,g=this.g/255,b=this.b/255;
var min=Math.min(r,b,g),max=Math.max(r,g,b);
var delta=max-min;
var h=null,s=(max==0)?0:(delta/max);
if(s==0){
h=0;
}else{
if(r==max){
h=60*(g-b)/delta;
}else{
if(g==max){
h=120+60*(b-r)/delta;
}else{
h=240+60*(r-g)/delta;
}
}
if(h<0){
h+=360;
}
}
return {h:h,s:Math.round(s*100),v:Math.round(max*100)};
}});
return cx;
});
},"dojo/dnd/common":function(){
define("dojo/dnd/common",["../_base/connect","../_base/kernel","../_base/lang","../dom"],function(_13c5,_13c6,lang,dom){
var _13c7={};
_13c7.getCopyKeyState=_13c5.isCopyKey;
_13c7._uniqueId=0;
_13c7.getUniqueId=function(){
var id;
do{
id=_13c6._scopeName+"Unique"+(++_13c7._uniqueId);
}while(dom.byId(id));
return id;
};
_13c7._empty={};
_13c7.isFormElement=function(e){
var t=e.target;
if(t.nodeType==3){
t=t.parentNode;
}
return " button textarea input select option ".indexOf(" "+t.tagName.toLowerCase()+" ")>=0;
};
lang.mixin(lang.getObject("dojo.dnd",true),_13c7);
return _13c7;
});
},"davinci/actions/UndoAction":function(){
define(["dojo/_base/declare","./Action","../Workbench"],function(_13c8,_13c9,_13ca){
return _13c8("davinci.actions.UndoAction",_13c9,{run:function(_13cb){
var e=_13ca.getOpenEditor();
if(e&&e.getContext){
e.getContext().getCommandStack().undo();
}
},isEnabled:function(_13cc){
var e=_13ca.getOpenEditor();
var _13cd=e&&e.getContext&&e.getContext();
if(e&&_13cd){
var _13ce=_13cd.getCommandStack().canUndo();
if(e.declaredClass=="davinci.ve.PageEditor"){
var _13cf=e.getDisplayMode();
return _13ce&&_13cf!="source";
}else{
return _13ce;
}
}else{
return false;
}
}});
});
},"davinci/ve/palette/PaletteFolder":function(){
define("davinci/ve/palette/PaletteFolder",["dojo/_base/declare","dijit/_WidgetBase","dojo/fx",],function(_13d0,_13d1,fx){
return _13d0("davinci.ve.palette.PaletteFolder",_13d1,{icon:"",displayName:"",paletteId:"",palette:null,buildRendering:function(){
this.palette=dijit.byId(this.paletteId);
var div=this.domNode=this.palette.folderTemplate.cloneNode(true);
var a=div.firstChild;
dojo.attr(a,"tabIndex","0");
a.onclick=this.palette.nop;
var img=a.firstChild;
img.src=this.icon;
a.appendChild(dojo.doc.createTextNode(this.displayName));
},postCreate:function(){
this.connect(this.domNode,"onmouseover","folderMouseOverHandler");
this.connect(this.domNode,"onmouseout","folderMouseOutHandler");
this.connect(this.domNode,"onclick","folderClickHandler");
},startup:function(){
},isFocusable:function(){
return true;
},focus:function(){
dijit.focus(this.domNode);
},addChild:function(node){
var _13d2=this.palette.getChildren();
for(var i=0,len=_13d2.length;i<len;i++){
var child=_13d2[i];
if(child!=this){
continue;
}
this.palette.addChild(node,i+1);
return true;
}
return false;
},folderClickHandler:function(evt){
var _13d3=this.palette.getChildren();
for(var i=0,len=_13d3.length;i<len;i++){
var child=_13d3[i];
if(child!=this){
continue;
}
for(var j=i+1;j<len;j++){
child=_13d3[j];
if(child.declaredClass!="davinci.ve.palette.PaletteItem"){
break;
}
if(dojo.style(child.domNode,"display")=="none"){
fx.wipeIn({node:child.id,duration:200}).play();
}else{
fx.wipeOut({node:child.id,duration:200}).play();
}
}
break;
}
return false;
},folderMouseOverHandler:function(evt){
dojo.removeClass(this.domNode,"dojoyPaletteFolderLow");
dojo.addClass(this.domNode,"dojoyPaletteFolderHi");
},folderMouseOutHandler:function(evt){
dojo.removeClass(this.domNode,"dojoyPaletteFolderHi");
dojo.addClass(this.domNode,"dojoyPaletteFolderLow");
}});
});
},"url:davinci/ui/templates/ChooseDevice.html":"<div>\n  <select dojoType=\"dijit.form.Select\" dojoAttachPoint=\"select\" style=\"width: 100%\">\n  </select>\n</div>\n","orion/textview/i18nUtil":function(){
define("orion/textview/i18nUtil",function(){
function _13d4(msg){
var args=arguments;
return msg.replace(/\$\{([^\}]+)\}/g,function(str,index){
return args[(index<<0)+1];
});
};
return {formatMessage:_13d4};
});
},"davinci/actions/SaveAsWidget":function(){
define(["dojo/_base/declare","./Action","../Workbench","davinci/ui/Dialog","../ui/SaveAsWidgetForm","dojo/i18n!../ui/nls/common"],function(_13d5,_13d6,_13d7,_13d8,_13d9,_13da){
return _13d5("davinci.actions.SaveAsWidget",_13d6,{run:function(_13db){
if(_13db.declaredClass!=="davinci.ve.Context"){
if(typeof _13db.getContext==="function"){
_13db=_13db.getContext();
}else{
_13db=_13d7.getOpenEditor().getContext();
}
}
var _13dc=this._generateMetadata(_13db);
this._showDialog(_13dc);
},_generateMetadata:function(_13dd){
var _13de={spec:"1.0",require:[],library:{}};
var body=_13dd.model.find({elementType:"HTMLElement",tag:"body"},true);
_13de.content=dojo.trim(body.getText(_13dd).match(/<body[^>]*>([\s\S]*)<\/body>/)[1]);
this._getRequires(_13dd.getTopWidgets(),_13de);
return _13de;
},_getRequires:function(_13df,_13e0){
function _13e1(_13e2,_13e3,types){
dojo.forEach(_13e2,function(w){
if(!types.hasOwnProperty(w.type)){
types[w.type]=true;
dojo.forEach(w.metadata.require,function(r){
if(!this._inRequiresArray(r,_13e3.require)){
_13e3.require.push(r);
}
},this);
for(var l in w.metadata.library){
if(w.metadata.library.hasOwnProperty(l)){
if(!_13e3.library[l]){
_13e3.library[l]=w.metadata.library[l];
}
}
}
}
_13e1.call(this,w.getChildren(),_13e3,types);
},this);
};
var types=types||{};
_13e1.call(this,_13df,_13e0,types);
if(_13e0.require.length>1){
var r2=_13e0.require.slice(0,1);
for(var i=1;i<_13e0.require.length;i++){
var req=_13e0.require[i];
if(req.$text&&r2[r2.length-1].$text){
r2[r2.length-1].$text+="\n"+req.$text;
}else{
r2.push(req);
}
}
_13e0.require=r2;
}
},_inRequiresArray:function(req,array){
var _13e4=req.$text?req.$text.replace(/\s/g," "):"";
return dojo.some(array,function(item){
return (req.type===item.type&&((req.src&&item.src&&req.src===item.src&&((req.$library&&item.$library&&req.$library===item.$library)||(!req.$library&&!item.$library)))||(req.$text&&item.$text&&_13e4===item.$text.replace(/\s/g," "))));
});
},_showDialog:function(_13e5){
var _13e6=new _13d8({title:_13da.sawdTitle,"class":"dvSaveAsWidgetDialog",execute:dojo.hitch(this,function(){
this._saveMetadata(arguments[0].metadata);
}),onHide:function(){
setTimeout(function(){
_13e6.destroyRecursive();
},_13e6.duration);
}});
var form=new _13d9({parentId:_13e6.id,metadata:_13e5});
_13e6.set("content",form);
_13e6.show();
},_saveMetadata:function(_13e7){
}});
});
},"davinci/ve/widgets/WidgetProperties":function(){
define(["dojo/_base/declare","dojo/_base/connect","davinci/workbench/ViewLite","davinci/ve/metadata","davinci/commands/CompoundCommand","davinci/ve/commands/ModifyCommand","dojo/i18n!davinci/ve/nls/ve","dojo/i18n!dijit/nls/common","./HTMLStringUtil"],function(_13e8,_13e9,_13ea,_13eb,_13ec,_13ed,veNLS,_13ee,_13ef){
return _13e8("davinci.ve.widgets.WidgetProperties",[_13ea],{key:"widgetSpecific",_connects:null,buildRendering:function(){
this.domNode=this.propDom=dojo.doc.createElement("div");
dojo.addClass(this.domNode,"propGroup");
dojo.attr(this.domNode,"propGroup",this.key);
this._connects=[];
this.inherited(arguments);
},onWidgetSelectionChange:function(){
if(!this._widget||!this._editor||this._editor.editorID!="davinci.ve.HTMLPageEditor"){
this._disconnectAll();
this._destroyProperties();
return;
}
var _13f0=davinci.ve.metadata.query(this._widget);
var _13f1=this._widget.getParent();
if(_13f1&&_13f1.isWidget){
var _13f2=_13eb.query(_13f1);
if(_13f2&&_13f2.childProperties){
if(!_13f0.$ownproperty){
_13f0.$ownproperty=_13f2.childProperties;
}else{
for(var prop in _13f2.childProperties){
_13f0.$ownproperty[prop]=_13f2.childProperties[prop];
}
}
}
}
if(!_13f0||!_13f0.$ownproperty){
return;
}
this._disconnectAll();
this._destroyProperties();
var props={};
if(!_13f0.$ownproperty.title){
props.title={datatype:"string"};
}
for(var prop in _13f0.$ownproperty){
props[prop]=_13f0.$ownproperty[prop];
}
var rows=this.propDom.innerHTML=this._createWidgetRows(props);
if(rows.indexOf("data-dojo-type")!==-1||rows.indexOf("dojoType")!==-1){
dojo.parser.parse(this.propDom);
}
this._setValues();
this._connectAll();
},onEditorSelected:function(_13f3){
this._editor=_13f3;
if(_13f3&&_13f3.editorID=="davinci.ve.HTMLPageEditor"){
this.context=_13f3.getContext();
this._widget=this.context.getSelection()[0];
}else{
this.context=null;
this._widget=null;
}
this.onWidgetSelectionChange();
},_createWidgetRows:function(_13f4){
this._pageLayout=[];
for(var name in _13f4){
var _13f5=_13f4[name];
if(_13f5.hidden){
continue;
}
var prop={display:(_13f5.title||name),type:_13f5.datatype,target:name,hideCascade:true};
if(_13f5.dropdownQueryValues&&_13f5.dropdownQueryAttribute){
var _13f6=[];
dojo.forEach(_13f5.dropdownQueryValues,dojo.hitch(this,function(query){
var _13f7=dojo.query(query,this.context.rootNode);
dojo.forEach(_13f7,function(node){
_13f6.push(node.getAttribute(_13f5.dropdownQueryAttribute));
});
}));
prop.values=_13f6;
prop.type="comboEdit";
}
if(dojo.isArray(_13f5.mustHaveAncestor)){
var found=false;
var w=this._widget;
while(!found&&w&&w.getParent()!=this.context.rootWidget){
w=w.getParent();
if(w&&dojo.indexOf(_13f5.mustHaveAncestor,w.type)>-1){
found=true;
}
}
if(found){
}else{
prop.disabled=true;
}
}
this._pageLayout.push(prop);
if(_13f5.option){
this._pageLayout[this._pageLayout.length-1].values=dojo.map(_13f5.option,function(_13f8){
return _13f8;
});
this._pageLayout[this._pageLayout.length-1].type=_13f5.unconstrained?"comboEdit":"combo";
}
}
return _13ef.generateTable(this._pageLayout);
},_destroyProperties:function(){
var _13f9=(this.propDom);
dojo.forEach(dojo.query("[widgetId]",_13f9).map(dijit.byNode),function(w){
w.destroy();
});
while(_13f9.firstChild){
dojo._destroyElement(_13f9.firstChild);
}
},_connectAll:function(){
function _13fa(_13fb){
return function(){
return this._onChange({target:_13fb});
};
};
for(var i=0,len=this._pageLayout.length;i<len;i++){
var row=this._pageLayout[i],_13fc=dijit.byId(row.id),obj=_13fc||dojo.byId(row.id),_13fd=_13fc?"onChange":"change",_13fe=_13fc?"onFocus":"focus",_13ff=_13fc?"onBlur":"blur";
this._connect(obj,_13fd,this,_13fa(i));
this._connect(obj,_13fe,this,"_onFieldFocus");
this._connect(obj,_13ff,this,"_onFieldBlur");
}
},_connect:function(_1400,_1401,scope,_1402,_1403){
this._connects.push(_13e9.connect.apply(null,arguments));
},_disconnectAll:function(){
this._connects.forEach(_13e9.disconnect);
this._connects=[];
},_onChange:function(a){
var index=a.target,row=this._pageLayout[index],box=dojo.byId(row.id),value;
if(this.context){
this.context.blockChange(false);
}
if(box){
var attr=box.type==="checkbox"?"checked":"value";
value=dojo.attr(box,attr);
}else{
box=dijit.byId(row.id);
if(box){
value=box.get("value");
}
}
if(row.value!=value){
row.value=value;
var _1404={};
_1404[row.target]=value;
var _1405=new _13ec();
var _1406=new _13ed(this._widget,_1404,null);
_1405.add(_1406);
var _1407=this._widget.getHelper();
if(_1407&&_1407.onWidgetPropertyChange){
_1407.onWidgetPropertyChange({widget:this._widget,compoundCommand:_1405,modifyCommand:_1406});
}
dojo.publish("/davinci/ui/widgetPropertiesChanges",[{source:this._editor.editor_id,compoundCommand:_1405,command:_1406}]);
}
},_onFieldFocus:function(){
if(this.context){
this.context.blockChange(true);
}
},_onFieldBlur:function(){
if(this.context){
this.context.blockChange(false);
}
},_setValues:function(){
for(var i=0,len=this._pageLayout.length;i<len;i++){
var row=this._pageLayout[i],_1408=dojo.byId(row.id);
if(!_1408){
continue;
}
var _1409=this._widget,_140a=row.target,_140b;
if(_140a==="_children"){
_140b=_1409.getChildrenData();
if(_140b&&_140b.length===1){
_140b=_140b[0];
}else{
_140b=_1409.getPropertyValue(_140a);
}
}else{
_140b=_1409.getPropertyValue(_140a);
}
if(row.value!=_140b){
row.value=_140b;
var attr=row.type==="boolean"?"checked":"value";
var _140c=dijit.byId(row.id);
if(_140c){
_140c.attr(attr,row.value);
}else{
dojo.attr(_1408,attr,row.value);
}
}
}
}});
});
},"url:davinci/ve/widgets/templates/ChangeWillModify.html":"<div>\n  ${langObj.changeWillModify}\n  <br><br>\n  ${insteadOfChanging}\n  <br><br>\n  ${langObj.okToProceed}\n  <br><br>\n  <input type=\"checkbox\" data-dojo-attach-point=\"checkbox\" data-dojo-type=\"dijit.form.CheckBox\"/>${uiNLS.dontShowAgain}\n</div>\n\n","dijit/tree/_dndContainer":function(){
define("dijit/tree/_dndContainer",["dojo/aspect","dojo/_base/declare","dojo/dom-class","dojo/_base/event","dojo/_base/lang","dojo/on","dojo/touch"],function(_140d,_140e,_140f,event,lang,on,touch){
return _140e("dijit.tree._dndContainer",null,{constructor:function(tree,_1410){
this.tree=tree;
this.node=tree.domNode;
lang.mixin(this,_1410);
this.current=null;
this.containerState="";
_140f.add(this.node,"dojoDndContainer");
this.events=[on(this.node,touch.enter,lang.hitch(this,"onOverEvent")),on(this.node,touch.leave,lang.hitch(this,"onOutEvent")),_140d.after(this.tree,"_onNodeMouseEnter",lang.hitch(this,"onMouseOver"),true),_140d.after(this.tree,"_onNodeMouseLeave",lang.hitch(this,"onMouseOut"),true),on(this.node,"dragstart",lang.hitch(event,"stop")),on(this.node,"selectstart",lang.hitch(event,"stop"))];
},destroy:function(){
var h;
while(h=this.events.pop()){
h.remove();
}
this.node=this.parent=null;
},onMouseOver:function(_1411){
this.current=_1411;
},onMouseOut:function(){
this.current=null;
},_changeState:function(type,_1412){
var _1413="dojoDnd"+type;
var state=type.toLowerCase()+"State";
_140f.replace(this.node,_1413+_1412,_1413+this[state]);
this[state]=_1412;
},_addItemClass:function(node,type){
_140f.add(node,"dojoDndItem"+type);
},_removeItemClass:function(node,type){
_140f.remove(node,"dojoDndItem"+type);
},onOverEvent:function(){
this._changeState("Container","Over");
},onOutEvent:function(){
this._changeState("Container","");
}});
});
},"davinci/review/actions/_ReviewNavigatorCommon":function(){
define("davinci/review/actions/_ReviewNavigatorCommon",["dojo/_base/declare","davinci/actions/Action"],function(_1414,_1415){
var _1416=_1414("davinci.review.actions._ReviewNavigatorCommon",[_1415],{_getSelection:function(_1417){
var _1418=null;
if(_1417.getSelection){
_1418=_1417.getSelection();
}else{
var _1419=dijit.byId("davinci.review.reviewNavigator");
_1418=_1419.getSelection();
}
return _1418;
},shouldShow:function(_141a){
return true;
}});
return _1416;
});
},"davinci/ve/RebuildPage":function(){
define(["dojo/_base/declare","../Workbench","../workbench/Preferences","./Context","../Theme","../model/Path","davinci/model/Factory","dojo/Deferred","dojo/promise/all","davinci/ve/commands/ChangeThemeCommand"],function(_141b,_141c,_141d,_141e,Theme,Path,_141f,_1420,all,_1421){
return _141b("davinci.ve.RebuildPage",_141e,{constructor:function(args){
dojo.mixin(this,args);
},getPageCss:function(){
return ["app.css"];
},getPageJs:function(){
return ["app.js"];
},rebuildSource:function(_1422,_1423,theme,_1424){
if(!(_1423&&_1423.extension&&_1423.extension=="html")){
var _1425=new _1420();
_1425.resolve(_1422);
return _1425;
}
this.model=this._srcDocument=_141f.getNewFromResource(_1423);
this._resourcePath=new Path(_1423?_1423.getPath():"");
this.model.fileName=this._resourcePath.toString();
this._srcDocument.setText(_1422,true);
var _1426=this._srcDocument.find({elementType:"HTMLElement","tag":"html"},true);
if(_1426==null){
var _1425=new _1420();
return _1425.resolve(_1422);
}
var _1427=this._srcDocument.find({elementType:"HTMLElement"}),_1428=[];
_1428.push(this.loadRequires("html.body",true,true,true));
for(var i=0;i<_1427.length;i++){
var n=_1427[i];
var type=n.getAttribute("data-dojo-type")||n.getAttribute("dojoType")||n.getAttribute("dvwidget");
if(type!=null){
_1428.push(this.loadRequires(type,true,true,true));
}
}
if(theme){
this.changeThemeBase(theme,this._resourcePath);
}
if(_1424&&_1424.mobileTheme){
var c=new _1421(_1424,this);
c._dojoxMobileAddTheme(this,_1424.mobileTheme);
}
var _1429=this.getPageCss();
var _142a=this.getPageJs();
var _142b=this.getCurrentBasePath();
var _142c=this._resourcePath.getParentPath();
for(var i=0;i<_1429.length;i++){
var _142d=_142b.append(_1429[i]);
var _142e=_142d.relativeTo(_142c).toString();
this.addModeledStyleSheet(_142e,_1429[i]);
}
for(var i=0;i<_142a.length;i++){
var _142f=_142b.append(_142a[i]);
var _1430=_142f.relativeTo(_142c).toString();
this.addJavaScript(_1430,null,null,null,_142a[i]);
}
var _1425=new _1420();
all(_1428).then(function(){
_1425.resolve(this._srcDocument.getText());
}.bind(this));
return _1425;
},addModeledStyleSheet:function(url,_1431){
var _1432=this._srcDocument.find({elementType:"CSSImport"});
if(_1432.some(function(n){
if(n.url&&n.url.indexOf(_1431)>-1){
n.setUrl(url);
return true;
}
})){
return;
}
},_findScriptAdditions:function(){
var _1433=this._srcDocument.find({elementType:"HTMLElement",tag:"head"},true);
var _1434=_1433.find({elementType:"HTMLElement",tag:"script"});
for(var i=0;i<_1434.length;i++){
var text=_1434[i].getText();
if(text.indexOf("dojo.require")>-1){
return _1434[i];
}
}
return null;
},addJavaScript:function(url,text,_1435,_1436,_1437){
var _1438=this._srcDocument.find({elementType:"HTMLElement",tag:"script"});
if(_1438.some(function(n){
var _1439=n.getAttribute("src");
if(_1439&&_1439.indexOf(_1437)>-1){
n.setAttribute("src",url);
return true;
}
})){
return;
}
if(url){
if(url.indexOf("dojo.js")>-1){
this.addHeaderScript(url,{"data-dojo-config":"parseOnLoad: true"});
}
this.addHeaderScript(url);
}else{
if(text){
this._scriptAdditions=this.addHeaderScriptSrc(text,this._findScriptAdditions(),this._srcDocument.find({elementType:"HTMLElement",tag:"head"},true));
}
}
},changeThemeBase:function(theme,_143a){
var _143b=new Path(theme.file.parent.getPath());
theme.files.forEach(function(file){
var _143c=_143b.append(file);
var _143d=_143c.relativeTo(_143a,true);
this.addModeledStyleSheet(_143d.toString(),new Path(file),true);
},this);
theme.conditionalFiles.forEach(function(file){
var _143e=_143b.append(file);
var _143f=_143e.relativeTo(_143a,true);
this.addModeledStyleSheet(_143f.toString(),new Path(file),true);
},this);
},getCurrentBasePath:function(){
var base=new Path(_141c.getProject());
var prefs=_141d.getPreferences("davinci.ui.ProjectPrefs",base);
if(prefs.webContentFolder!==null&&prefs.webContentFolder!==""){
base=base.append(prefs.webContentFolder);
}
return base;
}});
});
},"davinci/ve/commands/StyleCommand":function(){
define(["dojo/_base/declare","davinci/ve/widget","davinci/ve/utils/StyleArray"],function(_1440,_1441,_1442){
return _1440("davinci.ve.commands.StyleCommand",null,{name:"style",constructor:function(_1443,_1444,_1445){
this._newValues=_1444;
this._id=_1443?_1443.id:undefined;
this._applyToStateIndex=(!_1445||_1445=="Normal"||_1445=="undefined")?"undefined":_1445;
},add:function(_1446){
if(!_1446||_1446._id!=this._id){
return;
}
if(_1446._newValues){
dojo.mixin(this._newValues,_1446._newValues);
}
},execute:function(){
if(!this._id||!this._newValues){
return;
}
var _1447=require("davinci/ve/widget").byId(this._id);
if(!_1447||!_1447.domNode){
return;
}
var _1448=require("davinci/ve/States");
var _1449=_1447.getStyleValuesAllStates();
this._oldStyleValuesAllStates=dojo.clone(_1449);
if(_1449[this._applyToStateIndex]){
_1449[this._applyToStateIndex]=_1442.mergeStyleArrays(_1449[this._applyToStateIndex],this._newValues);
}else{
_1449[this._applyToStateIndex]=this._newValues;
}
_1447.setStyleValuesAllStates(_1449);
var _144a=_1448.getStatesListCurrent(_1447.domNode);
var _144b=_1442.mergeStyleArrays([],_1449["undefined"]);
for(var i=0;i<_144a.length;i++){
if(_1449[_144a[i]]){
_144b=_1442.mergeStyleArrays(_144b,_1449[_144a[i]]);
}
}
_1447.setStyleValuesCanvas(_144b);
_1447.setStyleValuesModel(_1449["undefined"]);
_1447.refresh();
_1448.resetState(_1447.domNode);
dojo.publish("/davinci/ui/widgetPropertiesChanged",[[_1447]]);
},undo:function(){
if(!this._id||!this._oldStyleValuesAllStates){
return;
}
var _144c=require("davinci/ve/widget").byId(this._id);
if(!_144c){
return;
}
var _144d=require("davinci/ve/States");
var _144e=this._oldStyleValuesAllStates;
var _144f=this._applyToStateIndex;
_144c.setStyleValuesAllStates(_144e);
var _1450=_1442.mergeStyleArrays(_144e["undefined"],_144e[_144f]);
_144c.setStyleValuesCanvas(_1450);
_144c.setStyleValuesModel(this._oldStyleValuesAllStates["undefined"]);
_144c.refresh();
require("davinci/ve/States").resetState(_144c.domNode);
dojo.publish("/davinci/ui/widgetPropertiesChanged",[[_144c]]);
}});
});
},"davinci/ui/widgets/AddFiles":function(){
require({cache:{"url:davinci/ui/widgets/templates/AddFiles.html":"<div>\n\t<div class=\"dijitDialogPaneContentArea\">\n\t\t<label for=\"fileDialogParentFolder\">${uiNLS.parentFolder}</label>\n\t\t<div dojoAttachPoint=\"fileDialogParentFolder\"></div>\n\t\t<div>\n\t\t\t<input dojoAttachPoint=\"uploader\" multiple=\"true\" type=\"file\" data-dojo-type=\"dojox.form.Uploader\"/>\n\t\t</div>\n\t\t<div dojoAttachPoint=\"filelist\"></div>\n\t</div>\n\n  <div class=\"dijitDialogPaneActionBar\">\n  \t<button dojoAttachPoint=\"uploadBtn\" dojoType=\"dijit.form.Button\" class=\"maqPrimaryButton\">${uiNLS.upload}</button>\n\t\t<button dojoType='dijit.form.Button' dojoAttachEvent='onClick:_cancelButton' class=\"maqSecondaryButton\">${uiNLS.cancelButtonLabel}</button>\n\t</div>\n</div>\n"}});
define("davinci/ui/widgets/AddFiles",["dojo/_base/declare","dijit/_Templated","dijit/_Widget","../../model/Path","system/resource","dojox/form/uploader/FileList","dojox/form/Uploader","dojo/i18n!davinci/ui/nls/ui","dojo/i18n!dijit/nls/common","dojo/text!./templates/AddFiles.html","dijit/form/Button"],function(_1451,_1452,_1453,Path,_1454,_1455,_1456,uiNLS,_1457,_1458){
return _1451("davinci.ui.widgets.AddFiles",[_1453,_1452],{widgetsInTemplate:true,templateString:_1458,selectedResource:null,uiNLS:uiNLS,postCreate:function(){
var _1459=_1454.getRoot();
if(this.selectedResource){
_1459=this.selectedResource.elementType=="Folder"?this.selectedResource:this.selectedResource.parent;
}
this.fileDialogParentFolder.innerHTML=_1459.getPath();
this.uploader.set("url","cmd/addFiles?path="+_1459.getPath());
var list=new _1455({uploader:this.uploader},this.filelist);
var _145a,_145b=this.uploadBtn;
_145b.set("disabled",true);
var _145c=this.uploader;
dojo.connect(this.uploader,"onChange",function(files){
if(_145a){
dojo.disconnect(_145a);
}
_145a=dojo.connect(_145b,"onClick",null,function(){
_145c.set("disabled",true);
_145c.upload();
});
if(_145b.oldText){
_145b.containerNode.innerText=_145b.oldText;
}
_145b.set("disabled",!files.length);
});
var _145d=function(){
_145c.set("disabled",false);
dojo.disconnect(_145a);
_145b.oldText=_145b.containerNode.innerText;
_145b.containerNode.innerText=uiNLS.done;
_145b.set("disabled",true);
};
dojo.connect(this.uploader,"onComplete",function(_145e){
dojo.forEach(_145e,function(data){
_1459._appendFiles([{isDir:false,isLib:false,isNew:false,name:data.file}]);
var _145f=new Path(_1459.getPath()).append(data.file);
_1454.resourceChanged("updated",_145f.toString());
});
_145d();
});
dojo.connect(this.uploader,"onError",function(args){
console.error("Upload error: ",args);
_145d();
});
},_cancelButton:function(){
this.onClose();
},});
});
},"url:davinci/ui/templates/OpenThemeDialog.html":"<div>\r\n\t<div class=\"dijitDialogPaneContentArea\">\r\n\t\t${selectTheme}: <div dojoType=\"davinci.ui.widgets.ThemeSelection\" dojoAttachPoint=\"_themeChooser\" value='claro' dojoAttachEvent='onChange:_checkValid' searchWorkspace='true'></div>\r\n\t</div>\t\r\n\t<div class=\"dijitDialogPaneActionBar\">\r\n\t\t<button dojoType='dijit.form.Button' dojoAttachPoint=\"_okButton\" dojoAttachEvent='onClick:okButton' label='${open}' class=\"maqPrimaryButton\" type=\"submit\"></button>\r\n\t\t<button dojoType='dijit.form.Button' dojoAttachEvent='onClick:cancelButton' label='${buttonCancel}' class=\"maqSecondaryButton\"></button>\r\n\t</div>\r\n</div>","url:davinci/ui/widgets/templates/NewFile.html":"<div class=\"fileDialog\" dojoAttachPoint=\"_fileDialog\">\n\t<div class=\"dijitDialogPaneContentArea\">\n\t  <div dojoAttachPoint=\"additionalMessage\" class=\"maqDialogMessage\" style=\"display: none\">\n\t  </div>\n\n\t\t<table class=\"fileFolderTable\">\n\t\t\t<tr class='fileNameRow'>\n\t\t\t\t<td class=\"fileDialogLabelCell\">\n\t\t\t\t\t<label>${fileFieldLabel}:</label>\n\t\t\t\t</td>\n\t\t\t\t<td>\n\t\t\t\t\t<input dojoType=\"dijit.form.TextBox\" type=\"text\" dojoAttachPoint=\"fileDialogFileName\"></input>\n\t\t\t\t</td>\n\t\t\t\t<td>\n\t\t\t\t</td>\n\t\t\t</tr>\n\t\t\t<tr class='folderNameRow'>\n\t\t\t\t<td class=\"fileDialogLabelCell\">\n\t\t\t\t\t<label>${folderFieldLabel}</label>\n\t\t\t\t</td>\n\t\t\t\t<td dojoAttachPoint=\"fileDialogWhereDropDownCell\">\n\t\t\t\t\t<!-- DropDownButton goes here -->\n\t\t\t\t</td>\n\t\t\t\t<td>\n\t\t\t\t\t<span dojoAttachPoint=\"fileDialogDetailsArrow\">\n\t\t\t\t\t\t<span class='folder_details_arrow folder_details_show_arrow'>&nbsp;</span>\n\t\t\t\t\t\t<span class='folder_details_arrow folder_details_hide_arrow'>&nbsp;</span>\n\t\t\t\t\t</span>\n\t\t\t\t</td>\n\t\t\t</tr>\n\t\t</table>\n\t\t\n\t\t<div class=\"folderContainer\">\n\t\t\t<div dojoType=\"dijit.layout.ContentPane\">\n\t\t\t\t<div class=\"fileDialogTreeWidget\" dojoAttachPoint=\"fileTree\" dojoType=\"dijit.Tree\" showRoot=\"false\" model=\"system.resource\" getIconClass=\"davinci.ui.Resource.getResourceIcon\"\n\t\t\t\t\tgetRowClass=\"davinci.ui.Resource.getResourceClass\" labelAttr=\"name\" childrenAttrs=\"children\" persist=\"false\"></div>\n\t\t\t</div>\n\t\t\t<div class='folderContainerButtonRow'><button dojoType=\"dijit.form.Button\" dojoAttachPoint=\"__newFolderButton\" dojoAttachEvent=\"onClick:_newFolder\">${newFolderLabel}</button></div>\n\t\t</div>\n\t\t\n\t\t<div dojoAttachPoint=\"dialogSpecificOptionsDiv\"></div>\n\t</div>\n\t\n\t<div class=\"dijitDialogPaneActionBar\">\n\t\t<span dojoAttachPoint=\"dialogSpecificButtonsSpan\" class=\"dialogSecondaryButtons\"></span>\n\t\t<span class=\"fileDialogStdButtons\">\n\t\t\t<button dojoType=\"dijit.form.Button\" dojoAttachPoint=\"__okButton\" class=\"maqPrimaryButton\" type=\"submit\">${finishButtonLabel}</button>\n\t\t\t<button dojoType=\"dijit.form.Button\" dojoAttachPoint=\"__cancelButton\" dojoAttachEvent=\"onClick:cancelButton\" class=\"maqSecondaryButton\">${cancelButtonLabel}</button>\n\t\t</span>\n\t</div>\n\t\n</div>\n","dijit/Tree":function(){
require({cache:{"url:dijit/templates/TreeNode.html":"<div class=\"dijitTreeNode\" role=\"presentation\"\n\t><div data-dojo-attach-point=\"rowNode\" class=\"dijitTreeRow dijitInline\" role=\"presentation\"\n\t\t><div data-dojo-attach-point=\"indentNode\" class=\"dijitInline\"></div\n\t\t><img src=\"${_blankGif}\" alt=\"\" data-dojo-attach-point=\"expandoNode\" class=\"dijitTreeExpando\" role=\"presentation\"\n\t\t/><span data-dojo-attach-point=\"expandoNodeText\" class=\"dijitExpandoText\" role=\"presentation\"\n\t\t></span\n\t\t><span data-dojo-attach-point=\"contentNode\"\n\t\t\tclass=\"dijitTreeContent\" role=\"presentation\">\n\t\t\t<img src=\"${_blankGif}\" alt=\"\" data-dojo-attach-point=\"iconNode\" class=\"dijitIcon dijitTreeIcon\" role=\"presentation\"\n\t\t\t/><span data-dojo-attach-point=\"labelNode\" class=\"dijitTreeLabel\" role=\"treeitem\" tabindex=\"-1\" aria-selected=\"false\"></span>\n\t\t</span\n\t></div>\n\t<div data-dojo-attach-point=\"containerNode\" class=\"dijitTreeContainer\" role=\"presentation\" style=\"display: none;\"></div>\n</div>\n","url:dijit/templates/Tree.html":"<div class=\"dijitTree dijitTreeContainer\" role=\"tree\">\n\t<div class=\"dijitInline dijitTreeIndent\" style=\"position: absolute; top: -9999px\" data-dojo-attach-point=\"indentDetector\"></div>\n</div>\n"}});
define("dijit/Tree",["dojo/_base/array","dojo/_base/connect","dojo/cookie","dojo/_base/declare","dojo/Deferred","dojo/DeferredList","dojo/dom","dojo/dom-class","dojo/dom-geometry","dojo/dom-style","dojo/_base/event","dojo/errors/create","dojo/fx","dojo/_base/kernel","dojo/keys","dojo/_base/lang","dojo/on","dojo/topic","dojo/touch","dojo/when","./focus","./registry","./_base/manager","./_Widget","./_TemplatedMixin","./_Container","./_Contained","./_CssStateMixin","dojo/text!./templates/TreeNode.html","dojo/text!./templates/Tree.html","./tree/TreeStoreModel","./tree/ForestStoreModel","./tree/_dndSelector"],function(array,_1460,_1461,_1462,_1463,_1464,dom,_1465,_1466,_1467,event,_1468,_1469,_146a,keys,lang,on,topic,touch,when,focus,_146b,_146c,_146d,_146e,_146f,_1470,_1471,_1472,_1473,_1474,_1475,_1476){
_1463=_1462(_1463,{addCallback:function(_1477){
this.then(_1477);
},addErrback:function(_1478){
this.then(null,_1478);
}});
var _1479=_1462("dijit._TreeNode",[_146d,_146e,_146f,_1470,_1471],{item:null,isTreeNode:true,label:"",_setLabelAttr:{node:"labelNode",type:"innerText"},isExpandable:null,isExpanded:false,state:"UNCHECKED",templateString:_1472,baseClass:"dijitTreeNode",cssStateNodes:{rowNode:"dijitTreeRow"},_setTooltipAttr:{node:"rowNode",type:"attribute",attribute:"title"},buildRendering:function(){
this.inherited(arguments);
this._setExpando();
this._updateItemClasses(this.item);
if(this.isExpandable){
this.labelNode.setAttribute("aria-expanded",this.isExpanded);
}
this.setSelected(false);
},_setIndentAttr:function(_147a){
var _147b=(Math.max(_147a,0)*this.tree._nodePixelIndent)+"px";
_1467.set(this.domNode,"backgroundPosition",_147b+" 0px");
_1467.set(this.indentNode,this.isLeftToRight()?"paddingLeft":"paddingRight",_147b);
array.forEach(this.getChildren(),function(child){
child.set("indent",_147a+1);
});
this._set("indent",_147a);
},markProcessing:function(){
this.state="LOADING";
this._setExpando(true);
},unmarkProcessing:function(){
this._setExpando(false);
},_updateItemClasses:function(item){
var tree=this.tree,model=tree.model;
if(tree._v10Compat&&item===model.root){
item=null;
}
this._applyClassAndStyle(item,"icon","Icon");
this._applyClassAndStyle(item,"label","Label");
this._applyClassAndStyle(item,"row","Row");
this.tree._startPaint(true);
},_applyClassAndStyle:function(item,lower,upper){
var _147c="_"+lower+"Class";
var _147d=lower+"Node";
var _147e=this[_147c];
this[_147c]=this.tree["get"+upper+"Class"](item,this.isExpanded);
_1465.replace(this[_147d],this[_147c]||"",_147e||"");
_1467.set(this[_147d],this.tree["get"+upper+"Style"](item,this.isExpanded)||{});
},_updateLayout:function(){
var _147f=this.getParent();
if(!_147f||!_147f.rowNode||_147f.rowNode.style.display=="none"){
_1465.add(this.domNode,"dijitTreeIsRoot");
}else{
_1465.toggle(this.domNode,"dijitTreeIsLast",!this.getNextSibling());
}
},_setExpando:function(_1480){
var _1481=["dijitTreeExpandoLoading","dijitTreeExpandoOpened","dijitTreeExpandoClosed","dijitTreeExpandoLeaf"],_1482=["*","-","+","*"],idx=_1480?0:(this.isExpandable?(this.isExpanded?1:2):3);
_1465.replace(this.expandoNode,_1481[idx],_1481);
this.expandoNodeText.innerHTML=_1482[idx];
},expand:function(){
if(this._expandDeferred){
return this._expandDeferred;
}
if(this._collapseDeferred){
this._collapseDeferred.cancel();
delete this._collapseDeferred;
}
this.isExpanded=true;
this.labelNode.setAttribute("aria-expanded","true");
if(this.tree.showRoot||this!==this.tree.rootNode){
this.containerNode.setAttribute("role","group");
}
_1465.add(this.contentNode,"dijitTreeContentExpanded");
this._setExpando();
this._updateItemClasses(this.item);
if(this==this.tree.rootNode&&this.tree.showRoot){
this.tree.domNode.setAttribute("aria-expanded","true");
}
var def,_1483=_1469.wipeIn({node:this.containerNode,duration:_146c.defaultDuration,onEnd:function(){
def.resolve(true);
}});
def=(this._expandDeferred=new _1463(function(){
_1483.stop();
}));
_1483.play();
return def;
},collapse:function(){
if(this._collapseDeferred){
return this._collapseDeferred;
}
if(this._expandDeferred){
this._expandDeferred.cancel();
delete this._expandDeferred;
}
this.isExpanded=false;
this.labelNode.setAttribute("aria-expanded","false");
if(this==this.tree.rootNode&&this.tree.showRoot){
this.tree.domNode.setAttribute("aria-expanded","false");
}
_1465.remove(this.contentNode,"dijitTreeContentExpanded");
this._setExpando();
this._updateItemClasses(this.item);
var def,_1484=_1469.wipeOut({node:this.containerNode,duration:_146c.defaultDuration,onEnd:function(){
def.resolve(true);
}});
def=(this._collapseDeferred=new _1463(function(){
_1484.stop();
}));
_1484.play();
return def;
},indent:0,setChildItems:function(items){
var tree=this.tree,model=tree.model,defs=[];
var _1485=this.getChildren();
array.forEach(_1485,function(child){
_146f.prototype.removeChild.call(this,child);
},this);
this.defer(function(){
array.forEach(_1485,function(node){
if(!node._destroyed&&!node.getParent()){
tree.dndController.removeTreeNode(node);
var id=model.getIdentity(node.item),ary=tree._itemNodesMap[id];
if(ary.length==1){
delete tree._itemNodesMap[id];
}else{
var index=array.indexOf(ary,node);
if(index!=-1){
ary.splice(index,1);
}
}
node.destroyRecursive();
}
});
});
this.state="LOADED";
if(items&&items.length>0){
this.isExpandable=true;
array.forEach(items,function(item){
var id=model.getIdentity(item),_1486=tree._itemNodesMap[id],node;
if(_1486){
for(var i=0;i<_1486.length;i++){
if(_1486[i]&&!_1486[i].getParent()){
node=_1486[i];
node.set("indent",this.indent+1);
break;
}
}
}
if(!node){
node=this.tree._createTreeNode({item:item,tree:tree,isExpandable:model.mayHaveChildren(item),label:tree.getLabel(item),tooltip:tree.getTooltip(item),ownerDocument:tree.ownerDocument,dir:tree.dir,lang:tree.lang,textDir:tree.textDir,indent:this.indent+1});
if(_1486){
_1486.push(node);
}else{
tree._itemNodesMap[id]=[node];
}
}
this.addChild(node);
if(this.tree.autoExpand||this.tree._state(node)){
defs.push(tree._expandNode(node));
}
},this);
array.forEach(this.getChildren(),function(child){
child._updateLayout();
});
}else{
this.isExpandable=false;
}
if(this._setExpando){
this._setExpando(false);
}
this._updateItemClasses(this.item);
if(this==tree.rootNode){
var fc=this.tree.showRoot?this:this.getChildren()[0];
if(fc){
fc.setFocusable(true);
tree.lastFocused=fc;
}else{
tree.domNode.setAttribute("tabIndex","0");
}
}
var def=new _1464(defs);
this.tree._startPaint(def);
return def;
},getTreePath:function(){
var node=this;
var path=[];
while(node&&node!==this.tree.rootNode){
path.unshift(node.item);
node=node.getParent();
}
path.unshift(this.tree.rootNode.item);
return path;
},getIdentity:function(){
return this.tree.model.getIdentity(this.item);
},removeChild:function(node){
this.inherited(arguments);
var _1487=this.getChildren();
if(_1487.length==0){
this.isExpandable=false;
this.collapse();
}
array.forEach(_1487,function(child){
child._updateLayout();
});
},makeExpandable:function(){
this.isExpandable=true;
this._setExpando(false);
},setSelected:function(_1488){
this.labelNode.setAttribute("aria-selected",_1488?"true":"false");
_1465.toggle(this.rowNode,"dijitTreeRowSelected",_1488);
},setFocusable:function(_1489){
this.labelNode.setAttribute("tabIndex",_1489?"0":"-1");
},_setTextDirAttr:function(_148a){
if(_148a&&((this.textDir!=_148a)||!this._created)){
this._set("textDir",_148a);
this.applyTextDir(this.labelNode,this.labelNode.innerText||this.labelNode.textContent||"");
array.forEach(this.getChildren(),function(_148b){
_148b.set("textDir",_148a);
},this);
}
}});
var Tree=_1462("dijit.Tree",[_146d,_146e],{store:null,model:null,query:null,label:"",showRoot:true,childrenAttr:["children"],paths:[],path:[],selectedItems:null,selectedItem:null,openOnClick:false,openOnDblClick:false,templateString:_1473,persist:true,autoExpand:false,dndController:_1476,dndParams:["onDndDrop","itemCreator","onDndCancel","checkAcceptance","checkItemAcceptance","dragThreshold","betweenThreshold"],onDndDrop:null,itemCreator:null,onDndCancel:null,checkAcceptance:null,checkItemAcceptance:null,dragThreshold:5,betweenThreshold:0,_nodePixelIndent:19,_publish:function(_148c,_148d){
topic.publish(this.id,lang.mixin({tree:this,event:_148c},_148d||{}));
},postMixInProperties:function(){
this.tree=this;
if(this.autoExpand){
this.persist=false;
}
this._itemNodesMap={};
if(!this.cookieName&&this.id){
this.cookieName=this.id+"SaveStateCookie";
}
this.expandChildrenDeferred=new _1463();
this.pendingCommandsDeferred=this.expandChildrenDeferred;
this.inherited(arguments);
},postCreate:function(){
this._initState();
var self=this;
this.own(on(this.domNode,on.selector(".dijitTreeNode",touch.enter),function(evt){
self._onNodeMouseEnter(_146b.byNode(this),evt);
}),on(this.domNode,on.selector(".dijitTreeNode",touch.leave),function(evt){
self._onNodeMouseLeave(_146b.byNode(this),evt);
}),on(this.domNode,on.selector(".dijitTreeNode","click"),function(evt){
self._onClick(_146b.byNode(this),evt);
}),on(this.domNode,on.selector(".dijitTreeNode","dblclick"),function(evt){
self._onDblClick(_146b.byNode(this),evt);
}),on(this.domNode,on.selector(".dijitTreeNode","keypress"),function(evt){
self._onKeyPress(_146b.byNode(this),evt);
}),on(this.domNode,on.selector(".dijitTreeNode","keydown"),function(evt){
self._onKeyDown(_146b.byNode(this),evt);
}),on(this.domNode,on.selector(".dijitTreeRow","focusin"),function(evt){
self._onNodeFocus(_146b.getEnclosingWidget(this),evt);
}));
if(!this.model){
this._store2model();
}
this.connect(this.model,"onChange","_onItemChange");
this.connect(this.model,"onChildrenChange","_onItemChildrenChange");
this.connect(this.model,"onDelete","_onItemDelete");
this.inherited(arguments);
if(this.dndController){
if(lang.isString(this.dndController)){
this.dndController=lang.getObject(this.dndController);
}
var _148e={};
for(var i=0;i<this.dndParams.length;i++){
if(this[this.dndParams[i]]){
_148e[this.dndParams[i]]=this[this.dndParams[i]];
}
}
this.dndController=new this.dndController(this,_148e);
}
this._load();
if(!this.params.path&&!this.params.paths&&this.persist){
this.set("paths",this.dndController._getSavedPaths());
}
this.onLoadDeferred=this.pendingCommandsDeferred;
this.onLoadDeferred.then(lang.hitch(this,"onLoad"));
},_store2model:function(){
this._v10Compat=true;
_146a.deprecated("Tree: from version 2.0, should specify a model object rather than a store/query");
var _148f={id:this.id+"_ForestStoreModel",store:this.store,query:this.query,childrenAttrs:this.childrenAttr};
if(this.params.mayHaveChildren){
_148f.mayHaveChildren=lang.hitch(this,"mayHaveChildren");
}
if(this.params.getItemChildren){
_148f.getChildren=lang.hitch(this,function(item,_1490,_1491){
this.getItemChildren((this._v10Compat&&item===this.model.root)?null:item,_1490,_1491);
});
}
this.model=new _1475(_148f);
this.showRoot=Boolean(this.label);
},onLoad:function(){
},_load:function(){
this.model.getRoot(lang.hitch(this,function(item){
var rn=(this.rootNode=this.tree._createTreeNode({item:item,tree:this,isExpandable:true,label:this.label||this.getLabel(item),textDir:this.textDir,indent:this.showRoot?0:-1}));
if(!this.showRoot){
rn.rowNode.style.display="none";
this.domNode.setAttribute("role","presentation");
this.domNode.removeAttribute("aria-expanded");
this.domNode.removeAttribute("aria-multiselectable");
rn.labelNode.setAttribute("role","presentation");
rn.containerNode.setAttribute("role","tree");
rn.containerNode.setAttribute("aria-expanded","true");
rn.containerNode.setAttribute("aria-multiselectable",!this.dndController.singular);
}else{
this.domNode.setAttribute("aria-multiselectable",!this.dndController.singular);
}
this.domNode.appendChild(rn.domNode);
var _1492=this.model.getIdentity(item);
if(this._itemNodesMap[_1492]){
this._itemNodesMap[_1492].push(rn);
}else{
this._itemNodesMap[_1492]=[rn];
}
rn._updateLayout();
this._expandNode(rn).then(lang.hitch(this,function(){
this.expandChildrenDeferred.resolve(true);
}));
}),lang.hitch(this,function(err){
console.error(this,": error loading root: ",err);
}));
},getNodesByItem:function(item){
if(!item){
return [];
}
var _1493=lang.isString(item)?item:this.model.getIdentity(item);
return [].concat(this._itemNodesMap[_1493]);
},_setSelectedItemAttr:function(item){
this.set("selectedItems",[item]);
},_setSelectedItemsAttr:function(items){
var tree=this;
return this.pendingCommandsDeferred=this.pendingCommandsDeferred.then(lang.hitch(this,function(){
var _1494=array.map(items,function(item){
return (!item||lang.isString(item))?item:tree.model.getIdentity(item);
});
var nodes=[];
array.forEach(_1494,function(id){
nodes=nodes.concat(tree._itemNodesMap[id]||[]);
});
this.set("selectedNodes",nodes);
}));
},_setPathAttr:function(path){
if(path.length){
return this.set("paths",[path]);
}else{
return this.set("paths",[]);
}
},_setPathsAttr:function(paths){
var tree=this;
return this.pendingCommandsDeferred=this.pendingCommandsDeferred.then(function(){
return new _1464(array.map(paths,function(path){
var d=new _1463();
path=array.map(path,function(item){
return lang.isString(item)?item:tree.model.getIdentity(item);
});
if(path.length){
_1495(path,[tree.rootNode],d);
}else{
d.reject(new Tree.PathError("Empty path"));
}
return d;
}));
}).then(_1496);
function _1495(path,nodes,def){
var _1497=path.shift();
var _1498=array.filter(nodes,function(node){
return node.getIdentity()==_1497;
})[0];
if(!!_1498){
if(path.length){
tree._expandNode(_1498).then(function(){
_1495(path,_1498.getChildren(),def);
});
}else{
def.resolve(_1498);
}
}else{
def.reject(new Tree.PathError("Could not expand path at "+_1497));
}
};
function _1496(_1499){
tree.set("selectedNodes",array.map(array.filter(_1499,function(x){
return x[0];
}),function(x){
return x[1];
}));
};
},_setSelectedNodeAttr:function(node){
this.set("selectedNodes",[node]);
},_setSelectedNodesAttr:function(nodes){
this.dndController.setSelection(nodes);
},expandAll:function(){
var _149a=this;
function _149b(node){
var def=new dojo.Deferred();
_149a._expandNode(node).then(function(){
var _149c=array.filter(node.getChildren()||[],function(node){
return node.isExpandable;
}),defs=array.map(_149c,_149b);
new dojo.DeferredList(defs).then(function(){
def.resolve(true);
});
});
return def;
};
return _149b(this.rootNode);
},collapseAll:function(){
var _149d=this;
function _149e(node){
var def=new dojo.Deferred();
def.label="collapseAllDeferred";
var _149f=array.filter(node.getChildren()||[],function(node){
return node.isExpandable;
}),defs=array.map(_149f,_149e);
new dojo.DeferredList(defs).then(function(){
if(!node.isExpanded||(node==_149d.rootNode&&!_149d.showRoot)){
def.resolve(true);
}else{
_149d._collapseNode(node).then(function(){
def.resolve(true);
});
}
});
return def;
};
return _149e(this.rootNode);
},mayHaveChildren:function(){
},getItemChildren:function(){
},getLabel:function(item){
return this.model.getLabel(item);
},getIconClass:function(item,_14a0){
return (!item||this.model.mayHaveChildren(item))?(_14a0?"dijitFolderOpened":"dijitFolderClosed"):"dijitLeaf";
},getLabelClass:function(){
},getRowClass:function(){
},getIconStyle:function(){
},getLabelStyle:function(){
},getRowStyle:function(){
},getTooltip:function(){
return "";
},_onKeyPress:function(_14a1,e){
if(e.charCode<=32){
return;
}
if(!e.altKey&&!e.ctrlKey&&!e.shiftKey&&!e.metaKey){
var c=String.fromCharCode(e.charCode);
this._onLetterKeyNav({node:_14a1,key:c.toLowerCase()});
event.stop(e);
}
},_onKeyDown:function(_14a2,e){
var key=e.keyCode;
var map=this._keyHandlerMap;
if(!map){
map={};
map[keys.ENTER]=map[keys.SPACE]=map[" "]="_onEnterKey";
map[this.isLeftToRight()?keys.LEFT_ARROW:keys.RIGHT_ARROW]="_onLeftArrow";
map[this.isLeftToRight()?keys.RIGHT_ARROW:keys.LEFT_ARROW]="_onRightArrow";
map[keys.UP_ARROW]="_onUpArrow";
map[keys.DOWN_ARROW]="_onDownArrow";
map[keys.HOME]="_onHomeKey";
map[keys.END]="_onEndKey";
this._keyHandlerMap=map;
}
if(this._keyHandlerMap[key]){
if(this._curSearch){
this._curSearch.timer.remove();
delete this._curSearch;
}
this[this._keyHandlerMap[key]]({node:_14a2,item:_14a2.item,evt:e});
event.stop(e);
}
},_onEnterKey:function(_14a3){
this._publish("execute",{item:_14a3.item,node:_14a3.node});
this.dndController.userSelect(_14a3.node,_1460.isCopyKey(_14a3.evt),_14a3.evt.shiftKey);
this.onClick(_14a3.item,_14a3.node,_14a3.evt);
},_onDownArrow:function(_14a4){
var node=this._getNextNode(_14a4.node);
if(node&&node.isTreeNode){
this.focusNode(node);
}
},_onUpArrow:function(_14a5){
var node=_14a5.node;
var _14a6=node.getPreviousSibling();
if(_14a6){
node=_14a6;
while(node.isExpandable&&node.isExpanded&&node.hasChildren()){
var _14a7=node.getChildren();
node=_14a7[_14a7.length-1];
}
}else{
var _14a8=node.getParent();
if(!(!this.showRoot&&_14a8===this.rootNode)){
node=_14a8;
}
}
if(node&&node.isTreeNode){
this.focusNode(node);
}
},_onRightArrow:function(_14a9){
var node=_14a9.node;
if(node.isExpandable&&!node.isExpanded){
this._expandNode(node);
}else{
if(node.hasChildren()){
node=node.getChildren()[0];
if(node&&node.isTreeNode){
this.focusNode(node);
}
}
}
},_onLeftArrow:function(_14aa){
var node=_14aa.node;
if(node.isExpandable&&node.isExpanded){
this._collapseNode(node);
}else{
var _14ab=node.getParent();
if(_14ab&&_14ab.isTreeNode&&!(!this.showRoot&&_14ab===this.rootNode)){
this.focusNode(_14ab);
}
}
},_onHomeKey:function(){
var node=this._getRootOrFirstNode();
if(node){
this.focusNode(node);
}
},_onEndKey:function(){
var node=this.rootNode;
while(node.isExpanded){
var c=node.getChildren();
node=c[c.length-1];
}
if(node&&node.isTreeNode){
this.focusNode(node);
}
},multiCharSearchDuration:250,_onLetterKeyNav:function(_14ac){
var cs=this._curSearch;
if(cs){
cs.pattern=cs.pattern+_14ac.key;
cs.timer.remove();
}else{
cs=this._curSearch={pattern:_14ac.key,startNode:_14ac.node};
}
cs.timer=this.defer(function(){
delete this._curSearch;
},this.multiCharSearchDuration);
var node=cs.startNode;
do{
node=this._getNextNode(node);
if(!node){
node=this._getRootOrFirstNode();
}
}while(node!==cs.startNode&&(node.label.toLowerCase().substr(0,cs.pattern.length)!=cs.pattern));
if(node&&node.isTreeNode){
if(node!==cs.startNode){
this.focusNode(node);
}
}
},isExpandoNode:function(node,_14ad){
return dom.isDescendant(node,_14ad.expandoNode);
},_onClick:function(_14ae,e){
var _14af=e.target,_14b0=this.isExpandoNode(_14af,_14ae);
if((this.openOnClick&&_14ae.isExpandable)||_14b0){
if(_14ae.isExpandable){
this._onExpandoClick({node:_14ae});
}
}else{
this._publish("execute",{item:_14ae.item,node:_14ae,evt:e});
this.onClick(_14ae.item,_14ae,e);
this.focusNode(_14ae);
}
event.stop(e);
},_onDblClick:function(_14b1,e){
var _14b2=e.target,_14b3=(_14b2==_14b1.expandoNode||_14b2==_14b1.expandoNodeText);
if((this.openOnDblClick&&_14b1.isExpandable)||_14b3){
if(_14b1.isExpandable){
this._onExpandoClick({node:_14b1});
}
}else{
this._publish("execute",{item:_14b1.item,node:_14b1,evt:e});
this.onDblClick(_14b1.item,_14b1,e);
this.focusNode(_14b1);
}
event.stop(e);
},_onExpandoClick:function(_14b4){
var node=_14b4.node;
this.focusNode(node);
if(node.isExpanded){
this._collapseNode(node);
}else{
this._expandNode(node);
}
},onClick:function(){
},onDblClick:function(){
},onOpen:function(){
},onClose:function(){
},_getNextNode:function(node){
if(node.isExpandable&&node.isExpanded&&node.hasChildren()){
return node.getChildren()[0];
}else{
while(node&&node.isTreeNode){
var _14b5=node.getNextSibling();
if(_14b5){
return _14b5;
}
node=node.getParent();
}
return null;
}
},_getRootOrFirstNode:function(){
return this.showRoot?this.rootNode:this.rootNode.getChildren()[0];
},_collapseNode:function(node){
if(node._expandNodeDeferred){
delete node._expandNodeDeferred;
}
if(node.state=="LOADING"){
return;
}
if(node.isExpanded){
var ret=node.collapse();
this.onClose(node.item,node);
this._state(node,false);
this._startPaint(ret);
return ret;
}
},_expandNode:function(node){
var def=new _1463();
if(node._expandNodeDeferred){
return node._expandNodeDeferred;
}
var model=this.model,item=node.item,_14b6=this;
if(!node._loadDeferred){
node.markProcessing();
node._loadDeferred=new _1463();
model.getChildren(item,function(items){
node.unmarkProcessing();
node.setChildItems(items).then(function(){
node._loadDeferred.resolve(items);
});
},function(err){
console.error(_14b6,": error loading "+node.label+" children: ",err);
node._loadDeferred.reject(err);
});
}
node._loadDeferred.then(lang.hitch(this,function(){
node.expand().then(function(){
def.resolve(true);
});
this.onOpen(node.item,node);
this._state(node,true);
}));
this._startPaint(def);
return def;
},focusNode:function(node){
focus.focus(node.labelNode);
},_onNodeFocus:function(node){
if(node&&node!=this.lastFocused){
if(this.lastFocused&&!this.lastFocused._destroyed){
this.lastFocused.setFocusable(false);
}
node.setFocusable(true);
this.lastFocused=node;
}
},_onNodeMouseEnter:function(){
},_onNodeMouseLeave:function(){
},_onItemChange:function(item){
var model=this.model,_14b7=model.getIdentity(item),nodes=this._itemNodesMap[_14b7];
if(nodes){
var label=this.getLabel(item),_14b8=this.getTooltip(item);
array.forEach(nodes,function(node){
node.set({item:item,label:label,tooltip:_14b8});
node._updateItemClasses(item);
});
}
},_onItemChildrenChange:function(_14b9,_14ba){
var model=this.model,_14bb=model.getIdentity(_14b9),_14bc=this._itemNodesMap[_14bb];
if(_14bc){
array.forEach(_14bc,function(_14bd){
_14bd.setChildItems(_14ba);
});
}
},_onItemDelete:function(item){
var model=this.model,_14be=model.getIdentity(item),nodes=this._itemNodesMap[_14be];
if(nodes){
array.forEach(nodes,function(node){
this.dndController.removeTreeNode(node);
var _14bf=node.getParent();
if(_14bf){
_14bf.removeChild(node);
}
node.destroyRecursive();
},this);
delete this._itemNodesMap[_14be];
}
},_initState:function(){
this._openedNodes={};
if(this.persist&&this.cookieName){
var oreo=_1461(this.cookieName);
if(oreo){
array.forEach(oreo.split(","),function(item){
this._openedNodes[item]=true;
},this);
}
}
},_state:function(node,_14c0){
if(!this.persist){
return false;
}
var path=array.map(node.getTreePath(),function(item){
return this.model.getIdentity(item);
},this).join("/");
if(arguments.length===1){
return this._openedNodes[path];
}else{
if(_14c0){
this._openedNodes[path]=true;
}else{
delete this._openedNodes[path];
}
if(this.persist&&this.cookieName){
var ary=[];
for(var id in this._openedNodes){
ary.push(id);
}
_1461(this.cookieName,ary.join(","),{expires:365});
}
}
},destroy:function(){
if(this._curSearch){
this._curSearch.timer.remove();
delete this._curSearch;
}
if(this.rootNode){
this.rootNode.destroyRecursive();
}
if(this.dndController&&!lang.isString(this.dndController)){
this.dndController.destroy();
}
this.rootNode=null;
this.inherited(arguments);
},destroyRecursive:function(){
this.destroy();
},resize:function(_14c1){
if(_14c1){
_1466.setMarginBox(this.domNode,_14c1);
}
this._nodePixelIndent=_1466.position(this.tree.indentDetector).w||this._nodePixelIndent;
this.expandChildrenDeferred.then(lang.hitch(this,function(){
this.rootNode.set("indent",this.showRoot?0:-1);
this._adjustWidths();
}));
},_outstandingPaintOperations:0,_startPaint:function(p){
this._outstandingPaintOperations++;
if(this._adjustWidthsTimer){
this._adjustWidthsTimer.remove();
delete this._adjustWidthsTimer;
}
var oc=lang.hitch(this,function(){
this._outstandingPaintOperations--;
if(this._outstandingPaintOperations<=0&&!this._adjustWidthsTimer&&this._started){
this._adjustWidthsTimer=this.defer("_adjustWidths");
}
});
when(p,oc,oc);
},_adjustWidths:function(){
if(this._adjustWidthsTimer){
this._adjustWidthsTimer.remove();
delete this._adjustWidthsTimer;
}
var _14c2=0,nodes=[];
function _14c3(_14c4){
var node=_14c4.rowNode;
node.style.width="auto";
_14c2=Math.max(_14c2,node.clientWidth);
nodes.push(node);
if(_14c4.isExpanded){
array.forEach(_14c4.getChildren(),_14c3);
}
};
_14c3(this.rootNode);
_14c2=Math.max(_14c2,_1466.getContentBox(this.domNode).w);
array.forEach(nodes,function(node){
node.style.width=_14c2+"px";
});
},_createTreeNode:function(args){
return new _1479(args);
},_setTextDirAttr:function(_14c5){
if(_14c5&&this.textDir!=_14c5){
this._set("textDir",_14c5);
this.rootNode.set("textDir",_14c5);
}
}});
Tree.PathError=_1468("TreePathError");
Tree._TreeNode=_1479;
return Tree;
});
},"dijit/form/_TextBoxMixin":function(){
define("dijit/form/_TextBoxMixin",["dojo/_base/array","dojo/_base/declare","dojo/dom","dojo/_base/event","dojo/keys","dojo/_base/lang","dojo/on","../main"],function(array,_14c6,dom,event,keys,lang,on,dijit){
var _14c7=_14c6("dijit.form._TextBoxMixin",null,{trim:false,uppercase:false,lowercase:false,propercase:false,maxLength:"",selectOnClick:false,placeHolder:"",_getValueAttr:function(){
return this.parse(this.get("displayedValue"),this.constraints);
},_setValueAttr:function(value,_14c8,_14c9){
var _14ca;
if(value!==undefined){
_14ca=this.filter(value);
if(typeof _14c9!="string"){
if(_14ca!==null&&((typeof _14ca!="number")||!isNaN(_14ca))){
_14c9=this.filter(this.format(_14ca,this.constraints));
}else{
_14c9="";
}
}
}
if(_14c9!=null&&((typeof _14c9)!="number"||!isNaN(_14c9))&&this.textbox.value!=_14c9){
this.textbox.value=_14c9;
this._set("displayedValue",this.get("displayedValue"));
}
if(this.textDir=="auto"){
this.applyTextDir(this.focusNode,_14c9);
}
this.inherited(arguments,[_14ca,_14c8]);
},displayedValue:"",_getDisplayedValueAttr:function(){
return this.filter(this.textbox.value);
},_setDisplayedValueAttr:function(value){
if(value==null){
value="";
}else{
if(typeof value!="string"){
value=String(value);
}
}
this.textbox.value=value;
this._setValueAttr(this.get("value"),undefined);
this._set("displayedValue",this.get("displayedValue"));
if(this.textDir=="auto"){
this.applyTextDir(this.focusNode,value);
}
},format:function(value){
return value==null?"":(value.toString?value.toString():value);
},parse:function(value){
return value;
},_refreshState:function(){
},onInput:function(){
},__skipInputEvent:false,_onInput:function(evt){
if(this.textDir=="auto"){
this.applyTextDir(this.focusNode,this.focusNode.value);
}
this._processInput(evt);
},_processInput:function(evt){
this._refreshState();
this._set("displayedValue",this.get("displayedValue"));
},postCreate:function(){
this.textbox.setAttribute("value",this.textbox.value);
this.inherited(arguments);
var _14cb=function(e){
var _14cc;
if(e.type=="keydown"){
_14cc=e.keyCode;
switch(_14cc){
case keys.SHIFT:
case keys.ALT:
case keys.CTRL:
case keys.META:
case keys.CAPS_LOCK:
case keys.NUM_LOCK:
case keys.SCROLL_LOCK:
return;
}
if(!e.ctrlKey&&!e.metaKey&&!e.altKey){
switch(_14cc){
case keys.NUMPAD_0:
case keys.NUMPAD_1:
case keys.NUMPAD_2:
case keys.NUMPAD_3:
case keys.NUMPAD_4:
case keys.NUMPAD_5:
case keys.NUMPAD_6:
case keys.NUMPAD_7:
case keys.NUMPAD_8:
case keys.NUMPAD_9:
case keys.NUMPAD_MULTIPLY:
case keys.NUMPAD_PLUS:
case keys.NUMPAD_ENTER:
case keys.NUMPAD_MINUS:
case keys.NUMPAD_PERIOD:
case keys.NUMPAD_DIVIDE:
return;
}
if((_14cc>=65&&_14cc<=90)||(_14cc>=48&&_14cc<=57)||_14cc==keys.SPACE){
return;
}
var named=false;
for(var i in keys){
if(keys[i]===e.keyCode){
named=true;
break;
}
}
if(!named){
return;
}
}
}
_14cc=e.charCode>=32?String.fromCharCode(e.charCode):e.charCode;
if(!_14cc){
_14cc=(e.keyCode>=65&&e.keyCode<=90)||(e.keyCode>=48&&e.keyCode<=57)||e.keyCode==keys.SPACE?String.fromCharCode(e.keyCode):e.keyCode;
}
if(!_14cc){
_14cc=229;
}
if(e.type=="keypress"){
if(typeof _14cc!="string"){
return;
}
if((_14cc>="a"&&_14cc<="z")||(_14cc>="A"&&_14cc<="Z")||(_14cc>="0"&&_14cc<="9")||(_14cc===" ")){
if(e.ctrlKey||e.metaKey||e.altKey){
return;
}
}
}
if(e.type=="input"){
if(this.__skipInputEvent){
this.__skipInputEvent=false;
return;
}
}else{
this.__skipInputEvent=true;
}
var faux={faux:true},attr;
for(attr in e){
if(attr!="layerX"&&attr!="layerY"){
var v=e[attr];
if(typeof v!="function"&&typeof v!="undefined"){
faux[attr]=v;
}
}
}
lang.mixin(faux,{charOrCode:_14cc,_wasConsumed:false,preventDefault:function(){
faux._wasConsumed=true;
e.preventDefault();
},stopPropagation:function(){
e.stopPropagation();
}});
if(this.onInput(faux)===false){
faux.preventDefault();
faux.stopPropagation();
}
if(faux._wasConsumed){
return;
}
this.defer(function(){
this._onInput(faux);
});
};
this.own(on(this.textbox,"keydown, keypress, paste, cut, input, compositionend",lang.hitch(this,_14cb)));
},_blankValue:"",filter:function(val){
if(val===null){
return this._blankValue;
}
if(typeof val!="string"){
return val;
}
if(this.trim){
val=lang.trim(val);
}
if(this.uppercase){
val=val.toUpperCase();
}
if(this.lowercase){
val=val.toLowerCase();
}
if(this.propercase){
val=val.replace(/[^\s]+/g,function(word){
return word.substring(0,1).toUpperCase()+word.substring(1);
});
}
return val;
},_setBlurValue:function(){
this._setValueAttr(this.get("value"),true);
},_onBlur:function(e){
if(this.disabled){
return;
}
this._setBlurValue();
this.inherited(arguments);
},_isTextSelected:function(){
return this.textbox.selectionStart!=this.textbox.selectionEnd;
},_onFocus:function(by){
if(this.disabled||this.readOnly){
return;
}
if(this.selectOnClick&&by=="mouse"){
this._selectOnClickHandle=this.connect(this.domNode,"onmouseup",function(){
this.disconnect(this._selectOnClickHandle);
this._selectOnClickHandle=null;
if(!this._isTextSelected()){
_14c7.selectInputText(this.textbox);
}
});
this.defer(function(){
if(this._selectOnClickHandle){
this.disconnect(this._selectOnClickHandle);
this._selectOnClickHandle=null;
}
},500);
}
this.inherited(arguments);
this._refreshState();
},reset:function(){
this.textbox.value="";
this.inherited(arguments);
},_setTextDirAttr:function(_14cd){
if(!this._created||this.textDir!=_14cd){
this._set("textDir",_14cd);
this.applyTextDir(this.focusNode,this.focusNode.value);
}
}});
_14c7._setSelectionRange=dijit._setSelectionRange=function(_14ce,start,stop){
if(_14ce.setSelectionRange){
_14ce.setSelectionRange(start,stop);
}
};
_14c7.selectInputText=dijit.selectInputText=function(_14cf,start,stop){
_14cf=dom.byId(_14cf);
if(isNaN(start)){
start=0;
}
if(isNaN(stop)){
stop=_14cf.value?_14cf.value.length:0;
}
try{
_14cf.focus();
_14c7._setSelectionRange(_14cf,start,stop);
}
catch(e){
}
};
return _14c7;
});
},"orion/editor/contentAssist":function(){
define("orion/editor/contentAssist",["i18n!orion/editor/nls/messages","orion/textview/keyBinding","orion/textview/eventTarget"],function(_14d0,_14d1,_14d2){
var _14d3=(function(){
function _14d3(){
};
_14d3.prototype.then=function(_14d4){
this.callback=_14d4;
if(this.result){
var _14d5=this;
setTimeout(function(){
_14d5.callback(_14d5.result);
},0);
}
};
_14d3.prototype.done=function(_14d6){
this.result=_14d6;
if(this.callback){
this.callback(this.result);
}
};
return _14d3;
}());
var State={INACTIVE:1,ACTIVE:2,FILTERING:3};
function _14d7(_14d8){
this.textView=_14d8;
this.state=State.INACTIVE;
this.providers=[];
var self=this;
this.contentAssistListener={onModelChanging:function(event){
if(self.isDeactivatingChange(event)){
self.setState(State.INACTIVE);
}else{
if(self.state===State.ACTIVE){
self.setState(State.FILTERING);
}
}
},onScroll:function(event){
self.setState(State.INACTIVE);
},onSelection:function(event){
var state=self.state;
if(state===State.ACTIVE||state===State.FILTERING){
self.computeProposals();
self.setState(State.FILTERING);
}
}};
var isMac=navigator.platform.indexOf("Mac")!==-1;
_14d8.setKeyBinding(isMac?new _14d1.KeyBinding(" ",false,false,false,true):new _14d1.KeyBinding(" ",true),"contentAssist");
_14d8.setAction("contentAssist",function(){
self.activate();
return true;
},{name:_14d0.contentAssist});
};
_14d7.prototype={apply:function(_14d9){
if(!_14d9){
return false;
}
var _14da=this.textView.getCaretOffset();
var data={proposal:_14d9,start:_14da,end:_14da};
this.setState(State.INACTIVE);
var _14db=_14d9.proposal||_14d9;
this.textView.setText(_14db,_14da,_14da);
this.dispatchEvent({type:"ProposalApplied",data:data});
return true;
},activate:function(){
if(this.state===State.INACTIVE){
this.setState(State.ACTIVE);
}
},deactivate:function(){
this.setState(State.INACTIVE);
},getTextView:function(){
return this.textView;
},isActive:function(){
return this.state===State.ACTIVE||this.state===State.FILTERING;
},isDeactivatingChange:function(event){
var _14dc=event.removedCharCount>0&&event.addedCharCount===0,view=this.textView,_14dd=(event.start+1<=view.getModel().getCharCount())&&/^\s*$/.test(view.getText(event.start,event.start+1));
return event.removedLineCount>0||event.addedLineCount>0||(_14dc&&_14dd);
},setState:function(state){
var _14de;
if(state===State.ACTIVE){
_14de="Activating";
}else{
if(state===State.INACTIVE){
_14de="Deactivating";
}
}
if(_14de){
this.dispatchEvent({type:_14de});
}
this.state=state;
this.onStateChange(state);
},onStateChange:function(state){
if(state===State.INACTIVE){
if(this.listenerAdded){
this.textView.removeEventListener("ModelChanging",this.contentAssistListener.onModelChanging);
this.textView.removeEventListener("Scroll",this.contentAssistListener.onScroll);
this.textView.removeEventListener("Selection",this.contentAssistListener.onSelection);
this.listenerAdded=false;
}
}else{
if(state===State.ACTIVE){
if(!this.listenerAdded){
this.textView.addEventListener("ModelChanging",this.contentAssistListener.onModelChanging);
this.textView.addEventListener("Scroll",this.contentAssistListener.onScroll);
this.textView.addEventListener("Selection",this.contentAssistListener.onSelection);
this.listenerAdded=true;
}
this.computeProposals();
}
}
},computeProposals:function(){
var self=this;
var _14df=this.textView.getCaretOffset();
this._computeProposals(_14df).then(function(_14e0){
self.dispatchEvent({type:"ProposalsComputed",data:{proposals:_14e0}});
});
},getPrefixStart:function(end){
var index=end;
while(index>0&&/[A-Za-z0-9_]/.test(this.textView.getText(index-1,index))){
index--;
}
return index;
},_computeProposals:function(_14e1){
var _14e2=[],_14e3=0,_14e4=new _14d3(),_14e5=this.providers;
function _14e6(_14e7){
if(_14e7){
_14e2=_14e2.concat(_14e7);
}
if(++_14e3===_14e5.length){
_14e4.done(_14e2);
}
};
function _14e8(){
if(++_14e3===_14e5.length){
_14e4.done(_14e2);
}
};
var _14e9=this.textView,_14ea=_14e9.getModel();
var _14eb=_14e9.getText();
var _14ec={line:_14ea.getLine(_14ea.getLineAtOffset(_14e1)),prefix:_14e9.getText(this.getPrefixStart(_14e1),_14e1),selection:_14e9.getSelection()};
for(var i=0;i<_14e5.length;i++){
var _14ed=_14e5[i];
var _14ee=_14ed.getProposals;
if(typeof _14ed.computeProposals==="function"){
_14ee=_14ed.computeProposals;
}
var _14ef=_14ee.apply(_14ed,[_14eb,_14e1,_14ec]);
if(_14ef&&_14ef.then){
_14ef.then(_14e6,_14e8);
}else{
_14e6(_14ef);
}
}
return _14e4;
},setProviders:function(_14f0){
this.providers=_14f0.slice(0);
}};
_14d2.EventTarget.addMixin(_14d7.prototype);
function _14f1(_14f2,_14f3){
this.contentAssist=_14f2;
this.widget=_14f3;
this.proposals=[];
var self=this;
this.contentAssist.addEventListener("ProposalsComputed",function(event){
self.proposals=event.data.proposals;
self.selectedIndex=self.proposals.length?0:-1;
});
};
_14f1.prototype={cancel:function(){
this.getContentAssist().deactivate();
},getContentAssist:function(){
return this.contentAssist;
},isActive:function(){
return this.getContentAssist().isActive();
},lineUp:function(){
this.selectedIndex=(this.selectedIndex===0)?this.proposals.length-1:this.selectedIndex-1;
if(this.widget){
this.widget.setSelectedIndex(this.selectedIndex);
}
return true;
},lineDown:function(){
this.selectedIndex=(this.selectedIndex===this.proposals.length-1)?0:this.selectedIndex+1;
if(this.widget){
this.widget.setSelectedIndex(this.selectedIndex);
}
return true;
},enter:function(){
var _14f4=this.proposals[this.selectedIndex]||null;
return this.contentAssist.apply(_14f4);
},tab:function(){
if(this.widget){
this.widget.createAccessible(this);
this.widget.parentNode.focus();
return true;
}else{
return false;
}
}};
function _14f5(_14f6,_14f7){
this.contentAssist=_14f6;
this.parentNode=typeof _14f7==="string"?document.getElementById(_14f7):_14f7;
this.textView=this.contentAssist.getTextView();
this.textViewListenerAdded=false;
var self=this;
this.textViewListener={onMouseDown:function(event){
if(event.event.target.parentElement!==self.parentNode){
self.contentAssist.deactivate();
}
}};
this.contentAssist.addEventListener("ProposalsComputed",function(event){
self.setProposals(event.data.proposals);
self.show();
if(!self.textViewListenerAdded){
self.textView.addEventListener("MouseDown",self.textViewListener.onMouseDown);
self.textViewListenerAdded=true;
}
});
this.contentAssist.addEventListener("Deactivating",function(event){
self.setProposals([]);
self.hide();
if(self.textViewListenerAdded){
self.textView.removeEventListener("MouseDown",self.textViewListener.onMouseDown);
self.textViewListenerAdded=false;
}
self.textViewListenerAdded=false;
});
};
_14f5.prototype={onClick:function(e){
this.contentAssist.apply(this.getProposal(e.target));
this.textView.focus();
},createDiv:function(_14f8,_14f9,_14fa,_14fb){
var div=document.createElement("div");
div.id="contentoption"+_14fb;
div.setAttribute("role","option");
if(_14f9){
div.className="selected";
this.parentNode.setAttribute("aria-activedescendant",div.id);
}
var _14fc=document.createTextNode(_14f8);
div.appendChild(_14fc,div);
_14fa.appendChild(div);
},createAccessible:function(mode){
if(!this._isAccessible){
this.parentNode.addEventListener("keydown",function(evt){
evt.preventDefault();
if(evt.keyCode===27){
return mode.cancel();
}else{
if(evt.keyCode===38){
return mode.lineUp();
}else{
if(evt.keyCode===40){
return mode.lineDown();
}else{
if(evt.keyCode===13){
return mode.enter();
}
}
}
}
return false;
});
}
this._isAccessible=true;
},getDisplayString:function(_14fd){
if(typeof _14fd==="string"){
return _14fd;
}
if(_14fd.description&&typeof _14fd.description==="string"){
return _14fd.description;
}
return _14fd.proposal;
},getProposal:function(node){
var _14fe=0;
for(var child=this.parentNode.firstChild;child!==null;child=child.nextSibling){
if(child===node){
return this.proposals[_14fe]||null;
}
_14fe++;
}
return null;
},setSelectedIndex:function(index){
this.selectedIndex=index;
this.selectNode(this.parentNode.childNodes[this.selectedIndex]);
},selectNode:function(node){
var nodes=this.parentNode.childNodes;
for(var i=0;i<nodes.length;i++){
var child=nodes[i];
if(child.className==="selected"){
child.className="";
}
if(child===node){
child.className="selected";
this.parentNode.setAttribute("aria-activedescendant",child.id);
child.focus();
if(child.offsetTop<this.parentNode.scrollTop){
child.scrollIntoView(true);
}else{
if((child.offsetTop+child.offsetHeight)>(this.parentNode.scrollTop+this.parentNode.clientHeight)){
child.scrollIntoView(false);
}
}
}
}
},setProposals:function(_14ff){
this.proposals=_14ff;
},show:function(){
if(this.proposals.length===0){
this.hide();
return;
}
var _1500=this.textView.getLocationAtOffset(this.textView.getCaretOffset());
_1500.y+=this.textView.getLineHeight();
this.parentNode.innerHTML="";
for(var i=0;i<this.proposals.length;i++){
this.createDiv(this.getDisplayString(this.proposals[i]),i===0,this.parentNode,i);
}
this.textView.convert(_1500,"document","page");
this.parentNode.style.position="absolute";
this.parentNode.style.left=_1500.x+"px";
this.parentNode.style.top=_1500.y+"px";
this.parentNode.style.display="block";
this.parentNode.scrollTop=0;
var _1501=document.documentElement.clientWidth,_1502=document.documentElement.clientHeight;
if(_1500.y+this.parentNode.offsetHeight>_1502){
this.parentNode.style.top=(_1500.y-this.parentNode.offsetHeight-this.textView.getLineHeight())+"px";
}
if(_1500.x+this.parentNode.offsetWidth>_1501){
this.parentNode.style.left=(_1501-this.parentNode.offsetWidth)+"px";
}
this.parentNode.onclick=this.onClick.bind(this);
},hide:function(){
if(document.activeElement===this.parentNode){
this.textView.focus();
}
this.parentNode.style.display="none";
this.parentNode.onclick=null;
}};
return {ContentAssist:_14d7,ContentAssistMode:_14f1,ContentAssistWidget:_14f5};
});
},"dijit/form/_ToggleButtonMixin":function(){
define("dijit/form/_ToggleButtonMixin",["dojo/_base/declare","dojo/dom-attr"],function(_1503,_1504){
return _1503("dijit.form._ToggleButtonMixin",null,{checked:false,_aria_attr:"aria-pressed",_onClick:function(evt){
var _1505=this.checked;
this._set("checked",!_1505);
var ret=this.inherited(arguments);
this.set("checked",ret?this.checked:_1505);
return ret;
},_setCheckedAttr:function(value,_1506){
this._set("checked",value);
_1504.set(this.focusNode||this.domNode,"checked",value);
(this.focusNode||this.domNode).setAttribute(this._aria_attr,value?"true":"false");
this._handleOnChange(value,_1506);
},reset:function(){
this._hasBeenBlurred=false;
this.set("checked",this.params.checked||false);
}});
});
},"dojox/grid/_RowSelector":function(){
define("dojox/grid/_RowSelector",["dojo/_base/declare","./_View"],function(_1507,_1508){
return _1507("dojox.grid._RowSelector",_1508,{defaultWidth:"2em",noscroll:true,padBorderWidth:2,buildRendering:function(){
this.inherited("buildRendering",arguments);
this.scrollboxNode.style.overflow="hidden";
this.headerNode.style.visibility="hidden";
},getWidth:function(){
return this.viewWidth||this.defaultWidth;
},buildRowContent:function(_1509,_150a){
var w=this.contentWidth||0;
_150a.innerHTML="<table class=\"dojoxGridRowbarTable\" style=\"width:"+w+"px;height:1px;\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\" role=\"presentation\"><tr><td class=\"dojoxGridRowbarInner\">&nbsp;</td></tr></table>";
},renderHeader:function(){
},updateRow:function(){
},resize:function(){
this.adaptHeight();
},adaptWidth:function(){
if(!("contentWidth" in this)&&this.contentNode&&this.contentNode.offsetWidth>0){
this.contentWidth=this.contentNode.offsetWidth-this.padBorderWidth;
}
},doStyleRowNode:function(_150b,_150c){
var n=["dojoxGridRowbar dojoxGridNonNormalizedCell"];
if(this.grid.rows.isOver(_150b)){
n.push("dojoxGridRowbarOver");
}
if(this.grid.selection.isSelected(_150b)){
n.push("dojoxGridRowbarSelected");
}
_150c.className=n.join(" ");
},domouseover:function(e){
this.grid.onMouseOverRow(e);
},domouseout:function(e){
if(!this.isIntraRowEvent(e)){
this.grid.onMouseOutRow(e);
}
}});
});
},"davinci/model/Model":function(){
define(["dojo/_base/declare"],function(_150d){
return _150d("davinci.model.Model",null,{constructor:function(){
this.elementType="";
this.name="";
this.startOffset=0;
this.endOffset=0;
this.parent=null;
this.children=[];
},inherits:function(_150e){
if(arguments.length>1){
_150e.apply(this,Array.prototype.slice.call(arguments,1));
}else{
_150e.call(this);
}
},getText:function(){
},setText:function(text){
},addChild:function(child,index,_150f){
child.parent=this;
if(index!=undefined){
this.children.splice(index,0,child);
}else{
this.children.push(child);
}
},setStart:function(_1510){
this.startOffset=_1510;
},setEnd:function(_1511){
this.endOffset=_1511;
},getLabel:function(){
return null;
},getID:function(){
return null;
},mapPositions:function(_1512){
return {startOffset:_1512.startOffset,endOffset:_1512.endOffset};
},findChildAtPosition:function(_1513){
if(!_1513.endOffset){
_1513.endOffset=_1513.startOffset;
}
if(_1513.startOffset>=this.startOffset&&_1513.endOffset<=this.endOffset){
for(var i=0;i<this.children.length;i++){
var child=this.children[i].findChildAtPosition(_1513);
if(child!=null){
return child;
}
}
return this;
}
return null;
},removeChild:function(child){
for(var i=0;i<this.children.length;i++){
if(this.children[i]==child){
this.children.splice(i,1);
return;
}
}
},find:function(_1514,_1515){
var _1516={visit:function(node){
if(this.found.length>0&&_1515){
return true;
}
var name=null;
for(name in _1514){
if(node[name]!=_1514[name]){
break;
}
}
if(node[name]==_1514[name]){
this.found.push(node);
}
return false;
},found:[]};
this.visit(_1516);
if(_1515){
return (_1516.found.length>0)?_1516.found[0]:null;
}
return _1516.found;
},setDirty:function(_1517){
this.dirtyResource=_1517;
},isDirty:function(){
return this.dirtyResource;
},searchUp:function(_1518){
if(this.elementType==_1518){
return this;
}
var _1519=this.parent;
while(_1519&&_1519.elementType!=_1518){
_1519=_1519.parent;
}
return _1519;
},visit:function(_151a){
if(!_151a.visit(this)){
for(var i=0;i<this.children.length;i++){
this.children[i].visit(_151a);
}
}
if(_151a.endVisit){
_151a.endVisit(this);
}
},updatePositions:function(model,_151b,delta){
visitor={visit:function(_151c){
if(_151c.endOffset<_151b){
return true;
}
if(_151c.startOffset>=_151b){
_151c.startOffset+=delta;
_151c.endOffset+=delta;
}else{
if(_151c.endOffset>=_151b){
_151c.endOffset+=delta;
}
}
}};
model.visit(visitor);
}});
});
},"davinci/ui/Rename":function(){
define(["dojo/_base/declare","dijit/_Templated","dijit/_Widget","dojo/i18n!davinci/ui/nls/ui","dojo/i18n!dijit/nls/common","dojo/text!./templates/Rename.html"],function(_151d,_151e,_151f,uiNLS,_1520,_1521){
return _151d("davinci.ui.Rename",[_151f,_151e],{widgetsInTemplate:true,templateString:_1521,_okButton:null,_newName:null,_eclipseSupport:null,postMixInProperties:function(){
var _1522=uiNLS;
var _1523=_1520;
dojo.mixin(this,_1522);
dojo.mixin(this,_1523);
if(!this.invalid){
this.invalid={};
}
this.inherited(arguments);
},postCreate:function(){
this.inherited(arguments);
dojo.connect(this._newName,"onkeyup",this,"_checkValid");
if(this.value){
this._setValueAttr(this.value);
}
if(this.invalid){
this._setInvalidAttr(this.invalid);
}
},_setInvalidAttr:function(_1524){
this.invalid=_1524;
},_checkValid:function(){
var name=dojo.attr(this._newName,"value");
var valid=(name!=null&&name.length>0);
for(var i=0;i<this.invalid.length&&valid;i++){
if(this.invalid[i]==name){
valid=false;
}
}
this._okButton.set("disabled",!valid);
},okButton:function(){
this.value=dojo.attr(this._newName,"value");
},_getValueAttr:function(){
return this.value;
},_setValueAttr:function(value){
this.value=value;
if(this._newName){
dojo.attr(this._newName,"value",this.value);
}
this._checkValid();
},cancelButton:function(){
this.cancel=true;
this.onClose();
},_getCancelAttr:function(value){
return this.cancel;
},onClose:function(){
}});
});
},"dijit/form/MappedTextBox":function(){
define("dijit/form/MappedTextBox",["dojo/_base/declare","dojo/dom-construct","./ValidationTextBox"],function(_1525,_1526,_1527){
return _1525("dijit.form.MappedTextBox",_1527,{postMixInProperties:function(){
this.inherited(arguments);
this.nameAttrSetting="";
},_setNameAttr:null,serialize:function(val){
return val.toString?val.toString():"";
},toString:function(){
var val=this.filter(this.get("value"));
return val!=null?(typeof val=="string"?val:this.serialize(val,this.constraints)):"";
},validate:function(){
this.valueNode.value=this.toString();
return this.inherited(arguments);
},buildRendering:function(){
this.inherited(arguments);
this.valueNode=_1526.place("<input type='hidden'"+(this.name?" name=\""+this.name.replace(/"/g,"&quot;")+"\"":"")+"/>",this.textbox,"after");
},reset:function(){
this.valueNode.value="";
this.inherited(arguments);
}});
});
},"url:dijit/templates/TreeNode.html":"<div class=\"dijitTreeNode\" role=\"presentation\"\n\t><div data-dojo-attach-point=\"rowNode\" class=\"dijitTreeRow dijitInline\" role=\"presentation\"\n\t\t><div data-dojo-attach-point=\"indentNode\" class=\"dijitInline\"></div\n\t\t><img src=\"${_blankGif}\" alt=\"\" data-dojo-attach-point=\"expandoNode\" class=\"dijitTreeExpando\" role=\"presentation\"\n\t\t/><span data-dojo-attach-point=\"expandoNodeText\" class=\"dijitExpandoText\" role=\"presentation\"\n\t\t></span\n\t\t><span data-dojo-attach-point=\"contentNode\"\n\t\t\tclass=\"dijitTreeContent\" role=\"presentation\">\n\t\t\t<img src=\"${_blankGif}\" alt=\"\" data-dojo-attach-point=\"iconNode\" class=\"dijitIcon dijitTreeIcon\" role=\"presentation\"\n\t\t\t/><span data-dojo-attach-point=\"labelNode\" class=\"dijitTreeLabel\" role=\"treeitem\" tabindex=\"-1\" aria-selected=\"false\"></span>\n\t\t</span\n\t></div>\n\t<div data-dojo-attach-point=\"containerNode\" class=\"dijitTreeContainer\" role=\"presentation\" style=\"display: none;\"></div>\n</div>\n","davinci/ve/ObjectWidget":function(){
define(["dojo/_base/declare","dojo/dom-attr","./_Widget"],function(_1528,_1529,_152a){
return _1528("davinci.ve.ObjectWidget",_152a,{isObjectWidget:true,constructor:function(_152b,node,_152c,_152d,_152e){
if(typeof _152c==="string"){
_1529.set(node,"data-dojo-type",_152c);
if(_152e){
_152e.addAttribute("data-dojo-type",_152c);
}
}
},postCreate:function(){
var id=this._params.jsId,dj=require("davinci/ve/widget")._dojo(this.domNode),_152f;
if(id){
_1529.set(this.domNode,"jsId",id);
var type=this.getObjectType();
if(type){
var c=dj.getObject(type);
if(c){
if(c.markupFactory){
_152f=c.markupFactory(this._params,this.domNode,c);
}else{
if(c.prototype&&c.prototype.markupFactory){
_152f=c.prototype.markupFactory(this._params,this.domNode,c);
}else{
_152f=new c(this._params,this.domNode);
}
}
if(_152f){
_152f._edit_object_id=id;
dj.setObject(id,_152f);
}
}
}
}else{
id=this.getObjectId();
if(id){
_152f=dj.getObject(id);
if(_152f){
_152f._edit_object_id=id;
}
}
}
},getObjectType:function(){
var node=this.domNode;
return _1529.get(node,"data-dojo-type")||_1529.get(node,"dojoType");
},getObjectId:function(){
return _1529.get(this.domNode,"jsId");
},_getChildren:function(){
return [];
}});
});
},"davinci/js/JSModel":function(){
define("davinci/js/JSModel",["dojo/_base/declare","davinci/model/Model"],function(_1530,Model){
if(!davinci.js){
davinci.js={};
}
return _1530("davinci.js.JSModel",Model,{});
});
},"davinci/model/resource/Folder":function(){
define(["dojo/_base/declare","dojo/_base/xhr","davinci/Runtime","davinci/model/resource/Resource","davinci/model/resource/File"],function(_1531,xhr,_1532,_1533,File){
var _1534=_1531(_1533,{constructor:function(name,_1535){
this.elementType="Folder";
this.name=name;
this.parent=_1535;
},reload:function(){
this._isLoaded=false;
},createResource:function(name,_1536,_1537){
var file;
if(name!=null){
file=_1536?new _1534(name,this):new File(name,this);
}else{
file=this;
_1536=this.elementType=="Folder";
}
var _1538=_1537?"OK":_1532.serverJSONRequest({url:"cmd/createResource",handleAs:"text",content:{path:file.getPath(),isFolder:_1536},sync:true});
if(_1538=="OK"&&name!=null){
this.children.push(file);
delete file.libraryId;
delete file.libVersion;
delete file._readOnly;
dojo.publish("/davinci/resource/resourceChanged",["created",file]);
return file;
}else{
if(_1538=="EXISTS"){
this.children.push(file);
delete file.libraryId;
delete file.libVersion;
delete file._readOnly;
dojo.publish("/davinci/resource/resourceChanged",["created",file]);
return file;
}else{
if(_1538!="OK"){
throw "Folder.createResource failed: name="+name+"response="+_1538;
}else{
delete file.libraryId;
delete file.libVersion;
delete file._readOnly;
return this;
}
}
}
},getChildren:function(_1539,_153a){
if(this._isLoaded){
_1539.call(null,this.children);
}else{
if(this._loading){
this._loading.then(function(){
_1539.call(null,this.children);
}.bind(this),_153a);
}else{
this._loading=xhr.get({url:"cmd/listFiles",content:{path:this.getPath()},sync:false,handleAs:"json"}).then(function(_153b){
this.setChildren(_153b);
this._isLoaded=true;
_1539.call(null,this.children);
delete this._loading;
}.bind(this),_153a);
}
}
},getChildrenSync:function(_153c,sync){
if(!this._isLoaded){
if(this._loadingCallbacks){
this._loadingCallbacks.push(_153c);
return;
}
this._loadingCallbacks=[];
this._loadingCallbacks.push(_153c);
_1532.serverJSONRequest({url:"cmd/listFiles",content:{path:this.getPath()},sync:sync,load:dojo.hitch(this,function(_153d,_153e){
this.setChildrenSync(_153d);
dojo.forEach(this._loadingCallbacks,function(item){
(item)(this.children);
},this);
delete this._loadingCallbacks;
})});
return;
}
_153c(this.children);
},setChildren:function(_153f){
this.children=[];
this._appendFiles(_153f);
},setChildrenSync:function(_1540){
this.children=[];
this._appendFiles(_1540,true);
},_appendFiles:function(_1541,sync){
_1541.forEach(function(item){
var child=sync?this.getChildSync(item.name):this._getChild(item.name);
var _1542=child!=null;
if(item.isDir||item.isLib){
if(!_1542){
child=new _1534(item.name,this);
}
if(item.isLib){
child.isLibrary=true;
}
}else{
if(!_1542){
child=new File(item.name,this);
}
}
child.link=item.link;
child.isNew=item.isNew;
child._readOnly=item.readOnly;
child.setDirty(item.isDirty);
if(item.libraryId){
child.libraryId=item.libraryId;
child.libVersion=item.libVersion;
}
if(!_1542){
this.children.push(child);
}
},this);
this._isLoaded=true;
},getMarkers:function(_1543,_1544){
var _1545=[];
this.visit({visit:function(_1546){
if(_1546.elementType=="File"){
markers=_1546.getMarkers(_1543);
_1545.concat(markers);
}else{
if(!_1544){
return true;
}
}
}},true);
return _1545;
},getChildSync:function(name){
if(!this._isLoaded||(this.children.length<1)){
this._isLoaded=false;
this.getChildrenSync(function(item){
this.children=item;
},true);
}
return this._getChild(name);
},_getChild:function(name){
if(!this.__CASE_SENSITIVE){
name=name.toLowerCase();
}
var _1547;
this.children.some(function(child){
var _1548=child.getName();
if(!this.__CASE_SENSITIVE){
_1548=_1548.toLowerCase();
}
var match=_1548==name;
if(match){
_1547=child;
}
return match;
});
return _1547;
}});
davinci.model.resource.root=new _1534(".",null);
return _1534;
});
},"dijit/form/_AutoCompleterMixin":function(){
define("dijit/form/_AutoCompleterMixin",["dojo/data/util/filter","dojo/_base/declare","dojo/dom-attr","dojo/_base/event","dojo/keys","dojo/_base/lang","dojo/query","dojo/regexp","dojo/sniff","dojo/string","./DataList","../registry","./_TextBoxMixin","./_SearchMixin"],function(_1549,_154a,_154b,event,keys,lang,query,_154c,has,_154d,_154e,_154f,_1550,_1551){
return _154a("dijit.form._AutoCompleterMixin",_1551,{item:null,autoComplete:true,highlightMatch:"first",labelAttr:"",labelType:"text",maxHeight:-1,_stopClickEvents:false,_getCaretPos:function(_1552){
var pos=0;
if(typeof (_1552.selectionStart)=="number"){
pos=_1552.selectionStart;
}else{
if(has("ie")){
var tr=_1552.ownerDocument.selection.createRange().duplicate();
var ntr=_1552.createTextRange();
tr.move("character",0);
ntr.move("character",0);
try{
ntr.setEndPoint("EndToEnd",tr);
pos=String(ntr.text).replace(/\r/g,"").length;
}
catch(e){
}
}
}
return pos;
},_setCaretPos:function(_1553,_1554){
_1554=parseInt(_1554);
_1550.selectInputText(_1553,_1554,_1554);
},_setDisabledAttr:function(value){
this.inherited(arguments);
this.domNode.setAttribute("aria-disabled",value?"true":"false");
},_onKey:function(evt){
if(evt.charCode>=32){
return;
}
var key=evt.charCode||evt.keyCode;
if(key==keys.ALT||key==keys.CTRL||key==keys.META||key==keys.SHIFT){
return;
}
var pw=this.dropDown;
var _1555=null;
this._abortQuery();
this.inherited(arguments);
if(evt.altKey||evt.ctrlKey||evt.metaKey){
return;
}
if(this._opened){
_1555=pw.getHighlightedOption();
}
switch(key){
case keys.PAGE_DOWN:
case keys.DOWN_ARROW:
case keys.PAGE_UP:
case keys.UP_ARROW:
if(this._opened){
this._announceOption(_1555);
}
event.stop(evt);
break;
case keys.ENTER:
if(_1555){
if(_1555==pw.nextButton){
this._nextSearch(1);
event.stop(evt);
break;
}else{
if(_1555==pw.previousButton){
this._nextSearch(-1);
event.stop(evt);
break;
}
}
event.stop(evt);
}else{
this._setBlurValue();
this._setCaretPos(this.focusNode,this.focusNode.value.length);
}
case keys.TAB:
var _1556=this.get("displayedValue");
if(pw&&(_1556==pw._messages["previousMessage"]||_1556==pw._messages["nextMessage"])){
break;
}
if(_1555){
this._selectOption(_1555);
}
case keys.ESCAPE:
if(this._opened){
this._lastQuery=null;
this.closeDropDown();
}
break;
}
},_autoCompleteText:function(text){
var fn=this.focusNode;
_1550.selectInputText(fn,fn.value.length);
var _1557=this.ignoreCase?"toLowerCase":"substr";
if(text[_1557](0).indexOf(this.focusNode.value[_1557](0))==0){
var cpos=this.autoComplete?this._getCaretPos(fn):fn.value.length;
if((cpos+1)>fn.value.length){
fn.value=text;
_1550.selectInputText(fn,cpos);
}
}else{
fn.value=text;
_1550.selectInputText(fn);
}
},_openResultList:function(_1558,query,_1559){
var _155a=this.dropDown.getHighlightedOption();
this.dropDown.clearResultList();
if(!_1558.length&&_1559.start==0){
this.closeDropDown();
return;
}
this._nextSearch=this.dropDown.onPage=lang.hitch(this,function(_155b){
_1558.nextPage(_155b!==-1);
this.focus();
});
this.dropDown.createOptions(_1558,_1559,lang.hitch(this,"_getMenuLabelFromItem"));
this._showResultList();
if("direction" in _1559){
if(_1559.direction){
this.dropDown.highlightFirstOption();
}else{
if(!_1559.direction){
this.dropDown.highlightLastOption();
}
}
if(_155a){
this._announceOption(this.dropDown.getHighlightedOption());
}
}else{
if(this.autoComplete&&!this._prev_key_backspace&&!/^[*]+$/.test(query[this.searchAttr].toString())){
this._announceOption(this.dropDown.containerNode.firstChild.nextSibling);
}
}
},_showResultList:function(){
this.closeDropDown(true);
this.openDropDown();
this.domNode.setAttribute("aria-expanded","true");
},loadDropDown:function(){
this._startSearchAll();
},isLoaded:function(){
return false;
},closeDropDown:function(){
this._abortQuery();
if(this._opened){
this.inherited(arguments);
this.domNode.setAttribute("aria-expanded","false");
this.focusNode.removeAttribute("aria-activedescendant");
}
},_setBlurValue:function(){
var _155c=this.get("displayedValue");
var pw=this.dropDown;
if(pw&&(_155c==pw._messages["previousMessage"]||_155c==pw._messages["nextMessage"])){
this._setValueAttr(this._lastValueReported,true);
}else{
if(typeof this.item=="undefined"){
this.item=null;
this.set("displayedValue",_155c);
}else{
if(this.value!=this._lastValueReported){
this._handleOnChange(this.value,true);
}
this._refreshState();
}
}
},_setItemAttr:function(item,_155d,_155e){
var value="";
if(item){
if(!_155e){
_155e=this.store._oldAPI?this.store.getValue(item,this.searchAttr):item[this.searchAttr];
}
value=this._getValueField()!=this.searchAttr?this.store.getIdentity(item):_155e;
}
this.set("value",value,_155d,_155e,item);
},_announceOption:function(node){
if(!node){
return;
}
var _155f;
if(node==this.dropDown.nextButton||node==this.dropDown.previousButton){
_155f=node.innerHTML;
this.item=undefined;
this.value="";
}else{
var item=this.dropDown.items[node.getAttribute("item")];
_155f=(this.store._oldAPI?this.store.getValue(item,this.searchAttr):item[this.searchAttr]).toString();
this.set("item",item,false,_155f);
}
this.focusNode.value=this.focusNode.value.substring(0,this._lastInput.length);
this.focusNode.setAttribute("aria-activedescendant",_154b.get(node,"id"));
this._autoCompleteText(_155f);
},_selectOption:function(_1560){
this.closeDropDown();
if(_1560){
this._announceOption(_1560);
}
this._setCaretPos(this.focusNode,this.focusNode.value.length);
this._handleOnChange(this.value,true);
},_startSearchAll:function(){
this._startSearch("");
},_startSearchFromInput:function(){
this.item=undefined;
this.inherited(arguments);
},_startSearch:function(key){
if(!this.dropDown){
var _1561=this.id+"_popup",_1562=lang.isString(this.dropDownClass)?lang.getObject(this.dropDownClass,false):this.dropDownClass;
this.dropDown=new _1562({onChange:lang.hitch(this,this._selectOption),id:_1561,dir:this.dir,textDir:this.textDir});
this.focusNode.removeAttribute("aria-activedescendant");
this.textbox.setAttribute("aria-owns",_1561);
}
this._lastInput=key;
this.inherited(arguments);
},_getValueField:function(){
return this.searchAttr;
},postMixInProperties:function(){
this.inherited(arguments);
if(!this.store){
var _1563=this.srcNodeRef;
this.store=new _154e({},_1563);
if(!("value" in this.params)){
var item=(this.item=this.store.fetchSelectedItem());
if(item){
var _1564=this._getValueField();
this.value=this.store._oldAPI?this.store.getValue(item,_1564):item[_1564];
}
}
}
},postCreate:function(){
var label=query("label[for=\""+this.id+"\"]");
if(label.length){
if(!label[0].id){
label[0].id=this.id+"_label";
}
this.domNode.setAttribute("aria-labelledby",label[0].id);
}
this.inherited(arguments);
this.connect(this,"onSearch","_openResultList");
},_getMenuLabelFromItem:function(item){
var label=this.labelFunc(item,this.store),_1565=this.labelType;
if(this.highlightMatch!="none"&&this.labelType=="text"&&this._lastInput){
label=this.doHighlight(label,this._lastInput);
_1565="html";
}
return {html:_1565=="html",label:label};
},doHighlight:function(label,find){
var _1566=(this.ignoreCase?"i":"")+(this.highlightMatch=="all"?"g":""),i=this.queryExpr.indexOf("${0}");
find=_154c.escapeString(find);
return this._escapeHtml(label.replace(new RegExp((i==0?"^":"")+"("+find+")"+(i==(this.queryExpr.length-4)?"$":""),_1566),"$1")).replace(/\uFFFF([^\uFFFF]+)\uFFFF/g,"<span class=\"dijitComboBoxHighlightMatch\">$1</span>");
},_escapeHtml:function(str){
str=String(str).replace(/&/gm,"&amp;").replace(/</gm,"&lt;").replace(/>/gm,"&gt;").replace(/"/gm,"&quot;");
return str;
},reset:function(){
this.item=null;
this.inherited(arguments);
},labelFunc:function(item,store){
return (store._oldAPI?store.getValue(item,this.labelAttr||this.searchAttr):item[this.labelAttr||this.searchAttr]).toString();
},_setValueAttr:function(value,_1567,_1568,item){
this._set("item",item||null);
if(value==null){
value="";
}
this.inherited(arguments);
},_setTextDirAttr:function(_1569){
this.inherited(arguments);
if(this.dropDown){
this.dropDown._set("textDir",_1569);
}
}});
});
},"dijit/layout/StackController":function(){
define("dijit/layout/StackController",["dojo/_base/array","dojo/_base/declare","dojo/dom-class","dojo/_base/event","dojo/keys","dojo/_base/lang","dojo/on","../focus","../registry","../_Widget","../_TemplatedMixin","../_Container","../form/ToggleButton","dojo/i18n!../nls/common"],function(array,_156a,_156b,event,keys,lang,on,focus,_156c,_156d,_156e,_156f,_1570){
var _1571=_156a("dijit.layout._StackButton",_1570,{tabIndex:"-1",closeButton:false,_aria_attr:"aria-selected",buildRendering:function(evt){
this.inherited(arguments);
(this.focusNode||this.domNode).setAttribute("role","tab");
}});
var _1572=_156a("dijit.layout.StackController",[_156d,_156e,_156f],{baseClass:"dijitStackController",templateString:"<span role='tablist' data-dojo-attach-event='onkeypress'></span>",containerId:"",buttonWidget:_1571,buttonWidgetCloseClass:"dijitStackCloseButton",constructor:function(_1573){
this.pane2button={};
},postCreate:function(){
this.inherited(arguments);
this.subscribe(this.containerId+"-startup","onStartup");
this.subscribe(this.containerId+"-addChild","onAddChild");
this.subscribe(this.containerId+"-removeChild","onRemoveChild");
this.subscribe(this.containerId+"-selectChild","onSelectChild");
this.subscribe(this.containerId+"-containerKeyPress","onContainerKeyPress");
this.connect(this.containerNode,"click",function(evt){
var _1574=_156c.getEnclosingWidget(evt.target);
if(_1574!=this.containerNode&&!_1574.disabled&&_1574.page){
for(var _1575=evt.target;_1575!==this.containerNode;_1575=_1575.parentNode){
if(_156b.contains(_1575,this.buttonWidgetCloseClass)){
this.onCloseButtonClick(_1574.page);
break;
}else{
if(_1575==_1574.domNode){
this.onButtonClick(_1574.page);
break;
}
}
}
}
});
},onStartup:function(info){
array.forEach(info.children,this.onAddChild,this);
if(info.selected){
this.onSelectChild(info.selected);
}
var _1576=_156c.byId(this.containerId).containerNode,_1577=this.pane2button,_1578={"title":"label","showtitle":"showLabel","iconclass":"iconClass","closable":"closeButton","tooltip":"title","disabled":"disabled"},_1579=function(attr,_157a){
return on(_1576,"attrmodified-"+attr,function(evt){
var _157b=_1577[evt.detail&&evt.detail.widget&&evt.detail.widget.id];
if(_157b){
_157b.set(_157a,evt.detail.newValue);
}
});
};
for(var attr in _1578){
this.own(_1579(attr,_1578[attr]));
}
},destroy:function(){
for(var pane in this.pane2button){
this.onRemoveChild(_156c.byId(pane));
}
this.inherited(arguments);
},onAddChild:function(page,_157c){
var Cls=lang.isString(this.buttonWidget)?lang.getObject(this.buttonWidget):this.buttonWidget;
var _157d=new Cls({id:this.id+"_"+page.id,name:this.id+"_"+page.id,label:page.title,disabled:page.disabled,ownerDocument:this.ownerDocument,dir:page.dir,lang:page.lang,textDir:page.textDir,showLabel:page.showTitle,iconClass:page.iconClass,closeButton:page.closable,title:page.tooltip,page:page});
this.addChild(_157d,_157c);
this.pane2button[page.id]=_157d;
page.controlButton=_157d;
if(!this._currentChild){
this.onSelectChild(page);
}
},onRemoveChild:function(page){
if(this._currentChild===page){
this._currentChild=null;
}
var _157e=this.pane2button[page.id];
if(_157e){
this.removeChild(_157e);
delete this.pane2button[page.id];
_157e.destroy();
}
delete page.controlButton;
},onSelectChild:function(page){
if(!page){
return;
}
if(this._currentChild){
var _157f=this.pane2button[this._currentChild.id];
_157f.set("checked",false);
_157f.focusNode.setAttribute("tabIndex","-1");
}
var _1580=this.pane2button[page.id];
_1580.set("checked",true);
this._currentChild=page;
_1580.focusNode.setAttribute("tabIndex","0");
var _1581=_156c.byId(this.containerId);
_1581.containerNode.setAttribute("aria-labelledby",_1580.id);
},onButtonClick:function(page){
var _1582=this.pane2button[page.id];
focus.focus(_1582.focusNode);
if(this._currentChild&&this._currentChild.id===page.id){
_1582.set("checked",true);
}
var _1583=_156c.byId(this.containerId);
_1583.selectChild(page);
},onCloseButtonClick:function(page){
var _1584=_156c.byId(this.containerId);
_1584.closeChild(page);
if(this._currentChild){
var b=this.pane2button[this._currentChild.id];
if(b){
focus.focus(b.focusNode||b.domNode);
}
}
},adjacent:function(_1585){
if(!this.isLeftToRight()&&(!this.tabPosition||/top|bottom/.test(this.tabPosition))){
_1585=!_1585;
}
var _1586=this.getChildren();
var idx=array.indexOf(_1586,this.pane2button[this._currentChild.id]),_1587=_1586[idx];
var child;
do{
idx=(idx+(_1585?1:_1586.length-1))%_1586.length;
child=_1586[idx];
}while(child.disabled&&child!=_1587);
return child;
},onkeypress:function(e){
if(this.disabled||e.altKey){
return;
}
var _1588=null;
if(e.ctrlKey||!e._djpage){
switch(e.charOrCode){
case keys.LEFT_ARROW:
case keys.UP_ARROW:
if(!e._djpage){
_1588=false;
}
break;
case keys.PAGE_UP:
if(e.ctrlKey){
_1588=false;
}
break;
case keys.RIGHT_ARROW:
case keys.DOWN_ARROW:
if(!e._djpage){
_1588=true;
}
break;
case keys.PAGE_DOWN:
if(e.ctrlKey){
_1588=true;
}
break;
case keys.HOME:
var _1589=this.getChildren();
for(var idx=0;idx<_1589.length;idx++){
var child=_1589[idx];
if(!child.disabled){
this.onButtonClick(child.page);
break;
}
}
event.stop(e);
break;
case keys.END:
var _1589=this.getChildren();
for(var idx=_1589.length-1;idx>=0;idx--){
var child=_1589[idx];
if(!child.disabled){
this.onButtonClick(child.page);
break;
}
}
event.stop(e);
break;
case keys.DELETE:
if(this._currentChild.closable){
this.onCloseButtonClick(this._currentChild);
}
event.stop(e);
break;
default:
if(e.ctrlKey){
if(e.charOrCode===keys.TAB){
this.onButtonClick(this.adjacent(!e.shiftKey).page);
event.stop(e);
}else{
if(e.charOrCode=="w"){
if(this._currentChild.closable){
this.onCloseButtonClick(this._currentChild);
}
event.stop(e);
}
}
}
}
if(_1588!==null){
this.onButtonClick(this.adjacent(_1588).page);
event.stop(e);
}
}
},onContainerKeyPress:function(info){
info.e._djpage=info.page;
this.onkeypress(info.e);
}});
_1572.StackButton=_1571;
return _1572;
});
},"dojo/number":function(){
define("dojo/number",["./_base/lang","./i18n","./i18n!./cldr/nls/number","./string","./regexp"],function(lang,i18n,_158a,_158b,_158c){
var _158d={};
lang.setObject("dojo.number",_158d);
_158d.format=function(value,_158e){
_158e=lang.mixin({},_158e||{});
var _158f=i18n.normalizeLocale(_158e.locale),_1590=i18n.getLocalization("dojo.cldr","number",_158f);
_158e.customs=_1590;
var _1591=_158e.pattern||_1590[(_158e.type||"decimal")+"Format"];
if(isNaN(value)||Math.abs(value)==Infinity){
return null;
}
return _158d._applyPattern(value,_1591,_158e);
};
_158d._numberPatternRE=/[#0,]*[#0](?:\.0*#*)?/;
_158d._applyPattern=function(value,_1592,_1593){
_1593=_1593||{};
var group=_1593.customs.group,_1594=_1593.customs.decimal,_1595=_1592.split(";"),_1596=_1595[0];
_1592=_1595[(value<0)?1:0]||("-"+_1596);
if(_1592.indexOf("%")!=-1){
value*=100;
}else{
if(_1592.indexOf("")!=-1){
value*=1000;
}else{
if(_1592.indexOf("")!=-1){
group=_1593.customs.currencyGroup||group;
_1594=_1593.customs.currencyDecimal||_1594;
_1592=_1592.replace(/\u00a4{1,3}/,function(match){
var prop=["symbol","currency","displayName"][match.length-1];
return _1593[prop]||_1593.currency||"";
});
}else{
if(_1592.indexOf("E")!=-1){
throw new Error("exponential notation not supported");
}
}
}
}
var _1597=_158d._numberPatternRE;
var _1598=_1596.match(_1597);
if(!_1598){
throw new Error("unable to find a number expression in pattern: "+_1592);
}
if(_1593.fractional===false){
_1593.places=0;
}
return _1592.replace(_1597,_158d._formatAbsolute(value,_1598[0],{decimal:_1594,group:group,places:_1593.places,round:_1593.round}));
};
_158d.round=function(value,_1599,_159a){
var _159b=10/(_159a||10);
return (_159b*+value).toFixed(_1599)/_159b;
};
if((0.9).toFixed()==0){
var round=_158d.round;
_158d.round=function(v,p,m){
var d=Math.pow(10,-p||0),a=Math.abs(v);
if(!v||a>=d||a*Math.pow(10,p+1)<5){
d=0;
}
return round(v,p,m)+(v>0?d:-d);
};
}
_158d._formatAbsolute=function(value,_159c,_159d){
_159d=_159d||{};
if(_159d.places===true){
_159d.places=0;
}
if(_159d.places===Infinity){
_159d.places=6;
}
var _159e=_159c.split("."),comma=typeof _159d.places=="string"&&_159d.places.indexOf(","),_159f=_159d.places;
if(comma){
_159f=_159d.places.substring(comma+1);
}else{
if(!(_159f>=0)){
_159f=(_159e[1]||[]).length;
}
}
if(!(_159d.round<0)){
value=_158d.round(value,_159f,_159d.round);
}
var _15a0=String(Math.abs(value)).split("."),_15a1=_15a0[1]||"";
if(_159e[1]||_159d.places){
if(comma){
_159d.places=_159d.places.substring(0,comma);
}
var pad=_159d.places!==undefined?_159d.places:(_159e[1]&&_159e[1].lastIndexOf("0")+1);
if(pad>_15a1.length){
_15a0[1]=_158b.pad(_15a1,pad,"0",true);
}
if(_159f<_15a1.length){
_15a0[1]=_15a1.substr(0,_159f);
}
}else{
if(_15a0[1]){
_15a0.pop();
}
}
var _15a2=_159e[0].replace(",","");
pad=_15a2.indexOf("0");
if(pad!=-1){
pad=_15a2.length-pad;
if(pad>_15a0[0].length){
_15a0[0]=_158b.pad(_15a0[0],pad);
}
if(_15a2.indexOf("#")==-1){
_15a0[0]=_15a0[0].substr(_15a0[0].length-pad);
}
}
var index=_159e[0].lastIndexOf(","),_15a3,_15a4;
if(index!=-1){
_15a3=_159e[0].length-index-1;
var _15a5=_159e[0].substr(0,index);
index=_15a5.lastIndexOf(",");
if(index!=-1){
_15a4=_15a5.length-index-1;
}
}
var _15a6=[];
for(var whole=_15a0[0];whole;){
var off=whole.length-_15a3;
_15a6.push((off>0)?whole.substr(off):whole);
whole=(off>0)?whole.slice(0,off):"";
if(_15a4){
_15a3=_15a4;
delete _15a4;
}
}
_15a0[0]=_15a6.reverse().join(_159d.group||",");
return _15a0.join(_159d.decimal||".");
};
_158d.regexp=function(_15a7){
return _158d._parseInfo(_15a7).regexp;
};
_158d._parseInfo=function(_15a8){
_15a8=_15a8||{};
var _15a9=i18n.normalizeLocale(_15a8.locale),_15aa=i18n.getLocalization("dojo.cldr","number",_15a9),_15ab=_15a8.pattern||_15aa[(_15a8.type||"decimal")+"Format"],group=_15aa.group,_15ac=_15aa.decimal,_15ad=1;
if(_15ab.indexOf("%")!=-1){
_15ad/=100;
}else{
if(_15ab.indexOf("")!=-1){
_15ad/=1000;
}else{
var _15ae=_15ab.indexOf("")!=-1;
if(_15ae){
group=_15aa.currencyGroup||group;
_15ac=_15aa.currencyDecimal||_15ac;
}
}
}
var _15af=_15ab.split(";");
if(_15af.length==1){
_15af.push("-"+_15af[0]);
}
var re=_158c.buildGroupRE(_15af,function(_15b0){
_15b0="(?:"+_158c.escapeString(_15b0,".")+")";
return _15b0.replace(_158d._numberPatternRE,function(_15b1){
var flags={signed:false,separator:_15a8.strict?group:[group,""],fractional:_15a8.fractional,decimal:_15ac,exponent:false},parts=_15b1.split("."),_15b2=_15a8.places;
if(parts.length==1&&_15ad!=1){
parts[1]="###";
}
if(parts.length==1||_15b2===0){
flags.fractional=false;
}else{
if(_15b2===undefined){
_15b2=_15a8.pattern?parts[1].lastIndexOf("0")+1:Infinity;
}
if(_15b2&&_15a8.fractional==undefined){
flags.fractional=true;
}
if(!_15a8.places&&(_15b2<parts[1].length)){
_15b2+=","+parts[1].length;
}
flags.places=_15b2;
}
var _15b3=parts[0].split(",");
if(_15b3.length>1){
flags.groupSize=_15b3.pop().length;
if(_15b3.length>1){
flags.groupSize2=_15b3.pop().length;
}
}
return "("+_158d._realNumberRegexp(flags)+")";
});
},true);
if(_15ae){
re=re.replace(/([\s\xa0]*)(\u00a4{1,3})([\s\xa0]*)/g,function(match,_15b4,_15b5,after){
var prop=["symbol","currency","displayName"][_15b5.length-1],_15b6=_158c.escapeString(_15a8[prop]||_15a8.currency||"");
_15b4=_15b4?"[\\s\\xa0]":"";
after=after?"[\\s\\xa0]":"";
if(!_15a8.strict){
if(_15b4){
_15b4+="*";
}
if(after){
after+="*";
}
return "(?:"+_15b4+_15b6+after+")?";
}
return _15b4+_15b6+after;
});
}
return {regexp:re.replace(/[\xa0 ]/g,"[\\s\\xa0]"),group:group,decimal:_15ac,factor:_15ad};
};
_158d.parse=function(_15b7,_15b8){
var info=_158d._parseInfo(_15b8),_15b9=(new RegExp("^"+info.regexp+"$")).exec(_15b7);
if(!_15b9){
return NaN;
}
var _15ba=_15b9[1];
if(!_15b9[1]){
if(!_15b9[2]){
return NaN;
}
_15ba=_15b9[2];
info.factor*=-1;
}
_15ba=_15ba.replace(new RegExp("["+info.group+"\\s\\xa0"+"]","g"),"").replace(info.decimal,".");
return _15ba*info.factor;
};
_158d._realNumberRegexp=function(flags){
flags=flags||{};
if(!("places" in flags)){
flags.places=Infinity;
}
if(typeof flags.decimal!="string"){
flags.decimal=".";
}
if(!("fractional" in flags)||/^0/.test(flags.places)){
flags.fractional=[true,false];
}
if(!("exponent" in flags)){
flags.exponent=[true,false];
}
if(!("eSigned" in flags)){
flags.eSigned=[true,false];
}
var _15bb=_158d._integerRegexp(flags),_15bc=_158c.buildGroupRE(flags.fractional,function(q){
var re="";
if(q&&(flags.places!==0)){
re="\\"+flags.decimal;
if(flags.places==Infinity){
re="(?:"+re+"\\d+)?";
}else{
re+="\\d{"+flags.places+"}";
}
}
return re;
},true);
var _15bd=_158c.buildGroupRE(flags.exponent,function(q){
if(q){
return "([eE]"+_158d._integerRegexp({signed:flags.eSigned})+")";
}
return "";
});
var _15be=_15bb+_15bc;
if(_15bc){
_15be="(?:(?:"+_15be+")|(?:"+_15bc+"))";
}
return _15be+_15bd;
};
_158d._integerRegexp=function(flags){
flags=flags||{};
if(!("signed" in flags)){
flags.signed=[true,false];
}
if(!("separator" in flags)){
flags.separator="";
}else{
if(!("groupSize" in flags)){
flags.groupSize=3;
}
}
var _15bf=_158c.buildGroupRE(flags.signed,function(q){
return q?"[-+]":"";
},true);
var _15c0=_158c.buildGroupRE(flags.separator,function(sep){
if(!sep){
return "(?:\\d+)";
}
sep=_158c.escapeString(sep);
if(sep==" "){
sep="\\s";
}else{
if(sep==""){
sep="\\s\\xa0";
}
}
var grp=flags.groupSize,grp2=flags.groupSize2;
if(grp2){
var _15c1="(?:0|[1-9]\\d{0,"+(grp2-1)+"}(?:["+sep+"]\\d{"+grp2+"})*["+sep+"]\\d{"+grp+"})";
return ((grp-grp2)>0)?"(?:"+_15c1+"|(?:0|[1-9]\\d{0,"+(grp-1)+"}))":_15c1;
}
return "(?:0|[1-9]\\d{0,"+(grp-1)+"}(?:["+sep+"]\\d{"+grp+"})*)";
},true);
return _15bf+_15c0;
};
return _158d;
});
},"dijit/DialogUnderlay":function(){
define("dijit/DialogUnderlay",["dojo/_base/declare","dojo/dom-attr","dojo/window","./_Widget","./_TemplatedMixin","./BackgroundIframe"],function(_15c2,_15c3,_15c4,_15c5,_15c6,_15c7){
return _15c2("dijit.DialogUnderlay",[_15c5,_15c6],{templateString:"<div class='dijitDialogUnderlayWrapper'><div class='dijitDialogUnderlay' data-dojo-attach-point='node'></div></div>",dialogId:"","class":"",_setDialogIdAttr:function(id){
_15c3.set(this.node,"id",id+"_underlay");
this._set("dialogId",id);
},_setClassAttr:function(clazz){
this.node.className="dijitDialogUnderlay "+clazz;
this._set("class",clazz);
},postCreate:function(){
this.ownerDocumentBody.appendChild(this.domNode);
},layout:function(){
var is=this.node.style,os=this.domNode.style;
os.display="none";
var _15c8=_15c4.getBox(this.ownerDocument);
os.top=_15c8.t+"px";
os.left=_15c8.l+"px";
is.width=_15c8.w+"px";
is.height=_15c8.h+"px";
os.display="block";
},show:function(){
this.domNode.style.display="block";
this.layout();
this.bgIframe=new _15c7(this.domNode);
},hide:function(){
this.bgIframe.destroy();
delete this.bgIframe;
this.domNode.style.display="none";
}});
});
},"davinci/ve/themeEditor/metadata/query":function(){
define(["dojo/_base/declare","davinci/ve/utils/URLRewrite"],function(_15c9,_15ca){
return _15c9("davinci.ve.themeEditor.metadata.query",null,{constructor:function(files,_15cb){
this.files=files;
this.cache={};
this.lastLoaded=-1;
this.modules=_15cb;
this.modulePrefix=null;
this.modulePrefix=".";
if(_15cb){
for(var i=0;i<_15cb.length;i++){
this.modulePrefix+="/"+_15cb[i];
}
}
},getType:function(_15cc){
var type=null;
if(_15cc.declaredClass){
type=_15cc.type;
}else{
type=_15cc;
if(type.substring(0,5)=="html."){
tagName=type.substring(5);
}
}
return type;
},_loadNextFile:function(){
var _15cd=this.files[++this.lastLoaded];
var _15ce=null;
if(_15cd.getURL){
_15ce=_15ca.encodeURI(_15cd.getURL());
}else{
_15ce=this.modulePrefix+_15cd;
}
var md=null;
dojo.xhrGet({url:_15ce,handleAs:"json",sync:true,load:function(_15cf){
md=_15cf;
}});
return md;
},_fullyLoaded:function(){
return this.files.length<=(this.lastLoaded+1);
},_cacheNext:function(){
var _15d0=this._loadNextFile();
dojo.mixin(this.cache,_15d0);
},getMetaData:function(type){
var path=type.split(".");
var front=path.length>=0?path[0]:path;
var back=path.length>=0?path[path.length-1]:path;
var _15d1=this.cache[front];
if(_15d1&&_15d1[back]){
return _15d1[back];
}
if(!this._fullyLoaded()){
this._cacheNext();
return this.getMetaData(type);
}
return null;
}});
});
},"davinci/ve/actions/AddState":function(){
require({cache:{"url:davinci/ve/actions/templates/AddState.html":"<div>\n\t<div class=\"dijitDialogPaneContentArea\">\n\t\t${veNls.stateLabel}: <input dojoAttachPoint=\"input\" dojoType=\"dijit.form.TextBox\" dojoAttachEvent=\"onKeyUp:_onKeyPress\" type=\"text\"></input>\n\t</div>\n\t\t\t\t\n\t<div class=\"dijitDialogPaneActionBar\">\n\t\t<button dojoType='dijit.form.Button' dojoAttachPoint=\"okButton\" dojoAttachEvent='onClick:onOk' disabled label='${veNls.createLabel}' class=\"maqPrimaryButton\" type=\"submit\"></button>\n\t\t<button dojoType='dijit.form.Button' dojoAttachEvent='onClick:onCancel' label='${commonNls.buttonCancel}' class=\"maqSecondaryButton\"></button>\n\t</div>\n</div>\n"}});
define("davinci/ve/actions/AddState",["dojo/_base/declare","dijit/_WidgetBase","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","davinci/Runtime","davinci/Workbench","davinci/ve/States","davinci/actions/Action","dojo/i18n!davinci/ve/nls/ve","dojo/i18n!dijit/nls/common","dojo/text!./templates/AddState.html","dijit/form/TextBox"],function(_15d2,_15d3,_15d4,_15d5,_15d6,_15d7,_15d8,_15d9,veNls,_15da,_15db){
var _15dc=_15d2("davinci.ve.actions.AddStateWidget",[_15d3,_15d4,_15d5],{templateString:_15db,widgetsInTemplate:true,veNls:veNls,commonNls:_15da,_isValid:function(){
var state=this.input.get("value");
if(!state){
return false;
}else{
if(davinci.ve.states.hasState(this.node,state)){
alert(dojo.string.substitute(veNls.stateNameExists,{name:state}));
return false;
}
}
return true;
},_onKeyPress:function(e){
if(e.keyCode!=dojo.keys.ENTER){
if(this._isValid()){
this.okButton.set("disabled",false);
}else{
this.okButton.set("disabled",true);
}
}
},onOk:function(){
var _15dd=this.input.get("value");
if(_15dd){
_15d8.add(this.node,_15dd);
}
},onCancel:function(){
this.onClose();
}});
return _15d2("davinci.ve.actions.AddState",[_15d9],{run:function(){
var _15de;
if(_15d6.currentEditor&&_15d6.currentEditor.currentEditor&&_15d6.currentEditor.currentEditor.context){
_15de=_15d6.currentEditor.currentEditor.context;
}else{
return;
}
var _15df=_15d8.getFocus(_15de.rootNode);
if(!_15df||!_15df.stateContainerNode){
return;
}
var w=new davinci.ve.actions.AddStateWidget({node:_15df.stateContainerNode});
_15d7.showModal(w,veNls.createNewState,null,null,true);
}});
});
},"davinci/ve/actions/EditPropertiesAction":function(){
define(["dojo/_base/declare","davinci/ve/actions/ContextAction"],function(_15e0,_15e1){
return _15e0("davinci.ve.actions.EditPropertiesAction",[_15e1],{run:function(_15e2){
_15e2=this.fixupContext(_15e2);
if(_15e2&&_15e2.editor&&_15e2.editor.editorContainer&&_15e2.editor.editorContainer.hideShowProperties){
_15e2.editor.editorContainer.hideShowProperties();
}
},isEnabled:function(_15e3){
_15e3=this.fixupContext(_15e3);
return true;
}});
});
},"dijit/_WidgetsInTemplateMixin":function(){
define("dijit/_WidgetsInTemplateMixin",["dojo/_base/array","dojo/_base/declare","dojo/parser"],function(array,_15e4,_15e5){
return _15e4("dijit._WidgetsInTemplateMixin",null,{_earlyTemplatedStartup:false,widgetsInTemplate:true,_beforeFillContent:function(){
if(this.widgetsInTemplate){
var node=this.domNode;
var cw=(this._startupWidgets=_15e5.parse(node,{noStart:!this._earlyTemplatedStartup,template:true,inherited:{dir:this.dir,lang:this.lang,textDir:this.textDir},propsThis:this,scope:"dojo"}));
if(!cw.isFulfilled()){
throw new Error(this.declaredClass+": parser returned unfilled promise (probably waiting for module auto-load), "+"unsupported by _WidgetsInTemplateMixin.   Must pre-load all supporting widgets before instantiation.");
}
this._attachTemplateNodes(cw,function(n,p){
return n[p];
});
}
},startup:function(){
array.forEach(this._startupWidgets,function(w){
if(w&&!w._started&&w.startup){
w.startup();
}
});
this.inherited(arguments);
}});
});
},"dojo/DeferredList":function(){
define("dojo/DeferredList",["./_base/kernel","./_base/Deferred","./_base/array"],function(dojo,_15e6,_15e7){
dojo.DeferredList=function(list,_15e8,_15e9,_15ea,_15eb){
var _15ec=[];
_15e6.call(this);
var self=this;
if(list.length===0&&!_15e8){
this.resolve([0,[]]);
}
var _15ed=0;
_15e7.forEach(list,function(item,i){
item.then(function(_15ee){
if(_15e8){
self.resolve([i,_15ee]);
}else{
_15ef(true,_15ee);
}
},function(error){
if(_15e9){
self.reject(error);
}else{
_15ef(false,error);
}
if(_15ea){
return null;
}
throw error;
});
function _15ef(_15f0,_15f1){
_15ec[i]=[_15f0,_15f1];
_15ed++;
if(_15ed===list.length){
self.resolve(_15ec);
}
};
});
};
dojo.DeferredList.prototype=new _15e6();
dojo.DeferredList.prototype.gatherResults=function(_15f2){
var d=new dojo.DeferredList(_15f2,false,true,false);
d.addCallback(function(_15f3){
var ret=[];
_15e7.forEach(_15f3,function(_15f4){
ret.push(_15f4[1]);
});
return ret;
});
return d;
};
return dojo.DeferredList;
});
},"url:dijit/form/templates/TextBox.html":"<div class=\"dijit dijitReset dijitInline dijitLeft\" id=\"widget_${id}\" role=\"presentation\"\n\t><div class=\"dijitReset dijitInputField dijitInputContainer\"\n\t\t><input class=\"dijitReset dijitInputInner\" data-dojo-attach-point='textbox,focusNode' autocomplete=\"off\"\n\t\t\t${!nameAttrSetting} type='${type}'\n\t/></div\n></div>\n","davinci/ve/commands/EventCommand":function(){
define("davinci/ve/commands/EventCommand",["dojo/_base/declare","davinci/ve/widget"],function(_15f5,_15f6){
return _15f5("davinci.ve.commands.EventCommand",null,{name:"EventCommand",constructor:function(_15f7,_15f8){
this._oldId=(_15f7?_15f7.id:undefined);
this._properties=(_15f8||{});
},setContext:function(_15f9){
this._context=_15f9;
},execute:function(){
if(!this._oldId||!this._properties){
return;
}
var _15fa=_15f6.byId(this._oldId);
this._oldProps=_15fa.properties||{};
_15fa.setProperties(this._properties,true);
if(_15fa.isHtmlWidget){
var node=_15fa.domNode;
for(var name in this._properties){
if(!this._properties[name]){
node.removeAttribute(name);
}
}
}
this._newId=this._oldId;
dojo.publish("/davinci/ui/widgetPropertiesChanged",[[_15fa]]);
},undo:function(){
if(!this._newId){
return;
}
var _15fb=_15f6.byId(this._newId);
var _15fc=_15fb.domNode;
var _15fd=_15fb._srcElement;
for(var _15fe in this._properties){
if(!this._oldProps[_15fe]){
_15fc.removeAttribute(_15fe);
_15fd.removeAttribute(_15fe);
}
}
_15fb.setProperties(this._oldProps);
dojo.publish("/davinci/ui/widgetPropertiesChanged",[[_15fb]]);
}});
});
},"url:dojox/widget/ColorPicker/ColorPicker.html":"<table class=\"dojoxColorPicker\" dojoAttachEvent=\"onkeypress: _handleKey\" cellpadding=\"0\" cellspacing=\"0\" role=\"presentation\">\n\t<tr>\n\t\t<td valign=\"top\" class=\"dojoxColorPickerRightPad\">\n\t\t\t<div class=\"dojoxColorPickerBox\">\n\t\t\t\t<!-- Forcing ABS in style attr due to dojo DND issue with not picking it up form the class. -->\n\t\t\t\t<img title=\"${saturationPickerTitle}\" alt=\"${saturationPickerTitle}\" class=\"dojoxColorPickerPoint\" src=\"${_pickerPointer}\" tabIndex=\"0\" dojoAttachPoint=\"cursorNode\" style=\"position: absolute; top: 0px; left: 0px;\">\n\t\t\t\t<img role=\"presentation\" alt=\"\" dojoAttachPoint=\"colorUnderlay\" dojoAttachEvent=\"onclick: _setPoint, onmousedown: _stopDrag\" class=\"dojoxColorPickerUnderlay\" src=\"${_underlay}\" ondragstart=\"return false\">\n\t\t\t</div>\n\t\t</td>\n\t\t<td valign=\"top\" class=\"dojoxColorPickerRightPad\">\n\t\t\t<div class=\"dojoxHuePicker\">\n\t\t\t\t<!-- Forcing ABS in style attr due to dojo DND issue with not picking it up form the class. -->\n\t\t\t\t<img dojoAttachPoint=\"hueCursorNode\" tabIndex=\"0\" class=\"dojoxHuePickerPoint\" title=\"${huePickerTitle}\" alt=\"${huePickerTitle}\" src=\"${_huePickerPointer}\" style=\"position: absolute; top: 0px; left: 0px;\">\n\t\t\t\t<div class=\"dojoxHuePickerUnderlay\" dojoAttachPoint=\"hueNode\">\n\t\t\t\t    <img role=\"presentation\" alt=\"\" dojoAttachEvent=\"onclick: _setHuePoint, onmousedown: _stopDrag\" src=\"${_hueUnderlay}\">\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</td>\n\t\t<td valign=\"top\">\n\t\t\t<table cellpadding=\"0\" cellspacing=\"0\" role=\"presentation\">\n\t\t\t\t<tr>\n\t\t\t\t\t<td valign=\"top\" class=\"dojoxColorPickerPreviewContainer\">\n\t\t\t\t\t\t<table cellpadding=\"0\" cellspacing=\"0\" role=\"presentation\">\n\t\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t\t<td valign=\"top\" class=\"dojoxColorPickerRightPad\">\n\t\t\t\t\t\t\t\t\t<div dojoAttachPoint=\"previewNode\" class=\"dojoxColorPickerPreview\"></div>\n\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t\t<td valign=\"top\">\n\t\t\t\t\t\t\t\t\t<div dojoAttachPoint=\"safePreviewNode\" class=\"dojoxColorPickerWebSafePreview\"></div>\n\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t</table>\n\t\t\t\t\t</td>\n\t\t\t\t</tr>\n\t\t\t\t<tr>\n\t\t\t\t\t<td valign=\"bottom\">\n\t\t\t\t\t\t<table class=\"dojoxColorPickerOptional\" cellpadding=\"0\" cellspacing=\"0\" role=\"presentation\">\n\t\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t\t\t<div class=\"dijitInline dojoxColorPickerRgb\" dojoAttachPoint=\"rgbNode\">\n\t\t\t\t\t\t\t\t\t\t<table cellpadding=\"1\" cellspacing=\"1\" role=\"presentation\">\n\t\t\t\t\t\t\t\t\t\t<tr><td><label for=\"${_uId}_r\">${redLabel}</label></td><td><input id=\"${_uId}_r\" dojoAttachPoint=\"Rval\" size=\"1\" dojoAttachEvent=\"onchange: _colorInputChange\"></td></tr>\n\t\t\t\t\t\t\t\t\t\t<tr><td><label for=\"${_uId}_g\">${greenLabel}</label></td><td><input id=\"${_uId}_g\" dojoAttachPoint=\"Gval\" size=\"1\" dojoAttachEvent=\"onchange: _colorInputChange\"></td></tr>\n\t\t\t\t\t\t\t\t\t\t<tr><td><label for=\"${_uId}_b\">${blueLabel}</label></td><td><input id=\"${_uId}_b\" dojoAttachPoint=\"Bval\" size=\"1\" dojoAttachEvent=\"onchange: _colorInputChange\"></td></tr>\n\t\t\t\t\t\t\t\t\t\t</table>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t\t\t<div class=\"dijitInline dojoxColorPickerHsv\" dojoAttachPoint=\"hsvNode\">\n\t\t\t\t\t\t\t\t\t\t<table cellpadding=\"1\" cellspacing=\"1\" role=\"presentation\">\n\t\t\t\t\t\t\t\t\t\t<tr><td><label for=\"${_uId}_h\">${hueLabel}</label></td><td><input id=\"${_uId}_h\" dojoAttachPoint=\"Hval\"size=\"1\" dojoAttachEvent=\"onchange: _colorInputChange\"> ${degLabel}</td></tr>\n\t\t\t\t\t\t\t\t\t\t<tr><td><label for=\"${_uId}_s\">${saturationLabel}</label></td><td><input id=\"${_uId}_s\" dojoAttachPoint=\"Sval\" size=\"1\" dojoAttachEvent=\"onchange: _colorInputChange\"> ${percentSign}</td></tr>\n\t\t\t\t\t\t\t\t\t\t<tr><td><label for=\"${_uId}_v\">${valueLabel}</label></td><td><input id=\"${_uId}_v\" dojoAttachPoint=\"Vval\" size=\"1\" dojoAttachEvent=\"onchange: _colorInputChange\"> ${percentSign}</td></tr>\n\t\t\t\t\t\t\t\t\t\t</table>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t\t<td colspan=\"2\">\n\t\t\t\t\t\t\t\t\t<div class=\"dojoxColorPickerHex\" dojoAttachPoint=\"hexNode\" aria-live=\"polite\">\t\n\t\t\t\t\t\t\t\t\t\t<label for=\"${_uId}_hex\">&nbsp;${hexLabel}&nbsp;</label><input id=\"${_uId}_hex\" dojoAttachPoint=\"hexCode, focusNode, valueNode\" size=\"6\" class=\"dojoxColorPickerHexCode\" dojoAttachEvent=\"onchange: _colorInputChange\">\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t</table>\n\t\t\t\t\t</td>\n\t\t\t\t</tr>\n\t\t\t</table>\n\t\t</td>\n\t</tr>\n</table>\n\n","davinci/review/actions/EditVersionAction":function(){
define("davinci/review/actions/EditVersionAction",["dojo/_base/declare","./_ReviewNavigatorCommon","./PublishAction","../../Runtime","dojox/widget/Toaster","dojo/i18n!./nls/actions"],function(_15ff,_1600,_1601,_1602,_1603,nls){
return _15ff("davinci.review.actions.EditVersionAction",[_1600],{run:function(_1604){
var _1605=this._getSelection(_1604);
if(!_1605||!_1605.length){
return;
}
var item=_1605[0].resource.elementType=="ReviewFile"?_1605[0].resource.parent:_1605[0].resource;
var _1606=new _1601(item);
_1606.run();
},isEnabled:function(_1607){
var _1608=this._getSelection(_1607);
if(_1608&&_1608.length>0){
var item=_1608[0].resource.elementType=="ReviewFile"?_1608[0].resource.parent:_1608[0].resource;
if(item.designerId==davinci.Runtime.userName){
return true;
}
}
return false;
}});
});
},"dojox/layout/ResizeHandle":function(){
define("dojox/layout/ResizeHandle",["dojo/_base/kernel","dojo/_base/lang","dojo/_base/connect","dojo/_base/array","dojo/_base/event","dojo/_base/fx","dojo/_base/window","dojo/fx","dojo/window","dojo/dom","dojo/dom-class","dojo/dom-geometry","dojo/dom-style","dijit/_base/manager","dijit/_Widget","dijit/_TemplatedMixin","dojo/_base/declare"],function(_1609,lang,_160a,_160b,_160c,_160d,_160e,_160f,_1610,_1611,_1612,_1613,_1614,_1615,_1616,_1617,_1618){
_1609.experimental("dojox.layout.ResizeHandle");
var _1619=_1618("dojox.layout.ResizeHandle",[_1616,_1617],{targetId:"",targetContainer:null,resizeAxis:"xy",activeResize:false,activeResizeClass:"dojoxResizeHandleClone",animateSizing:true,animateMethod:"chain",animateDuration:225,minHeight:100,minWidth:100,constrainMax:false,maxHeight:0,maxWidth:0,fixedAspect:false,intermediateChanges:false,startTopic:"/dojo/resize/start",endTopic:"/dojo/resize/stop",templateString:"<div dojoAttachPoint=\"resizeHandle\" class=\"dojoxResizeHandle\"><div></div></div>",postCreate:function(){
this.connect(this.resizeHandle,"onmousedown","_beginSizing");
if(!this.activeResize){
this._resizeHelper=_1615.byId("dojoxGlobalResizeHelper");
if(!this._resizeHelper){
this._resizeHelper=new _161a({id:"dojoxGlobalResizeHelper"}).placeAt(_160e.body());
_1612.add(this._resizeHelper.domNode,this.activeResizeClass);
}
}else{
this.animateSizing=false;
}
if(!this.minSize){
this.minSize={w:this.minWidth,h:this.minHeight};
}
if(this.constrainMax){
this.maxSize={w:this.maxWidth,h:this.maxHeight};
}
this._resizeX=this._resizeY=false;
var _161b=lang.partial(_1612.add,this.resizeHandle);
switch(this.resizeAxis.toLowerCase()){
case "xy":
this._resizeX=this._resizeY=true;
_161b("dojoxResizeNW");
break;
case "x":
this._resizeX=true;
_161b("dojoxResizeW");
break;
case "y":
this._resizeY=true;
_161b("dojoxResizeN");
break;
}
},_beginSizing:function(e){
if(this._isSizing){
return;
}
_160a.publish(this.startTopic,[this]);
this.targetWidget=_1615.byId(this.targetId);
this.targetDomNode=this.targetWidget?this.targetWidget.domNode:_1611.byId(this.targetId);
if(this.targetContainer){
this.targetDomNode=this.targetContainer;
}
if(!this.targetDomNode){
return;
}
if(!this.activeResize){
var c=_1613.position(this.targetDomNode,true);
this._resizeHelper.resize({l:c.x,t:c.y,w:c.w,h:c.h});
this._resizeHelper.show();
if(!this.isLeftToRight()){
this._resizeHelper.startPosition={l:c.x,t:c.y};
}
}
this._isSizing=true;
this.startPoint={x:e.clientX,y:e.clientY};
var style=_1614.getComputedStyle(this.targetDomNode),_161c=_1613.boxModel==="border-model",_161d=_161c?{w:0,h:0}:_1613.getPadBorderExtents(this.targetDomNode,style),_161e=_1613.getMarginExtents(this.targetDomNode,style),mb;
mb=this.startSize={w:_1614.get(this.targetDomNode,"width",style),h:_1614.get(this.targetDomNode,"height",style),pbw:_161d.w,pbh:_161d.h,mw:_161e.w,mh:_161e.h};
if(!this.isLeftToRight()&&dojo.style(this.targetDomNode,"position")=="absolute"){
var p=_1613.position(this.targetDomNode,true);
this.startPosition={l:p.x,t:p.y};
}
this._pconnects=[_160a.connect(_160e.doc,"onmousemove",this,"_updateSizing"),_160a.connect(_160e.doc,"onmouseup",this,"_endSizing")];
_160c.stop(e);
},_updateSizing:function(e){
if(this.activeResize){
this._changeSizing(e);
}else{
var tmp=this._getNewCoords(e,"border",this._resizeHelper.startPosition);
if(tmp===false){
return;
}
this._resizeHelper.resize(tmp);
}
e.preventDefault();
},_getNewCoords:function(e,box,_161f){
try{
if(!e.clientX||!e.clientY){
return false;
}
}
catch(e){
return false;
}
this._activeResizeLastEvent=e;
var dx=(this.isLeftToRight()?1:-1)*(this.startPoint.x-e.clientX),dy=this.startPoint.y-e.clientY,newW=this.startSize.w-(this._resizeX?dx:0),newH=this.startSize.h-(this._resizeY?dy:0),r=this._checkConstraints(newW,newH);
_161f=(_161f||this.startPosition);
if(_161f&&this._resizeX){
r.l=_161f.l+dx;
if(r.w!=newW){
r.l+=(newW-r.w);
}
r.t=_161f.t;
}
switch(box){
case "margin":
r.w+=this.startSize.mw;
r.h+=this.startSize.mh;
case "border":
r.w+=this.startSize.pbw;
r.h+=this.startSize.pbh;
break;
}
return r;
},_checkConstraints:function(newW,newH){
if(this.minSize){
var tm=this.minSize;
if(newW<tm.w){
newW=tm.w;
}
if(newH<tm.h){
newH=tm.h;
}
}
if(this.constrainMax&&this.maxSize){
var ms=this.maxSize;
if(newW>ms.w){
newW=ms.w;
}
if(newH>ms.h){
newH=ms.h;
}
}
if(this.fixedAspect){
var w=this.startSize.w,h=this.startSize.h,delta=w*newH-h*newW;
if(delta<0){
newW=newH*w/h;
}else{
if(delta>0){
newH=newW*h/w;
}
}
}
return {w:newW,h:newH};
},_changeSizing:function(e){
var _1620=this.targetWidget&&lang.isFunction(this.targetWidget.resize),tmp=this._getNewCoords(e,_1620&&"margin");
if(tmp===false){
return;
}
if(_1620){
this.targetWidget.resize(tmp);
}else{
if(this.animateSizing){
var anim=_160f[this.animateMethod]([_160d.animateProperty({node:this.targetDomNode,properties:{width:{start:this.startSize.w,end:tmp.w}},duration:this.animateDuration}),_160d.animateProperty({node:this.targetDomNode,properties:{height:{start:this.startSize.h,end:tmp.h}},duration:this.animateDuration})]);
anim.play();
}else{
_1614.set(this.targetDomNode,{width:tmp.w+"px",height:tmp.h+"px"});
}
}
if(this.intermediateChanges){
this.onResize(e);
}
},_endSizing:function(e){
_160b.forEach(this._pconnects,_160a.disconnect);
var pub=lang.partial(_160a.publish,this.endTopic,[this]);
if(!this.activeResize){
this._resizeHelper.hide();
this._changeSizing(e);
setTimeout(pub,this.animateDuration+15);
}else{
pub();
}
this._isSizing=false;
this.onResize(e);
},onResize:function(e){
}});
var _161a=dojo.declare("dojox.layout._ResizeHelper",_1616,{show:function(){
_1614.set(this.domNode,"display","");
},hide:function(){
_1614.set(this.domNode,"display","none");
},resize:function(dim){
_1613.setMarginBox(this.domNode,dim);
}});
return _1619;
});
},"davinci/ui/SaveAsWidgetForm":function(){
require({cache:{"url:davinci/ui/templates/SaveAsWidgetForm.html":"<div class='dvSaveAsWidgetForm'>\n\t<div class=\"dijitDialogPaneContentArea\">\n\t\t<p class=\"dvSawfDesc\">${descriptionString}</p>\n\t\t<p>\n\t\t\t<span class=\"dvSawfLabel\">${nameString}:</span>\n\t\t\t<input dojoType='dijit.form.ValidationTextBox' dojoAttachPoint=\"nameInputNode\" trim=\"true\"\n\t\t\t\t\tpromptMessage=\"${namePromptString}\"></input>\n\t\t</p>\n\t\t<p>\n\t\t\t<span class=\"dvSawfLabel\"><span class=\"dvRequired\">*</span>${idString}:</span>\n\t\t\t<input dojoType='dijit.form.ValidationTextBox' dojoAttachPoint=\"idInputNode\" trim=\"true\"\n\t\t\t\t\trequired=\"true\" intermediateChanges=\"true\" promptMessage=\"${idPromptString}\"></input>\n\t\t</p>\n\t\t<p>\n\t\t\t<span class=\"dvSawfLabel\">${versionString}:</span>\n\t\t\t<input dojoType='dijit.form.ValidationTextBox' dojoAttachPoint=\"versionInputNode\"\n\t\t\t\t\ttrim=\"true\"></input>\n\t\t</p>\n\t\t<h4 class=\"dvRequired\">*${requiredString}</h4>\n\t\n\t\t<div dojoType=\"dijit.TitlePane\" title=\"${metadataTitle}\" open=\"false\">\n\t\t\t<textarea dojoType=\"dijit.form.SimpleTextarea\" dojoAttachPoint=\"textareaNode\" name=\"metadata\"\n\t\t\t\t\trows=\"15\" cols=\"50\" intermediateChanges=\"true\">${initialTextareaContent}</textarea>\n\t\t</div>\n\t</div>\n  <div class=\"dijitDialogPaneActionBar\">\n    <button dojoType=\"dijit.form.Button\" dojoAttachPoint=\"buttonSave\" class=\"maqPrimaryButton\" type=\"submit\" disabled=\"true\">${saveString}</button>\n    <button dojoType=\"dijit.form.Button\" dojoAttachPoint=\"buttonCancel\" type=\"button\" class=\"maqSecondaryButton\">${cancelString}</button>\n  </div>\n</div>\n"}});
define("davinci/ui/SaveAsWidgetForm",["dojo/_base/declare","dijit/_Templated","dijit/_Widget","dojo/i18n!davinci/ui/nls/ui","dojo/i18n!dijit/nls/common","dojo/text!./templates/SaveAsWidgetForm.html"],function(_1621,_1622,_1623,uiNLS,_1624,_1625){
return dojo.declare("davinci.ui.SaveAsWidgetForm",[_1623,_1622],{templateString:_1625,widgetsInTemplate:true,postMixInProperties:function(){
var nls=_1624;
this.descriptionString=nls.sawfDesc;
this.nameString=nls.name;
this.idString=nls.id;
this.versionString=nls.version;
this.requiredString=nls.required;
this.saveString=nls.save;
this.cancelString=nls.cancel;
this.metadataTitle=nls.sawfMetadataTitle;
this.namePromptString=nls.sawfNamePrompt;
this.idPromptString=nls.sawfIdPrompt;
this.initialTextareaContent=dojo.toJson(this.metadata,true);
},postCreate:function(){
this.inherited(arguments);
var _1626=["nameInputNode","idInputNode","versionInputNode","textareaNode"];
dojo.forEach(_1626,function(item){
this.connect(this[item],"onChange",function(){
this._onChange(item,arguments[0]);
});
},this);
this.idInputNode.regExp="[a-zA-Z]+://[^\\s]+";
this.connect(this.buttonCancel,"onClick",function(){
dijit.byId(this.parentId).hide();
});
},_onChange:function(name,_1627){
switch(name){
case "nameInputNode":
this.metadata.name=_1627;
break;
case "idInputNode":
this.metadata.id=_1627;
break;
case "versionInputNode":
this.metadata.version=_1627;
break;
case "textareaNode":
try{
this.metadata=dojo.fromJson(_1627);
this._invalidMetadata=false;
}
catch(e){
this._invalidMetadata=true;
}
break;
}
if(name!=="textareaNode"){
this.textareaNode.set("value",dojo.toJson(this.metadata,true));
}
this.buttonSave.set("disabled",!this._isValid());
},_isValid:function(){
return this.idInputNode.isValid()&&!this._invalidMetadata;
}});
});
},"davinci/review/actions/OpenVersionAction":function(){
define(["dojo/_base/declare","./_ReviewNavigatorCommon","davinci/Runtime","dojox/widget/Toaster","dojo/i18n!./nls/actions"],function(_1628,_1629,_162a,_162b,nls){
var _162c=_1628("davinci.review.actions.OpenVersionAction",[_1629],{run:function(_162d){
var _162e=this._getSelection(_162d);
if(!_162e||!_162e.length){
return;
}
var item=_162e[0].resource.elementType=="ReviewFile"?_162e[0].resource.parent:_162e[0].resource;
dojo.xhrGet({url:"cmd/managerVersion",sync:false,handleAs:"text",content:{"type":"open","vTime":item.timeStamp}}).then(function(_162f){
if(_162f=="OK"){
if(typeof hasToaster=="undefined"){
new _162b({position:"br-left",duration:4000,messageTopic:"/davinci/review/resourceChanged"});
hasToaster=true;
}
dojo.publish("/davinci/review/resourceChanged",[{message:nls.openSuccessful,type:"message"},"open",item]);
}
});
},isEnabled:function(_1630){
var _1631=this._getSelection(_1630);
if(!_1631||_1631.length==0){
return false;
}
var item=_1631[0].resource.elementType=="ReviewFile"?_1631[0].resource.parent:_1631[0].resource;
if(item.designerId==davinci.Runtime.userName){
if(item.closed&&item.closedManual&&!item.isDraft){
return true;
}
}
return false;
}});
return _162c;
});
},"dijit/layout/TabContainer":function(){
define("dijit/layout/TabContainer",["dojo/_base/lang","dojo/_base/declare","./_TabContainerBase","./TabController","./ScrollingTabController"],function(lang,_1632,_1633,_1634,_1635){
return _1632("dijit.layout.TabContainer",_1633,{useMenu:true,useSlider:true,controllerWidget:"",_makeController:function(_1636){
var cls=this.baseClass+"-tabs"+(this.doLayout?"":" dijitTabNoLayout"),_1634=typeof this.controllerWidget=="string"?lang.getObject(this.controllerWidget):this.controllerWidget;
return new _1634({id:this.id+"_tablist",ownerDocument:this.ownerDocument,dir:this.dir,lang:this.lang,textDir:this.textDir,tabPosition:this.tabPosition,doLayout:this.doLayout,containerId:this.id,"class":cls,nested:this.nested,useMenu:this.useMenu,useSlider:this.useSlider,tabStripClass:this.tabStrip?this.baseClass+(this.tabStrip?"":"No")+"Strip":null},_1636);
},postMixInProperties:function(){
this.inherited(arguments);
if(!this.controllerWidget){
this.controllerWidget=(this.tabPosition=="top"||this.tabPosition=="bottom")&&!this.nested?_1635:_1634;
}
}});
});
},"davinci/workbench/ViewLite":function(){
define("davinci/workbench/ViewLite",["dojo/_base/declare","./WidgetLite","../ve/States"],function(_1637,_1638){
return _1637("davinci.workbench.ViewLite",[_1638],{_editor:null,_widget:null,_subWidget:null,constructor:function(_1639,_163a){
this.subscriptions=[];
this.publishing={};
dojo.subscribe("/davinci/ui/editorSelected",dojo.hitch(this,this._editorSelected));
dojo.subscribe("/davinci/ui/widgetSelected",dojo.hitch(this,this._widgetSelectionChanged));
},_widgetSelectionChanged:function(_163b){
if(!this._editor){
return;
}
var _163c=_163b[0];
if(_163c&&this._widget==_163c&&this._subwidget==_163c.subwidget){
return false;
}
this._widget=_163c;
this._subwidget=_163c&&_163c.subwidget;
if(this.onWidgetSelectionChange){
this.onWidgetSelectionChange();
}
},_editorSelected:function(_163d){
this._editor=_163d.editor;
if(this.onEditorSelected){
this.onEditorSelected(this._editor);
}
},subscribe:function(topic,func){
this.subscriptions.push(dojo.subscribe(topic,this,func));
},publish:function(topic,data){
this.publishing[topic]=true;
try{
dojo.publish(topic,data);
}
catch(e){
console.error(e);
}
delete this.publishing[topic];
},destroy:function(){
dojo.forEach(this.subscriptions,dojo.unsubscribe);
delete this.subscriptions;
}});
});
},"dojox/grid/_Events":function(){
define("dojox/grid/_Events",["dojo/keys","dojo/dom-class","dojo/_base/declare","dojo/_base/event","dojo/_base/sniff"],function(keys,_163e,_163f,event,has){
return _163f("dojox.grid._Events",null,{cellOverClass:"dojoxGridCellOver",onKeyEvent:function(e){
this.dispatchKeyEvent(e);
},onContentEvent:function(e){
this.dispatchContentEvent(e);
},onHeaderEvent:function(e){
this.dispatchHeaderEvent(e);
},onStyleRow:function(inRow){
var i=inRow;
i.customClasses+=(i.odd?" dojoxGridRowOdd":"")+(i.selected?" dojoxGridRowSelected":"")+(i.over?" dojoxGridRowOver":"");
this.focus.styleRow(inRow);
this.edit.styleRow(inRow);
},onKeyDown:function(e){
if(e.altKey||e.metaKey){
return;
}
var _1640;
switch(e.keyCode){
case keys.ESCAPE:
this.edit.cancel();
break;
case keys.ENTER:
if(!this.edit.isEditing()){
_1640=this.focus.getHeaderIndex();
if(_1640>=0){
this.setSortIndex(_1640);
break;
}else{
this.selection.clickSelect(this.focus.rowIndex,dojo.isCopyKey(e),e.shiftKey);
}
event.stop(e);
}
if(!e.shiftKey){
var _1641=this.edit.isEditing();
this.edit.apply();
if(!_1641){
this.edit.setEditCell(this.focus.cell,this.focus.rowIndex);
}
}
if(!this.edit.isEditing()){
var _1642=this.focus.focusView||this.views.views[0];
_1642.content.decorateEvent(e);
this.onRowClick(e);
event.stop(e);
}
break;
case keys.SPACE:
if(!this.edit.isEditing()){
_1640=this.focus.getHeaderIndex();
if(_1640>=0){
this.setSortIndex(_1640);
break;
}else{
this.selection.clickSelect(this.focus.rowIndex,dojo.isCopyKey(e),e.shiftKey);
}
event.stop(e);
}
break;
case keys.TAB:
this.focus[e.shiftKey?"previousKey":"nextKey"](e);
break;
case keys.LEFT_ARROW:
case keys.RIGHT_ARROW:
if(!this.edit.isEditing()){
var _1643=e.keyCode;
event.stop(e);
_1640=this.focus.getHeaderIndex();
if(_1640>=0&&(e.shiftKey&&e.ctrlKey)){
this.focus.colSizeAdjust(e,_1640,(_1643==keys.LEFT_ARROW?-1:1)*5);
}else{
var _1644=(_1643==keys.LEFT_ARROW)?1:-1;
if(this.isLeftToRight()){
_1644*=-1;
}
this.focus.move(0,_1644);
}
}
break;
case keys.UP_ARROW:
if(!this.edit.isEditing()&&this.focus.rowIndex!==0){
event.stop(e);
this.focus.move(-1,0);
}
break;
case keys.DOWN_ARROW:
if(!this.edit.isEditing()&&this.focus.rowIndex+1!=this.rowCount){
event.stop(e);
this.focus.move(1,0);
}
break;
case keys.PAGE_UP:
if(!this.edit.isEditing()&&this.focus.rowIndex!==0){
event.stop(e);
if(this.focus.rowIndex!=this.scroller.firstVisibleRow+1){
this.focus.move(this.scroller.firstVisibleRow-this.focus.rowIndex,0);
}else{
this.setScrollTop(this.scroller.findScrollTop(this.focus.rowIndex-1));
this.focus.move(this.scroller.firstVisibleRow-this.scroller.lastVisibleRow+1,0);
}
}
break;
case keys.PAGE_DOWN:
if(!this.edit.isEditing()&&this.focus.rowIndex+1!=this.rowCount){
event.stop(e);
if(this.focus.rowIndex!=this.scroller.lastVisibleRow-1){
this.focus.move(this.scroller.lastVisibleRow-this.focus.rowIndex-1,0);
}else{
this.setScrollTop(this.scroller.findScrollTop(this.focus.rowIndex+1));
this.focus.move(this.scroller.lastVisibleRow-this.scroller.firstVisibleRow-1,0);
}
}
break;
default:
break;
}
},onMouseOver:function(e){
e.rowIndex==-1?this.onHeaderCellMouseOver(e):this.onCellMouseOver(e);
},onMouseOut:function(e){
e.rowIndex==-1?this.onHeaderCellMouseOut(e):this.onCellMouseOut(e);
},onMouseDown:function(e){
e.rowIndex==-1?this.onHeaderCellMouseDown(e):this.onCellMouseDown(e);
},onMouseOverRow:function(e){
if(!this.rows.isOver(e.rowIndex)){
this.rows.setOverRow(e.rowIndex);
e.rowIndex==-1?this.onHeaderMouseOver(e):this.onRowMouseOver(e);
}
},onMouseOutRow:function(e){
if(this.rows.isOver(-1)){
this.onHeaderMouseOut(e);
}else{
if(!this.rows.isOver(-2)){
this.rows.setOverRow(-2);
this.onRowMouseOut(e);
}
}
},onMouseDownRow:function(e){
if(e.rowIndex!=-1){
this.onRowMouseDown(e);
}
},onCellMouseOver:function(e){
if(e.cellNode){
_163e.add(e.cellNode,this.cellOverClass);
}
},onCellMouseOut:function(e){
if(e.cellNode){
_163e.remove(e.cellNode,this.cellOverClass);
}
},onCellMouseDown:function(e){
},onCellClick:function(e){
this._click[0]=this._click[1];
this._click[1]=e;
if(!this.edit.isEditCell(e.rowIndex,e.cellIndex)){
this.focus.setFocusCell(e.cell,e.rowIndex);
}
if(this._click.length>1&&this._click[0]==null){
this._click.shift();
}
this.onRowClick(e);
},onCellDblClick:function(e){
var event;
if(this._click.length>1&&has("ie")){
event=this._click[1];
}else{
if(this._click.length>1&&this._click[0].rowIndex!=this._click[1].rowIndex){
event=this._click[0];
}else{
event=e;
}
}
this.focus.setFocusCell(event.cell,event.rowIndex);
this.onRowClick(event);
this.edit.setEditCell(event.cell,event.rowIndex);
this.onRowDblClick(e);
},onCellContextMenu:function(e){
this.onRowContextMenu(e);
},onCellFocus:function(_1645,_1646){
this.edit.cellFocus(_1645,_1646);
},onRowClick:function(e){
this.edit.rowClick(e);
this.selection.clickSelectEvent(e);
},onRowDblClick:function(e){
},onRowMouseOver:function(e){
},onRowMouseOut:function(e){
},onRowMouseDown:function(e){
},onRowContextMenu:function(e){
event.stop(e);
},onHeaderMouseOver:function(e){
},onHeaderMouseOut:function(e){
},onHeaderCellMouseOver:function(e){
if(e.cellNode){
_163e.add(e.cellNode,this.cellOverClass);
}
},onHeaderCellMouseOut:function(e){
if(e.cellNode){
_163e.remove(e.cellNode,this.cellOverClass);
}
},onHeaderCellMouseDown:function(e){
},onHeaderClick:function(e){
},onHeaderCellClick:function(e){
this.setSortIndex(e.cell.index);
this.onHeaderClick(e);
},onHeaderDblClick:function(e){
},onHeaderCellDblClick:function(e){
this.onHeaderDblClick(e);
},onHeaderCellContextMenu:function(e){
this.onHeaderContextMenu(e);
},onHeaderContextMenu:function(e){
if(!this.headerMenu){
event.stop(e);
}
},onStartEdit:function(_1647,_1648){
},onApplyCellEdit:function(_1649,_164a,_164b){
},onCancelEdit:function(_164c){
},onApplyEdit:function(_164d){
},onCanSelect:function(_164e){
return true;
},onCanDeselect:function(_164f){
return true;
},onSelected:function(_1650){
this.updateRowStyles(_1650);
},onDeselected:function(_1651){
this.updateRowStyles(_1651);
},onSelectionChanged:function(){
}});
});
},"davinci/ve/tools/_Tool":function(){
define(["dojo/_base/declare","davinci/ve/widget","davinci/ve/metadata","davinci/ve/utils/GeomUtils"],function(_1652,_1653,_1654,_1655){
return _1652("davinci.ve.tools._Tool",null,{_getTarget:function(){
return this._target;
},_setTarget:function(_1656,event){
if(!this._targetOverlays){
this._targetOverlays=[];
}
if(this._matchesTargetOverlay(_1656)){
return;
}
var _1657=this._context.getContainerNode();
var w;
while(_1656&&_1656!=_1657){
w=_1653.getEnclosingWidget(_1656);
if(w&&!w.getContext()){
_1656=w.domNode.parentNode;
w=null;
}else{
if(w&&davinci.ve.metadata.queryDescriptor(w.type,"enablePointerEvents")){
w=null;
break;
}else{
if(w&&w.getContainerNode()){
if(!davinci.ve.metadata.queryDescriptor(w.type,"isControl")){
w=null;
}
}
break;
}
}
}
if(w){
this._target=w;
this._updateTargetOverlays(event);
this._insertTargetOverlays();
}else{
this._removeTargetOverlays();
this._target=null;
}
},_updateTargetOverlays:function(event){
this._removeTargetOverlays();
if(!this._target){
return;
}
var _1658=this._target.domNode;
var _1659=this._getMaxZIndex(_1658);
if(this._targetOverlays){
var _165a=this._target.getHelper();
if(_165a&&_165a.getTargetOverlays){
var _165b=_165a.getTargetOverlays(this._target);
if(_165b&&_165b.length>0){
dojo.forEach(_165b,function(_165c){
var _165d=this._getNewTargetOverlay(_165c,_165c.x,_165c.y,_165c.width,_165c.height,_1659);
this._targetOverlays.push(_165d);
},this);
return;
}
}
var left=_1658.offsetLeft;
var top=_1658.offsetTop;
var width=_1658.offsetWidth;
var _165e=_1658.offsetHeight;
if(event){
var diff;
var _165f=_1655.getBorderBoxPageCoordsCached(_1658);
if(event.pageX<_165f.l){
diff=_165f.l-event.pageX;
left-=diff;
width+=diff;
}
if(event.pageY<_165f.t){
diff=_165f.t-event.pageY;
top-=diff;
_165e+=diff;
}
if(event.pageX>_165f.l+_165f.w){
diff=event.pageX-(_165f.l+_165f.w);
width+=diff;
}
if(event.pageY>_165f.t+_165f.h){
diff=event.pageY-(_165f.t+_165f.h);
_165e+=diff;
}
}
var _1660=this._getNewTargetOverlay(_1658,left,top,width,_165e,_1659);
this._targetOverlays.push(_1660);
}
},_getMaxZIndex:function(_1661){
var _1662=dojo.style(_1661,"zIndex");
dojo.query("*",_1661).forEach(function(node){
var _1663=dojo.style(node,"zIndex");
var _1664=Number(_1663);
var _1665=Number(_1662);
if(!isNaN(_1664)){
if(isNaN(_1665)){
_1662=_1663;
}else{
if(_1664>_1665){
_1662=_1663;
}
}
}
});
return _1662;
},_getNewTargetOverlay:function(_1666,x,y,width,_1667,_1668){
var _1669=this._context.getDojo().create("div",{className:"editFeedback",style:{position:"absolute",opacity:0.1,left:x+"px",top:y+"px",width:width+"px",height:_1667+"px",zIndex:_1668}});
return _1669;
},_insertTargetOverlays:function(){
if(this._targetOverlays&&this._target){
var _166a=this._target.domNode;
var _166b=_166a.parentNode;
dojo.forEach(this._targetOverlays,function(_166c){
_166b.insertBefore(_166c,_166a.nextSibling);
},this);
}
},_removeTargetOverlays:function(){
if(this._targetOverlays&&this._target){
for(var i=this._targetOverlays.length-1;i>=0;i--){
var _166d=this._targetOverlays[i];
dojo.destroy(_166d);
this._targetOverlays.pop();
}
}
},_matchesTargetOverlay:function(_166e){
return dojo.some(this._targetOverlays,function(entry){
return _166e==entry;
},this);
}});
});
},"dojo/regexp":function(){
define("dojo/regexp",["./_base/kernel","./_base/lang"],function(dojo,lang){
var _166f={};
lang.setObject("dojo.regexp",_166f);
_166f.escapeString=function(str,_1670){
return str.replace(/([\.$?*|{}\(\)\[\]\\\/\+^])/g,function(ch){
if(_1670&&_1670.indexOf(ch)!=-1){
return ch;
}
return "\\"+ch;
});
};
_166f.buildGroupRE=function(arr,re,_1671){
if(!(arr instanceof Array)){
return re(arr);
}
var b=[];
for(var i=0;i<arr.length;i++){
b.push(re(arr[i]));
}
return _166f.group(b.join("|"),_1671);
};
_166f.group=function(_1672,_1673){
return "("+(_1673?"?:":"")+_1672+")";
};
return _166f;
});
},"davinci/ve/utils/StyleArray":function(){
define([],function(){
return {mergeStyleArrays:function(set1,set2){
if(!set1){
set1=[];
}
if(!set2){
set2=[];
}
var _1674=dojo.clone(set1);
for(var i=0;i<set2.length;i++){
for(var name1 in set2[i]){
for(j=_1674.length-1;j>=0;j--){
var _1675=_1674[j];
for(var name2 in _1675){
if(name1==name2){
_1674.splice(j,1);
break;
}
}
}
}
}
var _1676=_1674.concat(set2);
return _1676;
}};
});
},"url:dijit/form/templates/ValidationTextBox.html":"<div class=\"dijit dijitReset dijitInline dijitLeft\"\n\tid=\"widget_${id}\" role=\"presentation\"\n\t><div class='dijitReset dijitValidationContainer'\n\t\t><input class=\"dijitReset dijitInputField dijitValidationIcon dijitValidationInner\" value=\"&#935; \" type=\"text\" tabIndex=\"-1\" readonly=\"readonly\" role=\"presentation\"\n\t/></div\n\t><div class=\"dijitReset dijitInputField dijitInputContainer\"\n\t\t><input class=\"dijitReset dijitInputInner\" data-dojo-attach-point='textbox,focusNode' autocomplete=\"off\"\n\t\t\t${!nameAttrSetting} type='${type}'\n\t/></div\n></div>\n","davinci/ve/commands/ReparentCommand":function(){
define(["dojo/_base/declare","../widget","../States"],function(_1677,_1678,_1679){
return _1677("davinci.ve.commands.ReparentCommand",null,{name:"reparent",constructor:function(_167a,_167b,index){
this._id=(_167a?_167a.id:undefined);
this._newParentId=(_167b?_167b.id:"myapp");
this._newIndex=index;
},execute:function(){
if(!this._id||!this._newParentId){
return;
}
var _167c=_1678.byId(this._id);
if(!_167c){
return;
}
var _167d=_167c.getParent();
if(!_167d){
_167d=dojo.byId("myapp");
}
var _167e=_1678.byId(this._newParentId);
if(!_167e){
_167e=dojo.byId("myapp");
}
if(!this._oldParentId){
this._oldParentId=_167d.id;
this._oldIndex=dojo.indexOf(_167d.getChildren(),_167c);
if(this._newIndex&&this._newIndex.domNode){
this._newIndex=_167e.indexOf(this._newIndex);
}
}
_167d.removeChild(_167c);
var _167f=_167e.getContext();
var _1680=(_167e==_167d&&this._oldIndex<this._newIndex)?this._newIndex-1:this._newIndex;
_167e.addChild(_167c,_1680);
if(_167f){
var _1681=_167c.getHelper();
if(_1681&&_1681.reparent){
_1681.reparent(_167c);
}
_167c.startup();
_167c.renderWidget();
_167f.widgetChanged(_167f.WIDGET_REPARENTED,_167c,[_167d,_167e]);
}
_1679.resetState(_167c.domNode);
},undo:function(){
if(!this._id||!this._oldParentId||!this._newParentId){
return;
}
var _1682=_1678.byId(this._id);
if(!_1682){
return;
}
var _1683=_1678.byId(this._oldParentId);
if(!_1683){
return;
}
var _1684=_1678.byId(this._newParentId);
if(!_1684){
return;
}
var _1685=_1683.getContext();
_1684.removeChild(_1682);
_1683.addChild(_1682,this._oldIndex);
if(_1685){
var _1686=_1682.getHelper();
if(_1686&&_1686.reparent){
_1686.reparent(_1682);
}
_1682.startup();
_1682.renderWidget();
_1685.widgetChanged(_1685.WIDGET_REPARENTED,_1682,[_1683,_1684]);
}
_1679.resetState(_1682.domNode);
}});
});
},"dojox/html/metrics":function(){
define("dojox/html/metrics",["dojo/_base/kernel","dojo/_base/lang","dojo/_base/sniff","dojo/ready","dojo/_base/unload","dojo/_base/window","dojo/dom-geometry"],function(_1687,lang,has,ready,_1688,_1689,_168a){
var dhm=lang.getObject("dojox.html.metrics",true);
var dojox=lang.getObject("dojox");
dhm.getFontMeasurements=function(){
var _168b={"1em":0,"1ex":0,"100%":0,"12pt":0,"16px":0,"xx-small":0,"x-small":0,"small":0,"medium":0,"large":0,"x-large":0,"xx-large":0};
if(has("ie")){
_1689.doc.documentElement.style.fontSize="100%";
}
var div=_1689.doc.createElement("div");
var ds=div.style;
ds.position="absolute";
ds.left="-100px";
ds.top="0";
ds.width="30px";
ds.height="1000em";
ds.borderWidth="0";
ds.margin="0";
ds.padding="0";
ds.outline="0";
ds.lineHeight="1";
ds.overflow="hidden";
_1689.body().appendChild(div);
for(var p in _168b){
ds.fontSize=p;
_168b[p]=Math.round(div.offsetHeight*12/16)*16/12/1000;
}
_1689.body().removeChild(div);
div=null;
return _168b;
};
var _168c=null;
dhm.getCachedFontMeasurements=function(_168d){
if(_168d||!_168c){
_168c=dhm.getFontMeasurements();
}
return _168c;
};
var _168e=null,empty={};
dhm.getTextBox=function(text,style,_168f){
var m,s;
if(!_168e){
m=_168e=_1689.doc.createElement("div");
var c=_1689.doc.createElement("div");
c.appendChild(m);
s=c.style;
s.overflow="scroll";
s.position="absolute";
s.left="0px";
s.top="-10000px";
s.width="1px";
s.height="1px";
s.visibility="hidden";
s.borderWidth="0";
s.margin="0";
s.padding="0";
s.outline="0";
_1689.body().appendChild(c);
}else{
m=_168e;
}
m.className="";
s=m.style;
s.borderWidth="0";
s.margin="0";
s.padding="0";
s.outline="0";
if(arguments.length>1&&style){
for(var i in style){
if(i in empty){
continue;
}
s[i]=style[i];
}
}
if(arguments.length>2&&_168f){
m.className=_168f;
}
m.innerHTML=text;
var box=_168a.position(m);
box.w=m.parentNode.scrollWidth;
return box;
};
var _1690={w:16,h:16};
dhm.getScrollbar=function(){
return {w:_1690.w,h:_1690.h};
};
dhm._fontResizeNode=null;
dhm.initOnFontResize=function(_1691){
var f=dhm._fontResizeNode=_1689.doc.createElement("iframe");
var fs=f.style;
fs.position="absolute";
fs.width="5em";
fs.height="10em";
fs.top="-10000px";
fs.display="none";
if(has("ie")){
f.onreadystatechange=function(){
if(f.contentWindow.document.readyState=="complete"){
f.onresize=f.contentWindow.parent[dojox._scopeName].html.metrics._fontresize;
}
};
}else{
f.onload=function(){
f.contentWindow.onresize=f.contentWindow.parent[dojox._scopeName].html.metrics._fontresize;
};
}
f.setAttribute("src","javascript:'<html><head><script>if(\"loadFirebugConsole\" in window){window.loadFirebugConsole();}</script></head><body></body></html>'");
_1689.body().appendChild(f);
dhm.initOnFontResize=function(){
};
};
dhm.onFontResize=function(){
};
dhm._fontresize=function(){
dhm.onFontResize();
};
_1688.addOnUnload(function(){
var f=dhm._fontResizeNode;
if(f){
if(has("ie")&&f.onresize){
f.onresize=null;
}else{
if(f.contentWindow&&f.contentWindow.onresize){
f.contentWindow.onresize=null;
}
}
dhm._fontResizeNode=null;
}
});
ready(function(){
try{
var n=_1689.doc.createElement("div");
n.style.cssText="top:0;left:0;width:100px;height:100px;overflow:scroll;position:absolute;visibility:hidden;";
_1689.body().appendChild(n);
_1690.w=n.offsetWidth-n.clientWidth;
_1690.h=n.offsetHeight-n.clientHeight;
_1689.body().removeChild(n);
delete n;
}
catch(e){
}
if("fontSizeWatch" in _1687.config&&!!_1687.config.fontSizeWatch){
dhm.initOnFontResize();
}
});
return dhm;
});
},"dojo/fx":function(){
define("dojo/fx",["./_base/lang","./Evented","./_base/kernel","./_base/array","./_base/connect","./_base/fx","./dom","./dom-style","./dom-geometry","./ready","require"],function(lang,_1692,dojo,_1693,_1694,_1695,dom,_1696,geom,ready,_1697){
if(!dojo.isAsync){
ready(0,function(){
var _1698=["./fx/Toggler"];
_1697(_1698);
});
}
var _1699=dojo.fx={};
var _169a={_fire:function(evt,args){
if(this[evt]){
this[evt].apply(this,args||[]);
}
return this;
}};
var _169b=function(_169c){
this._index=-1;
this._animations=_169c||[];
this._current=this._onAnimateCtx=this._onEndCtx=null;
this.duration=0;
_1693.forEach(this._animations,function(a){
this.duration+=a.duration;
if(a.delay){
this.duration+=a.delay;
}
},this);
};
_169b.prototype=new _1692();
lang.extend(_169b,{_onAnimate:function(){
this._fire("onAnimate",arguments);
},_onEnd:function(){
_1694.disconnect(this._onAnimateCtx);
_1694.disconnect(this._onEndCtx);
this._onAnimateCtx=this._onEndCtx=null;
if(this._index+1==this._animations.length){
this._fire("onEnd");
}else{
this._current=this._animations[++this._index];
this._onAnimateCtx=_1694.connect(this._current,"onAnimate",this,"_onAnimate");
this._onEndCtx=_1694.connect(this._current,"onEnd",this,"_onEnd");
this._current.play(0,true);
}
},play:function(delay,_169d){
if(!this._current){
this._current=this._animations[this._index=0];
}
if(!_169d&&this._current.status()=="playing"){
return this;
}
var _169e=_1694.connect(this._current,"beforeBegin",this,function(){
this._fire("beforeBegin");
}),_169f=_1694.connect(this._current,"onBegin",this,function(arg){
this._fire("onBegin",arguments);
}),_16a0=_1694.connect(this._current,"onPlay",this,function(arg){
this._fire("onPlay",arguments);
_1694.disconnect(_169e);
_1694.disconnect(_169f);
_1694.disconnect(_16a0);
});
if(this._onAnimateCtx){
_1694.disconnect(this._onAnimateCtx);
}
this._onAnimateCtx=_1694.connect(this._current,"onAnimate",this,"_onAnimate");
if(this._onEndCtx){
_1694.disconnect(this._onEndCtx);
}
this._onEndCtx=_1694.connect(this._current,"onEnd",this,"_onEnd");
this._current.play.apply(this._current,arguments);
return this;
},pause:function(){
if(this._current){
var e=_1694.connect(this._current,"onPause",this,function(arg){
this._fire("onPause",arguments);
_1694.disconnect(e);
});
this._current.pause();
}
return this;
},gotoPercent:function(_16a1,_16a2){
this.pause();
var _16a3=this.duration*_16a1;
this._current=null;
_1693.some(this._animations,function(a){
if(a.duration<=_16a3){
this._current=a;
return true;
}
_16a3-=a.duration;
return false;
});
if(this._current){
this._current.gotoPercent(_16a3/this._current.duration,_16a2);
}
return this;
},stop:function(_16a4){
if(this._current){
if(_16a4){
for(;this._index+1<this._animations.length;++this._index){
this._animations[this._index].stop(true);
}
this._current=this._animations[this._index];
}
var e=_1694.connect(this._current,"onStop",this,function(arg){
this._fire("onStop",arguments);
_1694.disconnect(e);
});
this._current.stop();
}
return this;
},status:function(){
return this._current?this._current.status():"stopped";
},destroy:function(){
if(this._onAnimateCtx){
_1694.disconnect(this._onAnimateCtx);
}
if(this._onEndCtx){
_1694.disconnect(this._onEndCtx);
}
}});
lang.extend(_169b,_169a);
_1699.chain=function(_16a5){
return new _169b(_16a5);
};
var _16a6=function(_16a7){
this._animations=_16a7||[];
this._connects=[];
this._finished=0;
this.duration=0;
_1693.forEach(_16a7,function(a){
var _16a8=a.duration;
if(a.delay){
_16a8+=a.delay;
}
if(this.duration<_16a8){
this.duration=_16a8;
}
this._connects.push(_1694.connect(a,"onEnd",this,"_onEnd"));
},this);
this._pseudoAnimation=new _1695.Animation({curve:[0,1],duration:this.duration});
var self=this;
_1693.forEach(["beforeBegin","onBegin","onPlay","onAnimate","onPause","onStop","onEnd"],function(evt){
self._connects.push(_1694.connect(self._pseudoAnimation,evt,function(){
self._fire(evt,arguments);
}));
});
};
lang.extend(_16a6,{_doAction:function(_16a9,args){
_1693.forEach(this._animations,function(a){
a[_16a9].apply(a,args);
});
return this;
},_onEnd:function(){
if(++this._finished>this._animations.length){
this._fire("onEnd");
}
},_call:function(_16aa,args){
var t=this._pseudoAnimation;
t[_16aa].apply(t,args);
},play:function(delay,_16ab){
this._finished=0;
this._doAction("play",arguments);
this._call("play",arguments);
return this;
},pause:function(){
this._doAction("pause",arguments);
this._call("pause",arguments);
return this;
},gotoPercent:function(_16ac,_16ad){
var ms=this.duration*_16ac;
_1693.forEach(this._animations,function(a){
a.gotoPercent(a.duration<ms?1:(ms/a.duration),_16ad);
});
this._call("gotoPercent",arguments);
return this;
},stop:function(_16ae){
this._doAction("stop",arguments);
this._call("stop",arguments);
return this;
},status:function(){
return this._pseudoAnimation.status();
},destroy:function(){
_1693.forEach(this._connects,_1694.disconnect);
}});
lang.extend(_16a6,_169a);
_1699.combine=function(_16af){
return new _16a6(_16af);
};
_1699.wipeIn=function(args){
var node=args.node=dom.byId(args.node),s=node.style,o;
var anim=_1695.animateProperty(lang.mixin({properties:{height:{start:function(){
o=s.overflow;
s.overflow="hidden";
if(s.visibility=="hidden"||s.display=="none"){
s.height="1px";
s.display="";
s.visibility="";
return 1;
}else{
var _16b0=_1696.get(node,"height");
return Math.max(_16b0,1);
}
},end:function(){
return node.scrollHeight;
}}}},args));
var fini=function(){
s.height="auto";
s.overflow=o;
};
_1694.connect(anim,"onStop",fini);
_1694.connect(anim,"onEnd",fini);
return anim;
};
_1699.wipeOut=function(args){
var node=args.node=dom.byId(args.node),s=node.style,o;
var anim=_1695.animateProperty(lang.mixin({properties:{height:{end:1}}},args));
_1694.connect(anim,"beforeBegin",function(){
o=s.overflow;
s.overflow="hidden";
s.display="";
});
var fini=function(){
s.overflow=o;
s.height="auto";
s.display="none";
};
_1694.connect(anim,"onStop",fini);
_1694.connect(anim,"onEnd",fini);
return anim;
};
_1699.slideTo=function(args){
var node=args.node=dom.byId(args.node),top=null,left=null;
var init=(function(n){
return function(){
var cs=_1696.getComputedStyle(n);
var pos=cs.position;
top=(pos=="absolute"?n.offsetTop:parseInt(cs.top)||0);
left=(pos=="absolute"?n.offsetLeft:parseInt(cs.left)||0);
if(pos!="absolute"&&pos!="relative"){
var ret=geom.position(n,true);
top=ret.y;
left=ret.x;
n.style.position="absolute";
n.style.top=top+"px";
n.style.left=left+"px";
}
};
})(node);
init();
var anim=_1695.animateProperty(lang.mixin({properties:{top:args.top||0,left:args.left||0}},args));
_1694.connect(anim,"beforeBegin",anim,init);
return anim;
};
return _1699;
});
},"url:davinci/ui/templates/UserLibraries.html":"<div class='userLibDialog'>\r\n\t<div class=\"dijitDialogPaneContentArea\">\r\n\t\t<div dojoAttachPoint=\"_tableDiv\"></div>\r\n\t</div>\r\n\r\n\t<div class=\"dijitDialogPaneActionBar\">\r\n\t\t<button dojoType='dijit.form.Button' type='submit' dojoAttachEvent='onClick:okButton' label='${modify}' class=\"maqPrimaryButton\"></button> \r\n\t\t<button dojoType='dijit.form.Button' dojoAttachEvent='onClick:cancelButton' label='${buttonCancel}' class=\"maqSecondaryButton\"></button> \r\n\t</div> \r\n</div>","davinci/html/HtmlFileXPathAdapter":function(){
define(function(){
function _16b1(elem){
this.elem=elem;
};
_16b1.prototype={name:function(){
return this.elem.tag;
},parent:function(){
var _16b2=this.elem.parent;
if(_16b2.elementType!=="HTMLFile"){
return new _16b1(_16b2);
}
},index:function(){
var tag=this.elem.tag,_16b3=this.elem.parent.children,elems,idx=0;
if(_16b3.length===1){
return 0;
}
elems=_16b3.filter(function(child){
return child.tag===tag;
});
if(elems.length>1){
elems.some(function(child,index){
if(child===this.elem){
idx=index+1;
return true;
}
},this);
}
return idx;
}};
return _16b1;
});
},"davinci/ui/widgets/ProjectSelection":function(){
define(["dojo/_base/declare","dijit/_WidgetBase","system/resource","dijit/form/Select","davinci/Workbench"],function(_16b4,_16b5,_16b6,_16b7,_16b8){
return _16b4("davinci.ui.widgets.ProjectSelection",_16b5,{postCreate:function(){
_16b6.listProjects(dojo.hitch(this,function(_16b9){
this.value=_16b8.getProject();
this._allProjects=_16b9.map(function(_16ba){
return _16ba.name;
});
this.domNode.removeAttribute("dojoType");
var items=[];
dojo.forEach(_16b9,dojo.hitch(this,function(v){
items.push({label:v.name,value:v.name});
}));
this.combo=new _16b7({style:"width:100%",options:items});
this.domNode.appendChild(this.combo.domNode);
this.combo.set("value",this.value);
dojo.connect(this.combo,"onChange",this,"_onChange");
}));
},onChange:function(){
},_onChange:function(){
var _16bb=dojo.attr(this.combo,"value");
if(this.value!=_16bb){
this.value=_16bb;
this.onChange();
}
},_getValueAttr:function(){
return this.value;
},_getSizeAttr:function(){
return this._allProjects.length;
},_getProjectsAttr:function(){
return this._allProjects;
}});
});
},"davinci/ve/widgets/BackgroundDialog":function(){
define(["dojo/_base/declare","dijit/_WidgetBase","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","davinci/Runtime","davinci/ve/widgets/MutableStore","davinci/ve/widgets/ColorStore","dojo/text!./templates/BackgroundDialog.html","davinci/ve/utils/CssUtils","dojo/i18n!davinci/ve/nls/ve","dojo/i18n!dijit/nls/common","davinci/ve/utils/URLRewrite","davinci/model/Path","dijit/form/Button","davinci/ve/widgets/ColorPicker","davinci/ve/widgets/ColorPickerFlat","dijit/form/Textarea","davinci/ui/widgets/FileFieldDialog",],function(_16bc,_16bd,_16be,_16bf,_16c0,_16c1,_16c2,_16c3,_16c4,veNLS,_16c5,_16c6,Path){
var _16c7=function(_16c8,_16c9){
var _16ca=_16c0.getUserWorkspaceUrl();
_16c9=new Path(_16c8).getParentPath().append(_16c9).toString();
val="url('"+_16ca+_16c9+"')";
return val;
};
BackgroundDialog=_16bc("davinci.ve.widgets.BackgroundDialog",[_16bd,_16be,_16bf],{templateString:_16c3,widgetsInTemplate:true,_filePicker:null,context:null,veNLS:veNLS,stopRowTemplate:"<tr class='bgdGradOptRow bgdStopRow' style='display:none;'>"+"<td class='bgdCol1'></td>"+"<td class='bgdOptsLabel bdgStopLabel'>"+veNLS.bgdTemplate+"</td>"+"<td class='bgdStopColorTD'>"+"<select class='bgdColor' dojoType='dijit.form.ComboBox'>"+"</select>"+"</td>"+"<td>"+"<select class='bgdPosition' dojoType='dijit.form.ComboBox'>"+"</select>"+"</td>"+"<td class='bgdPlusMinusButtons'><span class='bgdPlusButton' dojoType='dijit.form.Button'>+</span><span class='bgdMinusButton' dojoType='dijit.form.Button'>-</span></td>"+"</tr>",postMixInProperties:function(){
this.inherited(arguments);
dojo.mixin(this,_16c5);
},postCreate:function(){
this.inherited(arguments);
var _16cb=this.langObj=veNLS;
this.stoppos_store=new _16c1({values:["0%","100%","10%","20%","30%","40%","50%","60%","70%","80%","90%"]});
var _16cc=davinci.ve._BackgroundWidgets;
this._statics=["",davinci.ve.widgets.ColorPicker.divider,_16cb.colorPicker,_16cb.removeValue];
var _16cd=[{value:this._statics[0]}];
_16cd.push({value:this._statics[2],action:"_colorpicker"});
_16cd.push({value:this._statics[3],action:"_removevalue"});
_16cd.push({value:this._statics[1],action:"_donothing"});
_16cd.push({value:"transparent"});
_16cd.push({value:"black"});
_16cd.push({value:"white"});
_16cd.push({value:"red"});
_16cd.push({value:"green"});
_16cd.push({value:"blue"});
var _16ce=[];
this._bgcolor_action={};
var _16cf=[];
this._stops_action={};
for(var i=0;i<_16cd.length;i++){
_16ce.push(_16cd[i].value);
if(_16cd[i].action){
this._bgcolor_action[_16cd[i].value]=_16cd[i].action;
}
if(_16cd[i].value!=""&&_16cd[i].action!="_removevalue"){
_16cf.push(_16cd[i].value);
if(_16cd[i].action){
this._stops_action[_16cd[i].value]=_16cd[i].action;
}
}
}
this._bgcolor_store=new _16c2({values:_16ce,noncolors:this._statics});
this._stops_store=new _16c2({values:_16cf,noncolors:this._statics});
var _16d0;
var _16d1=_16cc["background-image"].comboBox;
_16d0=_16d1.get("value");
var _16d2,type;
if(typeof _16d0=="string"&&_16d0.length>0){
_16d2=_16c4.parseBackgroundImage(_16d0);
type=_16d2.type;
}else{
_16d2={};
}
this.bgddata=_16d2;
this.bgdOtherTA.set("value",_16d0);
var _16d3=[];
["emptystring","url","linear","radial","none","other"].forEach(function(val){
_16d3.push({value:val,label:_16cb["bgdType_"+val]});
});
this.bgdTypeSelect.addOption(_16d3);
this._updateBackgroundImageType(type);
this.connect(this.bgdTypeSelect,"onChange",dojo.hitch(this,function(){
var val=this.bgdTypeSelect.get("value");
this._updateBackgroundImageType(val);
this._onFieldChanged();
}));
var _16d4=_16cc["background-color"].comboBox;
_16d0=_16d4.get("value");
var _16d5=this.bgdColorCB;
_16d5.set("store",this._bgcolor_store);
_16d5.set("value",_16d0);
_16d2.backgroundColor=_16d0;
this.connect(this.bgdColorCB,"onChange",dojo.hitch(this,function(event){
this._onChangeColor(event,this.bgdColorCB,this._bgcolor_action);
}));
_16cc["background-color"].bgdWidget=this.bgdColorCB;
var _16d6=_16cc["background-repeat"].comboBox;
_16d0=_16d6.get("value");
var _16d7=this.bgdRepeatCB;
_16d7.set("store",_16d6.store);
_16d7.set("regExp","repeat|repeat-x|repeat-y|no-repeat");
_16d7.set("value",_16d0);
_16d2.backgroundRepeat=_16d0;
this.connect(this.bgdRepeatCB,"onChange",dojo.hitch(this,function(){
_16d2.backgroundRepeat=this.bgdRepeatCB.get("value");
this._onFieldChanged();
}));
_16cc["background-repeat"].bgdWidget=this.bgdRepeatCB;
var _16d8=_16cc["background-position"].comboBox;
_16d0=_16d8.get("value");
var _16d9=this.bgdPositionCB;
_16d9.set("store",_16d8.store);
_16d9.set("regExp","auto|contain|cover|"+_16c4.regstr_posn);
_16d9.set("value",_16d0);
_16d2.backgroundPosition=_16d0;
this.connect(this.bgdPositionCB,"onChange",dojo.hitch(this,function(){
_16d2.backgroundPosition=this.bgdPositionCB.get("value");
this._onFieldChanged();
}));
_16cc["background-position"].bgdWidget=this.bgdPositionCB;
var _16da=_16cc["background-size"].comboBox;
_16d0=_16da.get("value");
var _16db=this.bgdSizeCB;
_16db.set("store",_16da.store);
_16db.set("regExp","auto|contain|cover|"+_16c4.regstr_len_or_pct);
_16db.set("value",_16d0);
_16d2.backgroundSize=_16d0;
this.connect(this.bgdSizeCB,"onChange",dojo.hitch(this,function(){
_16d2.backgroundSize=this.bgdSizeCB.get("value");
this._onFieldChanged();
}));
_16cc["background-size"].bgdWidget=this.bgdSizeCB;
var _16dc=_16cc["background-origin"].comboBox;
_16d0=_16dc.get("value");
var _16dd=this.bgdOriginCB;
_16dd.set("store",_16dc.store);
_16dd.set("regExp","border-box|padding-box|content-box");
_16dd.set("value",_16d0);
_16d2.backgroundOrigin=_16d0;
this.connect(this.bgdOriginCB,"onChange",dojo.hitch(this,function(){
_16d2.backgroundOrigin=this.bgdOriginCB.get("value");
this._onFieldChanged();
}));
_16cc["background-origin"].bgdWidget=this.bgdOriginCB;
var _16de=_16cc["background-clip"].comboBox;
_16d0=_16de.get("value");
var _16df=this.bgdClipCB;
_16df.set("store",_16de.store);
_16df.set("regExp","border-box|padding-box|content-box");
_16df.set("value",_16d0);
_16d2.backgroundClip=_16d0;
this.connect(this.bgdClipCB,"onChange",dojo.hitch(this,function(){
_16d2.backgroundClip=this.bgdClipCB.get("value");
this._onFieldChanged();
}));
_16cc["background-clip"].bgdWidget=this.bgdClipCB;
var store=new _16c1({values:["to bottom","to top","to right","to left","45deg","-45deg"]});
this.bgdLinearAngleCB.set("store",store);
this.bgdLinearAngleCB.set("regExp",_16c4.regstr_angle);
this.bgdLinearAngleCB.set("value",(_16d2&&_16d2.angle)?_16d2.angle:"to bottom");
this.connect(this.bgdLinearAngleCB,"onChange",dojo.hitch(this,function(){
_16d2.angle=this.bgdLinearAngleCB.get("value");
this._onFieldChanged();
}));
var store=new _16c1({values:["center","left top","center center","right bottom","0% 0%","0px 0px"]});
this.bgdRadialPosCB.set("store",store);
this.bgdRadialPosCB.set("regExp",_16c4.regstr_posn);
this.bgdRadialPosCB.set("value",(_16d2&&_16d2.posn)?_16d2.posn:"center");
this.connect(this.bgdRadialPosCB,"onChange",dojo.hitch(this,function(){
_16d2.posn=this.bgdRadialPosCB.get("value");
this._onFieldChanged();
}));
var store=new _16c1({values:["circle","ellipse"]});
this.bgdRadialShapeCB.set("store",store);
this.bgdRadialShapeCB.set("regExp",_16c4.regstr_shape);
this.bgdRadialShapeCB.set("value",(_16d2&&_16d2.shape)?_16d2.shape:"circle");
this.connect(this.bgdRadialShapeCB,"onChange",dojo.hitch(this,function(){
_16d2.shape=this.bgdRadialShapeCB.get("value");
this._onFieldChanged();
}));
var store=new _16c1({values:["farthest-corner","farthest-side","closest-corner","closest-side"]});
this.bgdRadialExtentCB.set("store",store);
this.bgdRadialExtentCB.set("regExp",_16c4.regstr_extent);
this.bgdRadialExtentCB.set("value",(_16d2&&_16d2.extent)?_16d2.extent:"farthest-corner");
this.connect(this.bgdRadialExtentCB,"onChange",dojo.hitch(this,function(){
_16d2.extent=this.bgdRadialExtentCB.get("value");
this._onFieldChanged();
}));
var stops;
if(_16d2&&_16d2.stops&&_16d2.stops.length>=2){
stops=_16d2.stops;
}else{
stops=[{color:"white",pos:"0%"},{color:"black",pos:"100%"}];
}
this._initializeStops(stops);
},startup:function(){
this.inherited(arguments);
var url=(this.bgddata&&this.bgddata.url)?this.bgddata.url:"";
this._filePicker.set("value",url);
this.bgddata.url=url;
this.connect(this._filePicker,"onChange",dojo.hitch(this,function(){
var _16e0=this._filePicker.get("value");
this.bgddata.url=_16e0;
this._onFieldChanged();
}));
},_updateBackgroundImageType:function(type){
var _16e1=this.domNode;
if(!(type&&(type=="none"||type=="url"||type=="linear"||type=="radial"||type=="other"))){
type="emptystring";
}
this.bgddata.type=type;
this.bgdTypeSelect.set("value",type);
var _16e2=dojo.query(".bgdOptionsLabelRow",_16e1);
var _16e3=dojo.query(".bgdImageOptRow",_16e1);
var _16e4=dojo.query(".bgdGradOptRow",_16e1);
var _16e5=dojo.query(".bgdLinearOptRow",_16e1);
var _16e6=dojo.query(".bgdRadialOptRow",_16e1);
var _16e7=dojo.query(".bgdOtherRow",_16e1);
if(type=="url"){
_16e3.concat(_16e2).forEach(function(row){
dojo.removeClass(row,"dijitHidden");
});
_16e4.concat(_16e7).forEach(function(row){
dojo.addClass(row,"dijitHidden");
});
}else{
if(type=="linear"){
_16e4.concat(_16e2).forEach(function(row){
dojo.removeClass(row,"dijitHidden");
});
_16e3.concat(_16e6).concat(_16e7).forEach(function(row){
dojo.addClass(row,"dijitHidden");
});
}else{
if(type=="radial"){
_16e4.concat(_16e2).forEach(function(row){
dojo.removeClass(row,"dijitHidden");
});
_16e3.concat(_16e5).concat(_16e7).forEach(function(row){
dojo.addClass(row,"dijitHidden");
});
}else{
if(type=="other"){
_16e7.forEach(function(row){
dojo.removeClass(row,"dijitHidden");
});
_16e3.concat(_16e4).concat(_16e2).forEach(function(row){
dojo.addClass(row,"dijitHidden");
});
}else{
_16e3.concat(_16e4).concat(_16e2).concat(_16e7).forEach(function(row){
dojo.addClass(row,"dijitHidden");
});
}
}
}
}
},_initializeStops:function(stops){
var _16e8=this.langObj;
if(!stops){
stops=this.bgddata.stops;
}
var _16e9=this.bgdTypeSelect.get("value");
var _16ea=dojo.query(".bgdStopRow",this.domNode);
for(var i=_16ea.length-1;i>0;i--){
var _16eb=_16ea[i];
var _16ec=dojo.query(".bgdColor",_16eb);
var _16ed=dijit.byNode(_16ec[0]);
_16ed.destroyRecursive();
var _16ee=dojo.query(".bgdPosition",_16eb);
var _16ef=dijit.byNode(_16ee[0]);
_16ef.destroyRecursive();
dojo.destroy(_16eb);
}
var _16f0=_16ea[0];
var _16f1=_16f0.parentNode;
var _16f2=_16f0.nextSibling;
for(var i=0;i<stops.length;i++){
var stop=stops[i];
var _16f3=dojo.create("tr",{"className":"bgdGradOptRow bgdStopRow"});
_16f3.innerHTML=this.stopRowTemplate;
if(_16e9!="linear"&&_16e9!="radial"){
dojo.addClass(_16f3,"dijitHidden");
}
_16f1.insertBefore(_16f3,_16f2);
dojo.parser.parse(_16f3);
var _16f4=dojo.query(".bdgStopLabel",_16f3);
_16f4[0].innerHTML=this.langObj.bgdStop+" #"+(i+1)+":";
var _16ec=dojo.query(".bgdColor",_16f3);
var _16ed=dijit.byNode(_16ec[0]);
_16ed.set("store",this._stops_store);
_16ed.set("regExp",_16c4.regstr_stop_color);
_16ed.set("value",stop.color);
this.connect(_16ed,"onChange",dojo.hitch(this,function(_16f5,event){
this._onChangeColor(event,_16f5,this._stops_action);
},_16ed));
var _16ee=dojo.query(".bgdPosition",_16f3);
var _16ef=dijit.byNode(_16ee[0]);
_16ef.set("store",this.stoppos_store);
var pos=(typeof stop.pos=="string"&&stop.pos.length>0)?stop.pos:(i==0)?"0%":"100%";
_16ef.set("regExp",_16c4.regstr_stop_pos);
_16ef.set("value",pos);
this.connect(_16ef,"onChange",dojo.hitch(this,function(){
this._updateDataStructureStops();
this._onFieldChanged();
}));
var _16f6=dojo.query(".bgdPlusButton",_16f3)[0];
var _16f7=dijit.byNode(_16f6);
_16f7.set("title",_16e8.bgdAddStop);
this.connect(_16f7,"onClick",dojo.hitch(this,function(_16f8){
var stop=this.bgddata.stops[_16f8];
this.bgddata.stops.splice(_16f8+1,0,{color:stop.color,pos:stop.pos});
this._initializeStops();
},i));
var _16f9=dojo.query(".bgdMinusButton",_16f3)[0];
var _16fa=dijit.byNode(_16f9);
_16fa.set("title",_16e8.bgdRemoveStop);
this.connect(_16fa,"onClick",dojo.hitch(this,function(_16fb){
var stop=this.bgddata.stops[_16fb];
this.bgddata.stops.splice(_16fb,1);
this._initializeStops();
},i));
var _16fc=dojo.query(".bgdMinusButton",this.domNode);
for(var j=0;j<_16fc.length;j++){
var _16f9=_16fc[j];
var _16fa=dijit.byNode(_16f9);
if(stops.length<=2){
_16fa.set("disabled",true);
}else{
_16fa.set("disabled",false);
}
}
}
this._updateDataStructureStops();
},_onFieldChanged:function(){
this._updateDialogValidity();
this._updateBackgroundPreview();
},_setBaseLocationAttr:function(_16fd){
this._baseLocation=_16fd;
this._filePicker.set("baseLocation",_16fd);
},_updateDialogValidity:function(){
var _16fe=this.bgddata;
if(!_16fe||!_16fe.type){
return;
}
var _16ff=this.domNode;
var type=_16fe.type;
var _1700=[];
var valid=true;
if(type=="url"){
_1700=dojo.query(".bgdImageOptRow",_16ff);
}else{
if(type=="linear"){
_1700=dojo.query(".bgdStopRow",_16ff).concat(dojo.query(".bgdLinearOptRow",_16ff));
}else{
if(type=="radial"){
_1700=dojo.query(".bgdStopRow",_16ff).concat(dojo.query(".bgdRadialOptRow",_16ff));
}
}
}
_1700.forEach(function(row){
var _1701=dojo.query("[widgetid]",row);
_1701.forEach(function(w){
if(typeof w.isValid=="function"&&!w.isValid()){
valid=false;
}
});
});
this.bdgValid=valid;
this._okButton.set("disabled",!valid);
},_updateBackgroundPreview:function(){
var _1702=dojo.query(".bgdPreview",this.domNode)[0];
var _1703="";
var _1704=this.bgddata;
function _1705(_1706,_1707){
var _1708=_1704[_1707];
if(typeof _1708=="string"&&_1708.length>0){
_1703+=";"+_1706+":"+_1708;
}
};
_1705("background-color","backgroundColor");
_1705("background-repeat","backgroundRepeat");
_1705("background-position","backgroundPosition");
_1705("background-size","backgroundSize");
_1705("background-origin","backgroundOrigin");
_1705("background-clip","backgroundClip");
var a=_16c4.buildBackgroundImage(this.bgddata);
for(var i=0;i<a.length;i++){
var val=a[i];
if(_16c6.containsUrl(val)&&!_16c6.isAbsolute(val)&&this.context){
var _1709=_16c6.getUrl(val);
if(_1709){
val=_16c7(this._baseLocation,_1709);
}
}
_1703+=";background-image:"+val;
}
_1702.setAttribute("style",_1703);
this.bgdOtherTA.set("value",a[a.length-1]);
},_updateDataStructureStops:function(){
var _170a=this.bgddata;
_170a.stops=[];
var _170b=dojo.query(".bgdStopRow",this.domNode);
for(var i=1;i<_170b.length;i++){
var _170c=_170b[i];
var _170d=dojo.query(".bgdColor",_170c);
var _170e=dijit.byNode(_170d[0]);
var _170f=dojo.query(".bgdPosition",_170c);
var _1710=dijit.byNode(_170f[0]);
_170a.stops.push({color:_170e.get("value"),pos:_1710.get("value")});
}
},_setValueAttr:function(value){
if(value){
this._colorPickerTargetWidget.set("value",value);
}
},_onChangeColor:function(event,_1711,_1712){
var _1713=_1712[event];
if(_1713){
if(_1713=="_removevalue"){
_1711.set("value","");
}else{
_1711.set("value",_1711._currentcolorvalue);
}
if(_1713=="_colorpicker"){
var _1714=new davinci.ve.widgets.ColorPickerFlat({});
var _1715=_1711.get("value");
var _1716=this.isLeftToRight();
this._colorPickerTargetWidget=_1711;
davinci.ve.widgets.ColorPickerFlat.show(_1714,_1715,this,_1716);
}
}
_1711._currentcolorvalue=_1711.get("value");
this.bgddata.backgroundColor=this.bgdColorCB.get("value");
this._updateDataStructureStops();
this._onFieldChanged();
},okButton:function(){
},cancelButton:function(){
this.onClose();
}});
BackgroundDialog.getCSSForWorkspaceURL=_16c7;
return BackgroundDialog;
});
},"davinci/ve/commands/MoveCommand":function(){
define("davinci/ve/commands/MoveCommand",["dojo/_base/declare","dojo/dom-geometry","davinci/ve/widget","davinci/ve/States","davinci/ve/utils/StyleArray","davinci/ve/utils/GeomUtils"],function(_1717,_1718,_1719,_171a,_171b,_171c){
return _1717("davinci.ve.commands.MoveCommand",null,{name:"move",constructor:function(_171d,left,top,_171e,_171f,_1720,_1721){
this._id=(_171d?_171d.id:undefined);
this._context=_171d.getContext();
this._newBox={l:left,t:top};
this._commandForXYDeltas=_171e;
this._oldBox=_171f;
this._applyToStateIndex=(!_1720||_1720=="Normal"||_1720=="undefined")?"undefined":_1720;
this._disableSnapping=_1721;
},execute:function(){
if(!this._id){
return;
}
var _1722=_1719.byId(this._id);
if(!_1722||!_1722.domNode){
return;
}
var _1723=this._context;
if(!this._oldBox){
var box=_1722.getMarginBox();
this._oldBox={l:box.l,t:box.t,w:box.w,h:box.h};
}
if(!_1722.domNode.offsetParent){
return;
}
var _1724=dojo.position(_1722.domNode.offsetParent,true);
if(!_1724){
return;
}
if(this._commandForXYDeltas){
this._newBox.l=this._oldBox.l+this._commandForXYDeltas._deltaX;
this._newBox.t=this._oldBox.t+this._commandForXYDeltas._deltaY;
}else{
if(!this._disableSnapping&&_1723&&_1723._snapX){
var w=this._oldBox.w;
if(_1723._snapX.typeRefObj=="left"){
this._newBox.l=_1723._snapX.x;
}else{
if(w&&_1723._snapX.typeRefObj=="right"){
this._newBox.l=_1723._snapX.x-w;
}else{
if(w&&_1723._snapX.typeRefObj=="center"){
this._newBox.l=_1723._snapX.x-w/2;
}
}
}
}
if(!this._disableSnapping&&_1723&&_1723._snapY){
var h=this._oldBox.h;
if(_1723._snapY.typeRefObj=="top"){
this._newBox.t=_1723._snapY.y;
}else{
if(h&&_1723._snapY.typeRefObj=="bottom"){
this._newBox.t=_1723._snapY.y-h;
}else{
if(h&&_1723._snapY.typeRefObj=="middle"){
this._newBox.t=_1723._snapY.y-h/2;
}
}
}
}
}
this._deltaX=this._newBox.l-this._oldBox.l;
this._deltaY=this._newBox.t-this._oldBox.t;
var _1725=_171c.getBorderBoxPageCoords(_1722.domNode.offsetParent);
var _1726=_1718.getBorderExtents(_1722.domNode.offsetParent);
var _1727=this._newBox.l-_1725.l-_1726.l;
var _1728=this._newBox.t-_1725.t-_1726.t;
var _1729=[{left:_1727+"px"},{top:_1728+"px"}];
var _172a=_1722.getStyleValuesAllStates();
this._oldStyleValuesAllStates=dojo.clone(_172a);
if(this._oldBox){
var _172b=this._oldBox.l-_1725.l-_1726.l;
var _172c=this._oldBox.t-_1725.t-_1726.t;
this._oldStyleValuesAllStates[this._applyToStateIndex]=_171b.mergeStyleArrays(this._oldStyleValuesAllStates[this._applyToStateIndex],[{left:_172b+"px"},{top:_172c+"px"}]);
}
if(_172a[this._applyToStateIndex]){
_172a[this._applyToStateIndex]=_171b.mergeStyleArrays(_172a[this._applyToStateIndex],_1729);
}else{
_172a[this._applyToStateIndex]=_1729;
}
_1722.setStyleValuesAllStates(_172a);
var _172d=_171a.getStatesListCurrent(_1722.domNode);
var _172e=_171b.mergeStyleArrays([],_172a["undefined"]);
for(var i=0;i<_172d.length;i++){
if(_172a[_172d[i]]){
_172e=_171b.mergeStyleArrays(_172e,_172a[_172d[i]]);
}
}
_1722.setStyleValuesCanvas(_172e);
_1722.setStyleValuesModel(_172a["undefined"]);
_1722.refresh();
_171a.resetState(_1722.domNode);
dojo.publish("/davinci/ui/widgetPropertiesChanged",[[_1722]]);
},undo:function(){
if(!this._id){
return;
}
var _172f=_1719.byId(this._id);
if(!_172f){
return;
}
var _1730=this._oldStyleValuesAllStates;
var _1731=this._applyToStateIndex;
_172f.setStyleValuesAllStates(_1730);
var _1732=_171b.mergeStyleArrays(_1730["undefined"],_1730[_1731]);
_172f.setStyleValuesCanvas(_1732);
_172f.setStyleValuesModel(this._oldStyleValuesAllStates["undefined"]);
_172f.refresh();
davinci.ve.states.resetState(_172f.domNode);
dojo.publish("/davinci/ui/widgetPropertiesChanged",[[_172f]]);
}});
});
},"davinci/workbench/EditorContainer":function(){
define("davinci/workbench/EditorContainer",["require","dojo/_base/declare","./_ToolbaredContainer","../Runtime","../ve/metadata","../ve/utils/GeomUtils","dojo/Deferred","dojo/i18n!./nls/workbench"],function(_1733,_1734,_1735,_1736,_1737,_1738,_1739,_173a){
var _173b={},_173c={};
return _1734(_1735,{constructor:function(args){
},postCreate:function(){
this.subscribe("/davinci/ui/editorSelected",function(event){
if(event.editor==this.editor){
this.updateToolbars();
}
});
this.subscribe("/davinci/ui/widgetSelected",this.updateToolbars);
this.subscribe("/davinci/workbench/ready",this.updateToolbars);
},layout:function(){
this.titleBarDiv.style.display="none";
this.toolbarDiv.style.display="none";
this.inherited(arguments);
},resize:function(){
this.inherited(arguments);
if(this.editor&&this.editor.editor&&this.editor.editor.getTextView){
this.editor.editor.getTextView().resize();
}
},setEditor:function(_173d,_173e,_173f,file,_1740,_1741){
var d=new _1739();
this.editorExtension=_173d;
_1733([_173d.editorClass],function(_1742){
try{
var _1743=this.editor=new _1742(this.containerNode,_173e);
var _1744=function(){
if(_1743.setRootElement){
_1743.setRootElement(_1740);
}
this.containerNode=_1743.domNode||this.containerNode;
if(typeof _173d.editorClassName=="string"){
dojo.addClass(this.domNode,_173d.editorClassName);
}
_1743.editorID=_173d.id;
_1743.isDirty=!_1743.isReadOnly&&this.isDirty;
this._createToolbar(_173d.editorClass);
if(!_173f){
_173f=_1743.getDefaultContent();
if(_1743.isReadOnly||!file.isNew){
_1743.isDirty=false;
}else{
_1743.isDirty=true;
}
_1743.lastModifiedTime=Date.now();
}
if(!_173f){
_173f="";
}
_1743.resourceFile=file;
_1743.fileName=_173e;
var _1745="editors_container";
if(dijit.byId(_1745).selectedChildWidget.domNode==this.domNode){
_1743.setContent(_173e,_173f,_1741);
this._setupKeyboardHandler();
dojo.connect(_1743,"handleKeyEvent",this,"_handleKeyDown");
}else{
var _1746=dojo.subscribe(_1745+"-selectChild",this,function(args){
if(_1743==args.editor){
dojo.unsubscribe(_1746);
_1743.setContent(_173e,_173f);
this._setupKeyboardHandler();
dojo.connect(_1743,"handleKeyEvent",this,"_handleKeyDown");
}
});
}
_1743.editorContainer=this;
this.setDirty(_1743.isDirty);
}.bind(this);
if(_1743.deferreds){
_1743.deferreds.then(function(){
try{
_1744();
d.resolve(_1743);
}
catch(e2){
d.reject(e2);
}
},function(e){
d.reject(e);
});
}else{
_1744();
d.resolve(_1743);
}
}
catch(e){
d.reject(e);
}
}.bind(this));
return d;
},setDirty:function(_1747){
var title=this._getTitle();
if(_1747){
title="*"+title;
}
var _1748=_1733("../Workbench");
_1748.editorTabs.setTitle(this,title);
this.lastModifiedTime=Date.now();
this.isDirty=_1747;
},_getTitle:function(){
var title=this.attr("title");
if(title[0]=="*"){
title=title.substring(1);
}
return title;
},save:function(_1749){
this.editor.save(_1749);
this.setDirty(_1749);
},_close:function(_174a,_174b){
dojo.publish("/davinci/ui/EditorClosing",[{editor:_174a}]);
var _174c=true;
if(_174b&&_174a&&_174a.isDirty){
var _174d=_174a.getOnUnloadWarningMessage();
if(!_174d){
_174d=dojo.string.substitute(_173a.fileHasUnsavedChanges,[this._getTitle()]);
}
_174c=confirm(_174d);
}
if(_174c){
this._isClosing=true;
if(_174a.removeWorkingCopy){
_174a.removeWorkingCopy();
}else{
if(_174a.getFileEditors){
_174a.getFileEditors().forEach(function(_174e){
if(_174e.isReadOnly){
return;
}
_174e.resourceFile.removeWorkingCopy();
});
}else{
if(_174a.resourceFile){
_174a.resourceFile.removeWorkingCopy();
}
}
}
}
return _174c;
},onClose:function(){
var _174f=!this._skipDirtyCheck;
return this._close(this.editor,_174f);
},forceClose:function(_1750,_1751){
this._close(_1750,_1751);
var _1752=this.getParent();
if(_1752){
_1752.removeChild(this);
this.destroyRecursive();
}
},_getViewActions:function(){
var _1753=this.editorExtension.id;
var _1754=[];
var _1755=_1736.getExtensions("davinci.editorActions",function(ext){
if(_1753==ext.editorContribution.targetID){
_1754.push(ext.editorContribution);
return true;
}
});
if(_1754.length==0){
var _1755=_1736.getExtension("davinci.defaultEditorActions",function(ext){
_1754.push(ext.editorContribution);
return true;
});
}
var _1756=_1737.getLibraryActions("davinci.editorActions",_1753);
_1754=dojo.clone(_1754);
if(_1754.length>0&&_1756.length){
dojo.forEach(_1756,function(_1757){
var _1758=_1733("../Workbench");
if(_1757.action){
_1758._loadActionClass(_1757);
}
if(_1757.menu){
for(var i=0;i<_1757.menu.length;i++){
var _1759=_1757.menu[0];
if(_1759.action){
_1758._loadActionClass(_1759);
}
}
}
_1754[0].actions.push(_1757);
});
}
return _1754;
},_getViewContext:function(){
return this.editor;
},_setupKeyboardHandler:function(){
var _175a=function(o){
if(!this.keyBindings){
this.keyBindings=[];
}
this.keyBindings.push(o);
}.bind(this);
this._getViewActions().forEach(function(_175b){
_175b.actions.forEach(function(_175c){
if(_175c.keyBinding){
_175a({keyBinding:_175c.keyBinding,action:_175c});
}
if(_175c.menu){
_175c.menu.forEach(function(_175d){
if(_175d.keyBinding){
_175a({keyBinding:_175d.keyBinding,action:_175d});
}
},this);
}
},this);
},this);
},_handleKeyDown:function(e,_175e){
var _175f=this._handleKey(e,_175e);
if(!_175f&&!_175e){
_1736.handleKeyEvent(e);
}
},_handleKey:function(e,_1760){
if(!this.keyBindings){
return false;
}
var _1761=this.keyBindings.some(function(_1762){
if(_1760&&!_1762.keyBinding.allowGlobal){
return;
}
if(_1736.isKeyEqualToEvent(_1762.keyBinding,e)){
var _1763=_1733("../Workbench");
_1763._runAction(_1762.action,this.editor,_1762.action.id);
return true;
}
},this);
if(_1761){
dojo.stopEvent(e);
}
return _1761;
},destroy:function(){
this.inherited(arguments);
if(this.editor){
this.editor.destroy();
}
delete this.editor;
},_updateToolbar:function(_1764){
function _1765(_1766,_1767){
var _1768=true;
if(_1766&&_1766.action&&_1766.action[_1767]){
_1768=_1766.action[_1767]();
}else{
if(_1766&&_1766[_1767]){
_1768=_1766[_1767]();
}
}
return _1768;
};
function _1769(_176a,_176b){
var _176c=_1765(_176b,"shouldShow");
if(_176c){
dojo.removeClass(_176a.domNode,"maqHidden");
}else{
dojo.addClass(_176a.domNode,"maqHidden");
}
};
function _176d(_176e,_176f){
var _1770=_1765(_176f,"isEnabled");
_176e.set("disabled",!_1770);
};
function _1771(_1772,_1773){
_1765(_1773,"updateStyling");
};
if(_1764&&this.editor){
var _1774=this.editor.getContext?this.editor.getContext():null;
if(_1774){
var _1775=_1764.getChildren();
for(var i=0;i<_1775.length;i++){
var child=_1775[i];
_1769(child,child._maqAction);
_176d(child,child._maqAction);
_1771(child,child._maqAction);
var menu=child.dropDown;
if(menu){
var _1776=menu.getChildren();
for(var j=0;j<_1776.length;j++){
var _1777=_1776[j];
_1769(_1777,_1777._maqAction);
_176d(_1777,_1777._maqAction);
_1771(_1777,_1777._maqAction);
}
}
}
}
}
},updateToolbars:function(){
if(this.editor==_1736.currentEditor){
var _1778=this.getToolbarDiv();
if(_1778){
_1778.innerHTML="";
}
var _1779=this.toolbarCreated(this.editorExtension.editorClass);
if(_1778&&_1779&&_1779.domNode){
_1778.appendChild(_1779.domNode);
}
var _177a=dojo.query("#davinci_toolbar_container .dijitToolbar")[0];
var _177b=_177a?dijit.byNode(_177a):null;
this._updateToolbar(_177b);
}
},_createToolbar:function(_177c){
if(this.toolbarCreated(_177c)||_173b[_177c]){
return;
}
_173b[_177c]=true;
this.inherited(arguments);
},getToolbarDiv:function(){
return dojo.byId("davinci_toolbar_container");
},toolbarCreated:function(_177d,_177e){
if(arguments.length>1){
_173c[_177d]=_177e;
}
return _173c[_177d];
}});
});
},"davinci/html/CSSCombinedSelector":function(){
define("davinci/html/CSSCombinedSelector",["dojo/_base/declare","davinci/html/CSSElement"],function(_177f,_1780){
return _177f("davinci.html.CSSCombinedSelector",_1780,{constructor:function(){
this.selectors=[];
this.combiners=[];
this.elementType="CSSCombinedSelector";
},matchesSelector:function(_1781){
if(_1781.elementType==this.elementType){
if(_1781.selectors.length==this.selectors.length){
for(var i=0;i<this.selectors.length;i++){
if(this.combiners[i]!=_1781.combiners[i]){
return false;
}
if(!this.selectors[i].matchesSelector(_1781.selectors[i])){
return false;
}
}
return true;
}
}
},getText:function(_1782){
var s="";
for(var i=0;i<this.selectors.length-1;i++){
s=s+this.selectors[i].getText(_1782);
if(this.combiners[i]!=" "){
s+=" "+this.combiners[i]+" ";
}else{
s+=this.combiners[i];
}
}
s=s+this.selectors[this.selectors.length-1].getText(_1782);
return s;
},matches:function(_1783){
var _1784=this.selectors.length-1;
var _1785=0;
for(var i=0;i<_1783.length;i++){
var _1786;
if((_1786=this.selectors[_1784].matches(_1783,i))>=0){
_1785+=_1786;
_1784--;
if(_1784<0){
return _1785;
}
}
if(i==0&&_1786<0){
return -1;
}
}
},visit:function(_1787){
if(!_1787.visit(this)){
for(var i=0;i<this.children.length;i++){
this.children[i].visit(_1787);
}
for(var i=0;i<this.selectors.length;i++){
this.selectors[i].visit(_1787);
}
}
if(_1787.endVisit){
_1787.endVisit(this);
}
},getCSSRule:function(){
return this.parent;
}});
});
},"orion/textview/projectionTextModel":function(){
define("orion/textview/projectionTextModel",["orion/textview/textModel","orion/textview/eventTarget"],function(_1788,_1789){
function _178a(_178b){
this._model=_178b;
this._projections=[];
};
_178a.prototype={addProjection:function(_178c){
if(!_178c){
return;
}
var model=this._model,_178d=this._projections;
_178c._lineIndex=model.getLineAtOffset(_178c.start);
_178c._lineCount=model.getLineAtOffset(_178c.end)-_178c._lineIndex;
var text=_178c.text;
if(!text){
text="";
}
if(typeof text==="string"){
_178c._model=new _1788.TextModel(text,model.getLineDelimiter());
}else{
_178c._model=text;
}
var _178e=this.mapOffset(_178c.start,true);
var _178f=_178c.end-_178c.start;
var _1790=_178c._lineCount;
var _1791=_178c._model.getCharCount();
var _1792=_178c._model.getLineCount()-1;
var _1793={type:"Changing",text:_178c._model.getText(),start:_178e,removedCharCount:_178f,addedCharCount:_1791,removedLineCount:_1790,addedLineCount:_1792};
this.onChanging(_1793);
var index=this._binarySearch(_178d,_178c.start);
_178d.splice(index,0,_178c);
var _1794={type:"Changed",start:_178e,removedCharCount:_178f,addedCharCount:_1791,removedLineCount:_1790,addedLineCount:_1792};
this.onChanged(_1794);
},getProjections:function(){
return this._projections.slice(0);
},getBaseModel:function(){
return this._model;
},mapOffset:function(_1795,_1796){
var _1797=this._projections,delta=0,i,_1798;
if(_1796){
for(i=0;i<_1797.length;i++){
_1798=_1797[i];
if(_1798.start>_1795){
break;
}
if(_1798.end>_1795){
return -1;
}
delta+=_1798._model.getCharCount()-(_1798.end-_1798.start);
}
return _1795+delta;
}
for(i=0;i<_1797.length;i++){
_1798=_1797[i];
if(_1798.start>_1795-delta){
break;
}
var _1799=_1798._model.getCharCount();
if(_1798.start+_1799>_1795-delta){
return -1;
}
delta+=_1799-(_1798.end-_1798.start);
}
return _1795-delta;
},removeProjection:function(_179a){
var i,delta=0;
for(i=0;i<this._projections.length;i++){
var p=this._projections[i];
if(p===_179a){
_179a=p;
break;
}
delta+=p._model.getCharCount()-(p.end-p.start);
}
if(i<this._projections.length){
var model=this._model;
var _179b=_179a.start+delta;
var _179c=_179a.end-_179a.start;
var _179d=_179a._lineCount;
var _179e=_179a._model.getCharCount();
var _179f=_179a._model.getLineCount()-1;
var _17a0={type:"Changing",text:model.getText(_179a.start,_179a.end),start:_179b,removedCharCount:_179e,addedCharCount:_179c,removedLineCount:_179f,addedLineCount:_179d};
this.onChanging(_17a0);
this._projections.splice(i,1);
var _17a1={type:"Changed",start:_179b,removedCharCount:_179e,addedCharCount:_179c,removedLineCount:_179f,addedLineCount:_179d};
this.onChanged(_17a1);
}
},_binarySearch:function(array,_17a2){
var high=array.length,low=-1,index;
while(high-low>1){
index=Math.floor((high+low)/2);
if(_17a2<=array[index].start){
high=index;
}else{
low=index;
}
}
return high;
},getCharCount:function(){
var count=this._model.getCharCount(),_17a3=this._projections;
for(var i=0;i<_17a3.length;i++){
var _17a4=_17a3[i];
count+=_17a4._model.getCharCount()-(_17a4.end-_17a4.start);
}
return count;
},getLine:function(_17a5,_17a6){
if(_17a5<0){
return null;
}
var model=this._model,_17a7=this._projections;
var delta=0,_17a8=[],_17a9=0,i,_17aa,_17ab;
for(i=0;i<_17a7.length;i++){
_17ab=_17a7[i];
if(_17ab._lineIndex>=_17a5-delta){
break;
}
_17aa=_17ab._model.getLineCount()-1;
if(_17ab._lineIndex+_17aa>=_17a5-delta){
var _17ac=_17a5-(_17ab._lineIndex+delta);
if(_17ac<_17aa){
return _17ab._model.getLine(_17ac,_17a6);
}else{
_17a8.push(_17ab._model.getLine(_17aa));
}
}
_17a9=_17ab.end;
delta+=_17aa-_17ab._lineCount;
}
_17a9=Math.max(_17a9,model.getLineStart(_17a5-delta));
for(;i<_17a7.length;i++){
_17ab=_17a7[i];
if(_17ab._lineIndex>_17a5-delta){
break;
}
_17a8.push(model.getText(_17a9,_17ab.start));
_17aa=_17ab._model.getLineCount()-1;
if(_17ab._lineIndex+_17aa>_17a5-delta){
_17a8.push(_17ab._model.getLine(0,_17a6));
return _17a8.join("");
}
_17a8.push(_17ab._model.getText());
_17a9=_17ab.end;
delta+=_17aa-_17ab._lineCount;
}
var end=model.getLineEnd(_17a5-delta,_17a6);
if(_17a9<end){
_17a8.push(model.getText(_17a9,end));
}
return _17a8.join("");
},getLineAtOffset:function(_17ad){
var model=this._model,_17ae=this._projections;
var delta=0,_17af=0;
for(var i=0;i<_17ae.length;i++){
var _17b0=_17ae[i];
if(_17b0.start>_17ad-delta){
break;
}
var _17b1=_17b0._model.getCharCount();
if(_17b0.start+_17b1>_17ad-delta){
var _17b2=_17ad-(_17b0.start+delta);
_17af+=_17b0._model.getLineAtOffset(_17b2);
delta+=_17b2;
break;
}
_17af+=_17b0._model.getLineCount()-1-_17b0._lineCount;
delta+=_17b1-(_17b0.end-_17b0.start);
}
return model.getLineAtOffset(_17ad-delta)+_17af;
},getLineCount:function(){
var model=this._model,_17b3=this._projections;
var count=model.getLineCount();
for(var i=0;i<_17b3.length;i++){
var _17b4=_17b3[i];
count+=_17b4._model.getLineCount()-1-_17b4._lineCount;
}
return count;
},getLineDelimiter:function(){
return this._model.getLineDelimiter();
},getLineEnd:function(_17b5,_17b6){
if(_17b5<0){
return -1;
}
var model=this._model,_17b7=this._projections;
var delta=0,_17b8=0;
for(var i=0;i<_17b7.length;i++){
var _17b9=_17b7[i];
if(_17b9._lineIndex>_17b5-delta){
break;
}
var _17ba=_17b9._model.getLineCount()-1;
if(_17b9._lineIndex+_17ba>_17b5-delta){
var _17bb=_17b5-(_17b9._lineIndex+delta);
return _17b9._model.getLineEnd(_17bb,_17b6)+_17b9.start+_17b8;
}
_17b8+=_17b9._model.getCharCount()-(_17b9.end-_17b9.start);
delta+=_17ba-_17b9._lineCount;
}
return model.getLineEnd(_17b5-delta,_17b6)+_17b8;
},getLineStart:function(_17bc){
if(_17bc<0){
return -1;
}
var model=this._model,_17bd=this._projections;
var delta=0,_17be=0;
for(var i=0;i<_17bd.length;i++){
var _17bf=_17bd[i];
if(_17bf._lineIndex>=_17bc-delta){
break;
}
var _17c0=_17bf._model.getLineCount()-1;
if(_17bf._lineIndex+_17c0>=_17bc-delta){
var _17c1=_17bc-(_17bf._lineIndex+delta);
return _17bf._model.getLineStart(_17c1)+_17bf.start+_17be;
}
_17be+=_17bf._model.getCharCount()-(_17bf.end-_17bf.start);
delta+=_17c0-_17bf._lineCount;
}
return model.getLineStart(_17bc-delta)+_17be;
},getText:function(start,end){
if(start===undefined){
start=0;
}
var model=this._model,_17c2=this._projections;
var delta=0,_17c3=[],i,_17c4,_17c5;
for(i=0;i<_17c2.length;i++){
_17c4=_17c2[i];
if(_17c4.start>start-delta){
break;
}
_17c5=_17c4._model.getCharCount();
if(_17c4.start+_17c5>start-delta){
if(end!==undefined&&_17c4.start+_17c5>end-delta){
return _17c4._model.getText(start-(_17c4.start+delta),end-(_17c4.start+delta));
}else{
_17c3.push(_17c4._model.getText(start-(_17c4.start+delta)));
start=_17c4.end+delta+_17c5-(_17c4.end-_17c4.start);
}
}
delta+=_17c5-(_17c4.end-_17c4.start);
}
var _17c6=start-delta;
if(end!==undefined){
for(;i<_17c2.length;i++){
_17c4=_17c2[i];
if(_17c4.start>end-delta){
break;
}
_17c3.push(model.getText(_17c6,_17c4.start));
_17c5=_17c4._model.getCharCount();
if(_17c4.start+_17c5>end-delta){
_17c3.push(_17c4._model.getText(0,end-(_17c4.start+delta)));
return _17c3.join("");
}
_17c3.push(_17c4._model.getText());
_17c6=_17c4.end;
delta+=_17c5-(_17c4.end-_17c4.start);
}
_17c3.push(model.getText(_17c6,end-delta));
}else{
for(;i<_17c2.length;i++){
_17c4=_17c2[i];
_17c3.push(model.getText(_17c6,_17c4.start));
_17c3.push(_17c4._model.getText());
_17c6=_17c4.end;
}
_17c3.push(model.getText(_17c6));
}
return _17c3.join("");
},_onChanging:function(text,start,_17c7,_17c8,_17c9,_17ca){
var model=this._model,_17cb=this._projections,i,_17cc,delta=0,_17cd;
var end=start+_17c7;
for(;i<_17cb.length;i++){
_17cc=_17cb[i];
if(_17cc.start>start){
break;
}
delta+=_17cc._model.getCharCount()-(_17cc.end-_17cc.start);
}
var _17ce=start+delta,_17cf=i;
for(;i<_17cb.length;i++){
_17cc=_17cb[i];
if(_17cc.start>end){
break;
}
delta+=_17cc._model.getCharCount()-(_17cc.end-_17cc.start);
_17cd+=_17cc._model.getLineCount()-1-_17cc._lineCount;
}
var _17d0=end+delta,_17d1=i;
this.onChanging(_17ce,_17d0-_17ce,_17c8,_17c9+_17cd,_17ca);
_17cb.splice(_17cb,_17d1-_17cf);
var count=text.length-(_17d0-_17ce);
for(;i<_17cb.length;i++){
_17cc=_17cb[i];
_17cc.start+=count;
_17cc.end+=count;
_17cc._lineIndex=model.getLineAtOffset(_17cc.start);
}
},onChanging:function(_17d2){
return this.dispatchEvent(_17d2);
},onChanged:function(_17d3){
return this.dispatchEvent(_17d3);
},setLineDelimiter:function(_17d4){
this._model.setLineDelimiter(_17d4);
},setText:function(text,start,end){
if(text===undefined){
text="";
}
if(start===undefined){
start=0;
}
var _17d5=start,_17d6=end;
var model=this._model,_17d7=this._projections;
var delta=0,_17d8=0,i,_17d9,_17da,_17db,_17dc,_17dd=0;
for(i=0;i<_17d7.length;i++){
_17d9=_17d7[i];
if(_17d9.start>start-delta){
break;
}
_17da=_17d9._model.getCharCount();
if(_17d9.start+_17da>start-delta){
if(end!==undefined&&_17d9.start+_17da>end-delta){
_17d9._model.setText(text,start-(_17d9.start+delta),end-(_17d9.start+delta));
return;
}else{
_17dd=_17d9._model.getLineCount()-1-_17d9._model.getLineAtOffset(start-(_17d9.start+delta));
_17db={projection:_17d9,start:start-(_17d9.start+delta)};
start=_17d9.end+delta+_17da-(_17d9.end-_17d9.start);
}
}
_17d8+=_17d9._model.getLineCount()-1-_17d9._lineCount;
delta+=_17da-(_17d9.end-_17d9.start);
}
var _17de=start-delta,_17df=i,_17e0=model.getLineAtOffset(_17de)+_17d8-_17dd;
if(end!==undefined){
for(;i<_17d7.length;i++){
_17d9=_17d7[i];
if(_17d9.start>end-delta){
break;
}
_17da=_17d9._model.getCharCount();
if(_17d9.start+_17da>end-delta){
_17d8+=_17d9._model.getLineAtOffset(end-(_17d9.start+delta));
_17da=end-(_17d9.start+delta);
end=_17d9.end+delta;
_17dc={projection:_17d9,end:_17da};
break;
}
_17d8+=_17d9._model.getLineCount()-1-_17d9._lineCount;
delta+=_17da-(_17d9.end-_17d9.start);
}
}else{
for(;i<_17d7.length;i++){
_17d9=_17d7[i];
_17d8+=_17d9._model.getLineCount()-1-_17d9._lineCount;
delta+=_17d9._model.getCharCount()-(_17d9.end-_17d9.start);
}
end=_17d6=model.getCharCount()+delta;
}
var _17e1=end-delta,_17e2=i,_17e3=model.getLineAtOffset(_17e1)+_17d8;
var _17e4=_17d6-_17d5;
var _17e5=_17e3-_17e0;
var _17e6=text.length;
var _17e7=0;
var cr=0,lf=0,index=0;
while(true){
if(cr!==-1&&cr<=index){
cr=text.indexOf("\r",index);
}
if(lf!==-1&&lf<=index){
lf=text.indexOf("\n",index);
}
if(lf===-1&&cr===-1){
break;
}
if(cr!==-1&&lf!==-1){
if(cr+1===lf){
index=lf+1;
}else{
index=(cr<lf?cr:lf)+1;
}
}else{
if(cr!==-1){
index=cr+1;
}else{
index=lf+1;
}
}
_17e7++;
}
var _17e8={type:"Changing",text:text,start:_17d5,removedCharCount:_17e4,addedCharCount:_17e6,removedLineCount:_17e5,addedLineCount:_17e7};
this.onChanging(_17e8);
model.setText(text,_17de,_17e1);
if(_17db){
_17d9=_17db.projection;
_17d9._model.setText("",_17db.start);
}
if(_17dc){
_17d9=_17dc.projection;
_17d9._model.setText("",0,_17dc.end);
_17d9.start=_17d9.end;
_17d9._lineCount=0;
}
_17d7.splice(_17df,_17e2-_17df);
var _17e9=text.length-(_17e1-_17de);
for(i=_17e2;i<_17d7.length;i++){
_17d9=_17d7[i];
_17d9.start+=_17e9;
_17d9.end+=_17e9;
_17d9._lineIndex=model.getLineAtOffset(_17d9.start);
}
var _17ea={type:"Changed",start:_17d5,removedCharCount:_17e4,addedCharCount:_17e6,removedLineCount:_17e5,addedLineCount:_17e7};
this.onChanged(_17ea);
}};
_1789.EventTarget.addMixin(_178a.prototype);
return {ProjectionTextModel:_178a};
});
},"url:davinci/ve/actions/templates/ModifyState.html":"<div>\n\t<div class=\"dijitDialogPaneContentArea\">\n\t\t<div class='modify_state_container'>\n\t\t\t<div data-dojo-type=\"dijit.form.DropDownButton\" label='${veNls.renameLabel}' dojoAttachPoint=\"renameButton\" class=\"modify_state_rename_button\">\n\t\t\t\t\t<div data-dojo-type=\"dijit.TooltipDialog\" class='modify_state_rename_container' id='state_rename_tooltip_dialog'>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<label for=\"state_rename_new_name\">${veNls.newStateLabel}</label>\n\t\t\t\t\t\t\t<input data-dojo-type=\"dijit.form.ValidationTextBox\" id=\"state_rename_new_name\" name=\"state_rename_new_name\"></input>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<button id=\"state_rename_do_it\" dojoType='dijit.form.Button' label='${veNls.renameLabel}'></button>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t${veNls.stateLabel}: <span id='modify_state_old_name'>aaa</span>\n\t\t</div>\n\t\t<div class='initial_state_row'>\n\t\t\t<input data-dojo-type=\"dijit.form.CheckBox\" dojoAttachPoint=\"initialState\" id=\"modify_state_initial_state\" name=\"modify_state_initial_state\"></input>\n\t\t\t<label for='modify_state_initial_state'>${veNls.initialStateCheckBoxLabel}</label>\n\t\t</div>\n\t</div>\n\t\t\t\t\n\t<div class=\"dijitDialogPaneActionBar\">\n\t\t<button dojoType='dijit.form.Button' dojoAttachPoint=\"okButton\" label='${veNls.modifyLabel}' class=\"maqPrimaryButton\"></button>\n\t\t<button dojoType='dijit.form.Button' dojoAttachPoint=\"cancelButton\" label='${commonNls.buttonCancel}' class=\"maqSecondaryButton\"></button>\n\t</div>\n</div>\n","orion/textview/eventTarget":function(){
define("orion/textview/eventTarget",[],function(){
function _17eb(){
};
_17eb.addMixin=function(_17ec){
var proto=_17eb.prototype;
for(var p in proto){
if(proto.hasOwnProperty(p)){
_17ec[p]=proto[p];
}
}
};
_17eb.prototype={addEventListener:function(type,_17ed,_17ee){
if(!this._eventTypes){
this._eventTypes={};
}
var state=this._eventTypes[type];
if(!state){
state=this._eventTypes[type]={level:0,listeners:[]};
}
var _17ef=state.listeners;
_17ef.push({listener:_17ed,useCapture:_17ee});
},dispatchEvent:function(evt){
if(!this._eventTypes){
return;
}
var type=evt.type;
var state=this._eventTypes[type];
if(state){
var _17f0=state.listeners;
try{
state.level++;
if(_17f0){
for(var i=0,len=_17f0.length;i<len;i++){
if(_17f0[i]){
var l=_17f0[i].listener;
if(typeof l==="function"){
l.call(this,evt);
}else{
if(l.handleEvent&&typeof l.handleEvent==="function"){
l.handleEvent(evt);
}
}
}
}
}
}
finally{
state.level--;
if(state.compact&&state.level===0){
for(var j=_17f0.length-1;j>=0;j--){
if(!_17f0[j]){
_17f0.splice(j,1);
}
}
if(_17f0.length===0){
delete this._eventTypes[type];
}
state.compact=false;
}
}
}
},isListening:function(type){
if(!this._eventTypes){
return false;
}
return this._eventTypes[type]!==undefined;
},removeEventListener:function(type,_17f1,_17f2){
if(!this._eventTypes){
return;
}
var state=this._eventTypes[type];
if(state){
var _17f3=state.listeners;
for(var i=0,len=_17f3.length;i<len;i++){
var l=_17f3[i];
if(l&&l.listener===_17f1&&l.useCapture===_17f2){
if(state.level!==0){
_17f3[i]=null;
state.compact=true;
}else{
_17f3.splice(i,1);
}
break;
}
}
if(_17f3.length===0){
delete this._eventTypes[type];
}
}
}};
return {EventTarget:_17eb};
});
},"dojo/dnd/Mover":function(){
define("dojo/dnd/Mover",["../_base/array","../_base/declare","../_base/event","../_base/lang","../sniff","../_base/window","../dom","../dom-geometry","../dom-style","../Evented","../on","../touch","./common","./autoscroll"],function(array,_17f4,event,lang,has,win,dom,_17f5,_17f6,_17f7,on,touch,dnd,_17f8){
return _17f4("dojo.dnd.Mover",[_17f7],{constructor:function(node,e,host){
this.node=dom.byId(node);
this.marginBox={l:e.pageX,t:e.pageY};
this.mouseButton=e.button;
var h=(this.host=host),d=node.ownerDocument;
this.events=[on(d,touch.move,lang.hitch(this,"onFirstMove")),on(d,touch.move,lang.hitch(this,"onMouseMove")),on(d,touch.release,lang.hitch(this,"onMouseUp")),on(d,"dragstart",event.stop),on(d.body,"selectstart",event.stop)];
_17f8.autoScrollStart(d);
if(h&&h.onMoveStart){
h.onMoveStart(this);
}
},onMouseMove:function(e){
_17f8.autoScroll(e);
var m=this.marginBox;
this.host.onMove(this,{l:m.l+e.pageX,t:m.t+e.pageY},e);
event.stop(e);
},onMouseUp:function(e){
if(has("webkit")&&has("mac")&&this.mouseButton==2?e.button==0:this.mouseButton==e.button){
this.destroy();
}
event.stop(e);
},onFirstMove:function(e){
var s=this.node.style,l,t,h=this.host;
switch(s.position){
case "relative":
case "absolute":
l=Math.round(parseFloat(s.left))||0;
t=Math.round(parseFloat(s.top))||0;
break;
default:
s.position="absolute";
var m=_17f5.getMarginBox(this.node);
var b=win.doc.body;
var bs=_17f6.getComputedStyle(b);
var bm=_17f5.getMarginBox(b,bs);
var bc=_17f5.getContentBox(b,bs);
l=m.l-(bc.l-bm.l);
t=m.t-(bc.t-bm.t);
break;
}
this.marginBox.l=l-this.marginBox.l;
this.marginBox.t=t-this.marginBox.t;
if(h&&h.onFirstMove){
h.onFirstMove(this,e);
}
this.events.shift().remove();
},destroy:function(){
array.forEach(this.events,function(_17f9){
_17f9.remove();
});
var h=this.host;
if(h&&h.onMoveStop){
h.onMoveStop(this);
}
this.events=this.node=this.host=null;
}});
});
},"dojo/store/util/SimpleQueryEngine":function(){
define("dojo/store/util/SimpleQueryEngine",["../../_base/array"],function(_17fa){
return function(query,_17fb){
switch(typeof query){
default:
throw new Error("Can not query with a "+typeof query);
case "object":
case "undefined":
var _17fc=query;
query=function(_17fd){
for(var key in _17fc){
var _17fe=_17fc[key];
if(_17fe&&_17fe.test){
if(!_17fe.test(_17fd[key],_17fd)){
return false;
}
}else{
if(_17fe!=_17fd[key]){
return false;
}
}
}
return true;
};
break;
case "string":
if(!this[query]){
throw new Error("No filter function "+query+" was found in store");
}
query=this[query];
case "function":
}
function _17ff(array){
var _1800=_17fa.filter(array,query);
var _1801=_17fb&&_17fb.sort;
if(_1801){
_1800.sort(typeof _1801=="function"?_1801:function(a,b){
for(var sort,i=0;sort=_1801[i];i++){
var _1802=a[sort.attribute];
var _1803=b[sort.attribute];
if(_1802!=_1803){
return !!sort.descending==(_1802==null||_1802>_1803)?-1:1;
}
}
return 0;
});
}
if(_17fb&&(_17fb.start||_17fb.count)){
var total=_1800.length;
_1800=_1800.slice(_17fb.start||0,(_17fb.start||0)+(_17fb.count||Infinity));
_1800.total=total;
}
return _1800;
};
_17ff.matches=query;
return _17ff;
};
});
},"dijit/_HasDropDown":function(){
define("dijit/_HasDropDown",["dojo/_base/declare","dojo/_base/Deferred","dojo/_base/event","dojo/dom","dojo/dom-attr","dojo/dom-class","dojo/dom-geometry","dojo/dom-style","dojo/has","dojo/keys","dojo/_base/lang","dojo/on","dojo/window","./registry","./focus","./popup","./_FocusMixin"],function(_1804,_1805,event,dom,_1806,_1807,_1808,_1809,has,keys,lang,on,_180a,_180b,focus,popup,_180c){
return _1804("dijit._HasDropDown",_180c,{_buttonNode:null,_arrowWrapperNode:null,_popupStateNode:null,_aroundNode:null,dropDown:null,autoWidth:true,forceWidth:false,maxHeight:0,dropDownPosition:["below","above"],_stopClickEvents:true,_onDropDownMouseDown:function(e){
if(this.disabled||this.readOnly){
return;
}
e.preventDefault();
this._docHandler=this.connect(this.ownerDocument,"mouseup","_onDropDownMouseUp");
this.toggleDropDown();
},_onDropDownMouseUp:function(e){
if(e&&this._docHandler){
this.disconnect(this._docHandler);
}
var _180d=this.dropDown,_180e=false;
if(e&&this._opened){
var c=_1808.position(this._buttonNode,true);
if(!(e.pageX>=c.x&&e.pageX<=c.x+c.w)||!(e.pageY>=c.y&&e.pageY<=c.y+c.h)){
var t=e.target;
while(t&&!_180e){
if(_1807.contains(t,"dijitPopup")){
_180e=true;
}else{
t=t.parentNode;
}
}
if(_180e){
t=e.target;
if(_180d.onItemClick){
var _180f;
while(t&&!(_180f=_180b.byNode(t))){
t=t.parentNode;
}
if(_180f&&_180f.onClick&&_180f.getParent){
_180f.getParent().onItemClick(_180f,e);
}
}
return;
}
}
}
if(this._opened){
if(_180d.focus&&_180d.autoFocus!==false){
this._focusDropDownTimer=this.defer(function(){
_180d.focus();
delete this._focusDropDownTimer;
});
}
}else{
this.defer("focus");
}
if(has("ios")){
this._justGotMouseUp=true;
this.defer(function(){
this._justGotMouseUp=false;
});
}
},_onDropDownClick:function(e){
if(has("touch")&&!this._justGotMouseUp){
this._onDropDownMouseDown(e);
this._onDropDownMouseUp(e);
}
if(this._stopClickEvents){
event.stop(e);
}
},buildRendering:function(){
this.inherited(arguments);
this._buttonNode=this._buttonNode||this.focusNode||this.domNode;
this._popupStateNode=this._popupStateNode||this.focusNode||this._buttonNode;
var _1810={"after":this.isLeftToRight()?"Right":"Left","before":this.isLeftToRight()?"Left":"Right","above":"Up","below":"Down","left":"Left","right":"Right"}[this.dropDownPosition[0]]||this.dropDownPosition[0]||"Down";
_1807.add(this._arrowWrapperNode||this._buttonNode,"dijit"+_1810+"ArrowButton");
},postCreate:function(){
this.inherited(arguments);
this.own(on(this._buttonNode,"mousedown",lang.hitch(this,"_onDropDownMouseDown")),on(this._buttonNode,"click",lang.hitch(this,"_onDropDownClick")),on(this.focusNode,"keydown",lang.hitch(this,"_onKey")),on(this.focusNode,"keyup",lang.hitch(this,"_onKeyUp")));
},destroy:function(){
if(this.dropDown){
if(!this.dropDown._destroyed){
this.dropDown.destroyRecursive();
}
delete this.dropDown;
}
this.inherited(arguments);
},_onKey:function(e){
if(this.disabled||this.readOnly){
return;
}
var d=this.dropDown,_1811=e.target;
if(d&&this._opened&&d.handleKey){
if(d.handleKey(e)===false){
event.stop(e);
return;
}
}
if(d&&this._opened&&e.keyCode==keys.ESCAPE){
this.closeDropDown();
event.stop(e);
}else{
if(!this._opened&&(e.keyCode==keys.DOWN_ARROW||((e.keyCode==keys.ENTER||e.keyCode==dojo.keys.SPACE)&&((_1811.tagName||"").toLowerCase()!=="input"||(_1811.type&&_1811.type.toLowerCase()!=="text"))))){
this._toggleOnKeyUp=true;
event.stop(e);
}
}
},_onKeyUp:function(){
if(this._toggleOnKeyUp){
delete this._toggleOnKeyUp;
this.toggleDropDown();
var d=this.dropDown;
if(d&&d.focus){
this.defer(lang.hitch(d,"focus"),1);
}
}
},_onBlur:function(){
var _1812=focus.curNode&&this.dropDown&&dom.isDescendant(focus.curNode,this.dropDown.domNode);
this.closeDropDown(_1812);
this.inherited(arguments);
},isLoaded:function(){
return true;
},loadDropDown:function(_1813){
_1813();
},loadAndOpenDropDown:function(){
var d=new _1805(),_1814=lang.hitch(this,function(){
this.openDropDown();
d.resolve(this.dropDown);
});
if(!this.isLoaded()){
this.loadDropDown(_1814);
}else{
_1814();
}
return d;
},toggleDropDown:function(){
if(this.disabled||this.readOnly){
return;
}
if(!this._opened){
this.loadAndOpenDropDown();
}else{
this.closeDropDown();
}
},openDropDown:function(){
var _1815=this.dropDown,_1816=_1815.domNode,_1817=this._aroundNode||this.domNode,self=this;
if(!this._preparedNode){
this._preparedNode=true;
if(_1816.style.width){
this._explicitDDWidth=true;
}
if(_1816.style.height){
this._explicitDDHeight=true;
}
}
if(this.maxHeight||this.forceWidth||this.autoWidth){
var _1818={display:"",visibility:"hidden"};
if(!this._explicitDDWidth){
_1818.width="";
}
if(!this._explicitDDHeight){
_1818.height="";
}
_1809.set(_1816,_1818);
var _1819=this.maxHeight;
if(_1819==-1){
var _181a=_180a.getBox(this.ownerDocument),_181b=_1808.position(_1817,false);
_1819=Math.floor(Math.max(_181b.y,_181a.h-(_181b.y+_181b.h)));
}
popup.moveOffScreen(_1815);
if(_1815.startup&&!_1815._started){
_1815.startup();
}
var mb=_1808.getMarginSize(_1816);
var _181c=(_1819&&mb.h>_1819);
_1809.set(_1816,{overflowX:"visible",overflowY:_181c?"auto":"visible"});
if(_181c){
mb.h=_1819;
if("w" in mb){
mb.w+=16;
}
}else{
delete mb.h;
}
if(this.forceWidth){
mb.w=_1817.offsetWidth;
}else{
if(this.autoWidth){
mb.w=Math.max(mb.w,_1817.offsetWidth);
}else{
delete mb.w;
}
}
if(lang.isFunction(_1815.resize)){
_1815.resize(mb);
}else{
_1808.setMarginBox(_1816,mb);
}
}
var _181d=popup.open({parent:this,popup:_1815,around:_1817,orient:this.dropDownPosition,onExecute:function(){
self.closeDropDown(true);
},onCancel:function(){
self.closeDropDown(true);
},onClose:function(){
_1806.set(self._popupStateNode,"popupActive",false);
_1807.remove(self._popupStateNode,"dijitHasDropDownOpen");
self._set("_opened",false);
}});
_1806.set(this._popupStateNode,"popupActive","true");
_1807.add(this._popupStateNode,"dijitHasDropDownOpen");
this._set("_opened",true);
this.domNode.setAttribute("aria-expanded","true");
return _181d;
},closeDropDown:function(focus){
if(this._focusDropDownTimer){
this._focusDropDownTimer.remove();
delete this._focusDropDownTimer;
}
if(this._opened){
this.domNode.setAttribute("aria-expanded","false");
if(focus){
this.focus();
}
popup.close(this.dropDown);
this._opened=false;
}
}});
});
},"url:davinci/ui/widgets/templates/OpenFile.html":"<div class=\"fileDialog\">\n\t<div class=\"dijitDialogPaneContentArea folderContainer\">\n\t\t<div dojoType=\"dijit.layout.ContentPane\" dojoAttachPoint=\"contentpane\">\n\t\t<div class=\"fileDialogTreeWidget\" dojoAttachPoint=\"fileTree\" dojoType=\"dijit.Tree\" model=\"system.resource\" persist=\"false\" labelAttr=\"name\" childrenAttrs=\"children\" dojoAttachEvent=\"onDblClick:_onDblClick,onKeyPress:_onKeyPress\"></div>\n\t\t</div>\n\t</div>\n\t\n\t<div class=\"dijitDialogPaneActionBar\">\n\t\t<button dojoType=\"dijit.form.Button\" dojoAttachEvent=\"onClick:_okButton\" class=\"maqPrimaryButton\" type=\"submit\">${finishButtonLabel}</button>\n\t\t<button dojoType=\"dijit.form.Button\" dojoAttachEvent=\"onClick:_cancelButton\" class=\"maqSecondaryButton\">${cancelButtonLabel}</button>\n\t</div>\n</div>\n","davinci/ve/widgets/ColorStore":function(){
define(["dojo/_base/declare","dojo/data/ItemFileReadStore","dojo/i18n!davinci/ve/nls/ve","dojo/i18n!dijit/nls/common"],function(_181e,_181f){
return _181e("davinci.ve.widgets.ColorStore",_181f,{constructor:function(args){
this.clearValues();
if(args.noncolors){
this.noncolors=args.noncolors;
}
if(args.values){
this.setValues(args.values);
}
},setValues:function(_1820){
var items=[];
var _1821=0;
if(_1820){
this._values=_1820;
}
dojo.forEach(this._values,dojo.hitch(this,function(v){
var found=false;
for(var i=0;!found&&i<this.noncolors.length;i++){
if(this.noncolors[i]==v){
found=true;
}
}
if(found){
items.push({name:v,value:v,label:v});
}else{
items.push({value:v,name:v,label:"<table><tr><td style='width:10em'>"+v+"</td><td style='width:10px;height:10px;background-color:"+v+"'></td></tr></table>"});
}
}));
this._jsonData={identifier:"value",items:items};
this._loadFinished=false;
},insert:function(_1822,value){
this._values.splice(_1822,0,value);
this.setValues();
},contains:function(item){
for(var i=0;i<this._values.length;i++){
if(this._values[i]==item){
return true;
}
}
return false;
},getItemNumber:function(index){
return this._values[index];
},clearValues:function(){
this._loadFinished=false;
}});
});
},"dojox/grid/DataSelection":function(){
define("dojox/grid/DataSelection",["dojo/_base/declare","./_SelectionPreserver","./Selection"],function(_1823,_1824,_1825){
return _1823("dojox.grid.DataSelection",_1825,{constructor:function(grid){
if(grid.keepSelection){
this.preserver=new _1824(this);
}
},destroy:function(){
if(this.preserver){
this.preserver.destroy();
}
},getFirstSelected:function(){
var idx=_1825.prototype.getFirstSelected.call(this);
if(idx==-1){
return null;
}
return this.grid.getItem(idx);
},getNextSelected:function(_1826){
var _1827=this.grid.getItemIndex(_1826);
var idx=_1825.prototype.getNextSelected.call(this,_1827);
if(idx==-1){
return null;
}
return this.grid.getItem(idx);
},getSelected:function(){
var _1828=[];
for(var i=0,l=this.selected.length;i<l;i++){
if(this.selected[i]){
_1828.push(this.grid.getItem(i));
}
}
return _1828;
},addToSelection:function(_1829){
if(this.mode=="none"){
return;
}
var idx=null;
if(typeof _1829=="number"||typeof _1829=="string"){
idx=_1829;
}else{
idx=this.grid.getItemIndex(_1829);
}
_1825.prototype.addToSelection.call(this,idx);
},deselect:function(_182a){
if(this.mode=="none"){
return;
}
var idx=null;
if(typeof _182a=="number"||typeof _182a=="string"){
idx=_182a;
}else{
idx=this.grid.getItemIndex(_182a);
}
_1825.prototype.deselect.call(this,idx);
},deselectAll:function(_182b){
var idx=null;
if(_182b||typeof _182b=="number"){
if(typeof _182b=="number"||typeof _182b=="string"){
idx=_182b;
}else{
idx=this.grid.getItemIndex(_182b);
}
_1825.prototype.deselectAll.call(this,idx);
}else{
this.inherited(arguments);
}
}});
});
},"davinci/ve/HTMLWidget":function(){
define(["dojo/_base/declare","./_Widget"],function(_182c,_182d){
return _182c("davinci.ve.HTMLWidget",_182d,{isHtmlWidget:true,constructor:function(_182e,node){
this.type="html."+node.tagName.toLowerCase();
this.acceptsHTMLChildren=true;
},buildRendering:function(){
this.containerNode=this.domNode;
if(this._params){
for(var name in this._params){
this.domNode.setAttribute(name,this._params[name]);
}
this._params=undefined;
}
try{
dojo.addClass(this.domNode,"HtmlWidget");
}
catch(e){
}
},_getChildrenData:function(_182f){
function _1830(node){
var d=node.nodeValue.trim();
if(d){
d=davinci.html.escapeXml(d);
}
return d;
};
var _1831=this.domNode;
if(!_1831.hasChildNodes()){
return null;
}
if(_1831.childNodes.length===1&&_1831.firstChild.nodeType===3){
return _1830(_1831.firstChild);
}
var data=[];
dojo.forEach(_1831.childNodes,function(node){
var d;
switch(node.nodeType){
case 1:
var w=require("davinci/ve/widget").byNode(node);
if(w){
d=w.getData(_182f);
}
break;
case 3:
d=_1830(node);
break;
case 8:
d="<!--"+node.nodeValue+"-->";
break;
}
if(d){
data.push(d);
}
});
return data;
},setProperties:function(_1832,_1833){
var node=this.domNode;
_1833=_1833||false;
for(var name in _1832){
if(name==="style"){
dojo.style(node,_1832[name]);
}else{
if(!_1833){
var _1834=_1832[name];
if(_1834||typeof _1834=="boolean"||typeof _1834=="number"){
node.setAttribute(name,_1834);
}else{
node.removeAttribute(name);
}
}
}
}
this.inherited(arguments);
},resize:function(){
this.getChildren().forEach(function(_1835){
if(_1835.resize){
_1835.resize();
}
});
},_attr:function(name,value){
if(arguments.length>1){
this.domNode[name]=value;
}else{
return this.domNode[name];
}
},getTagName:function(){
return this.domNode.nodeName.toLowerCase();
}});
});
},"davinci/workbench/Preferences":function(){
define(["dojo/_base/declare","dojo/_base/xhr","../Runtime","dijit/_WidgetBase","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","davinci/ui/Dialog","dijit/Tree","dijit/tree/ForestStoreModel","dojo/data/ItemFileReadStore","dojo/i18n!./nls/workbench","dojo/i18n!dijit/nls/common","dojo/text!./templates/Preferences.html","dijit/form/Button"],function(_1836,xhr,_1837,_1838,_1839,_183a,_183b,Tree,_183c,_183d,_183e,_183f,_1840){
var _1841=_1836([_1838,_1839,_183a],{templateString:_1840,commonStrings:_183f,resize:function(){
this.borderContainer.resize();
}});
var _1842={_allPrefs:{},savePreferences:function(id,base,_1843){
xhr.put({url:"cmd/setPreferences?id="+id+"&base="+encodeURIComponent(base),putData:dojo.toJson(_1843),handleAs:"json",contentType:"text/html"}).then(function(){
if(!_1842._allPrefs[base]){
_1842._allPrefs[base]={};
}
_1842._allPrefs[base][id]=_1843;
dojo.publish("/davinci/preferencesChanged",[{id:id,preferences:_1843}]);
});
},_loadExtensions:function(){
if(!_1842._extensions){
_1842._extensions=_1837.getExtensions("davinci.preferences");
}
},showPreferencePage:function(){
_1842._loadExtensions();
var _1844=_1842.getPrefJson();
if(!_1844||_1844.length<1){
alert(_183e.noUserPref);
return;
}
this.dialog=_183b.showModal(new _1841({}),_183e.preferences,{width:700,height:500});
var _1845=new _183d({data:_1844,jsId:"prefTreeDataStore"});
var _1846=new _183c({jsId:"fileModel",labelAttr:"name",store:_1845});
var _1847=dijit.byId("prefTree");
if(!_1847){
_1847=new Tree({model:_1846,id:"prefTree",persist:false,query:"{type:'directory'}",label:"Preferences",labelAttr:"name",showRoot:false,childrenAttrs:"children"});
}
_1847.onClick=function(node){
_1842.setPaneContent(node);
};
dojo.byId("pref.TreePane").appendChild(_1847.domNode);
_1847.startup();
},getPrefJson:function(){
var ejson=_1842._extensions;
if(ejson==null){
return [];
}
var _1848=[];
for(var i=0;i<ejson.length;i++){
ejson[i]._index=i;
if(ejson[i].category){
if(!_1848[ejson[i].category]){
_1848[ejson[i].category]=[];
}
_1848[ejson[i].category].push(ejson[i]);
}else{
if(!_1848.root){
_1848.root=[];
}
_1848.root.push(ejson[i]);
}
}
var _1849=_1848.root.map(function(node){
return {id:node.id,name:node.name,index:node._index,children:_1842._getPrefJsonChildren(node.id,_1848)};
});
return {items:_1849};
},_getPrefJsonChildren:function(catId,_184a){
var _184b=_184a[catId];
if(!_184b){
return [];
}
var _184c=[];
for(var p=0;p<_184b.length;p++){
_184c[p]={id:_184b[p].id,name:_184b[p].name,index:_184b[p]._index};
if(_184a[_184b[p].id]){
_184c[p].children=_1842._getPrefJsonChildren(_184b[p].id,_184a);
}
}
return _184c;
},setPaneContent:function(node){
var _184d;
delete _1842._currentPane;
var _184e=_1842._extensions[node.index[0]];
var prefs=_1842.getPreferences(_184e.id,davinci.Workbench.getProject());
if(_184e.pane){
require([_184e.pane],function(cls){
var pane=new cls();
_1842._currentPane=pane;
_1842._currentPane._extension=_184e;
_1842._currentPane.setPreferences(prefs);
dijit.byId("pref.RightPane").setContent(pane.domNode);
});
}else{
if(_184e.pageContent){
_184d=document.createTextNode(_184e.pageContent);
}else{
_184d=document.createTextNode("");
}
}
if(_184d){
dijit.byId("pref.RightPane").setContent(_184d);
}
},_save:function(_184f){
if(_1842._currentPane){
var prefs=_1842._currentPane.getPreferences();
var id=_1842._currentPane._extension.id;
var base=davinci.Workbench.getProject();
_1842.savePreferences(id,base,prefs);
if(_1842._currentPane.save){
_1842._currentPane.save(prefs);
}
}
for(var i=0;i<_184f.length;i++){
try{
if(_184f[i].save){
_184f[i].save();
}
}
catch(ex){
}
if(_184f[i].children&&_184f[i].children.length>0){
_1842._save(_184f[i].children);
}
}
},save:function(){
_1842._save(_1842._extensions);
_1842.finish();
},finish:function(){
_1842._extensions=null;
_1842._currentPane=null;
this.dialog.destroyRecursive(false);
this.dialog=null;
},getPreferences:function(id,base){
if(!_1842._allPrefs[base]){
_1842._allPrefs[base]={};
}
if(!_1842._allPrefs[base][id]){
var prefs=_1837.serverJSONRequest({url:"cmd/getPreferences",handleAs:"json",content:{id:id,base:base},sync:true});
if(!prefs){
prefs=_1842.getDefaultPreferences(id);
}
_1842._allPrefs[base][id]=prefs;
}
return _1842._allPrefs[base][id];
},getDefaultPreferences:function(id){
_1842._loadExtensions();
for(var i=0;i<_1842._extensions.length;i++){
if(_1842._extensions[i].id==id){
if(dojo.isString(_1842._extensions[i].defaultValues)){
var prefs=_1837.serverJSONRequest({url:_1842._extensions[i].defaultValues,handleAs:"json",sync:true});
return prefs.defaultValues;
}
return _1842._extensions[i].defaultValues;
}
}
}};
return dojo.setObject("davinci.workbench.Preferences",_1842);
});
},"davinci/ve/widgets/ColorPickerFlat":function(){
define(["dojo/_base/declare","dijit/_Widget","dijit/TooltipDialog","dijit/form/Button","dojox/widget/ColorPicker","dojo/i18n!davinci/ve/nls/ve","dojo/i18n!dijit/nls/common"],function(_1850,_1851,_1852,_1853,_1854,veNLS,_1855){
var _1856=_1850("davinci.ve.widgets.ColorPickerFlat",[_1851],{numberDelta:1,insertPosition:1,data:null,postCreate:function(){
this.inherited(arguments);
var top=dojo.doc.createElement("div");
this._colorPicker=new _1854({});
top.appendChild(this._colorPicker.domNode);
var bd=dojo.doc.createElement("div");
var _1857=_1855;
var _1858=_1853({label:_1857.buttonOk});
_1858.innerHtml="OK";
bd.appendChild(_1858.domNode);
var _1859=_1853({label:_1857.buttonCancel});
bd.appendChild(_1859.domNode);
top.appendChild(bd);
this.domNode.appendChild(top);
dojo.connect(_1858,"onClick",this,"_onOk");
dojo.connect(_1859,"onClick",this,"onCancel");
delete this.canceled;
},onClose:function(){
},onCancel:function(){
this._value=null;
this.canceled=true;
},_onOk:function(){
delete this.canceled;
this._value=this._colorPicker.get("value");
this.onClose();
},_getValueAttr:function(){
return this._value;
},_setValueAttr:function(value){
var color=new dojo.Color(value);
this._colorPicker.setColor(color.toHex());
}});
return dojo.mixin(_1856,{show:function(_185a,_185b,_185c,_185d){
var _185e=veNLS;
var _185f=new _1852({title:_185e.selectColor,content:_185a});
dijit.popup.moveOffScreen(_185f.domNode);
var _1860=false;
var _1861=function(_1862){
return function(){
if(_1860){
_1860=false;
dijit.popup.close(_185f);
}
};
}();
_185f.connect(_185a,"onCancel",_1861);
_185f.connect(_185a,"onClose",_1861);
var _1863=dijit.byNode(dojo.query("[widgetId]",_185f.domNode)[0]);
var popup=function(_1864){
return function(){
dijit.popup.open({parent:_185c,popup:_185f,around:_185c.domNode,orient:_185d?{"BL":"TL","BR":"TR","TL":"BL","TR":"BR"}:{"BR":"TR","BL":"TL","TR":"BR","TL":"BL"},onClose:function(){
if(!_1863.canceled){
if(_185c._colorPickerFlat_comboBoxUpdateDueTo){
_185c._comboBoxUpdateDueTo=_185c._colorPickerFlat_comboBoxUpdateDueTo;
}
var _1865=_185c.get("value");
_185c.set("value",_1863.get("value"));
}
_1861();
}});
_1860=true;
dijit.focus(_185f.containerNode);
};
};
if(_185b in dojo.Color.named){
var value=dojo.colorFromString(_185b);
_185a.set("value",value.toHex());
}else{
_185a.set("value",_185b||"",true);
}
popup()();
}});
});
},"davinci/ve/actions/RotateDeviceAction":function(){
define("davinci/ve/actions/RotateDeviceAction",["dojo/_base/declare","davinci/Workbench","davinci/actions/Action"],function(_1866,_1867,_1868){
return _1866("davinci.ve.actions.RotateDeviceAction",[_1868],{run:function(_1869){
var e=davinci.Workbench.getOpenEditor();
var _186a=e.getContext();
_186a.visualEditor.toggleOrientation();
},isEnabled:function(_186b){
var e=davinci.Workbench.getOpenEditor();
if(e&&e.getContext){
var _186c=e.getContext();
if(_186c.getMobileDevice){
var _186d=_186c.getMobileDevice();
return (_186d&&_186d!=""&&_186d!="none"&&_186d!="desktop");
}else{
return false;
}
}else{
return false;
}
},updateStyling:function(){
var _186e=false;
var _186f=davinci.Workbench.getOpenEditor();
if(_186f){
var _1870=_186f.visualEditor;
if(_1870&&_1870.getOrientation){
var _1871=_1870.getOrientation();
_186e=(_1871=="landscape");
}
}
var _1872="orientationLandscape";
if(_186e){
dojo.addClass(document.body,_1872);
}else{
dojo.removeClass(document.body,_1872);
}
}});
});
},"davinci/html/html.plugin":function(){
define("davinci/html/html.plugin",["require"],function(_1873){
return {id:"davinci.html","davinci.editor":[{id:"HTMLEditor",name:"HTML Editor",extensions:"html",isDefault:false,editorClass:"davinci/html/ui/HTMLEditor",palettePerspective:"davinci.html.htmlEditor",expandPalettes:["left"]},{id:"CSSEditor",name:"CSS Editor",extensions:"css",isDefault:true,editorClass:"davinci/html/ui/CSSEditor",palettePerspective:"davinci.html.htmlEditor",expandPalettes:["left"]},{id:"ImageViewer",name:"Image Viewer",extensions:"jpg,gif,jpeg,png",isDefault:true,editorClass:"davinci/html/ui/ImageViewer",palettePerspective:"davinci.html.htmlEditor",expandPalettes:["left"]}],"davinci.editorActions":{editorContribution:{targetID:"davinci.html.CSSEditor",actions:[{id:"savecombo",className:"maqLabelButton",showLabel:true,label:"Save",toolbarPath:"save",type:"ComboButton",run:function(){
_1873(["../Workbench"],function(_1874){
_1873("../ui/Resource").save();
});
},isEnabled:function(_1875){
return _1873("../Workbench").getOpenEditor();
},menu:[{iconClass:"saveIcon",run:function(){
_1873("../ui/Resource").save();
},isEnabled:function(_1876){
return _1873("../Workbench").getOpenEditor();
},label:"Save",keyBinding:{accel:true,charOrCode:"s",allowGlobal:true}},{iconClass:"saveAsIcon",run:function(){
_1873("../ui/Resource").saveAs("html");
},isEnabled:function(_1877){
return _1873("../Workbench").getOpenEditor();
},label:"Save As",keyBinding:{accel:true,shift:true,charOrCode:"s",allowGlobal:true}}]}]}},"davinci.preferences":[{name:"HTML",id:"general",category:"",pageContent:"HTML preferences content here"}],"davinci.fileType":[{extension:"html",iconClass:"htmlFileIcon",type:"text"},{extension:"css",iconClass:"cssFileIcon",type:"text"},{extension:"jpeg",iconClass:"imageFileIcon",type:"image"},{extension:"jpg",iconClass:"imageFileIcon",type:"image"},{extension:"png",iconClass:"imageFileIcon",type:"image"},{extension:"gif",iconClass:"imageFileIcon",type:"image"}],"davinci.perspective":[{id:"htmlEditor",title:"HTML Editor",views:[{viewID:"davinci.ve.Palette",position:"left",hidden:true},{viewID:"davinci.ui.outline",position:"left",hidden:true},{viewID:"davinci.ve.style",position:"right"},{viewID:"davinci.ui.comment",position:"right",hidden:true},{viewID:"davinci.ve.states",position:"right-bottom",hidden:true},{viewID:"davinci.ui.navigator",position:"left-bottom",selected:true},{viewID:"davinci.review.reviewNavigator",position:"left"}]}]};
});
},"davinci/html/HTMLElement":function(){
define(["dojo/_base/declare","davinci/html/HTMLItem","davinci/html/HTMLText","davinci/html/HTMLComment","davinci/html/HTMLAttribute"],function(_1878,_1879,_187a,_187b,_187c){
return _1878("davinci.html.HTMLElement",_1879,{constructor:function(tag){
this.elementType="HTMLElement";
this.attributes=[];
this.tag=tag||"";
this._fmChildLine=0;
this._fmChildIndent=0;
},add:function(stmt){
if(!this.statements){
this.statements=[];
}
this.statements.push(stmt);
this.onChange();
},getText:function(_187d){
_187d=_187d||{};
var s="";
var _187e;
_187d.indent+=2;
s=s+"<"+this.tag;
for(var i=0;i<this.attributes.length;i++){
var _187f=this.attributes[i].getText(_187d);
if(_187f.length>0){
s=s+" "+_187f;
}
}
if(this.noEndTag){
s=s+"/>";
}else{
s=s+">";
s=s+this._addWS(this._fmChildLine,this._fmChildIndent);
if(this.statements){
for(var i=0;i<this.statements.length;i++){
s=s+this.statements[i].printStatement(_187d,this.statements[i]);
}
}else{
if(this.script){
s=s+this.script;
}else{
if(this.children.length>0){
var _1880=this.tag=="style";
for(var i=0;i<this.children.length;i++){
s=s+this.children[i].getText(_187d);
if(_1880){
var lines=this._fmChildLine,_1881=this._fmChildIndent||0;
if(i+1==this.children.length){
lines=this._fmLine;
_1881=this._fmIndent;
}
s=s+this._addWS(lines,_1881);
}
}
}
}
}
if(_187e&&this.children.length>0){
s=s+"\n"+"                                          ".substring(0,_187d.indent+1);
}
s=s+"</"+this.tag+">";
}
_187d.indent-=2;
s=s+this._addWS(this._fmLine,this._fmIndent);
return s;
},_formatModel:function(_1882,index,_1883){
var _1884=0;
var _1885=1;
if(index==undefined){
index=this.children.length;
}
function _1886(_1887,_1888,elem){
_1884+=(_1885+_1887);
if(_1888){
_1888._fmChildLine=1;
_1888._fmChildIndent=_1883.indent;
}else{
elem._fmLine=1;
elem._fmIndent=_1883.indent;
}
};
function _1889(elem,_188a){
elem.startOffset=_1884;
elem.wasParsed=true;
_1884+=elem.tag.length+2;
for(var i=0;i<elem.attributes.length;i++){
elem.attributes[i].startOffset=_1884;
var _188b=elem.attributes[i].getText(_188a);
if(_188b.length>0){
_1884+=1+_188b.length;
}
elem.attributes[i].endOffset=_1884-1;
}
if(elem.noEndTag){
_1884++;
}
elem.startTagOffset=_1884;
var s="";
if(elem.statements){
for(var i=0;i<elem.statements.length;i++){
s=s+elem.statements[i].printStatement(_188a,elem.statements[i]);
}
}else{
if(elem.script){
s=elem.script;
}
}
if(s){
_1884+=s.length;
}else{
if(elem.children.length>0){
var _188c;
if(!davinci.html._noFormatElements[elem.tag]){
_188a.indent+=2;
_1886(_188a.indent,elem);
_188c=true;
}
var _188d;
for(var i=0;i<elem.children.length;i++){
var child=elem.children[i];
switch(child.elementType){
case "HTMLElement":
if(_188d&&_188d.elementType!="HTMLText"&&!davinci.html._noFormatElements[child.tag]){
_1886(_188a.indent,null,_188d);
}
_1889(child,_188a);
break;
case "HTMLText":
child.startOffset=_1884;
_1884+=child.value.length;
break;
case "HTMLComment":
child.startOffset=_1884;
_1884+=child.value.length;
_1884++;
if(child.isProcessingInstruction){
_1884+=2;
}
break;
default:
debugger;
}
_188d=child;
}
if(_188c){
_188a.indent-=2;
}
if(_188d&&_188d.elementType!="HTMLText"){
_1886(_188a.indent,null,_188d);
}
}
}
_1884+=elem.tag.length+3;
elem.endOffset=_1884-1;
};
var elem1,elem2;
if(!this.children.length||index==0){
elem1=this;
_1884=this.startTagOffset+1;
}else{
elem2=this.children[index-1];
_1884=elem2.endOffset+1;
}
var _188e=_1884;
if(!davinci.html._noFormatElements[_1882.tag]){
_1886(_1883.indent,elem1,elem2);
_1882._fmLine=1;
_1882._fmIndent=(index<this.children.length)?_1883.indent:_1883.indent-2;
}
_1889(_1882,_1883);
return (_1884>_188e)?_1884-_188e:0;
},getElementText:function(_188f){
_188f=_188f||{};
var s="";
if(this.children.length>0){
for(var i=0;i<this.children.length;i++){
if(this.children[i].elementType!="HTMLComment"){
s=s+this.children[i].getText(_188f);
}
}
}else{
if(this.script){
return this.script;
}else{
if(this.statements){
for(var i=0;i<this.statements.length;i++){
s=s+this.statements[i].printStatement(_188f,this.statements[i]);
}
}
}
}
return s;
},getChildElements:function(_1890,_1891,_1892){
_1892=_1892||[];
for(var i=0;i<this.children.length;i++){
if(this.children[i].tag==_1890){
_1892.push(this.children[i]);
}
if(_1891&&this.children[i].elementType=="HTMLElement"){
this.children[i].getChildElements(_1890,_1891,_1892);
}
}
return _1892;
},getChildElement:function(_1893){
for(var i=0;i<this.children.length;i++){
if(this.children[i].tag==_1893){
return this.children[i];
}
}
},hasAttribute:function(name){
for(var i=0;i<this.attributes.length;i++){
if(this.attributes[i].name==name){
return true;
}
}
return false;
},getAttribute:function(name){
var attr=this._getAttribute(name);
if(attr){
return attr.value;
}
},_getAttribute:function(name){
for(var i=0;i<this.attributes.length;i++){
if(this.attributes[i].name==name){
return this.attributes[i];
}
}
},addText:function(text){
this.addChild(new _187a(text));
this.onChange();
},addComment:function(text){
this.addChild(new _187b(text));
this.onChange();
},getLabel:function(){
return "<"+this.tag+">";
},addAttribute:function(name,value,_1894){
if(name=="textContent"){
this.children=[];
this.addText(value);
return;
}
var delta;
var _1895=(this.attributes.length>0)?this.attributes[this.attributes.length-1].endOffset+1:this.startTagOffset-(this.noEndTag?2:1);
var attr=this._getAttribute(name);
var add;
if(!attr){
attr=new _187c();
add=true;
delta=name.length+value.length+4;
attr.startOffset=_1895;
attr.endOffset=_1895+delta-1;
}else{
delta=value.length-attr.value.length;
}
attr.name=name;
attr.setValue(value);
attr.noPersist=_1894;
if(this.wasParsed&&!_1894&&delta>0){
this.getHTMLFile().updatePositions(_1895,delta);
}
if(add){
this.attributes.push(attr);
}
this.onChange();
},removeAttribute:function(name){
this.attributes.every(function(attr,idx,arr){
if(attr.name===name){
arr.splice(idx,1);
var file=this.getHTMLFile();
if(!attr.noPersist&&file){
var s=attr.getText();
file.updatePositions(attr.startOffest,0-(s.length+1));
}
return false;
}
return true;
},this);
this.onChange();
},setAttribute:function(name,value){
this.removeAttribute(name);
this.addAttribute(name,value);
},getUniqueID:function(_1896){
var attr=this.getAttribute("id");
if(!attr){
var file=this.getHTMLFile();
if(!file.uniqueIDs){
file.uniqueIDs={};
}
var id;
if(!file.uniqueIDs.hasOwnProperty(this.tag)){
id=file.uniqueIDs[this.tag]=0;
}else{
id=++file.uniqueIDs[this.tag];
}
this.addAttribute("id",this.tag+"_"+id,_1896);
}
},findElement:function(id){
var attr=this.getAttribute("id");
if(id==attr){
return this;
}
for(var i=0;i<this.children.length;i++){
if(this.children[i].elementType=="HTMLElement"){
var found=this.children[i].findElement(id);
if(found){
return found;
}
}
}
},insertBefore:function(_1897,_1898){
var index=dojo.indexOf(this.children,_1898);
if(index<0){
index=undefined;
}
this.addChild(_1897,index);
this.onChange();
},addChild:function(_1899,index,_189a){
if(!_189a&&this.wasParsed){
if(_1899.elementType=="HTMLElement"){
var _189b=this._getIndent();
var _189c;
if(index<this.children.length&&this.children[index].elementType=="HTMLElement"){
_189c=this.children[index]._getIndent();
}else{
if(this.children.length){
dojo.forEach(this.children,function(_189d){
if(_189d.elementType=="HTMLElement"){
_189c=_189d._getIndent();
}
});
}else{
_189c=_189b+1;
}
}
var _189e=_189c;
var _189f={indent:_189e};
var delta=this._formatModel(_1899,index,_189f);
this.getHTMLFile().updatePositions(_1899.startOffset,delta);
}else{
if(_1899.elementType=="HTMLText"||_1899.elementType.substring(0,3)=="CSS"){
var s=_1899.getText();
var _18a0=this.children.length?this.children[this.children.length-1].endOffset:this.startTagOffset;
var len=s.length;
if(len>0){
if(_1899.elementType!="HTMLText"){
len+=this._fmChildIndent+1;
}
this.getHTMLFile().updatePositions(_18a0+1,len);
}
_1899.startOffset=_18a0+1;
_1899.endOffset=_1899.startOffset+s.length-1;
}
}
}
_1879.prototype.addChild.apply(this,arguments);
},removeChild:function(child){
var index=dojo.indexOf(this.children,child);
var _18a1=1;
if(index>=0){
var delta=1+child.endOffset-child.startOffset;
if(child.elementType=="HTMLElement"){
if(this.children.length==1){
delta+=this._fmChildLine*_18a1+this._fmChildIndent;
this._fmChildIndent-=2;
}else{
if(index>0&&this.children[index-1].elementType=="HTMLElement"){
var _18a2=this.children[index-1];
delta+=_18a2._fmLine*_18a1+_18a2._fmIndent;
}
if(index+1==this.children.length&&this.children[index-1].elementType=="HTMLElement"){
this.children[index-1]._fmChildIndent-=2;
}
}
}
if(delta>0&&this.wasParsed){
this.getHTMLFile().updatePositions(child.startOffset,0-delta);
}
}
_1879.prototype.removeChild.apply(this,arguments);
},_textModify:function(_18a3,_18a4){
var delta=_18a3.length-_18a4.length;
if(delta!=0&&this.wasParsed){
this.getHTMLFile().updatePositions(this.startOffset,delta);
}
},setScript:function(_18a5){
this._textModify(_18a5,this.script);
this.script=_18a5;
},_previous:function(){
var inx=dojo.indexOf(this.parent.children,this);
if(inx>0){
return this.parent.children[inx-1];
}
},_getIndent:function(){
var prev=this._previous();
if(prev){
if(prev.elementType==" HTMLText"){
var txt=prev.value.split("\n");
return txt[txt.length-1].length;
}else{
return prev._fmIndent;
}
}else{
return this.parent._fmChildIndent;
}
},visit:function(_18a6){
if(!_18a6.visit(this)){
for(var i=0;i<this.attributes.length;i++){
this.attributes[i].visit(_18a6);
}
for(var i=0;i<this.children.length;i++){
this.children[i].visit(_18a6);
}
}
if(_18a6.endVisit){
_18a6.endVisit(this);
}
},setText:function(text){
this.script="";
var _18a7={xmode:"outer"};
var _18a8=this.parent;
var _18a9=require("davinci/html/HTMLParser").parse(text,this);
this.errors=_18a9.errors;
dojo.mixin(this,this.children[0]);
this.parent=_18a8;
this.visit({visit:function(node){
delete node.wasParsed;
},rules:[]});
this.onChange();
}});
});
},"davinci/ve/actions/PasteAction":function(){
define(["dojo/_base/declare","davinci/Workbench","davinci/ve/actions/ContextAction","davinci/ve/tools/PasteTool"],function(_18aa,_18ab,_18ac,_18ad){
return _18aa("davinci.ve.actions.PasteAction",[_18ac],{shortcut:{keyCode:86,ctrlKey:true},run:function(_18ae){
_18ae=this.fixupContext(_18ae);
if(_18ae){
if(_18ae.declaredClass=="davinci.ve.PageEditor"&&_18ae._displayMode=="source"){
_18ae.htmlEditor.pasteAction.run();
return;
}
var data=davinci.Runtime.clipboard;
if(data){
_18ae.setActiveTool(new _18ad(data));
}
}
},isEnabled:function(_18af){
_18af=this.fixupContext(_18af);
var e=_18ab.getOpenEditor();
if(e&&_18af){
if(e.declaredClass=="davinci.ve.PageEditor"){
var _18b0=e.getDisplayMode();
return davinci.Runtime.clipboard&&_18b0!="source";
}else{
return davinci.Runtime.clipboard;
}
}else{
return false;
}
},shouldShow:function(_18b1){
_18b1=this.fixupContext(_18b1);
var _18b2=_18b1?_18b1.editor:null;
return (_18b2&&_18b2.declaredClass=="davinci.ve.PageEditor");
}});
});
},"davinci/Workbench":function(){
define("davinci/Workbench",["dojo/_base/lang","require","./Runtime","./model/Path","./workbench/ViewPart","./workbench/EditorContainer","./ui/Dialog","dijit/Toolbar","dijit/ToolbarSeparator","dijit/Menu","dijit/MenuBar","dijit/MenuItem","dijit/MenuSeparator","dijit/PopupMenuBarItem","dijit/form/Button","dijit/form/DropDownButton","dijit/form/ComboButton","dijit/form/ToggleButton","dijit/layout/BorderContainer","dijit/layout/StackController","dijit/layout/StackContainer","dijit/layout/ContentPane","dijit/layout/TabController","dijit/layout/TabContainer","system/resource","dojo/i18n!./nls/webContent","./ve/metadata","dojo/Deferred","dojo/promise/all","dojo/_base/declare","dojo/_base/connect","dojo/_base/xhr","./review/model/resource/root","dojo/i18n!./ve/nls/common","dojo/dnd/Mover","./ve/utils/GeomUtils","dojo/i18n!./workbench/nls/workbench"],function(lang,_18b3,_18b4,Path,_18b5,_18b6,_18b7,_18b8,_18b9,Menu,_18ba,_18bb,_18bc,_18bd,_18be,_18bf,_18c0,_18c1,_18c2,_18c3,_18c4,_18c5,_18c6,_18c7,_18c8,_18c9,_18ca,_18cb,all,_18cc,_18cd,xhr,_18ce,veNLS,Mover,_18cf,_18d0){
var _18d1=71;
var _18d2=20;
var _18d3={};
Function.prototype.bind=Function.prototype.bind||function(that){
return dojo.hitch(that,this);
};
var _18d4=function(_18d5){
return "editor-"+encodeURIComponent(_18d5.replace(/[\/| |\t]/g,"_")).replace(/%/g,":");
};
var _18d6=function(_18d7){
return _18d7.replace(/^editor/,"shadow");
};
var _18d8=function(_18d9){
return _18d9.replace(/^shadow/,"editor");
};
var _18da=function(_18db,_18dc){
console.warn("Workbench::handleIoError reason="+_18dc);
if(_18dc.status==401||_18dc.status==403){
console.warn("Workbench::handleIoError sessionTimedOut");
_18dd();
}else{
if(_18db.canceled===true){
console.warn("Workbench::handleIoError deferred.canceled");
var _18de=new RegExp("(^|\\.\\/|"+document.baseURI+"\\/)cmd\\/");
var url=_18db.ioArgs.url;
if(_18de.test(url)){
if(url.indexOf("getBluePageInfo")>=0){
return;
}
}else{
console.warn("Workbench::handleIoError skip");
return;
}
_18b4.handleError(_18dc.message);
console.warn("Failed to load url="+url+" message="+_18dc.message+" status="+_18dc.status);
}
}
};
var _18dd=function(){
var _18df="/maqetta/welcome";
if(_18b4.singleUserMode()){
_18df="/maqetta/";
}
var _18e0=new _18b7({title:_18c9.sessionTimedOut});
var _18e1=dojo.string.substitute(_18c9.sessionTimedOutMsg,{hrefLoc:_18df});
_18e0.set("content",_18e1);
dojo.connect(_18e0,"onCancel",null,function(){
window.location.href=_18df;
});
setTimeout(function(){
window.location.href=_18df;
},10000);
_18e0.show();
};
var _18e2=function(){
var _18e3=_18b4.getSelection();
if(_18e3[0]&&_18e3[0].resource){
return _18e3[0].resource;
}
};
var _18e4=function(){
davinci.Workbench._expandCollapsePaletteContainers(null,{dontPreserveWidth:true});
var _18e5=function(_18e6){
return _18e6.indexOf(".review")>-1;
};
var _18e7=function(_18e8){
return new Path(_18e8).segment(2);
};
var _18e9=function(_18ea){
return new Path(_18ea).removeFirstSegments(3);
};
var init=function(state){
dojo.publish("/davinci/ui/initialPerspectiveReady",[]);
if(state.project){
_18f7.setActiveProject(state.project);
}
if(state.editors){
state.version=davinci.version;
var _18eb=null;
var _18ec=_18f7.singleProjectMode();
if(_18ec){
var p=_18f7.getProject();
_18eb=new Path(p);
}
state.editors.forEach(function(_18ed){
var _18ee=_18e5(_18ed);
if(!_18ee&&_18ec){
if(!new Path(_18ed).startsWith(_18eb)){
return;
}
}
var _18ef=function(_18f0){
var _18f1=true;
if(_18ec){
var path=new Path(state.activeEditor);
if(!path.startsWith(_18eb)){
_18f1=false;
}
}
var _18f2=_18ed!=state.activeEditor;
if(_18f2&&!_18f1){
_18f2=false;
state.activeEditor=_18ed;
}
if(_18f0){
_18f7.openEditor({fileName:_18f0,content:_18f0.getContentSync(),noSelect:_18f2,isDirty:_18f0.isDirty(),startup:false});
}
};
if(_18ee){
var _18f3=_18e7(_18ed);
var _18f4=_18e9(_18ed).toString();
_18ce.findFile(_18f3,_18f4).then(function(_18f5){
_18ef(_18f5);
});
}else{
_18ef(_18c8.findResource(_18ed));
}
});
}else{
state.editors=[];
}
};
if(!_18f7._state||!_18f7._state.hasOwnProperty("editors")){
xhr.get({url:"cmd/getWorkbenchState",handleAs:"json"}).then(function(_18f6){
init((_18f7._state=_18f6));
_18f7.setupGlobalKeyboardHandler();
});
}else{
init(_18f7._state);
_18f7.setupGlobalKeyboardHandler();
}
};
var _18f7={activePerspective:"",actionScope:[],_DEFAULT_PROJECT:"project1",hideEditorTabs:true,_editorTabClosing:{},_shadowTabClosing:{},run:function(){
_18b4.run();
_18f7._initKeys();
_18f7._baseTitle=dojo.doc.title;
_18b4.subscribe("/davinci/resource/resourceChanged",function(type,_18f8){
if(type=="deleted"){
var _18f9=_18d4(_18f8.getPath());
var _18fa=_18d6(_18f9);
var _18fb=dijit.byId(_18f9);
var _18fc=dijit.byId(_18fa);
if(_18fb&&!_18fb._isClosing){
var _18fd=dijit.byId("editors_container");
var _18fe=dijit.byId("davinci_file_tabs");
_18fd.removeChild(_18fb);
_18fb.destroyRecursive();
_18fe.removeChild(_18fc);
_18fc.destroyRecursive();
}
}
});
_18b4.subscribe("/dojo/io/error",_18da);
_18b4.subscribe("/davinci/states/state/changed",function(e){
var _18ff=_18b4.currentEditor;
if((_18ff.declaredClass!="davinci.ve.themeEditor.ThemeEditor"&&_18ff.declaredClass!="davinci.review.editor.ReviewEditor")){
_18ff.visualEditor.onContentChange.apply(_18ff.visualEditor,arguments);
}
});
_18b4.subscribe("/davinci/ui/widgetPropertiesChanges",function(){
var ve=_18b4.currentEditor.visualEditor;
ve._objectPropertiesChange.apply(ve,arguments);
});
_18cd.subscribe("/davinci/states/state/changed",function(args){
var _1900=(_18b4.currentEditor&&_18b4.currentEditor.declaredClass=="davinci.ve.PageEditor"&&_18b4.currentEditor.visualEditor&&_18b4.currentEditor.visualEditor.context);
if(!_1900){
return;
}
var _1901="_show:",_1902,_1903,_1904;
var _1905=_1900?_1900.getDijit():null;
var _1906=_18b3("davinci/ve/widget");
if(args.newState&&!args.newState.indexOf(_1901)){
_1902=_1905.byId(args.newState.substring(6));
_1903=_1906.getWidget(_1902.domNode);
_1904=_1903.getHelper();
_1904&&_1904.popup&&_1904.popup(_1903);
}
if(args.oldState&&!args.oldState.indexOf(_1901)){
_1902=_1905.byId(args.oldState.substring(6));
_1903=_1906.getWidget(_1902.domNode);
_1904=_1903.getHelper();
_1904&&_1904.tearDown&&_1904.tearDown(_1903);
}
});
_18cd.subscribe("/davinci/ui/repositionFocusContainer",function(args){
_18f7._repositionFocusContainer();
});
var d=_18ca.init().then(function(){
var _1907=_18b4.initialPerspective||"davinci.ui.main";
_18f7.showPerspective(_1907);
_18f7._updateTitle();
_18e4();
});
var _1908=dojo.query(".loading");
if(_1908[0]){
_1908[0].parentNode.removeChild(_1908[0]);
}
_18f7._lastAutoSave=Date.now();
setInterval(dojo.hitch(this,"_autoSave"),30000);
return d;
},unload:function(){
_18f7._autoSave();
},_createToolBar:function(_1909,_190a,_190b,_190c){
var _190d=[];
if(!_190b){
_190b=_18b4.getExtensions("davinci.actionSets");
}
for(var i=0,len=_190b.length;i<len;i++){
var _190e=_190b[i].actions;
for(var k=0,len2=_190e.length;k<len2;k++){
var _190f=_190e[k],_1910=_190f[_1909];
if(_1910){
if(!_190d[_1910]){
_190d[_1910]=[];
}
_190d[_1910].push(_190f);
}
}
}
var _1911=new _18b8({"class":"davinciToolbar"},_190a);
var _1912={};
var _1913=true;
for(var value in _190d){
if(!_1913){
var _1914=new _18b9();
_1911.addChild(_1914);
}else{
_1913=false;
}
var _1915;
var _190e=_190d[value];
for(var p=0;p<_190e.length;p++){
var _190f=_190e[p];
var id=_190f.id;
_18f7._loadActionClass(_190f);
var parms={showLabel:false};
["label","showLabel","iconClass"].forEach(function(prop){
if(_190f.hasOwnProperty(prop)){
parms[prop]=_190f[prop];
}
});
if(_190f.className){
parms["class"]=_190f.className;
}
var _1916;
var _1917=new _18cb();
if(_190f.menu&&(_190f.type=="DropDownButton"||_190f.type=="ComboButton")){
var menu=new Menu({style:"display: none;"});
for(var _1918=0;_1918<_190f.menu.length;_1918++){
var _1919=_190f.menu[_1918];
_18f7._loadActionClass(_1919);
var _191a={onClick:dojo.hitch(this,"_runAction",_1919,_190c)};
var props=["label","iconClass"];
props.forEach(function(prop){
if(_1919[prop]){
_191a[prop]=_1919[prop];
}
});
var _191b=new _18bb(_191a);
_191b._maqAction=_1919;
menu.addChild(_191b);
}
parms.dropDown=menu;
if(_190f.type=="DropDownButton"){
_1916=new _18bf(parms);
}else{
_1916=new _18c0(parms);
}
_1916.onClick=dojo.hitch(this,"_runAction",_190f,_190c);
_1916._maqAction=_190f;
_1917.resolve();
}else{
if(_190f.toggle||_190f.radioGroup){
_1916=new _18c1(parms);
_1916.item=_190f;
_1916.set("checked",_190f.initialValue);
if(_190f.radioGroup){
var group=_1912[_190f.radioGroup];
if(!group){
group=_1912[_190f.radioGroup]=[];
}
group.push(_1916);
_1916.onChange=dojo.hitch(this,"_toggleButton",_1916,_190c,group);
}else{
_1916.onChange=dojo.hitch(this,"_runAction",_190f,_190c);
}
_1916._maqAction=_190f;
_1917.resolve();
}else{
if(_190f.type){
_18b3([_190f.type],function(_191c){
_1916=new _191c();
_1916._maqActiond=_190f;
_1917.resolve();
});
}else{
_1916=new _18be(parms);
_1916.onClick=dojo.hitch(this,"_runAction",_190f,_190c);
_1916._maqAction=_190f;
_1917.resolve();
}
}
}
if(_190f.icon){
var _191d=document.createElement("img");
_191d.src=_190f.icon;
_191d.height=_191d.width=18;
_1916.domNode.appendChild(_191d);
}
_1917.then(function(){
_1911.addChild(_1916);
if(_190f.isEnabled&&!_190f.isEnabled()){
_1916.isEnabled=_190f.isEnabled;
_1916.set("disabled",true);
}else{
_1916.set("disabled",false);
}
});
}
}
return _1911;
},showPerspective:function(_191e){
_18f7.activePerspective=_191e;
var _191f=_18f7._createMenuTree();
_18f7._updateMainMenubar(dojo.byId("davinci_main_menu"),_191f);
var o=this.getActionSets("davinci.ui.editorMenuBar");
var _1920=o.clonedActionSets;
if(_1920.length){
_191f=_18f7._createMenuTree(_1920);
_18f7._updateMainMenubar(dojo.byId("maq_banner_editor_commands"),_191f);
}
var _1921=dojo.byId("mainBody");
if(!_1921.tabs){
_1921.tabs=[];
}
var _1922=dijit.byId("mainBody");
if(!_1922){
_1922=new _18c2({gutters:false,region:"center",design:"sidebar"},_1921);
}
var _1923=_18b4.getExtension("davinci.perspective",_191e);
if(!_1923){
_18b4.handleError(dojo.string.substitute(_18c9.perspectiveNotFound,[_191e]));
}
_1923=dojo.clone(_1923);
var _1924=_18b4.getExtensions("davinci.perspectiveExtension",function(_1925){
return _1925.targetID===_191e;
});
dojo.forEach(_1924,function(_1926){
dojo.forEach(_1926.views,function(view){
_1923.views.push(view);
});
});
if(!_1921.editorsStackContainer){
_18f7.editorsStackContainer=_1921.editorsStackContainer=new _18c4({region:"center",id:"editorsStackContainer",controllerWidget:"dijit.layout.StackController"});
}
_1922.addChild(_1921.editorsStackContainer);
if(!_1921.editorsWelcomePage){
_18f7.editorsWelcomePage=_1921.editorsWelcomePage=new _18c5({id:"editorsWelcomePage",href:"app/davinci/ve/resources/welcome_to_maqetta.html"});
}
_1921.editorsStackContainer.addChild(_1921.editorsWelcomePage);
if(!_1921.tabs.editors){
_18f7.editorTabs=_1921.tabs.editors=new (_18f7.hideEditorTabs?_18c4:_18c7)({id:"editors_container",controllerWidget:(_18f7.hideEditorTabs?"dijit.layout.StackController":"dijit.layout.TabController")});
_18f7.editorTabs.setTitle=function(_1927,title){
_1927.attr("title",title);
_1927.domNode.title="";
if(!_18f7.hideEditorTabs){
this.tablist.pane2button[_1927.id].attr("label",title);
}else{
var _1928=_1927.id;
var _1929=_18d6(_1928);
var _192a=dijit.byId("davinci_file_tabs");
_192a.tablist.pane2button[_1929].attr("label",title);
}
};
dojo.connect(_1921.tabs.editors,"removeChild",this,_18f7._editorTabClosed);
}
_1921.editorsStackContainer.addChild(_1921.tabs.editors);
_1921.editorsStackContainer.selectChild(_1921.editorsWelcomePage);
dojo.connect(dijit.byId("editors_container"),"selectChild",function(child){
if(!_18f7._processingSelectChild){
_18f7._processingSelectChild=true;
var _192b=child.id;
var _192c=_18d6(_192b);
var _192d=dijit.byId(_192c);
var _192e=dijit.byId("davinci_file_tabs");
if(_192d&&_192e){
_192e.selectChild(_192d);
}
if(child.editor){
_18f7._switchEditor(child.editor);
}
_18f7._processingSelectChild=false;
}
});
_1922.startup();
var _192f=dijit.byId("davinci_app");
if(!_192f){
_192f=new _18c2({design:"headline",gutters:false,liveSplitters:false},"davinci_app");
var _1930=new _18c5({region:"top",layoutPriority:1},"davinci_top_bar");
var _1931=_18f7.mainStackContainer=_1921.editorsStackContainer=new _18c4({region:"center",id:"mainStackContainer",controllerWidget:"dijit.layout.StackController"});
var _1932=_18f7.welcomePage=new _18c5({id:"welcomePage",href:"app/davinci/ve/resources/welcome_to_maqetta.html"});
var _1933=_18f7.mainBorderContainer=new _18c2({design:"headline",gutters:false,id:"mainBorderContainer",liveSplitters:false});
var _1934=_18f7.shadowTabs=new _18c7({id:"davinci_file_tabs",closable:true,region:"top",layoutPriority:1,style:"display:none"});
_18f7.shadowTabs.setTitle=function(tab,title){
tab.attr("title",title);
this.tablist.pane2button[tab.id].attr("label",title);
};
dojo.connect(_1934,"selectChild",function(child){
var _1935=child.id;
var _1936=_18d8(_1935);
var _1937=dijit.byId(_1936);
var _1938=dijit.byId("editors_container");
if(_1938&&_1937&&_1937.editor){
_1938.selectChild(_1937);
}
});
dojo.connect(_1934,"removeChild",this,_18f7._shadowTabClosed);
var _1939=new _18c5({id:"davinci_toolbar_pane",region:"top",layoutPriority:1,content:"<div id=\"davinci_toolbar_container\"></div>",style:"display:none"});
_192f.addChild(_1930);
_192f.addChild(_1931);
_1931.addChild(_1933);
_1931.selectChild(_1933);
_1933.addChild(_1934);
_1933.addChild(_1939);
_1933.addChild(_1922);
_192f.layout();
_192f.startup();
_18f7._originalOnResize=window.onresize;
window.onresize=_18f7.onResize;
dojo.connect(_1922,"onMouseUp",this,"onResize");
var _193a=dijit.byId("davinci_file_tabs_tablist_Menu");
if(_193a){
_193a.addChild(new dijit.MenuItem({label:veNLS.closeAllEditors,onClick:function(a,b,c){
this.closeAllEditors();
}.bind(this)}));
}
}
for(var _193b in _1921.tabs.perspective){
var view=_1921.tabs.perspective[_193b];
if(!view){
continue;
}
dojo.forEach(view.getChildren(),function(child){
view.removeChild(child);
if(_193b!="left"&&_193b!="right"){
child.destroyRecursive(false);
}
});
view.destroyRecursive(false);
delete _1921.tabs.perspective[_193b];
}
this._showViewPromises=dojo.map(_1923.views,function(view){
return _18f7.showView(view.viewID,view.selected,view.hidden);
},this);
davinci.Workbench.focusContainer=dojo.create("div",{"class":"focusContainer",id:"focusContainer"},document.body);
setTimeout(function(){
_192f.resize();
dojo.publish("/davinci/workbench/ready",[]);
}.bind(this),3000);
},onResize:function(e){
var _193c=e.explicitOriginalTarget?e.explicitOriginalTarget:e.srcElement;
if(e.type=="resize"||((_193c.id&&(_193c.id.indexOf("dijit_layout__Splitter_")>-1)||(_193c.nextSibling&&_193c.nextSibling.id&&_193c.nextSibling.id.indexOf("dijit_layout__Splitter_")>-1)))){
var ed=davinci&&_18b4.currentEditor;
if(davinci&&_18b4.currentEditor&&_18b4.currentEditor.onResize){
_18b4.currentEditor.onResize();
}
}
if(_18f7._originalOnResize){
_18f7._originalOnResize();
}
_18f7._repositionFocusContainer();
},updateMenubar:function(node,_193d){
var _193e=_18f7._createMenuTree(_193d);
var _193f=dijit.byId(node.id);
if(!_193f){
_193f=new _18ba({"class":"dijitInline"},node);
}
_18f7._addItemsToMenubar(_193e,_193f);
},_updateMainMenubar:function(_1940,_1941){
for(var i=0;i<_1941.length;i++){
var _1942=_1941[i];
for(var j=0;j<_1942.menus.length;j++){
var menu=_1942.menus[j];
var _1943=_18f7._createMenu(menu);
menu.id=menu.id.replace(".","-");
var _1944=dijit.byId(menu.id+"-dropdown");
if(!_1944){
var _1945={label:menu.label,dropDown:_1943,id:menu.id+"-dropdown"};
if(menu.hasOwnProperty("showLabel")){
_1945.showLabel=menu.showLabel;
}
if(menu.hasOwnProperty("iconClass")){
_1945.iconClass=menu.iconClass;
}
if(menu.hasOwnProperty("className")){
_1945["class"]=menu.className;
}
_1944=new _18bf(_1945);
_1940.appendChild(_1944.domNode);
}
}
}
},_addItemsToMenubar:function(_1946,_1947){
dojo.forEach(_1946,function(m){
var menus=m.menus,_1948=menus.length;
if(_1948){
dojo.forEach(menus,function(menu){
menu.id=menu.id.replace(/\./g,"-");
var _1949=_18f7._createMenu(menu),_194a=dijit.byId(menu.id+"-dropdown");
if(!_194a){
_194a=new _18bd({label:menu.label,popup:_1949,id:menu.id+"-dropdown"});
}
_1947.addChild(_194a);
},this);
}
},this);
},getOpenEditor:function(_194b){
if(_194b!=null){
var tab=dijit.byId(_18d4(_194b.getPath()));
if(tab){
return tab.editor;
}
return null;
}
var _194c=dijit.byId("editors_container");
if(_194c&&_194c.selectedChildWidget&&_194c.selectedChildWidget.editor){
return _194c.selectedChildWidget.editor;
}
return null;
},closeActiveEditor:function(){
var _194d=dijit.byId("editors_container");
var _194e=dijit.byId("davinci_file_tabs");
if(_194d&&_194d.selectedChildWidget&&_194d.selectedChildWidget.editor){
var _194f=selectedChildWidget.id;
var _1950=_18d6(_194f);
_194d.closeChild(_194d.selectedChildWidget);
var _1951=dijit.byId(_1950);
if(_1951){
_194e.closeChild(_1951);
}
}
},closeAllEditors:function(){
var _1952=dijit.byId("editors_container");
if(_1952){
_1952.getChildren().forEach(function(child){
_1952.closeChild(child);
});
}
},getAllOpenEditorIds:function(){
},showModal:function(_1953,title,style,_1954,_1955){
return _18b7.showModal(_1953,title,style,_1954,_1955);
},showMessage:function(title,_1956,style,_1957,_1958){
return _18b7.showMessage(title,_1956,style,_1957,_1958);
},showDialog:function(title,_1959,style,_195a,_195b,_195c,_195d,_195e){
return _18b7.showDialog(title,_1959,style,_195a,_195b,_195c,_195d);
},_createMenuTree:function(_195f,_1960){
if(!_195f){
_195f=_18b4.getExtensions("davinci.actionSets",function(_1961){
var _1962=_18b4.getExtensions("davinci.actionSetPartAssociations",function(_1963){
return _1963.targetID==_1961.id;
});
return _1962.length==0;
});
}
var _1964=[];
function _1965(m,id){
for(var j=0,jLen=m.length;j<jLen;j++){
for(var k=0,kLen=m[j].menus.length;k<kLen;k++){
if(id==m[j].menus[k].id){
return m[j].menus[k].menus;
}
}
}
};
function _1966(item,path,_1967){
path=path||"additions";
path=path.split("/");
var m=_1964;
_18f7._loadActionClass(item);
var sep=path[path.length-1];
if(path.length>1){
for(var i=0,len=path.length-1;i<len;i++){
var k=_1965(m,path[i]);
if(k){
m=k;
}
}
}
for(var i=0,len=m.length;i<len;i++){
if(m[i].id==sep){
var menus=m[i].menus;
menus.push(item);
if(item.separator){
var _1968=false;
menus=item.menus=[];
for(var j=0;j<item.separator.length;j+=2){
var id=item.separator[j];
_1968=id=="additions";
menus.push({id:id,isSeparator:item.separator[j+1],menus:[]});
}
if(!_1968){
menus.push({id:"additions",isSeparator:false,menus:[]});
}
}
return;
}
}
if(_1967){
_1964.push({id:sep,isSeparator:false,menus:[item]});
}
};
for(var _1969=0,len=_195f.length;_1969<len;_1969++){
var _196a=_195f[_1969];
if(_196a.visible){
if(_196a.menu){
for(var menuN=0,_196b=_196a.menu.length;menuN<_196b;menuN++){
var menu=_196a.menu[menuN];
if(menu.__mainMenu){
for(var j=0;j<menu.separator.length;j+=2){
_1964.push({id:menu.separator[j],isSeparator:menu.separator[j+1],menus:[]});
}
}else{
_1966(menu,menu.path,_1960);
if(menu.populate instanceof Function){
var _196c=menu.populate();
for(var item in _196c){
_1966(_196c[item],_196c[item].menubarPath);
}
}
}
}
}
}
}
for(var _1969=0,len=_195f.length;_1969<len;_1969++){
var _196a=_195f[_1969];
if(_196a.visible){
for(var _196d=0,_196e=_196a.actions.length;_196d<_196e;_196d++){
var _196f=_196a.actions[_196d];
if(_196f.menubarPath){
_1966(_196f,_196f.menubarPath,_1960);
}
}
}
}
return _1964;
},_loadActionClass:function(item){
if(typeof item.action=="string"){
_18b3([item.action],function(_1970){
item.action=new _1970();
item.action.item=item;
});
}
},_createMenu:function(menu,_1971){
var _1972,menus,_1973;
if(menu.menus){
_1972=new Menu({parentMenu:menu});
menus=menu.menus;
_1973="onOpen";
}else{
_1972=new _1974({});
menus=menu;
_1973="menuOpened";
}
_1972.domNode.style.display="none";
_1972.actionContext=_1971;
this._rebuildMenu(_1972,menus);
dojo.connect(_1972,_1973,this,function(evt){
if(_1972._widgetCallback){
_1972._widgetCallback(evt);
}
this._rebuildMenu(_1972,menus).focus();
});
return _1972;
},singleProjectMode:function(){
return true;
},getProject:function(){
return _18f7.getActiveProject()||_18f7._DEFAULT_PROJECT;
},loadProject:function(_1975){
return _18f7.setActiveProject(_1975).then(function(){
location.href="/maqetta/cmd/configProject?configOnly=true&project="+_1975;
});
},location:function(){
return _18b4.location();
},queryParams:function(){
var _1976=document.location.href;
var split=_1976.split("?");
var _1977=split.length>1?split[1]:"";
return dojo.queryToObject(_1977);
},_rebuildMenu:function(_1978,menus){
dojo.forEach(_1978.getChildren(),function(child){
_1978.removeChild(child);
child.destroy();
});
_1978.focusedChild=null;
var _1979,_197a;
menus.forEach(function(menu,i){
if(menu.menus.length){
if(menu.isSeparator&&i>0){
_1979=true;
}
menu.menus.forEach(function(item){
if(_1979&&_197a){
_1978.addChild(new _18bc({}));
_1979=false;
}
_197a=true;
var label=item.label;
if(item.action&&item.action.getName){
label=item.action.getName();
}
if(item.separator){
var _197b=_18f7._createMenu(item);
var _197c=new _18bb({label:label,popup:_197b,id:_197b.id+"item"});
_197c.actionContext=_1978.actionContext;
_1978.addChild(_197c);
}else{
var _197d=true;
if(item.isEnabled){
var _197e=_18e2();
_197d=_197e?item.isEnabled(_197e):false;
}
if(item.action){
if(item.action.shouldShow&&!item.action.shouldShow(_1978.actionContext,{menu:_1978})){
return;
}
_197d=item.action.isEnabled&&item.action.isEnabled(_1978.actionContext);
}
var _197f={label:label,id:item.id,disabled:!_197d,onClick:dojo.hitch(this,"_runAction",item,_1978.actionContext)};
if(item.iconClass){
_197f.iconClass=item.iconClass;
}
_1978.addChild(new _18bb(_197f));
}
},this);
}
},this);
return _1978;
},_toggleButton:function(_1980,_1981,group,arg){
if(!_1980.checked){
return;
}
group.forEach(function(item){
if(item!=_1980){
item.set("checked",false);
}
});
_18f7._runAction(_1980.item,_1981,_1980.item.id);
},_runAction:function(item,_1982,arg){
if(_1982&&davinci.Runtime.currentEditor){
_1982=davinci.Runtime.currentEditor;
}
if(item.run){
item.run();
}else{
if(item.action){
if(dojo.isString(item.action)){
this._loadActionClass(item);
}
item.action.run(_1982);
}else{
if(item.method&&_1982&&_1982[item.method] instanceof Function){
_1982[item.method](arg);
}else{
if(item.commandID){
_18b4.executeCommand(item.commandID);
}
}
}
}
},showView:function(_1983,_1984,_1985){
var d=new _18cb();
try{
var _1986=dijit.byId("mainBody"),view=_18b4.getExtension("davinci.view",_1983),_1987=dojo.byId("mainBody"),_1988=_18f7.activePerspective,_1989=_18b4.getExtension("davinci.perspective",_1988),_198a="left",cp1=null,_198b=false,_198c=dijit.byId("mainBody")._borderBox.h-5;
dojo.some(_1989.views,function(view){
if(view.viewID==_1983){
_198a=view.position;
return true;
}
});
_1987.tabs=_1987.tabs||{};
_1987.tabs.perspective=_1987.tabs.perspective||{};
if(_198a=="right"&&!_1987.tabs.perspective.right){
_1986.addChild(_1987.tabs.perspective.right=new _18c2({"class":"davinciPaletteContainer",style:"width: "+_18d1+"px;",id:"right_mainBody",minSize:_18d1,region:"right",gutters:false,splitter:true}));
_1987.tabs.perspective.right.startup();
_18d3["right_mainBody"]={expandToSize:340,initialExpandToSize:340};
}
if(_198a=="left"&&!_1987.tabs.perspective.left){
_1986.addChild(_1987.tabs.perspective.left=new _18c2({"class":"davinciPaletteContainer",style:"width: "+_18d1+"px;",id:"left_mainBody",minSize:_18d1,region:"left",gutters:false,splitter:true}));
_1987.tabs.perspective.left.startup();
_18d3["left_mainBody"]={expandToSize:300,initialExpandToSize:300};
}
if(_198a==="left"||_198a==="right"){
_198a+="-top";
}
var _198d=_198a;
if(!_1987.tabs.perspective[_198a]){
_198d=_198a.split("-");
var _198e=_198d[0],_198f=_1986,clazz="davinciPalette ",style="";
if(_198d[1]&&(_198e=="left"||_198e=="right")){
_198f=_1987.tabs.perspective[_198e];
_198e=_198d[1];
if(_198d[1]=="top"){
_198e="center";
clazz+="davinciTopPalette";
}else{
style="height:30%;";
clazz+="davinciBottomPalette";
}
}else{
if(_198e=="bottom"){
style="height:80px;";
clazz+="davinciBottomPalette";
}
}
cp1=_1987.tabs.perspective[_198a]=new _18c7({region:_198e,id:"palette-tabcontainer-"+_198a,tabPosition:_198d[0]+"-h",tabStrip:false,"class":clazz,style:style,splitter:_198e!="center",controllerWidget:"dijit.layout.TabController"});
_198f.addChild(cp1);
dojo.connect(cp1,"selectChild",this,function(tab){
if(tab&&tab.domNode){
var tc=tab.getParent();
if(!this._showViewAddChildInProcess&&!tc._maqDontExpandCollapse){
if(tc._maqLastSelectedChild==tab){
this._expandCollapsePaletteContainer(tab);
}else{
this.expandPaletteContainer(tab.domNode);
}
}
tc._maqLastSelectedChild=tab;
}
}.bind(this));
}else{
cp1=_1987.tabs.perspective[_198a];
}
if(dojo.some(cp1.getChildren(),function(child){
return child.id==view.id;
})){
return;
}
this.instantiateView(view).then(function(tab){
this._showViewAddChildInProcess=true;
if(!_1985){
cp1.addChild(tab);
}
this._showViewAddChildInProcess=false;
var _1990=tab.controlButton;
if(_1990&&_1990.domNode){
_1990.domNode.title=view.title+" "+veNLS.palette;
}
if(_1984){
cp1.selectChild(tab);
}
d.resolve(tab);
}.bind(this));
}
catch(ex){
console.error("Error loading view: "+view.id);
console.error(ex);
}
return d;
},instantiateView:function(view){
var d=new _18cb(),tab=dijit.byId(view.id);
if(tab){
d.resolve(tab);
}else{
_18b3([view.viewClass],function(_1991){
var _1992={title:view.title,id:view.id,closable:false,view:view};
if(view.iconClass){
_1992.iconClass=view.iconClass;
}
d.resolve(new (_1991||_18b5)(_1992));
});
}
return d;
},hideView:function(_1993){
for(var _1994 in mainBody.tabs.perspective){
if(_1994=="left"||_1994=="right"){
_1994+="-top";
}
if(!mainBody.tabs.perspective[_1994]){
continue;
}
var _1995=mainBody.tabs.perspective[_1994].getChildren();
var found=false;
for(var i=0;i<_1995.length&&!found;i++){
if(_1995[i].id==_1993){
mainBody.tabs.perspective[_1994].removeChild(_1995[i]);
_1995[i].destroyRecursive(false);
}
}
}
},toggleView:function(_1996){
var found=dojo.byId(_1996);
if(found){
_18f7.hideView(_1996);
}else{
_18f7.showView(_1996,true);
}
},openEditor:function(_1997,_1998){
try{
var _1999=_1997.fileName,_199a=_1997.content,_199b,file;
if(typeof _1999=="string"){
_199b=_1999.substr(_1999.lastIndexOf(".")+1);
}else{
file=_1999;
_199b=_1999.getExtension();
_1999=_1999.getPath();
}
var _199c=dijit.byId(_18d4(_1999)),_199d=dijit.byId("editors_container");
if(_199c){
_199d.selectChild(_199c);
var _199e=_199c.editor;
if(_1997.startOffset){
_199e.select(_1997);
}
return;
}
var _199f=_1997.editorCreateCallback;
var _19a0=_18b4.getExtensions("davinci.editor",function(_19a1){
if(typeof _19a1.extensions=="string"){
_19a1.extensions=_19a1.extensions.split(",");
}
return dojo.some(_19a1.extensions,function(e){
return e.toLowerCase()==_199b.toLowerCase();
});
});
var _19a2=_19a0[0];
if(_19a0.length>1){
dojo.some(_19a0,function(_19a3){
_19a2=_19a3;
return _19a3.isDefault;
});
}
_18f7._createEditor(_19a2,_1999,_1997,_1998).then(function(_19a4){
if(_199f){
_199f.call(window,_19a4);
}
if(!_1997.noSelect){
_18b4.currentEditor=_19a4;
}
},function(error){
console.error("Error opening editor for filename: "+_1999,error);
});
}
catch(ex){
console.error("Exception opening editor for filename: "+_1997&&_1997.fileName);
console.error(ex);
}
},_createEditor:function(_19a5,_19a6,_19a7,_19a8){
var d=new _18cb();
var _19a9=_19a6.split("/").pop();
var _19aa=_19a7&&_19a7.fileName&&_19a7.fileName.extension?"."+_19a7.fileName.extension:"";
_19a9=_19a9+(_19aa==".rev"?_19aa:"");
var _19ab=dojo.query(".loading");
if(_19ab[0]){
_19ab[0].parentNode.removeChild(_19ab[0]);
}
var _19ac=dijit.byId("editorsStackContainer"),_19ad=dijit.byId("editors_container");
if(_19ac&&_19ad){
_19ac.selectChild(_19ad);
_18f7.mainStackContainer.selectChild(_18f7.mainBorderContainer);
}
var _19ae=_19a7.content,_19af=dijit.byId(_18d4(_19a6)),_19b0=dijit.byId("editors_container"),_19b1=dijit.byId("davinci_file_tabs"),_19b2=false,_19b3=null;
if(!_19af){
_19b2=true;
var _19b4=_18d4(_19a6);
var _19b5=_18d6(_19b4);
_19af=new _18b6({title:_19a9,id:_19b4,"class":"EditorContainer",isDirty:_19a7.isDirty});
_19b3=new _18c5({title:_19a9,closable:true,id:_19b5});
_19b3.onClose=function(tc,tab){
var _19b6=tab.id;
var _19b7=_18d8(_19b6);
var _19b8=dijit.byId(_19b7);
var _19b9=dijit.byId("editors_container");
function _19ba(){
_19b8._skipDirtyCheck=true;
_19b8.onClose.apply(_19b8,[_19b9,_19b8]);
tc.removeChild(tab);
tab.destroyRecursive();
};
if(_19b9&&_19b8){
if(_19b8.editor.isDirty){
var _19bb=_19b8.editor.getOnUnloadWarningMessage();
if(!_19bb){
_19bb=dojo.string.substitute(_18d0.fileHasUnsavedChanges,[_19b8._getTitle()]);
}
_18f7.showDialog(_19b8._getTitle(),_19bb,{width:300},dojo.hitch(this,_19ba),null,null,true);
}else{
_19ba();
}
}
};
}
if(!_19a5){
_19a5={editorClass:"davinci/ui/TextEditor",id:"davinci.ui.TextEditor"};
}
if(_19b2){
_19b0.addChild(_19af);
_19b1.addChild(_19b3);
}
if(!_18f7.hideEditorTabs){
var _19bc=dojo.query(".dijitTabButtonIcon",_19af.controlButton.domNode);
dojo.addClass(_19bc[0],"tabButtonLoadingIcon");
dojo.removeClass(_19bc[0],"dijitNoIcon");
}
if(!_19a7.noSelect){
_19b0.selectChild(_19af);
}
_19af.setEditor(_19a5,_19a6,_19ae,_19a7.fileName,_19af.domNode,_19a8).then(function(_19bd){
if(_19a7.startLine){
_19af.editor.select(_19a7);
}
if(!_19a7.noSelect){
if(_18f7._state.editors.indexOf(_19a6)===-1){
_18f7._state.editors.push(_19a6);
}
_18f7._switchEditor(_19af.editor,_19a7.startup);
}
if(!_18f7.hideEditorTabs){
dojo.removeClass(_19bc[0],"tabButtonLoadingIcon");
dojo.addClass(_19bc[0],"dijitNoIcon");
}
setTimeout(function(){
_19af.resize();
},100);
d.resolve(_19af.editor);
},function(error){
if(!_18f7.hideEditorTabs){
dojo.removeClass(_19bc[0],"tabButtonLoadingIcon");
dojo.addClass(_19bc[0],"tabButtonErrorIcon");
}
d.reject(error);
});
return d;
},createPopup:function(args){
var _19be=args.partID,_19bf=args.domNode,_19c0=args.context,_19c1=args.openCallback;
var o=this.getActionSets(_19be);
var _19c2=o.clonedActionSets;
var _19c3=o.actionSets;
if(_19c2.length>0){
var _19c4=_18f7._createMenuTree(_19c2,true);
_18f7._initActionsKeys(_19c3,args);
var popup=_18f7._createMenu(_19c4,_19c0);
if(popup&&_19bf){
popup.bindDomNode(_19bf);
}
popup._widgetCallback=_19c1;
popup._partID=_19be;
return popup;
}
},getActionSets:function(_19c5){
var _19c6=[];
var _19c7=_18b4.getExtension("davinci.actionSetPartAssociations",function(_19c8){
return _19c8.parts.some(function(part){
if(part==_19c5){
_19c6.push(_19c8.targetID);
return true;
}
});
});
var _19c9;
var _19ca=[];
if(_19c6.length){
_19c9=_18b4.getExtensions("davinci.actionSets",function(_19cb){
return _19c6.some(function(setID){
return setID==_19cb.id;
});
});
if(_19c9.length){
_19c9.forEach(function(_19cc){
var _19cd=_18ca.getLibraryActions(_19cc.id);
if(_19cd.length){
_19cc=lang.mixin({},_19cc);
_19cc.actions=_19cc.actions.concat(_19cd);
}
_19ca.push(_19cc);
});
}
}
return {actionSets:_19c9,clonedActionSets:_19ca};
},_initActionsKeys:function(_19ce,args){
var _19cf=args.keysDomNode||args.domNode,keys={},_19d0;
dojo.forEach(_19ce,function(_19d1){
dojo.forEach(_19d1.actions,function(_19d2){
if(_19d2.keySequence){
keys[_19d2.keySequence]=_19d2;
_19d0=true;
}
});
});
if(_19d0){
var _19d3=args.context;
dojo.connect(_19cf,"onkeydown",function(e){
var seq=_18f7._keySequence(e),_19d4=keys[seq];
if(_19d4){
if(_19d4.action.shouldShow&&!_19d4.action.shouldShow(_19d3)){
return;
}
if(_19d4.action.isEnabled(_19d3)){
_18f7._runAction(_19d4,_19d3);
}
}
});
}
},_initKeys:function(){
var keys={all:[]};
var _19d5=_18b4.getExtensions("davinci.keyBindings");
dojo.forEach(_19d5,function(_19d6){
var _19d7=_19d6.contextID||"all";
var _19d8=keys[_19d7];
if(!_19d8){
_19d8=keys[_19d7]=[];
}
_19d8[_19d6.sequence]=_19d6.commandID;
});
_18f7.keyBindings=keys;
},handleKey:function(e){
if(!_18f7.keyBindings){
return;
}
var seq=_18f7._keySequence(e);
var cmd;
if(_18f7.currentContext&&_18f7.keyBindings[_18f7.currentContext]){
cmd=_18f7.keyBindings[_18f7.currentContext][seq];
}
if(!cmd){
cmd=_18f7.keyBindings.all[seq];
}
if(cmd){
_18b4.executeCommand(cmd);
return true;
}
},_keySequence:function(e){
var seq=[];
if(window.event){
if(window.event.ctrlKey){
seq.push("M1");
}
if(window.event.shiftKey){
seq.push("M2");
}
if(window.event.altKey){
seq.push("M3");
}
}else{
if(e.ctrlKey||(e.modifiers==2)||(e.modifiers==3)||(e.modifiers>5)){
seq.push("M1");
}
if(e.shiftKey||(e.modifiers>3)){
seq.push("M2");
}
if(e.modifiers){
if(e.altKey||(e.modifiers%2)){
seq.push("M3");
}
}else{
if(e.altKey){
seq.push("M3");
}
}
}
var _19d9=String.fromCharCode(e.keyCode);
if(/[A-Z0-9]/.test(_19d9)){
}else{
var _19da={46:"del",114:"f3"};
_19d9=_19da[e.keyCode]||"xxxxxxxxxx";
}
_19d9=_19d9.toUpperCase();
if(_19d9==" "){
_19d9="' '";
}
seq.push(_19d9);
return seq.join("+");
},setActionScope:function(_19db,scope){
_18f7.actionScope[_19db]=scope;
},findView:function(_19dc){
var _19dd=dijit.byId(_19dc);
if(_19dd){
return _19dd;
}
},_switchEditor:function(_19de,_19df){
var _19e0=_18b4.currentEditor;
_18b4.currentEditor=_19de;
this._showEditorTopPanes();
try{
dojo.publish("/davinci/ui/editorSelected",[{editor:_19de,oldEditor:_19e0}]);
}
catch(ex){
console.error(ex);
}
_18f7._updateTitle(_19de);
_18f7._state.activeEditor=_19de?_19de.fileName:null;
setTimeout(function(){
if(_19de&&_19de.visualEditor&&_19de.visualEditor.context&&_19de.visualEditor.context.isActive()){
_19de.visualEditor.context.getTopWidgets().forEach(function(_19e1){
if(_19e1.resize){
_19e1.resize();
}
});
}
this._repositionFocusContainer();
}.bind(this),1000);
all(this._showViewPromises).then(function(){
if(_19de&&_19de.focus){
_19de.focus();
}
this._rearrangePalettes(_19de);
this._expandCollapsePaletteContainers(_19de);
}.bind(this));
if(!_19df){
_18f7._updateWorkbenchState();
}
},_rearrangePalettes:function(_19e2){
var _19e3,_19e4,_19e5;
if(_19e2){
var _19e6=_18b4.getExtensions("davinci.editor",function(_19e7){
return (_19e2?(_19e7.id===_19e2.editorID):false);
});
if(_19e6&&_19e6.length>0){
var _19e8=_19e6[0];
_19e3=_19e8.palettePerspective;
}
_19e4=_19e2._rightPaletteExpanded;
_19e5=_19e2._leftPaletteExpanded;
}else{
_19e3=_18b4.initialPerspective||"davinci.ui.main";
}
if(_19e3){
var _19e9=_18b4.getExtension("davinci.perspective",_19e3);
if(!_19e9){
_18b4.handleError(dojo.string.substitute(_18c9.perspectiveNotFound,[_19e8.palettePerspective]));
}
var _19ea=_19e9.views;
dojo.forEach(_19ea,function(_19eb){
var _19ec=_19eb.viewID;
var _19ed=_19eb.position;
if(_19ed.indexOf("bottom")<0){
_19ed+="-top";
}
var tab=dijit.byId(_19ec);
if(tab){
var _19ee=tab.getParent();
var _19ef=mainBody.tabs.perspective[_19ed];
if(_19ee!=_19ef){
if(_19ee){
_19ee.removeChild(tab);
}
if(!_19eb.hidden){
_19ef.addChild(tab);
_19ee=_19ef;
}
}
if(_19ee){
if(_19eb.hidden){
_19ee.removeChild(tab);
}else{
if(_19eb.selected){
_19ee._maqDontExpandCollapse=true;
_19ee.selectChild(tab);
delete _19ee._maqDontExpandCollapse;
}
}
}
}
});
}
if(_19e2){
if(_19e2.hasOwnProperty("_rightPaletteExpanded")){
_19e2._rightPaletteExpanded=_19e4;
}
if(_19e2.hasOwnProperty("_leftPaletteExpanded")){
_19e2._leftPaletteExpanded=_19e5;
}
}
},_nearlyCollapsed:function(_19f0){
var width=dojo.style(_19f0,"width");
if(typeof width=="string"){
width=parseInt(width);
}
return width<(_18d1+_18d2);
},_expandCollapsePaletteContainer:function(tab){
if(!tab||!tab.domNode){
return;
}
var _19f1=davinci.Workbench.findPaletteContainerNode(tab.domNode);
if(!_19f1.id){
return;
}
var _19f2=_19f1._maqExpanded;
var _19f3;
if(this._nearlyCollapsed(_19f1)){
_19f2=false;
_19f3=(_18d3[_19f1.id].expandToSize>=(_18d1+_18d2))?_18d3[_19f1.id].expandToSize:_18d3[_19f1.id].initialExpandToSize;
}
if(_19f2){
this.collapsePaletteContainer(_19f1);
}else{
this.expandPaletteContainer(_19f1,{expandToSize:_19f3});
}
},_expandCollapsePaletteContainers:function(_19f4,_19f5){
var _19f6=dijit.byId("left_mainBody");
var _19f7=dijit.byId("right_mainBody");
if(!_19f4){
if(_19f6){
this.collapsePaletteContainer(_19f6.domNode,_19f5);
}
if(_19f7){
this.collapsePaletteContainer(_19f7.domNode,_19f5);
}
}else{
var _19f8=_18b4.getExtensions("davinci.editor",function(_19f9){
return _19f9.id===_19f4.editorID;
});
if(_19f8&&_19f8.length>0){
var _19fa=_19f8[0].expandPalettes;
var _19fb;
if(_19f6){
if(_19f4&&_19f4.hasOwnProperty("_leftPaletteExpanded")){
_19fb=_19f4._leftPaletteExpanded;
}else{
_19fb=(_19fa&&_19fa.indexOf("left")>=0);
}
if(_19fb){
this.expandPaletteContainer(_19f6.domNode,_19f5);
}else{
this.collapsePaletteContainer(_19f6.domNode,_19f5);
}
}
if(_19f7){
if(_19f4&&_19f4.hasOwnProperty("_rightPaletteExpanded")){
_19fb=_19f4._rightPaletteExpanded;
}else{
_19fb=(_19fa&&_19fa.indexOf("right")>=0);
}
if(_19fb){
this.expandPaletteContainer(_19f7.domNode,_19f5);
}else{
this.collapsePaletteContainer(_19f7.domNode,_19f5);
}
}
}
}
},_updateTitle:function(_19fc){
var _19fd=_18f7._baseTitle;
if(_19fc){
_19fd=_19fd+" - ";
if(_19fc.isDirty){
_19fd=_19fd+"*";
}
_19fd=_19fd+_19fc.fileName;
}
dojo.doc.title=_19fd;
},_editorTabClosed:function(page){
if(!davinci.Workbench._editorTabClosing[page.id]){
davinci.Workbench._editorTabClosing[page.id]=true;
if(page&&page.editor&&page.editor.fileName){
var _19fe=page.id;
var _19ff=_18d6(_19fe);
var _1a00=dijit.byId("davinci_file_tabs");
var _1a01=dijit.byId(_19ff);
var i=_18f7._state.editors.indexOf(page.editor.fileName);
if(i!=-1){
_18f7._state.editors.splice(i,1);
}
_18f7._updateWorkbenchState();
if(!davinci.Workbench._shadowTabClosing[_19ff]){
_1a00.removeChild(_1a01);
_1a01.destroyRecursive();
}
}
var _1a02=dijit.byId("editors_container").getChildren();
if(!_1a02.length){
_18f7._switchEditor(null);
this._expandCollapsePaletteContainers(null);
var _1a03=dijit.byId("editorsStackContainer");
var _1a04=dijit.byId("editorsWelcomePage");
if(_1a03&&_1a04){
_1a03.selectChild(_1a04);
}
this._hideEditorTopPanes();
}
delete davinci.Workbench._editorTabClosing[page.id];
}
},_shadowTabClosed:function(page){
if(!davinci.Workbench._shadowTabClosing[page.id]){
davinci.Workbench._shadowTabClosing[page.id]=true;
var _1a05=page.id;
var _1a06=_18d8(_1a05);
if(!davinci.Workbench._editorTabClosing[_1a06]){
var _1a07=dijit.byId(_1a06);
var _1a08=dijit.byId("editors_container");
if(_1a08&&_1a07){
_1a08.removeChild(_1a07);
_1a07.destroyRecursive();
}
}
delete davinci.Workbench._shadowTabClosing[page.id];
}
},getActiveProject:function(){
if(!_18f7._state){
_18f7._state=_18b4.serverJSONRequest({url:"cmd/getWorkbenchState",handleAs:"json",sync:true});
}
var _1a09=dojo.queryToObject(dojo.doc.location.search.substr((dojo.doc.location.search[0]==="?"?1:0))).project;
if(_1a09){
_18f7.loadProject(_1a09);
}
if(_18f7._state.hasOwnProperty("project")){
return _18f7._state.project;
}
return _18f7._DEFAULT_PROJECT;
},setActiveProject:function(_1a0a){
if(!_18f7._state){
_18f7._state={};
}
_18f7._state.project=_1a0a;
return _18f7._updateWorkbenchState();
},workbenchStateCustomPropGet:function(_1a0b){
if(typeof _1a0b=="string"){
return _18f7._state[_1a0b];
}
},workbenchStateCustomPropSet:function(_1a0c,_1a0d){
if(typeof _1a0c=="string"){
if(typeof _1a0d=="undefined"){
delete _18f7._state[_1a0c];
}else{
_18f7._state[_1a0c]=_1a0d;
}
_18f7._updateWorkbenchState();
}
},clearWorkbenchState:function(){
_18f7._state={};
return this._updateWorkbenchState();
},_updateWorkbenchState:function(){
if(!this._updateWorkbench){
this._updateWorkbench=new _18cb();
this._updateWorkbench.resolve();
}
this._updateWorkbench.then(dojo.hitch(this,function(){
this._updateWorkbench=dojo.xhrPut({url:"cmd/setWorkbenchState",putData:dojo.toJson(_18f7._state),handleAs:"text",sync:false});
}));
return this._updateWorkbench;
},_autoSave:function(){
var _1a0e=_18f7._lastAutoSave;
var _1a0f=false;
function _1a10(_1a11){
if(_1a11.isReadOnly||!_1a11.isDirty){
return;
}
var _1a12=_1a11.lastModifiedTime;
if(_1a12&&_1a12>_1a0e){
try{
_1a11.save(true);
}
catch(ex){
console.error("Error while autosaving file:"+ex);
_1a0f=true;
}
}
};
if(_18f7.editorTabs){
dojo.forEach(_18f7.editorTabs.getChildren(),_1a10);
}
if(!_1a0f){
_18f7._lastAutoSave=Date.now();
}
},setupGlobalKeyboardHandler:function(){
var _1a13=_18b4.getExtensions("davinci.actionSets");
dojo.forEach(_1a13,function(_1a14){
if(_1a14.id=="davinci.ui.main"||_1a14.id=="davinci.ui.editorActions"){
dojo.forEach(_1a14.actions,function(_1a15){
if(_1a15.keyBinding){
_18b4.registerKeyBinding(_1a15.keyBinding,_1a15);
}
});
}
});
},findPaletteContainerNode:function(node){
var _1a16;
var n=node;
while(n&&n.tagName!="BODY"){
if(dojo.hasClass(n,"davinciPaletteContainer")){
_1a16=n;
break;
}
n=n.parentNode;
}
return _1a16;
},collapsePaletteContainer:function(node,_1a17){
var _1a18=davinci.Workbench.findPaletteContainerNode(node);
if(_1a18&&_1a18.id){
var id=_1a18.id;
var _1a19=dojo.style(_1a18,"width");
var _1a1a=dijit.byNode(_1a18);
var _1a1b=dojo.query("[role=tablist]",_1a18);
if(_1a1a&&_1a1b.length>0){
var _1a1c=_1a1b[0];
var _1a1d=dojo.marginBox(_1a1c);
var _1a1e=_1a1a.getParent();
if(_1a1e&&_1a1e.resize&&_1a1d&&_1a1d.w){
if(!this._nearlyCollapsed(_1a18)&&(!_1a17||!_1a17.dontPreserveWidth)){
_18d3[id].expandToSize=_1a19;
}
_1a18.style.width=_1a1d.w+"px";
_1a1e.resize();
_1a1a._isCollapsed=true;
}
}
dojo.removeClass(_1a18,"maqPaletteExpanded");
_1a18._maqExpanded=false;
davinci.Workbench._repositionFocusContainer();
var _1a1f=davinci.Runtime.currentEditor;
if(_1a1f){
if(_1a18.id=="left_mainBody"){
_1a1f._leftPaletteExpanded=false;
}else{
if(_1a18.id=="right_mainBody"){
_1a1f._rightPaletteExpanded=false;
}
}
}
}
},expandPaletteContainer:function(node,_1a20){
var _1a21=_1a20&&_1a20.expandToSize;
var _1a22=davinci.Workbench.findPaletteContainerNode(node);
if(_1a22&&_1a22.id){
var id=_1a22.id;
var _1a23=dijit.byNode(_1a22);
if(_1a21){
_18d3[id].expandToSize=_1a21;
}
if(_1a23&&_18d3[id].expandToSize){
var _1a24=_1a23.getParent();
if(_1a24&&_1a24.resize){
_1a22.style.width=_18d3[id].expandToSize+"px";
_1a24.resize();
delete _1a23._isCollapsed;
}
}
dojo.addClass(_1a22,"maqPaletteExpanded");
_1a22._maqExpanded=true;
davinci.Workbench._repositionFocusContainer();
var _1a25=davinci.Runtime.currentEditor;
if(_1a25){
if(_1a22.id=="left_mainBody"){
_1a25._leftPaletteExpanded=true;
}else{
if(_1a22.id=="right_mainBody"){
_1a25._rightPaletteExpanded=true;
}
}
}
}
},_repositionFocusContainer:function(){
var _1a26=dojo.byId("editors_container");
var _1a27=dojo.byId("focusContainer");
if(_1a26&&_1a27){
var _1a28=davinci.Runtime.currentEditor;
var box;
if(_1a28&&_1a28.getFocusContainerBounds){
box=_1a28.getFocusContainerBounds();
}else{
box=_18cf.getBorderBoxPageCoords(_1a26);
}
if(box){
_1a27.style.left=box.l+"px";
_1a27.style.top=box.t+"px";
_1a27.style.width=box.w+"px";
_1a27.style.height=box.h+"px";
if(_1a28&&_1a28.getContext){
var _1a29=_1a28.getContext();
if(_1a29&&_1a29.updateFocusAll){
_1a29.updateFocusAll();
}
}
}
}
},_hideShowEditorTopPanes:function(_1a2a){
var _1a2b=dijit.byId("davinci_app");
var _1a2c=dijit.byId("davinci_file_tabs");
var _1a2d=dijit.byId("davinci_toolbar_pane");
_1a2c.domNode.style.display=_1a2a;
_1a2d.domNode.style.display=_1a2a;
_1a2b.resize();
},_hideEditorTopPanes:function(){
this._hideShowEditorTopPanes("none");
},_showEditorTopPanes:function(){
this._hideShowEditorTopPanes("block");
},_XX_last_member:true};
var _1974=_18cc(Menu,{menuOpened:function(event){
},_openMyself:function(event){
this.menuOpened(event);
var open;
try{
var _1a2e=document.getElementById("menuOverlayDiv");
if(!_1a2e){
_1a2e=dojo.create("div",{id:"menuOverlayDiv",style:"left:0px; top:0px; width:100%; height:100%; position:absolute; z-index:10;"},document.body);
}
if(this.adjustPosition){
var _1a2f=this.adjustPosition(event);
open=dijit.popup.open;
dijit.popup.open=function(args){
args.x+=_1a2f.x;
args.y+=_1a2f.y;
open.call(dijit.popup,args);
};
}
this.onClose=function(){
var _1a30=document.getElementById("menuOverlayDiv");
if(_1a30){
_1a30.parentNode.removeChild(_1a30);
}
}.bind(this);
this.inherited(arguments);
}
finally{
if(open){
dijit.popup.open=open;
}
}
}});
dojo.setObject("davinci.Workbench",_18f7);
return _18f7;
});
},"davinci/ui/widgets/OutlineTree":function(){
define(["dojo/_base/declare","dojo/_base/connect","dojo/_base/array","dojo/touch","dojo/mouse","dijit/Tree","../../Workbench","./_ToggleTreeNode",],function(_1a31,_1a32,array,touch,mouse,Tree,_1a33,_1a34){
return _1a31(Tree,{postCreate:function(){
this._handles=[];
this.toggledItems={};
this.inherited(arguments);
this._handles.push(_1a32.connect(this.dndController,"userSelect",this,"_userSelect"));
var _1a35=this.dndController.onMouseDown;
this.dndController.onMouseDown=function(e){
if((" "+(e.srcElement||e.target).className+" ").indexOf(" dojoDndContainerOver ")!=-1){
return;
}
if(dojo.hasClass(e.target,"dvOutlineToggleNode")){
return;
}
return _1a35.call(this.dndController,e);
}.bind(this);
this._connect("widgetChanged","_widgetChanged");
this.connect(this.domNode,touch.press,"_onMouseDown");
},_createTreeNode:function(args){
return new _1a34(args);
},selectNode:function(items){
var paths=items.map(function(item){
return this._createPath(this.model._getWidget(item));
},this);
this.set("paths",paths);
},deselectAll:function(){
dojo.forEach(this.selectedItems,dojo.hitch(this,function(item){
var _1a36=this.model._getWidget(item);
var _1a37=this.getNodesByItem(_1a36);
if(_1a37.length>0){
_1a37[0].setSelected(false);
}
}));
},toggleNode:function(item,_1a38){
var _1a39=this.model._getWidget(item);
var nodes=this.getNodesByItem(_1a39);
if(nodes&&nodes.length>0&&nodes[0]){
nodes[0]._setToggleAttr(_1a38);
}
},_userSelect:function(){
var _1a3a=this.selectedItems.map(this.model._getWidget);
var _1a3b=this.context.getSelection();
dojo.forEach(_1a3b,dojo.hitch(this,function(item){
if(_1a3a.indexOf(item)==-1){
this.context.deselect(item);
}
}));
dojo.forEach(_1a3a,dojo.hitch(this,function(item){
if(_1a3b.indexOf(item)==-1){
if(item.id!="myapp"){
this.context.select(item,true);
}
}
}));
},_widgetChanged:function(type,_1a3c){
if(type===this.context.WIDGET_REPARENTED){
this.selectNode(this.context.getSelection());
}
},_createPath:function(item){
var path=[];
var n=item;
while(n&&n.id!="myapp"){
path.splice(0,0,n.id);
if(n.getParent){
n=n.getParent();
}else{
n=null;
}
}
path.splice(0,0,"myapp");
return path;
},_onItemDelete:function(item){
var model=this.model,_1a3d=model.getIdentity(item),nodes=this._itemNodesMap[_1a3d];
var _1a3e=this.dndController.getSelectedTreeNodes();
var _1a3f=[];
array.forEach(nodes,function(node){
array.forEach(_1a3e,function(snode){
if(snode.getTreePath().indexOf(node)==-1){
_1a3f.push(node.item);
}
},this);
},this);
this.set("selectedItems",_1a3f);
this.inherited(arguments);
},_onMouseDown:function(e){
if(!mouse.isLeft(e)){
var w=dijit.getEnclosingWidget(e.target);
if(w&&w.item){
e.preventDefault();
this.selectNode([w.item]);
this._userSelect();
}
}
},_onDblClick:function(_1a40,e){
this.inherited(arguments);
var c=_1a33.getOpenEditor().getContext();
if(c){
c.select(this.model._getWidget(_1a40.item),null,true);
}
},_connect:function(_1a41,_1a42){
this._handles.push(_1a32.connect(this.context,_1a41,this,_1a42));
},destroy:function(){
this._handles.forEach(_1a32.disconnect);
}});
});
},"url:davinci/ve/template.html":"<!DOCTYPE html>\n<html>\n<head>\n<meta charset=\"utf-8\" />\n<title>Untitled</title>\n</head>\n<body>\n</body>\n</html>\n","davinci/html/CSSElement":function(){
define(["dojo/_base/declare","davinci/model/Model"],function(_1a43,Model){
return _1a43("davinci.html.CSSElement",Model,{constructor:function(){
if(typeof pushComment!="undefined"&&pushComment!==null){
this.comment=pushComment;
pushComment=null;
}
this.elementType="CSSElement";
},getLabel:function(){
context={indent:0,noComments:true};
return this.getText(context);
},onChange:function(arg){
if(this.parent){
if(arg){
this.parent.onChange(arg);
}else{
this.parent.onChange(this);
}
}
},close:function(_1a44){
for(var i=0;i<this.children;i++){
this.children[i].close();
}
},getCSSFile:function(){
var rule=this.getCSSRule();
if(rule){
return rule.parent;
}
},getCSSRule:function(){
},_convertNode:function(_1a45){
if(dojo.isArray(_1a45)){
return _1a45;
}
var nodes=[];
while(_1a45&&_1a45.tagName!="HTML"){
nodes.push({tagName:_1a45.tagName,id:_1a45.id,classes:(_1a45.className&&_1a45.className.split(" "))});
_1a45=_1a45.parentNode;
}
return nodes;
},getID:function(){
return this.parent.getID()+":"+this.startOffset+":"+this.getLabel();
}});
});
},"dojo/colors":function(){
define("dojo/colors",["./_base/kernel","./_base/lang","./_base/Color","./_base/array"],function(dojo,lang,Color,_1a46){
var _1a47={};
lang.setObject("dojo.colors",_1a47);
var _1a48=function(m1,m2,h){
if(h<0){
++h;
}
if(h>1){
--h;
}
var h6=6*h;
if(h6<1){
return m1+(m2-m1)*h6;
}
if(2*h<1){
return m2;
}
if(3*h<2){
return m1+(m2-m1)*(2/3-h)*6;
}
return m1;
};
dojo.colorFromRgb=Color.fromRgb=function(color,obj){
var m=color.toLowerCase().match(/^(rgba?|hsla?)\(([\s\.\-,%0-9]+)\)/);
if(m){
var c=m[2].split(/\s*,\s*/),l=c.length,t=m[1],a;
if((t=="rgb"&&l==3)||(t=="rgba"&&l==4)){
var r=c[0];
if(r.charAt(r.length-1)=="%"){
a=_1a46.map(c,function(x){
return parseFloat(x)*2.56;
});
if(l==4){
a[3]=c[3];
}
return Color.fromArray(a,obj);
}
return Color.fromArray(c,obj);
}
if((t=="hsl"&&l==3)||(t=="hsla"&&l==4)){
var H=((parseFloat(c[0])%360)+360)%360/360,S=parseFloat(c[1])/100,L=parseFloat(c[2])/100,m2=L<=0.5?L*(S+1):L+S-L*S,m1=2*L-m2;
a=[_1a48(m1,m2,H+1/3)*256,_1a48(m1,m2,H)*256,_1a48(m1,m2,H-1/3)*256,1];
if(l==4){
a[3]=c[3];
}
return Color.fromArray(a,obj);
}
}
return null;
};
var _1a49=function(c,low,high){
c=Number(c);
return isNaN(c)?high:c<low?low:c>high?high:c;
};
Color.prototype.sanitize=function(){
var t=this;
t.r=Math.round(_1a49(t.r,0,255));
t.g=Math.round(_1a49(t.g,0,255));
t.b=Math.round(_1a49(t.b,0,255));
t.a=_1a49(t.a,0,1);
return this;
};
_1a47.makeGrey=Color.makeGrey=function(g,a){
return Color.fromArray([g,g,g,a]);
};
lang.mixin(Color.named,{"aliceblue":[240,248,255],"antiquewhite":[250,235,215],"aquamarine":[127,255,212],"azure":[240,255,255],"beige":[245,245,220],"bisque":[255,228,196],"blanchedalmond":[255,235,205],"blueviolet":[138,43,226],"brown":[165,42,42],"burlywood":[222,184,135],"cadetblue":[95,158,160],"chartreuse":[127,255,0],"chocolate":[210,105,30],"coral":[255,127,80],"cornflowerblue":[100,149,237],"cornsilk":[255,248,220],"crimson":[220,20,60],"cyan":[0,255,255],"darkblue":[0,0,139],"darkcyan":[0,139,139],"darkgoldenrod":[184,134,11],"darkgray":[169,169,169],"darkgreen":[0,100,0],"darkgrey":[169,169,169],"darkkhaki":[189,183,107],"darkmagenta":[139,0,139],"darkolivegreen":[85,107,47],"darkorange":[255,140,0],"darkorchid":[153,50,204],"darkred":[139,0,0],"darksalmon":[233,150,122],"darkseagreen":[143,188,143],"darkslateblue":[72,61,139],"darkslategray":[47,79,79],"darkslategrey":[47,79,79],"darkturquoise":[0,206,209],"darkviolet":[148,0,211],"deeppink":[255,20,147],"deepskyblue":[0,191,255],"dimgray":[105,105,105],"dimgrey":[105,105,105],"dodgerblue":[30,144,255],"firebrick":[178,34,34],"floralwhite":[255,250,240],"forestgreen":[34,139,34],"gainsboro":[220,220,220],"ghostwhite":[248,248,255],"gold":[255,215,0],"goldenrod":[218,165,32],"greenyellow":[173,255,47],"grey":[128,128,128],"honeydew":[240,255,240],"hotpink":[255,105,180],"indianred":[205,92,92],"indigo":[75,0,130],"ivory":[255,255,240],"khaki":[240,230,140],"lavender":[230,230,250],"lavenderblush":[255,240,245],"lawngreen":[124,252,0],"lemonchiffon":[255,250,205],"lightblue":[173,216,230],"lightcoral":[240,128,128],"lightcyan":[224,255,255],"lightgoldenrodyellow":[250,250,210],"lightgray":[211,211,211],"lightgreen":[144,238,144],"lightgrey":[211,211,211],"lightpink":[255,182,193],"lightsalmon":[255,160,122],"lightseagreen":[32,178,170],"lightskyblue":[135,206,250],"lightslategray":[119,136,153],"lightslategrey":[119,136,153],"lightsteelblue":[176,196,222],"lightyellow":[255,255,224],"limegreen":[50,205,50],"linen":[250,240,230],"magenta":[255,0,255],"mediumaquamarine":[102,205,170],"mediumblue":[0,0,205],"mediumorchid":[186,85,211],"mediumpurple":[147,112,219],"mediumseagreen":[60,179,113],"mediumslateblue":[123,104,238],"mediumspringgreen":[0,250,154],"mediumturquoise":[72,209,204],"mediumvioletred":[199,21,133],"midnightblue":[25,25,112],"mintcream":[245,255,250],"mistyrose":[255,228,225],"moccasin":[255,228,181],"navajowhite":[255,222,173],"oldlace":[253,245,230],"olivedrab":[107,142,35],"orange":[255,165,0],"orangered":[255,69,0],"orchid":[218,112,214],"palegoldenrod":[238,232,170],"palegreen":[152,251,152],"paleturquoise":[175,238,238],"palevioletred":[219,112,147],"papayawhip":[255,239,213],"peachpuff":[255,218,185],"peru":[205,133,63],"pink":[255,192,203],"plum":[221,160,221],"powderblue":[176,224,230],"rosybrown":[188,143,143],"royalblue":[65,105,225],"saddlebrown":[139,69,19],"salmon":[250,128,114],"sandybrown":[244,164,96],"seagreen":[46,139,87],"seashell":[255,245,238],"sienna":[160,82,45],"skyblue":[135,206,235],"slateblue":[106,90,205],"slategray":[112,128,144],"slategrey":[112,128,144],"snow":[255,250,250],"springgreen":[0,255,127],"steelblue":[70,130,180],"tan":[210,180,140],"thistle":[216,191,216],"tomato":[255,99,71],"turquoise":[64,224,208],"violet":[238,130,238],"wheat":[245,222,179],"whitesmoke":[245,245,245],"yellowgreen":[154,205,50]});
return Color;
});
},"davinci/ve/views/SwitchingStyleView":function(){
define("davinci/ve/views/SwitchingStyleView",["dojo/_base/declare","dojo/i18n!davinci/ve/nls/ve","dojo/i18n!dijit/nls/common","dijit/layout/TabContainer","dijit/layout/ContentPane","davinci/Runtime","davinci/workbench/WidgetLite","davinci/ve/widgets/HTMLStringUtil","davinci/ve/widgets/WidgetToolBar","davinci/ve/widgets/Cascade","davinci/ve/widgets/CommonProperties","davinci/ve/widgets/WidgetProperties","davinci/ve/widgets/EventSelection"],function(_1a4a,veNls,_1a4b,_1a4c,_1a4d,_1a4e,_1a4f,_1a50,_1a51,_1a52,_1a53,_1a54,_1a55){
return _1a4a("davinci.ve.views.SwitchingStyleView",[_1a4f],{_editor:null,_widget:null,_subWidget:null,_titleBarDiv:"<div class='palette_titleBarDiv'><span class='paletteCloseBox'></span><span class='titleBarDivTitle'></span></div>",constructor:function(_1a56,_1a57){
dojo.subscribe("/davinci/ui/editorSelected",dojo.hitch(this,this._editorSelected));
dojo.subscribe("/davinci/ui/widgetSelected",dojo.hitch(this,this._widgetSelectionChanged));
dojo.subscribe("/davinci/states/state/changed",dojo.hitch(this,this._stateChanged));
dojo.subscribe("/maqetta/appstates/state/changed",dojo.hitch(this,this._stateChanged));
dojo.subscribe("/davinci/ui/initialPerspectiveReady",dojo.hitch(this,this._initialPerspectiveReady));
dojo.subscribe("/davinci/workbench/ready",dojo.hitch(this,this._workbenchReady));
},pageTemplate:[{key:"widgetSpecific",className:"maqPropertySection page_editor_only",addCommonPropertiesAtTop:false,html:"<div dojoType='davinci.ve.widgets.WidgetProperties'></div>"},{key:"events",className:"maqPropertySection page_editor_only",addCommonPropertiesAtTop:false,pageTemplate:{html:"<div dojoType='davinci.ve.widgets.EventSelection'></div>"}},{key:"layout",className:"maqPropertySection",addCommonPropertiesAtTop:true,pageTemplate:[{display:"width",type:"multi",target:["width"],values:["","auto","100%","200px","10em"]},{display:"height",type:"multi",target:["height"],values:["","auto","100%","200px","10em"]},{html:"&nbsp;"},{key:"showMinMax",display:"&nbsp;&nbsp;&nbsp;",type:"toggleSection",pageTemplate:[{display:"min-height",type:"multi",target:["min-height"],rowClass:"propertiesSectionHidden"},{display:"max-height",type:"multi",target:["max-height"],rowClass:"propertiesSectionHidden"},{display:"min-width",type:"multi",target:["min-width"],rowClass:"propertiesSectionHidden"},{display:"max-width",type:"multi",target:["max-width"],rowClass:"propertiesSectionHidden"},{html:"&nbsp;",rowClass:"propertiesSectionHidden"}]},{display:"position",type:"combo",target:["position"],values:["","absolute","fixed","relative","static"]},{display:"left",type:"multi",target:["left"],values:["","0px","1em"]},{display:"top",type:"multi",target:["top"],values:["","0px","1em"]},{display:"right",type:"multi",target:["right"],values:["","0px","1em"]},{display:"bottom",type:"multi",target:["bottom"],values:["","0px","1em"]},{display:"display",type:"combo",target:["display"],values:["","none","block","inline","inline-block"]},{display:"opacity",type:"multi",target:["opacity"],values:["0","0.5","1.0"]},{display:"box-shadow",type:"text",target:["box-shadow"],value:["","none","1px 1px rgba(0,0,0,.5)"]},{display:"float",type:"combo",target:["float"],values:["","none","left","right"]},{display:"clear",type:"combo",target:["clear"],values:["","none","left","right","both"]},{display:"overflow",type:"combo",target:["overflow"],values:["","visible","hidden","scroll","auto"]},{display:"z-index",type:"multi",target:["z-index"],values:["","auto","0","1","100","-1","-100"]},{display:"box-sizing",type:"combo",target:["box-sizing","-webkit-box-sizing","-ms-box-sizing","-moz-box-sizing"],values:["","content-box","border-box"]}]},{key:"padding",className:"maqPropertySection",addCommonPropertiesAtTop:true,pageTemplate:[{display:"<b>(padding)</b>",type:"multi",target:["padding"],values:["","0px","1em"]},{key:"showtrbl",display:"&nbsp;&nbsp;&nbsp;",type:"toggleSection",pageTemplate:[{display:"padding-top",type:"multi",target:["padding-top"],values:["","0px","1em"],rowClass:"propertiesSectionHidden"},{display:"padding-right",type:"multi",target:["padding-right"],values:["","0px","1em"],rowClass:"propertiesSectionHidden"},{display:"padding-bottom",type:"multi",target:["padding-bottom"],values:["","0px","1em"],rowClass:"propertiesSectionHidden"},{display:"padding-left",type:"multi",target:["padding-left"],values:["","0px","1em"],rowClass:"propertiesSectionHidden"}]}]},{key:"margins",className:"maqPropertySection",addCommonPropertiesAtTop:true,pageTemplate:[{display:"<b>(margin)</b>",type:"multi",target:["margin"],values:["","0px","1em"]},{key:"showtrbl",display:"&nbsp;&nbsp;&nbsp;",type:"toggleSection",pageTemplate:[{display:"margin-top",type:"multi",target:["margin-top"],values:["","0px","1em"],rowClass:"propertiesSectionHidden"},{display:"margin-right",type:"multi",target:["margin-right"],values:["","0px","1em"],rowClass:"propertiesSectionHidden"},{display:"margin-bottom",type:"multi",target:["margin-bottom"],values:["","0px","1em"],rowClass:"propertiesSectionHidden"},{display:"margin-left",type:"multi",target:["margin-left"],values:["","0px","1em"],rowClass:"propertiesSectionHidden"}]}]},{key:"background",className:"maqPropertySection",addCommonPropertiesAtTop:true,pageTemplate:[{display:"background-color",type:"background",target:["background-color"],colorswatch:true},{display:"background-image",type:"background",target:["background-image"],values:["","none"]},{display:"background-repeat",type:"background",values:["","repeat","repeat-x","repeat-y","no-repeat"],target:["background-repeat"]},{display:"background-position",type:"background",target:["background-position"],values:["","0px 0px","0% 0%","left top","center center","right bottom"]},{display:"background-size",type:"background",target:["background-size"],values:["","auto","contain","cover","100%"]},{display:"background-origin",type:"background",target:["background-origin"],values:["","border-box","padding-box","content-box"]},{display:"background-clip",type:"background",target:["background-clip"],values:["","border-box","padding-box","content-box"]}]},{key:"border",className:"maqPropertySection",addCommonPropertiesAtTop:true,pageTemplate:[{display:"<b>(border)</b>",type:"multi",target:["border"],values:["","none","1px solid black"]},{display:"show",type:"combo",values:["none","props","sides","all"],id:"properties_show_select",onchange:function(_1a58){
if(typeof _1a58!="number"){
return;
}
var _1a59=function(_1a5a,first,last,begin,end){
for(var k=first;k<=last;k++){
var _1a5b=_1a5a[k];
var _1a5c=dojo.byId(_1a5b.rowId);
if(k>=begin&&k<=end){
dojo.removeClass(_1a5c,"propertiesSectionHidden");
}else{
dojo.addClass(_1a5c,"propertiesSectionHidden");
}
}
};
if(this.pageTemplate){
var _1a5d=this.pageTemplate[_1a58];
var value;
if(_1a5d&&_1a5d.id){
value=dojo.byId(_1a5d.id).value;
}
if(dojo.isString(value)){
if(value==="none"){
_1a59(this.pageTemplate,2,20,-1,-1);
}else{
if(value==="sides"){
_1a59(this.pageTemplate,2,20,2,5);
}else{
if(value==="props"){
_1a59(this.pageTemplate,2,20,6,8);
}else{
if(value==="all"){
_1a59(this.pageTemplate,2,20,9,20);
}
}
}
}
}
}
}},{display:"border-top",type:"multi",target:["border-top"],values:["","none","1px solid black"],rowClass:"propertiesSectionHidden"},{display:"border-right",type:"multi",target:["border-right"],values:["","none","1px solid black"],rowClass:"propertiesSectionHidden"},{display:"border-bottom",type:"multi",target:["border-bottom"],values:["","none","1px solid black"],rowClass:"propertiesSectionHidden"},{display:"border-left",type:"multi",target:["border-left"],values:["","none","1px solid black"],rowClass:"propertiesSectionHidden"},{display:"border-width",type:"multi",target:["border-width"],values:["","1px","1em"],rowClass:"propertiesSectionHidden"},{display:"border-style",type:"multi",target:["border-style"],values:["","none","solid","dotted","dashed"],rowClass:"propertiesSectionHidden"},{display:"border-color",type:"color",target:["border-color"],rowClass:"propertiesSectionHidden"},{display:"border-top-width",type:"multi",target:["border-top-width"],values:["","1px","1em"],rowClass:"propertiesSectionHidden"},{display:"border-top-style",type:"multi",target:["border-top-style"],values:["","none","solid","dotted","dashed"],rowClass:"propertiesSectionHidden"},{display:"border-top-color",type:"color",target:["border-top-color"],rowClass:"propertiesSectionHidden"},{display:"border-right-width",type:"multi",target:["border-right-width"],values:["","1px","1em"],rowClass:"propertiesSectionHidden"},{display:"border-right-style",type:"multi",target:["border-right-style"],values:["","none","solid","dotted","dashed"],rowClass:"propertiesSectionHidden"},{display:"border-right-color",type:"color",target:["border-right-color"],rowClass:"propertiesSectionHidden"},{display:"border-bottom-width",type:"multi",target:["border-bottom-width"],values:["","1px","1em"],rowClass:"propertiesSectionHidden"},{display:"border-bottom-style",type:"multi",target:["border-bottom-style"],values:["","none","solid","dotted","dashed"],rowClass:"propertiesSectionHidden"},{display:"border-bottom-color",type:"color",target:["border-bottom-color"],rowClass:"propertiesSectionHidden"},{display:"border-left-width",type:"multi",target:["border-left-width"],values:["","1px","1em"],rowClass:"propertiesSectionHidden"},{display:"border-left-style",type:"multi",target:["border-left-style"],values:["","none","solid","dotted","dashed"],rowClass:"propertiesSectionHidden"},{display:"border-left-color",type:"color",target:["border-left-color"],rowClass:"propertiesSectionHidden"},{display:"border-collapse",type:"combo",target:["border-collapse"],values:["","separate","collapse"]},{display:"<b>(border-radius)</b>",type:"multi",target:["border-radius","-moz-border-radius"],values:["","0px","6px"]},{key:"showDetails",display:"",type:"toggleSection",pageTemplate:[{display:"border-top-left-radius",type:"multi",target:["border-top-left-radius","-moz-border-radius-topleft"],values:["","0px","6px"],rowClass:"propertiesSectionHidden"},{display:"border-top-right-radius",type:"multi",target:["border-top-right-radius","-moz-border-radius-topright"],values:["","0px","6px"],rowClass:"propertiesSectionHidden"},{display:"border-bottom-right-radius",type:"multi",target:["border-bottom-right-radius","-moz-border-radius-bottomright"],values:["","0px","6px"],rowClass:"propertiesSectionHidden"},{display:"border-bottom-left-radius",type:"multi",target:["border-bottom-left-radius","-moz-border-radius-bottomleft"],values:["","0px","6px"],rowClass:"propertiesSectionHidden"}]}]},{key:"fontsAndText",className:"maqPropertySection",addCommonPropertiesAtTop:true,pageTemplate:[{display:"font",type:"text",target:["font"]},{display:"font-family",type:"font",target:["font-family"]},{display:"size",type:"multi",target:["font-size"],values:["","100%","1em","10px","10pt"]},{display:"color",type:"color",target:["color"]},{display:"font-weight",type:"combo",target:["font-weight"],values:["","normal","bold"]},{display:"font-style",type:"combo",target:["font-style"],values:["","normal","italic"]},{display:"text-decoration",type:"combo",target:["text-decoration"],values:["","none","underline","line-through"]},{display:"text-align",type:"combo",target:["text-align"],values:["","left","center","right","justify"]},{display:"vertical-align",type:"combo",target:["vertical-align"],values:["","baseline","top","middle","bottom"]},{display:"white-space",type:"combo",target:["white-space"],values:["","normal","nowrap","pre","pre-line","pre-wrap"]},{display:"text-indent",type:"multi",target:["text-indent"],values:["","0","1em","10px"]},{display:"line-height",type:"multi",target:["line-height"],values:["","normal","1.2","120%"]}]},{key:"shapesSVG",className:"maqPropertySection",addCommonPropertiesAtTop:true,pageTemplate:[{display:"stroke",type:"color",target:["stroke"]},{display:"stroke-width",type:"multi",target:["stroke-width"],values:["","1","2","3","4","5","10"]},{display:"fill",type:"color",target:["fill"]}]}],buildRendering:function(){
this.domNode=dojo.doc.createElement("div");
dojo.addClass(this.domNode,"propertiesContent");
var _1a5e="";
_1a5e+=this._titleBarDiv;
_1a5e+="<div class='propertiesToolBar' dojoType='davinci.ve.widgets.WidgetToolBar'></div>";
_1a5e+="<div dojoType='davinci.ve.widgets.WidgetProperties'></div>";
_1a5e+="<div class='propScrollableArea'>";
_1a5e+="<table class='propRootDetailsContainer'>";
_1a5e+="<tr>";
_1a5e+="<td class='propPaletteRoot'>";
var _1a5f=veNls;
for(var i=0;i<this.pageTemplate.length;i++){
this.pageTemplate[i].title=_1a5f[this.pageTemplate[i].key]?_1a5f[this.pageTemplate[i].key]:"Key not found";
if(this.pageTemplate[i].pageTemplate){
for(var j=0;j<this.pageTemplate[i].pageTemplate.length;j++){
if(this.pageTemplate[i].pageTemplate[j].key){
this.pageTemplate[i].pageTemplate[j].display+=_1a5f[this.pageTemplate[i].pageTemplate[j].key]?_1a5f[this.pageTemplate[i].pageTemplate[j].key]:"Key not found";
}
}
}
}
this.domNode.innerHTML=_1a5e;
this.inherited(arguments);
},_widgetValuesChanged:function(event){
var _1a60=this._currentPropSection;
if(_1a60){
var found=false;
for(var _1a61=0;_1a61<this.pageTemplate.length;_1a61++){
if(this.pageTemplate[_1a61].key==_1a60){
found=true;
break;
}
}
if(found){
var _1a62=this._getVisibleCascade(_1a61);
for(var i=0;i<_1a62.length;i++){
_1a62[i]._widgetValuesChanged(event);
}
}
}
},_getVisibleCascade:function(_1a63){
if(_1a63){
return this.pageTemplate[_1a63]["cascade"];
}
var _1a64=[];
var _1a65=this._currentPropSection;
if(_1a65){
for(var i=0;i<this.pageTemplate.length;i++){
if(this.pageTemplate[i].key==_1a65){
_1a64=_1a64.concat(this.pageTemplate[i]["cascade"]);
break;
}
}
}
return _1a64;
},_updatePaletteValues:function(_1a66){
if(!this._editor){
return;
}
var _1a67=_1a66[0];
this._widget=_1a67;
this._subwidget=_1a67&&_1a67.subwidget;
this.setReadOnly(!(this._widget||this._subwidget));
var _1a68=this._getVisibleCascade();
for(var i=0;i<_1a68.length;i++){
_1a68[i]._widgetSelectionChanged(_1a66);
}
},_widgetSelectionChanged:function(_1a69){
this._updatePaletteValues(_1a69);
},_stateChanged:function(){
var _1a6a=this._widget?[this._widget]:[];
this._updatePaletteValues(_1a6a);
},_widgetPropertiesChanged:function(_1a6b){
if((!this._widget)||(this._widget.type===_1a6b[0].type)){
this._updatePaletteValues(_1a6b);
}
},_titlePaneOpen:function(index){
var _1a6c=this._getVisibleCascade(index);
for(var i=0;i<_1a6c.length;i++){
_1a6c[i]._editorSelected({"editor":this._editor});
}
},startup:function(){
this.domNode.style.height="100%";
this._editor=_1a4e.currentEditor;
this.inherited(arguments);
for(var i=0;i<this.pageTemplate.length;i++){
var _1a6d=this.pageTemplate[i];
if(_1a6d.pageTemplate){
for(var j=0;j<_1a6d.pageTemplate.length;j++){
var _1a6e=_1a6d.pageTemplate[j];
if(_1a6e.onchange&&_1a6e.id){
dojo.connect(dojo.byId(_1a6e.id),"onchange",dojo.hitch(_1a6d,_1a6e.onchange,j));
}
}
}
}
for(var v=0;v<this.pageTemplate.length;v++){
this.pageTemplate[v]["cascade"]=[];
}
this.setReadOnly(true);
this.onEditorSelected();
dojo.subscribe("/davinci/ui/widgetValuesChanged",dojo.hitch(this,this._widgetValuesChanged));
dojo.subscribe("/davinci/ui/widgetPropertiesChanged",dojo.hitch(this,this._widgetPropertiesChanged));
},setReadOnly:function(_1a6f){
for(var v=0;v<this.pageTemplate.length;v++){
var page=this.pageTemplate[v]["pageTemplate"];
if(!page){
continue;
}
for(var i=0;i<page.length;i++){
var _1a70=page[i]["widget"];
if(_1a70){
_1a70.set("readOnly",_1a6f);
}else{
var node=page[i].domNode;
if(node){
dojo.attr(node,"disabled",_1a6f);
}
}
}
}
},_modelEntryById:function(id){
for(var v=0;v<this.pageTemplate.length;v++){
var page=this.pageTemplate[v]["pageTemplate"];
if(!page){
continue;
}
for(var i=0;i<page.length;i++){
var _1a71=page[i]["id"];
if(id==_1a71){
return page[i];
}
}
}
},_editorSelected:function(_1a72){
this._editor=_1a72.editor;
this.onEditorSelected(this._editor);
var _1a73=this.getParent();
var _1a74=_1a73.selectedChildWidget;
var _1a75=false;
var _1a76=dojo.query(".maqPropertySection",_1a73.domNode);
if(this._editor){
if(this._editor.declaredClass!="davinci.ve.PageEditor"&&this._editor.declaredClass!="davinci.ve.themeEditor.ThemeEditor"){
_1a76.forEach(function(_1a77){
var _1a78=dijit.byNode(_1a77);
_1a78.controlButton.domNode.style.display="none";
if(_1a78==_1a74){
_1a75=true;
}
});
}else{
_1a76.forEach(function(_1a79){
var _1a7a=dijit.byNode(_1a79);
_1a7a.controlButton.domNode.style.display="";
});
if(this._editor.declaredClass=="davinci.ve.themeEditor.ThemeEditor"){
var _1a7b=dojo.query(".page_editor_only",_1a73.domNode);
_1a7b.forEach(function(_1a7c){
var _1a7d=dijit.byNode(_1a7c);
_1a7d.controlButton.domNode.style.display="none";
if(_1a7d==_1a74){
_1a75=true;
}
});
}
}
}else{
_1a76.forEach(function(_1a7e){
var _1a7f=dijit.byNode(_1a7e);
_1a7f.controlButton.domNode.style.display="";
});
_1a75=true;
}
if(_1a75){
this._selectFirstVisibleTab();
}
},onEditorSelected:function(){
this._widget=null;
this._subWidget=null;
this._updateToolBars();
if(this._oldClassName){
dojo.removeClass(this.domNode.parentNode.parentNode,this._oldClassName);
}
if(!this._editor){
return;
}
if(this._editor){
this._oldClassName=this._editor.editorID.replace(/\./g,"_");
dojo.addClass(this.domNode.parentNode.parentNode,this._oldClassName);
}
var _1a80=this._currentPropSection;
var _1a81=dojo.query(".propSectionButton",this.domNode);
for(var i=0;i<_1a81.length;i++){
var _1a82=_1a81[i];
if(this._editor&&this._editor.supports&&this._editor.supports("propsect_"+this.pageTemplate[i].key)){
dojo.removeClass(_1a82,"dijitHidden");
}else{
dojo.addClass(_1a82,"dijitHidden");
if(_1a80==this.pageTemplate[i].key){
_1a50.showRoot();
}
}
}
var _1a83=[];
for(var i=0;i<this.pageTemplate.length;i++){
var _1a84=this.pageTemplate[i]["cascade"];
if(_1a84){
_1a83=_1a83.concat(_1a84);
}else{
}
}
for(var i=0;i<_1a83.length;i++){
var _1a84=_1a83[i];
if(_1a84._editorSelected){
_1a84._editorSelected({"editor":this._editor});
}
}
},_destroyContent:function(){
var _1a85=(this.containerNode||this.domNode);
dojo.forEach(dojo.query("[widgetId]",_1a85).map(dijit.byNode),function(w){
w.destroy();
});
while(_1a85.firstChild){
dojo._destroyElement(_1a85.firstChild);
}
dojo.forEach(this._tooltips,function(t){
t.destroy();
});
this._tooltips=undefined;
},sectionTitleFromKey:function(key){
for(var i=0;i<this.pageTemplate.length;i++){
if(this.pageTemplate[i].key==key){
return this.pageTemplate[i].title;
}
}
},_initialPerspectiveReady:function(){
if(!this._alreadySplitIntoMultipleTabs){
var _1a86=this.getParent();
dojo.addClass(_1a86.domNode,"propRootDetailsContainer");
dojo.addClass(_1a86.domNode,"propertiesContent");
for(var i=0;i<this.pageTemplate.length;i++){
var key=this.pageTemplate[i].key;
var title=this.pageTemplate[i].title;
var _1a87=this.pageTemplate[i].className;
if(!_1a87){
_1a87="";
}
var _1a88=this._titleBarDiv;
_1a88+="<div class='propertiesToolBar' dojoType='davinci.ve.widgets.WidgetToolBar'></div>";
_1a88+="<div class='cascadeBackButtonDiv'><button onclick='davinci.ve.widgets.HTMLStringUtil.showSection(\""+key+"\",\""+title+"\")'>"+title+" "+veNls.properties+"</button></div>";
var _1a89=_1a50.generateTemplate(this.pageTemplate[i]);
var _1a8a=_1a88+_1a89;
if(i==0){
cp=this;
cp.set("title",title);
dojo.addClass(cp.domNode,_1a87);
}else{
var cp=new _1a4d({title:title,content:_1a8a,"class":_1a87});
_1a86.addChild(cp);
}
cp._maqPropGroup=this.pageTemplate[i].key;
var _1a8b=dojo.query(".paletteCloseBox",cp.domNode);
if(_1a8b.length>0){
var _1a8c=_1a8b[0];
dojo.connect(_1a8c,"click",this,function(event){
davinci.Workbench.collapsePaletteContainer(event.currentTarget);
});
}
}
for(var v=0;v<this.pageTemplate.length;v++){
this.pageTemplate[v]["cascade"]=[];
var page=this.pageTemplate[v]["pageTemplate"];
if(!page){
continue;
}
for(var i=0;i<page.length;i++){
var id=page[i]["id"];
var _1a8d=dijit.byId(id);
if(_1a8d){
page[i]["widget"]=_1a8d;
}else{
_1a8d=dojo.byId(id);
if(_1a8d){
page[i]["domNode"]=_1a8d;
}
}
}
var _1a8e=this.pageTemplate[v].id;
var _1a8f=dojo.query("#"+_1a8e+" .CascadeTop");
_1a8f.forEach(function(_1a90){
return function(p){
var _1a91=dijit.byId(p.id);
_1a90["cascade"].push(_1a91);
};
}(this.pageTemplate[v]));
}
dojo.connect(_1a86,"selectChild",this,function(tab){
if(tab.controlButton.domNode.style.display=="none"){
if(!this._recursiveSelectChildInProcess){
this._recursiveSelectChildInProcess=true;
this._selectFirstVisibleTab();
delete this._recursiveSelectChildInProcess;
return;
}
}
if(tab._maqPropGroup){
this._currentPropSection=tab._maqPropGroup;
var _1a92=(this._editor&&this._editor.getContext)?this._editor.getContext():null;
var _1a93=(_1a92&&_1a92.getSelection)?_1a92.getSelection():[];
this._updatePaletteValues(_1a93);
_1a50._initSection(this._currentPropSection);
}
});
this._alreadySplitIntoMultipleTabs=true;
}
},_workbenchReady:function(){
this._updateToolBars();
},_updateToolBars:function(){
var _1a94=dojo.query(".propertiesToolBar");
_1a94.forEach(function(_1a95){
if(this._editor&&this._editor.declaredClass=="davinci.ve.PageEditor"){
dojo.removeClass(_1a95,"dijitHidden");
_1a95.style.display="";
}else{
dojo.addClass(_1a95,"dijitHidden");
}
}.bind(this));
},_selectFirstVisibleTab:function(){
var _1a96=this.getParent();
var _1a97=_1a96.getChildren();
for(var i=0;i<_1a97.length;i++){
var cp=_1a97[i];
if(cp.controlButton.domNode.style.display!="none"){
_1a96._maqDontExpandCollapse=true;
_1a96.selectChild(cp);
delete _1a96._maqDontExpandCollapse;
break;
}
}
}});
});
},"davinci/ui.plugin":function(){
define("davinci/ui.plugin",["require","davinci/css!./ui.css"],function(_1a98){
return {id:"davinci.ui","davinci.view":[{id:"navigator",title:"Files",viewClass:"davinci/workbench/Explorer",iconClass:"paletteIcon paletteIconFiles"},{id:"hierarchy",title:"Hierarchy"},{id:"outline",title:"Outline",viewClass:"davinci/workbench/OutlineView",iconClass:"paletteIcon paletteIconOutline"},{id:"comment",title:"Comments",viewClass:"davinci/review/view/CommentView",iconClass:"paletteIcon paletteIconComments"},{id:"scope",title:"Scope"},{id:"properties",title:"Properties",viewClass:"davinci/workbench/PropertyEditor"},{id:"problems",title:"Problems",viewClass:"davinci/workbench/ProblemsView"},{id:"console",title:"Console"},{id:"history",title:"History"},{id:"search",title:"Search"}],"davinci.preferences":[{name:"Project",id:"project",category:"",pageContent:"Project Settings here"},{name:"Project Settings",id:"ProjectPrefs",category:"davinci.ui.project",pane:"davinci/ui/ProjectPreferences",defaultValues:{"webContentFolder":"","themeFolder":"themes","widgetFolder":"lib/custom"}}],"davinci.perspective":{id:"main",title:"AJAX IDE",views:[{viewID:"davinci.ui.navigator",position:"left-bottom"},{viewID:"davinci.ui.outline",position:"right"},{viewID:"davinci.ui.properties",position:"right-bottom"}]},"davinci.actionSets":[{id:"editorActions",visible:true,menu:[{__mainMenu:true,separator:["new",false,"open",false]},{label:"Create",path:"new",id:"davinci.new",separator:["newApp",true,"newSketch",true,"newFolder",true,"newTheme",true,"newProject",true,"additions",true]},{label:"Open",path:"open",id:"davinci.open",separator:["openFile",true,"openTheme",true,"openProject",true,"openOrion",true,"additions",false]}],actions:[{id:"newHTMLMobile",run:function(){
_1a98(["./ui/Resource"],function(r){
r.newHTMLMobile();
});
},iconClass:"newOpenMenuItem newMobileAppMenuItem",label:"Mobile Application...",menubarPath:"davinci.new/newApp"},{id:"newHTMLDesktop",run:function(){
_1a98(["./ui/Resource"],function(r){
r.newHTMLDesktop();
});
},iconClass:"newOpenMenuItem newDesktopAppMenuItem",label:"Desktop Application...",menubarPath:"davinci.new/newApp"},{id:"newHTMLSketchHiFi",run:function(){
_1a98(["./ui/Resource"],function(r){
r.newHTMLSketchHiFi();
});
},iconClass:"newOpenMenuItem newSketchHiFiMenuItem",label:"Sketch (high-fidelity)...",menubarPath:"davinci.new/newSketch"},{id:"newHTMLSketchLoFi",run:function(){
_1a98(["./ui/Resource"],function(r){
r.newHTMLSketchLoFi();
});
},iconClass:"newOpenMenuItem newSketchLoFiMenuItem",label:"Sketch (low-fidelity)...",menubarPath:"davinci.new/newSketch"},{id:"newFolder",run:function(){
_1a98(["./ui/Resource"],function(r){
r.newFolder();
});
},iconClass:"newOpenMenuItem newFolderMenuItem",label:"Folder...",menubarPath:"davinci.new/newFolder"},{id:"newCSS",run:function(){
_1a98(["./ui/Resource"],function(r){
r.newCSS();
});
},iconClass:"newOpenMenuItem newCSSMenuItem",label:"CSS File...",menubarPath:"davinci.new/newFolder"},{id:"newJS",run:function(){
_1a98(["./ui/Resource"],function(r){
r.newJS();
});
},iconClass:"newOpenMenuItem newJSMenuItem",label:"JavaScript File...",menubarPath:"davinci.new/newFolder"},{id:"newTheme",run:function(){
_1a98(["davinci/Workbench","davinci/ui/NewTheme"],function(_1a99,_1a9a){
_1a99.showModal(new _1a9a(),"New Theme",{width:300},null,true);
});
},iconClass:"newOpenMenuItem newThemeMenuItem",label:"Theme...",menubarPath:"davinci.new/newTheme"},{id:"newProject",run:function(){
_1a98(["./ui/Resource"],function(r){
r.newProject();
});
},iconClass:"newOpenMenuItem newProjectMenuItem",label:"Project...",menubarPath:"davinci.new/newProject"},{id:"openFile",run:function(){
_1a98(["./ui/Resource"],function(r){
r.openFile();
});
},iconClass:"newOpenMenuItem openFileMenuItem",label:"File...",toolbarPath:"davinci.toolbar.main/edit",menubarPath:"davinci.open/openFile",keyBinding:{accel:true,charOrCode:"o"}},{id:"openThemeEditor",run:function(){
_1a98(["davinci/Workbench","davinci/ui/OpenThemeDialog"],function(_1a9b,_1a9c){
_1a9b.showModal(new _1a9c(),"Open Theme",{width:200},null,true);
});
},iconClass:"newOpenMenuItem openThemeMenuItem",label:"Theme Editor...",menubarPath:"davinci.open/openTheme"},{id:"openReview",run:function(){
_1a98(["./ui/Resource"],function(r){
r.openFile();
});
},run:function(){
_1a98(["davinci/Workbench","davinci/review/widgets/OpenReviewDialog"],function(_1a9d,_1a9e){
_1a9d.showModal(new _1a9e(),"Open Review",{width:350,height:250});
});
},iconClass:"newOpenMenuItem openReviewMenuItem",label:"Review...",menubarPath:"davinci.open/openTheme"},{id:"openProject",run:function(){
_1a98(["davinci/Workbench","davinci/ui/SelectProjectDialog"],function(_1a9f,_1aa0){
_1a9f.showModal(new _1aa0(),"Open Project",{width:300},null,true);
});
},iconClass:"newOpenMenuItem newProjectMenuItem",label:"Project...",menubarPath:"davinci.open/openProject"},{id:"orionNavigator",run:function(){
window.open("/navigate/table.html#","_blank");
window.focus();
},iconClass:"newOpenMenuItem orionIcon",label:"Orion Navigator",menubarPath:"davinci.open/openOrion"}]},{id:"main",visible:true,menu:[{__mainMenu:true,separator:["usersettings",false,"settings",false,"additions",false,"help",false]},{label:"UserSettings",path:"usersettings",id:"davinci.usersettings",className:"userSettingsMenu",iconClass:"userSettingsMenuIcon",showLabel:false,separator:["username",true,"logout",true,"additions",false]},{label:"Settings",path:"settings",id:"davinci.settings",className:"appSettingsMenu",iconClass:"appSettingsMenuIcon",showLabel:false,separator:["settings",true,"additions",false]},{label:"Help",path:"help",id:"davinci.help",className:"helpMenu",iconClass:"helpMenuIcon",showLabel:false,separator:["help",true,"about",false,"additions",false]}],actions:[{id:"editPreferences",run:function(){
_1a98(["davinci/workbench/Preferences"],function(_1aa1){
_1aa1.showPreferencePage();
});
},label:"Preferences...",menubarPath:"davinci.settings/settings"},{id:"editThemeSets",run:function(){
_1a98(["davinci/ui/ThemeSetsDialog"],function(_1aa2){
_1aa2();
});
},label:"Theme sets...",menubarPath:"davinci.settings/settings"},{id:"showHelp",run:function(){
window.open("app/docs/index.html","MaqettaDocumentation");
},label:"Documentation",menubarPath:"davinci.help/help",keyBinding:{charOrCode:dojo.keys.F1}},{id:"showTutotials",run:function(){
window.open("app/docs/index.html#tutorials/tutorials","MaqettaTutorials");
},label:"Tutorials",menubarPath:"davinci.help/help"},{id:"showVideos",run:function(){
window.open("http://www.youtube.com/user/Maqetta/","MaqettaVideos");
},label:"Videos",menubarPath:"davinci.help/help"},{id:"showCheatSheets",run:function(){
window.open("app/docs/index.html#cheatsheets/cheatsheets","MaqettaCheatSheets");
},label:"Cheat sheets",menubarPath:"davinci.help/help"},{id:"showHowTo",run:function(){
window.open("https://www.ibm.com/search/csass/search/?sn=dw&en=utf&hpp=20&dws=dw&q=maqetta&Search=Search","MaqettaHowTo");
},label:"How-to articles",menubarPath:"davinci.help/help"},{id:"about",run:function(){
_1a98(["davinci/ui/about"],function(about){
about.show();
});
},label:"About Maqetta",menubarPath:"davinci.help/about"},{id:"username",action:"davinci/actions/UserNameAction",run:function(){
},label:"{user}",menubarPath:"davinci.usersettings/username"},{id:"logout",action:"davinci/actions/LogoutAction",label:"Logout",menubarPath:"davinci.usersettings/logout"}]},{id:"explorerActions",visible:true,actions:[{id:"davinci.ui.newfile",label:"New folder...",iconClass:"newFolderIcon",run:function(){
_1a98(["./ui/Resource"],function(r){
r.newFolder();
});
},isEnabled:function(item){
return _1a98("./ui/Resource").canModify(item);
},menubarPath:"newfolder"},{id:"davinci.ui.addFiles",label:"Upload files...",iconClass:"uploadIcon",run:function(){
_1a98(["./ui/Resource"],function(r){
r.addFiles();
});
},isEnabled:function(item){
return _1a98("./ui/Resource").canModify(item);
},menubarPath:"addFiles"},{id:"davinci.ui.rename",label:"Rename...",iconClass:"renameIcon",run:function(){
_1a98(["./ui/Resource"],function(r){
r.renameAction();
});
},isEnabled:function(item){
return _1a98("./ui/Resource").canModify(item);
},menubarPath:"addFiles"},{id:"davinci.ui.delete",label:"Delete",iconClass:"deleteIcon",isEnabled:function(item){
return _1a98("./ui/Resource").canModify(item);
},run:function(){
_1a98(["./ui/Resource"],function(r){
r.deleteAction();
});
},menubarPath:"delete",keyBinding:{charOrCode:[dojo.keys.DELETE,dojo.keys.BACKSPACE]}},{id:"davinci.ui.download",label:"Download",iconClass:"downloadSomeIcon",action:"davinci/actions/DownloadAction",isEnabled:function(item){
return _1a98("./ui/Resource").canModify(item);
},menubarPath:"delete"}]}],"davinci.actionSetPartAssociations":[{targetID:"davinci.ui.editorActions",parts:["davinci.ui.editorMenuBar"]},{targetID:"davinci.ui.explorerActions",parts:["davinci.ui.navigator"]}],"davinci.viewActions":[{viewContribution:{targetID:"davinci.ui.problems",actions:[{id:"Copy2",iconClass:"copyIcon",run:function(){
alert("view toolbar");
},label:"Copy",toolbarPath:"davinci.toolbar.main/edit",menubarPath:"davinci.edit/cut"}]}},{viewContribution:{targetID:"workbench.Explorer",actions:[{id:"download",iconClass:"downloadAllIcon",run:function(){
_1a98(["./Workbench","./ui/Download"],function(_1aa3,_1aa4){
_1aa3.showModal(new _1aa4(),"Download",{width:440});
});
},label:"Download Entire Workspace",toolbarPath:"download"},{id:"download",iconClass:"downloadSomeIcon",run:function(){
_1a98(["./Workbench","./ui/DownloadSelected"],function(_1aa5,_1aa6){
_1aa5.showModal(new _1aa6(),"Download",{width:440});
});
},label:"Download Selected Files",toolbarPath:"download"},{id:"userlibs",iconClass:"userLibIcon",run:function(){
_1a98(["./Workbench","./ui/UserLibraries"],function(_1aa7,_1aa8){
_1aa7.showModal(new _1aa8(),"User Libraries","width: 400px");
});
},label:"Modify Libraries",toolbarPath:"download"}]}}]};
});
},"dojo/dnd/move":function(){
define("dojo/dnd/move",["../_base/declare","../dom-geometry","../dom-style","./common","./Mover","./Moveable"],function(_1aa9,_1aaa,_1aab,dnd,Mover,_1aac){
var _1aad=_1aa9("dojo.dnd.move.constrainedMoveable",_1aac,{constraints:function(){
},within:false,constructor:function(node,_1aae){
if(!_1aae){
_1aae={};
}
this.constraints=_1aae.constraints;
this.within=_1aae.within;
},onFirstMove:function(mover){
var c=this.constraintBox=this.constraints.call(this,mover);
c.r=c.l+c.w;
c.b=c.t+c.h;
if(this.within){
var mb=_1aaa.getMarginSize(mover.node);
c.r-=mb.w;
c.b-=mb.h;
}
},onMove:function(mover,_1aaf){
var c=this.constraintBox,s=mover.node.style;
this.onMoving(mover,_1aaf);
_1aaf.l=_1aaf.l<c.l?c.l:c.r<_1aaf.l?c.r:_1aaf.l;
_1aaf.t=_1aaf.t<c.t?c.t:c.b<_1aaf.t?c.b:_1aaf.t;
s.left=_1aaf.l+"px";
s.top=_1aaf.t+"px";
this.onMoved(mover,_1aaf);
}});
var _1ab0=_1aa9("dojo.dnd.move.boxConstrainedMoveable",_1aad,{box:{},constructor:function(node,_1ab1){
var box=_1ab1&&_1ab1.box;
this.constraints=function(){
return box;
};
}});
var _1ab2=_1aa9("dnd.move.parentConstrainedMoveable",_1aad,{area:"content",constructor:function(node,_1ab3){
var area=_1ab3&&_1ab3.area;
this.constraints=function(){
var n=this.node.parentNode,s=_1aab.getComputedStyle(n),mb=_1aaa.getMarginBox(n,s);
if(area=="margin"){
return mb;
}
var t=_1aaa.getMarginExtents(n,s);
mb.l+=t.l,mb.t+=t.t,mb.w-=t.w,mb.h-=t.h;
if(area=="border"){
return mb;
}
t=_1aaa.getBorderExtents(n,s);
mb.l+=t.l,mb.t+=t.t,mb.w-=t.w,mb.h-=t.h;
if(area=="padding"){
return mb;
}
t=_1aaa.getPadExtents(n,s);
mb.l+=t.l,mb.t+=t.t,mb.w-=t.w,mb.h-=t.h;
return mb;
};
}});
return {constrainedMoveable:_1aad,boxConstrainedMoveable:_1ab0,parentConstrainedMoveable:_1ab2};
});
},"davinci/de/resource":function(){
define("davinci/de/resource",["davinci/de/widgets/NewDijit","davinci/Workbench","davinci/workbench/Preferences","system/resource","davinci/Runtime","davinci/de/DijitTemplatedGenerator","davinci/library","davinci/ui/Dialog","davinci/ve/actions/ReplaceAction"],function(_1ab4,_1ab5,_1ab6,_1ab7,_1ab8,_1ab9,_1aba,_1abb,_1abc){
var dt={WIDGETS_JSON:{"name":"custom",longName:"Custom Widgets",version:"1.0",localPath:true,"categories":{"custom":{name:"User Widgets",description:"User Widgets",widgetClass:"dijit"}},widgets:[]},createDijiFromNewDialog:function(){
var _1abd=new _1ab4({});
var _1abe=_1ab5.getOpenEditor();
var _1abf=_1abe.fileName;
var _1ac0=_1ab7.findResource(_1abf);
var model=_1abe.model;
var _1ac1=_1ab5.getOpenEditor();
var _1ac2=_1ac1.getContext();
var _1ac3=_1ac2.getSelection();
if(!dt.validWidget(_1ac3)){
_1abb.showModal("Invalid Selection.  Please select a single container widget to create a new Widget","Error creating Widget...");
return;
}
_1ab5.showModal(_1abd,"Dijit Widget...",{height:160,width:250},function(){
if(!_1abd.cancel){
var _1ac4=_1abd.attr("value");
dt.createDijit(_1ac4,model,_1ac0,_1ac2,_1ac3);
if(_1ac4.replaceSelection){
var ra=new _1abc();
ra.run(_1ac2,_1ac4.group+"."+_1ac4.name);
}
}
return true;
});
},validWidget:function(_1ac5){
if(_1ac5==null||_1ac5.length!=1){
return false;
}
var _1ac6=_1ac5[0];
return (_1ac6.acceptsHTMLChildren);
},_createNameSpace:function(name,_1ac7){
var _1ac8=name.split(".");
var base=_1ab5.getProject();
_1ac7=_1ac7||_1ab7.findResource(base);
if(_1ac8.length>1){
for(var i=0;i<_1ac8.length-1;i++){
var _1ac9=_1ac7.getChildSync(_1ac8[i]);
if(_1ac9!=null){
_1ac7=_1ac9;
}else{
_1ac7=_1ac7.createResource(_1ac8[i],true);
}
}
}
return _1ac7;
},_createFolder:function(name,_1aca){
var _1acb=name.split("/");
var base=_1ab5.getProject();
_1aca=_1aca||_1ab7.findResource(base);
if(_1acb.length){
for(var i=0;i<_1acb.length;i++){
if(_1acb[i]=="."){
continue;
}
var _1acc=_1aca.getChildSync(_1acb[i]);
if(_1acc!=null){
_1aca=_1acc;
}else{
_1aca=_1aca.createResource(_1acb[i],true);
}
}
}
return _1aca;
},createDijit:function(_1acd,model,_1ace,_1acf,_1ad0){
var _1ad1=_1acd.group+"."+_1acd.name;
var base=_1ab5.getProject();
var prefs=_1ab6.getPreferences("davinci.ui.ProjectPrefs",base);
if(!prefs["widgetFolder"]){
prefs.widgetFolder="./WebContent/custom";
_1ab6.savePreferences("davinci.ui.ProjectPrefs",base,prefs);
}
var _1ad2=dt._createFolder(prefs["widgetFolder"]);
var _1ad3=dt._createNameSpace(_1ad1,_1ad2);
var _1ad4=_1ad3.getChildSync(_1acd.name+"_widgets.json");
if(_1ad4==null){
_1ad4=_1ad3.createResource(_1acd.name+"_widgets.json");
}
var _1ad5=dojo.clone(dt.WIDGETS_JSON);
_1ad5.widgets.push({name:_1acd.name,description:"Custom user widget "+_1acd.name,type:_1ad1,category:"custom",iconLocal:true,icon:"app/davinci/img/maqetta.png"});
_1ad4.setContents(dojo.toJson(_1ad5));
var _1ad6=_1ad2;
var _1ad7=new _1ab9({});
var _1ad8=_1ad7.buildSource(model,_1ad1,_1acd.name,false,_1acf,_1ad0);
for(var type in _1ad8){
switch(type){
case "amd":
break;
case "html":
var html=_1ad3.createResource(_1acd.name+".html");
html.setContents(_1ad8.html);
break;
case "js":
var _1ad9=_1ad3.createResource(_1acd.name+".js");
_1ad9.setContents(_1ad8.js);
break;
case "metadata":
var _1ada=_1ad3.createResource(_1acd.name+"_oam.json");
_1ada.setContents(_1ad8.metadata);
_1aba.addCustomWidgets(base,_1ad5);
break;
}
}
}};
return dt;
});
},"davinci/ui/dnd/DragSource":function(){
define(["dojo/_base/declare","dojo/fx"],function(_1adb,Fx){
return _1adb("davinci.ui.dnd.DragSource",null,{disabled:false,dragObject:null,dragClone:null,offsetParent:null,offsetParentCoords:null,parentCoords:null,refNode:null,positioning:null,useCurrentPositioning:true,targetShouldShowCaret:false,draggingMousePosition:"TopLeft",data:null,returnCloneOnFailure:true,constructor:function(node,type,data){
this.data=data;
var node=dojo.byId(node);
node.dragSource=this;
this.domNode=node;
this.dragObject=node;
this.refNode=node;
this.type=type;
this.offsetParent=dojo.doc.body;
},onDragDown:function(e){
if(this.useCurrentPositioning){
this.positioning=dojo.style(this.refNode,"position");
}
this.storeMouseDownInfo(e);
this.initDrag(e);
},onDragStart:function(e){
this.createDragClone(e);
e._dragClone=this.dragClone;
return this.dragClone;
},onDragMove:function(e){
if(this.draggingMousePosition=="TopLeft"){
this.dragClone.style.top=e.pageY+4+(e.documentY||0)+"px";
this.dragClone.style.left=e.pageX+4+(e.documentX||0)+"px";
}else{
if(this.draggingMousePosition=="ClickedPosition"){
this.dragClone.style.top=e.pageY-this.dragOffset.y+(e.documentY||0)+"px";
this.dragClone.style.left=e.pageX-this.dragOffset.x+(e.documentX||0)+"px";
}
}
if(this.dragClone.style.display=="none"){
this.dragClone.style.display="";
}
},onDragEnd:function(e){
if(e.dragStatus=="dropSuccess"||!this.returnCloneOnFailure){
this.removeClone();
}else{
if(e.dragStatus=="dropFailure"){
this.returnClone();
}else{
console.error("DragSource#onDragEnd: internal error: e.dragStatus is not set");
}
}
this.cleanupDrag();
},unregister:function(){
this.domNode.dragSource=null;
this.cleanupDrag();
},reregister:function(){
this.domNode.dragSource=this;
this.initDrag();
},storeMouseDownInfo:function(e){
if(dojo.isIE){
this.layerX=e.layerX+dojo._getBorderExtents(this.domNode).l;
this.layerY=e.layerY+dojo._getBorderExtents(this.domNode).t;
}else{
this.layerX=e.layerX-1;
this.layerY=e.layerY-1;
}
this.pageX=e.pageX;
this.pageY=e.pageY;
this.scrollOffset=dojo._docScroll();
this.dragStartPosition=dojo.position(this.refNode,true);
this.dragStartCssPosition={y:this.refNode.offsetTop,x:this.refNode.offsetLeft};
this.dragOffset={y:e.pageY-this.dragStartPosition.y,x:e.pageX-this.dragStartPosition.x};
this.offsetParentCoords=dojo.position(this.offsetParent,true);
var _1adc=dojo.position(this.domNode.parentNode,true);
this.parentCoords={y:_1adc.y-this.offsetParentCoords.y,x:_1adc.x-this.offsetParentCoords.x};
if(this.fixMouseDownInfo){
this.fixMouseDownInfo(this);
}
},initDrag:function(){
if(dojo.isIE){
dojo._event_listener.add(this.domNode,"ondragstart",this.cancelEvent);
}
},cleanupDrag:function(){
if(dojo.isIE){
dojo._event_listener.remove(this.domNode,"ondragstart",this.cancelEvent);
}
},createDragClone:function(e){
var _1add;
if(e.dragSource.dragHandler&&e.dragSource.dragHandler.createDragClone){
_1add=e.dragSource.dragHandler.createDragClone();
}else{
_1add=this.dragObject.cloneNode(true);
}
this.dragClone=_1add;
dojo.style(_1add,"opacity",0.5);
_1add.style.zIndex=1001000;
var box=dojo.contentBox(this.dragObject);
_1add.style.width=box.w+"px";
_1add.style.height=box.h+"px";
_1add.style.top=this.dragObject.offsetTop+4+"px";
_1add.style.left=this.dragObject.offsetLeft+4+"px";
_1add.style.position="absolute";
_1add.style.clear="both";
_1add.style.display="none";
this.offsetParent.appendChild(_1add);
},setDragTarget:function(node){
this.dragObject=node;
},cancelEvent:function(e){
e.stopPropagation();
e.preventDefault();
},removeClone:function(){
setTimeout(dojo.hitch(this,"removeClone_1"),0);
},removeClone_1:function(){
this.dragClone.parentNode.removeChild(this.dragClone);
this.dragClone=null;
},returnClone:function(){
var _1ade=dojo.position(this.dragClone,true);
var _1adf=this.dragStartPosition;
var _1ae0={x:_1ade.x>_1adf.x?_1adf.x-10:_1adf.x+10,y:_1ade.y>_1adf.y?_1adf.y-10:_1adf.y+10};
var _1ae1=this;
Fx.slideTo({node:this.dragClone,top:_1ae0.y,left:_1ae0.x,duration:400,onEnd:function(){
Fx.slideTo({node:_1ae1.dragClone,top:_1adf.y,left:_1adf.x,duration:100,onEnd:function(){
_1ae1.dragClone.parentNode.removeChild(_1ae1.dragClone);
_1ae1.dragClone=null;
_1ae1.onCloneReturned();
}}).play();
}}).play();
},onCloneReturned:function(){
},globalChangeCursor:function(_1ae2){
var sheet=dojo.doc.styleSheets[0];
if(!sheet){
return;
}
if(_1ae2){
if(this._showingCursor){
if(this._showingCursor==_1ae2){
return;
}
this.globalChangeCursor(null);
}
this._showingCursor=_1ae2;
if(dojo.isIE){
this._ruleIndex=sheet.rules.length;
sheet.addRule("*","{cursor:"+_1ae2+" ! important;}",sheet.rules.length);
this._prevCursor=dojo.doc.body.style.cursor;
dojo.doc.body.style.cursor=null;
}else{
this._ruleIndex=sheet.cssRules.length;
sheet.insertRule("*"+"{cursor:"+_1ae2+" ! important;}",sheet.cssRules.length);
}
}else{
if(!this._showingCursor){
return;
}
this._showingCursor=null;
if(dojo.isIE){
sheet.removeRule(this._ruleIndex);
dojo.doc.body.style.cursol=this._prevCursor!=null?this._prevCursor:"auto";
}else{
sheet.deleteRule(this._ruleIndex);
}
}
}});
});
},"dijit/PopupMenuBarItem":function(){
define("dijit/PopupMenuBarItem",["dojo/_base/declare","./PopupMenuItem","./MenuBarItem"],function(_1ae3,_1ae4,_1ae5){
var _1ae6=_1ae5._MenuBarItemMixin;
return _1ae3("dijit.PopupMenuBarItem",[_1ae4,_1ae6],{});
});
},"davinci/ve/commands/ModifyRuleCommand":function(){
define("davinci/ve/commands/ModifyRuleCommand",["dojo/_base/declare","../widget","../States"],function(_1ae7,_1ae8,_1ae9){
return _1ae7("davinci.ve.commands.ModifyRuleCommand",null,{name:"modify rule",constructor:function(_1aea,_1aeb,_1aec){
this.cssRule=_1aea;
this.values=_1aeb;
this.context=_1aec;
},execute:function(_1aed){
if(!this.context){
this.context=_1aed;
}
if(!this.cssRule||!this.values||!this.context){
return;
}
this._oldValues=this.cssRule.getProperties();
this.context.modifyRule(this.cssRule,this.values);
var file=this.cssRule.getCSSFile();
file.setDirty(true);
this.context.editor.setDirty(true);
_1ae9.resetState(this.context.rootNode);
if(this.context._selection){
this.context._forceSelectionChange=true;
}
},undo:function(){
if(!this.cssRule||!this._oldValues||!this.context){
return;
}
this.context.ruleSetAllProperties(this.cssRule,this._oldValues);
var file=this.cssRule.getCSSFile();
file.setDirty(true);
this.context.editor.setDirty(true);
_1ae9.resetState(this.context.rootNode);
if(this.context._selection){
this.context._forceSelectionChange=true;
}
}});
});
},"davinci/ve/actions/SelectAncestorAction":function(){
define(["dojo/_base/declare","davinci/ve/actions/_SelectAncestorAction","davinci/Workbench","dojo/i18n!davinci/ve/nls/ve"],function(_1aee,_1aef,_1af0,_1af1){
return _1aee("davinci.ve.actions.SelectAncestorAction",[_1aef],{run:function(_1af2){
_1af2=this.fixupContext(_1af2);
var _1af3=(_1af2&&_1af2.getSelection());
if(this.selectionSameParentNotBody(_1af3)){
var _1af4=[];
var _1af5=_1af3[0].getParent();
while(_1af5.domNode.tagName!="BODY"){
_1af4.push(_1af5);
_1af5=_1af5.getParent();
}
var _1af6="<div class=\"SelectAncestorLabel\">"+_1af1.selectAncestorLabel+"</div>"+"<select dojoType=\"dijit.form.Select\" id=\"SelectAncestor\" name=\"SelectAncestor\" style=\"width:12em;\">"+"<option value=\"-1\"></option>";
for(var i=0;i<_1af4.length;i++){
var label=require("davinci/ve/widget").getLabel(_1af4[i]);
_1af6+="<option value=\""+i+"\">"+label+"</option>";
}
_1af6+="</select><br/>";
var _1af7=_1af0.showMessage(_1af1.selectAncestorTitle,_1af6);
var _1af8=dijit.byId("SelectAncestor");
_1af8._selectAncestor=this._selectAncestor;
dojo.connect(_1af8,"onChange",function(_1af9){
_1af2.select(_1af4[_1af9]);
});
}
},isEnabled:function(_1afa){
_1afa=this.fixupContext(_1afa);
var _1afb=(_1afa&&_1afa.getSelection());
return this.selectionSameParentNotBody(_1afb);
}});
});
},"davinci/Theme":function(){
define(["dojo/_base/declare","dojo/promise/all","./Workbench","./library","./workbench/Preferences","./model/Path","./html/HTMLFile","./model/Factory","system/resource"],function(_1afc,all,_1afd,_1afe,_1aff,Path,_1b00,_1b01,_1b02){
var Theme={TEMP_CLONE_PRE:"clone_",desktop_default:"desktop_default",mobile_default:"custom_default",default_theme:"(device-specific)",none_themeset_name:"(none)",other_device:"other",none_theme:"none",dojoMobileDefault:[{"theme":"android","device":"Android"},{"theme":"blackberry","device":"BlackBerry"},{"theme":"ipad","device":"iPad"},{"theme":"iphone","device":"iPhone"},{"theme":"iphone","device":"other"}],dojoMobileCustom:[{"theme":"custom","device":"Android"},{"theme":"custom","device":"BlackBerry"},{"theme":"custom","device":"iPad"},{"theme":"custom","device":"iPhone"},{"theme":"custom","device":"other"}],isThemeHTML:function(_1b03){
return _1b03.getName().indexOf("dojo-theme-editor.html")>-1;
},CloneTheme:function(name,_1b04,_1b05,_1b06,_1b07,_1b08){
var _1b09=[];
var _1b0a=_1b07.file.parent;
var _1b0b=new Path(_1b06).removeLastSegments(0);
var _1b0c=_1b02.findResource(_1b0b.toString());
if(_1b0c.readOnly()){
_1b0c.createResource();
}
_1b02.createResource(_1b06,true);
var _1b0d=_1b02.findResource(_1b06);
var _1b0e=_1b07.file.getName();
var _1b0f=new Path(_1b0d.getPath());
var _1b10=_1b0f.lastSegment();
var _1b11=_1b0d.createResource(_1b10+".theme");
var _1b12=_1b0d.createResource(_1b10+".css");
var _1b13=this.getThemeLocation();
var _1b14=_1b07.file.parent.getPath();
function _1b15(_1b16){
var ret=[];
_1b16.forEach(function(_1b17){
var file=_1b02.findResource(_1b14+"/"+_1b17);
var _1b18=new Path(file.getPath());
var _1b19=_1b18.relativeTo("./"+_1b13,true);
var _1b1a="..";
for(var i=0;i<_1b19.segments.length;i++){
_1b1a=_1b1a+"/"+_1b19.segments[i];
}
ret.push(_1b1a);
});
return ret;
};
var _1b1b=_1b15(_1b07.themeEditorHtmls);
var meta=_1b15(_1b07.meta);
var _1b1c=_1b15(_1b07.files);
var _1b1d=" ";
_1b1c.forEach(function(_1b1e){
_1b1d=_1b1d+"@import url(\""+_1b1e+"\");";
});
var _1b1f={className:_1b07.className,name:name,version:_1b04||_1b07.version,specVersion:_1b07.specVersion,files:[""+_1b10+".css"],meta:meta,themeEditorHtmls:_1b1b,useBodyFontBackgroundClass:_1b07.useBodyFontBackgroundClass};
if(_1b07.helper){
if(_1b07.helper.declaredClass){
_1b1f.helper=_1b07.helper.declaredClass;
}else{
_1b1f.helper=_1b07.helper;
}
}
if(_1b07.base){
_1b1f.base=_1b07.base;
}
if(_1b07.type){
_1b1f.type=_1b07.type;
}
if(_1b07.conditionalFiles){
_1b1f.conditionalFiles=_1b07.conditionalFiles;
var _1b20=_1b15(_1b07.conditionalFiles);
for(var i=0;i<_1b1f.conditionalFiles.length;i++){
var _1b21=_1b0d.createResource(_1b1f.conditionalFiles[i]);
_1b09.push(_1b21.setContents("@import url(\""+_1b20[i]+"\");"));
}
}
var d=_1b11.setContents(JSON.stringify(_1b1f));
d.themeFile=_1b11;
_1b09.push(d);
_1b09.push(_1b12.setContents(_1b1d));
var ret={promise:all(_1b09),themeFile:_1b11};
return ret;
},getHelper:function(theme){
if(!theme){
return;
}
if(theme.helper&&typeof (theme.helper)!="string"){
return theme.helper;
}
var _1b22=theme.helper;
if(_1b22){
var _1b23=new dojo.Deferred();
require([_1b22],function(_1b24){
_1b24.declaredClass=_1b22;
_1b22=_1b24;
_1b23.resolve({helper:_1b22});
});
return _1b23;
}
},getThemeSet:function(_1b25){
var _1b26=_1aff.getPreferences("maqetta.dojo.themesets",_1afd.getProject()),_1b27=dojo.clone(this.dojoMobileDefault),_1b28;
if(!_1b26){
_1b26=this.dojoThemeSets;
}
_1b26=dojo.clone(_1b26);
if(_1b25){
var _1b29=_1b25._getDojoJsElem().getAttribute("data-dojo-config");
if(_1b29){
_1b29=require.eval("({ "+_1b29+" })","data-dojo-config");
if(_1b29.themeMap){
_1b27=Theme.getDojoxMobileThemesFromThemeMap(_1b25,_1b29.themeMap);
}
}
var _1b2a=_1b25.getTheme();
for(var s=0,len=_1b26.themeSets.length;s<len;s++){
_1b28=_1b26.themeSets[s];
if(_1b28.desktopTheme===_1b2a.name){
if(this.themeSetEquals(_1b27,_1b28.mobileTheme)){
return _1b28;
}
}
}
}
_1b28={name:this.none_themeset_name,desktopTheme:_1b25?_1b2a.name:"claro",mobileTheme:_1b27};
_1b26.themeSets.push(_1b28);
return _1b28;
},getBase:function(){
if(_1afd.singleProjectMode()){
return _1afd.getProject();
}
},getThemeLocation:function(){
var base=this.getBase();
var prefs=_1aff.getPreferences("davinci.ui.ProjectPrefs",base);
var _1b2b=(new Path(base).append(prefs["themeFolder"]));
return _1b2b;
},getTheme:function(name,_1b2c){
var _1b2d=_1afe.getThemes(_1afd.getProject(),this.workspaceOnly,_1b2c);
for(var i=0;i<_1b2d.length;i++){
if(_1b2d[i]&&_1b2d[i].name===name){
return _1b2d[i];
}
}
},getThemeByCssFile:function(_1b2e){
var _1b2f=_1afe.getThemes(_1afd.getProject(),this.workspaceOnly);
var _1b30=_1b2e.getResource().getPath();
for(var i=0;i<_1b2f.length;i++){
var _1b31=_1b2f[i].file;
var path=_1b31.getParentFolder().getPath();
for(var x=0;x<_1b2f[i].files.length;x++){
var _1b32=path+"/"+_1b2f[i].files[x];
if(_1b32===_1b30){
return _1b2f[i];
}
}
}
return null;
},getDojoxMobileThemeMap:function(_1b33,_1b34){
var _1b35=[];
var other=[".*","iphone",[]];
for(var i=0;i<_1b34.length;i++){
if(_1b34[i].theme!=this.none_theme&&_1b34[i].theme!=this.default_theme){
var theme=this.getTheme(_1b34[i].theme);
if(theme){
var _1b36=new Path(theme.file.parent.getPath()).append(theme.files[0]);
var _1b37=_1b33.getFullResourcePath();
var _1b38=_1b36.relativeTo(_1b37,true).toString();
if(_1b34[i].device===this.other_device){
other=[".*",theme.base,[_1b38]];
}else{
_1b35.push([_1b34[i].device,theme.base,[_1b38]]);
}
}
}
}
_1b35.push(other);
return _1b35;
},getDojoxMobileThemesFromThemeMap:function(_1b39,_1b3a){
var _1b3b=_1afe.getThemes(_1afd.getProject(),this.workspaceOnly,true);
var _1b3c=[];
_1b3a.forEach(function(item,idx,arr){
for(var i=0;i<_1b3b.length;i++){
var theme=_1b3b[i];
var _1b3d=new Path(theme.file.parent.getPath()).append(theme.files[0]);
var _1b3e=_1b39.getFullResourcePath();
var _1b3f=_1b3d.relativeTo(_1b3e,true).toString();
if(_1b3f==item[2][0]){
var o={};
o.device=item[0];
o.theme=theme.name;
if(o.device===".*"){
o.device="other";
}
_1b3c.push(o);
break;
}
}
},this);
return _1b3c;
},themeSetEquals:function(o1,o2){
function _1b40(obj){
var count=0;
for(var k in obj){
if(obj.hasOwnProperty(k)){
count++;
}
}
return count;
};
if(typeof (o1)!==typeof (o2)){
return false;
}
if(typeof (o1)==="function"){
return o1.toString()===o2.toString();
}
if(o1 instanceof Object&&o2 instanceof Object){
if(_1b40(o1)!==_1b40(o2)){
return false;
}
var r=true;
for(var k in o1){
r=this.themeSetEquals(o1[k],o2[k]);
if(!r){
return false;
}
}
return true;
}else{
return o1===o2;
}
},singleMobileTheme:function(_1b41){
var _1b42=_1b41.mobileTheme[0].theme;
for(var i=1;i<_1b41.mobileTheme.length;i++){
if(_1b41.mobileTheme[i].theme!=_1b42){
return false;
}
}
return true;
}};
Theme.none_themeset={"name":Theme.none_themeset_name,"desktopTheme":"claro","mobileTheme":dojo.clone(Theme.dojoMobileDefault)};
Theme.default_themeset={"name":Theme.desktop_default,"desktopTheme":"claro","mobileTheme":dojo.clone(Theme.dojoMobileDefault)};
Theme.custom_themeset={"name":Theme.mobile_default,"desktopTheme":"claro","mobileTheme":Theme.dojoMobileCustom};
Theme.dojoThemeSets={"version":"1.7","specVersion":"0.8","helper":"maq-metadata-dojo/dojox/mobile/ThemeHelper","themeSets":[Theme.custom_themeset]};
return Theme;
});
},"url:dijit/templates/MenuItem.html":"<tr class=\"dijitReset dijitMenuItem\" data-dojo-attach-point=\"focusNode\" role=\"menuitem\" tabIndex=\"-1\">\n\t<td class=\"dijitReset dijitMenuItemIconCell\" role=\"presentation\">\n\t\t<img src=\"${_blankGif}\" alt=\"\" class=\"dijitIcon dijitMenuItemIcon\" data-dojo-attach-point=\"iconNode\"/>\n\t</td>\n\t<td class=\"dijitReset dijitMenuItemLabel\" colspan=\"2\" data-dojo-attach-point=\"containerNode\"></td>\n\t<td class=\"dijitReset dijitMenuItemAccelKey\" style=\"display: none\" data-dojo-attach-point=\"accelKeyNode\"></td>\n\t<td class=\"dijitReset dijitMenuArrowCell\" role=\"presentation\">\n\t\t<div data-dojo-attach-point=\"arrowWrapper\" style=\"visibility: hidden\">\n\t\t\t<img src=\"${_blankGif}\" alt=\"\" class=\"dijitMenuExpand\"/>\n\t\t\t<span class=\"dijitMenuExpandA11y\">+</span>\n\t\t</div>\n\t</td>\n</tr>\n","dijit/form/TextBox":function(){
require({cache:{"url:dijit/form/templates/TextBox.html":"<div class=\"dijit dijitReset dijitInline dijitLeft\" id=\"widget_${id}\" role=\"presentation\"\n\t><div class=\"dijitReset dijitInputField dijitInputContainer\"\n\t\t><input class=\"dijitReset dijitInputInner\" data-dojo-attach-point='textbox,focusNode' autocomplete=\"off\"\n\t\t\t${!nameAttrSetting} type='${type}'\n\t/></div\n></div>\n"}});
define("dijit/form/TextBox",["dojo/_base/declare","dojo/dom-construct","dojo/dom-style","dojo/_base/kernel","dojo/_base/lang","dojo/sniff","./_FormValueWidget","./_TextBoxMixin","dojo/text!./templates/TextBox.html","../main"],function(_1b43,_1b44,_1b45,_1b46,lang,has,_1b47,_1b48,_1b49,dijit){
var _1b4a=_1b43("dijit.form.TextBox",[_1b47,_1b48],{templateString:_1b49,_singleNodeTemplate:"<input class=\"dijit dijitReset dijitLeft dijitInputField\" data-dojo-attach-point=\"textbox,focusNode\" autocomplete=\"off\" type=\"${type}\" ${!nameAttrSetting} />",_buttonInputDisabled:has("ie")?"disabled":"",baseClass:"dijitTextBox",postMixInProperties:function(){
var type=this.type.toLowerCase();
if(this.templateString&&this.templateString.toLowerCase()=="input"||((type=="hidden"||type=="file")&&this.templateString==this.constructor.prototype.templateString)){
this.templateString=this._singleNodeTemplate;
}
this.inherited(arguments);
},postCreate:function(){
this.inherited(arguments);
if(has("ie")<9){
this.defer(function(){
try{
var s=_1b45.getComputedStyle(this.domNode);
if(s){
var ff=s.fontFamily;
if(ff){
var _1b4b=this.domNode.getElementsByTagName("INPUT");
if(_1b4b){
for(var i=0;i<_1b4b.length;i++){
_1b4b[i].style.fontFamily=ff;
}
}
}
}
}
catch(e){
}
});
}
},_onInput:function(e){
this.inherited(arguments);
if(this.intermediateChanges){
this.defer(function(){
this._handleOnChange(this.get("value"),false);
});
}
},_setPlaceHolderAttr:function(v){
this._set("placeHolder",v);
if(!this._phspan){
this._attachPoints.push("_phspan");
this._phspan=_1b44.create("span",{className:"dijitPlaceHolder dijitInputField"},this.textbox,"after");
}
this._phspan.innerHTML="";
this._phspan.appendChild(this._phspan.ownerDocument.createTextNode(v));
this._updatePlaceHolder();
},_updatePlaceHolder:function(){
if(this._phspan){
this._phspan.style.display=(this.placeHolder&&!this.focused&&!this.textbox.value)?"":"none";
}
},_setValueAttr:function(value,_1b4c,_1b4d){
this.inherited(arguments);
this._updatePlaceHolder();
},getDisplayedValue:function(){
_1b46.deprecated(this.declaredClass+"::getDisplayedValue() is deprecated. Use get('displayedValue') instead.","","2.0");
return this.get("displayedValue");
},setDisplayedValue:function(value){
_1b46.deprecated(this.declaredClass+"::setDisplayedValue() is deprecated. Use set('displayedValue', ...) instead.","","2.0");
this.set("displayedValue",value);
},_onBlur:function(e){
if(this.disabled){
return;
}
this.inherited(arguments);
this._updatePlaceHolder();
if(has("mozilla")){
if(this.selectOnClick){
this.textbox.selectionStart=this.textbox.selectionEnd=undefined;
}
}
},_onFocus:function(by){
if(this.disabled||this.readOnly){
return;
}
this.inherited(arguments);
this._updatePlaceHolder();
}});
if(has("ie")){
_1b4a.prototype._isTextSelected=function(){
var range=this.ownerDocument.selection.createRange();
var _1b4e=range.parentElement();
return _1b4e==this.textbox&&range.text.length>0;
};
dijit._setSelectionRange=_1b48._setSelectionRange=function(_1b4f,start,stop){
if(_1b4f.createTextRange){
var r=_1b4f.createTextRange();
r.collapse(true);
r.moveStart("character",-99999);
r.moveStart("character",start);
r.moveEnd("character",stop-start);
r.select();
}
};
}
return _1b4a;
});
},"davinci/ve/commands/ModifyRichTextCommand":function(){
define("davinci/ve/commands/ModifyRichTextCommand",["dojo/_base/declare"],function(_1b50){
return _1b50("davinci.ve.commands.ModifyRichTextCommand",null,{name:"modify",constructor:function(_1b51,_1b52,_1b53,_1b54){
this._oldId=_1b51?_1b51.id:undefined;
this._properties=_1b52=(_1b52||{});
if(_1b52.richText){
this._richText=true;
this._newText=_1b52.richText;
this._children=_1b52.richText;
delete _1b52.richText;
}else{
this._children=_1b52._children;
}
this._context=_1b54||_1b51.getContext();
},setContext:function(_1b55){
this._context=_1b55;
},add:function(_1b56){
if(!_1b56||_1b56._oldId!=this._oldId){
return;
}
if(_1b56._properties){
dojo.mixin(this._properties,_1b56._properties);
}
if(_1b56._children){
this._children=_1b56._children;
}
},execute:function(){
if(!this._oldId||!this._properties){
return;
}
var _1b57=require("davinci/ve/widget");
var _1b58=_1b57.byId(this._oldId);
if(!_1b58){
return;
}
this._parentWidget=_1b58.getParent();
if(!this._oldText){
this._oldText=_1b58._srcElement.getElementText(this._context);
if(this._oldText&&(typeof this._oldText=="string")){
this._oldText=this._oldText.replace(/\n/g,"");
}
}
if(!this._oldData){
this._oldData=_1b58.getData();
this._oldData.context=this._context;
this._newData={type:this._oldData.type,properties:dojo.mixin({},this._oldData.properties,this._properties),children:this._newText,states:this._oldData.states,context:this._context};
this._oldData={type:this._oldData.type,properties:dojo.mixin({},this._oldData.properties,this._properties),children:this._oldText,states:this._oldData.states,context:this._context};
}
if(this._context){
this._context.detach(_1b58);
}
if(this._properties.id){
delete this._newData.properties.isTempID;
}
if(!this._newId_isTempID){
this._newId_isTempID=this._newData.properties.isTempID;
}
if(!this._oldId_isTempID){
this._oldId_isTempID=this._oldData.properties.isTempID;
}
var _1b59=null;
var index=this._parentWidget.indexOf(_1b58);
this._parentWidget.removeChild(_1b58);
_1b58.destroyWidget();
if(this._newId){
this._newData.properties.id=this._newId;
}
if(this._newId_isTempID){
this._newData.properties.isTempID=this._newId_isTempID;
}
_1b59=_1b57.createWidget(this._newData);
if(!_1b59){
return;
}
this._parentWidget.addChild(_1b59,index);
this._newId=_1b59.id;
if(this._context){
this._refresh(_1b59);
}
this.newWidget=_1b59;
dojo.publish("/davinci/ui/widget/replaced",[_1b59,_1b58]);
var _1b5a=require("davinci/ve/States");
_1b5a.resetState(_1b59.domNode);
},undo:function(){
if(!this._newId||!this._oldData){
return;
}
var _1b5b=require("davinci/ve/widget");
var _1b5c=_1b5b.byId(this._newId);
if(!_1b5c){
return;
}
var index=dojo.indexOf(this._parentWidget.getChildren(),_1b5c);
if(index<0){
return;
}
var _1b5d=this._parentWidget.getContext();
if(_1b5d){
_1b5d.detach(_1b5c);
}
this._parentWidget.removeChild(_1b5c);
_1b5c.destroyWidget();
this._oldData.children=this._oldText;
this._oldData.properties.id=this._oldId;
var _1b5e=_1b5b.createWidget(this._oldData);
_1b5c.getParent().addChild(_1b5e,index);
if(_1b5d){
this._refresh(_1b5e);
}
dojo.publish("/davinci/ui/widget/replaced",[_1b5e,_1b5c]);
var _1b5f=require("davinci/ve/States");
_1b5f.resetState(_1b5e.domNode);
},_refresh:function(_1b60){
var _1b61=_1b60.getContainerNode();
if(_1b61){
this._context.getGlobal()["require"]("dojo/parser").parse(_1b61);
}
this._context.attach(_1b60);
_1b60.startup();
_1b60.renderWidget();
if(_1b61){
this._context._attachChildren(_1b61);
}
}});
});
},"url:davinci/ui/widgets/templates/FileFieldDialog.html":"<div>\n\t<div style='float:right;'>\n\t\t<button type='button' style='font-size:.75em;float:right;' dojoType=\"dijit.form.Button\" dojoAttachPoint=\"button\" dojoAttachEvent=\"onClick:_showFileSelectionDialog\">...</button>\n\t</div>\n\t<div style='margin-right:35px;'>\n\t\t<input style='width:100%;' type='text' dojoType=\"dijit.form.TextBox\" dojoAttachPoint=\"textField\" dojoAttachEvent=\"onChange:_onChange\"></input>\n\t</div>\n</div>\n\n","davinci/ui/widgets/OpenFile":function(){
require({cache:{"url:davinci/ui/widgets/templates/OpenFile.html":"<div class=\"fileDialog\">\n\t<div class=\"dijitDialogPaneContentArea folderContainer\">\n\t\t<div dojoType=\"dijit.layout.ContentPane\" dojoAttachPoint=\"contentpane\">\n\t\t<div class=\"fileDialogTreeWidget\" dojoAttachPoint=\"fileTree\" dojoType=\"dijit.Tree\" model=\"system.resource\" persist=\"false\" labelAttr=\"name\" childrenAttrs=\"children\" dojoAttachEvent=\"onDblClick:_onDblClick,onKeyPress:_onKeyPress\"></div>\n\t\t</div>\n\t</div>\n\t\n\t<div class=\"dijitDialogPaneActionBar\">\n\t\t<button dojoType=\"dijit.form.Button\" dojoAttachEvent=\"onClick:_okButton\" class=\"maqPrimaryButton\" type=\"submit\">${finishButtonLabel}</button>\n\t\t<button dojoType=\"dijit.form.Button\" dojoAttachEvent=\"onClick:_cancelButton\" class=\"maqSecondaryButton\">${cancelButtonLabel}</button>\n\t</div>\n</div>\n"}});
define("davinci/ui/widgets/OpenFile",["dojo/_base/declare","dijit/_Templated","dijit/_Widget","davinci/library","system/resource","davinci/workbench/Preferences","davinci/Runtime","davinci/Workbench","dijit/Menu","dijit/MenuItem","davinci/model/Path","dijit/form/DropDownButton","dojo/i18n!davinci/ui/nls/ui","dojo/i18n!dijit/nls/common","dojo/text!./templates/OpenFile.html","dijit/form/Button","dijit/form/TextBox","dijit/form/RadioButton","dijit/layout/ContentPane","dijit/Tree"],function(_1b62,_1b63,_1b64,_1b65,_1b66,_1b67,_1b68,_1b69,Menu,_1b6a,Path,_1b6b,uiNLS,_1b6c,_1b6d){
return _1b62("davinci.ui.widgets.OpenFile",[_1b64,_1b63],{widgetsInTemplate:true,templateString:dojo.cache("davinci.ui.widgets","templates/OpenFile.html","<div class=\"fileDialog\">\n\t<div class=\"dijitDialogPaneContentArea folderContainer\">\n\t\t<div dojoType=\"dijit.layout.ContentPane\" dojoAttachPoint=\"contentpane\">\n\t\t<div class=\"fileDialogTreeWidget\" dojoAttachPoint=\"fileTree\" dojoType=\"dijit.Tree\" model=\"system.resource\" persist=\"false\" labelAttr=\"name\" childrenAttrs=\"children\" dojoAttachEvent=\"onDblClick:_onDblClick,onKeyPress:_onKeyPress\"></div>\n\t\t</div>\n\t</div>\n\t\n\t<div class=\"dijitDialogPaneActionBar\">\n\t\t<button dojoType=\"dijit.form.Button\" dojoAttachEvent=\"onClick:_okButton\" class=\"maqPrimaryButton\" type=\"submit\">${finishButtonLabel}</button>\n\t\t<button dojoType=\"dijit.form.Button\" dojoAttachEvent=\"onClick:_cancelButton\" class=\"maqSecondaryButton\">${cancelButtonLabel}</button>\n\t</div>\n</div>\n"),fileDialogFileName:null,fileDialogParentFolder:null,postMixInProperties:function(){
dojo.mixin(this,uiNLS);
dojo.mixin(this,_1b6c);
this.inherited(arguments);
},postCreate:function(){
this.inherited(arguments);
this.fileTree.watch("selectedItem",dojo.hitch(this,this._updateFields));
if(!this._value){
this._setValueAttr(this._getForcedRootAttr());
}
},startup:function(){
this.fileTree.startup();
},_setValueAttr:function(value){
if(value==this._value){
return;
}
this._value=value;
this.fileTree.set("selectedItems",[value]);
},_getForcedRootAttr:function(){
return this._forcedRoot||_1b66.findResource(_1b69.getProject());
},_setForcedRootAttr:function(value){
this._forcedRoot=value;
},_updateFields:function(){
var _1b6e=this.fileTree.get("selectedItems");
var _1b6f=(_1b6e!=null&&_1b6e.length>0)?_1b6e[0]:null;
dojo.attr(this._okButton,"disabled",true);
if(_1b6f!=null&&_1b6f.elementType=="File"){
dojo.attr(this._okButton,"disabled",false);
}
},_okButton:function(){
var _1b70=this.fileTree.get("selectedItems");
this.value=_1b70[0];
},_onDblClick:function(item){
this._okButton();
this.onExecute();
},_onKeyPress:function(e){
if(e.which==dojo.keys.ENTER){
this._okButton();
this.onExecute();
}
},_getValueAttr:function(){
return this.value;
},_cancelButton:function(){
this.onClose();
},resize:function(_1b71){
this.contentpane.resize(_1b71);
},onExecute:function(){
},onClose:function(){
}});
});
},"davinci/actions/RedoAction":function(){
define(["dojo/_base/declare","./Action","../Workbench"],function(_1b72,_1b73,_1b74){
return _1b72("davinci.actions.RedoAction",_1b73,{run:function(_1b75){
var e=_1b74.getOpenEditor();
if(e&&e.getContext){
e.getContext().getCommandStack().redo();
}
},isEnabled:function(_1b76){
var e=_1b74.getOpenEditor();
var _1b77=e&&e.getContext&&e.getContext();
if(e&&_1b77){
var _1b78=_1b77.getCommandStack().canRedo();
if(e.declaredClass=="davinci.ve.PageEditor"){
var _1b79=e.getDisplayMode();
return _1b78&&_1b79!="source";
}else{
return _1b78;
}
}else{
return false;
}
}});
});
},"davinci/actions/UserNameAction":function(){
define(["dojo/_base/declare","davinci/Runtime","./Action","dojo/i18n!davinci/ui/nls/ui"],function(_1b7a,_1b7b,_1b7c,uiNls){
return _1b7a("davinci.actions.UserNameAction",_1b7c,{run:function(){
},getName:function(){
var name=_1b7b.getUserDisplayName();
return uiNls.User+": "+"<i>"+name+"</i>";
}});
});
},"davinci/js/ui/JSOutlineModel":function(){
define(["dojo/_base/declare","davinci/ui/widgets/DavinciModelTreeModel"],function(_1b7d,_1b7e){
return _1b7d("davinci.js.ui.JSOutlineModel",_1b7e,{});
});
},"dijit/layout/LayoutContainer":function(){
define("dijit/layout/LayoutContainer",["dojo/_base/kernel","dojo/_base/lang","dojo/_base/declare","../_WidgetBase","./_LayoutWidget","./utils"],function(_1b7f,lang,_1b80,_1b81,_1b82,_1b83){
var _1b84=_1b80("dijit.layout.LayoutContainer",_1b82,{baseClass:"dijitLayoutContainer",constructor:function(){
_1b7f.deprecated("dijit.layout.LayoutContainer is deprecated","use BorderContainer instead",2);
},layout:function(){
_1b83.layoutChildren(this.domNode,this._contentBox,this.getChildren());
},addChild:function(child,_1b85){
this.inherited(arguments);
if(this._started){
_1b83.layoutChildren(this.domNode,this._contentBox,this.getChildren());
}
},removeChild:function(_1b86){
this.inherited(arguments);
if(this._started){
_1b83.layoutChildren(this.domNode,this._contentBox,this.getChildren());
}
}});
_1b84.ChildWidgetProperties={layoutAlign:"none"};
lang.extend(_1b81,_1b84.ChildWidgetProperties);
return _1b84;
});
},"url:davinci/ui/templates/newtheme.html":"<div>\r\n\t<div class=\"dijitDialogPaneContentArea\">\r\n\t\t<table>\r\n\t\t<tr>\r\n\t\t<td>${themeToClone}:</td><td> <div dojoType=\"davinci.ui.widgets.ThemeSelection\" workspaceOnly=\"false\" dojoAttachPoint = '_themeSelection'></div></td><td><div dojoAttachPoint='_error1'></div></td>\r\n\t\t</tr>\r\n\t\t<tr><td colspan='3'><hr></hr></td></tr>\r\n\t\t<!-- \r\n\t\t<tr>\r\n\t\t<td>New Name:</td><td><input style='width:100%' type='select' dojoAttachPoint=\"_themeName\"></input></td><td><div dojoAttachPoint='_error2'></div></td>\r\n\t\t</tr>\r\n\t\t<tr>\r\n\t\t<td>Version:</td><td><input style='width:100%' type='text' dojoAttachPoint=\"_version\"></input></td><td><div dojoAttachPoint='_error3'></div></td>\r\n\t\t</tr>\r\n\t\t -->\r\n\t\t<tr>\r\n\t\t<td>${newName}:</td><td><input class='templateInput' type='text' \r\n\t\t\tdojoAttachPoint=\"_selector\"\r\n\t\t\tdojoType=\"dijit.form.ValidationTextBox\"\r\n\t\t\trequired=\"true\" \r\n\t\t\tinvalidMessage='${invalidThemeName}'></input></td><td><div dojoAttachPoint='_error4'></div></td>\r\n\t\t</tr>\r\n\t\t</table>\r\n\t</div>\r\n\t<div class=\"dijitDialogPaneActionBar\">\r\n\t\t<button dojoType='dijit.form.Button' dojoAttachPoint=\"_okButton\" dojoAttachEvent='onClick:okButton' label='${create}' class=\"maqPrimaryButton\" type=\"submit\" disabled></button>\r\n\t\t<button dojoType='dijit.form.Button' dojoAttachEvent='onClick:cancelButton' label='${buttonCancel}' class=\"maqSecondaryButton\"></button>\r\n\t</div>\t\t\r\n</div>","dojo/cldr/supplemental":function(){
define("dojo/cldr/supplemental",["../_base/lang","../i18n"],function(lang,i18n){
var _1b87={};
lang.setObject("dojo.cldr.supplemental",_1b87);
_1b87.getFirstDayOfWeek=function(_1b88){
var _1b89={bd:5,mv:5,ae:6,af:6,bh:6,dj:6,dz:6,eg:6,iq:6,ir:6,jo:6,kw:6,ly:6,ma:6,om:6,qa:6,sa:6,sd:6,sy:6,ye:6,ag:0,ar:0,as:0,au:0,br:0,bs:0,bt:0,bw:0,by:0,bz:0,ca:0,cn:0,co:0,dm:0,"do":0,et:0,gt:0,gu:0,hk:0,hn:0,id:0,ie:0,il:0,"in":0,jm:0,jp:0,ke:0,kh:0,kr:0,la:0,mh:0,mm:0,mo:0,mt:0,mx:0,mz:0,ni:0,np:0,nz:0,pa:0,pe:0,ph:0,pk:0,pr:0,py:0,sg:0,sv:0,th:0,tn:0,tt:0,tw:0,um:0,us:0,ve:0,vi:0,ws:0,za:0,zw:0};
var _1b8a=_1b87._region(_1b88);
var dow=_1b89[_1b8a];
return (dow===undefined)?1:dow;
};
_1b87._region=function(_1b8b){
_1b8b=i18n.normalizeLocale(_1b8b);
var tags=_1b8b.split("-");
var _1b8c=tags[1];
if(!_1b8c){
_1b8c={de:"de",en:"us",es:"es",fi:"fi",fr:"fr",he:"il",hu:"hu",it:"it",ja:"jp",ko:"kr",nl:"nl",pt:"br",sv:"se",zh:"cn"}[tags[0]];
}else{
if(_1b8c.length==4){
_1b8c=tags[2];
}
}
return _1b8c;
};
_1b87.getWeekend=function(_1b8d){
var _1b8e={"in":0,af:4,dz:4,ir:4,om:4,sa:4,ye:4,ae:5,bh:5,eg:5,il:5,iq:5,jo:5,kw:5,ly:5,ma:5,qa:5,sd:5,sy:5,tn:5},_1b8f={af:5,dz:5,ir:5,om:5,sa:5,ye:5,ae:6,bh:5,eg:6,il:6,iq:6,jo:6,kw:6,ly:6,ma:6,qa:6,sd:6,sy:6,tn:6},_1b90=_1b87._region(_1b8d),start=_1b8e[_1b90],end=_1b8f[_1b90];
if(start===undefined){
start=6;
}
if(end===undefined){
end=0;
}
return {start:start,end:end};
};
return _1b87;
});
},"davinci/ve/widgets/ColorPicker":function(){
define("davinci/ve/widgets/ColorPicker",["dojo/_base/declare","dijit/_WidgetBase","dijit/form/ComboBox","davinci/ve/widgets/ColorStore","davinci/ve/widgets/ColorPickerFlat","dijit/TooltipDialog","dojo/i18n!davinci/ve/nls/ve","dijit/popup"],function(_1b91,_1b92,_1b93,_1b94,_1b95,_1b96,veNLS){
var _1b97=_1b91("davinci.ve.widgets.ColorPicker",[_1b92],{numberDelta:1,insertPosition:9,data:null,postCreate:function(){
this.inherited(arguments);
this.domNode.removeAttribute("data-dojo-type");
this.domNode.removeAttribute("dojoType");
this._statics=["",davinci.ve.widgets.ColorPicker.divider,veNLS.colorPicker,veNLS.removeValue];
this._run={};
if(!this.data){
this.data=[{value:this._statics[0]},{value:this._statics[2],run:this._chooseColorValue},{value:this._statics[3],run:function(){
this.set("value","");
}},{value:this._statics[1]},{value:"transparent"},{value:"black"},{value:"white"},{value:"red"},{value:"green"},{value:"blue"}];
}else{
this.data.push({value:davinci.ve.widgets.ColorPicker.divider});
this.data.push({value:veNLS.removeValue,run:function(){
this.set("value","");
}});
}
var _1b98=[];
for(var i=0;i<this.data.length;i++){
_1b98.push(this.data[i].value);
if(this.data[i].run){
this._run[this.data[i].value]=this.data[i].run;
}
}
this._store=new _1b94({values:_1b98,noncolors:this._statics});
this._dropDown=new _1b93({store:this._store,required:false,autoComplete:false,labelType:"html",labelAttr:"label",style:"width:100%"});
dojo.connect(this._dropDown,"onChange",this,"_onChange");
var top=dojo.doc.createElement("div");
dojo.addClass(top,"colorPicker");
this._selectedColor=dojo.doc.createElement("div");
this._selectedColor.innerHTML="&nbsp;";
dojo.addClass(this._selectedColor,"colorPickerSelected");
dojo.connect(this._selectedColor,"onclick",dojo.hitch(this,function(event){
this._chooseColorValue();
}));
top.appendChild(this._selectedColor);
var _1b99=dojo.doc.createElement("div");
dojo.addClass(_1b99,"colorPickerComboContainer");
_1b99.appendChild(this._dropDown.domNode);
top.appendChild(_1b99);
this._colorPickerFlat=new _1b95({});
this.domNode.appendChild(top);
},_chooseColorValue:function(){
this._dropDown.set("value",this._value,true);
var _1b9a=this._colorPickerFlat;
var _1b9b=new _1b96({title:veNLS.selectColor,content:_1b9a});
dijit.popup.moveOffScreen(_1b9b.domNode);
var _1b9c=false;
var _1b9d=function(_1b9e){
return function(){
if(_1b9c){
_1b9c=false;
dijit.popup.close(_1b9b);
}
};
}(this);
_1b9b.connect(_1b9a,"onCancel",dojo.hitch(this,_1b9d));
_1b9b.connect(_1b9a,"onClose",dojo.hitch(this,_1b9d));
var _1b9f=dijit.byNode(dojo.query("[widgetId]",_1b9b.domNode)[0]);
var popup=function(_1ba0){
return function(){
if(this._isReadOnly){
return;
}
dijit.popup.open({parent:_1ba0._dropDown,popup:_1b9b,around:_1ba0._dropDown.domNode,orient:_1ba0.isLeftToRight()?{"BL":"TL","BR":"TR","TL":"BL","TR":"BR"}:{"BR":"TR","BL":"TL","TR":"BR","TL":"BL"},onClose:function(){
if(!_1b9f.canceled){
var _1ba1=_1ba0._dropDown.get("value");
_1ba0._dropDown.set("value",_1b9f.get("value"));
}
_1b9d();
}});
_1b9c=true;
dijit.focus(_1b9b.containerNode);
};
};
if(this._value in dojo.Color.named){
var value=dojo.colorFromString(this._value);
_1b9a.set("value",value.toHex());
}else{
_1b9a.set("value",this._value||"",true);
}
popup(this)();
},_setReadOnlyAttr:function(_1ba2){
this._isReadOnly=_1ba2;
this._dropDown.set("disabled",_1ba2);
},onChange:function(event){
},_getValueAttr:function(){
return this._dropDown.get("value");
},_setValueAttr:function(value,_1ba3){
this._dropDown.set("value",value,true);
dojo.style(this._selectedColor,"backgroundColor",value);
if(value in dojo.Color.named){
var v=dojo.colorFromString(value);
this._colorPickerFlat.set("value",v.toHex(),_1ba3);
}else{
this._colorPickerFlat.set("value",value,_1ba3);
}
this._onChange(value,_1ba3);
},_onChange:function(event,_1ba4){
if(event in this._run){
dojo.hitch(this,this._run[event])();
}else{
if(event==davinci.ve.widgets.ColorPicker.divider){
this._dropDown.set("value",this._store.getItemNumber(0));
}else{
if(!this._store.contains(event)){
this._store.insert(this.insertPosition,event);
dojo.style(this._selectedColor,"backgroundColor",event);
}else{
dojo.style(this._selectedColor,"backgroundColor",event);
}
}
}
if(this._value!=event&&!(event in this._run)){
this._value=event;
if(!_1ba4){
this.onChange(event);
}
}
}});
return dojo.mixin(_1b97,{divider:"---"});
});
},"url:dijit/templates/Menu.html":"<table class=\"dijit dijitMenu dijitMenuPassive dijitReset dijitMenuTable\" role=\"menu\" tabIndex=\"${tabIndex}\"\n\t   data-dojo-attach-event=\"onkeypress:_onKeyPress\" cellspacing=\"0\">\n\t<tbody class=\"dijitReset\" data-dojo-attach-point=\"containerNode\"></tbody>\n</table>\n","davinci/html/CSSImport":function(){
define(["dojo/_base/declare","davinci/html/CSSElement","davinci/model/Path","davinci/html/CSSFile"],function(_1ba5,_1ba6,Path,_1ba7){
return _1ba5("davinci.html.CSSImport",_1ba6,{constructor:function(){
this.elementType="CSSImport";
},getCSSFile:function(){
return this.parent;
},setUrl:function(url){
this.url=url;
},visit:function(_1ba8){
if(!_1ba8.visit(this)){
for(var i=0;i<this.children.length;i++){
this.children[i].visit(_1ba8);
}
if(this.cssFile){
this.cssFile.visit(_1ba8);
}
}
if(_1ba8.endVisit){
_1ba8.endVisit(this);
}
},getText:function(_1ba9){
s="@import ";
if(this.isURL){
s+="url(\""+this.url+"\");";
}else{
s+="\""+this.url+"\";";
}
return s;
},close:function(_1baa){
require("davinci/model/Factory").closeModel(this.cssFile);
if(this.connection){
dojo.disconnect(this.connection);
}
delete this.connection;
},load:function(_1bab){
var p=this.parent;
while(p&&!(p.url||p.fileName)){
p=p.parent;
}
var path=new Path(p.url||p.fileName);
path=path.getParentPath().append(this.url);
var myUrl=path.toString();
this.cssFile=require("davinci/model/Factory").getModel({url:myUrl,loader:this.parent.loader,includeImports:this.parent.includeImports||_1bab});
this.cssFile.relativeURL=this.url;
this.connection=dojo.connect(this.cssFile,"onChange",this.parent,"onChange");
}});
});
},"orion/editor/cssContentAssist":function(){
define("orion/editor/cssContentAssist",[],function(){
var _1bac=["alignment-adjust","alignment-baseline","animation","animation-delay","animation-direction","animation-duration","animation-iteration-count","animation-name","animation-play-state","animation-timing-function","appearance","azimuth","backface-visibility","background","background-attachment","background-clip","background-color","background-image","background-origin","background-position","background-repeat","background-size","baseline-shift","binding","bleed","bookmark-label","bookmark-level","bookmark-state","bookmark-target","border","border-bottom","border-bottom-color","border-bottom-left-radius","border-bottom-right-radius","border-bottom-style","border-bottom-width","border-collapse","border-color","border-image","border-image-outset","border-image-repeat","border-image-slice","border-image-source","border-image-width","border-left","border-left-color","border-left-style","border-left-width","border-radius","border-right","border-right-color","border-right-style","border-right-width","border-spacing","border-style","border-top","border-top-color","border-top-left-radius","border-top-right-radius","border-top-style","border-top-width","border-width","bottom","box-align","box-decoration-break","box-direction","box-flex","box-flex-group","box-lines","box-ordinal-group","box-orient","box-pack","box-shadow","box-sizing","break-after","break-before","break-inside","caption-side","clear","clip","color","color-profile","column-count","column-fill","column-gap","column-rule","column-rule-color","column-rule-style","column-rule-width","column-span","column-width","columns","content","counter-increment","counter-reset","crop","cue","cue-after","cue-before","cursor","direction","display","dominant-baseline","drop-initial-after-adjust","drop-initial-after-align","drop-initial-before-adjust","drop-initial-before-align","drop-initial-size","drop-initial-value","elevation","empty-cells","fit","fit-position","flex-align","flex-flow","flex-inline-pack","flex-order","flex-pack","float","float-offset","font","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","grid-columns","grid-rows","hanging-punctuation","height","hyphenate-after","hyphenate-before","hyphenate-character","hyphenate-lines","hyphenate-resource","hyphens","icon","image-orientation","image-rendering","image-resolution","inline-box-align","left","letter-spacing","line-height","line-stacking","line-stacking-ruby","line-stacking-shift","line-stacking-strategy","list-style","list-style-image","list-style-position","list-style-type","margin","margin-bottom","margin-left","margin-right","margin-top","mark","mark-after","mark-before","marker-offset","marks","marquee-direction","marquee-loop","marquee-play-count","marquee-speed","marquee-style","max-height","max-width","min-height","min-width","move-to","nav-down","nav-index","nav-left","nav-right","nav-up","opacity","orphans","outline","outline-color","outline-offset","outline-style","outline-width","overflow","overflow-style","overflow-x","overflow-y","padding","padding-bottom","padding-left","padding-right","padding-top","page","page-break-after","page-break-before","page-break-inside","page-policy","pause","pause-after","pause-before","perspective","perspective-origin","phonemes","pitch","pitch-range","play-during","position","presentation-level","punctuation-trim","quotes","rendering-intent","resize","rest","rest-after","rest-before","richness","right","rotation","rotation-point","ruby-align","ruby-overhang","ruby-position","ruby-span","size","speak","speak-header","speak-numeral","speak-punctuation","speech-rate","stress","string-set","table-layout","target","target-name","target-new","target-position","text-align","text-align-last","text-decoration","text-emphasis","text-height","text-indent","text-justify","text-outline","text-shadow","text-transform","text-wrap","top","transform","transform-origin","transform-style","transition","transition-delay","transition-duration","transition-property","transition-timing-function","unicode-bidi","vertical-align","visibility","voice-balance","voice-duration","voice-family","voice-pitch","voice-pitch-range","voice-rate","voice-stress","voice-volume","volume","white-space","white-space-collapse","widows","width","word-break","word-spacing","word-wrap","z-index"];
function _1bad(_1bae,_1baf){
var index=_1baf;
while(index&&/[A-Za-z\-]/.test(_1bae.charAt(index-1))){
index--;
}
return index?_1bae.substring(index,_1baf):"";
};
function _1bb0(){
};
_1bb0.prototype={computeProposals:function(_1bb1,_1bb2,_1bb3){
var _1bb4=_1bad(_1bb1,_1bb2);
var _1bb5=[];
for(var i=0;i<_1bac.length;i++){
var _1bb6=_1bac[i];
if(_1bb6.indexOf(_1bb4)===0){
_1bb5.push({proposal:_1bb6.substring(_1bb4.length),description:_1bb6});
}
}
return _1bb5;
}};
return {CssContentAssistProvider:_1bb0};
});
},"davinci/ve/_Widget":function(){
define("davinci/ve/_Widget",["dojo/_base/declare","./metadata","../html/CSSModel","dojox/html/entities","davinci/ve/utils/StyleArray","davinci/ve/utils/GeomUtils"],function(_1bb7,_1bb8,_1bb9,_1bba,_1bbb,_1bbc){
var _1bbd=function(_1bbe,_1bbf,func){
if(_1bbe==_1bbf){
return true;
}
if(!_1bbe||!_1bbf){
return false;
}
if(_1bbe.length!=_1bbf.length){
return false;
}
for(var i=0;i<_1bbe.length;i++){
if(func){
if(!func(_1bbe[i],_1bbf[i])){
return false;
}
}else{
if(_1bbe[i]!=_1bbf[i]){
return false;
}
}
}
return true;
};
return _1bb7("davinci.ve._Widget",null,{isWidget:true,acceptsHTMLChildren:false,_skipAttrs:["id","style","class","dir","lang","_children"],constructor:function(_1bc0,node,type,_1bc1){
this.domNode=node;
this.id=node.id;
node._dvWidget=this;
this._params=dojo.mixin({},_1bc0);
this.type=type;
this.metadata=_1bc1;
},postscript:function(){
var _1bc2;
if(this.domNode){
var doc=this.domNode.ownerDocument;
if(doc.body._edit_context){
_1bc2=doc.body._edit_context;
}else{
if(doc.body._dvWidget&&doc.body._dvWidget._edit_context){
_1bc2=doc.body._dvWidget._edit_context;
}
}
}
if(this.id&&_1bc2){
_1bc2.widgetHash[this.id]=this;
}
this.buildRendering();
this.postCreate();
},buildRendering:function(){
},postCreate:function(){
},getObjectType:function(){
},getContext:function(){
return this._edit_context;
},getChildren:function(_1bc3){
var _1bc4=this.getHelper();
if(_1bc4&&_1bc4.getChildren){
return _1bc4.getChildren(this,_1bc3);
}
return this._getChildren(_1bc3);
},_getChildren:function(_1bc5){
var _1bc6=this.getContainerNode(),_1bc7=[];
if(_1bc6){
dojo.forEach(_1bc6.children,function(node){
if(_1bc5){
_1bc7.push(require("davinci/ve/widget").getWidget(node));
}else{
var _1bc8=node._dvWidget;
if(_1bc8){
_1bc7.push(_1bc8);
}
}
});
}
return _1bc7;
},getContainerNode:function(){
var _1bc9=this.getHelper();
if(_1bc9&&_1bc9.getContainerNode){
return _1bc9.getContainerNode(this);
}
if(_1bb8.getAllowedChild(this.type)[0]!=="NONE"){
return this._getContainerNode();
}
return null;
},_getContainerNode:function(){
return this.domNode;
},getMetadata:function(){
if(!this.metadata){
this.metadata=_1bb8.query(this);
}
return this.metadata;
},getHelper:function(){
if(!this._edit_helper){
this._edit_helper=require("davinci/ve/widget").getWidgetHelper(this.type);
}
return this._edit_helper;
},attr:function(name,value){
var _1bca=this._attr.apply(this,arguments);
if(arguments.length>1){
value=this._stringValue(name,value);
this._srcElement.addAttribute(name,value);
}else{
return _1bca;
}
},_attr:function(name,value){
},indexOf:function(child){
return dojo.indexOf(this.getChildren(),child);
},getStyleNode:function(){
return this.styleNode||this.domNode;
},addChild:function(child,index){
if(!child){
return;
}
var _1bcb;
var _1bcc=this.getHelper();
if(_1bcc&&_1bcc.getContainerNode){
_1bcb=_1bcc.getContainerNode(this);
}else{
_1bcb=this.getContainerNode();
}
if(_1bcb){
if(index===undefined||index===null||index===-1){
_1bcb.appendChild(child.domNode);
this._srcElement.addChild(child._srcElement);
}else{
var _1bcd=this.getChildren();
if(index<_1bcd.length){
_1bcb.insertBefore(child.domNode,_1bcd[index].domNode);
this._srcElement.insertBefore(child._srcElement,_1bcd[index]._srcElement);
}else{
_1bcb.appendChild(child.domNode);
this._srcElement.addChild(child._srcElement);
}
}
}
},getParent:function(){
return require("davinci/ve/widget").getEnclosingWidget(this.domNode.parentNode)||this.domNode.parentNode;
},getObjectId:function(_1bce){
_1bce=_1bce||this;
var _1bcf=_1bce._edit_object_id;
if(_1bcf){
return _1bcf;
}
if(_1bce.domNode){
return _1bce.domNode.getAttribute("jsId");
}
return undefined;
},addClass:function(_1bd0){
var _1bd1=this.getClassNames();
_1bd1=_1bd1?_1bd1.split(/\s+/):[];
if(_1bd1.indexOf(_1bd0)!==-1){
return;
}
_1bd1.push(_1bd0);
this._srcElement.setAttribute("class",_1bd1.join(" "));
dojo.addClass(this.domNode,_1bd0);
},getId:function(){
if(!this.id){
if(!this.domNode.id||!this.type){
return undefined;
}
var id=this.domNode.id;
var base=(this.isHtmlWidget?this.getTagName():this.type).replace(/\./g,"_")+"_";
if(id.length>base.length&&id.substring(0,base.length)==base){
return undefined;
}
}
if(this._srcElement&&this._srcElement._getAttribute("id")&&this._srcElement._getAttribute("id").noPersist){
return undefined;
}
return this.id;
},setMarginBox:function(box){
var node=this.getStyleNode();
if(!node){
return;
}
dojo.marginBox(node,box);
this._updateSrcStyle();
},getMarginBox:function(){
var node=this.domNode;
var box=null;
var _1bd2=this.getHelper();
if(_1bd2&&_1bd2.getMarginBoxPageCoords){
box=_1bd2.getMarginBoxPageCoords(this);
}else{
box=_1bbc.getMarginBoxPageCoords(node);
}
box.l-=_1bbc.getScrollLeft(node);
box.t-=_1bbc.getScrollTop(node);
box.x=box.l;
box.y=box.t;
return box;
},getStyle:function(_1bd3){
var _1bd4=this.getStyleValues(_1bd3);
if(!_1bd4){
return "";
}
return this._styleText(_1bd4);
},_sortStyleValues:function(_1bd5){
var _1bd6=dojo.clone(_1bd5);
function _1bd7(value){
for(var i=0;i<_1bd6.length;i++){
if(_1bd6[i]&&_1bd6[i].hasOwnProperty(value)){
return i;
}
}
return -1;
};
var _1bd8=_1bb9.shorthand;
var _1bd9=0;
for(var i=0;i<_1bd8.length;i++){
var index=_1bd7(_1bd8[i][0]);
if(index>-1){
var _1bda=_1bd6[index];
_1bd6.splice(index,1);
_1bd6.splice(_1bd9,0,_1bda);
_1bd9++;
}
}
return _1bd6;
},_styleText:function(v){
var s="";
if(dojo.isArray(v)){
var _1bdb=davinci.ve.states.normalizeArray("style",this.domNode,name,v);
for(var i=0;i<_1bdb.length;i++){
for(var name in _1bdb[i]){
value=_1bdb[i][name];
if(value!==undefined&&value!=""&&value!=null){
s+=name+": "+_1bdb[i][name]+"; ";
}
}
}
}else{
for(var name in v){
value=davinci.ve.states.normalize("style",this.domNode,name,v[name]);
if(value!==undefined&&value!=""&&value!=null){
s+=name+": "+v[name]+"; ";
}
}
}
return s.trim();
},getChildrenData:function(_1bdc){
_1bdc=_1bdc||{identify:true};
var _1bdd=this.getHelper();
if(_1bdd&&_1bdd.getChildrenData){
return _1bdd.getChildrenData.apply(_1bdd,[this,_1bdc]);
}
return this._getChildrenData(_1bdc);
},_getChildrenData:function(_1bde){
return this.getChildren().map(function(w){
return w.getData(_1bde);
});
},getClassNames:function(){
return this._srcElement.getAttribute("class")||"";
},_getData:function(_1bdf){
var data={type:this.type,properties:{}},_1be0=require("davinci/ve/widget");
if(_1bdf.identify){
if(!this._srcElement){
this._srcElement=_1be0._createSrcElement(this.domNode);
}
var _1be1=this._srcElement._getAttribute("id");
if(_1be1&&_1be1.noPersist){
data.properties.isTempID=true;
}
data.properties.id=this.id;
}
if((_1bdf.preserveTagName!==false)&&(this.id)){
data.tagName=this._srcElement.tag;
}
var _1be2=_1bb8.query(this,"property");
if(this.domNode&&this.domNode.parentNode){
var _1be3=_1be0.getEnclosingWidget(this.domNode.parentNode);
var _1be4=_1bb8.query(_1be3,"childProperties");
if(_1be4){
if(!_1be2){
_1be2=_1be4;
}else{
_1be2=dojo.mixin({},_1be2,_1be4);
}
}
}
if(_1be2){
for(var name in _1be2){
if(this._skipAttrs.indexOf(name.toLowerCase())!==-1){
continue;
}
var _1be5=_1be2[name];
var value=this.getPropertyValue(name);
if(value&&value.length){
if(_1be5.datatype=="array"){
if(!_1bbd(value,_1be5.defaultValue)){
data.properties[name]=value;
}
}else{
if(value!=_1be5.defaultValue){
data.properties[name]=value;
}
}
}else{
if((_1be5.datatype=="boolean"||_1be5.datatype=="number")&&value!=_1be5.defaultValue){
data.properties[name]=value;
}else{
if(_1be5.datatype&&(_1be5.datatype.indexOf("dijit")==0||_1be5.datatype=="object"&&_1be5.isData)){
data.properties[name]=value;
}
}
}
}
}
data.properties.style=this.getStyle(_1bdf);
var _1be6=this.getClassNames(_1bdf);
if(_1be6){
data.properties["class"]=_1be6;
}
data.children=this.getChildrenData(_1bdf);
return data;
},getData:function(_1be7){
_1be7=_1be7||{identify:true,preserveStates:true};
var data,_1be8=this.getHelper();
if(_1be8&&_1be8.getData){
data=_1be8.getData.apply(_1be8,[this,_1be7]);
}else{
data=this._getData(_1be7);
}
data.maqAppStates=dojo.clone(this.domNode._maqAppStates);
data.maqDeltas=dojo.clone(this.domNode._maqDeltas);
if(!data.properties){
data.properties={};
}
if(this.properties){
for(var name in this.properties){
if(!(name in data.properties)){
data.properties[name]=this.properties[name];
}
}
}
var _1be9=this._srcElement;
var _1bea=_1be9.attributes;
for(var i=0;i<_1bea.length;i++){
var _1beb=_1bea[i];
if(_1beb.name.substr(0,2).toLowerCase()=="on"){
data.properties[_1beb.name]=_1beb.value;
}
}
return data;
},getPropertyValue:function(name){
if(name==="id"){
return this.getId();
}else{
if(name==="jsId"){
return this.getObjectId();
}
}
var _1bec=this.getHelper();
if(_1bec&&_1bec.getPropertyValue){
return _1bec.getPropertyValue(this,name);
}
return this._getPropertyValue(name);
},_getPropertyValue:function(name){
return this.domNode.getAttribute(name);
},getTagName:function(){
return this.domNode.nodeName.toLowerCase();
},getStyleValues:function(){
function _1bed(_1bee){
for(var j=_1bef.length-1;j>=0;j--){
var item=_1bef[j];
if(item[_1bee]!==undefined){
_1bef.splice(j,1);
}
}
};
var style=this.getStyleNode().style;
var text=this._srcElement.getAttribute("style");
var _1bef=require("davinci/ve/widget").parseStyleValues(text);
var _1bf0=this.getParent();
if(style&&_1bf0&&_1bf0.dijitWidget&&_1bf0.dijitWidget.addChild&&!_1bf0.acceptsHTMLChildren){
_1bed("position");
_1bed("left");
_1bed("top");
}
return _1bef;
},getStyleValuesAllStates:function(){
var _1bf1=this.getStyleValues();
var _1bf2={"undefined":_1bf1};
var _1bf3=this.domNode._maqDeltas;
if(_1bf3){
for(var state in _1bf3){
if(_1bf3[state].style){
if(state=="undefined"){
_1bf2[state]=_1bbb.mergeStyleArrays(_1bf1,_1bf3[state].style);
}else{
_1bf2[state]=_1bf3[state].style;
}
}
}
}
return _1bf2;
},_updateSrcStyle:function(){
var _1bf4=this.getStyle();
if(_1bf4.length){
this._srcElement.addAttribute("style",_1bf4);
}else{
this._srcElement.removeAttribute("style");
}
},_getStyleString:function(_1bf5){
if(!_1bf5){
return "";
}
var v=this._sortStyleValues(_1bf5);
var text=this._styleText(v);
return text;
},setStyleValuesCanvas:function(_1bf6){
if(!_1bf6){
return;
}
var text=this._getStyleString(_1bf6);
var _1bf7=this.getStyleNode();
dojo.attr(_1bf7,"style",text);
if(this.dijitWidget){
this.dijitWidget.style=text;
}
},setStyleValuesModel:function(_1bf8){
var text=this._getStyleString(_1bf8);
if(text.length>0){
this._srcElement.addAttribute("style",text);
}else{
this._srcElement.removeAttribute("style");
}
},setStyleValuesAllStates:function(_1bf9){
this.domNode._maqDeltas=undefined;
if(_1bf9){
for(var state in _1bf9){
var _1bfa=_1bf9[state];
if(state==="undefined"){
state=undefined;
}
davinci.ve.states.setStyle(this.domNode,state,_1bfa,true);
}
}
},isLayout:function(){
return false;
},resize:function(){
},refresh:function(){
var _1bfb=this.getParent();
if(_1bfb.dijitWidget){
_1bfb.refresh();
}else{
if(this.resize){
this.resize();
}
}
},removeChild:function(child){
if(!child){
return;
}
var _1bfc=this.getContainerNode();
if(_1bfc){
_1bfc.removeChild(child.domNode);
this._srcElement.removeChild(child._srcElement);
}
},setProperties:function(_1bfd,_1bfe){
if(!this.properties){
this.properties={};
}
_1bfe=_1bfe||false;
if(_1bfd.id){
this._srcElement.addAttribute("id",_1bfd.id,_1bfd.isTempID);
delete _1bfd.id;
delete _1bfd.isTempID;
}
if(_1bfd.isTempID){
delete _1bfd.isTempID;
}
for(var name in _1bfd){
var _1bff=_1bfd[name];
if(_1bff||typeof _1bff=="boolean"||typeof _1bff=="number"){
var value=this._stringValue(name,_1bff);
if(!_1bfe){
this.properties[name]=value;
}
this._srcElement.addAttribute(name,value);
}else{
delete this.properties[name];
this._srcElement.removeAttribute(name);
}
}
},startup:function(){
},renderWidget:function(){
},destroyWidget:function(_1c00){
var _1c01=this.getHelper();
if(_1c01&&_1c01.destroy){
_1c01.destroy(this);
return;
}
if(this.dijitWidget){
this.dijitWidget.destroyRecursive();
}else{
dojo.forEach(this.getChildren(),function(each){
each.destroyWidget();
});
}
},selectChild:function(_1c02){
},attach:function(){
var _1c03=this.getHelper();
if(_1c03&&_1c03.create){
_1c03.create(this,this._srcElement);
}
},_stringValue:function(_1c04,value){
var _1c05=this.getMetadata();
var _1c06=_1c05.property&&_1c05.property[_1c04];
if(!_1c06){
return value;
}
if(_1c06.datatype=="object"){
if(value.getObjectId){
value=value.getObjectId();
}else{
var _1c07=value._edit_object_id;
if(_1c07){
return _1c07;
}
if(value.domNode){
return value.domNode.getAttribute("jsId");
}
}
}else{
if(_1c06.datatype=="json"){
var _1c08=this.getContext();
var dj=_1c08&&_1c08.getDojo()||dojo;
var _1c09=this.getHelper();
if(_1c09&&_1c09.checkValue){
value=_1c09.checkValue(value);
}
if(dj.isObject(value)){
value=dj.toJson(value);
}
}else{
if(_1c06.datatype=="string"){
switch(_1c06.format){
case "date":
case "time":
if(isFinite(value)){
value=dojo.date.stamp.toISOString(value,{selector:_1c06.format});
}
break;
default:
value=_1bba.encode(value);
}
}
}
}
return value;
}});
});
},"davinci/ve/VisualEditor":function(){
require({cache:{"url:davinci/ve/template.html":"<!DOCTYPE html>\n<html>\n<head>\n<meta charset=\"utf-8\" />\n<title>Untitled</title>\n</head>\n<body>\n</body>\n</html>\n"}});
define("davinci/ve/VisualEditor",["dojo/_base/declare","dojo/_base/lang","dojo/_base/connect","dojo/promise/all","dojo/text!./template.html","../Runtime","../Workbench","../model/Path","./metadata","./Context","preview/silhouetteiframe","../workbench/Preferences","./widget","../XPathUtils","../html/HtmlFileXPathAdapter","./utils/GeomUtils"],function(_1c0a,lang,_1c0b,all,_1c0c,_1c0d,_1c0e,Path,_1c0f,_1c10,_1c11,_1c12,_1c13,_1c14,_1c15,_1c16){
var _1c17=_1c0a("davinci.ve.VisualEditor",null,{deviceName:"none",_orientation:"portrait",_subscriptions:[],constructor:function(_1c18,_1c19){
this._pageEditor=_1c19;
this.contentPane=dijit.getEnclosingWidget(_1c18);
this.loadingDiv=dojo.create("div",{className:"loading",innerHTML:dojo.replace("<table><tr><td><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>&nbsp;{0}</td></tr></table>",["Loading..."])},this.contentPane.domNode.parentNode,"first");
dojo.addClass(this.contentPane.domNode,"fullPane");
var _1c1a=dojo.create("div",{className:"silhouette_div_container"},this.contentPane.domNode);
dojo.create("span",{className:"silhouetteiframe_object_container"},_1c1a);
this.silhouetteiframe=new _1c11({rootNode:_1c1a,margin:20});
var _1c1b=this;
this.contentPane.connect(this.contentPane,"resize",function(_1c1c){
var _1c1d=dojo.query(".designCP iframe",this._pageEditor.domNode)[0];
if(_1c1d&&_1c1d.contentDocument&&_1c1d.contentDocument.body){
var _1c1e=_1c1d.contentDocument.body;
_1c1b._resizeBody(_1c1e,_1c1c);
setTimeout(function(){
var _1c1f=_1c1b.getContext();
_1c1f.clearCachedWidgetBounds();
_1c1f.updateFocusAll();
_1c1b._registerScrollHandlers();
},100);
}
}.bind(this));
this._pageEditor.deferreds=all(_1c0f.getDeferreds());
this._subscriptions.push(dojo.subscribe("/davinci/ui/editorSelected",this._editorSelected.bind(this)));
this._subscriptions.push(dojo.subscribe("/davinci/ui/context/loaded",this._contextLoaded.bind(this)));
var _1c20=document.getElementById("visualEditorBorder");
if(!_1c20){
var _1c21=document.getElementById("editorsStackContainer");
_1c20=dojo.create("div",{id:"visualEditorBorder"},_1c21);
dojo.create("div",{id:"visualEditorBorderTopLeft"},_1c20);
dojo.create("div",{id:"visualEditorBorderTopRight"},_1c20);
dojo.create("div",{id:"visualEditorBorderTop"},_1c20);
dojo.create("div",{id:"visualEditorBorderRight"},_1c20);
dojo.create("div",{id:"visualEditorBorderLeft"},_1c20);
}
},getDevice:function(){
return this.deviceName;
},setDevice:function(_1c22){
this.deviceName=_1c22;
var _1c23=this.getContext();
_1c23.setMobileMeta(_1c22);
_1c23.setMobileTheme(_1c22);
var _1c24=_1c22=="none"?null:"app/preview/images/"+_1c22+".svg";
this.silhouetteiframe.setSVGFilename(_1c24);
_1c23.clearCachedWidgetBounds();
dojo.publish("/davinci/ui/deviceChanged",[_1c22]);
dojo.publish("/davinci/ui/repositionFocusContainer",[]);
},toggleOrientation:function(){
if(this.deviceName!="none"){
if(this._orientation=="landscape"){
this._orientation="portrait";
}else{
this._orientation="landscape";
}
this.setOrientation(this._orientation);
}
this.getContext().clearCachedWidgetBounds();
},getOrientation:function(_1c25){
return this._orientation;
},setOrientation:function(_1c26){
if(this.deviceName!="none"){
this._orientation=_1c26;
var _1c27=_1c0e.getOpenEditor();
if(_1c27.editorContainer&&_1c27.editorContainer.updateToolbars){
_1c27.editorContainer.updateToolbars();
}
var _1c28=this.getContext();
_1c28.setMobileOrientation(this._orientation);
this.silhouetteiframe.setOrientation(this._orientation);
_1c27._visualChanged();
setTimeout(function(){
_1c28.clearCachedWidgetBounds();
_1c28.updateFocusAll();
}.bind(this),100);
}
},_objectPropertiesChange:function(event){
if(!this.isActiveEditor()){
return;
}
var _1c29=this.getContext();
var _1c2a=event.compoundCommand;
var _1c2b=event.command;
var _1c2c=_1c29.getCommandStack();
if(_1c2a){
_1c2c.execute(_1c2a);
}else{
_1c2c.execute(_1c2b);
}
if(_1c2b._newId){
var _1c2d=_1c13.byId(_1c2b._newId,_1c29.getDocument());
_1c29.select(_1c2d);
}else{
var _1c2e=_1c29.getSelection();
var _1c2d=_1c2e.length?_1c2e[_1c2e.length-1]:undefined;
if(_1c2e.length>1){
_1c29.select(_1c2d);
}
}
this._srcChanged();
},isActiveEditor:function(){
var _1c2f=_1c0d.currentEditor;
return _1c2f&&_1c2f.declaredClass=="davinci.ve.PageEditor"&&_1c2f.visualEditor==this;
},_stylePropertiesChange:function(value){
if(!this.isActiveEditor()){
return;
}
var _1c30=this.getContext().getCommandForStyleChange(value);
if(_1c30){
this.getContext().getCommandStack().execute(_1c30);
if(_1c30._newId){
var _1c31=_1c13.byId(_1c30._newId,context.getDocument());
this.context.select(_1c31);
}
this._srcChanged();
dojo.publish("/davinci/ui/widgetValuesChanged",[value]);
}
},_srcChanged:function(){
this.isDirty=true;
},getContext:function(){
return this.context;
},getTemplate:function(){
return _1c0c;
},destroy:function(){
if(!this._handles){
return;
}
if(this._focusPopup){
this._focusPopup.destroyRecursive();
}
this._focusPopup=null;
this.context.destroy();
this._handles.forEach(dojo.disconnect);
if(this._iframeScrollHandler){
dojo.disconnect(this._iframeScrollHandler);
this._iframeScrollHandler=null;
}
if(this._designCPScrollHandler){
dojo.disconnect(this._designCPScrollHandler);
this._designCPScrollHandler=null;
}
for(var i=0;i<this._subscriptions.length;i++){
dojo.unsubscribe(this._subscriptions[i]);
}
this._subscriptions=[];
},setContent:function(_1c32,_1c33,_1c34){
this._onloadMessages=[];
this._setContent(_1c32,_1c33,_1c34);
},saveAs:function(_1c35,_1c36,_1c37){
this._setContent(_1c35,_1c37);
},_setContent:function(_1c38,_1c39,_1c3a){
this._setContentRaw(_1c38,_1c39,_1c3a);
},_setContentRaw:function(_1c3b,_1c3c,_1c3d){
this.fileName=_1c3b;
this.basePath=new Path(_1c3b);
if(!this.initialSet){
var _1c3e=_1c0d.getUserWorkspaceUrl();
if(_1c3b.indexOf("./")==0){
_1c3b=_1c3b.substring(2,_1c3b.length);
}
var _1c3f=_1c3e+_1c3b;
this._handles=[];
var _1c40=dojo.query(".silhouette_div_container",this.contentPane.domNode)[0];
this.context=new _1c10({editor:this._pageEditor,visualEditor:this,containerNode:_1c40,model:_1c3c,baseURL:_1c3f,iframeattrs:{"class":"silhouetteiframe_iframe"}});
this.context._commandStack=this._commandStack;
this._commandStack._context=this.context;
var prefs=_1c12.getPreferences("davinci.ve.editorPrefs",_1c0e.getProject());
if(prefs){
this.context.setPreferences(prefs);
}
this._handles.push(dojo.connect(this.context,"onContentChange",this,this.onContentChange));
this.title=dojo.doc.title;
this.context._setSource(_1c3c,this._connectCallback,this,_1c3d);
var flow=this.context.getFlowLayout();
this.initialSet=true;
}else{
this.context.setSource(_1c3c,this.context._restoreStates,this.context);
}
},_connectCallback:function(_1c41){
try{
var _1c42=this.context,popup;
this.savePoint=0;
_1c42.activate();
popup=_1c0e.createPopup({partID:"davinci.ve.visualEditor",domNode:_1c42.getContainerNode(),keysDomNode:_1c42.getDocument(),context:_1c42});
popup.adjustPosition=function(event){
var _1c43=dojo.position(_1c42.frameNode);
dojo.withDoc(_1c42.getDocument(),function(){
var _1c44=dojo.docScroll();
_1c43.x-=_1c44.x;
_1c43.y-=_1c44.y;
});
return _1c43;
};
this._focusPopup=_1c0e.createPopup({partID:"davinci.ve.visualEditor",domNode:_1c42.getFocusContainer(),keysDomNode:_1c42.getDocument(),context:_1c42});
_1c42.getTopWidgets().forEach(function(_1c45){
if(_1c45.resize){
_1c45.resize();
}
});
_1c42.anyDojoxMobileWidgets=undefined;
dojo.publish("/davinci/ui/context/pagebuilt",[_1c42]);
}
catch(e){
_1c41=e;
}
finally{
if(_1c41.errorMessage){
this.loadingDiv.innerHTML=_1c41.errorMessage||"(unknown)";
}else{
if(_1c41 instanceof Error){
var _1c46="Uh oh! An error has occurred:<br><b>"+_1c41.message+"</b>";
if(_1c41.fileName){
_1c46+="<br>file: "+_1c41.fileName+"<br>line: "+_1c41.lineNumber;
}
if(_1c41.stack){
_1c46+="<br><pre>"+_1c41.stack+"</pre>";
}
this.loadingDiv.innerHTML=_1c46;
dojo.addClass(this.loadingDiv,"error");
}else{
if(this.loadingDiv.parentNode){
this.loadingDiv.parentNode.removeChild(this.loadingDiv);
}
delete this.loadingDiv;
}
}
}
},getSelectedWidget:function(){
var _1c47=this.getContext(),_1c48=_1c47.getSelection(),_1c49=_1c48.length?_1c48[_1c48.length-1]:undefined;
if(_1c48.length>1){
_1c47.select(_1c49);
}
return _1c49;
},getSelectedSubWidget:function(){
return this._selectedSubWidget;
},saved:function(){
this.save();
},getFileEditors:function(){
debugger;
},save:function(_1c4a){
if(!this.context){
return;
}
var model=this.context.getModel();
model.setDirty(true);
var _1c4b={visit:function(node){
if((node.elementType=="HTMLFile"||node.elementType=="CSSFile")&&node.isDirty()){
node.save(_1c4a);
}
return false;
}};
model.visit(_1c4b);
this.getContext().saveDynamicCssFiles(this.context.cssFiles,_1c4a);
this.isDirty=_1c4a;
},removeWorkingCopy:function(){
},getDefaultContent:function(){
return this.getTemplate();
},previewInBrowser:function(){
var _1c4c=this.deviceName,_1c4d=_1c0e.getOpenEditor(),_1c4e=_1c4d.resourceFile.getURL(),query=[];
if(_1c4c&&_1c4c.length&&_1c4c!="none"){
query=["preview=1","device="+encodeURIComponent(_1c4c),"file="+encodeURIComponent(_1c4e)];
_1c4e=_1c0e.location();
if(this._orientation=="landscape"){
query.push("orientation="+this._orientation);
}
}
var _1c4f=this.context.getPreference("zazl");
if(_1c4f){
query.push("zazl=true");
}
if(query.length){
_1c4e+="?"+query.join("&");
}
window.open(_1c4e,"preview_"+_1c4e);
},refresh:function(){
var _1c50=this.context,xpath=_1c14.getXPath(_1c50.getSelection()[0]._srcElement,_1c15);
_1c50.setSource(_1c50.model);
var id=_1c50.model.evaluate(xpath).getAttribute("id"),_1c51=_1c13.byId(id,_1c50.getDocument());
setTimeout(function(){
_1c50.select(_1c51);
},0);
},_contextLoaded:function(_1c52){
if(_1c52==this.getContext()){
this._registerScrollHandlers();
}
},_editorSelected:function(event){
var _1c53=this.getContext();
var _1c54=_1c53?_1c53.getFocusContainer():null;
if(event.oldEditor==this._pageEditor){
if(_1c54&&this._focusPopup){
this._focusPopup.unBindDomNode(_1c54);
}
}
if(event.editor==this._pageEditor){
this._registerScrollHandlers();
if(_1c54&&this._focusPopup){
this._focusPopup.bindDomNode(_1c54);
}
}
var _1c55=document.getElementById("visualEditorBorder");
if(_1c55){
if(!event.editor||event.editor.declaredClass!="davinci.ve.PageEditor"){
_1c55.style.display="none";
}else{
_1c55.style.display="block";
}
}
},_resizeBody:function(_1c56,size){
var _1c57=_1c16.getScrollLeft(_1c56);
var _1c58=_1c16.getScrollTop(_1c56);
if(_1c57>0){
_1c56.style.width=(size.w+_1c57)+"px";
}else{
_1c56.style.width="100%";
}
if(_1c58>0){
_1c56.style.height=(size.h+_1c58)+"px";
}else{
_1c56.style.height="100%";
}
},_scrollHandler:function(e){
var _1c59=dojo.query(".designCP iframe",this._pageEditor.domNode)[0];
if(_1c59&&_1c59.contentDocument&&_1c59.contentDocument.body){
var _1c5a=_1c59.contentDocument.body;
this._resizeBody(_1c5a,{w:dojo.style(this.contentPane.domNode,"width"),h:dojo.style(this.contentPane.domNode,"height")});
setTimeout(function(){
var _1c5b=this.getContext();
_1c5b.clearCachedWidgetBounds();
_1c5b.updateFocusAll();
}.bind(this),100);
}
},_registerScrollHandlers:function(){
if(!this._iframeScrollHandler){
var _1c5c=dojo.query(".designCP iframe",this._pageEditor.domNode)[0];
if(_1c5c&&_1c5c.contentDocument&&_1c5c.contentDocument.body){
var _1c5d=_1c5c.contentDocument.body;
this._iframeScrollHandler=dojo.connect(_1c5d.ownerDocument,"onscroll",this,this._scrollHandler);
}
}
if(!this._designCPScrollHandler){
var _1c5e=dojo.query(".designCP",this._pageEditor.domNode)[0];
if(_1c5e){
this._designCPScrollHandler=dojo.connect(_1c5e,"onscroll",this,this._scrollHandler);
}
}
}});
return _1c17;
});
},"dijit/_DialogMixin":function(){
define("dijit/_DialogMixin",["dojo/_base/declare","./a11y"],function(_1c5f,a11y){
return _1c5f("dijit._DialogMixin",null,{execute:function(){
},onCancel:function(){
},onExecute:function(){
},_onSubmit:function(){
this.onExecute();
this.execute(this.get("value"));
},_getFocusItems:function(){
var elems=a11y._getTabNavigable(this.containerNode);
this._firstFocusItem=elems.lowest||elems.first||this.closeButtonNode||this.domNode;
this._lastFocusItem=elems.last||elems.highest||this._firstFocusItem;
}});
});
},"dijit/form/_CheckBoxMixin":function(){
define("dijit/form/_CheckBoxMixin",["dojo/_base/declare","dojo/dom-attr","dojo/_base/event"],function(_1c60,_1c61,event){
return _1c60("dijit.form._CheckBoxMixin",null,{type:"checkbox",value:"on",readOnly:false,_aria_attr:"aria-checked",_setReadOnlyAttr:function(value){
this._set("readOnly",value);
_1c61.set(this.focusNode,"readOnly",value);
this.focusNode.setAttribute("aria-readonly",value);
},_setLabelAttr:undefined,_getSubmitValue:function(value){
return !value&&value!==0?"on":value;
},_setValueAttr:function(_1c62){
_1c62=this._getSubmitValue(_1c62);
this._set("value",_1c62);
_1c61.set(this.focusNode,"value",_1c62);
},reset:function(){
this.inherited(arguments);
this._set("value",this.params.value||"on");
_1c61.set(this.focusNode,"value",this.value);
},_onClick:function(e){
if(this.readOnly){
event.stop(e);
return false;
}
return this.inherited(arguments);
}});
});
},"davinci/commands/CompoundCommand":function(){
define(["dojo/_base/declare"],function(_1c63){
return _1c63("davinci.commands.CompoundCommand",null,{name:"compound",_commands:[],constructor:function(_1c64){
this._commands=[];
if(_1c64){
this._commands=[_1c64];
}
},add:function(_1c65){
if(!_1c65){
return;
}
if(!this._commands){
if(_1c65.name=="compound"){
this._commands=_1c65._commands;
}else{
this._commands=[_1c65];
}
}else{
if(_1c65.name=="compound"){
dojo.forEach(_1c65._commands,function(c){
this.add(c);
},this);
return;
}else{
if(_1c65.name=="modify"){
var id=_1c65._oldId;
for(var i=0;i<this._commands.length;i++){
var c=this._commands[i];
if(c.name=="modify"&&c._oldId==id){
c.add(_1c65);
return;
}
}
}
}
this._commands.push(_1c65);
}
},setContext:function(_1c66){
for(var i=0;i<this._commands.length;i++){
if(this._commands[i].setContext){
this._commands[i].setContext(_1c66);
}
}
},isEmpty:function(){
return (!this._commands||this._commands.length===0);
},execute:function(){
if(!this._commands){
return;
}
for(var i=0;i<this._commands.length;i++){
this._commands[i].execute();
if(this._commands[i]._oldId&&this._commands[i]._newId){
this._oldId=this._commands[i]._oldId;
this._newId=this._commands[i]._newId;
}
}
},undo:function(){
if(!this._commands){
return;
}
for(var i=this._commands.length-1;i>=0;i--){
this._commands[i].undo();
}
}});
});
},"davinci/ve/GenericWidget":function(){
define(["dojo/_base/declare","./_Widget"],function(_1c67,_1c68){
return _1c67("davinci.ve.GenericWidget",_1c68,{isGenericWidget:true,constructor:function(_1c69,node,type,_1c6a,_1c6b){
dojo.attr(node,"dvwidget",type);
if(_1c6b){
_1c6b.addAttribute("dvwidget",type);
}
},buildRendering:function(){
this.containerNode=this.domNode;
if(this._params){
for(var name in this._params){
this.domNode.setAttribute(name,this._params[name]);
}
this._params=undefined;
}
},_getChildrenData:function(_1c6c){
var _1c6d=[];
var _1c6e=this.domNode.childNodes;
for(var i=0;i<_1c6e.length;i++){
var n=_1c6e[i];
var d;
switch(n.nodeType){
case 1:
var w=require("davinci/ve/widget").byNode(n);
if(w){
d=w.getData(_1c6c);
}
break;
case 3:
d=n.nodeValue.trim();
if(d&&_1c6c.serialize){
d=davinci.html.escapeXml(d);
}
break;
case 8:
d="<!--"+n.nodeValue+"-->";
break;
}
if(d){
_1c6d.push(d);
}
}
if(_1c6d.length===0){
return undefined;
}
return _1c6d;
},setProperties:function(_1c6f){
var node=this.domNode;
for(var name in _1c6f){
if(name==="style"){
dojo.style(node,_1c6f[name]);
}else{
if(!_1c6f[name]){
node.removeAttribute(name);
}else{
node[name]=_1c6f[name];
}
}
}
this.inherited(arguments);
},_attr:function(name,value){
if(arguments.length>1){
this.domNode.setAttribute(name,value);
}else{
return this.domNode.getAttribute(name);
}
},getTagName:function(){
return this.domNode.nodeName.toLowerCase();
}});
});
},"davinci/ve/widgets/WidgetToolBar":function(){
require({cache:{"url:davinci/ve/widgets/templates/WidgetToolBar.html":"<div class=\"propertiesTitleBar\" style=\"display: none\">\n\t<div class='propertiesWidgetDescription'>\n\t\t<span class='propertiesWidgetDescriptionFor'>${veNLS.toolBarFor}</span>\n\t\t<span data-dojo-attach-point=\"descNode\">${veNLS.noSelection}</span>\n\t</div>\n\n\t<div class=\"propertiesTitleBarPropertiesContainer\">\n\t\t<table width=\"100%\" cellspacing=\"0\" cellpadding=\"0\" border=\"0\" align=\"center\" class=\"propertiesTitleBarProperties property_table_stretchable\">\n\t\t\t<colgroup><col style=\"width:10px;\"><col class=\"gap02\"><col class=\"gap03\"><col style=\"width:10px;\"><col style=\"width:6px;\"></colgroup>\n\t\t\t<tbody>\n\t\t\t\t<tr class=\"cssPropertySection\">\n\t\t\t\t\t<td></td>\n\t\t\t\t\t<td class=\"propertyDisplayName\">${veNLS.toolBarClass}&nbsp;</td>\n\t\t\t\t\t<td class=\"propertyInputField\">\n\t\t\t\t\t  <input data-dojo-type=\"dijit.form.ComboBox\" data-dojo-attach-point=\"classComboBox\" label=\"\" data-dojo-attach-event=\"onChange:_onChangeClassAttribute,onFocus:_onFieldFocus,onBlur:_onFieldBlur\" style=\"width: 100%\" searchAttr=\"name\"/>\n\t\t\t\t\t</td>\n\t\t\t\t\t<td nowrap=\"true\" class=\"propertyExtra\"></td>\n\t\t\t\t\t<td></td>\n\t\t\t\t</tr>\n\t\n\t\t\t\t<tr class=\"cssPropertySection\">\n\t\t\t\t\t<td></td>\n\t\t\t\t\t<td class=\"propertyDisplayName\">${veNLS.toolBarId}&nbsp;</td>\n\t\t\t\t\t<td class=\"propertyInputField\">\n\t\t\t\t\t  <input data-dojo-type=\"dijit.form.ValidationTextBox\" data-dojo-attach-point=\"idTextBox\" label=\"\" data-dojo-attach-event=\"onChange:_onChangeIDAttribute,onKeyPress:_onKeyPress,onFocus:_onFieldFocus,onBlur:_onFieldBlur\" style=\"width: 100%\"/>\n\t\t\t\t\t</td>\n\t\t\t\t\t<td nowrap=\"true\" class=\"propertyExtra\"></td>\n\t\t\t\t\t<td></td>\n\t\t\t\t</tr>\n\t\t\t</tbody>\n\t\t</table>\n\t</div>\n</div>\n"}});
define("davinci/ve/widgets/WidgetToolBar",["dojo/_base/declare","dijit/_Templated","dijit/_Widget","davinci/Runtime","davinci/workbench/ViewLite","davinci/ve/commands/ModifyCommand","dijit/form/ComboBox","dijit/form/ValidationTextBox","dijit/form/TextBox","dojo/store/Memory","dojo/i18n!davinci/ve/nls/ve","dojo/i18n!dijit/nls/common","davinci/ve/widget","dojo/text!./templates/WidgetToolBar.html",],function(_1c70,_1c71,_1c72,_1c73,_1c74,_1c75,_1c76,_1c77,_1c78,_1c79,veNLS,_1c7a,_1c7b,_1c7c){
return _1c70("davinci.ve.widgets.WidgetToolBar",[_1c74,_1c72,_1c71],{templateString:_1c7c,widgetsInTemplate:true,descNode:null,idTextBox:null,classComboBox:null,widgetDescStart:"",widgetDescUnselectEnd:"",_oldIDName:null,_oldClassName:null,veNLS:veNLS,postCreate:function(){
this.idTextBox.validator=dojo.hitch(this,function(value,_1c7d){
this.invalidMessage=null;
if(!value||!this._widget||this.changing){
return true;
}
var w=_1c7b.byId(value);
if(w&&w!==this._widget){
this.invalidMessage=veNLS.idAlreadyUsed;
return false;
}
return true;
});
dojo.subscribe("/davinci/ui/widget/replaced",dojo.hitch(this,this._widgetReplaced));
},initialize:function(){
this._editor=_1c73.currentEditor;
if(this._editor&&this._editor.visualEditor&&this._editor.visualEditor.context){
var _1c7e=this._editor.visualEditor.context.getSelection();
if(_1c7e.length==0){
this._widget=null;
}else{
this._widget=_1c7e[0];
}
}else{
this._widget=null;
}
this.onWidgetSelectionChange();
},onEditorSelected:function(){
this.initialize();
if(this._editor&&this._editor.editorID=="davinci.ve.HTMLPageEditor"){
this.domNode.style.display="block";
}else{
this.domNode.style.display="none";
}
},_widgetReplaced:function(_1c7f,_1c80){
if(this._widget===_1c80){
this._widget=_1c7f;
this.onWidgetSelectionChange();
}
},onWidgetSelectionChange:function(){
var _1c81="";
if(this._widget){
_1c81=_1c7b.getLabel(this._widget);
this.context=this._widget.getContext();
this.classComboBox.set("disabled",false);
this.idTextBox.attr("disabled",false);
}else{
this.descNode.innerHTML=veNLS.noSelection;
dojo.removeClass(this.domNode,"propertiesSelection");
this.context=null;
this.classComboBox.set("value","");
this.classComboBox.set("disabled",true);
this.idTextBox.attr("value","");
this.idTextBox.attr("disabled",true);
return;
}
this.changing=true;
this._oldIDName=null;
this._oldClassName=null;
dojo.addClass(this.domNode,"propertiesSelection");
this.descNode.innerHTML=_1c81;
if(this._editor&&this._editor.declaredClass==="davinci.ve.PageEditor"){
var _1c82=this._widget._srcElement;
if(_1c82){
var _1c83=[];
var docEl=this._widget.getContext().getModel().getDocumentElement();
if(docEl){
var _1c84={visit:function(node){
if(node.elementType=="HTMLElement"&&node.tag!="body"&&node.tag!="html"){
var c=node.getAttribute("class");
if(c){
var _1c85=dojo.trim(c).split(" ");
dojo.forEach(_1c85,dojo.hitch(this,function(_1c86){
if(dojo.indexOf(this.classes,_1c86)==-1){
this.classes.push(_1c86);
}
}));
}
}
},classes:[]};
docEl.visit(_1c84);
dojo.forEach(_1c84.classes,function(_1c87){
_1c83.push({name:_1c87});
});
}
var _1c88=new _1c79({data:_1c83});
this.classComboBox.set("store",_1c88);
var _1c89=_1c82.getAttribute("class");
var _1c8a=(_1c89&&dojo.trim(_1c89))||"";
this.classComboBox.set("value",_1c8a);
this._oldClassName=_1c8a;
var _1c8b=this._widget.getId();
var _1c8c=(_1c8b&&dojo.trim(_1c8b))||"";
this._oldIDName=_1c8c;
this.idTextBox.attr("value",_1c8c);
}
}
this.changing=false;
},_onChangeIDAttribute:function(){
if(!this._widget||this.changing){
return;
}
var _1c8d=this.idTextBox;
if(!_1c8d||!_1c8d.isValid()){
return;
}
if(this.context){
this.context.blockChange(false);
}
var value=_1c8d.attr("value");
if(value!==this._oldIDName){
this._oldIDName=value;
var _1c8e={};
_1c8e["id"]=value;
var _1c8f=new _1c75(this._widget,_1c8e,null);
dojo.publish("/davinci/ui/widgetPropertiesChanges",[{source:this._editor.editor_id,command:_1c8f}]);
}
},_onChangeClassAttribute:function(){
if(!this._widget||this.changing){
return;
}
var _1c90=this.classComboBox;
if(!_1c90){
return;
}
if(this.context){
this.context.blockChange(false);
}
var _1c91=_1c90.attr("value");
if(_1c91!==this._oldClassName){
this._oldClassName=_1c91;
var _1c92={};
_1c92["class"]=_1c91;
var _1c93=new davinci.ve.commands.ModifyCommand(this._widget,_1c92,null);
dojo.publish("/davinci/ui/widgetPropertiesChanges",[{source:this._editor.editor_id,command:_1c93}]);
}
},_onFieldFocus:function(){
if(this.context){
this.context.blockChange(true);
}
},_onFieldBlur:function(){
if(this.context){
this.context.blockChange(false);
}
},_onKeyPress:function(e){
if(e.keyCode==dojo.keys.ENTER){
this._onChangeIDAttribute();
}
}});
});
},"davinci/js/js.plugin":function(){
define(["require"],function(_1c94){
return {id:"davinci.js","davinci.editor":{id:"JSEditor",name:"JavaScript Editor",extensions:"js,json",isDefault:true,editorClass:"davinci/js/ui/JavaScriptEditor",palettePerspective:"davinci.html.htmlEditor",expandPalettes:["left"]},"davinci.actionSets":[{id:"jsEdit",visible:true,actions:[{id:"davinci.js.cut",icon:null,label:"cut",commandID:"davinci.js.cut",menubarPath:"davinci.edit/cut"},{id:"davinci.js.add",icon:null,label:"add",commandID:"davinci.js.add",menubarPath:"davinci.edit/add"},{id:"davinci.js.delete",icon:null,label:"delete",commandID:"davinci.js.delete",menubarPath:"davinci.edit/delete"}]}],"davinci.actionSetPartAssociations":[{targetID:"davinci.js.jsEdit",parts:["davinci.ui.outline","davinci.js.JSEditor"]}],"davinci.editorActions":{editorContribution:{targetID:"davinci.js.JSEditor",actions:[{id:"savecombo",className:"maqLabelButton",showLabel:true,label:"Save",toolbarPath:"save",type:"ComboButton",run:function(){
_1c94(["../Workbench"],function(_1c95){
_1c94("../ui/Resource").save();
});
},isEnabled:function(_1c96){
return _1c94("../Workbench").getOpenEditor();
},menu:[{iconClass:"saveIcon",run:function(){
_1c94("../ui/Resource").save();
},isEnabled:function(_1c97){
return _1c94("../Workbench").getOpenEditor();
},label:"Save",keyBinding:{accel:true,charOrCode:"s",allowGlobal:true}},{iconClass:"saveAsIcon",run:function(){
_1c94("../ui/Resource").saveAs("html");
},isEnabled:function(_1c98){
return _1c94("../Workbench").getOpenEditor();
},label:"Save As",keyBinding:{accel:true,shift:true,charOrCode:"s",allowGlobal:true}}]}]}},"davinci.commands":[{id:"cut",run:function(){
}},{id:"add",run:function(){
}},{id:"delete",run:function(){
}}],"davinci.keyBindings":[{platform:"win",sequence:"M1+C",commandID:"davinci.js.copy",contextID:"davinci.js.JSEditor"}],"davinci.preferences":[],"davinci.fileType":[{extension:"js",iconClass:"jsFileIcon",type:"text"},{extension:"json",iconClass:"jsFileIcon",type:"text"}]};
});
},"davinci/ve/widgets/FontComboBox":function(){
define("davinci/ve/widgets/FontComboBox",["dojo/_base/declare","dijit/form/ComboBox","dojo/i18n!davinci/ve/nls/ve","dojo/i18n!dijit/nls/common"],function(_1c99,_1c9a){
return _1c99("davinci.ve.widgets.FontComboBox",_1c9a,{_getValueAttr:function(){
if(this.store){
for(var i=0;i<this.store._allValues.length;i++){
var item=this.store._allValues[i];
if(item.name[0]==this.value){
return item.value[0];
}
}
}
return this.value;
},_setValueAttr:function(v){
if(this.store&&v){
this.store.fetch({query:{value:v},onComplete:function(items,_1c9b){
if(items.length<1){
this.inherited("_setValueAttr",[v]);
}else{
this.inherited("_setValueAttr",[items[0].name[0]]);
this.item=items[0];
}
}.bind(this),onError:function(){
this.inherited("_setValueAttr",[v]);
}.bind(this)});
}else{
this.inherited("_setValueAttr",[v]);
}
}});
});
},"davinci/ve/utils/URLRewrite":function(){
define([],function(){
var _1c9c=/^\s*url\s*\(\s*(\'[^\'\"]*\'|\"[^\'\"]*\"|[^\'\"]*)\s*\)\s*$/;
var _1c9d=/^[\'\"]?([^\'\"]*)[\'\"]?$/;
var _1c9e=/^(http|ftp)/;
return {isAbsolute:function(url){
if(typeof url!="string"){
return false;
}
var _1c9f=this.getUrl(url);
if(_1c9f){
return _1c9e.test(_1c9f);
}else{
return false;
}
},containsUrl:function(url){
if(typeof url!="string"){
return false;
}
return _1c9c.test(url);
},replaceUrl:function(_1ca0,_1ca1){
if(typeof _1ca0!="string"||typeof _1ca1!="string"){
return null;
}
var _1ca2=this.getUrl(_1ca0);
if(_1ca2){
return "url('"+_1ca1+"')";
}else{
return null;
}
},stripQuotes:function(s){
var _1ca3=s.replace(_1c9d,"$1");
return _1ca3;
},encodeURI:function(url){
var pass1=encodeURI(url);
return pass1.replace(/#/g,"%23");
},getUrl:function(url){
if(typeof url!="string"){
return null;
}
var _1ca4=url.match(_1c9c);
if(_1ca4&&_1ca4.length>1){
var match=_1ca4[1];
return this.stripQuotes(match);
}else{
return null;
}
}};
});
},"url:davinci/review/widgets/templates/OpenReviewDialog.html":"<div class=\"fileDialog\">\n\t<div class=\"dijitDialogPaneContentArea folderContainer\">\n\t\t<div dojoType=\"dijit.layout.ContentPane\" dojoAttachPoint=\"treeContentPane\">\n\t\t</div>\n\t</div>\n\t\n\t<div class=\"dijitDialogPaneActionBar\">\n\t\t<button dojoType=\"dijit.form.Button\" dojoAttachPoint=\"okButton\" dojoAttachEvent=\"onClick:_okButton\" type=\"submit\" class=\"maqPrimaryButton\" disabled=\"disabled\">${finishButtonLabel}</button>\n\t\t<button dojoType=\"dijit.form.Button\" dojoAttachEvent=\"onClick:_cancelButton\" class=\"maqSecondaryButton\">${cancelButtonLabel}</button>\n\t</div>\n</div>\n","dijit/Menu":function(){
define("dijit/Menu",["require","dojo/_base/array","dojo/_base/declare","dojo/_base/event","dojo/dom","dojo/dom-attr","dojo/dom-geometry","dojo/dom-style","dojo/keys","dojo/_base/lang","dojo/on","dojo/sniff","dojo/_base/window","dojo/window","./popup","./DropDownMenu","dojo/ready"],function(_1ca5,array,_1ca6,event,dom,_1ca7,_1ca8,_1ca9,keys,lang,on,has,win,_1caa,pm,_1cab,ready){
if(has("dijit-legacy-requires")){
ready(0,function(){
var _1cac=["dijit/MenuItem","dijit/PopupMenuItem","dijit/CheckedMenuItem","dijit/MenuSeparator"];
_1ca5(_1cac);
});
}
return _1ca6("dijit.Menu",_1cab,{constructor:function(){
this._bindings=[];
},targetNodeIds:[],selector:"",contextMenuForWindow:false,leftClickToOpen:false,refocus:true,postCreate:function(){
if(this.contextMenuForWindow){
this.bindDomNode(this.ownerDocumentBody);
}else{
array.forEach(this.targetNodeIds,this.bindDomNode,this);
}
this.inherited(arguments);
},_iframeContentWindow:function(_1cad){
return _1caa.get(this._iframeContentDocument(_1cad))||this._iframeContentDocument(_1cad)["__parent__"]||(_1cad.name&&win.doc.frames[_1cad.name])||null;
},_iframeContentDocument:function(_1cae){
return _1cae.contentDocument||(_1cae.contentWindow&&_1cae.contentWindow.document)||(_1cae.name&&win.doc.frames[_1cae.name]&&win.doc.frames[_1cae.name].document)||null;
},bindDomNode:function(node){
node=dom.byId(node,this.ownerDocument);
var cn;
if(node.tagName.toLowerCase()=="iframe"){
var _1caf=node,_1cb0=this._iframeContentWindow(_1caf);
cn=win.body(_1cb0.document);
}else{
cn=(node==win.body(this.ownerDocument)?this.ownerDocument.documentElement:node);
}
var _1cb1={node:node,iframe:_1caf};
_1ca7.set(node,"_dijitMenu"+this.id,this._bindings.push(_1cb1));
var _1cb2=lang.hitch(this,function(cn){
var _1cb3=this.selector,_1cb4=_1cb3?function(_1cb5){
return on.selector(_1cb3,_1cb5);
}:function(_1cb6){
return _1cb6;
},self=this;
return [on(cn,_1cb4(this.leftClickToOpen?"click":"contextmenu"),function(evt){
event.stop(evt);
self._scheduleOpen(this,_1caf,{x:evt.pageX,y:evt.pageY});
}),on(cn,_1cb4("keydown"),function(evt){
if(evt.shiftKey&&evt.keyCode==keys.F10){
event.stop(evt);
self._scheduleOpen(this,_1caf);
}
})];
});
_1cb1.connects=cn?_1cb2(cn):[];
if(_1caf){
_1cb1.onloadHandler=lang.hitch(this,function(){
var _1cb7=this._iframeContentWindow(_1caf);
cn=win.body(_1cb7.document);
_1cb1.connects=_1cb2(cn);
});
if(_1caf.addEventListener){
_1caf.addEventListener("load",_1cb1.onloadHandler,false);
}else{
_1caf.attachEvent("onload",_1cb1.onloadHandler);
}
}
},unBindDomNode:function(_1cb8){
var node;
try{
node=dom.byId(_1cb8,this.ownerDocument);
}
catch(e){
return;
}
var _1cb9="_dijitMenu"+this.id;
if(node&&_1ca7.has(node,_1cb9)){
var bid=_1ca7.get(node,_1cb9)-1,b=this._bindings[bid],h;
while((h=b.connects.pop())){
h.remove();
}
var _1cba=b.iframe;
if(_1cba){
if(_1cba.removeEventListener){
_1cba.removeEventListener("load",b.onloadHandler,false);
}else{
_1cba.detachEvent("onload",b.onloadHandler);
}
}
_1ca7.remove(node,_1cb9);
delete this._bindings[bid];
}
},_scheduleOpen:function(_1cbb,_1cbc,_1cbd){
if(!this._openTimer){
this._openTimer=this.defer(function(){
delete this._openTimer;
this._openMyself({target:_1cbb,iframe:_1cbc,coords:_1cbd});
},1);
}
},_openMyself:function(args){
var _1cbe=args.target,_1cbf=args.iframe,_1cc0=args.coords;
this.currentTarget=_1cbe;
if(_1cc0){
if(_1cbf){
var ifc=_1ca8.position(_1cbf,true),_1cc1=this._iframeContentWindow(_1cbf),_1cc2=_1ca8.docScroll(_1cc1.document);
var cs=_1ca9.getComputedStyle(_1cbf),tp=_1ca9.toPixelValue,left=(has("ie")&&has("quirks")?0:tp(_1cbf,cs.paddingLeft))+(has("ie")&&has("quirks")?tp(_1cbf,cs.borderLeftWidth):0),top=(has("ie")&&has("quirks")?0:tp(_1cbf,cs.paddingTop))+(has("ie")&&has("quirks")?tp(_1cbf,cs.borderTopWidth):0);
_1cc0.x+=ifc.x+left-_1cc2.x;
_1cc0.y+=ifc.y+top-_1cc2.y;
}
}else{
_1cc0=_1ca8.position(_1cbe,true);
_1cc0.x+=10;
_1cc0.y+=10;
}
var self=this;
var _1cc3=this._focusManager.get("prevNode");
var _1cc4=this._focusManager.get("curNode");
var _1cc5=!_1cc4||(dom.isDescendant(_1cc4,this.domNode))?_1cc3:_1cc4;
function _1cc6(){
if(self.refocus&&_1cc5){
_1cc5.focus();
}
pm.close(self);
};
pm.open({popup:this,x:_1cc0.x,y:_1cc0.y,onExecute:_1cc6,onCancel:_1cc6,orient:this.isLeftToRight()?"L":"R"});
this.focus();
this._onBlur=function(){
this.inherited("_onBlur",arguments);
pm.close(this);
};
},destroy:function(){
array.forEach(this._bindings,function(b){
if(b){
this.unBindDomNode(b.node);
}
},this);
this.inherited(arguments);
}});
});
},"davinci/ve/actions/MoveToFrontAction":function(){
define(["dojo/_base/declare","./_ReorderAction","davinci/commands/CompoundCommand","davinci/ve/commands/ReparentCommand"],function(_1cc7,_1cc8,_1cc9,_1cca){
return _1cc7("davinci.ve.actions.MoveToFrontAction",[_1cc8],{name:"MoveToFront",iconClass:"editActionIcon editMoveToFrontIcon",run:function(_1ccb){
_1ccb=this.fixupContext(_1ccb);
if(!_1ccb){
return;
}
var _1ccc=(_1ccb&&_1ccb.getSelection)?_1ccb.getSelection():[];
if(_1ccc.length===0){
return;
}
if(!this.selectionSameParentAllAbsolute(_1ccc)){
return;
}
var _1ccd=_1ccc[0].getParent();
var _1cce=this.getAbsoluteSiblings(_1ccc[0]);
var _1ccf=new _1cc9();
for(var i=0;i<_1cce.length;i++){
var _1cd0=_1cce[i];
if(_1ccc.indexOf(_1cd0)>=0){
_1ccf.add(new _1cca(_1cd0,_1ccd,null));
}
}
_1ccb.getCommandStack().execute(_1ccf);
},isEnabled:function(_1cd1){
_1cd1=this.fixupContext(_1cd1);
var _1cd2=(_1cd1&&_1cd1.getSelection)?_1cd1.getSelection():[];
if(_1cd2.length===0){
return false;
}
if(!this.selectionSameParentAllAbsolute(_1cd2)){
return false;
}
var _1cd3=this.getAbsoluteSiblings(_1cd2[0]);
for(var j=0;j<_1cd2.length;j++){
var _1cd4=_1cd2[j];
if(_1cd3.indexOf(_1cd4)<_1cd3.length-_1cd2.length){
return true;
}
}
return false;
}});
});
},"dijit/layout/utils":function(){
define("dijit/layout/utils",["dojo/_base/array","dojo/dom-class","dojo/dom-geometry","dojo/dom-style","dojo/_base/lang","../main"],function(array,_1cd5,_1cd6,_1cd7,lang,dijit){
var _1cd8=lang.getObject("layout",true,dijit);
_1cd8.marginBox2contentBox=function(node,mb){
var cs=_1cd7.getComputedStyle(node);
var me=_1cd6.getMarginExtents(node,cs);
var pb=_1cd6.getPadBorderExtents(node,cs);
return {l:_1cd7.toPixelValue(node,cs.paddingLeft),t:_1cd7.toPixelValue(node,cs.paddingTop),w:mb.w-(me.w+pb.w),h:mb.h-(me.h+pb.h)};
};
function _1cd9(word){
return word.substring(0,1).toUpperCase()+word.substring(1);
};
function size(_1cda,dim){
var _1cdb=_1cda.resize?_1cda.resize(dim):_1cd6.setMarginBox(_1cda.domNode,dim);
if(_1cdb){
lang.mixin(_1cda,_1cdb);
}else{
lang.mixin(_1cda,_1cd6.getMarginBox(_1cda.domNode));
lang.mixin(_1cda,dim);
}
};
_1cd8.layoutChildren=function(_1cdc,dim,_1cdd,_1cde,_1cdf){
dim=lang.mixin({},dim);
_1cd5.add(_1cdc,"dijitLayoutContainer");
_1cdd=array.filter(_1cdd,function(item){
return item.region!="center"&&item.layoutAlign!="client";
}).concat(array.filter(_1cdd,function(item){
return item.region=="center"||item.layoutAlign=="client";
}));
array.forEach(_1cdd,function(child){
var elm=child.domNode,pos=(child.region||child.layoutAlign);
if(!pos){
throw new Error("No region setting for "+child.id);
}
var _1ce0=elm.style;
_1ce0.left=dim.l+"px";
_1ce0.top=dim.t+"px";
_1ce0.position="absolute";
_1cd5.add(elm,"dijitAlign"+_1cd9(pos));
var _1ce1={};
if(_1cde&&_1cde==child.id){
_1ce1[child.region=="top"||child.region=="bottom"?"h":"w"]=_1cdf;
}
if(pos=="top"||pos=="bottom"){
_1ce1.w=dim.w;
size(child,_1ce1);
dim.h-=child.h;
if(pos=="top"){
dim.t+=child.h;
}else{
_1ce0.top=dim.t+dim.h+"px";
}
}else{
if(pos=="left"||pos=="right"){
_1ce1.h=dim.h;
size(child,_1ce1);
dim.w-=child.w;
if(pos=="left"){
dim.l+=child.w;
}else{
_1ce0.left=dim.l+dim.w+"px";
}
}else{
if(pos=="client"||pos=="center"){
size(child,dim);
}
}
}
});
};
return {marginBox2contentBox:_1cd8.marginBox2contentBox,layoutChildren:_1cd8.layoutChildren};
});
},"davinci/ve/utils/GeomUtils":function(){
define("davinci/ve/utils/GeomUtils",["dojo/_base/window","dojo/dom-geometry","dojo/dom-style","dojo/has","dojo/_base/sniff"],function(win,_1ce2,_1ce3,has,sniff){
var _1ce4=["TABLE","TBODY","TR","TD","TH"];
return {getMarginBoxPageCoords:function(node){
var _1ce5;
win.withDoc(node.ownerDocument,function(){
var _1ce6=this.getBorderBoxPageCoords(node);
var _1ce7=this.getMarginExtents(node);
_1ce5={l:_1ce6.l-_1ce7.l,t:_1ce6.t-_1ce7.t,w:_1ce6.w+_1ce7.l+_1ce7.r,h:_1ce6.h+_1ce7.t+_1ce7.b};
}.bind(this));
return _1ce5;
},getMarginBoxPageCoordsCached:function(node){
if(!node._maqMarginBoxPageCoords){
node._maqMarginBoxPageCoords=this.getMarginBoxPageCoords(node);
}
return node._maqMarginBoxPageCoords;
},getBorderBoxPageCoords:function(node){
var o;
win.withDoc(node.ownerDocument,function(){
if(_1ce4.indexOf(node.tagName)){
var bcr=node.getBoundingClientRect();
var _1ce8=this.getScrollLeft(node);
var _1ce9=this.getScrollTop(node);
o={l:bcr.left+_1ce8,t:bcr.top+_1ce9,w:bcr.width,h:bcr.height};
}else{
var l=node.offsetLeft;
var t=node.offsetTop;
var pn=node.parentNode;
var opn=node.offsetParent;
while(pn&&pn.tagName!="BODY"){
if(typeof pn.scrollLeft=="number"&&typeof pn.scrollTop=="number"){
l-=pn.scrollLeft;
t-=pn.scrollTop;
}
if(pn==opn){
var _1cea=_1ce2.getBorderExtents(opn);
l+=opn.offsetLeft+_1cea.l;
t+=opn.offsetTop+_1cea.t;
opn=opn.offsetParent;
}
pn=pn.parentNode;
}
o={l:l,t:t,w:node.offsetWidth,h:node.offsetHeight};
}
}.bind(this));
return o;
},getBorderBoxPageCoordsCached:function(node){
if(!node._maqBorderBoxPageCoords){
node._maqBorderBoxPageCoords=this.getBorderBoxPageCoords(node);
}
return node._maqBorderBoxPageCoords;
},getScrollLeft:function(node){
var doc=node&&node.ownerDocument;
if(has("mozilla")){
var win=doc&&doc.defaultView;
return win?win.pageXOffset:0;
}else{
var body=doc&&doc.body;
return body?body.scrollLeft:0;
}
},getScrollTop:function(node){
var doc=node&&node.ownerDocument;
if(has("mozilla")){
var win=doc&&doc.defaultView;
return win?win.pageYOffset:0;
}else{
var body=doc&&doc.body;
return body?body.scrollTop:0;
}
},getMarginExtents:function getMarginExtents(node,_1ceb){
var s=_1ceb||_1ce3.getComputedStyle(node);
var l,t,r,b;
function px(value){
return parseFloat(value)||0;
};
if(s){
l=px(s.marginLeft);
t=px(s.marginTop);
r=px(s.marginRight);
b=px(s.marginBottom);
}else{
l=t=r=b=0;
}
return {l:l,t:t,r:r,b:b,w:l+r,h:t+b};
},clearGeomCache:function(node){
delete node._maqBorderBoxPageCoords;
delete node._maqMarginBoxPageCoords;
}};
});
},"orion/editor/jsContentAssist":function(){
define("orion/editor/jsContentAssist",[],function(){
var _1cec=[{name:"toString"},{name:"toLocaleString"},{name:"valueOf"},{name:"hasOwnProperty",args:["property"]},{name:"isPrototypeOf",args:["object"]},{name:"propertyIsEnumerable",args:["property"]}];
var _1ced=[{name:"charAt",args:["index"]},{name:"charCodeAt",args:["index"]},{name:"concat",args:["array"]},{name:"indexOf",args:["searchString","[position]"]},{name:"lastIndexOf",args:["searchString","[position]"]},{name:"length",field:true},{name:"localeCompare",args:["object"]},{name:"match",args:["regexp"]},{name:"replace",args:["searchValue","replaceValue"]},{name:"search",args:["regexp"]},{name:"slice",args:["start","end"]},{name:"split",args:["separator","[limit]"]},{name:"substring",args:["start","[end]"]},{name:"toLowerCase"},{name:"toLocaleLowerCase"},{name:"toUpperCase"},{name:"toLocaleUpperCase"},{name:"trim"}];
function _1cee(_1cef,_1cf0){
var _1cf1="";
_1cf0=_1cf0-1;
while(_1cf0>0){
var c=_1cef.charAt(_1cf0--);
if(c==="\n"||c==="\r"){
break;
}
if(/\s/.test(c)){
_1cf1=c.concat(_1cf1);
}else{
_1cf1="";
}
}
return _1cf1;
};
function _1cf2(_1cf3,_1cf4,_1cf5){
var _1cf6=_1cf5-1;
while(_1cf6>0){
var c=_1cf4.charAt(_1cf6);
if(c==="\n"||c==="\r"){
break;
}
_1cf6--;
}
return _1cf4.substring(_1cf6+1,(_1cf5-_1cf3.length));
};
function _1cf7(_1cf8,_1cf9,_1cfa){
var line=_1cf2(_1cf8,_1cf9,_1cfa);
if(line.length>1&&(line.charAt(line.length-2)==="\""||line.charAt(line.length-2)==="'")){
return "String";
}
return null;
};
function chop(_1cfb,_1cfc){
return _1cfc.substring(_1cfb.length);
};
function _1cfd(_1cfe,_1cff,_1d00,_1d01,_1d02){
var text,_1d03,_1d04,_1d05;
for(var i=0;i<_1cfe.length;i++){
var name=_1cfe[i].name;
if(name.indexOf(_1d00)!==0){
continue;
}
var args=_1cfe[i].args;
if(!args||args.length===0){
text=name+(_1cfe[i].field?"":"()");
_1d03=text+" - "+_1cff;
_1d02.push({proposal:chop(_1d00,text),description:_1d03});
continue;
}
text=name+"(";
_1d04=[];
_1d05=_1d01+name.length+1-_1d00.length;
for(var _1d06=0;_1d06<args.length;_1d06++){
_1d04.push({offset:_1d05,length:args[_1d06].length});
_1d05+=args[_1d06].length+2;
text+=args[_1d06];
if(_1d06<args.length-1){
text+=", ";
}
}
text+=")";
_1d03=text+" - "+_1cff;
_1d05--;
_1d02.push({proposal:chop(_1d00,text),description:_1d03,positions:_1d04,escapePosition:_1d05});
}
};
function _1d07(_1d08,_1d09,_1d0a){
var _1d0b=[];
var type=_1cf7(_1d08,_1d09,_1d0a);
if(type==="String"){
_1cfd(_1ced,"String",_1d08,_1d0a,_1d0b);
}
_1cfd(_1cec,"Object",_1d08,_1d0a,_1d0b);
return _1d0b;
};
function _1d0c(_1d0d,_1d0e,_1d0f){
var _1d10=_1d0f-_1d0d.length;
var _1d11=[];
var _1d12=_1cee(_1d0e,_1d0f);
var text,_1d13,_1d14,_1d15;
if("if".indexOf(_1d0d)===0){
text="if (condition) {\n"+_1d12+"\t\n"+_1d12+"}";
_1d13="if - if statement";
_1d14=[{offset:_1d10+4,length:9}];
_1d15=_1d10+_1d12.length+18;
_1d11.push({proposal:chop(_1d0d,text),description:_1d13,positions:_1d14,escapePosition:_1d15});
text="if (condition) {\n"+_1d12+"\t\n"+_1d12+"} else {\n"+_1d12+"\t\n"+_1d12+"}";
_1d13="if - if else statement";
_1d14=[{offset:_1d10+4,length:9}];
_1d15=_1d10+_1d12.length+18;
_1d11.push({proposal:chop(_1d0d,text),description:_1d13,positions:_1d14,escapePosition:_1d15});
}
if("for".indexOf(_1d0d)===0){
text="for (var i = 0; i < array.length; i++) {\n"+_1d12+"\t\n"+_1d12+"}";
_1d13="for - iterate over array";
_1d14=[{offset:_1d10+9,length:1},{offset:_1d10+20,length:5}];
_1d15=_1d10+_1d12.length+42;
_1d11.push({proposal:chop(_1d0d,text),description:_1d13,positions:_1d14,escapePosition:_1d15});
text="for (var property in object) {\n"+_1d12+"\tif (object.hasOwnProperty(property)) {\n"+_1d12+"\t\t\n"+_1d12+"\t}\n"+_1d12+"}";
_1d13="for..in - iterate over properties of an object";
_1d14=[{offset:_1d10+9,length:8},{offset:_1d10+21,length:6}];
_1d15=_1d10+(2*_1d12.length)+73;
_1d11.push({proposal:chop(_1d0d,text),description:_1d13,positions:_1d14,escapePosition:_1d15});
}
if("while".indexOf(_1d0d)===0){
text="while (condition) {\n"+_1d12+"\t\n"+_1d12+"}";
_1d13="while - while loop with condition";
_1d14=[{offset:_1d10+7,length:9}];
_1d15=_1d10+_1d12.length+21;
_1d11.push({proposal:chop(_1d0d,text),description:_1d13,positions:_1d14,escapePosition:_1d15});
}
if("do".indexOf(_1d0d)===0){
text="do {\n"+_1d12+"\t\n"+_1d12+"} while (condition);";
_1d13="do - do while loop with condition";
_1d14=[{offset:_1d10+16,length:9}];
_1d15=_1d10+_1d12.length+6;
_1d11.push({proposal:chop(_1d0d,text),description:_1d13,positions:_1d14,escapePosition:_1d15});
}
if("switch".indexOf(_1d0d)===0){
text="switch (expression) {\n"+_1d12+"\tcase value1:\n"+_1d12+"\t\t\n"+_1d12+"\t\tbreak;\n"+_1d12+"\tdefault:\n"+_1d12+"}";
_1d13="switch - switch case statement";
_1d14=[{offset:_1d10+8,length:10},{offset:_1d10+28,length:6}];
_1d15=_1d10+(2*_1d12.length)+38;
_1d11.push({proposal:chop(_1d0d,text),description:_1d13,positions:_1d14,escapePosition:_1d15});
}
if("try".indexOf(_1d0d)===0){
text="try {\n"+_1d12+"\t\n"+_1d12+"} catch (err) {\n"+_1d12+"}";
_1d13="try - try..catch statement";
_1d15=_1d10+_1d12.length+7;
_1d11.push({proposal:chop(_1d0d,text),description:_1d13,escapePosition:_1d15});
text="try {\n"+_1d12+"\t\n"+_1d12+"} catch (err) {\n"+_1d12+"} finally {\n"+_1d12+"}";
_1d13="try - try..catch statement with finally block";
_1d15=_1d10+_1d12.length+7;
_1d11.push({proposal:chop(_1d0d,text),description:_1d13,escapePosition:_1d15});
}
return _1d11;
};
function _1d16(_1d17,_1d18,_1d19){
var _1d1a=["break","case","catch","continue","debugger","default","delete","do","else","finally","for","function","if","in","instanceof","new","return","switch","this","throw","try","typeof","var","void","while","with"];
var _1d1b=[];
for(var i=0;i<_1d1a.length;i++){
if(_1d1a[i].indexOf(_1d17)===0){
_1d1b.push({proposal:chop(_1d17,_1d1a[i]),description:_1d1a[i]});
}
}
return _1d1b;
};
function _1d1c(_1d1d,index){
var c=_1d1d.charAt(index);
switch(c){
case "/":
if(_1d1d.charAt(index+1)==="/"){
index=_1d1d.indexOf("\n",index)+2;
if(index===1){
return _1d1d.length;
}
}else{
if(_1d1d.charAt(index+1)==="*"){
index=_1d1d.indexOf("*/",index+2)+2;
if(index===1){
return _1d1d.length;
}
}else{
var _1d1e=_1d1d.indexOf("\n",index);
if(_1d1e<0){
_1d1e=_1d1d.length;
}
var _1d1f=_1d1d.indexOf("/",index+1);
while(_1d1f>0&&_1d1f<_1d1e&&_1d1d.charAt(_1d1f-1)==="\\"){
_1d1f=_1d1d.indexOf("/",_1d1f+1);
}
index=(_1d1f>0&&_1d1e>_1d1f)?_1d1f:_1d1e;
index++;
}
}
break;
case "\"":
case "'":
var _1d1e=_1d1d.indexOf("\n",index);
if(_1d1e<0){
_1d1e=_1d1d.length;
}
var _1d20=_1d1d.indexOf(c,index+1);
while(_1d20>0&&_1d20<_1d1e&&_1d1d.charAt(_1d20-1)==="\\"){
_1d20=_1d1d.indexOf(c,_1d20+1);
}
index=(_1d20>0&&_1d1e>_1d20)?_1d20:_1d1e;
index++;
break;
}
return index;
};
function _1d21(_1d22,start){
var index=start,_1d23=0;
while(index<_1d22.length){
index=_1d1c(_1d22,index);
var c=_1d22.charAt(index);
switch(c){
case "{":
_1d23++;
break;
case "}":
if(--_1d23===0){
return index;
}
break;
}
index++;
}
return index;
};
function _1d24(block){
var _1d25=[];
var index=0;
while((index=_1d1c(block,index))<block.length){
var _1d26=block.substring(index);
if(_1d26.match(/^var\s/)){
var _1d27=block.indexOf(";",index);
if(_1d27<0){
_1d27=block.length;
}
var names=block.substring(index+3,_1d27).match(/[\w]+/);
if(names){
_1d25.push(names[0]);
index+=names[0].length;
}
index=_1d27+1;
}else{
if(_1d26.match(/^function[\s(]/)){
index=_1d21(block,index);
}else{
var words=block.substring(index).match(/^\w[\w\s\()]+/);
if(words){
index+=words[0].length;
}else{
index++;
}
}
}
}
return _1d25;
};
function _1d28(_1d29,_1d2a){
var block=_1d29.substring(0,_1d2a);
var _1d2b=block.lastIndexOf("function");
if(_1d2b>=0){
var _1d2c=block.indexOf("{",_1d2b);
var _1d2d=_1d21(_1d29,_1d2c);
if(_1d2d<_1d2a){
return _1d28(_1d29,_1d2b);
}
return _1d29.substring(_1d2b,_1d2d);
}
return null;
};
function _1d2e(_1d2f,_1d30,_1d31){
var _1d32=[];
var start,i;
var block=_1d28(_1d30,_1d31);
var _1d33=0;
if(block){
_1d33=_1d30.indexOf(block);
start=block.indexOf("(");
var end=block.indexOf(")");
if(start>=0&&end>=0){
var _1d34=block.substring(start+1,end);
var args=_1d34.split(",");
for(i=0;i<args.length;i++){
var arg=args[i].trim();
if(arg.indexOf(_1d2f)===0){
_1d32.push({proposal:chop(_1d2f,arg),description:arg});
}
}
}
start=block.indexOf("{");
if(start>0){
block=block.substring(start+1);
}
}else{
block=_1d30;
}
var _1d35=_1d24(block);
for(i=0;i<_1d35.length;i++){
if(_1d35[i].indexOf(_1d2f)===0){
_1d32.push({proposal:chop(_1d2f,_1d35[i]),description:_1d35[i]});
}
}
if(_1d33>0){
_1d32=_1d32.concat(_1d2e(_1d2f,_1d30,_1d33));
}
return _1d32;
};
function _1d36(block){
var _1d37="";
var index=0;
while(index<block.length){
index=_1d1c(block,index);
_1d37+=block.charAt(index++);
}
return _1d37;
};
function _1d38(_1d39,_1d3a,_1d3b){
var _1d3c=_1d3a.substring(0,_1d3b);
var _1d3d=_1d36(_1d3c);
var _1d3e=_1d3c.length-_1d3d.length;
return _1d2e(_1d39,_1d3d,_1d3b-_1d3e);
};
function _1d3f(){
};
_1d3f.prototype={computeProposals:function(_1d40,_1d41,_1d42){
var _1d43=_1d42.prefix;
var _1d44=[];
if(_1d41>0){
var _1d45=_1d40.charAt(_1d41-_1d43.length-1);
if(_1d45==="."){
return _1d07(_1d43,_1d40,_1d41);
}
}
_1d44=_1d44.concat(_1d38(_1d43,_1d40,_1d41-_1d43.length));
_1d44=_1d44.concat(_1d0c(_1d43,_1d40,_1d41));
_1d44=_1d44.concat(_1d16(_1d43,_1d40,_1d41));
return _1d44;
}};
return {JavaScriptContentAssistProvider:_1d3f};
});
},"davinci/ve/actions/ViewSourceAction":function(){
define(["dojo/_base/declare","davinci/ve/actions/ContextAction","dojo/i18n!davinci/ve/nls/ve"],function(_1d46,_1d47,veNls){
return _1d46("davinci.ve.actions.ViewSourceAction",[_1d47],{run:function(_1d48){
_1d48=this.fixupContext(_1d48);
if(_1d48&&_1d48.editor&&_1d48.editor.switchDisplayModeSourceLatest){
editor=_1d48.editor;
editor.switchDisplayModeSourceLatest();
}
},updateStyling:function(){
var _1d49=davinci.Workbench.getOpenEditor();
if(_1d49&&_1d49.getDisplayMode){
var _1d4a=_1d49.getDisplayMode();
var _1d4b=_1d49.getSourceDisplayMode();
var _1d4c=dojo.query(".maqSourceComboButton")[0];
if(_1d4c){
var _1d4d=dijit.byNode(_1d4c);
if(_1d4d){
_1d4d.set("label",veNls["SourceComboButton-"+_1d4b]);
}
if(_1d4a=="design"){
dojo.removeClass(_1d4c,"maqLabelButtonSelected");
}else{
dojo.addClass(_1d4c,"maqLabelButtonSelected");
}
}
}
}});
});
},"url:davinci/review/widgets/templates/PublishWizard.html":"<div class='publishWizard'>\r\n\t<div class=\"dijitDialogPaneContentArea\">\r\n\t\t<div class='steps'>\r\n\t\t\t<div dojoAttachPoint=\"navPage1\" dojoAttachEvent=\"onclick:select\" class=\"crumbs current sep\">\r\n\t\t\t\t<div dojoAttachPoint=\"navPage1Icon\" class=\"done\"></div>\r\n\t\t\t\t1.${generalInfo}\r\n\t\t\t</div>\r\n\t\t\t<div dojoAttachPoint=\"navPage2\" dojoAttachEvent=\"onclick:select\" class=\"crumbs sep\">\r\n\t\t\t\t<div dojoAttachPoint=\"navPage2Icon\" class=\"todo\"></div>\r\n\t\t\t\t2.${selectRevFiles}\r\n\t\t\t</div>\r\n\t\t\t<div dojoAttachPoint=\"navPage3\" dojoAttachEvent=\"onclick:select\" class=\"crumbs\">\r\n\t\t\t\t<div dojoAttachPoint=\"navPage3Icon\" class=\"todo\"></div>\r\n\t\t\t\t3.${addReviewers}\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t\t<div dojoAttachPoint=\"reviewerStackContainer\" class='mainSection'>\r\n\t\t</div>\r\n\t\t<table cellspacing=\"10\" dojoAttachPoint=\"page1Node\">\r\n\t\t\t<tr>\r\n\t\t\t\t<td><label for=\"versionTitle\">${title}:</label></td>\r\n\t\t\t\t<td><input dojoAttachPoint=\"versionTitle\"></input></td>\r\n\t\t\t\t<td><input dojoAttachPoint=\"receiveEmail\"></input><label class='emailLabel' for=\"receiveEmail\">${notifyMe}</label></td>\r\n\t\t\t</tr>\r\n\t\t\t<tr>\r\n\t\t\t\t<td valign=\"top\"><label for=\"descriptions\">${description}:</label></td>\r\n\t\t\t\t<td colspan=\"2\"><input dojoAttachPoint=\"descriptions\"></input></td>\r\n\t\t\t</tr>\r\n\t\t\t<tr>\r\n\t\t\t\t<td><label>${windowSize}:</label></td>\r\n\t\t\t\t<td colspan=\"2\"><input dojoAttachPoint=\"desireWidth\"></input><label>*</label><input dojoAttachPoint=\"desireHeight\"/></td>\r\n\t\t\t</tr>\r\n\t\t\t<tr>\r\n\t\t\t\t<td><label for=\"dueDate\">${dueDate}:</label></td>\r\n\t\t\t\t<td><input dojoAttachPoint=\"dueDate\" /></td>\r\n\t\t\t\t<td class=\"review-tips\"><label>${leaveBlank}</label></td>\r\n\t\t\t</tr>\r\n\t\t</table>\r\n\t\t\r\n\t\t<table cellspacing=\"10\" dojoAttachPoint=\"page2Node\">\r\n\t\t\t<tr>\r\n\t\t\t\t<td>${availableFiles}:</td>\r\n\t\t\t\t<td></td>\r\n\t\t\t\t<td>${selectedFiles}:</td>\r\n\t\t\t</tr>\r\n\t\t\t<tr>\r\n\t\t\t\t<td>\r\n\t\t\t\t\t<div dojoAttachPoint=\"sourceTreeNode\" class='sourceTree'>\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</td>\r\n\t\t\t\t<td>\r\n\t\t\t\t\t<a href=\"javascript:void(0);\" dojoAttachEvent=\"onclick:addSelectFiles\"><img src=\"app/davinci/review/resources/img/forward_nav.gif\"/></a>\r\n\t\t\t\t</td>\r\n\t\t\t\t<td>\r\n\t\t\t\t\t<div dojoAttachPoint=\"targetTreeNode\" class='sourceTree'>\r\n\t\t\t\t\t\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</td>\r\n\t\t\t</tr>\r\n\t\t</table>\r\n\t\t\r\n\t\t<table cellspacing=\"10\" dojoAttachPoint=\"page3Node\">\r\n\t\t\t<tr valign=\"top\">\r\n\t\t\t\t<td align=\"left\" rowspan=2><div class='reviewers'>${reviewers}:</div></td>\r\n\t\t\t\t<td colspan=2><div dojoAttachPoint=\"userGrid\" class='reviewerList'></div></td>\r\n\t\t\t</tr>\r\n\t\t\t<tr>\r\n\t\t\t\t<td class='reviewerBox'>\r\n\t\t\t\t\t<div dojoAttachPoint=\"addReviewerCombox\"></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t<td align=\"left\"><button dojoAttachPoint=\"addReviewerButton\"></button></td>\r\n\t\t\t</tr>\r\n\t\t</table>\r\n\t</div>\r\n\r\n\t\t<div class='dijitDialogPaneActionBar dialogButtonContainerOverride'>\r\n\t\t\t<div dojoAttachPoint=\"reviewMsg\" class=\"reviewMsg\"></div>\r\n\t\t\t<a class='cancelButton' href=\"javascript:void(0);\" dojoAttachEvent=\"onclick:onClose\">${buttonCancel}</a>\r\n\t\t\t<button class='maqSecondaryButton' dojoAttachPoint=\"saveDt\">${saveAsDraft}</button>\r\n\t\t\t<button class='maqSecondaryButton' dojoAttachPoint=\"prev\">&lt ${back}</button>\r\n\t\t\t<button class='maqSecondaryButton' dojoAttachPoint=\"next\">${next} &gt</button>\r\n\t\t\t<button class='maqPrimaryButton' dojoAttachPoint=\"invite\">${publishReview}</button>\r\n\t\t</div>\r\n</div>","dojo/i18n":function(){
define("dojo/i18n",["./_base/kernel","require","./has","./_base/array","./_base/config","./_base/lang","./_base/xhr","./json","module"],function(dojo,_1d4e,has,array,_1d4f,lang,xhr,json,_1d50){
has.add("dojo-preload-i18n-Api",1);
1||has.add("dojo-v1x-i18n-Api",1);
var _1d51=dojo.i18n={},nlsRe=/(^.*(^|\/)nls)(\/|$)([^\/]*)\/?([^\/]*)/,_1d52=function(root,_1d53,_1d54,_1d55){
for(var _1d56=[_1d54+_1d55],_1d57=_1d53.split("-"),_1d58="",i=0;i<_1d57.length;i++){
_1d58+=(_1d58?"-":"")+_1d57[i];
if(!root||root[_1d58]){
_1d56.push(_1d54+_1d58+"/"+_1d55);
}
}
return _1d56;
},cache={},_1d59=function(_1d5a,_1d5b,_1d5c){
_1d5c=_1d5c?_1d5c.toLowerCase():dojo.locale;
_1d5a=_1d5a.replace(/\./g,"/");
_1d5b=_1d5b.replace(/\./g,"/");
return (/root/i.test(_1d5c))?(_1d5a+"/nls/"+_1d5b):(_1d5a+"/nls/"+_1d5c+"/"+_1d5b);
},_1d5d=dojo.getL10nName=function(_1d5e,_1d5f,_1d60){
return _1d5e=_1d50.id+"!"+_1d59(_1d5e,_1d5f,_1d60);
},_1d61=function(_1d62,_1d63,_1d64,_1d65,_1d66,load){
_1d62([_1d63],function(root){
var _1d67=lang.clone(root.root),_1d68=_1d52(!root._v1x&&root,_1d66,_1d64,_1d65);
_1d62(_1d68,function(){
for(var i=1;i<_1d68.length;i++){
_1d67=lang.mixin(lang.clone(_1d67),arguments[i]);
}
var _1d69=_1d63+"/"+_1d66;
cache[_1d69]=_1d67;
load();
});
});
},_1d6a=function(id,_1d6b){
return /^\./.test(id)?_1d6b(id):id;
},_1d6c=function(_1d6d){
var list=_1d4f.extraLocale||[];
list=lang.isArray(list)?list:[list];
list.push(_1d6d);
return list;
},load=function(id,_1d6e,load){
if(has("dojo-preload-i18n-Api")){
var split=id.split("*"),_1d6f=split[1]=="preload";
if(_1d6f){
if(!cache[id]){
cache[id]=1;
_1d70(split[2],json.parse(split[3]),1,_1d6e);
}
load(1);
}
if(_1d6f||_1d71(id,_1d6e,load)){
return;
}
}
var match=nlsRe.exec(id),_1d72=match[1]+"/",_1d73=match[5]||match[4],_1d74=_1d72+_1d73,_1d75=(match[5]&&match[4]),_1d76=_1d75||dojo.locale,_1d77=_1d74+"/"+_1d76,_1d78=_1d75?[_1d76]:_1d6c(_1d76),_1d79=_1d78.length,_1d7a=function(){
if(!--_1d79){
load(lang.delegate(cache[_1d77]));
}
};
array.forEach(_1d78,function(_1d7b){
var _1d7c=_1d74+"/"+_1d7b;
if(has("dojo-preload-i18n-Api")){
_1d7d(_1d7c);
}
if(!cache[_1d7c]){
_1d61(_1d6e,_1d74,_1d72,_1d73,_1d7b,_1d7a);
}else{
_1d7a();
}
});
};
if(has("dojo-unit-tests")){
var _1d7e=_1d51.unitTests=[];
}
if(has("dojo-preload-i18n-Api")||1){
var _1d7f=_1d51.normalizeLocale=function(_1d80){
var _1d81=_1d80?_1d80.toLowerCase():dojo.locale;
return _1d81=="root"?"ROOT":_1d81;
},isXd=function(mid,_1d82){
return (1&&1)?_1d82.isXdUrl(_1d4e.toUrl(mid+".js")):true;
},_1d83=0,_1d84=[],_1d70=_1d51._preloadLocalizations=function(_1d85,_1d86,_1d87,_1d88){
_1d88=_1d88||_1d4e;
function _1d89(mid,_1d8a){
if(isXd(mid,_1d88)||_1d87){
_1d88([mid],_1d8a);
}else{
_1d93([mid],_1d8a,_1d88);
}
};
function _1d8b(_1d8c,func){
var parts=_1d8c.split("-");
while(parts.length){
if(func(parts.join("-"))){
return;
}
parts.pop();
}
func("ROOT");
};
function _1d8d(_1d8e){
_1d8e=_1d7f(_1d8e);
_1d8b(_1d8e,function(loc){
if(array.indexOf(_1d86,loc)>=0){
var mid=_1d85.replace(/\./g,"/")+"_"+loc;
_1d83++;
_1d89(mid,function(_1d8f){
for(var p in _1d8f){
cache[_1d4e.toAbsMid(p)+"/"+loc]=_1d8f[p];
}
--_1d83;
while(!_1d83&&_1d84.length){
load.apply(null,_1d84.shift());
}
});
return true;
}
return false;
});
};
_1d8d();
array.forEach(dojo.config.extraLocale,_1d8d);
},_1d71=function(id,_1d90,load){
if(_1d83){
_1d84.push([id,_1d90,load]);
}
return _1d83;
},_1d7d=function(){
};
}
if(1){
var _1d91={},_1d92=new Function("__bundle","__checkForLegacyModules","__mid","__amdValue","var define = function(mid, factory){define.called = 1; __amdValue.result = factory || mid;},"+"\t   require = function(){define.called = 1;};"+"try{"+"define.called = 0;"+"eval(__bundle);"+"if(define.called==1)"+"return __amdValue;"+"if((__checkForLegacyModules = __checkForLegacyModules(__mid)))"+"return __checkForLegacyModules;"+"}catch(e){}"+"try{"+"return eval('('+__bundle+')');"+"}catch(e){"+"return e;"+"}"),_1d93=function(deps,_1d94,_1d95){
var _1d96=[];
array.forEach(deps,function(mid){
var url=_1d95.toUrl(mid+".js");
function load(text){
var _1d97=_1d92(text,_1d7d,mid,_1d91);
if(_1d97===_1d91){
_1d96.push(cache[url]=_1d91.result);
}else{
if(_1d97 instanceof Error){
console.error("failed to evaluate i18n bundle; url="+url,_1d97);
_1d97={};
}
_1d96.push(cache[url]=(/nls\/[^\/]+\/[^\/]+$/.test(url)?_1d97:{root:_1d97,_v1x:1}));
}
};
if(cache[url]){
_1d96.push(cache[url]);
}else{
var _1d98=_1d95.syncLoadNls(mid);
if(_1d98){
_1d96.push(_1d98);
}else{
if(!xhr){
try{
_1d95.getText(url,true,load);
}
catch(e){
_1d96.push(cache[url]={});
}
}else{
xhr.get({url:url,sync:true,load:load,error:function(){
_1d96.push(cache[url]={});
}});
}
}
}
});
_1d94&&_1d94.apply(null,_1d96);
};
_1d7d=function(_1d99){
for(var _1d9a,names=_1d99.split("/"),_1d9b=dojo.global[names[0]],i=1;_1d9b&&i<names.length-1;_1d9b=_1d9b[names[i++]]){
}
if(_1d9b){
_1d9a=_1d9b[names[i]];
if(!_1d9a){
_1d9a=_1d9b[names[i].replace(/-/g,"_")];
}
if(_1d9a){
cache[_1d99]=_1d9a;
}
}
return _1d9a;
};
_1d51.getLocalization=function(_1d9c,_1d9d,_1d9e){
var _1d9f,_1da0=_1d59(_1d9c,_1d9d,_1d9e);
load(_1da0,(!isXd(_1da0,_1d4e)?function(deps,_1da1){
_1d93(deps,_1da1,_1d4e);
}:_1d4e),function(_1da2){
_1d9f=_1da2;
});
return _1d9f;
};
if(has("dojo-unit-tests")){
_1d7e.push(function(doh){
doh.register("tests.i18n.unit",function(t){
var check;
check=_1d92("{prop:1}",_1d7d,"nonsense",_1d91);
t.is({prop:1},check);
t.is(undefined,check[1]);
check=_1d92("({prop:1})",_1d7d,"nonsense",_1d91);
t.is({prop:1},check);
t.is(undefined,check[1]);
check=_1d92("{'prop-x':1}",_1d7d,"nonsense",_1d91);
t.is({"prop-x":1},check);
t.is(undefined,check[1]);
check=_1d92("({'prop-x':1})",_1d7d,"nonsense",_1d91);
t.is({"prop-x":1},check);
t.is(undefined,check[1]);
check=_1d92("define({'prop-x':1})",_1d7d,"nonsense",_1d91);
t.is(_1d91,check);
t.is({"prop-x":1},_1d91.result);
check=_1d92("define('some/module', {'prop-x':1})",_1d7d,"nonsense",_1d91);
t.is(_1d91,check);
t.is({"prop-x":1},_1d91.result);
check=_1d92("this is total nonsense and should throw an error",_1d7d,"nonsense",_1d91);
t.is(check instanceof Error,true);
});
});
}
}
return lang.mixin(_1d51,{dynamic:true,normalize:_1d6a,load:load,cache:cache});
});
},"davinci/ui/Download":function(){
require({cache:{"url:davinci/ui/templates/download.html":"<div class='downloadDialog'>\t \r\n\t<div class=\"dijitDialogPaneContentArea\">\r\n\t\t<div style=\"margin-bottom: 20px\">\r\n\t\t  ${fileName}: <input dojoType='dijit.form.ValidationTextBox' type=\"text\" maxLength='${_fileNameMaxLength}' dojoAttachPoint=\"__fileName\" value='workspace1.zip' data-dojo-props=\"regExp:'${_fileNameValidationRegExp}', required:true, invalidMessage:'${invalidDownloadFileName}'\"></input>\r\n\t\t</div>\r\n\t\t\r\n\t\t<div dojoAttachPoint=\"_selectionDiv\"></div>\r\n\t\t<div dojoAttachPoint=\"_tableDiv\"></div>\r\n\r\n\t\t<div style=\"margin-top: 8px\">\r\n\t\t  Select: <a href=\"javascript:;\" data-dojo-attach-event=\"onclick: _selectAll\">${selectAll}</a> / <a href=\"javascript:;\" data-dojo-attach-event=\"onclick: _selectNone\">${selectNone}</a>\r\n\t\t</div>\r\n\r\n\t\t<div style=\"margin-top: 20px\">\r\n\t\t\t<input dojoType='dijit.form.CheckBox' type=\"text\" dojoAttachPoint=\"__fullSource\" data-dojo-props=\"\"></input><span style='padding-left: 3px;'>${downloadFullSource}</span>\r\n\t\t\t<br>\r\n\t\t\t<input dojoType='dijit.form.CheckBox' type=\"text\" dojoAttachPoint=\"__optimize\" data-dojo-props=\"\"></input><span style='padding-left: 3px;'>${optimizeOption}</span>\r\n\t\t</div>\r\n  </div>\r\n\t<div class=\"dijitDialogPaneActionBar\">\r\n\t\t<button dojoType='dijit.form.Button' dojoAttachPoint=\"_okButton\" dojoAttachEvent='onClick:okButton' label='${downloadButtonLabel}' class=\"maqPrimaryButton\" type=\"submit\"></button>\r\n\t\t<button dojoType='dijit.form.Button' dojoAttachEvent='onClick:cancelButton' label='${buttonCancel}' class=\"maqSecondaryButton\"></button>\r\n\t</div>\r\n</div>"}});
define("davinci/ui/Download",["dojo/_base/declare","dijit/_TemplatedMixin","dijit/_WidgetBase","dijit/_WidgetsInTemplateMixin","davinci/library","system/resource","dojo/promise/all","dojo/parser","davinci/Workbench","davinci/ve/RebaseDownload","dojo/i18n!./nls/ui","dojo/i18n!dijit/nls/common","dojo/text!./templates/download.html","davinci/Theme","dijit/form/Button","dijit/form/ValidationTextBox","dijit/form/TextBox"],function(_1da3,_1da4,_1da5,_1da6,_1da7,_1da8,all,_1da9,_1daa,_1dab,uiNLS,_1dac,_1dad,Theme){
return _1da3([_1da5,_1da4,_1da6],{templateString:_1dad,_fileNameValidationRegExp:"[a-zA-z0-9_.]+",_fileNameMaxLength:50,postMixInProperties:function(){
dojo.mixin(this,uiNLS);
dojo.mixin(this,_1dac);
this.inherited(arguments);
},__rewriteDojo:null,__rewriteDojoURL:null,__fileName:null,__optimize:null,__fullSource:null,_selectionDiv:null,_okButton:null,_tableDiv:null,buildRendering:function(){
this.inherited(arguments);
this._handles=[];
this._userLibs=_1da7.getUserLibs(this.getRoot());
var _1dae=[];
_1dae.push("<table cellspacing='0' cellpadding='0' width='100%' class='dwnloadLibTable'><tr><td class='header'>"+uiNLS.library+"</td><td class='header'>"+uiNLS.version+"</td><td class='header'>"+uiNLS.include+"<br>"+uiNLS.source+"</td><td class='header'>"+uiNLS.baseLocation+"</td></tr>");
_1dae.push("<tr><td colspan='4'><hr></hr></td></tr>");
this.libraries={};
for(var i=0;i<this._userLibs.length;i++){
this._userLibs[i].initRoot=this._getLibRoot(this._userLibs[i].id,this._userLibs[i].version);
var name=this._userLibs[i].id;
if(this._userLibs[i].initRoot==null){
continue;
}
if(this._userLibs[i].required){
_1dae.push("<tr libPath='"+i+"' style='display:none'>");
}else{
_1dae.push("<tr libPath='"+i+"'>");
}
_1dae.push("<td class='columna'>"+name+"</td>");
_1dae.push("<td class='columnb'>"+this._userLibs[i].version+"</td>");
_1dae.push("<td class='columnc'><input type='checkbox' dojoType='dijit.form.CheckBox' checked></input></td>");
_1dae.push("<td class='columnd'><input type='text' dojoType='dijit.form.TextBox' value='"+this._userLibs[i].initRoot+"'></input></td>");
_1dae.push("</tr>");
}
_1dae.push("</table>");
var html=_1dae.join("");
dojo.place(html,this._tableDiv);
dojo.parser.parse(this._tableDiv);
},_getLibRoot:function(id,_1daf){
for(var i=0;i<this._userLibs.length;i++){
if(this._userLibs[i].id==id&&this._userLibs[i].version==_1daf){
return this._userLibs[i].root;
}
}
},_getLibs:function(){
var rows=dojo.query("tr[libPath]",this.domNode);
var _1db0=[];
for(var i=0;i<rows.length;i++){
var _1db1=dijit.byNode(dojo.query(".dijitTextBox",rows[i])[0]);
var _1db2=dijit.byNode(dojo.query(".dijitCheckBox",rows[i])[0]);
var _1db3=parseInt(dojo.attr(rows[i],"libPath"));
var value=_1db2.get("checked");
var _1db4=_1db1.get("value")||this._userLibs[_1db3].root;
_1db0.push({id:this._userLibs[_1db3].id,version:this._userLibs[_1db3].version,root:_1db4,includeSrc:value});
}
return _1db0;
},getRoot:function(){
if(_1daa.singleProjectMode()){
return _1daa.getProject();
}
},_getResources:function(){
return {userFiles:[_1daa.getProject()],userLibs:this._getLibs()};
},_rewriteUrls:function(){
var _1db5=this._getResources(),_1db6=[];
var _1db7=new _1dab(_1db5.userLibs);
var _1db8=[];
for(var i=0;i<_1db5.userFiles.length;i++){
var _1db9=_1da8.findResource(_1db5.userFiles[i]);
if(_1db9.elementType=="Folder"){
_1db8=_1da8.findResource("*.html",true,_1db9,true);
}else{
if(_1db9.extension=="html"){
_1db8=[_1db9];
}
}
_1db8.forEach(function(res){
if(!Theme.isThemeHTML(res)){
_1db6.push(_1db7.rebuildSource(res.getContentSync(),res).then(function(_1dba){
res.setContents(_1dba,true);
}));
}
});
}
return all(_1db6);
},_select:function(value){
var rows=dojo.query("tr[libPath]",this.domNode);
dojo.forEach(rows,function(row){
var _1dbb=dijit.byNode(dojo.query(".dijitCheckBox",row)[0]);
if(_1dbb){
_1dbb.set("checked",value);
}
});
return false;
},_selectAll:function(){
this._select(true);
},_selectNone:function(){
this._select(false);
},okButton:function(){
if(this.__fileName.isValid()){
function _1dbc(_1dbd,_1dbe,root,libs,_1dbf){
return function(){
var files=_1dbd;
var fn=_1dbe;
_1da8.download(files,fn,root,libs,_1dbf);
};
};
var _1dc0=dojo.attr(this.__fileName,"value");
if(_1dc0.slice(-4)!=".zip"){
_1dc0=_1dc0+".zip";
}
this._rewriteUrls().then(function(){
var _1dc1=this._getResources();
var pages=this._noRewrite?[]:this._pages;
var _1dc2=_1dc1.userLibs.filter(function(lib){
return lib.includeSrc;
});
var _1dc3={};
if(this.__optimize.getValue()){
_1dc3.build="1";
}
if(this.__fullSource.getValue()){
_1dc3.fullsource="1";
}
setTimeout(_1dbc(_1dc1.userFiles,_1dc0,this.getRoot(),_1dc2,_1dc3),300);
}.bind(this));
}
},cancelButton:function(){
this.cancel=true;
this.onClose();
}});
});
},"davinci/ui/about":function(){
define(["dojo/_base/declare","../Workbench","davinci/version","davinci/repositoryinfo","dojo/date/locale","dojo/date/stamp","dojo/i18n!davinci/ui/nls/ui","dojo/i18n!dijit/nls/common","dijit/form/Button"],function(_1dc4,_1dc5,_1dc6,_1dc7,_1dc8,Stamp,uiNLS,_1dc9){
var about=_1dc4("davinci.ui.about",null,{});
about.show=function(){
var _1dca=uiNLS;
var _1dcb="<div class='about_container'>"+"<div class='about_version'>"+dojo.string.substitute(_1dca.productVersion,[_1dc6])+"</div>";
var ri=_1dc7,_1dcc=ri.revision;
var bd=ri.buildtime;
var date=Stamp.fromISOString(bd);
if(date){
bd=_1dc8.format(date,{formatLength:"medium"});
}
if(bd){
_1dcb+="<div class='about_date'>"+dojo.string.substitute(_1dca.productDate,[bd])+"</div>";
}
if(_1dcc){
var _1dcd="<a href='https://github.com/maqetta/maqetta/commit/"+_1dcc+"'>"+_1dcc.substr(0,15)+"...</a>";
_1dcb+="<div class='about_build'>"+dojo.string.substitute(_1dca.build,[_1dcd])+"</div>";
}
_1dcb+="</div>";
_1dc5.showMessage(_1dca.aboutMaqetta,_1dcb);
};
return about;
});
},"dojo/store/Memory":function(){
define("dojo/store/Memory",["../_base/declare","./util/QueryResults","./util/SimpleQueryEngine"],function(_1dce,_1dcf,_1dd0){
var base=null;
return _1dce("dojo.store.Memory",base,{constructor:function(_1dd1){
for(var i in _1dd1){
this[i]=_1dd1[i];
}
this.setData(this.data||[]);
},data:null,idProperty:"id",index:null,queryEngine:_1dd0,get:function(id){
return this.data[this.index[id]];
},getIdentity:function(_1dd2){
return _1dd2[this.idProperty];
},put:function(_1dd3,_1dd4){
var data=this.data,index=this.index,_1dd5=this.idProperty;
var id=_1dd3[_1dd5]=(_1dd4&&"id" in _1dd4)?_1dd4.id:_1dd5 in _1dd3?_1dd3[_1dd5]:Math.random();
if(id in index){
if(_1dd4&&_1dd4.overwrite===false){
throw new Error("Object already exists");
}
data[index[id]]=_1dd3;
}else{
index[id]=data.push(_1dd3)-1;
}
return id;
},add:function(_1dd6,_1dd7){
(_1dd7=_1dd7||{}).overwrite=false;
return this.put(_1dd6,_1dd7);
},remove:function(id){
var index=this.index;
var data=this.data;
if(id in index){
data.splice(index[id],1);
this.setData(data);
return true;
}
},query:function(query,_1dd8){
return _1dcf(this.queryEngine(query,_1dd8)(this.data));
},setData:function(data){
if(data.items){
this.idProperty=data.identifier;
data=this.data=data.items;
}else{
this.data=data;
}
this.index={};
for(var i=0,l=data.length;i<l;i++){
this.index[data[i][this.idProperty]]=i;
}
}});
});
},"dijit/form/_DateTimeTextBox":function(){
require({cache:{"url:dijit/form/templates/DropDownBox.html":"<div class=\"dijit dijitReset dijitInline dijitLeft\"\n\tid=\"widget_${id}\"\n\trole=\"combobox\"\n\t><div class='dijitReset dijitRight dijitButtonNode dijitArrowButton dijitDownArrowButton dijitArrowButtonContainer'\n\t\tdata-dojo-attach-point=\"_buttonNode, _popupStateNode\" role=\"presentation\"\n\t\t><input class=\"dijitReset dijitInputField dijitArrowButtonInner\" value=\"&#9660; \" type=\"text\" tabIndex=\"-1\" readonly=\"readonly\" role=\"presentation\"\n\t\t\t${_buttonInputDisabled}\n\t/></div\n\t><div class='dijitReset dijitValidationContainer'\n\t\t><input class=\"dijitReset dijitInputField dijitValidationIcon dijitValidationInner\" value=\"&#935; \" type=\"text\" tabIndex=\"-1\" readonly=\"readonly\" role=\"presentation\"\n\t/></div\n\t><div class=\"dijitReset dijitInputField dijitInputContainer\"\n\t\t><input class='dijitReset dijitInputInner' ${!nameAttrSetting} type=\"text\" autocomplete=\"off\"\n\t\t\tdata-dojo-attach-point=\"textbox,focusNode\" role=\"textbox\" aria-haspopup=\"true\"\n\t/></div\n></div>\n"}});
define("dijit/form/_DateTimeTextBox",["dojo/date","dojo/date/locale","dojo/date/stamp","dojo/_base/declare","dojo/_base/lang","./RangeBoundTextBox","../_HasDropDown","dojo/text!./templates/DropDownBox.html"],function(date,_1dd9,stamp,_1dda,lang,_1ddb,_1ddc,_1ddd){
new Date("X");
var _1dde=_1dda("dijit.form._DateTimeTextBox",[_1ddb,_1ddc],{templateString:_1ddd,hasDownArrow:true,cssStateNodes:{"_buttonNode":"dijitDownArrowButton"},pattern:_1dd9.regexp,datePackage:"",postMixInProperties:function(){
this.inherited(arguments);
this._set("type","text");
},compare:function(val1,val2){
var _1ddf=this._isInvalidDate(val1);
var _1de0=this._isInvalidDate(val2);
return _1ddf?(_1de0?0:-1):(_1de0?1:date.compare(val1,val2,this._selector));
},forceWidth:true,format:function(value,_1de1){
if(!value){
return "";
}
return this.dateLocaleModule.format(value,_1de1);
},"parse":function(value,_1de2){
return this.dateLocaleModule.parse(value,_1de2)||(this._isEmpty(value)?null:undefined);
},serialize:function(val,_1de3){
if(val.toGregorian){
val=val.toGregorian();
}
return stamp.toISOString(val,_1de3);
},dropDownDefaultValue:new Date(),value:new Date(""),_blankValue:null,popupClass:"",_selector:"",constructor:function(_1de4){
this.dateModule=_1de4.datePackage?lang.getObject(_1de4.datePackage,false):date;
this.dateClassObj=this.dateModule.Date||Date;
this.dateLocaleModule=_1de4.datePackage?lang.getObject(_1de4.datePackage+".locale",false):_1dd9;
this._set("pattern",this.dateLocaleModule.regexp);
this._invalidDate=this.constructor.prototype.value.toString();
},buildRendering:function(){
this.inherited(arguments);
if(!this.hasDownArrow){
this._buttonNode.style.display="none";
}
if(!this.hasDownArrow){
this._buttonNode=this.domNode;
this.baseClass+=" dijitComboBoxOpenOnClick";
}
},_setConstraintsAttr:function(_1de5){
_1de5.selector=this._selector;
_1de5.fullYear=true;
var _1de6=stamp.fromISOString;
if(typeof _1de5.min=="string"){
_1de5.min=_1de6(_1de5.min);
}
if(typeof _1de5.max=="string"){
_1de5.max=_1de6(_1de5.max);
}
this.inherited(arguments);
},_isInvalidDate:function(value){
return !value||isNaN(value)||typeof value!="object"||value.toString()==this._invalidDate;
},_setValueAttr:function(value,_1de7,_1de8){
if(value!==undefined){
if(typeof value=="string"){
value=stamp.fromISOString(value);
}
if(this._isInvalidDate(value)){
value=null;
}
if(value instanceof Date&&!(this.dateClassObj instanceof Date)){
value=new this.dateClassObj(value);
}
}
this.inherited(arguments);
if(this.value instanceof Date){
this.filterString="";
}
if(this.dropDown){
this.dropDown.set("value",value,false);
}
},_set:function(attr,value){
if(attr=="value"&&this.value instanceof Date&&this.compare(value,this.value)==0){
return;
}
this.inherited(arguments);
},_setDropDownDefaultValueAttr:function(val){
if(this._isInvalidDate(val)){
val=new this.dateClassObj();
}
this.dropDownDefaultValue=val;
},openDropDown:function(_1de9){
if(this.dropDown){
this.dropDown.destroy();
}
var _1dea=lang.isString(this.popupClass)?lang.getObject(this.popupClass,false):this.popupClass,_1deb=this,value=this.get("value");
this.dropDown=new _1dea({onChange:function(value){
_1deb.set("value",value,true);
},id:this.id+"_popup",dir:_1deb.dir,lang:_1deb.lang,value:value,currentFocus:!this._isInvalidDate(value)?value:this.dropDownDefaultValue,constraints:_1deb.constraints,filterString:_1deb.filterString,datePackage:_1deb.params.datePackage,isDisabledDate:function(date){
return !_1deb.rangeCheck(date,_1deb.constraints);
}});
this.inherited(arguments);
},_getDisplayedValueAttr:function(){
return this.textbox.value;
},_setDisplayedValueAttr:function(value,_1dec){
this._setValueAttr(this.parse(value,this.constraints),_1dec,value);
}});
return _1dde;
});
},"davinci/ve/widgets/MetaDataStore":function(){
define(["dojo/_base/declare","dojo/data/ItemFileReadStore","dojo/i18n!davinci/ve/nls/ve","dojo/i18n!dijit/nls/common"],function(_1ded,_1dee){
return _1ded("davinci.ve.widgets.MetaDataStore",_1dee,{_allValues:[],constructor:function(args){
this.setValues((args&&args.values)||[]);
},setValues:function(_1def){
dojo.mixin(this._allValues,_1def);
var items=[];
dojo.forEach(this._allValues,function(v){
items.push({name:v,value:v});
});
this._jsonData={identifier:"name",items:items};
this._loadFinished=false;
},contains:function(value){
return dojo.indexOf(this._allValues,value)!=-1;
},clearValues:function(){
this._allValues=[];
this._loadFinished=false;
}});
});
},"davinci/ui/dnd/DragManager":function(){
define(["dojo/_base/declare"],function(_1df0){
return new _1df0("",null,{disabled:false,currentDragSource:null,currentDropTarget:null,dropAcceptable:false,dropTargets:null,dragTriggered:false,currentDomElement:null,_connectors:null,_moveConnector:null,document:null,documentX:0,documentY:0,_ABSOLUTE_THRESHOLD:3,_STATIC_THRESHOLD:40,constructor:function(){
this.dropTargets=[];
this._connectors=[dojo.connect(dojo.doc,"onkeydown",this,"onKeyDown"),dojo.connect(dojo.doc,"onmouseover",this,"onMouseOver"),dojo.connect(dojo.doc,"onmouseout",this,"onMouseOut"),dojo.connect(dojo.doc,"onmousedown",this,"onMouseDown"),dojo.connect(dojo.doc,"onmouseup",this,"onMouseUp")];
},destroy:function(){
dojo.forEach(this._connectors,dojo.disconnect);
},onKeyDown:function(e){
if(e.keyCode==27){
if(this.currentDragSource){
this.dropAcceptable=false;
this.onMouseUp(e);
}
}
},onMouseDown:function(e,_1df1){
if(this.disabled){
return;
}
if(this.dragTriggered){
return;
}
if(!dojo.mouseButtons.isLeft(e)||e.metaKey||e.ctrlKey){
return;
}
if(dojo.isIE){
e.pageX-=2;
e.pageY-=2;
}
if(this.dragTriggered){
return;
}
var ds=this.currentDragSource=_1df1||this.findDragSource(e);
if(!ds){
return;
}
ds.onDragDown(e);
for(var i=0,len=this.dropTargets.length;i<len;i++){
var dt=this.dropTargets[i];
if(!dt.disabled){
dt.onDragDown(e);
}
}
e.preventDefault();
this._moveConnectors=[dojo.connect(dojo.doc,"onmousemove",this,"onMouseMove")];
if(this.document&&this.document!=dojo.doc){
this._moveConnectors.push(dojo.connect(this.document,"onmousemove",this,"onMouseMove"));
this._moveConnectors.push(dojo.connect(this.document,"onmouseover",this,"onMouseOver"));
this._moveConnectors.push(dojo.connect(this.document,"onmouseout",this,"onMouseOut"));
this._moveConnectors.push(dojo.connect(this.document,"onmouseup",this,"onMouseUp"));
}
},onMouseMove:function(e){
e.preventDefault();
if(dojo.isIE){
e.pageX-=2;
e.pageY-=2;
}
if(e.target==this.document||e.target.ownerDocument==this.document){
e.documentX=this.documentX;
e.documentY=this.documentY;
}
var ds=e.dragSource=this.currentDragSource;
if(!this.dragTriggered){
var dx=e.pageX-ds.pageX;
var dy=e.pageY-ds.pageY;
var d=Math.sqrt(dx*dx+dy*dy);
if(ds.positioning=="absolute"){
if(d<this._ABSOLUTE_THRESHOLD){
return;
}
}else{
if(d<this._STATIC_THRESHOLD){
return;
}
}
this.dragTriggered=true;
ds.onDragStart(e);
for(var i=0,len=this.dropTargets.length;i<len;i++){
var dt=this.dropTargets[i];
if(!dt.disabled){
e.dropTarget=dt;
dt.onDragStart(e);
}
}
this.onMouseOver(e);
}
ds.onDragMove(e);
var dt=this.currentDropTarget;
if(dt){
if(this.dropAcceptable){
e.dropTarget=dt;
dt.onDragMove(e,this.dragObjects);
}
}else{
this.dropAcceptable=false;
}
},onMouseOver:function(e){
this.currentDomElement=e.target;
if(!this.dragTriggered){
return;
}
var ds=this.currentDragSource;
if(!ds){
return;
}
e.dragSource=ds;
var dt=this.findDropTarget(this.currentDomElement,ds);
if(dt&&ds.domNode==dt.domNode){
return;
}
if(dt!=this.currentDropTarget){
if(this.currentDropTarget){
e.dropTarget=this.currentDropTarget;
this.currentDropTarget.onDragOut(e);
}
if(dt){
e.dropTarget=dt;
this.dropAcceptable=dt.onDragOver(e);
}
}
this.currentDropTarget=dt;
},onMouseOut:function(e){
},onMouseUp:function(e){
if(this.ignoreMouseUp){
return;
}
dojo.forEach(this._moveConnectors,dojo.disconnect);
if(!this.dragTriggered){
this._resetStatus();
return;
}
for(var i=0,len=this.dropTargets.length;i<len;i++){
var _1df2=this.dropTargets[i];
if(!_1df2.disabled){
e.dropTarget=_1df2;
_1df2.onDragEnd(e);
}
}
var ds=this.currentDragSource;
var dt=this.currentDropTarget;
e.dragSource=ds;
e.dropTarget=dt;
if(!ds){
this._resetStatus();
return;
}
if(dt){
dt.onDropStart(e);
if(this.dropAcceptable){
var ret=dt.onDrop(e);
dt.onDragOut(e);
if(ret!=undefined&&!e.dragStatus){
e.dragStatus=ret?"dropSuccess":"dropFailure";
}
}else{
dt.onDragOut(e);
e.dragStatus="dropFailure";
}
}else{
e.dragStatus="dropFailure";
}
ds.onDragEnd(e);
if(dt){
dt.onDropEnd(e);
}
this._resetStatus();
},_resetStatus:function(){
this.currentDropTarget=null;
this.currentDragSource=null;
this.dropAcceptable=false;
this.dragTriggered=false;
this.currentDomElement=null;
},findDragSource:function(e){
for(var node=e.target;node&&node!=dojo.doc.body;node=node.parentNode){
if(node.dragSource&&!node.dragSource.disabled){
return node.dragSource;
}
}
return null;
},findDropTarget:function(_1df3,ds){
var dt=null;
for(var elem=_1df3,prev=null;elem!=null&&elem!=dojo.doc.body;elem=elem.parentNode){
var _1df4=elem.dropTarget;
if(_1df4&&!_1df4.disabled&&_1df4.accepts(ds)){
dt=_1df4;
dt.nodeUnderMouse=prev;
break;
}
if(elem.dragSource&&!elem.dragSource.disabled){
prev=elem;
}
}
return dt;
},registerDropTarget:function(dt){
this.dropTargets.push(dt);
},unregisterDropTarget:function(dt){
for(var i=0,len=this.dropTargets.length;i<len;i++){
if(this.dropTargets[i]==dt){
this.dropTargets.splice(i,1);
break;
}
}
}})();
});
},"dijit/form/Select":function(){
require({cache:{"url:dijit/form/templates/Select.html":"<table class=\"dijit dijitReset dijitInline dijitLeft\"\n\tdata-dojo-attach-point=\"_buttonNode,tableNode,focusNode\" cellspacing='0' cellpadding='0'\n\trole=\"listbox\" aria-haspopup=\"true\"\n\t><tbody role=\"presentation\"><tr role=\"presentation\"\n\t\t><td class=\"dijitReset dijitStretch dijitButtonContents\" role=\"presentation\"\n\t\t\t><div class=\"dijitReset dijitInputField dijitButtonText\"  data-dojo-attach-point=\"containerNode,_popupStateNode\" role=\"presentation\"></div\n\t\t\t><div class=\"dijitReset dijitValidationContainer\"\n\t\t\t\t><input class=\"dijitReset dijitInputField dijitValidationIcon dijitValidationInner\" value=\"&#935; \" type=\"text\" tabIndex=\"-1\" readonly=\"readonly\" role=\"presentation\"\n\t\t\t/></div\n\t\t\t><input type=\"hidden\" ${!nameAttrSetting} data-dojo-attach-point=\"valueNode\" value=\"${value}\" aria-hidden=\"true\"\n\t\t/></td\n\t\t><td class=\"dijitReset dijitRight dijitButtonNode dijitArrowButton dijitDownArrowButton dijitArrowButtonContainer\"\n\t\t\tdata-dojo-attach-point=\"titleNode\" role=\"presentation\"\n\t\t\t><input class=\"dijitReset dijitInputField dijitArrowButtonInner\" value=\"&#9660; \" type=\"text\" tabIndex=\"-1\" readonly=\"readonly\" role=\"presentation\"\n\t\t\t\t${_buttonInputDisabled}\n\t\t/></td\n\t></tr></tbody\n></table>\n"}});
define("dijit/form/Select",["dojo/_base/array","dojo/_base/declare","dojo/dom-attr","dojo/dom-class","dojo/dom-geometry","dojo/_base/event","dojo/i18n","dojo/_base/lang","dojo/sniff","./_FormSelectWidget","../_HasDropDown","../Menu","../MenuItem","../MenuSeparator","../Tooltip","dojo/text!./templates/Select.html","dojo/i18n!./nls/validate"],function(array,_1df5,_1df6,_1df7,_1df8,event,i18n,lang,has,_1df9,_1dfa,Menu,_1dfb,_1dfc,_1dfd,_1dfe){
var _1dff=_1df5("dijit.form._SelectMenu",Menu,{autoFocus:true,buildRendering:function(){
this.inherited(arguments);
var o=(this.menuTableNode=this.domNode);
var n=(this.domNode=this.ownerDocument.createElement("div"));
n.style.cssText="overflow-x: hidden; overflow-y: scroll";
if(o.parentNode){
o.parentNode.replaceChild(n,o);
}
_1df7.remove(o,"dijitMenuTable");
n.className=o.className+" dijitSelectMenu";
o.className="dijitReset dijitMenuTable";
o.setAttribute("role","listbox");
n.setAttribute("role","presentation");
n.appendChild(o);
},postCreate:function(){
this.inherited(arguments);
this.connect(this.domNode,"onselectstart",event.stop);
},focus:function(){
var found=false,val=this.parentWidget.value;
if(lang.isArray(val)){
val=val[val.length-1];
}
if(val){
array.forEach(this.parentWidget._getChildren(),function(child){
if(child.option&&(val===child.option.value)){
found=true;
this.focusChild(child,false);
}
},this);
}
if(!found){
this.inherited(arguments);
}
},resize:function(mb){
if(mb){
_1df8.setMarginBox(this.domNode,mb);
if("w" in mb){
this.menuTableNode.style.width="100%";
}
}
}});
var _1e00=_1df5("dijit.form.Select",[_1df9,_1dfa],{baseClass:"dijitSelect dijitValidationTextBox",templateString:_1dfe,_buttonInputDisabled:has("ie")?"disabled":"",required:false,state:"",message:"",tooltipPosition:[],emptyLabel:"&#160;",_isLoaded:false,_childrenLoaded:false,_fillContent:function(){
this.inherited(arguments);
if(this.options.length&&!this.value&&this.srcNodeRef){
var si=this.srcNodeRef.selectedIndex||0;
this.value=this.options[si>=0?si:0].value;
}
this.dropDown=new _1dff({id:this.id+"_menu",parentWidget:this});
_1df7.add(this.dropDown.domNode,this.baseClass.replace(/\s+|$/g,"Menu "));
},_getMenuItemForOption:function(_1e01){
if(!_1e01.value&&!_1e01.label){
return new _1dfc({ownerDocument:this.ownerDocument});
}else{
var click=lang.hitch(this,"_setValueAttr",_1e01);
var item=new _1dfb({option:_1e01,label:_1e01.label||this.emptyLabel,onClick:click,ownerDocument:this.ownerDocument,dir:this.dir,disabled:_1e01.disabled||false});
item.focusNode.setAttribute("role","option");
return item;
}
},_addOptionItem:function(_1e02){
if(this.dropDown){
this.dropDown.addChild(this._getMenuItemForOption(_1e02));
}
},_getChildren:function(){
if(!this.dropDown){
return [];
}
return this.dropDown.getChildren();
},_loadChildren:function(_1e03){
if(_1e03===true){
if(this.dropDown){
delete this.dropDown.focusedChild;
}
if(this.options.length){
this.inherited(arguments);
}else{
array.forEach(this._getChildren(),function(child){
child.destroyRecursive();
});
var item=new _1dfb({ownerDocument:this.ownerDocument,label:this.emptyLabel});
this.dropDown.addChild(item);
}
}else{
this._updateSelection();
}
this._isLoaded=false;
this._childrenLoaded=true;
if(!this._loadingStore){
this._setValueAttr(this.value,false);
}
},_refreshState:function(){
if(this._started){
this.validate(this.focused);
}
},startup:function(){
this.inherited(arguments);
this._refreshState();
},_setValueAttr:function(value){
this.inherited(arguments);
_1df6.set(this.valueNode,"value",this.get("value"));
this._refreshState();
},_setDisabledAttr:function(value){
this.inherited(arguments);
this._refreshState();
},_setRequiredAttr:function(value){
this._set("required",value);
this.focusNode.setAttribute("aria-required",value);
this._refreshState();
},_setOptionsAttr:function(_1e04){
this._isLoaded=false;
this._set("options",_1e04);
},_setDisplay:function(_1e05){
var lbl=_1e05||this.emptyLabel;
this.containerNode.innerHTML="<span role=\"option\" class=\"dijitReset dijitInline "+this.baseClass.replace(/\s+|$/g,"Label ")+"\">"+lbl+"</span>";
},validate:function(_1e06){
var _1e07=this.disabled||this.isValid(_1e06);
this._set("state",_1e07?"":(this._hasBeenBlurred?"Error":"Incomplete"));
this.focusNode.setAttribute("aria-invalid",_1e07?"false":"true");
var _1e08=_1e07?"":this._missingMsg;
if(_1e08&&this.focused&&this._hasBeenBlurred){
_1dfd.show(_1e08,this.domNode,this.tooltipPosition,!this.isLeftToRight());
}else{
_1dfd.hide(this.domNode);
}
this._set("message",_1e08);
return _1e07;
},isValid:function(){
return (!this.required||this.value===0||!(/^\s*$/.test(this.value||"")));
},reset:function(){
this.inherited(arguments);
_1dfd.hide(this.domNode);
this._refreshState();
},postMixInProperties:function(){
this.inherited(arguments);
this._missingMsg=i18n.getLocalization("dijit.form","validate",this.lang).missingMessage;
},postCreate:function(){
this.inherited(arguments);
this.connect(this.domNode,"onselectstart",event.stop);
this.domNode.setAttribute("aria-expanded","false");
if(has("ie")<9){
this.defer(function(){
try{
var s=domStyle.getComputedStyle(this.domNode);
if(s){
var ff=s.fontFamily;
if(ff){
var _1e09=this.domNode.getElementsByTagName("INPUT");
if(_1e09){
for(var i=0;i<_1e09.length;i++){
_1e09[i].style.fontFamily=ff;
}
}
}
}
}
catch(e){
}
});
}
},_setStyleAttr:function(value){
this.inherited(arguments);
_1df7.toggle(this.domNode,this.baseClass.replace(/\s+|$/g,"FixedWidth "),!!this.domNode.style.width);
},isLoaded:function(){
return this._isLoaded;
},loadDropDown:function(_1e0a){
this._loadChildren(true);
this._isLoaded=true;
_1e0a();
},closeDropDown:function(){
this.inherited(arguments);
if(this.dropDown&&this.dropDown.menuTableNode){
this.dropDown.menuTableNode.style.width="";
}
},destroy:function(_1e0b){
if(this.dropDown&&!this.dropDown._destroyed){
this.dropDown.destroyRecursive(_1e0b);
delete this.dropDown;
}
this.inherited(arguments);
},_onFocus:function(){
this.validate(true);
this.inherited(arguments);
},_onBlur:function(){
_1dfd.hide(this.domNode);
this.inherited(arguments);
this.validate(false);
}});
_1e00._Menu=_1dff;
return _1e00;
});
},"davinci/html/CSSEditorWidget":function(){
define(["dojo/_base/declare"],function(_1e0c){
return _1e0c("davinci.html.CSSEditorWidget",null,{constructor:function(_1e0d){
this.context=_1e0d;
},getValues:function(){
if(!this.values){
this.values={};
var rule=this.context.selectedRule;
for(var i=0;i<rule.properties.length;i++){
var _1e0e=rule.properties[i];
this.values[_1e0e.name]=_1e0e.value;
}
}
return this.values;
}});
});
},"url:dijit/form/templates/Select.html":"<table class=\"dijit dijitReset dijitInline dijitLeft\"\n\tdata-dojo-attach-point=\"_buttonNode,tableNode,focusNode\" cellspacing='0' cellpadding='0'\n\trole=\"listbox\" aria-haspopup=\"true\"\n\t><tbody role=\"presentation\"><tr role=\"presentation\"\n\t\t><td class=\"dijitReset dijitStretch dijitButtonContents\" role=\"presentation\"\n\t\t\t><div class=\"dijitReset dijitInputField dijitButtonText\"  data-dojo-attach-point=\"containerNode,_popupStateNode\" role=\"presentation\"></div\n\t\t\t><div class=\"dijitReset dijitValidationContainer\"\n\t\t\t\t><input class=\"dijitReset dijitInputField dijitValidationIcon dijitValidationInner\" value=\"&#935; \" type=\"text\" tabIndex=\"-1\" readonly=\"readonly\" role=\"presentation\"\n\t\t\t/></div\n\t\t\t><input type=\"hidden\" ${!nameAttrSetting} data-dojo-attach-point=\"valueNode\" value=\"${value}\" aria-hidden=\"true\"\n\t\t/></td\n\t\t><td class=\"dijitReset dijitRight dijitButtonNode dijitArrowButton dijitDownArrowButton dijitArrowButtonContainer\"\n\t\t\tdata-dojo-attach-point=\"titleNode\" role=\"presentation\"\n\t\t\t><input class=\"dijitReset dijitInputField dijitArrowButtonInner\" value=\"&#9660; \" type=\"text\" tabIndex=\"-1\" readonly=\"readonly\" role=\"presentation\"\n\t\t\t\t${_buttonInputDisabled}\n\t\t/></td\n\t></tr></tbody\n></table>\n","davinci/ve/views/StatesView":function(){
define(["dojo/_base/declare","dojo/query","dojo/dom-class","dojo/_base/connect","dojo/i18n!../nls/ve","davinci/workbench/ViewPart","dijit/layout/BorderContainer","dijit/layout/ContentPane","davinci/XPathUtils","davinci/ve/States","davinci/ve/widget","davinci/ve/_Widget","dojo/data/ItemFileWriteStore","dijit/tree/ForestStoreModel","dijit/Tree","dojo/_base/window"],function(_1e0f,_1e10,_1e11,_1e12,veNls,_1e13,_1e14,_1e15,_1e16,_1e17,_1e18,_1e19,_1e1a,_1e1b,Tree,win){
var _1e1c=_1e0f(Tree._TreeNode,{}),_1e1d=_1e0f(Tree._TreeNode,{_setLabelAttr:{node:"labelNode",type:"innerHTML"}});
var _1e1e=["sceneId","category","node","sceneContainerNode","isCurrent","isFocus","isInitial"];
return _1e0f("davinci.ve.views.StatesView",[_1e13],{nextId:0,_lastSelectedId:null,postCreate:function(){
this.inherited(arguments);
this._themeState=null;
this.container=new _1e14({design:"headline",gutters:false,liveSplitters:false});
this.centerPane=new _1e15({region:"center"});
this.container.addChild(this.centerPane);
this.container.layout();
this.container.startup();
this.setContent(this.container);
this.subscribe("/davinci/ui/editorSelected",this._editorSelected.bind(this));
this.subscribe("/davinci/ui/context/loaded",this._contextLoaded.bind(this));
this.subscribe("/davinci/ui/context/statesLoaded",this._statesLoaded.bind(this));
this.subscribe("/davinci/ui/context/pagebuilt",this._pagebuilt.bind(this));
this.subscribe("/davinci/ui/context/pagerebuilt",this._pagerebuilt.bind(this));
this.subscribe("/davinci/ui/deviceChanged",this._deviceChanged.bind(this));
this.subscribe("/davinci/states/state/added",this._addState.bind(this));
this.subscribe("/davinci/states/state/removed",this._removeState.bind(this));
this.subscribe("/davinci/states/state/renamed",this._renameState.bind(this));
this.subscribe("/davinci/states/state/changed",this._changeState.bind(this));
this.subscribe("/maqetta/appstates/state/changed",this._changeState.bind(this));
this.subscribe("/maqetta/appstates/state/containerChange",this._containerChange.bind(this));
this.subscribe("/davinci/ui/context/registerSceneManager",this._registerSceneManager.bind(this));
this.subscribe("/davinci/scene/scenesLoaded",this._scenesLoaded.bind(this));
this.subscribe("/davinci/scene/added",this._addScene.bind(this));
this.subscribe("/davinci/scene/removed",this._removeScene.bind(this));
this.subscribe("/davinci/scene/renamed",this._renameScene.bind(this));
this.subscribe("/davinci/scene/selectionChanged",this._sceneSelectionChanged.bind(this));
dojo.subscribe("/davinci/ui/widgetPropertiesChanged",dojo.hitch(this,this._widgetPropertiesChanged));
this.subscribe("/davinci/ui/widgetSelected",dojo.hitch(this,this._widgetSelectionChanged));
this.attachToolbar();
dojo.style(this.toolbarDiv,"display","none");
},_contextLoaded:function(){
},_pagebuilt:function(){
this._statesLoaded.apply(this,arguments);
},_pagerebuilt:function(){
this._destroyTree();
this._statesLoaded.apply(this,arguments);
},_statesLoaded:function(){
if(this._editor&&this._editor.declaredClass!="davinci.ve.themeEditor.ThemeEditor"){
this._updateView();
}
this._hideShowToolBar();
},_deviceChanged:function(){
this._updateView();
},_addState:function(){
this._updateView();
},_removeState:function(){
this._updateView();
},_renameState:function(){
this._updateView();
},_changeState:function(event){
if(this.isThemeEditor()){
this._updateThemeSelection(event.newState);
}else{
this._updateView();
}
},_containerChange:function(){
this._updateView();
},_registerSceneManager:function(_1e1f){
},_scenesLoaded:function(_1e20){
this._updateView();
},_addScene:function(_1e21,_1e22,child){
this._updateView();
},_removeScene:function(_1e23,_1e24,child){
this._updateView();
},_renameScene:function(_1e25,_1e26,child){
this._updateView();
},_widgetPropertiesChanged:function(){
this._updateView();
},_widgetSelectionChanged:function(){
if(!this._editor||!this._editor.getContext||!this._tree||!this._sceneStore){
return;
}
var _1e27=this._editor.getContext();
var _1e28=_1e27.getSelection();
if(_1e28.length==1){
var node=_1e28[0].domNode;
if(node&&node._maqAppStates){
this._sceneStore.fetch({query:{node:node},queryOptions:{deep:true},onComplete:dojo.hitch(this,function(items,_1e29){
if(items.length>0){
var path=this._getTreeSelectionPath(items[0]);
this._tree.set("path",path);
}
})});
}
}
},_sceneSelectionChanged:function(_1e2a,_1e2b){
if(!_1e2a||!_1e2a.category||!_1e2b){
return;
}
this._updateSelection(_1e2a.category,_1e2b);
},_editorSelected:function(event){
var _1e2c=event.editor;
this._destroyTree();
this._unregisterForContextEvents();
if(_1e2c&&_1e2c.supports("states")){
this._editor=_1e2c;
dojo.style(this.container.domNode,"display","block");
if(_1e2c.declaredClass==="davinci.ve.themeEditor.ThemeEditor"){
this.set("title",veNls.States);
this._updateViewForThemeEditor();
if(!this._themeState){
this._updateThemeSelection("Normal");
}else{
this._updateThemeSelection(this._themeState);
}
}else{
this.set("title",veNls.Scenes);
this._registerForContextEvents();
this._updateView();
}
this.container.layout();
}else{
delete this._editor;
dojo.style(this.container.domNode,"display","none");
}
this._hideShowToolBar();
},_getRootNode:function(){
var _1e2d=this._editor,doc;
if(_1e2d&&_1e2d.getContext){
var _1e2e=_1e2d.getContext();
doc=_1e2e&&_1e2e.rootNode;
}
return doc;
},_updateView:function(){
if(!this._editor||!this._editor.getContext||this.isThemeEditor()){
return;
}
var _1e2f=this._editor.getContext();
if(!_1e2f||!_1e2f._statesLoaded){
return;
}
win.withDoc(document,function(){
this._updateList();
this._updateSelection();
},this);
},isThemeEditor:function(){
return this._editor&&this._editor.declaredClass==="davinci.ve.themeEditor.ThemeEditor";
},_updateViewForThemeEditor:function(){
var _1e30=this._editor._theme.getStatesForAllWidgets();
var names={"Normal":"Normal"};
if(_1e30){
for(var i=0;i<_1e30.length;i++){
var name=_1e30[i];
if(name!="Normal"){
names[name]=name;
}
}
}
latestStates=names;
var _1e31=this._getScenes();
var _1e32;
if(this._editor&&this._editor.getFileNameToDisplay){
_1e32=this._editor.getFileNameToDisplay();
}else{
_1e32=(this._editor&&this._editor.fileName)?this._editor.fileName:"file";
}
var _1e33={name:_1e32,type:"file",category:"file",children:[]};
var _1e34={name:"Widget States",type:"SceneManagerRoot",category:"AppStates",children:[]};
var _1e35=[_1e33];
for(var state in latestStates){
_1e34.children.push({name:state,sceneId:state,type:"AppState"});
}
_1e33.children=_1e33.children.concat(_1e34.children);
if(!this._compareStructures(_1e35,_1e31)){
this._destroyTree();
this._createTree(_1e35);
}
},_updateList:function(){
var _1e36=this._getScenes();
if(!this._editor||!_1e36){
return;
}
var _1e37=this._editor.getContext();
if(!_1e37||!_1e37.rootWidget||!_1e37.rootNode||!_1e37._statesLoaded){
return;
}
var _1e38=_1e37.sceneManagers;
var _1e39=[];
var that=this;
function _1e3a(_1e3b,_1e3c){
var _1e3d,_1e3e;
var _1e3f=(_1e3b.declaredClass&&_1e3b.isInstanceOf&&_1e3b.isInstanceOf(_1e19));
if(_1e3f){
_1e3d=_1e3b;
node=_1e3d.domNode;
}else{
_1e3d=null;
node=_1e3b;
}
var _1e40=_1e17.isStateContainer(node);
var _1e41=false;
for(var _1e42 in _1e38){
var sm=_1e38[_1e42];
if(sm.getSceneChildren&&sm.name&&sm.category){
_1e41=sm.isSceneContainer(node);
if(_1e41){
break;
}
}
}
if(node.tagName=="BODY"||_1e40||_1e41){
var _1e43=null;
for(var e=0;e<_1e39.length;e++){
var _1e44=_1e39[e];
if(_1e44.node==node){
_1e43=_1e44;
break;
}
}
var _1e45=null;
if(!_1e43){
pn=node.parentNode;
ancestorParentItemLoop:
while(pn){
for(var e=0;e<_1e39.length;e++){
var _1e44=_1e39[e];
if(_1e44.node==pn){
_1e45=_1e44;
break ancestorParentItemLoop;
}
}
if(pn.tagName=="BODY"){
break;
}
pn=pn.parentNode;
}
}
if(_1e43){
_1e3c=_1e43;
}else{
var label=_1e3f?_1e18.getLabel(_1e3d):_1e18.getLabelForNode(node);
var xpath=_1e16.getXPath(node);
var o={name:label,type:"file",category:"file",node:node,children:[]};
if(_1e45){
o.maqid=_1e45.maqid+"$"+xpath;
_1e45.children.push(o);
}else{
o.maqid=_1e3c.maqid+"$"+xpath;
_1e3c.children.push(o);
}
_1e39.push(o);
_1e3c=o;
}
if(_1e40){
var _1e46=_1e17.getStates(node);
var _1e47=_1e17.getState(node);
if(!_1e47){
_1e47=_1e17.NORMAL;
}
var _1e48=_1e17.getInitial(node);
if(!_1e48){
_1e48=_1e17.NORMAL;
}
var _1e49=_1e3c.maqid+"$"+"AppStates";
var _1e4a={maqid:_1e49,name:"Application States",type:"SceneManagerRoot",category:"AppStates",sceneContainerNode:node,parentItem:_1e3c,children:[]};
for(var st=0;st<_1e46.length;st++){
var state=_1e46[st];
var span=that._treeNodeContent(state);
var _1e4b=(_1e4c&&_1e4c.stateContainerNode==node&&_1e4c.state==_1e47);
var _1e4d=(state===_1e47);
var _1e4e=(state===_1e48);
var _1e4f=_1e4a.maqid+"$"+state;
var o={maqid:_1e4f,name:span,sceneId:state,type:"AppState",isFocus:_1e4b,isCurrent:_1e4d,isInitial:_1e4e,sceneContainerNode:node,parentItem:_1e4a};
_1e4a.children.push(o);
_1e39.push(o);
}
_1e3c.children.push(_1e4a);
_1e39.push(_1e4a);
}
if(_1e41){
for(var _1e42 in _1e38){
var sm=_1e38[_1e42];
if(sm.getSceneChildren&&sm.getCurrentScene&&sm.getInitialScenes&&sm.name&&sm.category){
var _1e50=sm.getSceneChildren(node);
if(_1e50.length>0){
var _1e51=sm.getCurrentScene(node);
var _1e52=sm.getInitialScenes(node);
var xpath=_1e16.getXPath(node);
var _1e53=_1e3c.maqid+"$"+xpath;
var _1e54={maqid:_1e53,name:sm.name,type:"SceneManagerRoot",category:sm.category,parentItem:_1e3c,children:[]};
for(var _1e55=0;_1e55<_1e50.length;_1e55++){
var _1e56=_1e50[_1e55];
var label=_1e3f?_1e18.getLabel(_1e56._dvWidget):_1e18.getLabelForNode(_1e56);
var span=that._treeNodeContent(label);
var _1e4b=false;
var _1e4d=(_1e56===_1e51);
var _1e4e=(_1e52.indexOf(_1e56)>=0);
var xpath=_1e16.getXPath(_1e56);
var _1e57=_1e54.maqid+"$"+xpath;
var o={maqid:_1e57,name:span,sceneId:_1e56.id,type:sm.category,isFocus:_1e4b,isCurrent:_1e4d,isInitial:_1e4e,sceneContainerNode:node,parentItem:_1e54,node:_1e56,children:[]};
_1e54.children.push(o);
_1e39.push(o);
}
_1e3c.children.push(_1e54);
_1e39.push(o);
}
}
}
}
}
var _1e58;
if(_1e3f){
_1e58=_1e3d.getChildren();
for(var j=0;j<_1e58.length;j++){
_1e3a(_1e58[j],_1e3c);
}
}else{
_1e58=_1e17._getChildrenOfNode(node);
for(var j=0;j<_1e58.length;j++){
_1e3a(_1e58[j],_1e3c);
}
}
};
var _1e4c=_1e17.getFocus(_1e37.rootNode);
if(_1e4c&&!_1e4c.state){
_1e4c.state=_1e17.NORMAL;
}
var _1e59={maqid:"root",children:[]};
_1e3a(_1e37.rootWidget,_1e59);
var _1e5a=[_1e59.children[0]];
if(!this._compareStructures(_1e5a,_1e36)){
var _1e5b=null;
if(this._tree&&this._sceneStore){
var _1e5c=null;
var path=this._tree.get("path");
if(path.length>0){
_1e5b=path[path.length-1].maqid[0];
}
}
this._destroyTree();
this._createTree(_1e5a);
if(_1e5b){
this._tree.onLoadDeferred.then(function(){
this._sceneStore.fetch({query:{maqid:_1e5b},queryOptions:{deep:true},onComplete:dojo.hitch(this,function(items,_1e5d){
if(items.length===1){
var path=this._getTreeSelectionPath(items[0]);
if(path.length>0){
this._tree.set("path",path);
}
}
})});
}.bind(this));
}
}
this._hideShowToolBar();
},_getTreeSelectionPath:function(item){
var path=[];
path.splice(0,0,item.id[0]);
var _1e5e=item.parentItem&&item.parentItem[0];
while(_1e5e){
path.splice(0,0,_1e5e.id[0]);
_1e5e=_1e5e.parentItem&&_1e5e.parentItem[0];
}
path.splice(0,0,"StoryRoot");
return path;
},_updateSelection:function(){
if(!this._editor||!this._tree){
return;
}
var _1e5f=this._editor.getContext();
if(!_1e5f||!_1e5f._statesLoaded){
return;
}
this._tree.onLoadDeferred.then(function(){
var path=this._tree.get("path");
var _1e60=(path.length>0)?path[path.length-1].maqid[0]:null;
var _1e61=_1e5f.sceneManagers;
for(var _1e62 in _1e61){
var sm=_1e61[_1e62];
if(sm.getAllSceneContainers&&sm.getSceneChildren&&sm.getCurrentScene){
var _1e63=sm.getAllSceneContainers();
var _1e64;
this._sceneStore.fetch({query:{type:sm.category},queryOptions:{deep:true},onComplete:dojo.hitch(this,function(items,_1e65){
_1e64=items;
})});
for(var k=0;k<_1e64.length;k++){
var _1e66=_1e64[k];
var _1e67=_1e66.sceneContainerNode[0];
var id=_1e66.id[0];
var _1e68=this._findTreeNodeSpanByClass(_1e66,"ScenesPaletteCurrent");
var _1e69=this._findTreeNodeSpanByClass(_1e66,"ScenesPaletteFocus");
var _1e6a=this._findTreeNodeSpanByClass(_1e66,"ScenesPaletteInitial");
if(_1e66.isCurrent&&_1e66.isCurrent[0]){
if(_1e68){
_1e11.remove(_1e68,"ScenesPaletteCurrentHidden");
}
}else{
if(_1e68){
_1e11.add(_1e68,"ScenesPaletteCurrentHidden");
}
}
if(_1e69){
_1e11.add(_1e69,"ScenesPaletteFocusHidden");
}
if(_1e66.isInitial&&_1e66.isInitial[0]){
if(_1e6a){
_1e11.remove(_1e6a,"ScenesPaletteInitialHidden");
}
}else{
if(_1e6a){
_1e11.add(_1e6a,"ScenesPaletteInitialHidden");
}
}
if(_1e66.maqId&&_1e66.maqId[0]==_1e60){
var node=_1e66.node&&_1e66.node[0];
if(node&&node._maqAppStates){
var _1e6b=_1e17.getState(node);
_1e17.setState(_1e6b,node,{focus:true,updateWhenCurrent:true});
}
}
}
}
}
var _1e6c=[];
this._sceneStore.fetch({query:{type:"AppState"},queryOptions:{deep:true},onComplete:dojo.hitch(this,function(items,_1e6d){
_1e6c=items;
})});
for(var k=0;k<_1e6c.length;k++){
var _1e6e=_1e6c[k];
var _1e67=_1e6e.sceneContainerNode[0];
var id=_1e6e.id[0];
var _1e68=this._findTreeNodeSpanByClass(_1e6e,"ScenesPaletteCurrent");
var _1e69=this._findTreeNodeSpanByClass(_1e6e,"ScenesPaletteFocus");
var _1e6a=this._findTreeNodeSpanByClass(_1e6e,"ScenesPaletteInitial");
if(_1e6e.isCurrent&&_1e6e.isCurrent[0]){
if(_1e6e.isFocus&&_1e6e.isFocus[0]){
if(_1e69){
_1e11.remove(_1e69,"ScenesPaletteFocusHidden");
}
if(_1e68){
_1e11.remove(_1e68,"ScenesPaletteCurrentHidden");
}
}else{
if(_1e69){
_1e11.add(_1e69,"ScenesPaletteFocusHidden");
}
if(_1e68){
_1e11.remove(_1e68,"ScenesPaletteCurrentHidden");
}
}
}else{
if(_1e69){
_1e11.add(_1e69,"ScenesPaletteFocusHidden");
}
if(_1e68){
_1e11.add(_1e68,"ScenesPaletteCurrentHidden");
}
}
if(_1e6e.isInitial&&_1e6e.isInitial[0]){
if(_1e6a){
_1e11.remove(_1e6a,"ScenesPaletteInitialHidden");
}
}else{
if(_1e6a){
_1e11.add(_1e6a,"ScenesPaletteInitialHidden");
}
}
}
}.bind(this));
},_updateThemeSelection:function(_1e6f){
if(!this._sceneStore){
return;
}
var _1e70;
if(!_1e6f){
_1e6f="Normal";
}
this._sceneStore.fetch({query:{type:"AppState",sceneId:_1e6f},queryOptions:{deep:true},onComplete:dojo.hitch(this,function(items,_1e71){
if(items.length===1){
_1e70=items[0].sceneId[0];
}
})});
if(_1e70){
this._updateSelectedScene("AppState",_1e70);
}
},_getScenes:function(){
var _1e72=[];
if(this._sceneStore){
this._sceneStore.fetch({query:{},queryOptions:{},onComplete:dojo.hitch(this,function(items,_1e73){
function _1e74(_1e75,_1e76){
var o={name:_1e75.name[0],type:_1e75.type[0]};
for(var p=0;p<_1e1e.length;p++){
var prop=_1e1e[p];
if(_1e75[prop]){
o[prop]=_1e75[prop][0];
}
}
_1e76.push(o);
if(_1e75.children&&_1e75.children.length>0){
o.children=[];
_1e75.children.forEach(function(child){
_1e74(child,o.children);
});
}
};
items.forEach(function(_1e77){
_1e74(_1e77,_1e72);
});
})});
}
return _1e72;
},_compareStructures:function(a1,a2){
function _1e78(o1,o2,prop){
if((o1[prop]&&!o2[prop])||(!o1[prop]&&o2[prop])){
return false;
}
if(o1[prop]&&o1[prop]!==o2[prop]){
return false;
}
return true;
};
function _1e79(o1,o2){
for(var pidx=0;pidx<_1e1e.length;pidx++){
var p=_1e1e[pidx];
if(!_1e78(o1,o2,p)){
return false;
}
}
var _1e7a=o1.children&&o1.children.length;
var _1e7b=o2.children&&o2.children.length;
if((_1e7a&&!_1e7b)||(!_1e7a&&_1e7b)){
return false;
}
if(_1e7a){
if(!_1e7c(o1.children,o2.children)){
return false;
}
}
return true;
};
function _1e7c(a1,a2){
if(a1.length!=a2.length){
return false;
}
for(var i=0;i<a1.length;i++){
if(!_1e79(a1[i],a2[i])){
return false;
}
}
return true;
};
return _1e7c(a1,a2);
},_destroyTree:function(){
if(this._tree){
this._tree.destroyRecursive();
this._forest.destroy();
this._sceneStore=null;
this._forest=null;
this._tree=null;
}
},_createTree:function(_1e7d){
if(!this._editor){
return;
}
var _1e7e=this._editor.getContext();
var _1e7f=_1e7e.sceneManagers;
var _1e80={identifier:"id",label:"name",items:[]};
this._sceneStore=new _1e1a({data:_1e80,clearOnClose:true});
this._forest=new _1e1b({store:this._sceneStore,query:{type:"file"},rootId:"StoryRoot",rootLabel:"All",childrenAttrs:["children"]});
this._tree=new Tree({model:this._forest,persist:false,showRoot:false,autoExpand:true,className:"StatesViewTree",style:"height:150px; overflow-x:hidden; overflow-y:auto;",_createTreeNode:function(args){
return new _1e1d(args);
},getIconClass:function(item,_1e81){
return "dijitLeaf";
}});
this.centerPane.domNode.appendChild(this._tree.domNode);
dojo.connect(this._tree,"onClick",this,function(item){
var _1e82=this._editor;
var _1e83=_1e82?_1e82.getContext():null;
var _1e84=_1e83?_1e83.rootNode:null;
var _1e85=null;
var type=null;
var _1e86=null;
if(item&&item.type){
type=item.type[0];
var _1e87=item.category&&item.category[0];
if(type=="AppState"||(type=="SceneManagerRoot"&&_1e87=="AppStates")){
_1e85=item.sceneContainerNode?item.sceneContainerNode[0]:null;
}else{
if(item.node&&item.node[0]._maqAppStates){
_1e85=item.node[0];
}
}
}
if(this.isThemeEditor()){
this.publish("/davinci/states/state/changed",[{editorClass:_1e82.declaredClass,widget:"$all",newState:item.sceneId[0],oldState:this._themeState,context:this._editor.context}]);
this._themeState=item.sceneId[0];
}else{
if(_1e83&&_1e85){
if(type=="AppState"){
_1e86=item.sceneId?item.sceneId[0]:null;
}else{
_1e86=_1e17.getState(_1e85);
}
_1e17.setState(_1e86,_1e85,{focus:true,updateWhenCurrent:true});
if(this._editor.declaredClass==="davinci.ve.PageEditor"){
_1e83.deselectInvisible();
_1e83.clearCachedWidgetBounds();
_1e83.updateFocusAll();
}
}
if(item.sceneId){
for(var _1e88 in _1e7f){
var sm=_1e7f[_1e88];
if(sm.selectScene){
if(sm.selectScene({sceneId:item.sceneId[0]})){
break;
}
}
}
}else{
if(item.type&&item.type[0]=="file"&&item.node&&item.node[0]._dvWidget){
_1e83.select(item.node[0]._dvWidget);
}
}
this._updateSelection();
}
});
var _1e89=function(obj,_1e8a){
var o=dojo.mixin({},obj);
var id=this.nextId+"";
this.nextId++;
o.id=id;
o.parentItem=_1e8a;
delete o.children;
var _1e8b;
if(_1e8a){
_1e8b=this._sceneStore.newItem(o,{parent:_1e8a,attribute:"children"});
}else{
_1e8b=this._sceneStore.newItem(o);
}
if(obj.children){
obj.children.forEach(function(child){
_1e89(child,_1e8b);
});
}
}.bind(this);
_1e7d.forEach(function(obj){
_1e89(obj);
});
this._sceneStore.save();
if(this._tree.getParent){
var _1e8c=this._tree.getParent();
if(_1e8c.resize){
window.setTimeout(function(){
_1e8c.resize();
},0);
}
}
},_updateSelectedScene:function(type,_1e8d){
if(!this._sceneStore){
return;
}
var _1e8e=_1e8d;
var path=[];
while(_1e8e){
this._sceneStore.fetch({query:{type:type,sceneId:_1e8e},queryOptions:{deep:true},onComplete:dojo.hitch(this,function(items,_1e8f){
if(items.length!==1){
console.error("_sceneSelectionChanged error. currentSceneId="+_1e8e+",items.length="+items.length);
_1e8e=null;
}else{
var item=items[0];
path.splice(0,0,item.id[0]);
_1e8e=item.parentSceneId?item.parentSceneId[0]:null;
var _1e90=item.parentItem&&item.parentItem[0];
while(_1e90){
path.splice(0,0,_1e90.id[0]);
_1e90=_1e90.parentItem&&_1e90.parentItem[0];
}
}
})});
}
path.splice(0,0,"StoryRoot");
this._tree.set("paths",[path]);
},_hideShowToolBar:function(){
if(!this._editor){
return;
}
var _1e91=(this._editor.getContext&&this._editor.getContext());
var _1e92=(this._editor.declaredClass==="davinci.ve.PageEditor");
dojo.style(this.toolbarDiv,"display",_1e92?"block":"none");
var _1e93,_1e94,_1e95;
_1e93=_1e94=_1e95=false;
if(_1e91&&_1e91.rootNode){
var _1e96=_1e17.getFocus(_1e91.rootNode);
if(_1e96&&_1e96.stateContainerNode){
_1e93=_1e95=true;
}
if(_1e96&&_1e96.state&&_1e96.state!==_1e17.NORMAL){
_1e94=_1e95=true;
}
}
function _1e97(_1e98,_1e99){
var _1e9a=_1e98+"Disabled";
var _1e9b=_1e10("."+_1e98);
if(_1e9b.length){
if(_1e99){
_1e11.remove(_1e9b[0],_1e9a);
}else{
_1e11.add(_1e9b[0],_1e9a);
}
}
};
_1e97("addStateIcon",_1e93);
_1e97("removeStateIcon",_1e94);
_1e97("modifyStateIcon",_1e95);
},_treeNodeContent:function(_1e9c){
var s="";
s+="<span title=\""+veNls.InitialScene+"\" class=\"ScenesPaletteAppStateIcon ScenesPaletteInitial\">&#x2713;</span>";
s+="<span title=\""+veNls.ActiveScene+"\" class=\"ScenesPaletteAppStateIcon ScenesPaletteCurrent\">&#x263C;</span>";
s+="<span title=\""+veNls.AppStateFocus+"\" class=\"ScenesPaletteAppStateIcon ScenesPaletteFocus\">&#x25C9;</span>";
s+="<span>"+_1e9c+"</span>";
return s;
},_findTreeNodeSpanByClass:function(item,_1e9d){
var _1e9e=this._tree.getNodesByItem(item);
var _1e9f=(_1e9e&&_1e9e.length>0)?_1e9e[0]:null;
var node=_1e9f?_1e9f.domNode:null;
var spans=_1e9f?dojo.query("."+_1e9d,node):[];
var span=(spans&&spans.length>0)?spans[0]:null;
return span;
},_contextEventHandler:function(){
this._updateView();
},_unregisterForContextEvents:function(){
if(this._contextConnects){
this._contextConnects.forEach(_1e12.disconnect);
this._contextConnects=null;
}
},_registerForContextEvents:function(){
var _1ea0=["widgetChanged","widgetAddedOrDeleted"];
this._unregisterForContextEvents();
var _1ea1=(this._editor&&this._editor.getContext&&this._editor.getContext());
if(_1ea1){
this._contextConnects=[];
_1ea0.forEach(function(name){
if(_1ea1[name]){
this._contextConnects.push(_1e12.connect(_1ea1,name,this,"_contextEventHandler"));
}
}.bind(this));
}
}});
});
},"dojo/data/ItemFileWriteStore":function(){
define("dojo/data/ItemFileWriteStore",["../_base/lang","../_base/declare","../_base/array","../_base/json","../_base/kernel","./ItemFileReadStore","../date/stamp"],function(lang,_1ea2,_1ea3,_1ea4,_1ea5,_1ea6,_1ea7){
return _1ea2("dojo.data.ItemFileWriteStore",_1ea6,{constructor:function(_1ea8){
this._features["dojo.data.api.Write"]=true;
this._features["dojo.data.api.Notification"]=true;
this._pending={_newItems:{},_modifiedItems:{},_deletedItems:{}};
if(!this._datatypeMap["Date"].serialize){
this._datatypeMap["Date"].serialize=function(obj){
return _1ea7.toISOString(obj,{zulu:true});
};
}
if(_1ea8&&(_1ea8.referenceIntegrity===false)){
this.referenceIntegrity=false;
}
this._saveInProgress=false;
},referenceIntegrity:true,_assert:function(_1ea9){
if(!_1ea9){
throw new Error("assertion failed in ItemFileWriteStore");
}
},_getIdentifierAttribute:function(){
return this.getFeatures()["dojo.data.api.Identity"];
},newItem:function(_1eaa,_1eab){
this._assert(!this._saveInProgress);
if(!this._loadFinished){
this._forceLoad();
}
if(typeof _1eaa!="object"&&typeof _1eaa!="undefined"){
throw new Error("newItem() was passed something other than an object");
}
var _1eac=null;
var _1ead=this._getIdentifierAttribute();
if(_1ead===Number){
_1eac=this._arrayOfAllItems.length;
}else{
_1eac=_1eaa[_1ead];
if(typeof _1eac==="undefined"){
throw new Error("newItem() was not passed an identity for the new item");
}
if(lang.isArray(_1eac)){
throw new Error("newItem() was not passed an single-valued identity");
}
}
if(this._itemsByIdentity){
this._assert(typeof this._itemsByIdentity[_1eac]==="undefined");
}
this._assert(typeof this._pending._newItems[_1eac]==="undefined");
this._assert(typeof this._pending._deletedItems[_1eac]==="undefined");
var _1eae={};
_1eae[this._storeRefPropName]=this;
_1eae[this._itemNumPropName]=this._arrayOfAllItems.length;
if(this._itemsByIdentity){
this._itemsByIdentity[_1eac]=_1eae;
_1eae[_1ead]=[_1eac];
}
this._arrayOfAllItems.push(_1eae);
var pInfo=null;
if(_1eab&&_1eab.parent&&_1eab.attribute){
pInfo={item:_1eab.parent,attribute:_1eab.attribute,oldValue:undefined};
var _1eaf=this.getValues(_1eab.parent,_1eab.attribute);
if(_1eaf&&_1eaf.length>0){
var _1eb0=_1eaf.slice(0,_1eaf.length);
if(_1eaf.length===1){
pInfo.oldValue=_1eaf[0];
}else{
pInfo.oldValue=_1eaf.slice(0,_1eaf.length);
}
_1eb0.push(_1eae);
this._setValueOrValues(_1eab.parent,_1eab.attribute,_1eb0,false);
pInfo.newValue=this.getValues(_1eab.parent,_1eab.attribute);
}else{
this._setValueOrValues(_1eab.parent,_1eab.attribute,_1eae,false);
pInfo.newValue=_1eae;
}
}else{
_1eae[this._rootItemPropName]=true;
this._arrayOfTopLevelItems.push(_1eae);
}
this._pending._newItems[_1eac]=_1eae;
for(var key in _1eaa){
if(key===this._storeRefPropName||key===this._itemNumPropName){
throw new Error("encountered bug in ItemFileWriteStore.newItem");
}
var value=_1eaa[key];
if(!lang.isArray(value)){
value=[value];
}
_1eae[key]=value;
if(this.referenceIntegrity){
for(var i=0;i<value.length;i++){
var val=value[i];
if(this.isItem(val)){
this._addReferenceToMap(val,_1eae,key);
}
}
}
}
this.onNew(_1eae,pInfo);
return _1eae;
},_removeArrayElement:function(array,_1eb1){
var index=_1ea3.indexOf(array,_1eb1);
if(index!=-1){
array.splice(index,1);
return true;
}
return false;
},deleteItem:function(item){
this._assert(!this._saveInProgress);
this._assertIsItem(item);
var _1eb2=item[this._itemNumPropName];
var _1eb3=this.getIdentity(item);
if(this.referenceIntegrity){
var _1eb4=this.getAttributes(item);
if(item[this._reverseRefMap]){
item["backup_"+this._reverseRefMap]=lang.clone(item[this._reverseRefMap]);
}
_1ea3.forEach(_1eb4,function(_1eb5){
_1ea3.forEach(this.getValues(item,_1eb5),function(value){
if(this.isItem(value)){
if(!item["backupRefs_"+this._reverseRefMap]){
item["backupRefs_"+this._reverseRefMap]=[];
}
item["backupRefs_"+this._reverseRefMap].push({id:this.getIdentity(value),attr:_1eb5});
this._removeReferenceFromMap(value,item,_1eb5);
}
},this);
},this);
var _1eb6=item[this._reverseRefMap];
if(_1eb6){
for(var _1eb7 in _1eb6){
var _1eb8=null;
if(this._itemsByIdentity){
_1eb8=this._itemsByIdentity[_1eb7];
}else{
_1eb8=this._arrayOfAllItems[_1eb7];
}
if(_1eb8){
for(var _1eb9 in _1eb6[_1eb7]){
var _1eba=this.getValues(_1eb8,_1eb9)||[];
var _1ebb=_1ea3.filter(_1eba,function(_1ebc){
return !(this.isItem(_1ebc)&&this.getIdentity(_1ebc)==_1eb3);
},this);
this._removeReferenceFromMap(item,_1eb8,_1eb9);
if(_1ebb.length<_1eba.length){
this._setValueOrValues(_1eb8,_1eb9,_1ebb,true);
}
}
}
}
}
}
this._arrayOfAllItems[_1eb2]=null;
item[this._storeRefPropName]=null;
if(this._itemsByIdentity){
delete this._itemsByIdentity[_1eb3];
}
this._pending._deletedItems[_1eb3]=item;
if(item[this._rootItemPropName]){
this._removeArrayElement(this._arrayOfTopLevelItems,item);
}
this.onDelete(item);
return true;
},setValue:function(item,_1ebd,value){
return this._setValueOrValues(item,_1ebd,value,true);
},setValues:function(item,_1ebe,_1ebf){
return this._setValueOrValues(item,_1ebe,_1ebf,true);
},unsetAttribute:function(item,_1ec0){
return this._setValueOrValues(item,_1ec0,[],true);
},_setValueOrValues:function(item,_1ec1,_1ec2,_1ec3){
this._assert(!this._saveInProgress);
this._assertIsItem(item);
this._assert(lang.isString(_1ec1));
this._assert(typeof _1ec2!=="undefined");
var _1ec4=this._getIdentifierAttribute();
if(_1ec1==_1ec4){
throw new Error("ItemFileWriteStore does not have support for changing the value of an item's identifier.");
}
var _1ec5=this._getValueOrValues(item,_1ec1);
var _1ec6=this.getIdentity(item);
if(!this._pending._modifiedItems[_1ec6]){
var _1ec7={};
for(var key in item){
if((key===this._storeRefPropName)||(key===this._itemNumPropName)||(key===this._rootItemPropName)){
_1ec7[key]=item[key];
}else{
if(key===this._reverseRefMap){
_1ec7[key]=lang.clone(item[key]);
}else{
_1ec7[key]=item[key].slice(0,item[key].length);
}
}
}
this._pending._modifiedItems[_1ec6]=_1ec7;
}
var _1ec8=false;
if(lang.isArray(_1ec2)&&_1ec2.length===0){
_1ec8=delete item[_1ec1];
_1ec2=undefined;
if(this.referenceIntegrity&&_1ec5){
var _1ec9=_1ec5;
if(!lang.isArray(_1ec9)){
_1ec9=[_1ec9];
}
for(var i=0;i<_1ec9.length;i++){
var value=_1ec9[i];
if(this.isItem(value)){
this._removeReferenceFromMap(value,item,_1ec1);
}
}
}
}else{
var _1eca;
if(lang.isArray(_1ec2)){
_1eca=_1ec2.slice(0,_1ec2.length);
}else{
_1eca=[_1ec2];
}
if(this.referenceIntegrity){
if(_1ec5){
var _1ec9=_1ec5;
if(!lang.isArray(_1ec9)){
_1ec9=[_1ec9];
}
var map={};
_1ea3.forEach(_1ec9,function(_1ecb){
if(this.isItem(_1ecb)){
var id=this.getIdentity(_1ecb);
map[id.toString()]=true;
}
},this);
_1ea3.forEach(_1eca,function(_1ecc){
if(this.isItem(_1ecc)){
var id=this.getIdentity(_1ecc);
if(map[id.toString()]){
delete map[id.toString()];
}else{
this._addReferenceToMap(_1ecc,item,_1ec1);
}
}
},this);
for(var rId in map){
var _1ecd;
if(this._itemsByIdentity){
_1ecd=this._itemsByIdentity[rId];
}else{
_1ecd=this._arrayOfAllItems[rId];
}
this._removeReferenceFromMap(_1ecd,item,_1ec1);
}
}else{
for(var i=0;i<_1eca.length;i++){
var value=_1eca[i];
if(this.isItem(value)){
this._addReferenceToMap(value,item,_1ec1);
}
}
}
}
item[_1ec1]=_1eca;
_1ec8=true;
}
if(_1ec3){
this.onSet(item,_1ec1,_1ec5,_1ec2);
}
return _1ec8;
},_addReferenceToMap:function(_1ece,_1ecf,_1ed0){
var _1ed1=this.getIdentity(_1ecf);
var _1ed2=_1ece[this._reverseRefMap];
if(!_1ed2){
_1ed2=_1ece[this._reverseRefMap]={};
}
var _1ed3=_1ed2[_1ed1];
if(!_1ed3){
_1ed3=_1ed2[_1ed1]={};
}
_1ed3[_1ed0]=true;
},_removeReferenceFromMap:function(_1ed4,_1ed5,_1ed6){
var _1ed7=this.getIdentity(_1ed5);
var _1ed8=_1ed4[this._reverseRefMap];
var _1ed9;
if(_1ed8){
for(_1ed9 in _1ed8){
if(_1ed9==_1ed7){
delete _1ed8[_1ed9][_1ed6];
if(this._isEmpty(_1ed8[_1ed9])){
delete _1ed8[_1ed9];
}
}
}
if(this._isEmpty(_1ed8)){
delete _1ed4[this._reverseRefMap];
}
}
},_dumpReferenceMap:function(){
var i;
for(i=0;i<this._arrayOfAllItems.length;i++){
var item=this._arrayOfAllItems[i];
if(item&&item[this._reverseRefMap]){
}
}
},_getValueOrValues:function(item,_1eda){
var _1edb=undefined;
if(this.hasAttribute(item,_1eda)){
var _1edc=this.getValues(item,_1eda);
if(_1edc.length==1){
_1edb=_1edc[0];
}else{
_1edb=_1edc;
}
}
return _1edb;
},_flatten:function(value){
if(this.isItem(value)){
return {_reference:this.getIdentity(value)};
}else{
if(typeof value==="object"){
for(var type in this._datatypeMap){
var _1edd=this._datatypeMap[type];
if(lang.isObject(_1edd)&&!lang.isFunction(_1edd)){
if(value instanceof _1edd.type){
if(!_1edd.serialize){
throw new Error("ItemFileWriteStore:  No serializer defined for type mapping: ["+type+"]");
}
return {_type:type,_value:_1edd.serialize(value)};
}
}else{
if(value instanceof _1edd){
return {_type:type,_value:value.toString()};
}
}
}
}
return value;
}
},_getNewFileContentString:function(){
var _1ede={};
var _1edf=this._getIdentifierAttribute();
if(_1edf!==Number){
_1ede.identifier=_1edf;
}
if(this._labelAttr){
_1ede.label=this._labelAttr;
}
_1ede.items=[];
for(var i=0;i<this._arrayOfAllItems.length;++i){
var item=this._arrayOfAllItems[i];
if(item!==null){
var _1ee0={};
for(var key in item){
if(key!==this._storeRefPropName&&key!==this._itemNumPropName&&key!==this._reverseRefMap&&key!==this._rootItemPropName){
var _1ee1=this.getValues(item,key);
if(_1ee1.length==1){
_1ee0[key]=this._flatten(_1ee1[0]);
}else{
var _1ee2=[];
for(var j=0;j<_1ee1.length;++j){
_1ee2.push(this._flatten(_1ee1[j]));
_1ee0[key]=_1ee2;
}
}
}
}
_1ede.items.push(_1ee0);
}
}
var _1ee3=true;
return _1ea4.toJson(_1ede,_1ee3);
},_isEmpty:function(_1ee4){
var empty=true;
if(lang.isObject(_1ee4)){
var i;
for(i in _1ee4){
empty=false;
break;
}
}else{
if(lang.isArray(_1ee4)){
if(_1ee4.length>0){
empty=false;
}
}
}
return empty;
},save:function(_1ee5){
this._assert(!this._saveInProgress);
this._saveInProgress=true;
var self=this;
var _1ee6=function(){
self._pending={_newItems:{},_modifiedItems:{},_deletedItems:{}};
self._saveInProgress=false;
if(_1ee5&&_1ee5.onComplete){
var scope=_1ee5.scope||_1ea5.global;
_1ee5.onComplete.call(scope);
}
};
var _1ee7=function(err){
self._saveInProgress=false;
if(_1ee5&&_1ee5.onError){
var scope=_1ee5.scope||_1ea5.global;
_1ee5.onError.call(scope,err);
}
};
if(this._saveEverything){
var _1ee8=this._getNewFileContentString();
this._saveEverything(_1ee6,_1ee7,_1ee8);
}
if(this._saveCustom){
this._saveCustom(_1ee6,_1ee7);
}
if(!this._saveEverything&&!this._saveCustom){
_1ee6();
}
},revert:function(){
this._assert(!this._saveInProgress);
var _1ee9;
for(_1ee9 in this._pending._modifiedItems){
var _1eea=this._pending._modifiedItems[_1ee9];
var _1eeb=null;
if(this._itemsByIdentity){
_1eeb=this._itemsByIdentity[_1ee9];
}else{
_1eeb=this._arrayOfAllItems[_1ee9];
}
_1eea[this._storeRefPropName]=this;
for(var key in _1eeb){
delete _1eeb[key];
}
lang.mixin(_1eeb,_1eea);
}
var _1eec;
for(_1ee9 in this._pending._deletedItems){
_1eec=this._pending._deletedItems[_1ee9];
_1eec[this._storeRefPropName]=this;
var index=_1eec[this._itemNumPropName];
if(_1eec["backup_"+this._reverseRefMap]){
_1eec[this._reverseRefMap]=_1eec["backup_"+this._reverseRefMap];
delete _1eec["backup_"+this._reverseRefMap];
}
this._arrayOfAllItems[index]=_1eec;
if(this._itemsByIdentity){
this._itemsByIdentity[_1ee9]=_1eec;
}
if(_1eec[this._rootItemPropName]){
this._arrayOfTopLevelItems.push(_1eec);
}
}
for(_1ee9 in this._pending._deletedItems){
_1eec=this._pending._deletedItems[_1ee9];
if(_1eec["backupRefs_"+this._reverseRefMap]){
_1ea3.forEach(_1eec["backupRefs_"+this._reverseRefMap],function(_1eed){
var _1eee;
if(this._itemsByIdentity){
_1eee=this._itemsByIdentity[_1eed.id];
}else{
_1eee=this._arrayOfAllItems[_1eed.id];
}
this._addReferenceToMap(_1eee,_1eec,_1eed.attr);
},this);
delete _1eec["backupRefs_"+this._reverseRefMap];
}
}
for(_1ee9 in this._pending._newItems){
var _1eef=this._pending._newItems[_1ee9];
_1eef[this._storeRefPropName]=null;
this._arrayOfAllItems[_1eef[this._itemNumPropName]]=null;
if(_1eef[this._rootItemPropName]){
this._removeArrayElement(this._arrayOfTopLevelItems,_1eef);
}
if(this._itemsByIdentity){
delete this._itemsByIdentity[_1ee9];
}
}
this._pending={_newItems:{},_modifiedItems:{},_deletedItems:{}};
return true;
},isDirty:function(item){
if(item){
var _1ef0=this.getIdentity(item);
return new Boolean(this._pending._newItems[_1ef0]||this._pending._modifiedItems[_1ef0]||this._pending._deletedItems[_1ef0]).valueOf();
}else{
return !this._isEmpty(this._pending._newItems)||!this._isEmpty(this._pending._modifiedItems)||!this._isEmpty(this._pending._deletedItems);
}
},onSet:function(item,_1ef1,_1ef2,_1ef3){
},onNew:function(_1ef4,_1ef5){
},onDelete:function(_1ef6){
},close:function(_1ef7){
if(this.clearOnClose){
if(!this.isDirty()){
this.inherited(arguments);
}else{
throw new Error("dojo.data.ItemFileWriteStore: There are unsaved changes present in the store.  Please save or revert the changes before invoking close.");
}
}
}});
});
},"dojox/color":function(){
define("dojox/color",["./color/_base"],function(_1ef8){
return _1ef8;
});
},"orion/textview/textDND":function(){
define("orion/textview/textDND",[],function(){
function _1ef9(view,_1efa){
this._view=view;
this._undoStack=_1efa;
this._dragSelection=null;
this._dropOffset=-1;
this._dropText=null;
var self=this;
this._listener={onDragStart:function(evt){
self._onDragStart(evt);
},onDragEnd:function(evt){
self._onDragEnd(evt);
},onDragEnter:function(evt){
self._onDragEnter(evt);
},onDragOver:function(evt){
self._onDragOver(evt);
},onDrop:function(evt){
self._onDrop(evt);
},onDestroy:function(evt){
self._onDestroy(evt);
}};
view.addEventListener("DragStart",this._listener.onDragStart);
view.addEventListener("DragEnd",this._listener.onDragEnd);
view.addEventListener("DragEnter",this._listener.onDragEnter);
view.addEventListener("DragOver",this._listener.onDragOver);
view.addEventListener("Drop",this._listener.onDrop);
view.addEventListener("Destroy",this._listener.onDestroy);
};
_1ef9.prototype={destroy:function(){
var view=this._view;
if(!view){
return;
}
view.removeEventListener("DragStart",this._listener.onDragStart);
view.removeEventListener("DragEnd",this._listener.onDragEnd);
view.removeEventListener("DragEnter",this._listener.onDragEnter);
view.removeEventListener("DragOver",this._listener.onDragOver);
view.removeEventListener("Drop",this._listener.onDrop);
view.removeEventListener("Destroy",this._listener.onDestroy);
this._view=null;
},_onDestroy:function(e){
this.destroy();
},_onDragStart:function(e){
var view=this._view;
var _1efb=view.getSelection();
var model=view.getModel();
if(model.getBaseModel){
_1efb.start=model.mapOffset(_1efb.start);
_1efb.end=model.mapOffset(_1efb.end);
model=model.getBaseModel();
}
var text=model.getText(_1efb.start,_1efb.end);
if(text){
this._dragSelection=_1efb;
e.event.dataTransfer.effectAllowed="copyMove";
e.event.dataTransfer.setData("Text",text);
}
},_onDragEnd:function(e){
var view=this._view;
if(this._dragSelection){
if(this._undoStack){
this._undoStack.startCompoundChange();
}
var move=e.event.dataTransfer.dropEffect==="move";
if(move){
view.setText("",this._dragSelection.start,this._dragSelection.end);
}
if(this._dropText){
var text=this._dropText;
var _1efc=this._dropOffset;
if(move){
if(_1efc>=this._dragSelection.end){
_1efc-=this._dragSelection.end-this._dragSelection.start;
}else{
if(_1efc>=this._dragSelection.start){
_1efc=this._dragSelection.start;
}
}
}
view.setText(text,_1efc,_1efc);
view.setSelection(_1efc,_1efc+text.length);
this._dropText=null;
this._dropOffset=-1;
}
if(this._undoStack){
this._undoStack.endCompoundChange();
}
}
this._dragSelection=null;
},_onDragEnter:function(e){
this._onDragOver(e);
},_onDragOver:function(e){
var types=e.event.dataTransfer.types;
if(types){
var _1efd=types.contains?types.contains("text/plain"):types.indexOf("text/plain")!==-1;
if(!_1efd){
e.event.dataTransfer.dropEffect="none";
}
}
},_onDrop:function(e){
var view=this._view;
var text=e.event.dataTransfer.getData("Text");
if(text){
var _1efe=view.getOffsetAtLocation(e.x,e.y);
if(this._dragSelection){
this._dropOffset=_1efe;
this._dropText=text;
}else{
view.setText(text,_1efe,_1efe);
view.setSelection(_1efe,_1efe+text.length);
}
}
}};
return {TextDND:_1ef9};
});
},"url:davinci/ve/actions/templates/AddState.html":"<div>\n\t<div class=\"dijitDialogPaneContentArea\">\n\t\t${veNls.stateLabel}: <input dojoAttachPoint=\"input\" dojoType=\"dijit.form.TextBox\" dojoAttachEvent=\"onKeyUp:_onKeyPress\" type=\"text\"></input>\n\t</div>\n\t\t\t\t\n\t<div class=\"dijitDialogPaneActionBar\">\n\t\t<button dojoType='dijit.form.Button' dojoAttachPoint=\"okButton\" dojoAttachEvent='onClick:onOk' disabled label='${veNls.createLabel}' class=\"maqPrimaryButton\" type=\"submit\"></button>\n\t\t<button dojoType='dijit.form.Button' dojoAttachEvent='onClick:onCancel' label='${commonNls.buttonCancel}' class=\"maqSecondaryButton\"></button>\n\t</div>\n</div>\n","preview/silhouetteiframe":function(){
define("preview/silhouetteiframe",[],function(){
var _1eff=function(args){
var _1f00=this.rootNode=args.rootNode;
if(!_1f00){
return;
}
if(!this.verifyDOMTree(false)){
return;
}
this._isWebKit=navigator.userAgent.indexOf("WebKit")!=-1;
if(args.svgfilename){
this.svgfilename=args.svgfilename;
}
if(args.orientation){
this.orientation=args.orientation;
}
if(args.scalefactor){
this.scalefactor=args.scalefactor;
}
if(args.margin){
this.margin=args.margin;
}
this._silhouette_div_container_orig_style={};
var style=_1f00.style;
for(var i=0;i<style.length;i++){
this._silhouette_div_container_orig_style[style.item(i)]=style[style.item(i)];
}
var _1f01=_1f00.querySelectorAll(".silhouetteiframe_iframe");
if(_1f01.length>0){
this._init_silhouetteiframe_iframe_orig_style();
}else{
this._silhouetteiframe_iframe_orig_style=null;
}
_1f00._silhouetteiframe=this;
this.addStyleDeclarations();
this.updateObjectElement();
};
var _1f02=1;
_1eff.prototype={rootNode:null,svgfilename:undefined,orientation:"portrait",scalefactor:1,margin:0,_object_elem:null,_silhouette_div_container_orig_style:{},_silhouetteiframe_iframe_orig_style:{},_init_silhouetteiframe_iframe_orig_style:function(){
this._silhouetteiframe_iframe_orig_style={};
var _1f03=this.rootNode.querySelectorAll(".silhouetteiframe_iframe")[0];
var style=_1f03.style;
for(var i=0;i<style.length;i++){
this._silhouetteiframe_iframe_orig_style[style.item(i)]=style[style.item(i)];
}
},verifyDOMTree:function(_1f04){
var _1f05=this.rootNode;
if(_1f05&&_1f05.children&&_1f05.children.length){
var _1f06=_1f05.children[0];
if(_1f05.children[0].className==="loading"){
_1f06=_1f05.children[1];
}
}else{
console.error("silhouetteiframe.verifyDOMTree(): no children on rootNode");
return false;
}
if(_1f04){
if(_1f05.children.length<2){
console.error("silhouetteiframe.verifyDOMTree(): iframe child not present");
return false;
}
var _1f07;
if(_1f05.children[0].className==="loading"){
_1f07=_1f05.children[2];
}else{
_1f07=_1f05.children[1];
}
}
if(_1f05.nodeName!="DIV"||_1f05.className.indexOf("silhouette_div_container")==-1||!_1f06||_1f06.nodeName!="SPAN"||_1f06.className.indexOf("silhouetteiframe_object_container")==-1||(_1f04&&(!_1f07||_1f07.nodeName!="IFRAME"||_1f07.className.indexOf("silhouetteiframe_iframe")==-1))){
console.error("silhouetteiframe.verifyDOMTree(): incorrect DOM tree on rootNode");
return false;
}
return true;
},addStyleDeclarations:function(){
var _1f08=document.querySelectorAll("style.silhouetteiframe_styles");
if(_1f08.length==0){
var _1f09=document.querySelectorAll("head")[0];
if(!_1f09){
console.error("silhouetteiframe.js addStyleDeclarations(): no HEAD element");
return;
}
var _1f0a=document.createElement("style");
_1f0a.setAttribute("type","text/css");
_1f0a.setAttribute("class","silhouetteiframe_styles");
_1f0a.innerHTML=".silhouetteiframe_div_container { display:inline-block; text-align:left; }\n"+".silhouetteiframe_iframe { position:absolute; top:0px; left:0px; border:none; }";
_1f09.appendChild(_1f0a);
}
},_restoreStyle:function(style,_1f0b){
if(style){
for(var i=style.length-1;i>=0;i--){
style.removeProperty(style.item(i));
}
if(_1f0b){
for(var i in _1f0b){
style[i]=_1f0b[i];
}
}
}
},updateObjectElement:function(){
var _1f0c=this.rootNode.querySelectorAll(".silhouetteiframe_object_container",this.rootNode);
if(_1f0c.length==0){
return;
}
var _1f0d=_1f0c[0];
_1f0d.innerHTML="";
this.object_elem=null;
if(this.svgfilename){
var _1f0e=this.rootNode;
if(!this.verifyDOMTree(true)){
return;
}
if(this._silhouetteiframe_iframe_orig_style===null){
this._init_silhouetteiframe_iframe_orig_style();
}
_1f0d.innerHTML="<object class=\"silhouetteiframe_object\" data=\""+this.svgfilename+"\" type=\"image/svg+xml\" "+"onload=\"event.target.parentNode.parentNode._silhouetteiframe.svgloadhandler(event.target)\"></object>";
}else{
this._restoreStyle(this.rootNode.style,this._silhouette_div_container_orig_style);
var _1f0f=this.rootNode.querySelectorAll(".silhouetteiframe_iframe",this.rootNode);
if(_1f0f.length>0){
var _1f10=_1f0f[0];
this._restoreStyle(_1f10.style,this._silhouetteiframe_iframe_orig_style);
}
}
},svgloadhandler:function(_1f11){
this._object_elem=_1f11;
var _1f12=_1f11.getSVGDocument();
if(_1f12&&_1f12.documentURI==_1f11.data){
this._loadcounter=null;
this._silhouette_reset_size_position(false);
}else{
if(!this._loadcounter){
this._loadcounter=1;
}else{
if(this._loadcounter>=5){
console.error("svgloadhandler failed after 5 tries");
return;
}
this._loadcounter++;
}
this.rootNode.style.display="none";
var that=this;
setTimeout(function(){
that.rootNode.style.display="block";
that._silhouette_reset_size_position(false);
},1);
}
},setSVGFilename:function(_1f13){
this.svgfilename=_1f13;
this.updateObjectElement();
},setScaleFactor:function(_1f14){
this.scalefactor=_1f14;
if(this._isWebKit){
this.updateObjectElement();
}else{
this._silhouette_reset_size_position(false);
}
},setOrientation:function(_1f15){
this.orientation=_1f15;
this._silhouette_reset_size_position(false);
},_silhouette_reset_size_position:function(_1f16){
var _1f17=this._object_elem;
var _1f18=this.orientation;
var _1f19=this.scalefactor;
if(!_1f17){
return;
}
var _1f1a=_1f17.getSVGDocument();
if(!_1f1a){
return;
}
var _1f1b=_1f1a.documentElement;
var _1f1c=this.rootNode.querySelector(".silhouetteiframe_iframe");
if(!_1f1c){
return;
}
var _1f1d=_1f1a.querySelector("#DeviceRect");
if(!_1f1d){
return;
}
var _1f1e=_1f1a.querySelector("#ScreenRect");
if(!_1f1e){
return;
}
var _1f1f=_1f1a.querySelector("#ResolutionRect");
if(!_1f1f){
}
if(_1f19<=0){
return;
}
var _1f20=this.rootNode;
var _1f21=_1f1d.getAttribute("x")-0;
var _1f22=_1f1d.getAttribute("y")-0;
var _1f23=_1f1d.getAttribute("width")-0;
var _1f24=_1f1d.getAttribute("height")-0;
var _1f25=_1f1e.getAttribute("x")-0;
var _1f26=_1f1e.getAttribute("y")-0;
var _1f27=_1f1e.getAttribute("width")-0;
var _1f28=_1f1e.getAttribute("height")-0;
var _1f29=_1f25-_1f21;
var _1f2a=_1f26-_1f22;
var _1f2b,_1f2c;
if(_1f1f){
var _1f2d=_1f1f.getAttribute("width")-0;
var _1f2e=_1f1f.getAttribute("height")-0;
if(_1f2d>0&&_1f2e>0&&_1f27>0&&_1f28>0){
_1f2b=(_1f2d/_1f27)*_1f19;
_1f2c=(_1f2e/_1f28)*_1f19;
}
}
if(!_1f2b){
var _1f2f=4/3;
_1f2b=_1f2c=_1f2f*_1f19;
}
_1f1d.style.display="none";
_1f1e.style.display="none";
if(_1f1f){
_1f1f.style.display="none";
}
obj_style=_1f17.style;
obj_style.overflow="hidden";
var _1f30=_1f23*_1f2b;
var _1f31=_1f24*_1f2c;
var _1f32=_1f27*_1f2b;
var _1f33=_1f28*_1f2c;
var _1f34=_1f29*_1f2b;
var _1f35="http://www.w3.org/2000/svg";
var _1f36="http://www.w3.org/1999/xlink";
var _1f37="_aqzpqtxv";
var g1_id="g1"+_1f37,g2_id="g2"+_1f37,a1_id="a1"+_1f37,a2_id="a2"+_1f37;
var _1f38=_1f1a.getElementById(g1_id);
var _1f39;
if(_1f38){
_1f39=_1f1a.getElementById(g2_id);
if(!_1f39){
return;
}
}else{
_1f38=_1f1a.createElementNS(_1f35,"g");
_1f38.id=g1_id;
_1f39=_1f1a.createElementNS(_1f35,"g");
_1f39.id=g2_id;
_1f38.appendChild(_1f39);
var _1f3a=null;
for(var i=_1f1b.childNodes.length-1;i>=0;i--){
_1f3a=_1f39.insertBefore(_1f1b.childNodes[i],_1f3a);
}
_1f1b.appendChild(_1f38);
}
var _1f3b=_1f1a.createElementNS(_1f35,"rect");
_1f3b.setAttribute("x",_1f25+1);
_1f3b.setAttribute("y",_1f26+1);
_1f3b.setAttribute("width",_1f27-2);
_1f3b.setAttribute("height",_1f28-2);
_1f3b.setAttribute("fill","lightgray");
_1f39.appendChild(_1f3b);
var _1f3c=_1f20.style;
_1f3c.position="relative";
_1f3c.overflow="hidden";
_1f3c.marginLeft="0px";
_1f3c.marginTop="0px";
var _1f3d=_1f1c.style;
var _1f3e=_1f1c.contentDocument.documentElement;
var _1f3f=_1f3e.style;
var _1f40=_1f1c.contentDocument.body;
var _1f41=_1f40.style;
_1f3f.overflow="hidden";
_1f3d.overflow="hidden";
_1f41.transformOrigin=_1f41.WebkitTransformOrigin=_1f41.MozTransformOrigin=_1f41.msTransformOrigin="left top";
_1f41.transform=_1f41.WebkitTransform=_1f41.MozTransform=_1f41.msTransform="scale("+_1f19+")";
_1f41.width=(100/_1f19)+"%";
_1f41.height=(100/_1f19)+"%";
if(_1f18!=="landscape"){
_1f1b.setAttribute("width",_1f30+"px");
_1f1b.setAttribute("height",_1f31+"px");
_1f1b.setAttribute("viewBox",0+" "+0+" "+_1f30+" "+_1f31);
var _1f42=_1f2a*_1f2c;
_1f3d.marginLeft=_1f34+"px";
_1f3d.marginTop=_1f42+"px";
_1f3d.width=_1f32+"px";
_1f3d.height=_1f33+"px";
_1f38.setAttribute("transform","translate(0 0) rotate(0)");
_1f39.setAttribute("transform","scale("+_1f2b+","+_1f2c+") translate(-"+_1f21+" -"+_1f22+")");
obj_style.width=_1f30+"px";
obj_style.height=_1f31+"px";
_1f3c.width=_1f30+"px";
_1f3c.height=_1f31+"px";
setTimeout(function(){
obj_style.width=Math.ceil(_1f30+1)+"px";
obj_style.height=Math.ceil(_1f31+1)+"px";
},10);
}else{
_1f1b.setAttribute("width",_1f31+"px");
_1f1b.setAttribute("height",_1f30+"px");
_1f1b.setAttribute("viewBox",0+" "+0+" "+_1f31+" "+_1f30);
_1f3d.marginLeft=((_1f24-_1f28-_1f2a)*_1f2c)+"px";
_1f3d.marginTop=_1f34+"px";
_1f3d.width=_1f33+"px";
_1f3d.height=_1f32+"px";
_1f38.setAttribute("transform","translate("+_1f31+" 0) rotate(90)");
_1f39.setAttribute("transform","scale("+_1f2b+","+_1f2c+") translate(-"+_1f21+" -"+_1f22+")");
obj_style.width=_1f31+"px";
obj_style.height=_1f30+"px";
_1f3c.width=_1f31+"px";
_1f3c.height=_1f30+"px";
setTimeout(function(){
obj_style.width=Math.ceil(_1f31+1)+"px";
obj_style.height=Math.ceil(_1f30+1)+"px";
},10);
}
}};
_1eff.themeMap={"android_340x480.svg":"Android","android_480x800.svg":"Android","androidtablet.svg":"Android","bbplaybook.svg":"BlackBerry","blackberry.svg":"BlackBerry","ipad.svg":"iPad","iphone.svg":"iPhone"};
_1eff.themeCssMap={"Android":["android/android.css"],"BlackBerry":["blackberry/blackberry.css"],"iPad":["iphone/iphone.css","iphone/ipad.css"],"iPhone":["iphone/iphone.css"]};
_1eff.getMobileTheme=function(_1f43){
return _1eff.themeMap[_1f43.split("/").pop()];
};
_1eff.getMobileCss=function(theme){
return _1eff.themeCssMap[theme||"iPhone"];
};
return _1eff;
});
},"davinci/model/resource/Marker":function(){
define(["dojo/_base/declare","davinci/model/resource/Resource"],function(_1f44,_1f45){
return _1f44("davinci.model.resource.Marker",_1f45,{constructor:function(_1f46,type,line,text){
this.resource=_1f46;
this.type=type;
this.line=line;
this.text=text;
}});
});
},"davinci/repositoryinfo":function(){
define({revision:"f940814741d832335cf203555c0e7236f56925ad",buildtime:"2012-09-11T17:35:21Z"});
},"davinci/UserActivityMonitor":function(){
define(["dojo/i18n!./nls/webContent"],function(_1f47){
var _1f48={subscriptions:[],subscribe:function(topic,func){
this.subscriptions.push(dojo.subscribe(topic,this,func));
},destroy:function(){
dojo.forEach(this.subscriptions,dojo.unsubscribe);
},setUpInActivityMonitor:function(doc){
if(!this._runtime){
try{
this._runtime=require("davinci/Runtime");
}
catch(e){
console.warn("FAILED: failure for loading davinci/Runtime");
return;
}
}
if(this._runtime.singleUserMode()){
this._MaxInactiveInterval=-1;
}else{
this._firstPoll=true;
this._MaxInactiveInterval=60*5;
this.keepAlive();
this.addInActivityMonitor(doc);
this.subscribe("/dojo/io/load",this.lastServerConnection);
this.userActivity();
}
},addInActivityMonitor:function(doc){
if(this._MaxInactiveInterval===-1){
return [];
}else{
var _1f49=[dojo.connect(doc.documentElement,"keydown",this,"userActivity"),dojo.connect(doc.documentElement,"mousedown",this,"userActivity")];
return _1f49;
}
},userActivity:function(e){
if(this.countdown){
this.resetIdle();
}
if(this._idleTimer){
window.clearTimeout(this._idleTimer);
}
if(this._MaxInactiveInterval>0){
var t=(this._MaxInactiveInterval*1000);
this._idleTimer=window.setTimeout(function(){
this.idle();
}.bind(this),t);
}
},keepAlive:function(){
var _1f4a=dojo.xhrGet({url:"cmd/keepalive",sync:false,handleAs:"json",});
_1f4a.then(function(_1f4b){
if(_1f4b.MaxInactiveInterval){
this._MaxInactiveInterval=_1f4b.MaxInactiveInterval;
if(this._firstPoll){
delete this._firstPoll;
this.userActivity(null);
}
}else{
console.warn("Unknown error: result="+_1f4b);
}
}.bind(this),function(error){
console.warn("MaxInactiveInterval error",error);
});
},lastServerConnection:function(_1f4c,_1f4d){
if(this._serverPollTimer){
window.clearTimeout(this._serverPollTimer);
}
if(this._MaxInactiveInterval>0){
t=((this._MaxInactiveInterval*1000)*0.8);
this._serverPollTimer=window.setTimeout(function(){
this.keepAlive();
}.bind(this),t);
}
},idle:function(){
var _1f4e=30;
var app=dojo.byId("davinci_app");
var _1f4f=dojo.doc.createElement("div");
_1f4f.id="org.maqetta.idleWarning";
app.appendChild(_1f4f);
_1f4f.setAttribute("class","idleWarning");
_1f4f.innerHTML=dojo.string.substitute(_1f47.idleSessionMessage,{seconds:_1f4e});
this.countdown=window.setInterval(function(){
if(--_1f4e===0){
window.clearInterval(this.countdown);
delete this.countdown;
this._runtime.logoff();
}else{
var span=dojo.byId("org.maqetta.idleWarning");
span.innerHTML=dojo.string.substitute(_1f47.idleSessionMessage,{seconds:_1f4e});
}
}.bind(this),1000);
},resetIdle:function(e){
window.clearInterval(this.countdown);
delete this.countdown;
var _1f50=dojo.byId("org.maqetta.idleWarning");
_1f50.parentNode.removeChild(_1f50);
this.userActivity();
}};
return _1f48;
});
},"davinci/ve/actions/MoveForwardAction":function(){
define(["dojo/_base/declare","./_ReorderAction","davinci/commands/CompoundCommand","davinci/ve/commands/ReparentCommand"],function(_1f51,_1f52,_1f53,_1f54){
return _1f51("davinci.ve.actions.MoveForwardAction",[_1f52],{name:"MoveForward",iconClass:"editActionIcon editMoveForwardIcon",run:function(_1f55){
_1f55=this.fixupContext(_1f55);
if(!_1f55){
return;
}
var _1f56=(_1f55&&_1f55.getSelection)?_1f55.getSelection():[];
if(_1f56.length===0){
return;
}
if(!this.selectionSameParentAllAbsoluteAdjacent(_1f56)){
return;
}
var _1f57;
var _1f58=_1f56[0].getParent();
var _1f59=_1f58.getChildren();
var _1f5a=this.getAbsoluteSiblings(_1f56[0]);
var _1f5b=new _1f53();
var _1f5c=_1f56.slice(0);
for(var j=0;j<_1f5a.length;j++){
_1f57=_1f5a[j];
var _1f5d=_1f5c.indexOf(_1f57);
if(_1f5d>=0){
_1f5c.splice(_1f5d,1);
}else{
if(_1f5c.length===0){
break;
}
}
}
var index=_1f59.indexOf(_1f57)+1;
for(var i=0;i<_1f5a.length;i++){
_1f57=_1f5a[i];
if(_1f56.indexOf(_1f57)>=0){
_1f5b.add(new _1f54(_1f57,_1f58,index));
}
}
_1f55.getCommandStack().execute(_1f5b);
},isEnabled:function(_1f5e){
_1f5e=this.fixupContext(_1f5e);
var _1f5f=(_1f5e&&_1f5e.getSelection)?_1f5e.getSelection():[];
if(_1f5f.length===0){
return false;
}
if(!this.selectionSameParentAllAbsoluteAdjacent(_1f5f)){
return false;
}
var _1f60=this.getAbsoluteSiblings(_1f5f[0]);
for(var j=0;j<_1f5f.length;j++){
var _1f61=_1f5f[j];
if(_1f60.indexOf(_1f61)<_1f60.length-_1f5f.length){
return true;
}
}
return false;
}});
});
},"url:davinci/ui/templates/SaveAsWidgetForm.html":"<div class='dvSaveAsWidgetForm'>\n\t<div class=\"dijitDialogPaneContentArea\">\n\t\t<p class=\"dvSawfDesc\">${descriptionString}</p>\n\t\t<p>\n\t\t\t<span class=\"dvSawfLabel\">${nameString}:</span>\n\t\t\t<input dojoType='dijit.form.ValidationTextBox' dojoAttachPoint=\"nameInputNode\" trim=\"true\"\n\t\t\t\t\tpromptMessage=\"${namePromptString}\"></input>\n\t\t</p>\n\t\t<p>\n\t\t\t<span class=\"dvSawfLabel\"><span class=\"dvRequired\">*</span>${idString}:</span>\n\t\t\t<input dojoType='dijit.form.ValidationTextBox' dojoAttachPoint=\"idInputNode\" trim=\"true\"\n\t\t\t\t\trequired=\"true\" intermediateChanges=\"true\" promptMessage=\"${idPromptString}\"></input>\n\t\t</p>\n\t\t<p>\n\t\t\t<span class=\"dvSawfLabel\">${versionString}:</span>\n\t\t\t<input dojoType='dijit.form.ValidationTextBox' dojoAttachPoint=\"versionInputNode\"\n\t\t\t\t\ttrim=\"true\"></input>\n\t\t</p>\n\t\t<h4 class=\"dvRequired\">*${requiredString}</h4>\n\t\n\t\t<div dojoType=\"dijit.TitlePane\" title=\"${metadataTitle}\" open=\"false\">\n\t\t\t<textarea dojoType=\"dijit.form.SimpleTextarea\" dojoAttachPoint=\"textareaNode\" name=\"metadata\"\n\t\t\t\t\trows=\"15\" cols=\"50\" intermediateChanges=\"true\">${initialTextareaContent}</textarea>\n\t\t</div>\n\t</div>\n  <div class=\"dijitDialogPaneActionBar\">\n    <button dojoType=\"dijit.form.Button\" dojoAttachPoint=\"buttonSave\" class=\"maqPrimaryButton\" type=\"submit\" disabled=\"true\">${saveString}</button>\n    <button dojoType=\"dijit.form.Button\" dojoAttachPoint=\"buttonCancel\" type=\"button\" class=\"maqSecondaryButton\">${cancelString}</button>\n  </div>\n</div>\n","davinci/de/DijitTemplatedGenerator":function(){
define(["dojo/_base/declare","davinci/model/Path","davinci/ve/metadata"],function(_1f62,Path,_1f63){
return _1f62("davinci.de.DijitTemplatedGenerator",null,{constructor:function(args){
dojo.mixin(this,args);
},buildSource:function(model,_1f64,_1f65,_1f66,_1f67,_1f68){
this.value={js:"",metadata:"",amd:["dojo/_base/declare","dijit/_Widget","dijit/_Templated"]};
this.metadata={id:_1f64,name:_1f64,spec:"1.0",version:"1.0",require:[],library:{dojo:{src:"../../../../dojo/dojo.js"}}};
this.model=this._srcDocument=model;
var _1f69=_1f68[0]._srcElement;
var _1f6a="./"+_1f65+".html";
if(!_1f66){
this.value.amd.push("dojo/text!"+_1f6a.toString());
this.value.htmlPath=_1f6a;
}
var _1f6b=_1f69.find({"elementType":"HTMLElement"});
_1f6b.push(_1f69);
this.loadRequires("html.body",true,true,true);
for(var i=0;i<_1f6b.length;i++){
var n=_1f6b[i];
var type=n.getAttribute("data-dojo-type")||n.getAttribute("dojoType")||n.getAttribute("dvwidget");
if(type!=null){
this.loadRequires(type,true,true,true);
}
}
this.metadata.require.push({$library:"dojo",format:"amd",src:"widgets/"+_1f64.replace(/\./g,"/"),type:"javascript-module"});
this.value.html="";
this.value.html+=_1f69.getText();
this.value.html+="";
var _1f6c=3;
this.metadata.content="<div></div>";
this.value.js="define([";
for(var i=0;i<this.value.amd.length;i++){
this.value.js+="'"+this.value.amd[i]+"'";
if(i+1<this.value.amd.length){
this.value.js+=",\n";
}
}
this.value.js+="\n],function(";
for(var i=0;i<_1f6c;i++){
var _1f6d=this.value.amd[i].split("/");
var _1f6e=_1f6d[_1f6d.length-1];
this.value.js+=_1f6e;
if(i+1<_1f6c){
this.value.js+=",";
}
}
if(!_1f66){
this.value.js+=",templateString";
}
this.value.js+="){\n\n";
this.value.js+=" return declare('"+_1f64+"',[ _Widget, _Templated";
this.value.js+="], {\n";
this.value.js+="       widgetsInTemplate:true,\n";
if(!_1f66){
this.value.js+="       templateString:templateString";
}else{
this.value.js+="       templateString:'"+this.escapeHtml(this.value.html)+"'";
delete this.value.html;
}
this.value.js+="   \n});";
this.value.js+="\n});";
this.value.metadata=dojo.toJson(this.metadata);
return this.value;
},escapeHtml:function(text){
var _1f6f=text.replace(/"/g,"\\\"");
_1f6f=_1f6f.replace(/\n/g,"");
return _1f6f;
},addMetaData:function(row){
for(var i=0;i<this.metadata.require.length;i++){
var m=this.metadata.require[i];
if(m.$library==row.$library&&m.src==row.src&&m.type==row.type&&m.format==row.format){
return;
}
}
this.metadata.require.push(row);
},loadRequires:function(type,_1f70,_1f71,_1f72){
if(!type){
return false;
}
var _1f73=_1f63.query(type,"require");
if(!_1f73){
return true;
}
_1f73.every(function(r){
this.addMetaData(r);
return;
switch(r.type){
case "javascript":
break;
case "javascript-module":
if(r.format!=="amd"){
console.error("Unknown javascript-module format");
}
if(r.src){
this.value.amd.push(r.src);
}else{
console.error("Inline 'javascript-module' not handled");
}
break;
case "css":
if(r.src){
}else{
console.error("Inline CSS not handled");
}
break;
case "image":
break;
default:
console.error("Unhandled metadata resource type '"+r.type+"' for widget '"+type+"'");
}
return true;
},this);
}});
});
},"davinci/html/CSSRule":function(){
define("davinci/html/CSSRule",["dojo/_base/declare","davinci/html/CSSElement","davinci/html/CSSParser","davinci/html/CSSProperty"],function(_1f74,_1f75,_1f76,_1f77){
return _1f74("davinci.html.CSSRule",_1f75,{constructor:function(){
this.elementType="CSSRule";
this.selectors=[];
this.properties=[];
},getText:function(_1f78){
var s="";
_1f78=_1f78||[];
if(this.comment&&!_1f78.noComments){
s+=this.comment.getText(_1f78);
}
s+=this.getSelectorText(_1f78);
s=s+" {";
for(var i=0;i<this.properties.length;i++){
s=s+"\n    "+this.properties[i].getText(_1f78);
}
s=s+"\n}\n";
if(this.postComment&&!_1f78.noComments){
s+=this.postComment.getText(_1f78);
}
return s;
},setText:function(text){
var _1f79={xmode:"style",css:true};
var _1f7a=require("davinci/html/CSSParser").parse(text,this);
dojo.mixin(this,this.children[0]);
var _1f7b=(this.parent)?this.parent.endOffset:0;
this.startOffset=_1f7b+1;
this.setDirty(true);
},addProperty:function(name,value){
var _1f7c=new _1f77(name,value,this);
this.properties.push(_1f7c);
this.setDirty(true);
this.onChange();
},insertProperty:function(name,value,_1f7d){
var _1f7e;
_1f7e=this.getProperty(name);
if(_1f7e){
this.removeProperty(name);
}
_1f7e=new _1f77(name,value,this);
this.properties.splice(_1f7d,0,_1f7e);
this.setDirty(true);
this.onChange();
},getSelectorText:function(_1f7f){
var s="";
for(var i=0;i<this.selectors.length;i++){
if(i>0){
s=s+", ";
}
s=s+this.selectors[i].getText(_1f7f);
}
return s;
},matches:function(_1f80){
_1f80=this._convertNode(_1f80);
var _1f81;
for(var i=0;i<this.selectors.length;i++){
if((_1f81=this.selectors[i].matches(_1f80))>=0){
return _1f81;
}
}
},visit:function(_1f82){
if(!_1f82.visit(this)){
for(var i=0;i<this.children.length;i++){
this.children[i].visit(_1f82);
}
for(var i=0;i<this.selectors.length;i++){
this.selectors[i].visit(_1f82);
}
}
if(_1f82.endVisit){
_1f82.endVisit(this);
}
},hasSelector:function(_1f83){
for(var i=0;i<this.selectors.length;i++){
if(this.selectors[i].getLabel()==_1f83){
return true;
}
}
return false;
},matchesSelectors:function(_1f84){
for(var j=0;j<_1f84.length;j++){
for(var i=0;i<this.selectors.length;i++){
if(this.selectors[i].matchesSelector(_1f84[j])){
return true;
}
}
}
return false;
},getCSSRule:function(){
return this;
},getLabel:function(){
return this.getSelectorText({});
},getProperty:function(_1f85){
for(var i=0;i<this.properties.length;i++){
if(_1f85==this.properties[i].name){
return this.properties[i];
}
}
},hasProperty:function(_1f86){
for(var i=0;i<this.properties.length;i++){
if(_1f86==this.properties[i].name){
return true;
}
}
},getProperties:function(_1f87){
var _1f88=[];
for(var i=0;i<this.properties.length;i++){
if(!_1f87||_1f87==this.properties[i].name){
_1f88.push(this.properties[i]);
}
}
return _1f88;
},setProperty:function(name,value){
var _1f89=this.getProperty(name);
if(!value){
this.removeProperty(name);
}else{
if(_1f89){
_1f89.value=value;
}else{
_1f89=new _1f77();
_1f89.name=name;
_1f89.value=value;
this.properties.push(_1f89);
_1f89.parent=this;
}
}
this.setDirty(true);
this.onChange();
},removeProperty:function(_1f8a){
for(var i=0;i<this.properties.length;i++){
if(_1f8a==this.properties[i].name){
this.properties.splice(i,1);
}
}
this.setDirty(true);
this.onChange();
},removeAllProperties:function(){
this.properties=[];
this.setDirty(true);
this.onChange();
},removeStyleValues:function(_1f8b){
var _1f8c=[];
for(var i=0;i<this.properties.length;i++){
var found;
for(var j=0;j<_1f8b.length&&!found;j++){
found=_1f8b[j]==this.properties[i].name;
}
if(!found){
_1f8c=this.properties[i];
}
}
this.properties=_1f8c;
this.setDirty(true);
this.onChange();
}});
});
},"davinci/ve/widgets/Cascade":function(){
define("davinci/ve/widgets/Cascade",["dojo/_base/declare","../../workbench/WidgetLite","../../workbench/Preferences","../../Workbench","../../html/CSSModel","../../ui/widgets/DocileDialog","../States","dojo/i18n!../nls/ve","system/resource"],function(_1f8d,_1f8e,_1f8f,_1f90,_1f91,_1f92,_1f93,veNLS,_1f94){
var _1f95=_1f8d("davinci.ve.widgets.Cascade",[_1f8e],{target:null,targetField:null,toggleClasses:null,_regex_combinators:/[\s\~\+\>]+/,_regex_not_pseudoclass:/(.*)\:not\((.*)\)(.*)/,_regex_pseudoelement:/(.*)(\:\:[^\:\.\#\[]*)(.*)/,_regex_id:/(.*)(\#[^\:\.\#\[]*)(.*)/,_regex_class:/(.*)(\.[^\:\.\#\[]*)(.*)/,_regex_attribute:/(.*)(\[[^\]]*\])(.*)/,_regex_pseudoclass:/(.*)(\:[^\:\.\#\[]*)(.*)/,_regex_univeral:/(.*)(\*[^\:\.\#\[]*)(.*)/,constructor:function(_1f96,_1f97){
this.subscriptions=[];
this.publishing={};
this._radioGroupName="davinci_ve_widgets_Cascade"+(davinci.ve.widgets.Cascade.__id++);
this._handles=[];
this.inherited(arguments);
},buildRendering:function(){
this.domNode=dojo.doc.createElement("div");
this.container=dojo.doc.createElement("div");
dojo.addClass(this.container,"showCascade");
this.domNode.appendChild(this.container);
this.topDiv=dojo.create("div",{"class":"cascadeTopDiv"},this.container);
this.cascadeTableDiv=dojo.create("div",{"class":"cascadeTableDiv"},this.container);
dojo.removeClass(this.container,"showAllValues");
if(!dojo.isArray(this.target)){
this.target=[this.target];
}
dojo.addClass(this.domNode,"CascadeTop");
this.inherited(arguments);
},startup:function(){
var _1f98=dijit.byId(this.targetField);
if(_1f98){
_1f98._cascade=this;
this._getFieldValue=function(){
return _1f98.get("value");
};
this._setFieldValue=function(value,loc){
if(!_1f98.set){
return;
}
this._value=value||"";
this._loc=loc;
if(_1f98._setBaseLocationAttr){
_1f98.set("baseLocation",(loc&&loc.getPath)?loc.getPath():null);
}
_1f98.set("value",this._value,true);
};
dojo.connect(_1f98,"onChange",this,"_onFieldChange");
dojo.connect(_1f98,"onFocus",this,"_onFieldFocus");
dojo.connect(_1f98,"onBlur",this,"_onFieldBlur");
}else{
var node=dojo.byId(this.targetField);
this._getFieldValue=function(){
return dojo.attr(node,"value");
};
this._setFieldValue=function(value,_1f99){
this._value=value||"";
this._loc=_1f99;
dojo.attr(node,"value",this._value);
};
dojo.connect(node,"onchange",this,"_onFieldChange",true);
dojo.connect(node,"onfocus",this,"_onFieldFocus",true);
dojo.connect(node,"onblur",this,"_onFieldBlur",true);
}
this._value=this._getFieldValue();
this._started=true;
},_canModifyRule:function(_1f9a){
if(!_1f9a||!_1f9a.getCSSFile){
return true;
}
var _1f9b=_1f9a.getCSSFile();
if(_1f9b==null){
return true;
}
var _1f9c=_1f9b.getResource();
return !_1f9c.readOnly();
},_onFieldChange:function(){
var _1f9d=function(arr1,arr2){
if(!arr1&&!arr2){
return true;
}
if((!arr1&&arr2)||(arr1&&!arr2)){
return false;
}
if(arr1.length!=arr2.length){
return false;
}
for(var i=0;i<arr1.length;i++){
if(arr1[i]!==arr2[i]){
return false;
}
}
return true;
};
if(this.context){
this.context.blockChange(false);
}
if(this._value==this._getFieldValue()&&_1f9d(this._valueArray,this._valueArrayNew)){
return;
}
if(this._getFieldValue()=="(overrides)"){
if(this._setFieldValue){
this._setFieldValue("(overrides)",null);
}
return;
}
if(typeof this._targetValueIndex!="number"){
return;
}
var _1f9e=_1f8f.getPreferences("davinci.ve.editorPrefs",_1f90.getProject());
if(this._widget&&this.target&&this.target.length>0){
var _1f9f=this.target[0];
var _1fa0=this._widget.getContext();
var _1fa1;
if(_1fa0){
_1fa1=_1fa0.cascadeBatch;
}
if(_1fa1){
var _1fa2=_1fa1.askUserResponse;
if(_1fa1.deferreds){
var _1fa3=_1fa1.deferreds;
}
}
}
function _1fa4(){
if(_1f9f&&_1fa3&&_1fa3[_1f9f]){
_1fa3[_1f9f].resolve();
}
};
function _1fa5(that){
that._value=that._getFieldValue();
that._valueArray=that._valueArrayNew;
var value=(that._valueArray&&dojo.isArray(that._valueArray)&&that._valueArray.length>0)?that._valueArray:that._value;
that._changeValue(that._targetValueIndex,value);
};
if(_1fa2===false){
this._setFieldValue(this._value,this._loc);
_1fa4();
}else{
if(_1fa2===true){
_1fa5(this);
_1fa4();
}else{
var _1fa6=false;
var _1fa7=null;
var _1fa8=veNLS;
if(this._values[this._targetValueIndex].readOnly&&this._editor.editorID!="davinci.themeEdit.ThemeEditor"){
var _1fa9="<a href='app/docs/index.html#CreatingStyleRulesWithAppCss' target='_blank'>"+_1fa8.creatingStyleRules+"</a>";
var _1fa7=_1fa8.propChangeCannotComplete+"<br><br>"+dojo.string.substitute(_1fa8.toChangeProperty,[_1fa9])+"<br/><br/>";
davinci.Workbench.showMessage(_1fa8.errorModifyingValue,_1fa7,{width:350},dojo.hitch(this,function(){
_1fa4();
return true;
}));
if(_1fa1){
_1fa1.askUserResponse=false;
}
this._setFieldValue(this._value,this._loc);
}else{
if((this._values[this._targetValueIndex].type=="theme"||this._values[this._targetValueIndex].proposalTarget=="theme")&&_1f9e.cssOverrideWarn&&this._editor.supports("MultiPropTarget")){
require(["davinci/ve/widgets/ChangeWillModify"],dojo.hitch(this,function(_1faa){
function _1fab(){
if(_1fa1){
_1fa1.askUserResponse=true;
}
_1fa5(this);
_1fa4();
if(cwm.checkbox.get("checked")){
_1f9e.cssOverrideWarn=false;
_1f8f.savePreferences("davinci.ve.editorPrefs",null,_1f9e);
}
};
var cwm=new _1faa();
var _1fac=davinci.Workbench.showDialog("",cwm,{width:350},dojo.hitch(this,_1fab),null,null,true);
dojo.connect(_1fac,"onCancel",dojo.hitch(this,function(){
if(_1fa1){
_1fa1.askUserResponse=false;
}
this._setFieldValue(this._value,this._loc);
_1fa4();
if(cwm.checkbox.get("checked")){
_1f9e.cssOverrideWarn=false;
_1f8f.savePreferences("davinci.ve.editorPrefs",null,_1f9e);
}
}));
}));
}else{
_1fa5(this);
_1fa4();
}
}
}
}
},_changeValue:function(_1fad,value){
var _1fae=undefined;
if(this._whichStateInputElement&&this._whichStateInputElement.checked){
_1fae=this._whichState;
}
var _1faf=this._values[_1fad];
var _1fb0=[];
for(var i=0;i<this.target.length;i++){
if(dojo.isArray(value)){
for(var k=0;k<value.length;k++){
var a={};
a[this.target[i]]=value[k];
_1fb0.push(a);
}
}else{
var a={};
a[this.target[i]]=value;
_1fb0.push(a);
}
}
this._dirtyCascadeList=true;
if(_1faf.type=="element.style"){
if(this.target[0]=="position"&&_1fb0.length==1){
if(_1fb0[0]["position"]=="absolute"){
var _1fb1=this.context.getPreference("absoluteWidgetsZindex");
_1fb0.push({"z-index":_1fb1});
}else{
_1fb0.push({"z-index":""});
}
}
dojo.publish("/davinci/ui/styleValuesChange",[{values:_1fb0,appliesTo:"inline",applyToWhichStates:_1fae}]);
}else{
dojo.publish("/davinci/ui/styleValuesChange",[{values:_1fb0,appliesTo:_1faf,applyToWhichStates:_1fae}]);
}
},_getAttribStyleValue:function(){
return this.context.getStyleAttributeValues(this._widget);
},_getShortHands:function(){
if(this._shorthands){
return this._shorthands;
}
this._shorthands=[];
for(var i=0;i<this.target.length;i++){
this._buildShortHands(this.target[i]);
}
return this._shorthands;
},_buildShortHands:function(_1fb2){
var _1fb3=false;
for(var j=0;j<_1f91.shorthand.length;j++){
if(_1fb2==_1f91.shorthand[j][0]){
_1fb3=true;
break;
}
}
if(_1fb3){
var _1fb4=_1f91.shorthand[j][1];
for(var i=0;i<_1fb4.length;i++){
var found=false;
for(var j=0;j<this._shorthands.length&&!found;j++){
if(this._shorthands[j]==_1fb4[i]){
found=true;
}
}
if(!found){
this._shorthands.push(_1fb4[i]);
}
this._buildShortHands(_1fb4[i]);
}
}
return this._shorthands;
},_onChangeOverride:function(e){
alert(veNLS.valueIsOverriden);
return false;
},_getAllRules:function(){
function _1fb5(rule){
if(rule&&rule.parent&&rule.parent.url){
var url=rule.parent.url;
if(/^themes\//.test(url)||/\/themes\//.test(url)){
return "theme";
}else{
return "queried";
}
}
};
var _1fb6=[];
if(this._editor.editorID!="davinci.themeEdit.ThemeEditor"){
var _1fb7=this._getDefaultSelection();
if(this._editor.supports("inline-style")&&(_1fb7=="element.style")){
var _1fb8=this._getAttribStyleValue();
var value=null;
for(var _1fb9=0;_1fb9<_1fb8.length;_1fb9++){
var vItem=_1fb8[_1fb9];
for(var t=0;t<this.target.length;t++){
var name=this.target[t];
if(vItem[name]!==undefined){
value=vItem[name];
}
}
}
_1fb6.push({rule:_1fb8,value:value,matchLevel:"element.style",type:"element.style"});
}
var v=this.context.getSelectionCssRules(this._topWidgetDom);
if(v&&v.rules){
for(var i=0;i<v.rules.length;i++){
var s="";
var rule=v.rules[i];
for(var j=0;j<rule.selectors.length;j++){
if(j!=0){
s+=", ";
}
s+=rule.selectors[j].getLabel();
}
var _1fba=_1fb5(rule);
_1fb6.push({rule:v.rules[i],ruleString:s,matchLevel:v.matchLevels[i],type:_1fba});
}
}
var _1fbb=this._addDeltaRules(this._widget,_1fb6);
var _1fbc=this._getClasses(this._widget);
var _1fbd=0;
for(var i=0;i<_1fbc.length;i++){
var _1fbe=_1fbc[i];
if(typeof _1fbe=="string"&&_1fbe.length>0){
var _1fbf=this._getClassSelector(_1fbe);
_1fbf.forEach(function(_1fc0){
var _1fc1=false;
for(var j=0;j<_1fb6.length;j++){
if(this._compareSelectors(_1fb6[j].ruleString,_1fc0)){
_1fb6[j].className=_1fbe;
_1fc1=true;
break;
}
}
if(!_1fc1){
var _1fc2=this._computeMatchLevelSelector(_1fc0);
_1fb6.splice(_1fbd,0,{rule:null,ruleString:_1fc0,targetFile:this.targetFile,className:_1fbe,value:null,matchLevel:_1fc2,type:"proposal"});
_1fbd++;
}
}.bind(this));
}
}
}
if(this._editor.editorID=="davinci.themeEdit.ThemeEditor"){
v=this._editor._getCssRules(this._widget,this._editor._selectedSubWidget,this._editor._currentState);
if(v){
var t=[];
for(var x=v.length-1;x>-1;--x){
t.push(v[x]);
}
v=t;
}
}else{
if(this._widget){
v=this.context.getMetaTargets(this._widget,this.target);
}else{
v=[];
}
}
for(var i=0;i<v.length;i++){
var found=false;
for(var k=0;!found&&k<_1fb6.length;k++){
if(_1fb6[k].rule==v[i]){
found=true;
_1fb6[k].type="theme";
}
}
if(!found){
_1fb6.push({rule:v[i],matchLevel:"theme",type:"theme"});
}
}
return _1fb6;
},_buildCssRuleset:function(){
var _1fc3=this._getAllRules();
this._values=[];
this._hasOverride=false;
var _1fc4=this.target[0];
var _1fc5=this._getShortHands();
for(var i=0;i<_1fc3.length;i++){
var rule=_1fc3[i].rule;
if(rule){
for(var k=0;k<_1fc5.length;k++){
if(_1fc3[i].type!="element.style"&&_1fc3[i].rule.getProperty(_1fc5[k])!=null){
_1fc3[i].shorthand=_1fc5[k];
var prop=rule.getProperty(_1fc5[k]);
_1fc3[i].value=prop&&prop.value;
this._hasOverride=true;
}else{
if(_1fc3[i].type=="element.style"&&dojo.indexOf(_1fc3[i].rule,_1fc5[k])>-1){
_1fc3[i].shorthand=_1fc5[k];
var index=dojo.indexOf(_1fc3[i].rule,_1fc5[k]);
_1fc3[i].value=rule[index];
this._hasOverride=true;
}
}
}
if(!_1fc3[i].shorthand&&_1fc3[i].type!="element.style"){
_1fc3[i].value=this._getRuleTargetValue(rule);
}else{
if(!_1fc3[i].shorthand&&_1fc3[i].type=="element.style"){
for(var kk=0;kk<rule.length;kk++){
if(rule[kk].hasOwnProperty(this.target[0])){
_1fc3[i].value=rule[kk][this.target[0]];
}
}
}
}
}else{
}
}
_1fc3=this._sortRules(_1fc3);
this._addClasses(_1fc3);
this._values=_1fc3;
},_sortRules:function(rules){
var _1fc6=[];
for(var i=0;i<rules.length;i++){
var _1fc7=false;
if(rules[i].type=="element.style"){
_1fc6.splice(0,0,rules[i]);
_1fc7=true;
}
for(var k=0;!_1fc7&&k<_1fc6.length;k++){
if(_1fc6[k].matchLevel!="element.style"&&_1fc6[k].matchLevel<rules[i].matchLevel){
_1fc7=true;
_1fc6.splice(k,0,rules[i]);
}
}
if(!_1fc7){
_1fc6.push(rules[i]);
}
}
return _1fc6;
},_addClasses:function(rules){
var value=null;
var _1fc8=false;
for(var i=0;i<rules.length;i++){
rules[i].extraClass=[];
if(_1fc8){
rules[i].extraClass.push("cssShorthandOverRidden");
}
if(rules[i].value||(rules[i].type!="element.style"&&this._getRuleTargetValue(rules[i].rule))){
_1fc8=true;
}else{
if(!rules[i].value&&rules[i].type!="element.style"){
rules[i].extraClass.push("hiddenCascadeNode");
}
}
if(rules[i].type=="element.style"&&!rules[i].value){
rules[i].extraClass.push("elementStyleNode");
}
if(!this._canModifyRule(rules[i].rule)){
rules[i].extraClass.push("readOnlyRule");
rules[i].readOnly=true;
}
}
},_updateCascadeList:function(){
if(this._setFieldValue){
this._setFieldValue("",null);
}
if(!this._widget||!this._widget.domNode){
dojo.addClass(this.container,"dijitHidden");
return;
}
dojo.removeClass(this.container,"dijitHidden");
this._buildCssRuleset();
function _1fc9(_1fca){
return function(){
return this._onChange({target:_1fca});
};
};
function _1fcb(_1fcc){
return function(){
return this._onChangeRemove({target:_1fcc});
};
};
this._destroy();
var table=dojo.doc.createElement("table");
dojo.addClass(table,"cascadeTable");
var row=null;
var _1fcd=null;
row=dojo.doc.createElement("tr");
row.className="propApplyToLabelRow";
_1fcd=dojo.doc.createElement("td");
_1fcd.colSpan="3";
_1fcd.innerHTML=veNLS.applyToWhich;
_1fcd.className="propApplyToLabelCell";
row.appendChild(_1fcd);
table.appendChild(row);
this._radio=[];
for(var i=0;i<this._values.length;i++){
var _1fce=this._formatRuleString(this._values[i]);
this._radio.push(dojo.create("input",{type:"radio",name:this._radioGroupName}));
row=dojo.doc.createElement("tr");
for(var j=0;j<this._values[i].extraClass.length;j++){
dojo.addClass(row,this._values[i].extraClass[j]);
}
_1fcd=dojo.doc.createElement("td");
row.appendChild(_1fcd);
dojo.addClass(_1fcd,"cascadeSpacer");
_1fcd=dojo.doc.createElement("td");
dojo.addClass(_1fcd,"cascadeButton");
_1fcd.appendChild(this._radio[this._radio.length-1]);
row.appendChild(_1fcd);
_1fcd=dojo.doc.createElement("td");
dojo.addClass(_1fcd,"cascadText");
_1fcd.innerHTML="<div class='cascadeRuleText'>"+_1fce+"</div>";
if(!this._values[i].shorthand){
this._handles.push(dojo.connect(this._radio[this._radio.length-1],"onclick",this,_1fc9(i)));
}else{
this._handles.push(dojo.connect(this._radio[this._radio.length-1],"onclick",this,"_onChangeOverride"));
}
if(this._values[i].shorthand){
_1fcd.innerHTML+="<div>"+this._values[i].shorthand+":"+this._values[i].value+";"+"</div>";
}else{
if(this._values[i].value){
var _1fcf="";
for(var j=0;j<this.target.length;j++){
_1fcf+=this.target[j]+(j-1==this.target.length?",":"");
}
_1fcd.innerHTML+="<div class='ruleValue'>"+this.target[0]+":"+this._values[i].value+";"+"</div>";
}
}
row.appendChild(_1fcd);
_1fcd=dojo.doc.createElement("td");
dojo.addClass(_1fcd,"cascadRemove");
var _1fd0=dojo.doc.createElement("button");
if(this._values[i].readOnly){
dojo.attr(_1fd0,"disabled","true");
}
dojo.addClass(_1fd0,"cascadeRemoveButton");
_1fcd.appendChild(_1fd0);
this._handles.push(dojo.connect(_1fd0,"onclick",this,_1fcb(i)));
row.appendChild(_1fcd);
_1fcd=dojo.doc.createElement("td");
_1fcd.className="cascadeSpacer";
row.appendChild(_1fcd);
table.appendChild(row);
}
this._widgetState=this._whichStateInputElement=undefined;
var _1fd1=veNLS;
var node=this._widget.domNode;
var _1fd2=_1f93.getStatesListCurrent(node);
for(var i=0;i<_1fd2.length;i++){
if(_1fd2[i]){
var state=_1fd2[i];
row=dojo.doc.createElement("tr");
row.className="propWhichStateRow";
_1fcd=dojo.doc.createElement("td");
_1fcd.colSpan="3";
var _1fd3=dojo.create("input",{type:"checkbox",checked:false,className:"propWhichStateInput"});
this._whichState=state;
this._whichStateInputElement=_1fd3;
_1fcd.appendChild(_1fd3);
var _1fd4=dojo.create("label",{className:"propWhichStateLabel"});
_1fd4.innerHTML=dojo.string.substitute(_1fd1.onlyApplyToState,[state]);
_1fcd.appendChild(_1fd4);
_1fcd.className="propWhichStateCell";
row.appendChild(_1fcd);
table.appendChild(row);
break;
}
}
this.cascadeTableDiv.appendChild(table);
this._updateFieldValue();
},selectRule:function(rule){
for(var i=0;i<this._values.length;i++){
if(rule!="element.style"&&this._values[i].rule==rule){
dojo.removeClass(this._radio[i].parentNode.parentNode,"hiddenCascadeNode");
dojo.attr(this._radio[i],"checked",true);
this._onChange({target:i});
break;
}else{
if(rule=="element.style"&&this._values[i].type=="element.style"){
dojo.removeClass(this._radio[i].parentNode.parentNode,"hiddenCascadeNode");
dojo.attr(this._radio[i],"checked",true);
this._onChange({target:i});
break;
}
}
}
},selectRuleBySelector:function(_1fd5){
if(_1fd5=="element.style"){
this._targetValueIndex=0;
if(this._values.length>0){
dojo.attr(this._radio[0],"checked",true);
if(this._values[0].shorthand){
dojo.addClass(this._radio[0].parentNode.parentNode,"cssShorthandOverRidden");
}else{
var loc=this._getBaseLocation();
this._setFieldValue(this._values[0].value,loc);
}
}
return;
}
for(var i=0;i<this._values.length;i++){
if(this._values[i].type!="element.style"&&this._values[i].rule&&this._values[i].rule.hasSelector(_1fd5)){
dojo.removeClass(this._radio[i].parentNode.parentNode,"hiddenCascadeNode");
dojo.attr(this._radio[i],"checked",true);
this._onChange({target:i});
break;
}
}
},_isTarget:function(t){
if(t==="$std_10"){
return true;
}
for(var i=0;i<this.target.length;i++){
if(this.target[i]==t){
return true;
}
}
return false;
},_updateFieldValue:function(){
function _1fd6(value){
if(value&&value.rule&&value.rule.getCSSFile){
var file=value.rule.getCSSFile();
var _1fd7=file.getResource();
return _1fd7.readOnly();
}else{
return false;
}
};
if(this._widget==null){
this._setFieldValue("",this._getBaseLocation());
}
var _1fd8=this._getDefaultSelection();
this._targetValueIndex=0;
var _1fd9=false;
var _1fda=false;
for(var i=0;i<this._values.length;i++){
var _1fdb=(this._editor.editorID=="davinci.ve.HTMLPageEditor");
var _1fdc=(this._editor.editorID=="davinci.themeEdit.ThemeEditor");
if((this._values[i].value&&!_1fd9&&_1fdc)||(this._values[i].value&&!_1fd9&&_1fdb&&!this._values[i].readOnly)||(!_1fd9&&!_1fda&&this._values[i].type!="element.style"&&this._values[i].rule&&this._values[i].rule.hasSelector(_1fd8))||(_1fd8=="element.style"&&this._values[i].type=="element.style")){
var _1fdd=this._values[i].type=="element.style"?"element.style":this._values[i].rule;
this.selectRule(_1fdd);
if(this._values[i].value){
_1fd9=true;
}
_1fda=true;
}else{
if(_1fd9&&!_1fda){
dojo.addClass(this._radio[i].parentNode.parentNode,"cssOverRidden");
}
}
}
if(!_1fd9&&!_1fda&&_1fdb){
this.selectRuleBySelector("element.style");
}
},_getDefaultSelection:function(){
var state="Normal";
if(this._editor.editorID=="davinci.themeEdit.ThemeEditor"){
state=state||_1f93.getState();
}
var meta=this.context.getThemeMetaDataByWidget(this._widget);
if(!meta||!meta.states){
return "element.style";
}
if(meta&&meta.states[state]&&meta.states[state].elements){
var md=meta.states[state].elements;
for(var name in md){
for(var p=0;p<md[name].length;p++){
if(this._isTarget(md[name][p])){
if(name=="$root"){
return "element.style";
}else{
return name;
}
}
}
}
}
if(meta&&meta.states[state]){
var theme=this.context.getThemeMeta();
if(theme){
var _1fde=theme.loader.getType(this._widget);
var md=theme.metadata.getStyleSelectors(_1fde,state,null);
if(md){
for(var name in md){
for(var c=0;c<md[name].length;c++){
if(this._isTarget(md[name][c])){
if(meta.rootSelectors){
for(var i=0;i<meta.rootSelectors.length;i++){
if(name==meta.rootSelectors[i]){
return "element.style";
}
}
}
return name;
}
}
}
}
}
}
return null;
},_addDeltaRules:function(_1fdf,_1fe0){
var state="Normal";
var _1fe1=-1;
var _1fe2=[];
var _1fe3=this.context._getCssFiles();
var _1fe4=(_1fe3&&_1fe3.length>0)?_1fe3[0].url:null;
var _1fe5=false;
if(_1fe4){
var file=_1f94.findResource(_1fe4);
_1fe5=file._readOnly;
}
if(this._editor.editorID=="davinci.themeEdit.ThemeEditor"){
state=state||_1f93.getState();
}
var meta=this.context.getThemeMetaDataByWidget(_1fdf);
if(meta&&meta.states[state]&&meta.states[state].selectors){
var md=meta.states[state].selectors;
for(var name in md){
var found=false;
for(var i=0;i<_1fe0.length;i++){
var r=_1fe0[i];
if(r.type==="element.style"){
_1fe1=i;
}
if(r.type==="theme"&&r.ruleString===name&&(r.rule.parent.relativeURL==this.context._themeUrl||r.rule.parent.url==_1fe4)){
found=true;
break;
}
}
if(!found){
var _1fe6=this._computeMatchLevelSelector(name);
if(_1fe4&&!_1fe5){
_1fe2.push({rule:null,ruleString:name,targetFile:_1fe4,className:null,value:null,matchLevel:_1fe6,type:"proposal"});
}
if(this.context._themeUrl&&!this.context.theme.file.readOnly()){
_1fe2.push({rule:null,ruleString:name,targetFile:this.context._themeUrl,className:null,value:null,matchLevel:_1fe6,type:"proposal",proposalTarget:"theme"});
}
}
}
}
var n=_1fe1+1;
_1fe2.forEach(function(item){
_1fe0.splice(n++,0,item);
});
return _1fe0;
},_getRuleTargetValue:function(rule){
var value=null;
if(rule){
for(var i=0;!value&&i<this.target.length;i++){
value=rule.getProperties(this.target[i]);
}
}
if(value!=null){
if(value.length>1){
var _1fe7=[];
for(var i=0;i<value.length;i++){
_1fe7.push(value[i].value);
}
return _1fe7;
}else{
if(value.length==1){
return value[0].value;
}
}
}
return null;
},_onChangeRemove:function(event){
var _1fe8=event.target;
this._changeValue(_1fe8,null);
this._updateCascadeList();
},_onChange:function(event){
var loc=null;
if(this._values[event.target].type=="element.style"){
loc=this._getBaseLocation();
}else{
if(this._values[event.target].type=="proposal"){
var model=this.context.getModel();
var _1fe9=model.find({elementType:"CSSFile",relativeURL:this._values[event.target].targetFile},true);
var _1fea=this.context._getCssFiles();
if(_1fe9){
loc=_1fe9.getResource();
}else{
if(_1fea[0].url==this._values[event.target].targetFile){
loc=_1fea.cssFiles[0];
}
}
}else{
loc=this._values[event.target].rule.getCSSFile().getResource();
}
}
this._setFieldValue(this._values[event.target].value||"",loc);
this._targetValueIndex=event.target;
},_widgetValuesChanged:function(event){
if(this._dirtyCascadeList){
this._updateCascadeList();
this._dirtyCascadeList=false;
}else{
var _1feb=this._getShortHands();
var _1fec=event.values;
for(var name in _1fec){
for(var i=0;i<_1feb.length;i++){
if(_1feb[i]==name){
this._updateCascadeList();
return;
}
}
}
}
},_formatRuleString:function(r){
var _1fed=veNLS;
if(r.type=="element.style"){
return "element.style";
}
var s="";
if(r.type=="proposal"){
if(r.className){
s+=dojo.string.substitute(_1fed.newRule,[r.className,r.targetFile]);
}else{
s+=dojo.string.substitute(_1fed.newThemeRule,[r.targetFile]);
}
s+=r.ruleString;
}else{
var rule=r.rule;
if(r.className){
s+=dojo.string.substitute(_1fed.existingRule,[r.className,this.targetFile]);
}else{
if(r.type=="theme"){
s+="["+r.type+"] ";
}
}
if(r.ruleString){
s+=r.ruleString;
}else{
for(var i=0;i<rule.selectors.length;i++){
if(i!=0){
s+=", ";
}
s+=rule.selectors[i].getLabel();
}
}
var file=rule.searchUp("CSSFile");
if(file){
s+="  ("+file.url||file.relativeURL;
}
if(r.property){
s+=dojo.string.substitute(_1fed.line,[r.property.startLine]);
}else{
s+=dojo.string.substitute(_1fed.line,[rule.startLine||_1fed.propUndefined]);
}
}
return s;
},_widgetSelectionChanged:function(_1fee){
var _1fef=_1fee[0];
this._widget=_1fef;
if(this._widget){
this.context=_1fef.getContext();
this.targetFile=this.context.getAppCssRelativeFile();
this._editor=this.context.editor;
this._topWidgetDom=this.context.getWidgetTopDom(this._widget,this.target)||this._widget.domNode||this._widget;
}else{
this._topWidgetDom=null;
}
this._updateCascadeList();
},_getBaseLocation:function(){
return this._editor.getContext().getBaseResource();
},_editorSelected:function(_1ff0){
this._editor=_1ff0.editor;
var _1ff1;
if(this._editor&&this._editor.getContext){
_1ff1=this._editor.getContext();
}
if(_1ff1&&this._editor.supports("style")){
this.context=_1ff1;
this.targetFile=_1ff1.getAppCssRelativeFile();
var v=_1ff1.getSelection();
if(v.length>0){
this._widgetSelectionChanged(v);
}else{
this._widgetSelectionChanged([]);
}
}else{
this.context=null;
this._widget=null;
if(this._setFieldValue){
this._setFieldValue("",null);
}
}
this._updateCascadeList();
},_onFieldFocus:function(){
if(this.context){
this.context.blockChange(true);
}
},_destroy:function(){
var _1ff2=(this.cascadeTableDiv);
dojo.forEach(dojo.query("[widgetId]",_1ff2).map(dijit.byNode),function(w){
w.destroy();
});
while(_1ff2.firstChild){
dojo._destroyElement(_1ff2.firstChild);
}
dojo.forEach(this._handles,dojo.disconnect);
this._handles=[];
},_onFieldBlur:function(){
if(this.context){
this.context.blockChange(false);
}
},_getClasses:function(_1ff3){
var _1ff4=_1ff3.getClassNames("class")||"";
_1ff4=_1ff4.split(" ");
for(var i=0;i<_1ff4.length;i++){
for(var j=i+1;j<_1ff4.length;j++){
if(_1ff4[j]==_1ff4[i]){
_1ff4.splice(j,1);
}
}
}
return _1ff4;
},_getClassSelector:function(_1ff5){
var rel=this.context.getRelativeMetaTargetSelector(this.target);
var text=rel.length>0?rel[0]:"";
var _1ff6=this.context.getBodyId();
var theme=this.context.getTheme();
var rules=[];
if(!theme){
return rules;
}
var _1ff7=theme.className;
var _1ff8=text.split(",");
_1ff8.forEach(function(_1ff9){
_1ff9=_1ff9.trim();
rules.push("#"+_1ff6+"."+_1ff7+" ."+_1ff5+_1ff9);
}.bind(this));
return rules;
},_computeMatchLevelSelector:function(_1ffa){
var _1ffb=_1ffa.split(this._regex_combinators);
var _1ffc=0;
for(var i=0;i<_1ffb.length;i++){
var ss=_1ffb[i];
while(true){
var _1ffd=ss.match(this._regex_not_pseudoclass);
if(_1ffd!=null){
_1ffc+=this._computeMatchLevelSimpleSelector(_1ffd[2]);
ss=_1ffd[1]+_1ffd[3];
}else{
break;
}
}
_1ffc+=this._computeMatchLevelSimpleSelector(ss);
}
return _1ffc;
},_computeMatchLevelSimpleSelector:function(ss){
var _1ffe=0;
do{
var _1fff=false;
function _2000(regex,_2001){
var _2002=ss.match(regex);
if(_2002!=null){
_1fff=true;
_1ffe+=_2001;
ss=_2002[1]+_2002[3];
}
};
_2000(this._regex_pseudoelement,1);
if(!_1fff){
_2000(this._regex_id,100);
_2000(this._regex_class,10);
_2000(this._regex_attribute,10);
_2000(this._regex_pseudoclass,10);
_2000(this._regex_univeral,0);
}
}while(_1fff);
if(ss.length>0){
_1ffe+=1;
}
return _1ffe;
},_compareSelectors:function(_2003,_2004){
if((!_2003||!_2004)&&_2003!=_2004){
return false;
}
var _2005=_2003.split(this._regex_combinators);
var _2006=_2004.split(this._regex_combinators);
if(_2005.length!=_2005.length){
return false;
}
for(var i=0;i<_2005.length;i++){
var ss1=_2005[i];
var ss2=_2006[i];
if(ss1!=ss2){
return false;
}
}
return true;
},_compareSimpleSelectors:function(ss1,ss2){
}});
return dojo.mixin(_1f95,{__id:0});
});
},"davinci/ui/TextEditor":function(){
define(["dojo/_base/declare","./Editor"],function(_2007,_2008){
return _2007(_2008,{constructor:function(_2009,_200a){
this.subscriptions=[];
this._handles=[];
},isActiveEditor:function(){
return davinci.Runtime.currentEditor==this;
},supports:function(_200b){
return false;
},handleChange:function(text){
if(this.editorContainer){
this.editorContainer.setDirty(true);
}
this.isDirty=true;
this.lastModifiedTime=Date.now();
},_onKey:function(e){
davinci.Workbench.currentContext=this.editorID;
return davinci.Workbench.handleKey(e);
},subscribe:function(topic,func){
this.subscriptions.push(dojo.subscribe(topic,this,func));
},destroy:function(){
this.inherited(arguments);
this.subscriptions.forEach(dojo.unsubscribe);
this._handles.forEach(dojo.disconnect);
},getDefaultContent:function(){
return null;
},getErrors:function(){
return [];
},save:function(_200c){
var text=this.getText();
if(this.resourceFile){
this.resourceFile.clearMarkers();
var _200d=this.getErrors();
for(var i=0;i<_200d.length;i++){
var _200e;
switch(_200d[i].id){
case "(error)":
_200e="error";
break;
case "(warning)":
_200e="warning";
break;
}
if(_200e){
this.resourceFile.addMarker(_200e,_200d[i].line+1,_200d[i].reason);
}
}
this.resourceFile.setContents(text,_200c);
if(this.editorContainer){
this.editorContainer.setDirty(_200c);
}
this.isDirty=false;
this.lastModifiedTime=0;
}
},supports:function(_200f){
return false;
},_connect:function(_2010,_2011,_2012){
this._handles.push(dojo.connect(_2010,_2011,this,_2012));
}});
});
},"dijit/ToolbarSeparator":function(){
define("dijit/ToolbarSeparator",["dojo/_base/declare","dojo/dom","./_Widget","./_TemplatedMixin"],function(_2013,dom,_2014,_2015){
return _2013("dijit.ToolbarSeparator",[_2014,_2015],{templateString:"<div class=\"dijitToolbarSeparator dijitInline\" role=\"presentation\"></div>",buildRendering:function(){
this.inherited(arguments);
dom.setSelectable(this.domNode,false);
},isFocusable:function(){
return false;
}});
});
},"davinci/js/ui/JavaScriptOutline":function(){
define("davinci/js/ui/JavaScriptOutline",["dojo/_base/declare","davinci/js/ui/JSOutlineModel","davinci/ui/widgets/DavinciModelTreeModel"],function(_2016,_2017,_2018){
return _2016("davinci.js.ui.JavaScriptOutline",null,{constructor:function(model){
this._jsModel=model;
},getModel:function(){
this._model=new _2017(this._jsModel);
return this._model;
}});
});
},"davinci/ve/actions/ViewDesignAction":function(){
define(["dojo/_base/declare","davinci/ve/actions/ContextAction"],function(_2019,_201a){
return _2019("davinci.ve.actions.ViewDesignAction",[_201a],{run:function(_201b){
_201b=this.fixupContext(_201b);
if(_201b&&_201b.editor&&_201b.editor.switchDisplayModeDesign){
_201b.editor.switchDisplayModeDesign();
}
},updateStyling:function(){
var _201c=davinci.Workbench.getOpenEditor();
if(_201c&&_201c.getDisplayMode){
var _201d=_201c.getDisplayMode();
var _201e=dojo.query(".maqDesignButton")[0];
if(_201e){
if(_201d=="design"){
dojo.addClass(_201e,"maqLabelButtonSelected");
}else{
dojo.removeClass(_201e,"maqLabelButtonSelected");
}
}
}
}});
});
},"url:dijit/form/templates/DropDownButton.html":"<span class=\"dijit dijitReset dijitInline\"\n\t><span class='dijitReset dijitInline dijitButtonNode'\n\t\tdata-dojo-attach-event=\"ondijitclick:_onClick\" data-dojo-attach-point=\"_buttonNode\"\n\t\t><span class=\"dijitReset dijitStretch dijitButtonContents\"\n\t\t\tdata-dojo-attach-point=\"focusNode,titleNode,_arrowWrapperNode\"\n\t\t\trole=\"button\" aria-haspopup=\"true\" aria-labelledby=\"${id}_label\"\n\t\t\t><span class=\"dijitReset dijitInline dijitIcon\"\n\t\t\t\tdata-dojo-attach-point=\"iconNode\"\n\t\t\t></span\n\t\t\t><span class=\"dijitReset dijitInline dijitButtonText\"\n\t\t\t\tdata-dojo-attach-point=\"containerNode,_popupStateNode\"\n\t\t\t\tid=\"${id}_label\"\n\t\t\t></span\n\t\t\t><span class=\"dijitReset dijitInline dijitArrowButtonInner\"></span\n\t\t\t><span class=\"dijitReset dijitInline dijitArrowButtonChar\">&#9660;</span\n\t\t></span\n\t></span\n\t><input ${!nameAttrSetting} type=\"${type}\" value=\"${value}\" class=\"dijitOffScreen\" tabIndex=\"-1\"\n\t\tdata-dojo-attach-point=\"valueNode\"\n/></span>\n","dijit/Toolbar":function(){
define("dijit/Toolbar",["require","dojo/_base/declare","dojo/has","dojo/keys","dojo/ready","./_Widget","./_KeyNavContainer","./_TemplatedMixin"],function(_201f,_2020,has,keys,ready,_2021,_2022,_2023){
if(has("dijit-legacy-requires")){
ready(0,function(){
var _2024=["dijit/ToolbarSeparator"];
_201f(_2024);
});
}
return _2020("dijit.Toolbar",[_2021,_2023,_2022],{templateString:"<div class=\"dijit\" role=\"toolbar\" tabIndex=\"${tabIndex}\" data-dojo-attach-point=\"containerNode\">"+"</div>",baseClass:"dijitToolbar",postCreate:function(){
this.inherited(arguments);
this.connectKeyNavHandlers(this.isLeftToRight()?[keys.LEFT_ARROW]:[keys.RIGHT_ARROW],this.isLeftToRight()?[keys.RIGHT_ARROW]:[keys.LEFT_ARROW]);
}});
});
},"davinci/ve/actions/CopyAction":function(){
define(["dojo/_base/declare","davinci/Workbench","./_CutCopyAction","davinci/commands/CompoundCommand","davinci/ve/commands/RemoveCommand"],function(_2025,_2026,_2027,_2028,_2029){
return _2025("davinci.ve.actions.CopyAction",[_2027],{_invokeSourceEditorAction:function(_202a){
_202a.htmlEditor.copyAction.run();
},_executeAction:function(_202b,_202c,data,_202d){
var _202e=davinci.Runtime.clipboard;
davinci.Runtime.clipboard=data;
if(!_202e){
_202b.onSelectionChange(_202c);
}
}});
});
},"dojo/promise/all":function(){
define("dojo/promise/all",["../_base/array","../Deferred","../when"],function(array,_202f,when){
"use strict";
var some=array.some;
return function all(_2030){
var _2031,array;
if(_2030 instanceof Array){
array=_2030;
}else{
if(_2030&&typeof _2030==="object"){
_2031=_2030;
}
}
var _2032;
var _2033=[];
if(_2031){
array=[];
for(var key in _2031){
if(Object.hasOwnProperty.call(_2031,key)){
_2033.push(key);
array.push(_2031[key]);
}
}
_2032={};
}else{
if(array){
_2032=[];
}
}
if(!array||!array.length){
return new _202f().resolve(_2032);
}
var _2034=new _202f();
_2034.promise.always(function(){
_2032=_2033=null;
});
var _2035=array.length;
some(array,function(_2036,index){
if(!_2031){
_2033.push(index);
}
when(_2036,function(value){
if(!_2034.isFulfilled()){
_2032[_2033[index]]=value;
if(--_2035===0){
_2034.resolve(_2032);
}
}
},_2034.reject);
return _2034.isFulfilled();
});
return _2034.promise;
};
});
},"davinci/ve/tools/PasteTool":function(){
define("davinci/ve/tools/PasteTool",["dojo/_base/declare","./CreateTool","../widget","../metadata","../../commands/CompoundCommand","../commands/AddCommand","../commands/MoveCommand","../commands/StyleCommand","dojo/Deferred","dojo/promise/all"],function(_2037,_2038,_2039,_203a,_203b,_203c,_203d,_203e,_203f,all){
return _2037("davinci.ve.tools.PasteTool",_2038,{constructor:function(data){
this.inherited(arguments);
this._position_prop=null;
var d=data[0];
if(d&&d.properties){
var _2040=_2039.parseStyleValues(d.properties.style);
this._position_prop=_2039.retrieveStyleProperty(_2040,"position","");
}
},_create:function(args){
var index=args.index,delta,_2041,_2042=new _203b(),_2043,_2044=[],_2045=new _203f(),_2046;
var _2046=this._data.map(function(d){
var _2047=new _203f();
var _2048=[];
if(!this._loadType(d,_2048)){
_2047.reject();
return _2047;
}
all(_2048).then(function(){
var _2049=_2039.parseStyleValues(d.properties&&d.properties.style);
if(this._position_prop=="absolute"){
var left=parseInt(_2039.retrieveStyleProperty(_2049,"left","0px"));
var top=parseInt(_2039.retrieveStyleProperty(_2049,"top","0px"));
if(delta){
_2041={x:left+delta.x,y:top+delta.y};
}else{
if(args.position){
_2041=args.position;
delta={x:args.position.x-left,y:args.position.y-top};
}else{
console.warn("PasteTool.js _create - no value for args.position");
_2041={x:left,y:top};
delta={x:0,y:0};
}
}
}
dojo.withDoc(this._context.getDocument(),function(){
var _204a=function(_204b){
if(index!==undefined&&index>=0){
index++;
}
_2044.push(_204b);
if(_2041){
var _204c=this._context.getPreference("absoluteWidgetsZindex");
_2042.add(new _203e(_204b,[{position:"absolute"},{"z-index":_204c}]));
var _204d=new _203d(_204b,_2041.x,_2041.y,_2043,null,null,_2043);
if(!_2043){
_2043=_204d;
}
_2042.add(_204d);
}
_2047.resolve();
}.bind(this);
d.context=this._context;
_203a.getHelper(d.type,"tool").then(function(_204e){
var w,_204f,_2050=[];
if(_204e){
_204f=new _204e(d);
}
if(_204f&&_204f.addPasteCreateCommand){
var _2051={parent:args.parent||this._context.getContainerNode(),position:_2041,index:index};
_204f.addPasteCreateCommand(_2042,_2051).then(function(w){
if(!w){
_2047.reject();
return _2047;
}
_204a(w);
});
}else{
w=_2039.createWidget(d);
if(!w){
_2047.reject();
return _2047;
}
_2042.add(new _203c(w,args.parent||this._context.getContainerNode(),index));
_204a(w);
}
}.bind(this));
}.bind(this));
}.bind(this));
return _2047;
}.bind(this));
all(_2046).then(function(){
if(!_2042.isEmpty()){
this._context.getCommandStack().execute(_2042);
setTimeout(function(){
_2044.forEach(function(w,i){
this._context.select(w,i>0);
}.bind(this));
}.bind(this),0);
}
_2045.resolve();
}.bind(this));
return _2045;
},createWithFlowLayout:function(){
return this._position_prop!="absolute";
}});
});
},"davinci/ui/widgets/DavinciModelTreeModel":function(){
define(["dojo/_base/declare"],function(_2052){
return _2052("davinci.ui.widgets.DavinciModelTreeModel",null,{constructor:function(root){
this.root=root;
this.subscription=dojo.subscribe("/davinci/ui/modelChanged",this,this.modelChanged);
},destroy:function(){
dojo.unsubscribe(this.subscription);
},getRoot:function(_2053){
_2053(this.root);
},mayHaveChildren:function(item){
return item.children.length>0;
},getChildren:function(_2054,_2055){
_2055(this._childList(_2054));
},getIdentity:function(item){
return item.getID();
},getLabel:function(item){
return item.getLabel();
},modelChanged:function(type,_2056){
this.refresh();
},_childList:function(_2057){
return _2057.children;
},newItem:function(args,_2058){
},pasteItem:function(_2059,_205a,_205b,bCopy){
},onChange:function(item){
},onChildrenChange:function(_205c,_205d){
},refresh:function(){
try{
var node=this.root;
this.onChildrenChange(node,this._childList(node));
}
catch(e){
console.error("error in VisualEditorOutline::refresh");
}
}});
});
},"davinci/ve/PageEditor":function(){
define(["dojo/_base/declare","../ui/ModelEditor","dijit/layout/BorderContainer","dijit/layout/ContentPane","dojo/dnd/Moveable","../Runtime","../commands/CommandStack","../html/ui/HTMLEditor","../model/Path","./VisualEditor","./VisualEditorOutline","./widget","./utils/GeomUtils","dojo/i18n!./nls/ve"],function(_205e,_205f,_2060,_2061,_2062,_2063,_2064,_2065,Path,_2066,_2067,_2068,_2069,veNls){
return _205e("davinci.ve.PageEditor",_205f,{_latestSourceMode:"source",_latestLayoutMode:"flow",constructor:function(_206a,_206b){
this._bc=new _2060({},_206a);
this.domNode=this._bc.domNode;
this._commandStack=new _2064(this);
this.savePoint=0;
this._designCP=new _2061({"class":"designCP",region:"center"});
this._bc.addChild(this._designCP);
this.visualEditor=new _2066(this._designCP.domNode,this);
this.currentEditor=this.visualEditor;
this.currentEditor._commandStack=this._commandStack;
this._srcCP=new dijit.layout.ContentPane({region:"bottom",splitter:true,style:"height:50%"});
var _206c=this._srcCP.resize;
this._srcCP.resize=function(_206d,_206e){
dojo.marginBox(this.domNode,_206e);
_206c.apply(this,arguments);
if(_206f.editor&&_206f.editor.getTextView()){
_206f.editor.getTextView().resize();
}
};
var _206f=this.htmlEditor=new _2065(this._srcCP.domNode,_206b,true);
this.htmlEditor.setVisible(false);
this.model=this.htmlEditor.model;
this._displayMode="design";
this.model=this.htmlEditor.model;
this._bc.startup();
this._bc.resize();
this._connect(this.visualEditor,"onContentChange","_visualChanged");
this._connect(this.htmlEditor,"handleChange","_srcChanged");
this.subscribe("/davinci/ui/styleValuesChange",this._stylePropertiesChange);
this.subscribe("/davinci/ui/widgetSelected",this._widgetSelectionChange);
this.subscribe("/davinci/ui/selectionChanged",this._modelSelectionChange);
this.subscribe("/davinci/ui/editorSelected",this._editorSelected.bind(this));
this.subscribe("/davinci/ui/context/loaded",this._contextLoaded.bind(this));
this.subscribe("/davinci/ui/deviceChanged",this._deviceChanged.bind(this));
},setRootElement:function(_2070){
this._rootElement=_2070;
},supports:function(_2071){
var regex=/^palette|properties|style|states|inline-style|MultiPropTarget|propsect_common|propsect_widgetSpecific|propsect_events|propsect_layout|propsect_paddingMargins|propsect_background|propsect_border|propsect_fontsAndText|propsect_shapesSVG$/;
return _2071.match(regex);
},focus:function(){
},_editorSelected:function(event){
var _2072=this.getContext();
if(this==event.oldEditor){
_2072.hideFocusAll();
}
if(event.editor&&event.editor.editorContainer&&(event.editor.declaredClass=="davinci.ve.PageEditor"||event.editor.declaredClass=="davinci.ve.themeEditor.ThemeEditor")){
if(this==event.editor){
var _2073=_2072.getFlowLayout();
var _2074=_2073?"flow":"absolute";
this._updateLayoutDropDownButton(_2074);
_2072.clearCachedWidgetBounds();
if(this.editorContainer){
this.editorContainer.updateToolbars();
}
}
}
},_contextLoaded:function(){
if(davinci.Runtime.currentEditor==this&&this.editorContainer){
this.editorContainer.updateToolbars();
}
},_deviceChanged:function(){
if(davinci.Runtime.currentEditor==this&&this.editorContainer){
var _2075=this.getContext();
if(_2075&&_2075.updateFocusAll){
setTimeout(function(){
_2075.updateFocusAll();
},1000);
}
}
},_updateLayoutDropDownButton:function(_2076){
var _2077=dojo.query(".maqLayoutDropDownButton");
if(_2077&&_2077[0]){
var _2078=dijit.byNode(_2077[0]);
if(_2078){
_2078.set("label",veNls["LayoutDropDownButton-"+_2076]);
}
}
},_selectLayout:function(_2079){
this._latestLayoutMode=_2079;
require(["davinci/actions/SelectLayoutAction"],function(_207a){
var _207b=new _207a();
_207b._changeLayoutCommand(_2079);
});
this._updateLayoutDropDownButton(_2079);
},selectLayoutFlow:function(){
this._selectLayout("flow");
},selectLayoutAbsolute:function(){
this._selectLayout("absolute");
},getDisplayMode:function(){
return this._displayMode;
},getSourceDisplayMode:function(){
return this._latestSourceMode;
},_switchDisplayModeSource:function(_207c){
this._latestSourceMode=_207c;
this.switchDisplayMode(_207c);
},switchDisplayModeSource:function(){
this._switchDisplayModeSource("source");
},switchDisplayModeSplitVertical:function(){
this._switchDisplayModeSource("splitVertical");
},switchDisplayModeSplitHorizontal:function(){
this._switchDisplayModeSource("splitHorizontal");
},switchDisplayModeSourceLatest:function(){
this.switchDisplayMode(this._latestSourceMode);
},switchDisplayModeDesign:function(){
this.switchDisplayMode("design");
},switchDisplayMode:function(_207d){
var _207e=this.getContext();
if(this._displayMode!="design"){
this._bc.removeChild(this._srcCP);
this.htmlEditor.setVisible(false);
}
this._designCP.set("region","center");
delete this._designCP.domNode.style.width;
delete this._srcCP.domNode.style.width;
switch(_207d){
case "design":
break;
case "source":
this._designCP.set("region","left");
this._designCP.domNode.style.width=0;
this._srcCP.set("region","center");
break;
case "splitVertical":
this._designCP.domNode.style.width="50%";
this._srcCP.set("region","right");
this._srcCP.domNode.style.width="50%";
this._bc.set("design","sidebar");
break;
case "splitHorizontal":
this._designCP.domNode.style.height="50%";
this._srcCP.set("region","bottom");
this._srcCP.domNode.style.height="50%";
this._bc.set("design","headline");
}
if(_207d!="design"){
this._bc.addChild(this._srcCP);
this.htmlEditor.setVisible(true);
}
this._displayMode=_207d;
this._bc.layout();
if(this.editorContainer){
this.editorContainer.updateToolbars();
}
dojo.publish("/davinci/ui/repositionFocusContainer",[]);
if(_207d=="source"){
_207e.hideFocusAll();
}else{
_207e.clearCachedWidgetBounds();
_207e.updateFocusAll();
}
},_modelSelectionChange:function(_207f){
if(this._displayMode=="source"||davinci.Runtime.currentEditor!==this){
return;
}
this._selectionCssRules=null;
if(_207f.length){
var _2080=_207f[0].model;
if(_2080&&_2080.elementType=="HTMLElement"){
var id=_2080.getAttribute("id");
if(id&&this._displayMode!="source"){
var _2081=_2068.byId(id,this.visualEditor.context.getDocument());
this.visualEditor.context.select(_2081);
}
}
}
},_widgetSelectionChange:function(_2082){
if(!this.visualEditor.context||(_2082&&_2082.length&&_2082[0]._edit_context!=this.visualEditor.context)){
return;
}
var _2082=this.visualEditor.context.getSelection();
if(_2082&&_2082.length){
if(this._displayMode!="design"){
this.htmlEditor.selectModel([{model:_2082[0]._srcElement}]);
}
}
},_stylePropertiesChange:function(value){
this.visualEditor._stylePropertiesChange(value);
},_setDirty:function(){
this.setDirty(true);
},setDirty:function(_2083){
this.isDirty=_2083;
if(_2083){
this.lastModifiedTime=Date.now();
}
if(this.editorContainer){
this.editorContainer.setDirty(_2083);
}
},_visualChanged:function(_2084){
if(!_2084){
this._setDirty();
}
this.htmlEditor.setValue(this.model.getText(),true);
},_srcChanged:function(){
var _2085=this.htmlEditor.isTyping;
if(_2085){
this.visualEditor.skipSave=true;
}
var _2086=this.visualEditor.context,_2087=_2086?_2086.getStatesScenes():undefined;
this.visualEditor.setContent(this.fileName,this.htmlEditor.model);
dojo.publish("/davinci/ui/context/pagerebuilt",[_2086]);
if(_2087){
_2086.setStatesScenes(_2087);
}
delete this.visualEditor.skipSave;
this._setDirty();
},getContext:function(){
return this.visualEditor.context;
},getOutline:function(){
if(!this.outline){
this.outline=new _2067(this);
}
return this.outline;
},getPropertiesView:function(){
return this.currentEditor.getPropertiesView();
},setContent:function(_2088,_2089,_208a){
this.fileName=_2088;
this.htmlEditor.setContent(_2088,_2089);
this.visualEditor.setContent(_2088,this.htmlEditor.model,_208a);
this._connect(this.htmlEditor.model,"onChange","_themeChange");
this.htmlEditor.setValue(this.model.getText(),true);
},_themeChange:function(e){
if(e&&e.elementType==="CSSRule"){
this.setDirty(true);
this.visualEditor.context.hotModifyCssRule(e);
}
},getDefaultContent:function(){
this._isNewFile=true;
return this.visualEditor.getDefaultContent();
},selectModel:function(_208b,_208c){
if(this.publishingSelect||(_208c&&this!=_208c)){
return;
}
var _208d=_208b&&_208b[0];
if(!_208d){
return;
}
if(_208d.elementType){
this.htmlEditor.selectModel(_208b);
}else{
if(_208d.model&&_208d.model.isWidget){
this.visualEditor.context.select(_208d.model,_208d.add);
}
}
},save:function(_208e){
if(_208e){
if(system.resource.findResource(this.fileName).readOnly()){
return;
}
}
this.savePoint=this._commandStack.getUndoCount();
this.visualEditor.save(_208e);
this.isDirty=this.isDirty&&_208e;
if(this.editorContainer){
this.editorContainer.setDirty(_208e);
}
},removeWorkingCopy:function(){
},previewInBrowser:function(){
this.visualEditor.previewInBrowser();
},destroy:function(){
this.inherited(arguments);
this.visualEditor.destroy();
this.htmlEditor.destroy();
},getText:function(){
return this.htmlEditor.getText();
},onResize:function(){
var _208f=this.getContext();
var _2090=_208f.getSelection();
for(var i=0;i<_2090.length;i++){
var add=(i!=0);
_208f.select(_2090[i],add);
}
},handleKeyEvent:function(e){
},getDisplayMode:function(){
return this._displayMode;
},getFocusContainerBounds:function(){
if(this._displayMode=="source"){
return {l:0,t:0,w:0,h:0};
}else{
var _2091=this._designCP.domNode;
var box=_2069.getBorderBoxPageCoords(_2091);
box.l-=8;
box.t-=8;
var _2092=(this.visualEditor&&this.visualEditor.getDevice)?this.visualEditor.getDevice():"none";
if(_2092=="none"){
box.w+=(this._displayMode=="splitVertical"?8:16);
box.h+=(this._displayMode=="splitHorizontal"?8:16);
}else{
box.w+=8;
box.h+=8;
}
return box;
}
}});
});
},"dojox/grid/Selection":function(){
define("dojox/grid/Selection",["dojo/_base/declare","dojo/_base/array","dojo/_base/lang","dojo/dom-attr"],function(_2093,array,lang,_2094){
return _2093("dojox.grid.Selection",null,{constructor:function(_2095){
this.grid=_2095;
this.selected=[];
this.setMode(_2095.selectionMode);
},mode:"extended",selected:null,updating:0,selectedIndex:-1,setMode:function(mode){
if(this.selected.length){
this.deselectAll();
}
if(mode!="extended"&&mode!="multiple"&&mode!="single"&&mode!="none"){
this.mode="extended";
}else{
this.mode=mode;
}
},onCanSelect:function(_2096){
return this.grid.onCanSelect(_2096);
},onCanDeselect:function(_2097){
return this.grid.onCanDeselect(_2097);
},onSelected:function(_2098){
},onDeselected:function(_2099){
},onChanging:function(){
},onChanged:function(){
},isSelected:function(_209a){
if(this.mode=="none"){
return false;
}
return this.selected[_209a];
},getFirstSelected:function(){
if(!this.selected.length||this.mode=="none"){
return -1;
}
for(var i=0,l=this.selected.length;i<l;i++){
if(this.selected[i]){
return i;
}
}
return -1;
},getNextSelected:function(_209b){
if(this.mode=="none"){
return -1;
}
for(var i=_209b+1,l=this.selected.length;i<l;i++){
if(this.selected[i]){
return i;
}
}
return -1;
},getSelected:function(){
var _209c=[];
for(var i=0,l=this.selected.length;i<l;i++){
if(this.selected[i]){
_209c.push(i);
}
}
return _209c;
},getSelectedCount:function(){
var c=0;
for(var i=0;i<this.selected.length;i++){
if(this.selected[i]){
c++;
}
}
return c;
},_beginUpdate:function(){
if(this.updating===0){
this.onChanging();
}
this.updating++;
},_endUpdate:function(){
this.updating--;
if(this.updating===0){
this.onChanged();
}
},select:function(_209d){
if(this.mode=="none"){
return;
}
if(this.mode!="multiple"){
this.deselectAll(_209d);
this.addToSelection(_209d);
}else{
this.toggleSelect(_209d);
}
},addToSelection:function(_209e){
if(this.mode=="none"){
return;
}
if(lang.isArray(_209e)){
array.forEach(_209e,this.addToSelection,this);
return;
}
_209e=Number(_209e);
if(this.selected[_209e]){
this.selectedIndex=_209e;
}else{
if(this.onCanSelect(_209e)!==false){
this.selectedIndex=_209e;
var _209f=this.grid.getRowNode(_209e);
if(_209f){
_2094.set(_209f,"aria-selected","true");
}
this._beginUpdate();
this.selected[_209e]=true;
this.onSelected(_209e);
this._endUpdate();
}
}
},deselect:function(_20a0){
if(this.mode=="none"){
return;
}
if(lang.isArray(_20a0)){
array.forEach(_20a0,this.deselect,this);
return;
}
_20a0=Number(_20a0);
if(this.selectedIndex==_20a0){
this.selectedIndex=-1;
}
if(this.selected[_20a0]){
if(this.onCanDeselect(_20a0)===false){
return;
}
var _20a1=this.grid.getRowNode(_20a0);
if(_20a1){
_2094.set(_20a1,"aria-selected","false");
}
this._beginUpdate();
delete this.selected[_20a0];
this.onDeselected(_20a0);
this._endUpdate();
}
},setSelected:function(_20a2,_20a3){
this[(_20a3?"addToSelection":"deselect")](_20a2);
},toggleSelect:function(_20a4){
if(lang.isArray(_20a4)){
array.forEach(_20a4,this.toggleSelect,this);
return;
}
this.setSelected(_20a4,!this.selected[_20a4]);
},_range:function(_20a5,inTo,func){
var s=(_20a5>=0?_20a5:inTo),e=inTo;
if(s>e){
e=s;
s=inTo;
}
for(var i=s;i<=e;i++){
func(i);
}
},selectRange:function(_20a6,inTo){
this._range(_20a6,inTo,lang.hitch(this,"addToSelection"));
},deselectRange:function(_20a7,inTo){
this._range(_20a7,inTo,lang.hitch(this,"deselect"));
},insert:function(_20a8){
this.selected.splice(_20a8,0,false);
if(this.selectedIndex>=_20a8){
this.selectedIndex++;
}
},remove:function(_20a9){
this.selected.splice(_20a9,1);
if(this.selectedIndex>=_20a9){
this.selectedIndex--;
}
},deselectAll:function(_20aa){
for(var i in this.selected){
if((i!=_20aa)&&(this.selected[i]===true)){
this.deselect(i);
}
}
},clickSelect:function(_20ab,_20ac,_20ad){
if(this.mode=="none"){
return;
}
this._beginUpdate();
if(this.mode!="extended"){
this.select(_20ab);
}else{
var _20ae=this.selectedIndex;
if(!_20ac){
this.deselectAll(_20ab);
}
if(_20ad){
this.selectRange(_20ae,_20ab);
}else{
if(_20ac){
this.toggleSelect(_20ab);
}else{
this.addToSelection(_20ab);
}
}
}
this._endUpdate();
},clickSelectEvent:function(e){
this.clickSelect(e.rowIndex,dojo.isCopyKey(e),e.shiftKey);
},clear:function(){
this._beginUpdate();
this.deselectAll();
this._endUpdate();
}});
});
},"url:dijit/templates/MenuBarItem.html":"<div class=\"dijitReset dijitInline dijitMenuItem dijitMenuItemLabel\" data-dojo-attach-point=\"focusNode\"\n\t \trole=\"menuitem\" tabIndex=\"-1\">\n\t<span data-dojo-attach-point=\"containerNode\"></span>\n</div>\n","dijit/CheckedMenuItem":function(){
require({cache:{"url:dijit/templates/CheckedMenuItem.html":"<tr class=\"dijitReset dijitMenuItem\" data-dojo-attach-point=\"focusNode\" role=\"menuitemcheckbox\" tabIndex=\"-1\">\n\t<td class=\"dijitReset dijitMenuItemIconCell\" role=\"presentation\">\n\t\t<img src=\"${_blankGif}\" alt=\"\" class=\"dijitMenuItemIcon dijitCheckedMenuItemIcon\" data-dojo-attach-point=\"iconNode\"/>\n\t\t<span class=\"dijitCheckedMenuItemIconChar\">&#10003;</span>\n\t</td>\n\t<td class=\"dijitReset dijitMenuItemLabel\" colspan=\"2\" data-dojo-attach-point=\"containerNode,labelNode\"></td>\n\t<td class=\"dijitReset dijitMenuItemAccelKey\" style=\"display: none\" data-dojo-attach-point=\"accelKeyNode\"></td>\n\t<td class=\"dijitReset dijitMenuArrowCell\" role=\"presentation\">&#160;</td>\n</tr>\n"}});
define("dijit/CheckedMenuItem",["dojo/_base/declare","dojo/dom-class","./MenuItem","dojo/text!./templates/CheckedMenuItem.html","./hccss"],function(_20af,_20b0,_20b1,_20b2){
return _20af("dijit.CheckedMenuItem",_20b1,{templateString:_20b2,checked:false,_setCheckedAttr:function(_20b3){
_20b0.toggle(this.domNode,"dijitCheckedMenuItemChecked",_20b3);
this.domNode.setAttribute("aria-checked",_20b3?"true":"false");
this._set("checked",_20b3);
},iconClass:"",onChange:function(){
},_onClick:function(evt){
if(!this.disabled){
this.set("checked",!this.checked);
this.onChange(this.checked);
}
this.onClick(evt);
}});
});
},"davinci/ui/OpenThemeDialog":function(){
require({cache:{"url:davinci/ui/templates/OpenThemeDialog.html":"<div>\r\n\t<div class=\"dijitDialogPaneContentArea\">\r\n\t\t${selectTheme}: <div dojoType=\"davinci.ui.widgets.ThemeSelection\" dojoAttachPoint=\"_themeChooser\" value='claro' dojoAttachEvent='onChange:_checkValid' searchWorkspace='true'></div>\r\n\t</div>\t\r\n\t<div class=\"dijitDialogPaneActionBar\">\r\n\t\t<button dojoType='dijit.form.Button' dojoAttachPoint=\"_okButton\" dojoAttachEvent='onClick:okButton' label='${open}' class=\"maqPrimaryButton\" type=\"submit\"></button>\r\n\t\t<button dojoType='dijit.form.Button' dojoAttachEvent='onClick:cancelButton' label='${buttonCancel}' class=\"maqSecondaryButton\"></button>\r\n\t</div>\r\n</div>"}});
define("davinci/ui/OpenThemeDialog",["dojo/_base/declare","dijit/_Templated","dijit/_Widget","dojo/i18n!davinci/ui/nls/ui","dojo/i18n!dijit/nls/common","dojo/text!./templates/OpenThemeDialog.html","davinci/ui/widgets/ThemeSelection"],function(_20b4,_20b5,_20b6,uiNLS,_20b7,_20b8){
return _20b4("davinci.ui.OpenThemeDialog",[_20b6,_20b5],{templateString:_20b8,widgetsInTemplate:true,_themeChooser:null,startup:function(){
var _20b9=uiNLS;
this.inherited(arguments);
var value=this._themeChooser.get("numberOfThemes");
if(value<1){
alert(_20b9.noUserThemes);
setTimeout(dojo.hitch(this,function(){
this.destroyRecursive();
this.cancel=true;
this.onClose();
},500));
}
},postMixInProperties:function(){
var _20ba=uiNLS;
var _20bb=_20b7;
dojo.mixin(this,_20ba);
dojo.mixin(this,_20bb);
this.inherited(arguments);
},_checkValid:function(){
var isOk=true;
var _20bc=this._themeChooser.attr("value");
if(_20bc==null||_20bc==""){
isOk=false;
}
this._okButton.set("disabled",!isOk);
},okButton:function(){
var _20bd=this._themeChooser.attr("value");
davinci.Workbench.openEditor({fileName:_20bd.file,content:_20bd});
},cancelButton:function(){
this.cancel=true;
this.onClose();
}});
});
},"dojox/grid/_Grid":function(){
require({cache:{"url:dojox/grid/resources/_Grid.html":"<div hidefocus=\"hidefocus\" role=\"grid\" dojoAttachEvent=\"onmouseout:_mouseOut\">\n\t<div class=\"dojoxGridMasterHeader\" dojoAttachPoint=\"viewsHeaderNode\" role=\"presentation\"></div>\n\t<div class=\"dojoxGridMasterView\" dojoAttachPoint=\"viewsNode\" role=\"presentation\"></div>\n\t<div class=\"dojoxGridMasterMessages\" style=\"display: none;\" dojoAttachPoint=\"messagesNode\"></div>\n\t<span dojoAttachPoint=\"lastFocusNode\" tabindex=\"0\"></span>\n</div>\n"}});
define("dojox/grid/_Grid",["dojo/_base/kernel","../main","dojo/_base/declare","./_Events","./_Scroller","./_Layout","./_View","./_ViewManager","./_RowManager","./_FocusManager","./_EditManager","./Selection","./_RowSelector","./util","dijit/_Widget","dijit/_TemplatedMixin","dijit/CheckedMenuItem","dojo/text!./resources/_Grid.html","dojo/string","dojo/_base/array","dojo/_base/lang","dojo/_base/sniff","dojox/html/metrics","dojo/_base/html","dojo/query","dojo/dnd/common","dojo/i18n!dijit/nls/loading"],function(dojo,dojox,_20be,_20bf,_20c0,_20c1,_20c2,_20c3,_20c4,_20c5,_20c6,_20c7,_20c8,util,_20c9,_20ca,_20cb,_20cc,_20cd,array,lang,has,_20ce,html,query){
if(!dojo.isCopyKey){
dojo.isCopyKey=dojo.dnd.getCopyKeyState;
}
var _20cf=_20be("dojox.grid._Grid",[_20c9,_20ca,_20bf],{templateString:_20cc,classTag:"dojoxGrid",rowCount:5,keepRows:75,rowsPerPage:25,autoWidth:false,initialWidth:"",autoHeight:"",rowHeight:0,autoRender:true,defaultHeight:"15em",height:"",structure:null,elasticView:-1,singleClickEdit:false,selectionMode:"extended",rowSelector:"",columnReordering:false,headerMenu:null,placeholderLabel:"GridColumns",selectable:false,_click:null,loadingMessage:"<span class='dojoxGridLoading'>${loadingState}</span>",errorMessage:"<span class='dojoxGridError'>${errorState}</span>",noDataMessage:"",escapeHTMLInData:true,formatterScope:null,editable:false,summary:"",_setSummaryAttr:"domNode",sortInfo:0,_placeholders:null,_layoutClass:_20c1,buildRendering:function(){
this.inherited(arguments);
if(!this.domNode.getAttribute("tabIndex")){
this.domNode.tabIndex="0";
}
this.createScroller();
this.createLayout();
this.createViews();
this.createManagers();
this.createSelection();
this.connect(this.selection,"onSelected","onSelected");
this.connect(this.selection,"onDeselected","onDeselected");
this.connect(this.selection,"onChanged","onSelectionChanged");
_20ce.initOnFontResize();
this.connect(_20ce,"onFontResize","textSizeChanged");
util.funnelEvents(this.domNode,this,"doKeyEvent",util.keyEvents);
if(this.selectionMode!="none"){
this.domNode.setAttribute("aria-multiselectable",this.selectionMode=="single"?"false":"true");
}
html.addClass(this.domNode,this.classTag);
if(!this.isLeftToRight()){
html.addClass(this.domNode,this.classTag+"Rtl");
}
},postMixInProperties:function(){
this.inherited(arguments);
var _20d0=dojo.i18n.getLocalization("dijit","loading",this.lang);
this.loadingMessage=_20cd.substitute(this.loadingMessage,_20d0);
this.errorMessage=_20cd.substitute(this.errorMessage,_20d0);
if(this.srcNodeRef&&this.srcNodeRef.style.height){
this.height=this.srcNodeRef.style.height;
}
this._setAutoHeightAttr(this.autoHeight,true);
this.lastScrollTop=this.scrollTop=0;
},postCreate:function(){
this._placeholders=[];
this._setHeaderMenuAttr(this.headerMenu);
this._setStructureAttr(this.structure);
this._click=[];
this.inherited(arguments);
if(this.domNode&&this.autoWidth&&this.initialWidth){
this.domNode.style.width=this.initialWidth;
}
if(this.domNode&&!this.editable){
html.attr(this.domNode,"aria-readonly","true");
}
},destroy:function(){
this.domNode.onReveal=null;
this.domNode.onSizeChange=null;
delete this._click;
if(this.scroller){
this.scroller.destroy();
delete this.scroller;
}
this.edit.destroy();
delete this.edit;
this.views.destroyViews();
if(this.focus){
this.focus.destroy();
delete this.focus;
}
if(this.headerMenu&&this._placeholders.length){
array.forEach(this._placeholders,function(p){
p.unReplace(true);
});
this.headerMenu.unBindDomNode(this.viewsHeaderNode);
}
this.inherited(arguments);
},_setAutoHeightAttr:function(ah,_20d1){
if(typeof ah=="string"){
if(!ah||ah=="false"){
ah=false;
}else{
if(ah=="true"){
ah=true;
}else{
ah=window.parseInt(ah,10);
}
}
}
if(typeof ah=="number"){
if(isNaN(ah)){
ah=false;
}
if(ah<0){
ah=true;
}else{
if(ah===0){
ah=false;
}
}
}
this.autoHeight=ah;
if(typeof ah=="boolean"){
this._autoHeight=ah;
}else{
if(typeof ah=="number"){
this._autoHeight=(ah>=this.get("rowCount"));
}else{
this._autoHeight=false;
}
}
if(this._started&&!_20d1){
this.render();
}
},_getRowCountAttr:function(){
return this.updating&&this.invalidated&&this.invalidated.rowCount!=undefined?this.invalidated.rowCount:this.rowCount;
},textSizeChanged:function(){
this.render();
},sizeChange:function(){
this.update();
},createManagers:function(){
this.rows=new _20c4(this);
this.focus=new _20c5(this);
this.edit=new _20c6(this);
},createSelection:function(){
this.selection=new _20c7(this);
},createScroller:function(){
this.scroller=new _20c0();
this.scroller.grid=this;
this.scroller.renderRow=lang.hitch(this,"renderRow");
this.scroller.removeRow=lang.hitch(this,"rowRemoved");
},createLayout:function(){
this.layout=new this._layoutClass(this);
this.connect(this.layout,"moveColumn","onMoveColumn");
},onMoveColumn:function(){
this.update();
},onResizeColumn:function(_20d2){
},createViews:function(){
this.views=new _20c3(this);
this.views.createView=lang.hitch(this,"createView");
},createView:function(_20d3,idx){
var c=lang.getObject(_20d3);
var view=new c({grid:this,index:idx});
this.viewsNode.appendChild(view.domNode);
this.viewsHeaderNode.appendChild(view.headerNode);
this.views.addView(view);
html.attr(this.domNode,"align",this.isLeftToRight()?"left":"right");
return view;
},buildViews:function(){
for(var i=0,vs;(vs=this.layout.structure[i]);i++){
this.createView(vs.type||dojox._scopeName+".grid._View",i).setStructure(vs);
}
this.scroller.setContentNodes(this.views.getContentNodes());
},_setStructureAttr:function(_20d4){
var s=_20d4;
if(s&&lang.isString(s)){
dojo.deprecated("dojox.grid._Grid.set('structure', 'objVar')","use dojox.grid._Grid.set('structure', objVar) instead","2.0");
s=lang.getObject(s);
}
this.structure=s;
if(!s){
if(this.layout.structure){
s=this.layout.structure;
}else{
return;
}
}
this.views.destroyViews();
this.focus.focusView=null;
if(s!==this.layout.structure){
this.layout.setStructure(s);
}
this._structureChanged();
},setStructure:function(_20d5){
dojo.deprecated("dojox.grid._Grid.setStructure(obj)","use dojox.grid._Grid.set('structure', obj) instead.","2.0");
this._setStructureAttr(_20d5);
},getColumnTogglingItems:function(){
var items,_20d6=[];
items=array.map(this.layout.cells,function(cell){
if(!cell.menuItems){
cell.menuItems=[];
}
var self=this;
var item=new _20cb({label:cell.name,checked:!cell.hidden,_gridCell:cell,onChange:function(_20d7){
if(self.layout.setColumnVisibility(this._gridCell.index,_20d7)){
var items=this._gridCell.menuItems;
if(items.length>1){
array.forEach(items,function(item){
if(item!==this){
item.setAttribute("checked",_20d7);
}
},this);
}
_20d7=array.filter(self.layout.cells,function(c){
if(c.menuItems.length>1){
array.forEach(c.menuItems,"item.set('disabled', false);");
}else{
c.menuItems[0].set("disabled",false);
}
return !c.hidden;
});
if(_20d7.length==1){
array.forEach(_20d7[0].menuItems,"item.set('disabled', true);");
}
}
},destroy:function(){
var index=array.indexOf(this._gridCell.menuItems,this);
this._gridCell.menuItems.splice(index,1);
delete this._gridCell;
_20cb.prototype.destroy.apply(this,arguments);
}});
cell.menuItems.push(item);
if(!cell.hidden){
_20d6.push(item);
}
return item;
},this);
if(_20d6.length==1){
_20d6[0].set("disabled",true);
}
return items;
},_setHeaderMenuAttr:function(menu){
if(this._placeholders&&this._placeholders.length){
array.forEach(this._placeholders,function(p){
p.unReplace(true);
});
this._placeholders=[];
}
if(this.headerMenu){
this.headerMenu.unBindDomNode(this.viewsHeaderNode);
}
this.headerMenu=menu;
if(!menu){
return;
}
this.headerMenu.bindDomNode(this.viewsHeaderNode);
if(this.headerMenu.getPlaceholders){
this._placeholders=this.headerMenu.getPlaceholders(this.placeholderLabel);
}
},setHeaderMenu:function(menu){
dojo.deprecated("dojox.grid._Grid.setHeaderMenu(obj)","use dojox.grid._Grid.set('headerMenu', obj) instead.","2.0");
this._setHeaderMenuAttr(menu);
},setupHeaderMenu:function(){
if(this._placeholders&&this._placeholders.length){
array.forEach(this._placeholders,function(p){
if(p._replaced){
p.unReplace(true);
}
p.replace(this.getColumnTogglingItems());
},this);
}
},_fetch:function(start){
this.setScrollTop(0);
},getItem:function(_20d8){
return null;
},showMessage:function(_20d9){
if(_20d9){
this.messagesNode.innerHTML=_20d9;
this.messagesNode.style.display="";
}else{
this.messagesNode.innerHTML="";
this.messagesNode.style.display="none";
}
},_structureChanged:function(){
this.buildViews();
if(this.autoRender&&this._started){
this.render();
}
},hasLayout:function(){
return this.layout.cells.length;
},resize:function(_20da,_20db){
if(dojo.isIE&&!_20da&&!_20db&&this._autoHeight){
return;
}
this._pendingChangeSize=_20da;
this._pendingResultSize=_20db;
this.sizeChange();
},_getPadBorder:function(){
this._padBorder=this._padBorder||html._getPadBorderExtents(this.domNode);
return this._padBorder;
},_getHeaderHeight:function(){
var vns=this.viewsHeaderNode.style,t=vns.display=="none"?0:this.views.measureHeader();
vns.height=t+"px";
this.views.normalizeHeaderNodeHeight();
return t;
},_resize:function(_20dc,_20dd){
_20dc=_20dc||this._pendingChangeSize;
_20dd=_20dd||this._pendingResultSize;
delete this._pendingChangeSize;
delete this._pendingResultSize;
if(!this.domNode){
return;
}
var pn=this.domNode.parentNode;
if(!pn||pn.nodeType!=1||!this.hasLayout()||pn.style.visibility=="hidden"||pn.style.display=="none"){
return;
}
var _20de=this._getPadBorder();
var hh=undefined;
var h;
if(this._autoHeight){
this.domNode.style.height="auto";
}else{
if(typeof this.autoHeight=="number"){
h=hh=this._getHeaderHeight();
h+=(this.scroller.averageRowHeight*this.autoHeight);
this.domNode.style.height=h+"px";
}else{
if(this.domNode.clientHeight<=_20de.h){
if(pn==document.body){
this.domNode.style.height=this.defaultHeight;
}else{
if(this.height){
this.domNode.style.height=this.height;
}else{
this.fitTo="parent";
}
}
}
}
}
if(_20dd){
_20dc=_20dd;
}
if(!this._autoHeight&&_20dc){
html.marginBox(this.domNode,_20dc);
this.height=this.domNode.style.height;
delete this.fitTo;
}else{
if(this.fitTo=="parent"){
h=this._parentContentBoxHeight=this._parentContentBoxHeight||html._getContentBox(pn).h;
this.domNode.style.height=Math.max(0,h)+"px";
}
}
var _20df=array.some(this.views.views,function(v){
return v.flexCells;
});
if(!this._autoHeight&&(h||html._getContentBox(this.domNode).h)===0){
this.viewsHeaderNode.style.display="none";
}else{
this.viewsHeaderNode.style.display="block";
if(!_20df&&hh===undefined){
hh=this._getHeaderHeight();
}
}
if(_20df){
hh=undefined;
}
this.adaptWidth();
this.adaptHeight(hh);
this.postresize();
},adaptWidth:function(){
var _20e0=(!this.initialWidth&&this.autoWidth);
var w=_20e0?0:this.domNode.clientWidth||(this.domNode.offsetWidth-this._getPadBorder().w),vw=this.views.arrange(1,w);
this.views.onEach("adaptWidth");
if(_20e0){
this.domNode.style.width=vw+"px";
}
},adaptHeight:function(_20e1){
var t=_20e1===undefined?this._getHeaderHeight():_20e1;
var h=(this._autoHeight?-1:Math.max(this.domNode.clientHeight-t,0)||0);
this.views.onEach("setSize",[0,h]);
this.views.onEach("adaptHeight");
if(!this._autoHeight){
var _20e2=0,_20e3=0;
var _20e4=array.filter(this.views.views,function(v){
var has=v.hasHScrollbar();
if(has){
_20e2++;
}else{
_20e3++;
}
return (!has);
});
if(_20e2>0&&_20e3>0){
array.forEach(_20e4,function(v){
v.adaptHeight(true);
});
}
}
if(this.autoHeight===true||h!=-1||(typeof this.autoHeight=="number"&&this.autoHeight>=this.get("rowCount"))){
this.scroller.windowHeight=h;
}else{
this.scroller.windowHeight=Math.max(this.domNode.clientHeight-t,0);
}
},startup:function(){
if(this._started){
return;
}
this.inherited(arguments);
if(this.autoRender){
this.render();
}
},render:function(){
if(!this.domNode){
return;
}
if(!this._started){
return;
}
if(!this.hasLayout()){
this.scroller.init(0,this.keepRows,this.rowsPerPage);
return;
}
this.update=this.defaultUpdate;
this._render();
},_render:function(){
this.scroller.init(this.get("rowCount"),this.keepRows,this.rowsPerPage);
this.prerender();
this.setScrollTop(0);
this.postrender();
},prerender:function(){
this.keepRows=this._autoHeight?0:this.keepRows;
this.scroller.setKeepInfo(this.keepRows);
this.views.render();
this._resize();
},postrender:function(){
this.postresize();
this.focus.initFocusView();
html.setSelectable(this.domNode,this.selectable);
},postresize:function(){
if(this._autoHeight){
var size=Math.max(this.views.measureContent())+"px";
this.viewsNode.style.height=size;
}
},renderRow:function(_20e5,_20e6){
this.views.renderRow(_20e5,_20e6,this._skipRowRenormalize);
},rowRemoved:function(_20e7){
this.views.rowRemoved(_20e7);
},invalidated:null,updating:false,beginUpdate:function(){
this.invalidated=[];
this.updating=true;
},endUpdate:function(){
this.updating=false;
var i=this.invalidated,r;
if(i.all){
this.update();
}else{
if(i.rowCount!=undefined){
this.updateRowCount(i.rowCount);
}else{
for(r in i){
this.updateRow(Number(r));
}
}
}
this.invalidated=[];
},defaultUpdate:function(){
if(!this.domNode){
return;
}
if(this.updating){
this.invalidated.all=true;
return;
}
this.lastScrollTop=this.scrollTop;
this.prerender();
this.scroller.invalidateNodes();
this.setScrollTop(this.lastScrollTop);
this.postrender();
},update:function(){
this.render();
},updateRow:function(_20e8){
_20e8=Number(_20e8);
if(this.updating){
this.invalidated[_20e8]=true;
}else{
this.views.updateRow(_20e8);
this.scroller.rowHeightChanged(_20e8);
}
},updateRows:function(_20e9,_20ea){
_20e9=Number(_20e9);
_20ea=Number(_20ea);
var i;
if(this.updating){
for(i=0;i<_20ea;i++){
this.invalidated[i+_20e9]=true;
}
}else{
for(i=0;i<_20ea;i++){
this.views.updateRow(i+_20e9,this._skipRowRenormalize);
}
this.scroller.rowHeightChanged(_20e9);
}
},updateRowCount:function(_20eb){
if(this.updating){
this.invalidated.rowCount=_20eb;
}else{
this.rowCount=_20eb;
this._setAutoHeightAttr(this.autoHeight,true);
if(this.layout.cells.length){
this.scroller.updateRowCount(_20eb);
}
this._resize();
if(this.layout.cells.length){
this.setScrollTop(this.scrollTop);
}
}
},updateRowStyles:function(_20ec){
this.views.updateRowStyles(_20ec);
},getRowNode:function(_20ed){
if(this.focus.focusView&&!(this.focus.focusView instanceof _20c8)){
return this.focus.focusView.rowNodes[_20ed];
}else{
for(var i=0,cView;(cView=this.views.views[i]);i++){
if(!(cView instanceof _20c8)){
return cView.rowNodes[_20ed];
}
}
}
return null;
},rowHeightChanged:function(_20ee){
this.views.renormalizeRow(_20ee);
this.scroller.rowHeightChanged(_20ee);
},fastScroll:true,delayScroll:false,scrollRedrawThreshold:(has("ie")?100:50),scrollTo:function(inTop){
if(!this.fastScroll){
this.setScrollTop(inTop);
return;
}
var delta=Math.abs(this.lastScrollTop-inTop);
this.lastScrollTop=inTop;
if(delta>this.scrollRedrawThreshold||this.delayScroll){
this.delayScroll=true;
this.scrollTop=inTop;
this.views.setScrollTop(inTop);
if(this._pendingScroll){
window.clearTimeout(this._pendingScroll);
}
var _20ef=this;
this._pendingScroll=window.setTimeout(function(){
delete _20ef._pendingScroll;
_20ef.finishScrollJob();
},200);
}else{
this.setScrollTop(inTop);
}
},finishScrollJob:function(){
this.delayScroll=false;
this.setScrollTop(this.scrollTop);
},setScrollTop:function(inTop){
this.scroller.scroll(this.views.setScrollTop(inTop));
},scrollToRow:function(_20f0){
this.setScrollTop(this.scroller.findScrollTop(_20f0)+1);
},styleRowNode:function(_20f1,_20f2){
if(_20f2){
this.rows.styleRowNode(_20f1,_20f2);
}
},_mouseOut:function(e){
this.rows.setOverRow(-2);
},getCell:function(_20f3){
return this.layout.cells[_20f3];
},setCellWidth:function(_20f4,_20f5){
this.getCell(_20f4).unitWidth=_20f5;
},getCellName:function(_20f6){
return "Cell "+_20f6.index;
},canSort:function(_20f7){
},sort:function(){
},getSortAsc:function(_20f8){
_20f8=_20f8==undefined?this.sortInfo:_20f8;
return Boolean(_20f8>0);
},getSortIndex:function(_20f9){
_20f9=_20f9==undefined?this.sortInfo:_20f9;
return Math.abs(_20f9)-1;
},setSortIndex:function(_20fa,inAsc){
var si=_20fa+1;
if(inAsc!=undefined){
si*=(inAsc?1:-1);
}else{
if(this.getSortIndex()==_20fa){
si=-this.sortInfo;
}
}
this.setSortInfo(si);
},setSortInfo:function(_20fb){
if(this.canSort(_20fb)){
this.sortInfo=_20fb;
this.sort();
this.update();
}
},doKeyEvent:function(e){
e.dispatch="do"+e.type;
this.onKeyEvent(e);
},_dispatch:function(m,e){
if(m in this){
return this[m](e);
}
return false;
},dispatchKeyEvent:function(e){
this._dispatch(e.dispatch,e);
},dispatchContentEvent:function(e){
this.edit.dispatchEvent(e)||e.sourceView.dispatchContentEvent(e)||this._dispatch(e.dispatch,e);
},dispatchHeaderEvent:function(e){
e.sourceView.dispatchHeaderEvent(e)||this._dispatch("doheader"+e.type,e);
},dokeydown:function(e){
this.onKeyDown(e);
},doclick:function(e){
if(e.cellNode){
this.onCellClick(e);
}else{
this.onRowClick(e);
}
},dodblclick:function(e){
if(e.cellNode){
this.onCellDblClick(e);
}else{
this.onRowDblClick(e);
}
},docontextmenu:function(e){
if(e.cellNode){
this.onCellContextMenu(e);
}else{
this.onRowContextMenu(e);
}
},doheaderclick:function(e){
if(e.cellNode){
this.onHeaderCellClick(e);
}else{
this.onHeaderClick(e);
}
},doheaderdblclick:function(e){
if(e.cellNode){
this.onHeaderCellDblClick(e);
}else{
this.onHeaderDblClick(e);
}
},doheadercontextmenu:function(e){
if(e.cellNode){
this.onHeaderCellContextMenu(e);
}else{
this.onHeaderContextMenu(e);
}
},doStartEdit:function(_20fc,_20fd){
this.onStartEdit(_20fc,_20fd);
},doApplyCellEdit:function(_20fe,_20ff,_2100){
this.onApplyCellEdit(_20fe,_20ff,_2100);
},doCancelEdit:function(_2101){
this.onCancelEdit(_2101);
},doApplyEdit:function(_2102){
this.onApplyEdit(_2102);
},addRow:function(){
this.updateRowCount(this.get("rowCount")+1);
},removeSelectedRows:function(){
if(this.allItemsSelected){
this.updateRowCount(0);
}else{
this.updateRowCount(Math.max(0,this.get("rowCount")-this.selection.getSelected().length));
}
this.selection.clear();
}});
_20cf.markupFactory=function(props,node,ctor,_2103){
var _2104=function(n){
var w=html.attr(n,"width")||"auto";
if((w!="auto")&&(w.slice(-2)!="em")&&(w.slice(-1)!="%")){
w=parseInt(w,10)+"px";
}
return w;
};
if(!props.structure&&node.nodeName.toLowerCase()=="table"){
props.structure=query("> colgroup",node).map(function(cg){
var sv=html.attr(cg,"span");
var v={noscroll:(html.attr(cg,"noscroll")=="true")?true:false,__span:(!!sv?parseInt(sv,10):1),cells:[]};
if(html.hasAttr(cg,"width")){
v.width=_2104(cg);
}
return v;
});
if(!props.structure.length){
props.structure.push({__span:Infinity,cells:[]});
}
query("thead > tr",node).forEach(function(tr,_2105){
var _2106=0;
var _2107=0;
var _2108;
var cView=null;
query("> th",tr).map(function(th){
if(!cView){
_2108=0;
cView=props.structure[0];
}else{
if(_2106>=(_2108+cView.__span)){
_2107++;
_2108+=cView.__span;
var _2109=cView;
cView=props.structure[_2107];
}
}
var cell={name:lang.trim(html.attr(th,"name")||th.innerHTML),colSpan:parseInt(html.attr(th,"colspan")||1,10),type:lang.trim(html.attr(th,"cellType")||""),id:lang.trim(html.attr(th,"id")||"")};
_2106+=cell.colSpan;
var _210a=html.attr(th,"rowspan");
if(_210a){
cell.rowSpan=_210a;
}
if(html.hasAttr(th,"width")){
cell.width=_2104(th);
}
if(html.hasAttr(th,"relWidth")){
cell.relWidth=window.parseInt(html.attr(th,"relWidth"),10);
}
if(html.hasAttr(th,"hidden")){
cell.hidden=(html.attr(th,"hidden")=="true"||html.attr(th,"hidden")===true);
}
if(_2103){
_2103(th,cell);
}
cell.type=cell.type?lang.getObject(cell.type):dojox.grid.cells.Cell;
if(cell.type&&cell.type.markupFactory){
cell.type.markupFactory(th,cell);
}
if(!cView.cells[_2105]){
cView.cells[_2105]=[];
}
cView.cells[_2105].push(cell);
});
});
}
return new ctor(props,node);
};
return _20cf;
});
},"davinci/ve/widgets/CommonProperties":function(){
define(["dojo/_base/declare","davinci/workbench/ViewLite","davinci/ve/commands/ModifyCommand"],function(_210b,_210c,_210d){
return _210b("davinci.ve.widgets.CommonProperties",[_210c],{buildRendering:function(){
var props=["title"];
var _210e="<table width='100%' class='property_table_stretchable' border='0' cellspacing='0' cellpadding='0'>";
_210e+="<colgroup>";
_210e+="<col style='width:15px;' />";
_210e+="<col class='gap02' />";
_210e+="<col class='gap03' />";
_210e+="<col style='width:15px;' />";
_210e+="</colgroup>";
var id=0;
this._boxes={};
for(var i=0;i<props.length;i++){
this._boxes[props[i]]={value:""};
this._boxes[props[i]].id="davinci_properties_event_"+id++ +"_combo";
_210e+="<tr>";
_210e+="<td/>";
_210e+="<td class='propertyDisplayName'>";
_210e+=props[i]+":";
_210e+="</td>";
_210e+="<td>";
_210e+="<input type='text' id='"+this._boxes[props[i]].id+"'></input>";
_210e+="</td>";
_210e+="<td/>";
_210e+="</tr>";
}
_210e+="</table>";
this.domNode=dojo.doc.createElement("div");
this.domNode.innerHTML=_210e;
dojo.subscribe("/davinci/ui/widgetValuesChanged",dojo.hitch(this,this.onWidgetSelectionChange));
dojo.subscribe("/davinci/ui/widget/replaced",dojo.hitch(this,this._widgetReplaced));
this.inherited(arguments);
},onEditorSelected:function(_210f){
if(this._editor&&this._editor.getContext){
this.context=this._editor.getContext();
this._setValues();
}else{
this._widget=this._subwidget=null;
this.context=null;
this._clearValues();
}
},startup:function(){
this.inherited(arguments);
function _2110(_2111){
return function(){
return this._onChange({target:_2111});
};
};
for(var name in this._boxes){
this._boxes[name].domNode=dojo.byId(this._boxes[name]["id"]);
dojo.connect(this._boxes[name].domNode,"onchange",this,_2110(name));
dojo.connect(this._boxes[name].domNode,"onfocus",this,"_onFocus");
dojo.connect(this._boxes[name].domNode,"onblur",this,"_onBlur");
}
},_onFocus:function(){
if(this.context){
this.context.blockChange(true);
}
},_onBlur:function(){
if(this.context){
this.context.blockChange(false);
}
},_onChange:function(a){
var _2112=a.target;
var value=dojo.attr(this._boxes[_2112].domNode,"value");
if(this.context){
this.context.blockChange(false);
}
if(this._boxes[_2112].value!=value){
this._boxes[_2112].value=value;
var _2113={};
_2113[_2112]=value;
var _2114=new _210d(this._widget,_2113,null);
dojo.publish("/davinci/ui/widgetPropertiesChanges",[{source:this._editor.editor_id,command:_2114}]);
}
},_widgetReplaced:function(_2115,_2116){
if(this._widget===_2116){
this._widget=_2115;
this.onWidgetSelectionChange();
}
},onWidgetSelectionChange:function(){
if(!this._widget){
this.set("readOnly",true);
this._clearValues();
return;
}else{
this._setValues();
this.set("readOnly",false);
}
},_clearValues:function(){
for(name in this._boxes){
if(this._boxes[name].domNode){
dojo.attr(this._boxes[name].domNode,"value","");
}
this._boxes[name].value=null;
}
},_setValues:function(){
if(!this._widget){
return;
}
for(var name in this._boxes){
var _2117=this._widget,box=this._boxes[name];
if(box.domNode&&box.domNode.ownerDocument){
if(_2117.getPropertyValue){
var value=_2117.getPropertyValue(name);
if(box.value!=value){
box.value=value;
dojo.attr(box.domNode,"value",box.value);
}
}else{
box.value="";
dojo.attr(box.domNode,"value","");
}
}
}
}});
});
},"dijit/layout/TabController":function(){
require({cache:{"url:dijit/layout/templates/_TabButton.html":"<div role=\"presentation\" data-dojo-attach-point=\"titleNode,innerDiv,tabContent\" class=\"dijitTabInner dijitTabContent\">\n\t<img src=\"${_blankGif}\" alt=\"\" class=\"dijitIcon dijitTabButtonIcon\" data-dojo-attach-point='iconNode'/>\n\t<span data-dojo-attach-point='containerNode,focusNode' class='tabLabel'></span>\n\t<span class=\"dijitInline dijitTabCloseButton dijitTabCloseIcon\" data-dojo-attach-point='closeNode'\n\t\t  role=\"presentation\">\n\t\t<span data-dojo-attach-point='closeText' class='dijitTabCloseText'>[x]</span\n\t\t\t\t></span>\n</div>\n"}});
define("dijit/layout/TabController",["dojo/_base/declare","dojo/dom","dojo/dom-attr","dojo/dom-class","dojo/i18n","dojo/_base/lang","./StackController","../registry","../Menu","../MenuItem","dojo/text!./templates/_TabButton.html","dojo/i18n!../nls/common"],function(_2118,dom,_2119,_211a,i18n,lang,_211b,_211c,Menu,_211d,_211e){
var _211f=_2118("dijit.layout._TabButton",_211b.StackButton,{baseClass:"dijitTab",cssStateNodes:{closeNode:"dijitTabCloseButton"},templateString:_211e,scrollOnFocus:false,buildRendering:function(){
this.inherited(arguments);
dom.setSelectable(this.containerNode,false);
},startup:function(){
this.inherited(arguments);
var n=this.domNode;
this.defer(function(){
n.className=n.className;
},1);
},_setCloseButtonAttr:function(disp){
this._set("closeButton",disp);
_211a.toggle(this.domNode,"dijitClosable",disp);
this.closeNode.style.display=disp?"":"none";
if(disp){
var _2120=i18n.getLocalization("dijit","common");
if(this.closeNode){
_2119.set(this.closeNode,"title",_2120.itemClose);
}
}
},_setDisabledAttr:function(_2121){
this.inherited(arguments);
if(this.closeNode){
if(_2121){
_2119.remove(this.closeNode,"title");
}else{
var _2122=i18n.getLocalization("dijit","common");
_2119.set(this.closeNode,"title",_2122.itemClose);
}
}
},_setLabelAttr:function(_2123){
this.inherited(arguments);
if(!this.showLabel&&!this.params.title){
this.iconNode.alt=lang.trim(this.containerNode.innerText||this.containerNode.textContent||"");
}
}});
var _2124=_2118("dijit.layout.TabController",_211b,{baseClass:"dijitTabController",templateString:"<div role='tablist' data-dojo-attach-event='onkeypress:onkeypress'></div>",tabPosition:"top",buttonWidget:_211f,buttonWidgetCloseClass:"dijitTabCloseButton",postCreate:function(){
this.inherited(arguments);
var _2125=new Menu({id:this.id+"_Menu",ownerDocument:this.ownerDocument,dir:this.dir,lang:this.lang,textDir:this.textDir,targetNodeIds:[this.domNode],selector:function(node){
return _211a.contains(node,"dijitClosable")&&!_211a.contains(node,"dijitTabDisabled");
}});
this.own(_2125);
var _2126=i18n.getLocalization("dijit","common"),_2127=this;
_2125.addChild(new _211d({label:_2126.itemClose,ownerDocument:this.ownerDocument,dir:this.dir,lang:this.lang,textDir:this.textDir,onClick:function(evt){
var _2128=_211c.byNode(this.getParent().currentTarget);
_2127.onCloseButtonClick(_2128.page);
}}));
}});
_2124.TabButton=_211f;
return _2124;
});
},"url:dojox/form/resources/Uploader.html":"<span class=\"dijit dijitReset dijitInline\"\n\t><span class=\"dijitReset dijitInline dijitButtonNode\"\n\t\tdojoAttachEvent=\"ondijitclick:_onClick\"\n\t\t><span class=\"dijitReset dijitStretch dijitButtonContents\"\n\t\t\tdojoAttachPoint=\"titleNode,focusNode\"\n\t\t\trole=\"button\" aria-labelledby=\"${id}_label\"\n\t\t\t><span class=\"dijitReset dijitInline dijitIcon\" dojoAttachPoint=\"iconNode\"></span\n\t\t\t><span class=\"dijitReset dijitToggleButtonIconChar\">&#x25CF;</span\n\t\t\t><span class=\"dijitReset dijitInline dijitButtonText\"\n\t\t\t\tid=\"${id}_label\"\n\t\t\t\tdojoAttachPoint=\"containerNode\"\n\t\t\t></span\n\t\t></span\n\t></span\n\t><!--no need to have this for Uploader \n\t<input ${!nameAttrSetting} type=\"${type}\" value=\"${value}\" class=\"dijitOffScreen\" tabIndex=\"-1\"\n\t\tdojoAttachPoint=\"valueNode\"\n/--></span>\n","davinci/ve/actions/ViewSplitVMenuAction":function(){
define("davinci/ve/actions/ViewSplitVMenuAction",["dojo/_base/declare","davinci/ve/actions/ContextAction"],function(_2129,_212a){
return _2129("davinci.ve.actions.ViewSplitVMenuAction",[_212a],{run:function(_212b){
_212b=this.fixupContext(_212b);
if(_212b&&_212b.editor&&_212b.editor.switchDisplayModeSplitVertical){
_212b.editor.switchDisplayModeSplitVertical();
}
}});
});
},"davinci/ve/actions/_ReorderAction":function(){
define(["dojo/_base/declare","dojo/_base/array","dojo/dom-style","davinci/ve/actions/ContextAction"],function(_212c,Array,_212d,_212e){
return _212c("davinci.ve.actions._ReorderAction",[_212e],{shouldShow:function(_212f){
_212f=this.fixupContext(_212f);
return _212f&&_212f.editor&&_212f.editor.editorID=="davinci.ve.HTMLPageEditor";
},selectionSameParentAllAbsolute:function(_2130){
if(_2130.length===0){
return false;
}
var _2131=_2130[0].getParent();
for(var i=0;i<_2130.length;i++){
var _2132=_2130[i];
if(_2132.getParent()!=_2131){
return false;
}
var _2133=(_2132&&_2132.domNode)?_212d.get(_2132.domNode,"position"):null;
if(_2133!="absolute"){
return false;
}
}
return true;
},selectionSameParentAllAbsoluteAdjacent:function(_2134){
if(!_2134||_2134.length===0||!this.selectionSameParentAllAbsolute(_2134)){
return false;
}
var _2135=_2134[0].getParent();
var _2136=_2135.getChildren();
var _2137=Number.MAX_VALUE;
var _2138=Number.MIN_VALUE;
for(var i=0;i<_2136.length;i++){
var child=_2136[i];
var index=_2134.indexOf(child);
if(index>=0){
_2137=(i<_2137)?i:_2137;
_2138=(i>_2138)?i:_2138;
}
}
if(_2138-_2137+1===_2134.length){
return true;
}else{
return false;
}
},getAbsoluteSiblings:function(_2139){
var _213a=(_2139&&_2139.getParent&&_2139.getParent());
if(!_213a){
return [];
}
var _213b=(_213a.getChildren&&_213a.getChildren());
if(!_213b){
return [];
}
var _213c=Array.filter(_213b,function(item){
var _213d=(item&&item.domNode)?_212d.get(item.domNode,"position"):null;
return (_213d=="absolute");
});
return _213c;
}});
});
},"dijit/form/DropDownButton":function(){
require({cache:{"url:dijit/form/templates/DropDownButton.html":"<span class=\"dijit dijitReset dijitInline\"\n\t><span class='dijitReset dijitInline dijitButtonNode'\n\t\tdata-dojo-attach-event=\"ondijitclick:_onClick\" data-dojo-attach-point=\"_buttonNode\"\n\t\t><span class=\"dijitReset dijitStretch dijitButtonContents\"\n\t\t\tdata-dojo-attach-point=\"focusNode,titleNode,_arrowWrapperNode\"\n\t\t\trole=\"button\" aria-haspopup=\"true\" aria-labelledby=\"${id}_label\"\n\t\t\t><span class=\"dijitReset dijitInline dijitIcon\"\n\t\t\t\tdata-dojo-attach-point=\"iconNode\"\n\t\t\t></span\n\t\t\t><span class=\"dijitReset dijitInline dijitButtonText\"\n\t\t\t\tdata-dojo-attach-point=\"containerNode,_popupStateNode\"\n\t\t\t\tid=\"${id}_label\"\n\t\t\t></span\n\t\t\t><span class=\"dijitReset dijitInline dijitArrowButtonInner\"></span\n\t\t\t><span class=\"dijitReset dijitInline dijitArrowButtonChar\">&#9660;</span\n\t\t></span\n\t></span\n\t><input ${!nameAttrSetting} type=\"${type}\" value=\"${value}\" class=\"dijitOffScreen\" tabIndex=\"-1\"\n\t\tdata-dojo-attach-point=\"valueNode\"\n/></span>\n"}});
define("dijit/form/DropDownButton",["dojo/_base/declare","dojo/_base/lang","dojo/query","../registry","../popup","./Button","../_Container","../_HasDropDown","dojo/text!./templates/DropDownButton.html"],function(_213e,lang,query,_213f,popup,_2140,_2141,_2142,_2143){
return _213e("dijit.form.DropDownButton",[_2140,_2141,_2142],{baseClass:"dijitDropDownButton",templateString:_2143,_fillContent:function(){
if(this.srcNodeRef){
var nodes=query("*",this.srcNodeRef);
this.inherited(arguments,[nodes[0]]);
this.dropDownContainer=this.srcNodeRef;
}
},startup:function(){
if(this._started){
return;
}
if(!this.dropDown&&this.dropDownContainer){
var _2144=query("[widgetId]",this.dropDownContainer)[0];
this.dropDown=_213f.byNode(_2144);
delete this.dropDownContainer;
}
if(this.dropDown){
popup.hide(this.dropDown);
}
this.inherited(arguments);
},isLoaded:function(){
var _2145=this.dropDown;
return (!!_2145&&(!_2145.href||_2145.isLoaded));
},loadDropDown:function(_2146){
var _2147=this.dropDown;
var _2148=_2147.on("load",lang.hitch(this,function(){
_2148.remove();
_2146();
}));
_2147.refresh();
},isFocusable:function(){
return this.inherited(arguments)&&!this._mouseDown;
}});
});
},"url:davinci/ve/newfile.template.html":"<!DOCTYPE html>\n<!--\n\tTODO: margin:0 is a temporary hack. In previous releases, we always included dojo.css\n\twhich set margin:0, but we now only include dojo.css with the first Dojo widget\n\tadded to the page. That causes scrollbars when page was loaded initially,\n\twhich went want when first Dojo widget was added.\n\tNeed to rethink this whole business of width:100%;height:100%;margin:0\n-->\n<html style=\"height: 100%; width: 100%; margin: 0;\">\n\t<head>\n\t\t<base href=\"{baseUrl}\"/>\n\t\t<meta charset=\"utf-8\"/>\n\t\t<script src=\"{dojoUrl}\" data-dojo-config=\"{dojoConfig}\" {additionalDojoAttrs}></script>\n\t\t<script>\n\t\t\t// base dependencies needed for VE\n\t\t\trequire([\n\t\t\t\t'dojo/parser',\n\t\t\t\t'dojox/html/_base',\n\t\t\t\t'dojo/domReady!'\n\t\t\t\t{additionalModules}\n\t\t\t], top.loading{id});\n\t\t</script>\n\t\t{themeHeadImports}\n\t\t{themeCssFiles}\n\t</head>\n\t<body>\n\t</body>\n</html>\n","davinci/html/HTMLItem":function(){
define(["dojo/_base/declare","davinci/html/HTMLModel"],function(_2149,_214a){
return _2149("davinci.html.HTMLItem",_214a,{constructor:function(){
this.elementType="HTMLItem";
},getLabel:function(){
return this.getText({indent:0});
},onChange:function(arg){
if(this.parent){
if(arg){
this.parent.onChange(arg);
}
}
},_addWS:function(lines,_214b){
lines=lines||0;
_214b=_214b||0;
var res=[];
for(var i=0;i<lines;i++){
res.push("\n");
}
res.push("                                          ".substring(0,_214b));
return res.join("");
},close:function(){
for(var i=0;i<this.children.length;i++){
this.children[i].close();
}
},getID:function(){
return this.parent.getID()+":"+this.startOffset+":"+this.getLabel();
},getHTMLFile:function(){
var _214c=this;
while(_214c&&_214c.elementType!="HTMLFile"){
_214c=_214c.parent;
}
return _214c;
}});
});
},"davinci/html/CSSProperty":function(){
define(["dojo/_base/declare","davinci/html/CSSElement"],function(_214d,_214e){
return _214d("davinci.html.CSSProperty",_214e,{constructor:function(name,value,_214f){
this.elementType="CSSProperty";
this.name=name||"";
this.value=value||"";
this.parent=_214f;
this.expanded=[];
this.lengthValues=[];
},getValue:function(){
return this.value;
},getText:function(_2150){
var s="";
if(this.comment&&!_2150.noComments){
s+="\n  "+this.comment.getText(_2150);
}
s+=this.name+" : "+this.value;
if(this.isNotImportant){
s+=" !important";
}
s+=";";
if(this.postComment&&!_2150.noComments){
s+=this.postComment.getText(_2150);
}
return s;
},getCSSRule:function(){
return this.parent;
},addProperty:function(name,value){
var _2151=new CSSProperty(name,value,this);
this.properties.push(_2151);
},getURL:function(){
if(this.url){
var path=new davinci.model.Path(this.getCSSFile().url);
path=path.getParentPath().append(this.url);
return path.toString();
}
}});
});
},"url:dijit/form/templates/CheckBox.html":"<div class=\"dijit dijitReset dijitInline\" role=\"presentation\"\n\t><input\n\t \t${!nameAttrSetting} type=\"${type}\" ${checkedAttrSetting}\n\t\tclass=\"dijitReset dijitCheckBoxInput\"\n\t\tdata-dojo-attach-point=\"focusNode\"\n\t \tdata-dojo-attach-event=\"onclick:_onClick\"\n/></div>\n","dojo/dnd/autoscroll":function(){
define("dojo/dnd/autoscroll",["../_base/lang","../sniff","../_base/window","../dom-geometry","../dom-style","../window"],function(lang,has,win,_2152,_2153,_2154){
var _2155={};
lang.setObject("dojo.dnd.autoscroll",_2155);
_2155.getViewport=_2154.getBox;
_2155.V_TRIGGER_AUTOSCROLL=32;
_2155.H_TRIGGER_AUTOSCROLL=32;
_2155.V_AUTOSCROLL_VALUE=16;
_2155.H_AUTOSCROLL_VALUE=16;
var _2156,doc=win.doc,_2157=Infinity,_2158=Infinity;
_2155.autoScrollStart=function(d){
doc=d;
_2156=_2154.getBox(doc);
var html=win.body(doc).parentNode;
_2157=Math.max(html.scrollHeight-_2156.h,0);
_2158=Math.max(html.scrollWidth-_2156.w,0);
};
_2155.autoScroll=function(e){
var v=_2156||_2154.getBox(doc),html=win.body(doc).parentNode,dx=0,dy=0;
if(e.clientX<_2155.H_TRIGGER_AUTOSCROLL){
dx=-_2155.H_AUTOSCROLL_VALUE;
}else{
if(e.clientX>v.w-_2155.H_TRIGGER_AUTOSCROLL){
dx=Math.min(_2155.H_AUTOSCROLL_VALUE,_2158-html.scrollLeft);
}
}
if(e.clientY<_2155.V_TRIGGER_AUTOSCROLL){
dy=-_2155.V_AUTOSCROLL_VALUE;
}else{
if(e.clientY>v.h-_2155.V_TRIGGER_AUTOSCROLL){
dy=Math.min(_2155.V_AUTOSCROLL_VALUE,_2157-html.scrollTop);
}
}
window.scrollBy(dx,dy);
};
_2155._validNodes={"div":1,"p":1,"td":1};
_2155._validOverflow={"auto":1,"scroll":1};
_2155.autoScrollNodes=function(e){
var b,t,w,h,rx,ry,dx=0,dy=0,_2159,_215a;
for(var n=e.target;n;){
if(n.nodeType==1&&(n.tagName.toLowerCase() in _2155._validNodes)){
var s=_2153.getComputedStyle(n),_215b=(s.overflow.toLowerCase() in _2155._validOverflow),_215c=(s.overflowX.toLowerCase() in _2155._validOverflow),_215d=(s.overflowY.toLowerCase() in _2155._validOverflow);
if(_215b||_215c||_215d){
b=_2152.getContentBox(n,s);
t=_2152.position(n,true);
}
if(_215b||_215c){
w=Math.min(_2155.H_TRIGGER_AUTOSCROLL,b.w/2);
rx=e.pageX-t.x;
if(has("webkit")||has("opera")){
rx+=win.body().scrollLeft;
}
dx=0;
if(rx>0&&rx<b.w){
if(rx<w){
dx=-w;
}else{
if(rx>b.w-w){
dx=w;
}
}
_2159=n.scrollLeft;
n.scrollLeft=n.scrollLeft+dx;
}
}
if(_215b||_215d){
h=Math.min(_2155.V_TRIGGER_AUTOSCROLL,b.h/2);
ry=e.pageY-t.y;
if(has("webkit")||has("opera")){
ry+=win.body().scrollTop;
}
dy=0;
if(ry>0&&ry<b.h){
if(ry<h){
dy=-h;
}else{
if(ry>b.h-h){
dy=h;
}
}
_215a=n.scrollTop;
n.scrollTop=n.scrollTop+dy;
}
}
if(dx||dy){
return;
}
}
try{
n=n.parentNode;
}
catch(x){
n=null;
}
}
_2155.autoScroll(e);
};
return _2155;
});
},"url:dijit/form/templates/DropDownBox.html":"<div class=\"dijit dijitReset dijitInline dijitLeft\"\n\tid=\"widget_${id}\"\n\trole=\"combobox\"\n\t><div class='dijitReset dijitRight dijitButtonNode dijitArrowButton dijitDownArrowButton dijitArrowButtonContainer'\n\t\tdata-dojo-attach-point=\"_buttonNode, _popupStateNode\" role=\"presentation\"\n\t\t><input class=\"dijitReset dijitInputField dijitArrowButtonInner\" value=\"&#9660; \" type=\"text\" tabIndex=\"-1\" readonly=\"readonly\" role=\"presentation\"\n\t\t\t${_buttonInputDisabled}\n\t/></div\n\t><div class='dijitReset dijitValidationContainer'\n\t\t><input class=\"dijitReset dijitInputField dijitValidationIcon dijitValidationInner\" value=\"&#935; \" type=\"text\" tabIndex=\"-1\" readonly=\"readonly\" role=\"presentation\"\n\t/></div\n\t><div class=\"dijitReset dijitInputField dijitInputContainer\"\n\t\t><input class='dijitReset dijitInputInner' ${!nameAttrSetting} type=\"text\" autocomplete=\"off\"\n\t\t\tdata-dojo-attach-point=\"textbox,focusNode\" role=\"textbox\" aria-haspopup=\"true\"\n\t/></div\n></div>\n","url:davinci/ui/widgets/templates/NewHTMLFileOptions.html":"<div class=\"nhfo_outer2\" dojoAttachPoint=\"nhfo_outer2\">\t\t<!--  nhfo = NewHTMLFileOptions -->\n\t<div class=\"nhfo_outer1\">\n\t\t<div class=\"nhfo_details\">\n\t\t\t<table>\n\t\t\t\t<tr class=\"nhfo_dv\" dojoAttachPoint=\"deviceLabel\">\t<!--  dv = Device -->\n\t\t\t\t\t<td class='nhfo_label'>\n\t\t\t\t\t\t<label dojoAttachPoint=\"deviceLabel\"></label>\n\t\t\t\t\t\t<select dojoType=\"dijit.form.Select\" dojoAttachPoint=\"deviceSelect\">\n\t\t\t\t\t\t\t<!--  values added dynamically -->\n\t\t\t\t\t\t</select>\n\t\t\t\t\t</td>\n\t\t\t\t</tr>\n\t\t\t</table>\n\t\t</div>\n\t</div>\n</div>\n","orion/textview/rulers":function(){
define("orion/textview/rulers",["i18n!orion/textview/nls/messages","orion/textview/annotations","orion/textview/tooltip","orion/textview/i18nUtil"],function(_215e,_215f,_2160,_2161){
function Ruler(_2162,_2163,_2164,_2165){
this._location=_2163||"left";
this._overview=_2164||"page";
this._rulerStyle=_2165;
this._view=null;
var self=this;
this._listener={onTextModelChanged:function(e){
self._onTextModelChanged(e);
},onAnnotationModelChanged:function(e){
self._onAnnotationModelChanged(e);
}};
this.setAnnotationModel(_2162);
};
Ruler.prototype={getAnnotations:function(_2166,_2167){
var _2168=this._annotationModel;
if(!_2168){
return [];
}
var model=this._view.getModel();
var start=model.getLineStart(_2166);
var end=model.getLineEnd(_2167-1);
var _2169=model;
if(model.getBaseModel){
_2169=model.getBaseModel();
start=model.mapOffset(start);
end=model.mapOffset(end);
}
var _216a=[];
var _216b=this.getAnnotationsByType(_2168,start,end);
for(var i=0;i<_216b.length;i++){
var _216c=_216b[i];
var _216d=_2169.getLineAtOffset(_216c.start);
var _216e=_2169.getLineAtOffset(Math.max(_216c.start,_216c.end-1));
for(var _216f=_216d;_216f<=_216e;_216f++){
var _2170=_216f;
if(model!==_2169){
var ls=_2169.getLineStart(_216f);
ls=model.mapOffset(ls,true);
if(ls===-1){
continue;
}
_2170=model.getLineAtOffset(ls);
}
if(!(_2166<=_2170&&_2170<_2167)){
continue;
}
var _2171=this._mergeAnnotation(_216a[_2170],_216c,_216f-_216d,_216e-_216d+1);
if(_2171){
_216a[_2170]=_2171;
}
}
}
if(!this._multiAnnotation&&this._multiAnnotationOverlay){
for(var k in _216a){
if(_216a[k]._multiple){
_216a[k].html=_216a[k].html+this._multiAnnotationOverlay.html;
}
}
}
return _216a;
},getAnnotationModel:function(){
return this._annotationModel;
},getLocation:function(){
return this._location;
},getOverview:function(){
return this._overview;
},getRulerStyle:function(){
return this._rulerStyle;
},getWidestAnnotation:function(){
return null;
},setAnnotationModel:function(_2172){
if(this._annotationModel){
this._annotationModel.removEventListener("Changed",this._listener.onAnnotationModelChanged);
}
this._annotationModel=_2172;
if(this._annotationModel){
this._annotationModel.addEventListener("Changed",this._listener.onAnnotationModelChanged);
}
},setMultiAnnotation:function(_2173){
this._multiAnnotation=_2173;
},setMultiAnnotationOverlay:function(_2174){
this._multiAnnotationOverlay=_2174;
},setView:function(view){
if(this._onTextModelChanged&&this._view){
this._view.removeEventListener("ModelChanged",this._listener.onTextModelChanged);
}
this._view=view;
if(this._onTextModelChanged&&this._view){
this._view.addEventListener("ModelChanged",this._listener.onTextModelChanged);
}
},onClick:function(_2175,e){
},onDblClick:function(_2176,e){
},onMouseMove:function(_2177,e){
var _2178=_2160.Tooltip.getTooltip(this._view);
if(!_2178){
return;
}
if(_2178.isVisible()&&this._tooltipLineIndex===_2177){
return;
}
this._tooltipLineIndex=_2177;
var self=this;
_2178.setTarget({y:e.clientY,getTooltipInfo:function(){
return self._getTooltipInfo(self._tooltipLineIndex,this.y);
}});
},onMouseOver:function(_2179,e){
this.onMouseMove(_2179,e);
},onMouseOut:function(_217a,e){
var _217b=_2160.Tooltip.getTooltip(this._view);
if(!_217b){
return;
}
_217b.setTarget(null);
},_getTooltipInfo:function(_217c,y){
if(_217c===undefined){
return;
}
var view=this._view;
var model=view.getModel();
var _217d=this._annotationModel;
var _217e=[];
if(_217d){
var start=model.getLineStart(_217c);
var end=model.getLineEnd(_217c);
if(model.getBaseModel){
start=model.mapOffset(start);
end=model.mapOffset(end);
}
_217e=this.getAnnotationsByType(_217d,start,end);
}
var _217f=this._getTooltipContents(_217c,_217e);
if(!_217f){
return null;
}
var info={contents:_217f,anchor:this.getLocation()};
var rect=view.getClientArea();
if(this.getOverview()==="document"){
rect.y=view.convert({y:y},"view","document").y;
}else{
rect.y=view.getLocationAtOffset(model.getLineStart(_217c)).y;
}
view.convert(rect,"document","page");
info.x=rect.x;
info.y=rect.y;
if(info.anchor==="right"){
info.x+=rect.width;
}
return info;
},_getTooltipContents:function(_2180,_2181){
return _2181;
},_onAnnotationModelChanged:function(e){
var view=this._view;
if(!view){
return;
}
var model=view.getModel(),self=this;
var _2182=model.getLineCount();
if(e.textModelChangedEvent){
var start=e.textModelChangedEvent.start;
if(model.getBaseModel){
start=model.mapOffset(start,true);
}
var _2183=model.getLineAtOffset(start);
view.redrawLines(_2183,_2182,self);
return;
}
function _2184(_2185){
for(var i=0;i<_2185.length;i++){
if(!self.isAnnotationTypeVisible(_2185[i].type)){
continue;
}
var start=_2185[i].start;
var end=_2185[i].end;
if(model.getBaseModel){
start=model.mapOffset(start,true);
end=model.mapOffset(end,true);
}
if(start!==-1&&end!==-1){
view.redrawLines(model.getLineAtOffset(start),model.getLineAtOffset(Math.max(start,end-1))+1,self);
}
}
};
_2184(e.added);
_2184(e.removed);
_2184(e.changed);
},_mergeAnnotation:function(_2186,_2187,_2188,_2189){
if(!_2186){
_2186={};
}
if(_2188===0){
if(_2186.html&&_2187.html){
if(_2187.html!==_2186.html){
if(!_2186._multiple&&this._multiAnnotation){
_2186.html=this._multiAnnotation.html;
}
}
_2186._multiple=true;
}else{
_2186.html=_2187.html;
}
}
_2186.style=this._mergeStyle(_2186.style,_2187.style);
return _2186;
},_mergeStyle:function(_218a,style){
if(style){
if(!_218a){
_218a={};
}
if(_218a.styleClass&&style.styleClass&&_218a.styleClass!==style.styleClass){
_218a.styleClass+=" "+style.styleClass;
}else{
_218a.styleClass=style.styleClass;
}
var prop;
if(style.style){
if(!_218a.style){
_218a.style={};
}
for(prop in style.style){
if(!_218a.style[prop]){
_218a.style[prop]=style.style[prop];
}
}
}
if(style.attributes){
if(!_218a.attributes){
_218a.attributes={};
}
for(prop in style.attributes){
if(!_218a.attributes[prop]){
_218a.attributes[prop]=style.attributes[prop];
}
}
}
}
return _218a;
}};
_215f.AnnotationTypeList.addMixin(Ruler.prototype);
function _218b(_218c,_218d,_218e,_218f,_2190){
Ruler.call(this,_218c,_218d,"page",_218e);
this._oddStyle=_218f||{style:{backgroundColor:"white"}};
this._evenStyle=_2190||{style:{backgroundColor:"white"}};
this._numOfDigits=0;
};
_218b.prototype=new Ruler();
_218b.prototype.getAnnotations=function(_2191,_2192){
var _2193=Ruler.prototype.getAnnotations.call(this,_2191,_2192);
var model=this._view.getModel();
for(var _2194=_2191;_2194<_2192;_2194++){
var style=_2194&1?this._oddStyle:this._evenStyle;
var _2195=_2194;
if(model.getBaseModel){
var _2196=model.getLineStart(_2195);
_2195=model.getBaseModel().getLineAtOffset(model.mapOffset(_2196));
}
if(!_2193[_2194]){
_2193[_2194]={};
}
_2193[_2194].html=(_2195+1)+"";
if(!_2193[_2194].style){
_2193[_2194].style=style;
}
}
return _2193;
};
_218b.prototype.getWidestAnnotation=function(){
var _2197=this._view.getModel().getLineCount();
return this.getAnnotations(_2197-1,_2197)[_2197-1];
};
_218b.prototype._onTextModelChanged=function(e){
var start=e.start;
var model=this._view.getModel();
var _2198=model.getBaseModel?model.getBaseModel().getLineCount():model.getLineCount();
var _2199=(_2198+"").length;
if(this._numOfDigits!==_2199){
this._numOfDigits=_2199;
var _219a=model.getLineAtOffset(start);
this._view.redrawLines(_219a,model.getLineCount(),this);
}
};
function _219b(_219c,_219d,_219e){
Ruler.call(this,_219c,_219d,"page",_219e);
};
_219b.prototype=new Ruler();
function _219f(_21a0,_21a1,_21a2){
Ruler.call(this,_21a0,_21a1,"document",_21a2);
};
_219f.prototype=new Ruler();
_219f.prototype.getRulerStyle=function(){
var _21a3={style:{lineHeight:"1px",fontSize:"1px"}};
_21a3=this._mergeStyle(_21a3,this._rulerStyle);
return _21a3;
};
_219f.prototype.onClick=function(_21a4,e){
if(_21a4===undefined){
return;
}
this._view.setTopIndex(_21a4);
};
_219f.prototype._getTooltipContents=function(_21a5,_21a6){
if(_21a6.length===0){
var model=this._view.getModel();
var _21a7=_21a5;
if(model.getBaseModel){
var _21a8=model.getLineStart(_21a7);
_21a7=model.getBaseModel().getLineAtOffset(model.mapOffset(_21a8));
}
return _2161.formatMessage(_215e.line,_21a7+1);
}
return Ruler.prototype._getTooltipContents.call(this,_21a5,_21a6);
};
_219f.prototype._mergeAnnotation=function(_21a9,_21aa,_21ab,_21ac){
if(_21ab!==0){
return undefined;
}
var _21ad=_21a9;
if(!_21ad){
var _21ae=3*_21ac;
_21ad={html:"&nbsp;",style:{style:{height:_21ae+"px"}}};
_21ad.style=this._mergeStyle(_21ad.style,_21aa.overviewStyle);
}
return _21ad;
};
function _21af(_21b0,_21b1,_21b2){
_219b.call(this,_21b0,_21b1,_21b2);
};
_21af.prototype=new _219b();
_21af.prototype.onClick=function(_21b3,e){
if(_21b3===undefined){
return;
}
var _21b4=this._annotationModel;
if(!_21b4){
return;
}
var view=this._view;
var model=view.getModel();
var start=model.getLineStart(_21b3);
var end=model.getLineEnd(_21b3,true);
if(model.getBaseModel){
start=model.mapOffset(start);
end=model.mapOffset(end);
model=model.getBaseModel();
}
var _21b5,iter=_21b4.getAnnotations(start,end);
while(!_21b5&&iter.hasNext()){
var a=iter.next();
if(!this.isAnnotationTypeVisible(a.type)){
continue;
}
_21b5=a;
}
if(_21b5&&model.getLineAtOffset(_21b5.start)===model.getLineAtOffset(start)){
var _21b6=_2160.Tooltip.getTooltip(this._view);
if(_21b6){
_21b6.setTarget(null);
}
if(_21b5.expanded){
_21b5.collapse();
}else{
_21b5.expand();
}
this._annotationModel.modifyAnnotation(_21b5);
}
};
_21af.prototype._getTooltipContents=function(_21b7,_21b8){
if(_21b8.length===1){
if(_21b8[0].expanded){
return null;
}
}
return _219b.prototype._getTooltipContents.call(this,_21b7,_21b8);
};
_21af.prototype._onAnnotationModelChanged=function(e){
if(e.textModelChangedEvent){
_219b.prototype._onAnnotationModelChanged.call(this,e);
return;
}
var view=this._view;
if(!view){
return;
}
var model=view.getModel(),self=this,i;
var _21b9=model.getLineCount(),_21ba=_21b9;
function _21bb(_21bc){
for(i=0;i<_21bc.length;i++){
if(!self.isAnnotationTypeVisible(_21bc[i].type)){
continue;
}
var start=_21bc[i].start;
if(model.getBaseModel){
start=model.mapOffset(start,true);
}
if(start!==-1){
_21ba=Math.min(_21ba,model.getLineAtOffset(start));
}
}
};
_21bb(e.added);
_21bb(e.removed);
_21bb(e.changed);
var _21bd=view.getRulers();
for(i=0;i<_21bd.length;i++){
view.redrawLines(_21ba,_21b9,_21bd[i]);
}
};
return {Ruler:Ruler,AnnotationRuler:_219b,LineNumberRuler:_218b,OverviewRuler:_219f,FoldingRuler:_21af};
});
},"davinci/ui/widgets/NewFile":function(){
define(["dojo/_base/declare","dijit/_Templated","dijit/_Widget","davinci/library","davinci/Workbench","system/resource","davinci/workbench/Preferences","davinci/Runtime","dijit/Menu","dijit/MenuItem","davinci/model/Path","dijit/form/DropDownButton","dojo/i18n!davinci/ui/nls/ui","dojo/i18n!dijit/nls/common","dojo/text!./templates/NewFile.html","dijit/form/Button","dijit/form/TextBox","dijit/form/RadioButton"],function(_21be,_21bf,_21c0,_21c1,_21c2,_21c3,_21c4,_21c5,Menu,_21c6,Path,_21c7,uiNLS,_21c8,_21c9){
return _21be("davinci.ui.widgets.NewFile",[_21c0,_21bf],{widgetsInTemplate:true,templateString:_21c9,treeCollapsed:true,fileDialogFileName:null,fileTree:null,__okButton:null,dialogSpecificClass:null,_fileDialog:null,postMixInProperties:function(){
var _21ca=this.langObj=uiNLS;
var _21cb=_21c8;
dojo.mixin(this,_21ca);
dojo.mixin(this,_21cb);
this.inherited(arguments);
},postCreate:function(){
this.inherited(arguments);
this.arrowNode=this.fileDialogDetailsArrow;
this._tree_collapse_expand();
var t=this;
if(this.dialogSpecificClass){
require([this.dialogSpecificClass],function(c){
t.dialogSpecificWidget=new c({dialogSpecificButtonsSpan:t.dialogSpecificButtonsSpan,dialogSpecificClassOptions:this.dialogSpecificClassOptions},t.dialogSpecificOptionsDiv);
}.bind(this));
}
this._whereMenu=new Menu({style:"display: none;"});
this._whereDropDownButton=new _21c7({className:"whereDropDown",dropDown:this._whereMenu,iconClass:"fileDialogWhereIcon"});
this.fileDialogWhereDropDownCell.appendChild(this._whereDropDownButton.domNode);
if(!this.value){
this._setValueAttr(this._getForcedRootAttr());
}
this.connect(this.arrowNode,"onclick",dojo.hitch(this,function(e){
this._tree_collapse_expand(!this.treeCollapsed);
}));
dojo.connect(this.fileDialogFileName,"onkeyup",this,"_checkValid");
this.fileTree.watch("selectedItem",dojo.hitch(this,this._updateFields));
this.fileTree.watch("selectedItem",dojo.hitch(this,this._checkValid));
this._updateFields();
this.__okButton.onClick=dojo.hitch(this,this._okButton);
if(this.optionalMessage){
this.additionalMessage.innerHTML=this.optionalMessage;
this.additionalMessage.style.display="block";
}
},startup:function(){
if(this.dialogSpecificWidget&&this.dialogSpecificWidget.startup){
this.dialogSpecificWidget.startup();
}
},_tree_collapse_expand:function(_21cc){
if(typeof _21cc!="undefined"){
this.treeCollapsed=_21cc;
}
var table=dojo.query(".fileFolderTable",this.domNode)[0];
var _21cd=dojo.query(".folderContainer",this.domNode)[0];
var _21ce=dojo.query(".folder_details_show_arrow",this.domNode)[0];
var _21cf=dojo.query(".folder_details_hide_arrow",this.domNode)[0];
if(table){
if(this.treeCollapsed){
dojo.addClass(table,"treeCollapsed");
dojo.removeClass(table,"treeExpanded");
dojo.addClass(_21cd,"dijitHidden");
dojo.removeClass(_21ce,"dijitHidden");
dojo.addClass(_21cf,"dijitHidden");
}else{
dojo.addClass(table,"treeExpanded");
dojo.removeClass(table,"treeCollapsed");
dojo.removeClass(_21cd,"dijitHidden");
dojo.addClass(_21ce,"dijitHidden");
dojo.removeClass(_21cf,"dijitHidden");
}
}
this.fileDialogDetailsArrow.title=this.treeCollapsed?this.langObj.newFileShowFiles:this.langObj.newFileHideFiles;
},_setValueAttr:function(value){
if(value==this._value){
return;
}
this._value=value;
var path=[];
for(var i=value;i.parent;i=i.parent){
path.unshift(i);
}
return this.fileTree.set("path",path);
},_setNewFileNameAttr:function(name){
this.fileDialogFileName.set("value",name);
},_getForcedRootAttr:function(){
if(this._forcedRoot){
return this._forcedRoot;
}
var base=_21c2.getProject();
var prefs=_21c4.getPreferences("davinci.ui.ProjectPrefs",base);
if(prefs.webContentFolder!=null&&prefs.webContentFolder!=""){
var _21d0=new Path(_21c2.getProject()).append(prefs.webContentFolder);
var _21d1=_21c3.findResource(_21d0.toString());
return _21d1;
}
return _21c3.findResource(_21c2.getProject());
},_setForcedRootAttr:function(value){
this._forcedRoot=value;
},_updateFields:function(){
var _21d2=this.fileTree.get("selectedItems");
var _21d3=(_21d2!=null&&_21d2.length>0)?_21d2[0]:null;
var _21d4;
var _21d5=("./"+_21c2.getProject()).length+1;
if(_21d3==null){
_21d4=this._getForcedRootAttr();
}else{
if(_21d3.elementType=="Folder"){
_21d4=_21d3;
}else{
this.fileDialogFileName.set("value",_21d3.getName());
_21d4=_21d3.parent;
}
}
if(this._whereDropDownButton&&this._whereMenu){
var _21d6=_21d4.getPath().substring(_21d5);
var _21d7=_21d4.getName();
var _21d8=dojo.trim(_21d6);
var _21d9=_21d8.length==0?this.langObj.root:_21d7;
this._whereDropDownButton.attr("label",_21d9);
this._whereMenu.attr("value",_21d6);
this._whereMenu.destroyDescendants();
var _21da;
var done=false;
var _21db=0;
do{
var _21d8=dojo.trim(_21d6);
if(_21d8.length==0){
done=true;
_21d7=this.langObj.root;
}
_21da=new _21c6({label:_21d7,value:_21d6,onClick:dojo.hitch(this,function(label,value,e){
this._whereMenu.attr("value",value);
this._whereDropDownButton.attr("label",label);
var _21dc=new Path(_21c2.getProject()).append(value);
var _21dd=_21c3.findResource(_21dc.toString());
this.fileTree.set("selectedItems",[_21dd]);
},_21d7,_21d6)});
this._whereMenu.addChild(_21da);
if(!done){
_21d4=_21d4.parent;
_21d6=_21d4.getPath().substring(_21d5);
_21d7=_21d4.getName();
}
_21db++;
}while(!done&&_21db<100);
}
},_checkValid:function(){
var name=this.fileDialogFileName.get("value"),valid=name&&name.length>0,_21de=this._whereMenu.attr("value"),_21df=_21c3.findResource(_21c2.getProject()+(_21de?"/"+_21de:"")),_21e0;
if(_21df){
valid=valid&&!_21df.readOnly();
}
_21e0=_21df.getChildSync(name);
if(_21e0){
valid=valid&&!_21e0.readOnly();
}
this.__okButton.set("disabled",!valid);
return valid;
},_okButton:function(e){
var _21e1=(new Path(_21c2.getProject())).append(this._whereMenu.attr("value")).append(this.fileDialogFileName.get("value"));
this.value=_21e1.toString();
var check=this.checkFileName(this.value);
if(check){
return true;
}else{
return false;
}
},_newFolder:function(){
var _21e2=this.fileTree.get("selectedItems");
var _21e3=(_21e2!=null&&_21e2.length>0)?_21e2[0]:null;
davinci.ui.Resource.newFolder(_21e3,dojo.hitch(this,function(_21e4){
this.fileTree.set("selectedItems",[_21e4]);
}));
},_getValueAttr:function(){
return this.value;
},cancelButton:function(){
this.onClose();
},_createResource:function(){
var _21e5=this._whereMenu.attr("value");
var _21e6=this.fileDialogFileName.get("value");
var _21e7=_21c3.findResource(_21e5+"/"+_21e6);
if(_21e7){
return _21e7;
}
var _21e8=_21c3.findResource(_21e5);
return _21e8.createResource(_21e6);
},onClose:function(){
}});
});
},"dijit/form/NumberTextBox":function(){
define("dijit/form/NumberTextBox",["dojo/_base/declare","dojo/_base/lang","dojo/number","./RangeBoundTextBox"],function(_21e9,lang,_21ea,_21eb){
var _21ec=_21e9("dijit.form.NumberTextBoxMixin",null,{pattern:_21ea.regexp,value:NaN,editOptions:{pattern:"#.######"},_formatter:_21ea.format,postMixInProperties:function(){
this.inherited(arguments);
this._set("type","text");
},_setConstraintsAttr:function(_21ed){
var _21ee=typeof _21ed.places=="number"?_21ed.places:0;
if(_21ee){
_21ee++;
}
if(typeof _21ed.max!="number"){
_21ed.max=9*Math.pow(10,15-_21ee);
}
if(typeof _21ed.min!="number"){
_21ed.min=-9*Math.pow(10,15-_21ee);
}
this.inherited(arguments,[_21ed]);
if(this.focusNode&&this.focusNode.value&&!isNaN(this.value)){
this.set("value",this.value);
}
},_onFocus:function(){
if(this.disabled){
return;
}
var val=this.get("value");
if(typeof val=="number"&&!isNaN(val)){
var _21ef=this.format(val,this.constraints);
if(_21ef!==undefined){
this.textbox.value=_21ef;
}
}
this.inherited(arguments);
},format:function(value,_21f0){
var _21f1=String(value);
if(typeof value!="number"){
return _21f1;
}
if(isNaN(value)){
return "";
}
if(!("rangeCheck" in this&&this.rangeCheck(value,_21f0))&&_21f0.exponent!==false&&/\de[-+]?\d/i.test(_21f1)){
return _21f1;
}
if(this.editOptions&&this.focused){
_21f0=lang.mixin({},_21f0,this.editOptions);
}
return this._formatter(value,_21f0);
},_parser:_21ea.parse,parse:function(value,_21f2){
var v=this._parser(value,lang.mixin({},_21f2,(this.editOptions&&this.focused)?this.editOptions:{}));
if(this.editOptions&&this.focused&&isNaN(v)){
v=this._parser(value,_21f2);
}
return v;
},_getDisplayedValueAttr:function(){
var v=this.inherited(arguments);
return isNaN(v)?this.textbox.value:v;
},filter:function(value){
return (value==null||value==="")?NaN:this.inherited(arguments);
},serialize:function(value,_21f3){
return (typeof value!="number"||isNaN(value))?"":this.inherited(arguments);
},_setBlurValue:function(){
var val=lang.hitch(lang.mixin({},this,{focused:true}),"get")("value");
this._setValueAttr(val,true);
},_setValueAttr:function(value,_21f4,_21f5){
if(value!==undefined&&_21f5===undefined){
_21f5=String(value);
if(typeof value=="number"){
if(isNaN(value)){
_21f5="";
}else{
if(("rangeCheck" in this&&this.rangeCheck(value,this.constraints))||this.constraints.exponent===false||!/\de[-+]?\d/i.test(_21f5)){
_21f5=undefined;
}
}
}else{
if(!value){
_21f5="";
value=NaN;
}else{
value=undefined;
}
}
}
this.inherited(arguments,[value,_21f4,_21f5]);
},_getValueAttr:function(){
var v=this.inherited(arguments);
if(isNaN(v)&&this.textbox.value!==""){
if(this.constraints.exponent!==false&&/\de[-+]?\d/i.test(this.textbox.value)&&(new RegExp("^"+_21ea._realNumberRegexp(lang.mixin({},this.constraints))+"$").test(this.textbox.value))){
var n=Number(this.textbox.value);
return isNaN(n)?undefined:n;
}else{
return undefined;
}
}else{
return v;
}
},isValid:function(_21f6){
if(!this.focused||this._isEmpty(this.textbox.value)){
return this.inherited(arguments);
}else{
var v=this.get("value");
if(!isNaN(v)&&this.rangeCheck(v,this.constraints)){
if(this.constraints.exponent!==false&&/\de[-+]?\d/i.test(this.textbox.value)){
return true;
}else{
return this.inherited(arguments);
}
}else{
return false;
}
}
}});
var _21f7=_21e9("dijit.form.NumberTextBox",[_21eb,_21ec],{baseClass:"dijitTextBox dijitNumberTextBox"});
_21f7.Mixin=_21ec;
return _21f7;
});
},"dojox/widget/ColorPicker":function(){
require({cache:{"url:dojox/widget/ColorPicker/ColorPicker.html":"<table class=\"dojoxColorPicker\" dojoAttachEvent=\"onkeypress: _handleKey\" cellpadding=\"0\" cellspacing=\"0\" role=\"presentation\">\n\t<tr>\n\t\t<td valign=\"top\" class=\"dojoxColorPickerRightPad\">\n\t\t\t<div class=\"dojoxColorPickerBox\">\n\t\t\t\t<!-- Forcing ABS in style attr due to dojo DND issue with not picking it up form the class. -->\n\t\t\t\t<img title=\"${saturationPickerTitle}\" alt=\"${saturationPickerTitle}\" class=\"dojoxColorPickerPoint\" src=\"${_pickerPointer}\" tabIndex=\"0\" dojoAttachPoint=\"cursorNode\" style=\"position: absolute; top: 0px; left: 0px;\">\n\t\t\t\t<img role=\"presentation\" alt=\"\" dojoAttachPoint=\"colorUnderlay\" dojoAttachEvent=\"onclick: _setPoint, onmousedown: _stopDrag\" class=\"dojoxColorPickerUnderlay\" src=\"${_underlay}\" ondragstart=\"return false\">\n\t\t\t</div>\n\t\t</td>\n\t\t<td valign=\"top\" class=\"dojoxColorPickerRightPad\">\n\t\t\t<div class=\"dojoxHuePicker\">\n\t\t\t\t<!-- Forcing ABS in style attr due to dojo DND issue with not picking it up form the class. -->\n\t\t\t\t<img dojoAttachPoint=\"hueCursorNode\" tabIndex=\"0\" class=\"dojoxHuePickerPoint\" title=\"${huePickerTitle}\" alt=\"${huePickerTitle}\" src=\"${_huePickerPointer}\" style=\"position: absolute; top: 0px; left: 0px;\">\n\t\t\t\t<div class=\"dojoxHuePickerUnderlay\" dojoAttachPoint=\"hueNode\">\n\t\t\t\t    <img role=\"presentation\" alt=\"\" dojoAttachEvent=\"onclick: _setHuePoint, onmousedown: _stopDrag\" src=\"${_hueUnderlay}\">\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</td>\n\t\t<td valign=\"top\">\n\t\t\t<table cellpadding=\"0\" cellspacing=\"0\" role=\"presentation\">\n\t\t\t\t<tr>\n\t\t\t\t\t<td valign=\"top\" class=\"dojoxColorPickerPreviewContainer\">\n\t\t\t\t\t\t<table cellpadding=\"0\" cellspacing=\"0\" role=\"presentation\">\n\t\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t\t<td valign=\"top\" class=\"dojoxColorPickerRightPad\">\n\t\t\t\t\t\t\t\t\t<div dojoAttachPoint=\"previewNode\" class=\"dojoxColorPickerPreview\"></div>\n\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t\t<td valign=\"top\">\n\t\t\t\t\t\t\t\t\t<div dojoAttachPoint=\"safePreviewNode\" class=\"dojoxColorPickerWebSafePreview\"></div>\n\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t</table>\n\t\t\t\t\t</td>\n\t\t\t\t</tr>\n\t\t\t\t<tr>\n\t\t\t\t\t<td valign=\"bottom\">\n\t\t\t\t\t\t<table class=\"dojoxColorPickerOptional\" cellpadding=\"0\" cellspacing=\"0\" role=\"presentation\">\n\t\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t\t\t<div class=\"dijitInline dojoxColorPickerRgb\" dojoAttachPoint=\"rgbNode\">\n\t\t\t\t\t\t\t\t\t\t<table cellpadding=\"1\" cellspacing=\"1\" role=\"presentation\">\n\t\t\t\t\t\t\t\t\t\t<tr><td><label for=\"${_uId}_r\">${redLabel}</label></td><td><input id=\"${_uId}_r\" dojoAttachPoint=\"Rval\" size=\"1\" dojoAttachEvent=\"onchange: _colorInputChange\"></td></tr>\n\t\t\t\t\t\t\t\t\t\t<tr><td><label for=\"${_uId}_g\">${greenLabel}</label></td><td><input id=\"${_uId}_g\" dojoAttachPoint=\"Gval\" size=\"1\" dojoAttachEvent=\"onchange: _colorInputChange\"></td></tr>\n\t\t\t\t\t\t\t\t\t\t<tr><td><label for=\"${_uId}_b\">${blueLabel}</label></td><td><input id=\"${_uId}_b\" dojoAttachPoint=\"Bval\" size=\"1\" dojoAttachEvent=\"onchange: _colorInputChange\"></td></tr>\n\t\t\t\t\t\t\t\t\t\t</table>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t\t\t<div class=\"dijitInline dojoxColorPickerHsv\" dojoAttachPoint=\"hsvNode\">\n\t\t\t\t\t\t\t\t\t\t<table cellpadding=\"1\" cellspacing=\"1\" role=\"presentation\">\n\t\t\t\t\t\t\t\t\t\t<tr><td><label for=\"${_uId}_h\">${hueLabel}</label></td><td><input id=\"${_uId}_h\" dojoAttachPoint=\"Hval\"size=\"1\" dojoAttachEvent=\"onchange: _colorInputChange\"> ${degLabel}</td></tr>\n\t\t\t\t\t\t\t\t\t\t<tr><td><label for=\"${_uId}_s\">${saturationLabel}</label></td><td><input id=\"${_uId}_s\" dojoAttachPoint=\"Sval\" size=\"1\" dojoAttachEvent=\"onchange: _colorInputChange\"> ${percentSign}</td></tr>\n\t\t\t\t\t\t\t\t\t\t<tr><td><label for=\"${_uId}_v\">${valueLabel}</label></td><td><input id=\"${_uId}_v\" dojoAttachPoint=\"Vval\" size=\"1\" dojoAttachEvent=\"onchange: _colorInputChange\"> ${percentSign}</td></tr>\n\t\t\t\t\t\t\t\t\t\t</table>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t\t<td colspan=\"2\">\n\t\t\t\t\t\t\t\t\t<div class=\"dojoxColorPickerHex\" dojoAttachPoint=\"hexNode\" aria-live=\"polite\">\t\n\t\t\t\t\t\t\t\t\t\t<label for=\"${_uId}_hex\">&nbsp;${hexLabel}&nbsp;</label><input id=\"${_uId}_hex\" dojoAttachPoint=\"hexCode, focusNode, valueNode\" size=\"6\" class=\"dojoxColorPickerHexCode\" dojoAttachEvent=\"onchange: _colorInputChange\">\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t</table>\n\t\t\t\t\t</td>\n\t\t\t\t</tr>\n\t\t\t</table>\n\t\t</td>\n\t</tr>\n</table>\n\n"}});
define("dojox/widget/ColorPicker",["dojo/_base/kernel","dojo/_base/declare","dojo/_base/lang","dojo/_base/array","dojo/_base/html","dojo/_base/connect","dojo/_base/sniff","dojo/_base/window","dojo/_base/event","dojo/dom","dojo/dom-class","dojo/keys","dojo/fx","dojo/dnd/move","dijit/registry","dijit/_base/focus","dijit/form/_FormWidget","dijit/typematic","dojox/color","dojo/i18n","dojo/i18n!./nls/ColorPicker","dojo/i18n!dojo/cldr/nls/number","dojo/text!./ColorPicker/ColorPicker.html"],function(_21f8,_21f9,lang,_21fa,html,Hub,has,win,Event,DOM,_21fb,Keys,fx,move,_21fc,_21fd,_21fe,_21ff,color,i18n,_2200,_2201,_2202){
_21f8.experimental("dojox.widget.ColorPicker");
var _2203=function(hex){
return hex;
};
return _21f9("dojox.widget.ColorPicker",_21fe,{showRgb:true,showHsv:true,showHex:true,webSafe:true,animatePoint:true,slideDuration:250,liveUpdate:false,PICKER_HUE_H:150,PICKER_SAT_VAL_H:150,PICKER_SAT_VAL_W:150,PICKER_HUE_SELECTOR_H:8,PICKER_SAT_SELECTOR_H:10,PICKER_SAT_SELECTOR_W:10,value:"#ffffff",_underlay:_21f8.moduleUrl("dojox.widget","ColorPicker/images/underlay.png"),_hueUnderlay:_21f8.moduleUrl("dojox.widget","ColorPicker/images/hue.png"),_pickerPointer:_21f8.moduleUrl("dojox.widget","ColorPicker/images/pickerPointer.png"),_huePickerPointer:_21f8.moduleUrl("dojox.widget","ColorPicker/images/hueHandle.png"),_huePickerPointerAlly:_21f8.moduleUrl("dojox.widget","ColorPicker/images/hueHandleA11y.png"),templateString:_2202,postMixInProperties:function(){
if(_21fb.contains(win.body(),"dijit_a11y")){
this._huePickerPointer=this._huePickerPointerAlly;
}
this._uId=_21fc.getUniqueId(this.id);
lang.mixin(this,i18n.getLocalization("dojox.widget","ColorPicker"));
lang.mixin(this,i18n.getLocalization("dojo.cldr","number"));
this.inherited(arguments);
},postCreate:function(){
this.inherited(arguments);
if(has("ie")<7){
this.colorUnderlay.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+this._underlay+"', sizingMethod='scale')";
this.colorUnderlay.src=this._blankGif.toString();
}
if(!this.showRgb){
this.rgbNode.style.visibility="hidden";
}
if(!this.showHsv){
this.hsvNode.style.visibility="hidden";
}
if(!this.showHex){
this.hexNode.style.visibility="hidden";
}
if(!this.webSafe){
this.safePreviewNode.style.visibility="hidden";
}
},startup:function(){
if(this._started){
return;
}
this._started=true;
this.set("value",this.value);
this._mover=new move.boxConstrainedMoveable(this.cursorNode,{box:{t:-(this.PICKER_SAT_SELECTOR_H/2),l:-(this.PICKER_SAT_SELECTOR_W/2),w:this.PICKER_SAT_VAL_W,h:this.PICKER_SAT_VAL_H}});
this._hueMover=new move.boxConstrainedMoveable(this.hueCursorNode,{box:{t:-(this.PICKER_HUE_SELECTOR_H/2),l:0,w:0,h:this.PICKER_HUE_H}});
this._subs=[];
this._subs.push(Hub.subscribe("/dnd/move/stop",lang.hitch(this,"_clearTimer")));
this._subs.push(Hub.subscribe("/dnd/move/start",lang.hitch(this,"_setTimer")));
this._keyListeners=[];
this._connects.push(_21ff.addKeyListener(this.hueCursorNode,{charOrCode:Keys.UP_ARROW,shiftKey:false,metaKey:false,ctrlKey:false,altKey:false},this,lang.hitch(this,this._updateHueCursorNode),25,25));
this._connects.push(_21ff.addKeyListener(this.hueCursorNode,{charOrCode:Keys.DOWN_ARROW,shiftKey:false,metaKey:false,ctrlKey:false,altKey:false},this,lang.hitch(this,this._updateHueCursorNode),25,25));
this._connects.push(_21ff.addKeyListener(this.cursorNode,{charOrCode:Keys.UP_ARROW,shiftKey:false,metaKey:false,ctrlKey:false,altKey:false},this,lang.hitch(this,this._updateCursorNode),25,25));
this._connects.push(_21ff.addKeyListener(this.cursorNode,{charOrCode:Keys.DOWN_ARROW,shiftKey:false,metaKey:false,ctrlKey:false,altKey:false},this,lang.hitch(this,this._updateCursorNode),25,25));
this._connects.push(_21ff.addKeyListener(this.cursorNode,{charOrCode:Keys.LEFT_ARROW,shiftKey:false,metaKey:false,ctrlKey:false,altKey:false},this,lang.hitch(this,this._updateCursorNode),25,25));
this._connects.push(_21ff.addKeyListener(this.cursorNode,{charOrCode:Keys.RIGHT_ARROW,shiftKey:false,metaKey:false,ctrlKey:false,altKey:false},this,lang.hitch(this,this._updateCursorNode),25,25));
},_setValueAttr:function(value){
if(!this._started){
return;
}
this.setColor(value,true);
},setColor:function(col,force){
col=color.fromString(col);
this._updatePickerLocations(col);
this._updateColorInputs(col);
this._updateValue(col,force);
},_setTimer:function(mover){
if(mover.node!=this.cursorNode){
return;
}
_21fd.focus(mover.node);
DOM.setSelectable(this.domNode,false);
this._timer=setInterval(lang.hitch(this,"_updateColor"),45);
},_clearTimer:function(mover){
if(!this._timer){
return;
}
clearInterval(this._timer);
this._timer=null;
this.onChange(this.value);
DOM.setSelectable(this.domNode,true);
},_setHue:function(h){
html.style(this.colorUnderlay,"backgroundColor",color.fromHsv(h,100,100).toHex());
},_updateHueCursorNode:function(count,node,e){
if(count!==-1){
var y=html.style(this.hueCursorNode,"top");
var _2204=this.PICKER_HUE_SELECTOR_H/2;
y+=_2204;
var _2205=false;
if(e.charOrCode==Keys.UP_ARROW){
if(y>0){
y-=1;
_2205=true;
}
}else{
if(e.charOrCode==Keys.DOWN_ARROW){
if(y<this.PICKER_HUE_H){
y+=1;
_2205=true;
}
}
}
y-=_2204;
if(_2205){
html.style(this.hueCursorNode,"top",y+"px");
}
}else{
this._updateColor(true);
}
},_updateCursorNode:function(count,node,e){
var _2206=this.PICKER_SAT_SELECTOR_H/2;
var _2207=this.PICKER_SAT_SELECTOR_W/2;
if(count!==-1){
var y=html.style(this.cursorNode,"top");
var x=html.style(this.cursorNode,"left");
y+=_2206;
x+=_2207;
var _2208=false;
if(e.charOrCode==Keys.UP_ARROW){
if(y>0){
y-=1;
_2208=true;
}
}else{
if(e.charOrCode==Keys.DOWN_ARROW){
if(y<this.PICKER_SAT_VAL_H){
y+=1;
_2208=true;
}
}else{
if(e.charOrCode==Keys.LEFT_ARROW){
if(x>0){
x-=1;
_2208=true;
}
}else{
if(e.charOrCode==Keys.RIGHT_ARROW){
if(x<this.PICKER_SAT_VAL_W){
x+=1;
_2208=true;
}
}
}
}
}
if(_2208){
y-=_2206;
x-=_2207;
html.style(this.cursorNode,"top",y+"px");
html.style(this.cursorNode,"left",x+"px");
}
}else{
this._updateColor(true);
}
},_updateColor:function(){
var _2209=this.PICKER_HUE_SELECTOR_H/2,_220a=this.PICKER_SAT_SELECTOR_H/2,_220b=this.PICKER_SAT_SELECTOR_W/2;
var _220c=html.style(this.hueCursorNode,"top")+_2209,_220d=html.style(this.cursorNode,"top")+_220a,_220e=html.style(this.cursorNode,"left")+_220b,h=Math.round(360-(_220c/this.PICKER_HUE_H*360)),col=color.fromHsv(h,_220e/this.PICKER_SAT_VAL_W*100,100-(_220d/this.PICKER_SAT_VAL_H*100));
this._updateColorInputs(col);
this._updateValue(col,true);
if(h!=this._hue){
this._setHue(h);
}
},_colorInputChange:function(e){
var col,hasit=false;
switch(e.target){
case this.hexCode:
col=color.fromString(e.target.value);
hasit=true;
break;
case this.Rval:
case this.Gval:
case this.Bval:
col=color.fromArray([this.Rval.value,this.Gval.value,this.Bval.value]);
hasit=true;
break;
case this.Hval:
case this.Sval:
case this.Vval:
col=color.fromHsv(this.Hval.value,this.Sval.value,this.Vval.value);
hasit=true;
break;
}
if(hasit){
this._updatePickerLocations(col);
this._updateColorInputs(col);
this._updateValue(col,true);
}
},_updateValue:function(col,_220f){
var hex=col.toHex();
this.value=this.valueNode.value=hex;
if(_220f&&(!this._timer||this.liveUpdate)){
this.onChange(hex);
}
},_updatePickerLocations:function(col){
var _2210=this.PICKER_HUE_SELECTOR_H/2,_2211=this.PICKER_SAT_SELECTOR_H/2,_2212=this.PICKER_SAT_SELECTOR_W/2;
var hsv=col.toHsv(),ypos=Math.round(this.PICKER_HUE_H-hsv.h/360*this.PICKER_HUE_H)-_2210,_2213=Math.round(hsv.s/100*this.PICKER_SAT_VAL_W)-_2212,_2214=Math.round(this.PICKER_SAT_VAL_H-hsv.v/100*this.PICKER_SAT_VAL_H)-_2211;
if(this.animatePoint){
fx.slideTo({node:this.hueCursorNode,duration:this.slideDuration,top:ypos,left:0}).play();
fx.slideTo({node:this.cursorNode,duration:this.slideDuration,top:_2214,left:_2213}).play();
}else{
html.style(this.hueCursorNode,"top",ypos+"px");
html.style(this.cursorNode,{left:_2213+"px",top:_2214+"px"});
}
if(hsv.h!=this._hue){
this._setHue(hsv.h);
}
},_updateColorInputs:function(col){
var hex=col.toHex();
if(this.showRgb){
this.Rval.value=col.r;
this.Gval.value=col.g;
this.Bval.value=col.b;
}
if(this.showHsv){
var hsv=col.toHsv();
this.Hval.value=Math.round((hsv.h));
this.Sval.value=Math.round(hsv.s);
this.Vval.value=Math.round(hsv.v);
}
if(this.showHex){
this.hexCode.value=hex;
}
this.previewNode.style.backgroundColor=hex;
if(this.webSafe){
this.safePreviewNode.style.backgroundColor=_2203(hex);
}
},_setHuePoint:function(evt){
var _2215=this.PICKER_HUE_SELECTOR_H/2;
var ypos=evt.layerY-_2215;
if(this.animatePoint){
fx.slideTo({node:this.hueCursorNode,duration:this.slideDuration,top:ypos,left:0,onEnd:lang.hitch(this,function(){
this._updateColor(true);
_21fd.focus(this.hueCursorNode);
})}).play();
}else{
html.style(this.hueCursorNode,"top",ypos+"px");
this._updateColor(false);
}
},_setPoint:function(evt){
var _2216=this.PICKER_SAT_SELECTOR_H/2;
var _2217=this.PICKER_SAT_SELECTOR_W/2;
var _2218=evt.layerY-_2216;
var _2219=evt.layerX-_2217;
if(evt){
_21fd.focus(evt.target);
}
if(this.animatePoint){
fx.slideTo({node:this.cursorNode,duration:this.slideDuration,top:_2218,left:_2219,onEnd:lang.hitch(this,function(){
this._updateColor(true);
_21fd.focus(this.cursorNode);
})}).play();
}else{
html.style(this.cursorNode,{left:_2219+"px",top:_2218+"px"});
this._updateColor(false);
}
},_handleKey:function(e){
},focus:function(){
if(!this.focused){
_21fd.focus(this.focusNode);
}
},_stopDrag:function(e){
Event.stop(e);
},destroy:function(){
this.inherited(arguments);
_21fa.forEach(this._subs,function(sub){
Hub.unsubscribe(sub);
});
delete this._subs;
}});
});
},"davinci/ve/prefs/HTMLEditPreferences":function(){
define("davinci/ve/prefs/HTMLEditPreferences",["dojo/_base/declare","dijit/layout/ContentPane","dijit/_TemplatedMixin","dijit/form/CheckBox","dijit/form/TextBox","dojo/i18n!../nls/common"],function(_221a,_221b,_221c,_221d,_221e,_221f){
return _221a([_221b,_221c],{templateString:"<div><table style='margin: 4px;' cellspacing='4'><tbody>"+"<tr><td>${_loc.snapToNearestWidget}:</td><td><div dojoAttachPoint='snapNode'></div></td></tr>"+"<tr><td>${_loc.showPossibleParents}:</td><td><div dojoAttachPoint='showPossibleParentsNode'></div></td></tr>"+"<tr><td>${_loc.warnOnCSSOverride}:</td><td><div dojoAttachPoint='cssOverrideWarn'></div></td></tr>"+"<tr><td>${_loc.absoluteWidgetsZindex}:</td><td><div dojoAttachPoint='absoluteWidgetsZindex'></div></td></tr>"+"<tr><td>${_loc.zazl}:</td><td><div dojoAttachPoint='zazl'></div></td></tr>"+"</tbody></table></div>",postMixInProperties:function(){
this._loc=_221f;
},postCreate:function(){
this._snap=new _221d({},this.snapNode);
this._showPossibleParents=new _221d({},this.showPossibleParentsNode);
this._cssOverrideWarn=new _221d({},this.cssOverrideWarn);
this._absoluteWidgetsZindex=new _221e({},this.absoluteWidgetsZindex);
this._zazl=new _221d({},this.zazl);
if(!this.containerNode){
this.containerNode=this.domNode;
}
},getDefaults:function(){
},setDefaults:function(){
},doApply:function(){
},getPreferences:function(){
return {snap:this._snap.checked,showPossibleParents:this._showPossibleParents.checked,cssOverrideWarn:this._cssOverrideWarn.checked,absoluteWidgetsZindex:this._absoluteWidgetsZindex.value,zazl:this._zazl.checked};
},setPreferences:function(_2220){
_2220=_2220||{};
this._check(this._snap,!!_2220.snap);
this._check(this._showPossibleParents,!!_2220.showPossibleParents);
this._check(this._cssOverrideWarn,!!_2220.cssOverrideWarn);
this._absoluteWidgetsZindex.set("value",_2220.absoluteWidgetsZindex);
this._check(this._zazl,!!_2220.zazl);
},_check:function(_2221,_2222){
_2221.set("checked",_2222);
},save:function(prefs){
davinci.ve._preferences=prefs;
}});
});
},"url:dijit/templates/CheckedMenuItem.html":"<tr class=\"dijitReset dijitMenuItem\" data-dojo-attach-point=\"focusNode\" role=\"menuitemcheckbox\" tabIndex=\"-1\">\n\t<td class=\"dijitReset dijitMenuItemIconCell\" role=\"presentation\">\n\t\t<img src=\"${_blankGif}\" alt=\"\" class=\"dijitMenuItemIcon dijitCheckedMenuItemIcon\" data-dojo-attach-point=\"iconNode\"/>\n\t\t<span class=\"dijitCheckedMenuItemIconChar\">&#10003;</span>\n\t</td>\n\t<td class=\"dijitReset dijitMenuItemLabel\" colspan=\"2\" data-dojo-attach-point=\"containerNode,labelNode\"></td>\n\t<td class=\"dijitReset dijitMenuItemAccelKey\" style=\"display: none\" data-dojo-attach-point=\"accelKeyNode\"></td>\n\t<td class=\"dijitReset dijitMenuArrowCell\" role=\"presentation\">&#160;</td>\n</tr>\n","davinci/html/HTMLFile":function(){
define(["dojo/_base/declare","davinci/html/HTMLItem","davinci/html/HTMLParser","davinci/html/CSSSelector","davinci/html/HTMLElement","davinci/html/CSSImport","davinci/html/CSSFile","davinci/model/Model"],function(_2223,_2224,_2225,_2226,_2227,_2228,_2229,Model){
return _2223("davinci.html.HTMLFile",_2224,{constructor:function(_222a){
this.fileName=_222a;
this.url=_222a;
this.elementType="HTMLFile";
this._loadedCSS={};
this._styleElem=null;
},save:function(_222b){
var _222c;
var file=system.resource.findResource(this.fileName);
if(file){
var text=this.getText();
_222c=file.setContents(text,_222b);
}
return _222c;
},getText:function(_222d){
_222d=_222d||{};
_222d.indent=0;
var s="";
for(var i=0;i<this.children.length;i++){
var child=this.children[i];
s=s+child.getText(_222d);
if(child.elementType=="HTMLComment"){
s=s+this._addWS(child._fmLine,child._fmIndent);
}
}
return s;
},getDocumentElement:function(_222e){
for(var i=0;i<this.children.length;i++){
if(this.children[i].tag=="html"){
return this.children[i];
}
}
},findElement:function(id){
var _222f=this.getDocumentElement();
if(_222f){
return _222f.findElement(id);
}
},getMatchingRules:function(_2230,_2231){
var _2232={visit:function(node){
if(node.elementType=="CSSFile"){
var m=[];
var _2233=node.getMatchingRules(_2230,[],m);
for(var i=0;i<_2233.length;i++){
for(var j=0;j<this.matchLevels.length;j++){
if(m[i]>this.matchLevels[j]){
this.matchLevels.splice(j,0,m[i]);
this.rules.splice(j,0,_2233[i]);
break;
}
}
}
if(this.rules.length==0){
this.rules=_2233;
this.matchLevels=m;
}
return true;
}
return false;
},matchLevels:[],rules:[]};
this.visit(_2232);
if(_2231){
return {"rules":_2232.rules,"matchLevels":_2232.matchLevels};
}else{
return _2232.rules;
}
},getRule:function(_2234){
if(!_2234){
return [];
}
var _2235=_2226.parseSelectors(_2234);
var _2236={visit:function(node){
if(node.elementType=="CSSFile"){
var _2237=node.getRule(_2235);
this.rules=this.rules.concat(_2237||[]);
return true;
}
return false;
},rules:[]};
this.visit(_2236);
return _2236.rules;
},setText:function(text,_2238){
this.visit({visit:function(node){
if(node.elementType=="CSSImport"){
node.close();
}
}});
this.children=[];
this._styleElem=null;
var _2239=_2225.parse(text||"",this);
var _223a="";
if(!_2238&&_2239.errors.length==0){
_223a=this.getText();
this.children=[];
_2239=_2225.parse(_223a,this);
}
this.endOffset=_2239.endOffset;
this.errors=_2239.errors;
var _223b=this;
if(!_2238){
this.visit({visit:function(node){
if(node.elementType=="CSSImport"){
if(!node.cssFile){
node.load(true);
dojo.connect(node.cssFile,"onChange",null,dojo.hitch(_223b,"onChange"));
}
}
}});
}
this.onChange();
},hasStyleSheet:function(url){
var _223c=this.find({elementType:"CSSImport"});
for(var i=0;i<_223c.length;i++){
if(_223c[i].url==url){
return true;
}
}
return false;
},addStyleSheet:function(url,_223d,_223e,_223f,_2240){
if(!_223e){
this._loadedCSS[url]=require("davinci/model/Factory").getModel({url:url,includeImports:true,loader:_2240});
}
if(_223d){
this._loadedCSS[url].setText(_223d);
}
this.onChange();
if(!this._styleElem){
var head=this.find({"elementType":"HTMLElement","tag":"head"},true);
var style=head.getChildElement("style");
if(!style){
style=new _2227("style");
head.addChild(style);
}
this._styleElem=style;
}
var css=new _2228();
css.parent=this;
css.url=url;
if(_223f){
this._styleElem.insertBefore(css,_223f);
}else{
this._styleElem.addChild(css);
}
if(!_223e){
css.load(true);
}
},close:function(){
this.visit({visit:function(node){
if(node.elementType=="CSSImport"){
node.close();
}
}});
require("davinci/model/Factory").closeModel(this);
},getLabel:function(){
return "<>";
},getID:function(){
return this.fileName;
},updatePositions:function(_2241,delta){
new Model(this).updatePositions(this,_2241,delta);
this.visit({visit:function(_2242){
if(_2242.endOffset<_2241){
return true;
}
if(_2242.elementType=="HTMLElement"&&_2242.startTagOffset>_2241){
_2242.startTagOffset+=delta;
}
}});
},mapPositions:function(_2243){
var s=this.getText();
var et=_2243.getText();
var start=s.indexOf(et);
var end=start+et.lastIndexOf(">")+1;
return {startOffset:start,endOffset:end};
},reportPositions:function(){
this.visit({visit:function(_2244){
if(_2244.elementType=="HTMLElement"){
}else{
if(_2244.elementType=="HTMLAttribute"){
}
}
}});
},evaluate:function(xpath){
if(xpath.charAt(0)!=="/"){
console.error("invalid XPath string");
return;
}
var elem=this;
xpath.substr(1).split("/").forEach(function(path){
var m=path.match(this._RE_XPATH),tag=m[1],idx=m[2],elems;
elems=elem.children.filter(function(child){
return child.tag===tag;
});
if(!idx&&elems.length>1){
console.error("invalid XPath string; no index specified for multiple elements");
return;
}
elem=idx?elems[idx-1]:elems[0];
},this);
return elem;
},_RE_XPATH:/(\w+)(?:\[(\d+)\])?/});
});
},"davinci/ve/Context":function(){
define(["require","dojo/_base/declare","dojo/_base/lang","dojo/_base/xhr","dojo/query","dojo/Deferred","dojo/promise/all","dojo/_base/connect","dojo/window","system/resource","../UserActivityMonitor","../Theme","./ThemeModifier","../commands/CommandStack","./commands/ChangeThemeCommand","./tools/SelectTool","../model/Path","../Workbench","./widget","./Focus","../library","./metadata","./ChooseParent","./Snap","./States","../XPathUtils","../html/HtmlFileXPathAdapter","./HTMLWidget","../html/CSSModel","../html/CSSRule","../html/CSSImport","../html/HTMLElement","../html/HTMLText","../workbench/Preferences","preview/silhouetteiframe","./utils/GeomUtils","dojo/text!./newfile.template.html","./utils/URLRewrite","dojox/html/_base"],function(_2245,_2246,lang,xhr,query,_2247,all,_2248,_2249,_224a,_224b,Theme,_224c,_224d,_224e,_224f,Path,_2250,_2251,Focus,_2252,_2253,_2254,Snap,_2255,_2256,_2257,_2258,_2259,_225a,_225b,_225c,_225d,_225e,_225f,_2260,_2261,_2262){
davinci.ve._preferences={};
var _2263="data-maq-device",_2264="data-maqetta-device",_2265="data-maq-orientation",_2266="data-maqetta-device-orientation",_2267="data-maq-flow-layout",_2268="data-maqetta-flow-layout";
var _2269=0;
return _2246("davinci.ve.Context",[_224c],{_bootstrapModules:"dijit/dijit",constructor:function(args){
if(!args){
args={};
}
this._contentStyleSheet=_2250.location()+_2245.toUrl("davinci/ve/resources/content.css");
this._id="_edit_context_"+_2269++;
this.widgetHash={};
lang.mixin(this,args);
if(dojo.isString(this.containerNode)){
this.containerNode=dijit.byId(this.containerNode);
}
this.hostNode=this.containerNode;
this._commandStack=new _224d(this);
this._defaultTool=new _224f();
this._widgetIds=[];
this._objectIds=[];
this._widgets=[];
this._loadedCSSConnects=[];
this._chooseParent=new _2254({context:this});
this.sceneManagers={};
var _226a=_2253.getLibrary();
for(var libId in _226a){
var _226b=_2253.getLibrary(libId);
args=[this];
_2253.invokeCallback(_226b,"onDocInit",args);
}
},destroy:function(){
this.inherited(arguments);
if(this._loadedCSSConnects){
dojo.forEach(this._loadedCSSConnects,dojo.disconnect);
delete this._loadedCSSConnects;
}
},isActive:function(){
return !!this._activeTool;
},getModel:function(){
return this._srcDocument;
},getPath:function(){
var path=this.getModel().fileName;
return new Path(path);
},activate:function(){
if(this.isActive()){
return;
}
this.loadStyleSheet(this._contentStyleSheet);
this._attachAll();
this._restoreStates();
this._AppStatesActivateActions();
this._statesLoaded=true;
dojo.publish("/davinci/ui/context/statesLoaded",[this]);
this._onLoadHelpers();
var _226c=this.getContainerNode();
dojo.addClass(_226c,"editContextContainer");
this._connects=[dojo.connect(this._commandStack,"onExecute",this,"onCommandStackExecute"),dojo.connect(this._commandStack,"onExecute",function(){
setTimeout(this.onContentChange.bind(this),0);
}.bind(this)),dojo.connect(this.getDocument(),"onkeydown",this,"onKeyDown"),dojo.connect(this.getDocument(),"onkeyup",this,"onKeyUp"),dojo.connect(_226c,"ondblclick",this,"onDblClick"),dojo.connect(_226c,"onmousedown",this,"onMouseDown"),dojo.connect(_226c,"onmousemove",this,"onMouseMove"),dojo.connect(_226c,"onmouseup",this,"onMouseUp"),dojo.connect(_226c,"onmouseover",this,"onMouseOver"),dojo.connect(_226c,"onmouseout",this,"onMouseOut")];
if(this.visualEditor&&this.visualEditor._pageEditor&&this.visualEditor._pageEditor._visualChanged){
this.visualEditor._pageEditor._visualChanged(true);
}
this.setActiveTool();
},deactivate:function(){
if(!this.isActive()){
return;
}
dojo.forEach(this._connects,dojo.disconnect);
this._connects=undefined;
dojo.forEach(this._focuses,function(f){
f._connected=false;
});
this._commandStack.clear();
if(this._activeTool){
this._activeTool.deactivate();
delete this._activeTool;
}
var _226d=this.getContainerNode();
this._menu.unBindDomNode(_226d);
this.select(null);
dojo.removeClass(_226d,"editContextContainer");
dojo.forEach(this.getTopWidgets(),this.detach,this);
this.unloadStyleSheet(this._contentStyleSheet);
},attach:function(_226e){
if(!_226e){
return;
}
if(_226e._edit_focus){
return;
}
var type=_226e.declaredClass;
if(!_226e._srcElement){
_226e._srcElement=this._srcDocument.findElement(_226e.id);
}
if(!_226e.type){
if(_226e.isHtmlWidget){
_226e.type="html."+_226e.getTagName();
}else{
if(_226e.isGenericWidget){
_226e.type=_226e.domNode.getAttribute("dvwidget");
}else{
if(_226e.isObjectWidget){
_226e.type=_226e.getObjectType();
}else{
_226e.type=_226e.declaredClass;
}
}
}
}
_226e.metadata=_226e.metadata||_2253.query(_226e.type);
_226e._edit_context=this;
_226e.attach();
if(_226e.type.charAt(_226e.type.lastIndexOf(".")+1)=="_"){
_226e.internal=true;
return;
}
var _226f=function(array,item){
if(array.indexOf(item)===-1){
array.push(item);
}
};
var id=_226e.getId();
if(id){
_226f(this._widgetIds,id);
}
var _2270=_226e.getObjectId(_226e);
if(_2270){
_226f(this._objectIds,_2270);
}
dojo.forEach(_226e.getChildren(true),this.attach,this);
},getBodyId:function(){
var _2271=this.model.find({elementType:"HTMLElement",tag:"body"},true),id=_2271.find({elementType:"HTMLAttribute",name:"id"},true);
return id.value;
},detach:function(_2272){
var _2273=function(array,item){
var i=array.indexOf(item);
if(i!=-1){
array.splice(i,1);
}
};
var id=_2272.getId();
if(id){
_2273(this._widgetIds,id);
}
var _2274=_2272.getObjectId();
if(_2274){
_2273(this._objectIds,_2274);
}
if(this._selection){
for(var i=0;i<this._selection.length;i++){
if(this._selection[i]==_2272){
this.focus(null,i);
this._selection.splice(i,1);
}
}
}
var _2275=_2253.getLibraryForType(_2272.type);
if(_2275){
var libId=_2275.name,data=[_2272.type,this];
_2253.invokeCallback(_2275,"onRemove",data);
this._widgets[libId]-=1;
if(this._widgets[libId]===0){
_2253.invokeCallback(_2275,"onLastRemove",data);
}
}
dojo.forEach(_2272.getChildren(),this.detach,this);
delete this._containerControls;
},getSource:function(_2276){
return this._srcDocument.getText();
},getDocumentElement:function(){
return this._srcDocument.getDocumentElement();
},getDocumentLocation:function(_2277){
return this._srcDocument.fileName;
},getBaseResource:function(_2278){
return system.resource.findResource(this.getDocumentLocation());
},getLibraryBase:function(id,_2279){
return _2252.getLibRoot(id,_2279,this.getBase())||"";
},loadRequires:function(type,_227a,_227b,_227c){
var _227d=_2253.query(type,"require");
if(!_227d){
var noop=new _2247();
noop.resolve();
return noop;
}
var _227e=[];
var _227f=_2253.query(type,"library"),libs={},_2280=this;
function _2281(libId,lib){
if(libs.hasOwnProperty(libId)){
return true;
}
var ver=_2253.getLibrary(libId).version||lib.version,root=_2280.getLibraryBase(libId,ver);
if(root==null){
console.error("No library found for name = '"+libId+"' version = '"+ver+"'");
return false;
}
libs[libId]=new Path(_2280.getBase()).append(root);
if(lib.src.substr(-3)===".js"){
var m=lib.src.match(/((?:\.\.\/)*)(.*)/);
_227e.push(_2282(libId,m[2]));
}
return true;
};
function _2283(libId,src){
return libs[libId].append(src).relativeTo(_2280.getPath(),true).toString();
};
function _2282(libId,src){
return _2280.addJavaScriptSrc(_2283(libId,src),_227a,src,_227c);
};
for(var libId in _227f){
if(_227f.hasOwnProperty(libId)){
if(!_2281(libId,_227f[libId])){
var d=new _2247();
d.reject();
return d;
}
}
}
_227d.every(function(r){
if(r.$library){
if(!_2281(r.$library)){
return false;
}
}
switch(r.type){
case "javascript":
if(r.src){
_227e.push(_2282(r.$library,r.src));
}else{
this.addJavaScriptText(r.$text,_227a||_227b,_227c);
}
break;
case "javascript-module":
if(r.format!=="amd"){
console.error("Unknown javascript-module format");
}
if(r.src){
_227e.push(this.addJavaScriptModule(r.src,_227a||_227b,_227c));
}else{
console.error("Inline 'javascript-module' not handled src="+r.src);
}
break;
case "css":
if(r.src){
var src=_2283(r.$library,r.src);
if(_227a){
this.addModeledStyleSheet(src,_227c);
}else{
this.loadStyleSheet(src);
}
}else{
console.error("Inline CSS not handled src="+r.src);
}
break;
case "image":
break;
default:
console.error("Unhandled metadata resource type='"+r.type+"' for widget '"+type+"'");
}
return true;
},this);
return all(_227e);
},_getWidgetFolder:function(){
var base=this.getBase();
var prefs=_225e.getPreferences("davinci.ui.ProjectPrefs",base);
if(!prefs.widgetFolder){
prefs.widgetFolder="WebContent/lib/custom";
_225e.savePreferences("davinci.ui.ProjectPrefs",base,prefs);
}
var _2284=prefs.widgetFolder;
while(_2284.length>1&&(_2284.charAt(0)=="."||_2284.charAt(0)=="/")){
_2284=_2284.substring(1);
}
return _2284;
},getMobileDevice:function(){
var _2285=this.getDocumentElement().getChildElement("body");
var _2286=_2285.getAttribute(_2263);
var _2287=_2285.getAttribute(_2264);
if(!_2286&&_2287){
_2285.removeAttribute(_2264);
_2285.setAttribute(_2263,_2287);
_2286=_2287;
this.editor._visualChanged();
}
return _2286;
},setMobileDevice:function(_2288){
this.getGlobal()["require"]("dojo/_base/config").mblUserAgent=_225f.getMobileTheme(_2288+".svg");
var _2289=this.getDocumentElement().getChildElement("body");
if(!_2288||_2288=="none"){
_2289.removeAttribute(_2263,_2288);
}else{
_2289.addAttribute(_2263,_2288);
}
},setMobileTheme:function(_228a){
var _228b=this.getMobileDevice()||"none";
if(_228b!=_228a){
this.setMobileDevice(_228a);
}
this.close();
try{
var ua=_225f.getMobileTheme(_228a+".svg");
ua=ua||"other";
this._configDojoxMobile();
}
catch(e){
}
},getMobileOrientation:function(){
var _228c=this.getDocumentElement().getChildElement("body");
var _228d=_228c.getAttribute(_2265);
var _228e=_228c.getAttribute(_2266);
if(!_228d&&_228e){
_228c.removeAttribute(_2266);
_228c.setAttribute(_2265,_228e);
_228d=_228e;
this.editor._visualChanged();
}
return _228d;
},setMobileOrientation:function(_228f){
var _2290=this.getDocumentElement().getChildElement("body");
if(_228f){
_2290.setAttribute(_2265,_228f);
}else{
_2290.removeAttribute(_2265);
}
},_mobileMetaElement:{name:"viewport",content:"width=device-width, initial-scale=1.0, user-scalable=no"},setMobileMeta:function(_2291){
if(_2291==="none"){
this._removeHeadElement("meta",this._mobileMetaElement);
}else{
this._addHeadElement("meta",this._mobileMetaElement);
}
},themeChanged:function(){
var _2292=true;
var model=this.getModel();
if(this._themeUrl){
var style=model.find({elementType:"CSSImport",url:this._themeUrl},true);
if(style){
_2292=false;
}
}
if(_2292){
this.theme=null;
this._themeMetaCache=null;
}
},getTheme:function(){
if(!this.theme){
var theme=this.loadThemeMeta(this._srcDocument);
if(theme){
this._themeUrl=theme.themeUrl;
this._themeMetaCache=theme.themeMetaCache;
this.theme=theme.theme;
this.theme.helper=Theme.getHelper(this.theme);
if(this.theme.helper&&this.theme.helper.then){
this.theme.helper.then(function(_2293){
if(_2293.helper){
this.theme.helper=_2293.helper;
}
}.bind(this));
}
}
}
return this.theme;
},getThemeMeta:function(){
if(!this._themeMetaCache){
this.getTheme();
}
return this._themeMetaCache;
},loadThemeMeta:function(model){
var ro=_2253.loadThemeMeta(model);
return ro;
},setSource:function(_2294,_2295,scope,_2296){
dojo.withDoc(this.getDocument(),"_setSource",this,arguments);
},getDojoUrl:function(){
var loc=_2250.location();
if(loc.charAt(loc.length-1)=="/"){
loc=loc.substring(0,loc.length-1);
}
if(document&&document.getElementsByTagName){
var _2297=document.getElementsByTagName("script");
var rePkg=/dojo(\.xd)?\.js(\W|$)/i;
for(var i=0;i<_2297.length;i++){
var src=_2297[i].getAttribute("src");
if(!src){
continue;
}
var m=src.match(rePkg);
if(m){
return loc+"/"+src;
}
}
}
},getResourcePath:function(){
return this.getFullResourcePath().removeLastSegments(1);
},getBase:function(){
if(davinci.Workbench.singleProjectMode()){
return _2250.getProject();
}
},getFullResourcePath:function(){
if(!this._fullResourcePath){
var _2298=this.getModel().fileName;
this._fullResourcePath=new Path(_2298);
}
return this._fullResourcePath;
},getCurrentHtmlFolderPath:function(){
var _2299=this.getFullResourcePath();
var _229a=_2299.getParentPath();
return _229a;
},getCurrentBasePath:function(){
var base=new Path(_2250.getProject());
var prefs=_225e.getPreferences("davinci.ui.ProjectPrefs",base);
if(prefs.webContentFolder!==null&&prefs.webContentFolder!==""){
basePath=base.append(prefs.webContentFolder);
}else{
basePath=base;
}
return basePath;
},getRelativeFileString:function(_229b){
var _229c=this.getCurrentHtmlFolderPath();
var _229d=this.getCurrentBasePath();
var _229e=_229d.append(_229b);
var _229f=_229e.relativeTo(_229c).toString();
return _229f;
},getAppCssRelativeFile:function(){
if(!this._appCssRelativeFile){
this._appCssRelativeFile=this.getRelativeFileString("app.css");
}
return this._appCssRelativeFile;
},getAppJsRelativeFile:function(){
if(!this._appJsRelativeFile){
this._appJsRelativeFile=this.getRelativeFileString("app.js");
}
return this._appJsRelativeFile;
},loadTheme:function(_22a0){
var model=this.getModel();
var _22a1="claro";
if(_22a0&&_22a0.themeSet){
_22a1=_22a0.themeSet.desktopTheme;
}else{
if(_22a0&&_22a0.theme){
if(_22a0.theme=="deviceSpecific"){
_22a1="claro";
}else{
_22a1=_22a0.theme;
}
}
}
var _22a2=model.find({elementType:"CSSImport"});
var _22a3=_2252.getThemes(_2250.getProject()),_22a4={},_22a5;
_22a3.forEach(function(theme){
if(theme.name==_22a1){
_22a5=theme;
}
if(theme.files){
theme.files.forEach(function(file){
_22a4[file]=theme;
});
}
});
if(_22a2.some(function(imp){
for(var _22a6 in _22a4){
if(imp.url.indexOf(_22a6)>-1){
return true;
}
}
})){
return true;
}
var body=model.find({elementType:"HTMLElement",tag:"body"},true);
body.setAttribute("class",_22a5.className);
var _22a7=_22a5.file.getPath();
_22a5.files.forEach(function(file){
var url=new Path(_22a7).removeLastSegments(1).append(file).relativeTo(this.getPath(),true);
this.addModeledStyleSheet(url.toString(),true);
},this);
},_setSource:function(_22a8,_22a9,scope,_22aa){
delete this._requireHtmlElem;
delete this._dojoScriptElem;
delete this.rootWidget;
if(this.frameNode){
var doc=this.frameNode.contentDocument||(this.frameNode.contentWindow&&this.frameNode.contentWindow.document);
if(doc){
try{
_2249.get(doc).require("dijit/registry")._destroyAll();
}
catch(e){
}
}
}
this._srcDocument=_22a8;
if(!_22a8.themeCssFiles){
this.loadRequires("html.body",true,false,true).then(function(){
this.loadTheme(_22aa);
}.bind(this));
}
if(_22aa){
var _22ab=_22a8.getDocumentElement().getChildElement("body");
_22ab.setAttribute(_2263,_22aa.device);
_22ab.setAttribute(_2267,_22aa.flowlayout);
if(_22aa.themeSet){
var cmd=new _224e(_22aa.themeSet,this);
cmd._dojoxMobileAddTheme(this,_22aa.themeSet.mobileTheme,true);
}
this.addModeledStyleSheet(this.getAppCssRelativeFile(),true);
var _22ac=this.getAppJsRelativeFile();
this.addHeaderScript(_22ac);
}
_22a8.find({elementType:"HTMLElement",tag:"script"}).forEach(function(_22ad){
for(var j=0;j<_22ad.children.length;j++){
var text=_22ad.children[j].getText();
if(text.indexOf("dojo.require")>=0){
_22ad.parent.removeChild(_22ad);
break;
}
}
});
var data=this._parse(_22a8);
if(this.frameNode){
if(!this.getGlobal()){
console.warn("Context._setContent called during initialization");
}
query(".loading",this.frameNode.parentNode).orphan();
this._continueLoading(data,_22a9,this,scope);
}else{
var _22ae;
dojo.some(data.scripts,function(url){
if(url.indexOf("/dojo.js")!=-1){
_22ae=url;
return true;
}
});
var _22af=this.getBase();
if(!_22ae){
dojo.some(_2252.getUserLibs(_22af.toString()),function(lib){
if(lib.id==="dojo"){
var _22b0=new Path(this.getBase()).append(lib.root).append("dojo/dojo.js");
_22ae=_22b0.relativeTo(this.getPath(),true).toString();
return true;
}
return false;
},this);
if(!_22ae){
_22ae=this.getDojoUrl();
console.warn("Falling back to use workbench's Dojo in the editor iframe");
}
}
var _22b1=this.containerNode;
_22b1.style.overflow="hidden";
var frame=dojo.create("iframe",this.iframeattrs,_22b1);
frame.dvContext=this;
this.frameNode=frame;
var _22b2=_2250.location()+"/";
if(this.baseURL){
_22b2=this.baseURL;
}
var doc=frame.contentDocument||frame.contentWindow.document,win=_2249.get(doc),subs={baseUrl:_22b2};
if(_22ae){
subs.dojoUrl=_22ae;
subs.id=this._id;
var _22b3={packages:this._getLoaderPackages()};
this._getDojoScriptValues(_22b3,subs);
if(this._bootstrapModules){
var mods="";
this._bootstrapModules.split(",").forEach(function(mod){
mods+=",'"+mod+"'";
});
subs.additionalModules=mods;
}
}
if(_22a8.themeCssFiles){
subs.themeCssFiles=""+_22a8.themeCssFiles.map(function(file){
return "<link rel=\"stylesheet\" type=\"text/css\" href=\""+file+"\">";
}).join()+"";
}
window["loading"+this._id]=function(_22b4,_22b5){
var _22b6=this;
try{
var win=_2249.get(doc),body=(this.rootNode=doc.body);
if(!body){
this._waiting=this._waiting||0;
if(this._waiting++<10){
setTimeout(window["loading"+this._id],500);
return;
}
throw "doc.body is null";
}
delete window["loading"+this._id];
body.id="myapp";
body.style.width="100%";
body.style.height="100%";
body.style.visibility="visible";
body.style.margin="0";
body._edit_context=this;
var _22b7=this._bootstrapModules.split(",");
if(_22b7.indexOf("dijit/dijit-all")!=-1){
win.dojo._postLoad=true;
}
win.require("dojo/_base/lang").isArray=win.dojo.isArray=function(it){
return it&&Object.prototype.toString.call(it)=="[object Array]";
};
}
catch(e){
console.error(e.stack||e);
_22b6=new Error(e.message,e.fileName,e.lineNumber);
lang.mixin(_22b6,e);
}
this._continueLoading(data,_22a9,_22b6,scope);
}.bind(this);
doc.open();
var _22b8=lang.replace(_2261,function(_22b9,key){
return subs.hasOwnProperty(key)?subs[key]:"";
});
doc.write(_22b8);
doc.close();
dojo.connect(doc.documentElement,"onkeypress",function(e){
if(e.charOrCode==8){
window.davinciBackspaceKeyTime=win.davinciBackspaceKeyTime=Date.now();
}
});
dojo.connect(doc.documentElement,"onkeydown",dojo.hitch(this,function(e){
this.editor.handleKeyEvent(e);
}));
}
},_continueLoading:function(data,_22ba,_22bb,scope){
var _22bc,_22bd={};
try{
if(_22bb instanceof Error){
throw _22bb;
}
_22bc=this._setSourceData(data).then(this.onload.bind(this),function(error){
_22bd.errorMessage="Unable to parse HTML source.  See console for error.  Please switch to \"Display Source\" mode and correct the error.";
console.error(error.stack||error.message);
});
}
catch(e){
_22bd=new Error(e.message,e.fileName,e.lineNumber);
lang.mixin(_22bd,e);
}
finally{
if(_22ba){
if(_22bc){
_22bc.then(function(){
_22ba.call((scope||this),_22bd);
}.bind(this));
}else{
_22ba.call((scope||this),_22bd);
}
}
}
},_getLoaderPackages:function(){
var libs=_2252.getUserLibs(this.getBase()),_22be,_22bf=[];
libs.some(function(lib){
if(lib.id==="dojo"){
_22be=new Path(lib.root+"/dojo");
return true;
}
return false;
});
libs=libs.concat({id:"widgets",root:this._getWidgetFolder()});
libs.forEach(function(lib){
var id=lib.id;
if(lib.root===undefined||id==="dojo"||id==="DojoThemes"){
return;
}
var root=new Path(lib.root).relativeTo(_22be).toString();
_22bf.push({name:lib.id,location:root});
});
return _22bf;
},_getDojoScriptValues:function(_22c0,subs){
var _22c1=this._getDojoJsElem();
var _22c2=_22c1.getAttribute("data-dojo-config");
_22c2=_22c2?_2245.eval("({ "+_22c2+" })","data-dojo-config"):{};
lang.mixin(_22c2,_22c0,{async:true,parseOnLoad:false});
subs.dojoConfig=JSON.stringify(_22c2).slice(1,-1).replace(/"/g,"'");
var attrs=[];
_22c1.attributes.forEach(function(attr){
var name=attr.name,val=attr.value;
if(name!=="src"&&name!=="data-dojo-config"){
attrs.push(name+"=\""+val+"\"");
}
});
if(attrs.length){
subs.additionalDojoAttrs=attrs.join(" ");
}
},_setSourceData:function(data){
this.themeChanged();
var theme=this.getThemeMeta();
if(theme&&theme.usingSubstituteTheme){
var _22c3=theme.usingSubstituteTheme.oldThemeName;
var _22c4=theme.usingSubstituteTheme.newThemeName;
data.styleSheets=data.styleSheets.map(function(sheet){
return sheet.replace(new RegExp("/"+_22c3,"g"),"/"+_22c4);
});
data.bodyClasses=data.bodyClasses.replace(new RegExp("\\b"+_22c3+"\\b","g"),_22c4);
if(this.editor&&this.editor.visualEditor&&this.editor.visualEditor._onloadMessages){
this.editor.visualEditor._onloadMessages.push(dojo.replace("Warning. File refers to CSS theme '{0}' which is not in your workspace. Using CSS theme '{1}' instead.",[_22c3,_22c4]));
}
}
this.setHeader({title:data.title,scripts:data.scripts,modules:data.modules,styleSheets:data.styleSheets,bodyClasses:data.bodyClasses,style:data.style});
var _22c5=data.content||"";
var _22c6=this.isActive();
if(_22c6){
this.select(null);
dojo.forEach(this.getTopWidgets(),this.detach,this);
}
var _22c7={},_22c8=this.getContainerNode();
if(data.maqAppStates){
_22c7.body=data.maqAppStates;
}
dojo.forEach(this.getTopWidgets(),function(w){
if(w.getContext()){
w.destroyWidget();
}
});
this.getDijit().registry.forEach(function(w){
w.destroy();
});
var brRE=/<\s*\/\s*br\s*>/gi;
var _22c5=_22c5.replace(brRE,"");
var _22c9;
this.getGlobal()["require"]("dojox/html/_base").set(_22c8,_22c5,{executeScripts:true,onEnd:function(){
_22c9=this._code;
this.executeScripts=false;
this.inherited("onEnd",arguments);
}});
var _22ca=function(node){
if(node){
dojo.filter(node.attributes,function(_22cb){
return _22cb.nodeName.substr(0,2).toLowerCase()=="on";
}).forEach(function(_22cc){
node.removeAttribute(_22cc.nodeName);
});
}
};
_22ca(_22c8);
query("*",_22c8).forEach(_22ca);
_22c8.setAttribute("data-maq-ws","collapse");
var _22cd=this._srcDocument.getDocumentElement().getChildElement("body");
_22cd.addAttribute("data-maq-ws","collapse");
var skip={SCRIPT:1,STYLE:1},_22ce=function(_22cf){
dojo.forEach(_22cf.childNodes,function(cn){
if(cn.nodeType==3){
cn.nodeValue=cn.data.replace(/^[\f\n\r\t\v\ ]+$/g,"");
}else{
if(cn.nodeType==1&&!skip[cn.nodeName]){
_22ce(cn);
}
}
});
};
_22ce(_22c8);
this._loadFileStatesCache=_22c7;
return this._processWidgets(_22c8,_22c6,this._loadFileStatesCache,_22c9);
},onload:function(){
this._connects=(this._connects||[]).concat(_224b.addInActivityMonitor(this.getDocument()));
window.setTimeout(function(){
var _22d0=this.getMobileDevice();
if(_22d0){
this.setMobileDevice(_22d0);
this.visualEditor.setDevice(_22d0);
}
window.setTimeout(function(){
this.widgetAddedOrDeleted();
dojo.publish("/davinci/ui/context/loaded",[this]);
this.editor.setDirty(this.hasDirtyResources());
}.bind(this),500);
}.bind(this),500);
},_processWidgets:function(_22d1,_22d2,_22d3,_22d4){
var _22d5=[];
dojo.forEach(query("*",_22d1),function(n){
var type=n.getAttribute("data-dojo-type")||n.getAttribute("dojoType")||n.getAttribute("dvwidget");
_22d5.push(this.loadRequires(type,false,true));
_22d5.push(this._preProcess(n));
this._preserveStates(n,_22d3);
},this);
var _22d6=new _2247();
all(_22d5).then(function(){
this.getGlobal()["require"]("dojo/ready")(function(){
try{
this.getGlobal()["require"]("dojo/parser").parse(_22d1);
_22d6.resolve();
}
catch(e){
console.error(e);
this.getDijit().registry.forEach(function(w){
w.destroy();
});
this._editorSelectConnection=dojo.subscribe("/davinci/ui/editorSelected",this,"_editorSelectionChange");
_22d6.reject(e);
throw e;
}
if(_22d2){
this._attachAll();
}
if(_22d4){
try{
dojox.html.evalInGlobal(_22d4,_22d1);
}
catch(e){
console.error("Error eval script in Context._setSourceData, "+e);
}
}
}.bind(this));
}.bind(this));
return _22d6;
},_preProcess:function(node){
var type=node.getAttribute("data-dojo-type")||node.getAttribute("dojoType");
return _2251.requireWidgetHelper(type).then(function(_22d7){
if(_22d7&&_22d7.preProcess){
_22d7.preProcess(node,this);
}
}.bind(this));
},_editorSelectionChange:function(event){
if(event.editor.fileName===this.editor.fileName){
dojo.unsubscribe(this._editorSelectConnection);
delete this._editorSelectConnection;
this._setSource(this._srcDocument);
}
},_attachAll:function(){
var _22d8=this.rootWidget=new _2258({},this.rootNode);
_22d8._edit_context=this;
_22d8.isRoot=true;
_22d8._srcElement=this._srcDocument.getDocumentElement().getChildElement("body");
_22d8._srcElement.setAttribute("id","myapp");
this._attachChildren(this.rootNode);
},_attachChildren:function(_22d9){
query("> *",_22d9).map(_2251.getWidget).forEach(this.attach,this);
},_onLoadHelpers:function(){
var _22da={};
query("> *",this.rootNode).map(_2251.getWidget).forEach(function(_22db){
var _22dc=_22db.getHelper();
if(_22dc&&_22dc.onLoad){
var _22dd=_22da[_22db.type];
_22da[_22db.type]=true;
_22dc.onLoad(_22db,_22dd);
}
},this);
},getHeader:function(){
return this._header||{};
},setHeader:function(_22de){
var _22df=[],_22e0,_22e1,_22e2;
if(this._header){
_22df=this._header.styleSheets||[];
_22e1=this._header.bodyClasses;
}
if(_22de){
_22e0=_22de.styleSheets||[];
_22e2=_22de.bodyClasses;
if(_22de.modules){
var _22e3=this.getGlobal()["require"];
_22de.modules.map(function(_22e4){
return [_22e4.replace(/\./g,"/")];
}).forEach(_22e3);
}
if(_22de.className){
var _22e5=_22de.className.split(" ");
dojo.some(_22e5,function(clasz,index){
_22e5.splice(index,1);
_22e2=_22e5.join(" ");
return true;
});
}
}
if(_22e1!=_22e2){
var _22e6=this.getContainerNode();
if(_22e1){
dojo.removeClass(_22e6,_22e1);
}
if(_22e2){
dojo.addClass(_22e6,_22e2);
}
}
if(_22df!=_22e0){
_22df=[].concat(_22df);
dojo.forEach(_22e0,function(s){
var index=dojo.indexOf(_22df,s);
if(index<0){
this.loadStyleSheet(s);
}else{
_22df.splice(index,1);
}
},this);
dojo.forEach(_22df,this.unloadStyleSheet,this);
}
this.setStyle(_22de?_22de.style:undefined);
this._header=_22de;
},getStyle:function(){
return this._header?this._header.style:undefined;
},setStyle:function(style){
var _22e7=(_2251.parseStyleValues(style));
if(this._header){
var _22e8=_2251.parseStyleValues(this._header.style);
if(_22e8){
for(var name in _22e8){
if(!_22e7[name]){
_22e7[name]=undefined;
}
}
}
this._header.style=style;
}else{
this._header={style:style};
}
},loadStyleSheet:function(url){
var doc=this.getDocument();
var dj=this.getDojo();
var links=dj.query("link");
var found=links.some(function(val){
return val.getAttribute("href")===url;
});
if(found){
return;
}
dojo.withDoc(doc,function(){
var link=dojo.create("link",{rel:"stylesheet",type:"text/css",href:url});
var _22e9=doc.getElementsByTagName("head")[0],_22ea=url.indexOf("app.css")>-1,_22eb=url.indexOf("content.css")>-1,_22ec,_22ed,_22ee,_22ef;
for(var i=0;i<links.length;i++){
if(links[i].href.indexOf("app.css")>-1){
_22ec=links[i];
_22ee=i;
}else{
if(links[i].href.indexOf("content.css")>-1){
_22ed=links[i];
_22ef=i;
}
}
}
var index,_22f0;
if(!_22eb){
if(_22ea&&_22ed){
_22f0=_22ed;
index=_22ef;
}else{
_22f0=_22ec;
index=_22ee;
}
}
if(_22f0){
_22e9.insertBefore(link,_22f0);
}else{
_22e9.appendChild(link);
}
});
},unloadStyleSheet:function(url){
var self=this;
var doc=this.getDocument();
var dj=this.getDojo();
var links=dj.query("link");
links.some(function(val,idx){
if(val.getAttribute("href")===url){
dojo.destroy(val);
return true;
}
});
},addModeledStyleSheet:function(url,_22f1){
if(!_22f1){
this.loadStyleSheet(url);
}
if(!this.model.hasStyleSheet(url)){
var _22f2=(url.indexOf("app.css")>-1);
var _22f3;
var _22f4=this.model.find({"elementType":"HTMLElement","tag":"style"},true);
if(_22f4){
var kids=_22f4.children;
for(var i=0;i<kids.length;i++){
if(kids[i].url.indexOf("app.css")>-1){
_22f3=kids[i];
}
}
}
var _22f5=_22f2?undefined:_22f3;
this.model.addStyleSheet(url,undefined,undefined,_22f5);
for(var css in this.model._loadedCSS){
this._loadedCSSConnects.push(dojo.connect(this.model._loadedCSS[css],"onChange",this,"_themeChange"));
}
}
},_themeChange:function(e){
if(e&&e.elementType==="CSSRule"){
this.editor.setDirty(true);
this.hotModifyCssRule(e);
}
},maqTempClassCount:0,maqTempClassPrefix:"maqTempClass",_preserveStates:function(node,cache){
var _22f6=davinci.ve.states.retrieve(node);
if(node.tagName!="BODY"&&(_22f6.maqAppStates||_22f6.maqDeltas)){
var _22f7=this.maqTempClassPrefix+this.maqTempClassCount;
node.className=node.className+" "+_22f7;
this.maqTempClassCount++;
cache[_22f7]={};
if(_22f6.maqAppStates){
cache[_22f7].maqAppStates=_22f6.maqAppStates;
}
if(_22f6.maqDeltas){
cache[_22f7].maqDeltas=_22f6.maqDeltas;
}
if(node.style){
cache[_22f7].style=node.style.cssText;
}else{
debugger;
}
}
},_restoreStates:function(){
var cache=this._loadFileStatesCache;
if(!cache){
console.error("Context._restoreStates: this._loadFileStatesCache missing");
return;
}
var _22f8,_22f9,_22fa,_22fb;
for(var id in cache){
var node=null;
if(id=="body"){
node=this.getContainerNode();
}
if(!node){
var doc=this.getDocument();
node=doc.querySelectorAll("."+id)[0];
if(node){
node.className=node.className.replace(" "+id,"");
}
}
if(!node){
console.error("Context.js _restoreStates node not found. id="+id);
continue;
}
var _22fc=_2251.getWidget(node);
var _22fd=(node.tagName=="BODY");
var _22fe=_22fc._srcElement;
_22f8=_22f9=_22fa=_22fb=null;
if(_22fd){
_22f8=cache[id];
}else{
_22f8=cache[id].maqAppStates;
_22f9=cache[id].maqDeltas;
}
var _22fa=_22fb=null;
var _22ff=false;
if(_22f8){
_22fa=davinci.states.deserialize(_22f8,{isBody:_22fd});
var _2300=_22fe.getAttribute(davinci.ve.states.APPSTATES_ATTRIBUTE);
if(_2300!=_22f8){
_22fe.setAttribute(davinci.ve.states.APPSTATES_ATTRIBUTE,_22f8);
_22ff=true;
}
if(_22fe.hasAttribute(davinci.ve.states.APPSTATES_ATTRIBUTE_P6)){
_22fe.removeAttribute(davinci.ve.states.APPSTATES_ATTRIBUTE_P6);
_22ff=true;
}
}
if(_22f9){
_22fb=davinci.states.deserialize(_22f9,{isBody:_22fd});
var _2300=_22fe.getAttribute(davinci.ve.states.DELTAS_ATTRIBUTE);
if(_2300!=_22f9){
_22fe.setAttribute(davinci.ve.states.DELTAS_ATTRIBUTE,_22f9);
_22ff=true;
}
if(_22fe.hasAttribute(davinci.ve.states.DELTAS_ATTRIBUTE_P6)){
_22fe.removeAttribute(davinci.ve.states.DELTAS_ATTRIBUTE_P6);
_22ff=true;
}
}
if(_22ff){
this.editor._visualChanged(true);
}
if(_22fa){
if(_22fa.initial){
_22fa.current=_22fa.initial;
}else{
if(_22fa.focus){
delete _22fa.focus;
}
delete _22fa.current;
}
}
davinci.ve.states.store(_22fc.domNode,_22fa,_22fb);
if(_22fb){
davinci.states.transferElementStyle(node,cache[id].style);
}
}
davinci.ve.states.removeUnusedStates(this);
var _2301=davinci.ve.states.getAllStateContainers(this.rootNode);
var _2302=[];
for(var i=0;i<_2301.length;i++){
var _2303=_2301[i];
if(_2303._maqAppStates&&typeof _2303._maqAppStates.current=="string"){
var focus=_2303._maqAppStates.focus;
davinci.states.setState(_2303._maqAppStates.current,_2303,{updateWhenCurrent:true,focus:focus});
}
}
},_AppStatesActivateActions:function(){
if(this.editor.declaredClass!=="davinci.ve.PageEditor"){
return;
}
if(!this.rootNode._maqAppStates){
this.rootNode._maqAppStates={};
var _2304=this.rootWidget._srcElement;
var o=_2255.serialize(this.rootNode);
if(o.maqAppStates){
_2304.setAttribute(_2255.APPSTATES_ATTRIBUTE,o.maqAppStates);
}else{
_2304.removeAttribute(_2255.APPSTATES_ATTRIBUTE);
}
this.editor._visualChanged(true);
}
var _2305=_2255.getFocus(this.rootNode);
if(!_2305){
var _2306=_2255.getState(this.rootNode);
_2255.setState(_2306,this.rootNode,{updateWhenCurrent:true,silent:true,focus:true});
}
},getDocument:function(){
var _2307=this.getContainerNode();
return _2307&&_2307.ownerDocument;
},getGlobal:function(){
var doc=this.getDocument();
return doc?_2249.get(doc):null;
},getDojo:function(){
var win=this.getGlobal();
return (win&&win.dojo)||dojo;
},getDijit:function(){
var win=this.getGlobal();
return win&&win.dijit||dijit;
},getContainerNode:function(){
return this.rootNode;
},getParentIframe:function(){
if(!this._parentIframeElem){
var _2308=this.getDocument();
var _2309=document.getElementsByTagName("iframe");
for(var i=0;i<_2309.length;i++){
if(_2309[i].contentDocument===_2308){
this._parentIframeElem=_2309[i];
break;
}
}
}
return this._parentIframeElem;
},getTopWidgets:function(){
var _230a=[];
for(var node=this.rootNode.firstChild;node;node=node.nextSibling){
if(node.nodeType==1&&node._dvWidget){
_230a.push(node._dvWidget);
}
}
return _230a;
},getContentPosition:function(_230b){
if(!_230b){
return undefined;
}
if(_230b.target){
_230b={x:_230b.pageX,y:_230b.pageY};
}
return _230b;
},getCommandStack:function(){
return this._commandStack;
},getSelection:function(){
return this._selection||[];
},inlineEditActive:function(){
return this.getSelection().some(function(item,i){
return this._focuses[i].inlineEditActive();
},this);
},updateFocus:function(_230c,index,_230d){
if(this.editor.getDisplayMode&&this.editor.getDisplayMode()=="source"){
return;
}
_2251.requireWidgetHelper(_230c.type).then(function(_230e){
if(!this.editor.isActiveEditor()){
return;
}
var box,op,_230f;
if(!_2253.queryDescriptor(_230c.type,"isInvisible")){
var box=null;
var _230e=_230c.getHelper();
if(_230e&&_230e.getMarginBoxPageCoords){
box=_230e.getMarginBoxPageCoords(_230c);
}else{
var node=_230c.getStyleNode();
if(_230e&&_230e.getSelectNode){
node=_230e.getSelectNode(this)||node;
}
box=_2260.getMarginBoxPageCoords(node);
}
_230f=_230c.getParent();
op={move:!(_230f&&_230f.isLayout&&_230f.isLayout())};
var _2310=(_230f&&_230f.isLayout&&_230f.isLayout())?"none":_2253.queryDescriptor(_230c.type,"resizable");
switch(_2310){
case "width":
op.resizeWidth=true;
break;
case "height":
op.resizeHeight=true;
break;
case "both":
op.resizeWidth=true;
op.resizeHeight=true;
}
}
this.focus({box:box,op:op,hasLayout:(_230c.isLayout&&_230c.isLayout()),isChild:_230f&&_230f.isLayout&&_230f.isLayout()},index,_230d);
this._focuses[0].showContext(this,_230c);
}.bind(this));
},updateFocusAll:function(){
if(this.editor&&this.editor.getDisplayMode&&this.editor.getDisplayMode()=="source"){
return;
}
var _2311=this._selection;
if(_2311){
for(var i=0;i<_2311.length;i++){
this.updateFocus(_2311[i],i);
}
}
},select:function(_2312,add,_2313){
if(!_2312||_2312==this.rootWidget){
if(!add){
this.deselect();
}
return;
}
var index,_2314=false;
if(this._selection){
_2314=this._selection.some(function(w,idx){
if(w===_2312){
index=idx;
return true;
}
return false;
});
}
if(!_2314){
var _2315;
if(add&&this._selection){
index=this._selection.length;
_2315=this._selection;
_2315.push(_2312);
}else{
_2315=[_2312];
}
var _2316=_2312.getParent();
if(_2316){
_2316.selectChild(_2312);
}
if(!this._selection||this._selection.length>1||_2315.length>1||this.getSelection()!=_2312){
var _2317=this._selection;
this._selection=_2315;
this.onSelectionChange(_2315,add);
if(_2317){
_2317.forEach(function(w){
var h=w.getHelper();
if(h&&h.onDeselect){
h.onDeselect(w);
}
},this);
}
var _2318=_2312.getHelper();
if(_2318&&_2318.onSelect){
_2318.onSelect(_2312);
}
}
}
this.updateFocus(_2312,index,_2313);
},deselect:function(_2319){
if(!this._selection){
return;
}
if(_2319){
helper=_2319.getHelper();
}
if(_2319&&this._selection.length){
if(this._selection.length===1){
if(this._selection[0]!=_2319){
return;
}
this.focus(null,0);
this._selection=undefined;
}else{
var index=dojo.indexOf(this._selection,_2319);
if(index<0){
return;
}
this.focus(null,index);
this._selection.splice(index,1);
}
if(helper&&helper.onDeselect){
helper.onDeselect(_2319);
}
}else{
if(this._selection){
this._selection.forEach(function(w){
var h=w.getHelper();
if(h&&h.onDeselect){
h.onDeselect(w);
}
},this);
}
this.focus(null);
this._selection=undefined;
}
this.onSelectionChange(this.getSelection());
},deselectInvisible:function(){
if(this._selection){
for(var i=this._selection.length-1;i>=0;i--){
var _231a=this._selection[i];
var _231b=_231a.domNode;
while(_231b&&_231b.tagName!="BODY"){
if(_231b&&_231b.ownerDocument&&_231b.ownerDocument.defaultView){
var _231c=dojo.style(_231b,"display");
if(_231c=="none"){
this.deselect(_231a);
break;
}
}
_231b=_231b.parentNode;
}
}
}
},getFocus:function(_231d){
var i=this.getSelection().indexOf(_231d);
return i==-1?null:this._focuses[i];
},checkFocusXY:function(pageX,pageY){
var _231e=this.getSelection();
for(var i=0;i<_231e.length;i++){
var box=this._focuses[i].getBounds();
if(pageX>=box.l&&pageX<=box.l+box.w&&pageY>=box.t&&pageY<=box.t+box.h){
return _231e[i];
}
}
return null;
},selectionHideFocus:function(){
var _231f=this.getSelection();
for(var i=0;i<_231f.length;i++){
this._focuses[i].hide();
}
},selectionShowFocus:function(){
var _2320=this.getSelection();
for(var i=0;i<_2320.length;i++){
this._focuses[i].show(_2320[i],{});
}
},focus:function(state,index,_2321){
this._focuses=this._focuses||[];
var clear=false;
if(index===undefined){
clear=true;
index=0;
}
var focus;
if(index<this._focuses.length){
focus=this._focuses[index];
}else{
dojo.withDoc(this.getDocument(),dojo.hitch(this,function(){
focus=new Focus();
focus._edit_focus=true;
focus._context=this;
}));
this._focuses.push(focus);
}
var _2322=this.getFocusContainer();
if(state){
if(state.box&&state.op){
if(!focus._connected){
this._connects.push(dojo.connect(focus,"onExtentChange",this,"onExtentChange"));
focus._connected=true;
}
var w=this.getSelection();
focus.resize(state.box,w[0]);
var _2323=index<w.length?index:0;
focus.resize(state.box,w[_2323]);
focus.allow(state.op);
if(focus.domNode.parentNode!=_2322){
_2322.appendChild(focus.domNode);
}
focus.show(w[_2323],{inline:_2321});
}else{
focus.hide();
}
index++;
}else{
if(!clear){
if(focus.domNode.parentNode==_2322){
focus.hide();
_2322.removeChild(focus.domNode);
}
this._focuses.splice(index,1);
this._focuses.push(focus);
}
}
if(clear){
this.hideFocusAll(index);
}
},hideFocusAll:function(_2324){
if(!_2324){
_2324=0;
}
var _2325=this.getFocusContainer();
if(this._focuses){
for(var i=_2324;i<this._focuses.length;i++){
focus=this._focuses[i];
if(focus.domNode.parentNode==_2325){
focus.hide();
_2325.removeChild(focus.domNode);
}
}
}
},getPreference:function(name){
if(!name){
return undefined;
}
return davinci.ve._preferences[name];
},getPreferences:function(){
return lang.mixin({},davinci.ve._preferences);
},setPreference:function(name,value){
if(!name){
return;
}
davinci.ve._preferences[name]=value;
if(this.isActive()){
}
},setPreferences:function(_2326){
if(_2326){
for(var name in _2326){
this.setPreference(name,_2326[name]);
}
}
},getFlowLayout:function(){
var _2327=this.getDocumentElement(),_2328=_2327.getChildElement("body"),_2329=_2328.getAttribute(_2267),_232a=_2328.getAttribute(_2268);
if(!_2329&&_232a){
_2328.removeAttribute(_2268);
_2328.setAttribute(_2267,_232a);
_2329=_232a;
this.editor._visualChanged();
}
if(!_2329){
_2329=true;
this.setFlowLayout(_2329);
}else{
_2329=(_2329==="true");
}
return _2329;
},setFlowLayout:function(_232b){
var _232c=this.getDocumentElement();
var _232d=_232c.getChildElement("body");
_232d.addAttribute(_2267,""+_232b);
return _232b;
},getActiveTool:function(){
return this._activeTool;
},setActiveTool:function(tool){
if(this._activeTool){
this._activeTool.deactivate();
}
this._activeTool=tool;
if(!this._activeTool){
this._activeTool=this._defaultTool;
}
this._activeTool.activate(this);
_2248.publish("/davinci/ve/activeToolChanged",[this,tool]);
},getActiveDragDiv:function(){
return (this._activeDragDiv);
},setActiveDragDiv:function(_232e){
this._activeDragDiv=_232e;
},blockChange:function(_232f){
this._blockChange=_232f;
},isFocusNode:function(node){
if(this._selection&&this._selection.length>0&&this._focuses&&this._focuses.length>=this._selection.length){
for(var i=0;i<this._selection.length;i++){
if(this._focuses[i].isFocusNode(node)){
return true;
}
}
}
return false;
},onMouseDown:function(event){
if(this._activeTool&&this._activeTool.onMouseDown&&!this._blockChange){
this._activeTool.onMouseDown(event);
}
this.blockChange(false);
},onDblClick:function(event){
},onMouseMove:function(event){
if(this._activeTool&&this._activeTool.onMouseMove&&!this._blockChange){
this._activeTool.onMouseMove(event);
}
},onMouseUp:function(event){
if(this._activeTool&&this._activeTool.onMouseUp){
this._activeTool.onMouseUp(event);
}
this.blockChange(false);
},onMouseOver:function(event){
if(this._activeTool&&this._activeTool.onMouseOver){
this._activeTool.onMouseOver(event);
}
},onMouseOut:function(event){
if(this._activeTool&&this._activeTool.onMouseOut){
this._activeTool.onMouseOut(event);
}
},onExtentChange:function(focus,_2330,_2331,_2332){
if(this._activeTool&&this._activeTool.onExtentChange&&!this._blockChange){
var index=dojo.indexOf(this._focuses,focus);
if(index>=0){
this._activeTool.onExtentChange({index:index,oldBoxes:[_2330],newBox:_2331,applyToWhichStates:_2332});
}
}
this.blockChange(false);
},_parse:function(_2333){
var data={metas:[],scripts:[],modules:[],styleSheets:[]},_2334=_2333.getDocumentElement(),head=_2334.getChildElement("head"),_2335=_2334.getChildElement("body");
this._uniqueIDs={};
if(_2335){
_2335.visit({visit:dojo.hitch(this,function(_2336){
if(_2336.elementType=="HTMLElement"&&_2336!=_2335){
this.getUniqueID(_2336);
}
})});
var _2337=_2335.getAttribute("class");
if(_2337){
data.bodyClasses=_2337;
}
data.style=_2335.getAttribute("style");
data.content=_2335.getElementText({includeNoPersist:true,excludeIgnoredContent:true});
var _2338=_2335.getAttribute(davinci.ve.states.APPSTATES_ATTRIBUTE);
if(!_2338){
_2338=_2335.getAttribute(davinci.ve.states.APPSTATES_ATTRIBUTE_P6);
if(_2338){
_2335.setAttribute(davinci.ve.states.APPSTATES_ATTRIBUTE,_2338);
}
}
_2335.removeAttribute(davinci.ve.states.APPSTATES_ATTRIBUTE_P6);
data.maqAppStates=_2338;
}
var _2339=head.getChildElement("title");
if(_2339){
data.title=_2339.getElementText();
}
var _233a=head.getChildElements("script");
dojo.forEach(_233a,function(_233b){
var value=_233b.getAttribute("src");
if(value){
data.scripts.push(value);
}
var text=_233b.getElementText();
if(text.length){
text.replace(/dojo\.require\(["']([^'"]+)["']\)/g,function(match,_233c){
data.modules.push(_233c);
});
text.replace(/require\(\[["']([^'"]+)["']\]\)/g,function(match,_233d){
data.modules.push(_233d);
});
}
},this);
var _233e=head.getChildElements("style");
dojo.forEach(_233e,function(_233f){
dojo.forEach(_233f.children,function(_2340){
if(_2340.elementType==="CSSImport"){
data.styleSheets.push(_2340.url);
}
});
});
return data;
},onKeyDown:function(event){
if(this._activeTool&&this._activeTool.onKeyDown){
this._activeTool.onKeyDown(event);
}
},onKeyUp:function(event){
if(this._activeTool&&this._activeTool.onKeyUp){
this._activeTool.onKeyUp(event);
}
},onContentChange:function(){
dojo.forEach(this.getSelection(),function(w,i){
if(i===0){
this.select(w);
}else{
this.select(w,true);
}
},this);
if(this.editor.editorID=="davinci.themeEdit.ThemeEditor"){
var _2341=Theme.getHelper(this.visualEditor.theme);
if(_2341&&_2341.onContentChange){
_2341.onContentChange(this,this.visualEditor.theme);
}else{
if(_2341&&_2341.then){
_2341.then(function(_2342){
if(_2342.helper&&_2342.helper.onContentChange){
_2342.helper.onContentChange(this,this.visualEditor.theme);
}
}.bind(this));
}
}
}
if(this._forceSelectionChange){
this.onSelectionChange(this.getSelection());
delete this._forceSelectionChange;
}
setTimeout(function(){
_2250._autoSave.call(_2250);
},0);
},onSelectionChange:function(_2343){
this._cssCache={};
dojo.publish("/davinci/ui/widgetSelected",[_2343]);
},hotModifyCssRule:function(r){
function _2344(sheet,rule){
var _2345=_2262.encodeURI(rule.parent.getResource().getURL());
var _2346=rule.getSelectorText();
_2346=_2346.replace(/^\s+|\s+$/g,"");
var _2347=_2348(sheet,_2345);
if(_2347){
var rules=_2347.cssRules;
var r=0;
for(r=0;r<rules.length;r++){
if(rules[r] instanceof CSSStyleRule){
if(rules[r].selectorText==_2346){
_2347.deleteRule(r);
break;
}
}
}
if(rule.properties.length>0){
var text=rule.getText({noComments:true});
_2347.insertRule(text,r);
}
return true;
}
return false;
};
function _2348(sheet,_2349){
if(sheet.href==_2349){
return sheet;
}
var _234a;
var rules=sheet.cssRules;
for(var r=0;r<rules.length;r++){
var x=""+rules[r].constructor;
if(rules[r] instanceof CSSImportRule||x==="[object CSSImportRuleConstructor]"){
var n=rules[r].href;
if(rules[r].href==_2349){
_234a=rules[r].styleSheet;
}else{
_234a=_2348(rules[r].styleSheet,_2349);
}
if(_234a){
break;
}
}
}
return _234a;
};
var _234b=this.getDocument().styleSheets;
dojo.some(_234b,function(sheet){
return _2344(sheet,r);
});
},ruleSetAllProperties:function(rule,_234c){
rule.removeAllProperties();
for(i=0;i<_234c.length;i++){
rule.addProperty(_234c[i].name,_234c[i].value);
}
},modifyRule:function(rule,_234d){
var i,p,prop,_234e=[];
var _234f=[];
for(i=0;i<_234d.length;i++){
for(var name in _234d[i]){
var prop=rule.getProperty(name);
if(prop){
_234f.push(prop);
}
rule.removeProperty(name);
}
}
for(p=0;p<rule.properties.length;p++){
prop=rule.properties[p];
var o={};
o[prop.name]=prop.value;
_234e.push(o);
}
var _2350=_234e.concat(dojo.clone(_234d));
function _2351(value){
for(var i=0;i<_2350.length;i++){
if(_2350[i].hasOwnProperty(value)){
return i;
}
}
return -1;
};
var _2352=_2259.shorthand;
var _2353=0;
for(i=0;i<_2352.length;i++){
var index=_2351(_2352[i][0]);
if(index>-1){
var _2354=_2350[index];
_2350.splice(index,1);
_2350.splice(_2353,0,_2354);
_2353++;
}
}
for(p=rule.properties.length-1;p>=0;p--){
prop=rule.properties[p];
if(prop){
_234f.push(rule.getProperty(prop.name));
rule.removeProperty(prop.name);
}
}
for(i=0;i<_2350.length;i++){
for(var name in _2350[i]){
if(_2350[i][name]&&_2350[i][name]!==""){
rule.addProperty(name,_2350[i][name]);
for(var x=0;x<_234f.length;x++){
if(_234f[x].name===name){
var _2355=rule.getProperty(name,_2350[i][name]);
if(_234f[x].comment){
_2355.comment=_234f[x].comment;
}
if(_234f[x].postComment){
_2355.postComment=_234f[x].postComment;
}
_234f.splice(x,1);
break;
}
}
}
}
}
},getRelativeMetaTargetSelector:function(_2356){
var theme=this.getThemeMeta();
if(!theme){
return [];
}
var state="Normal";
var _2357=this.getSelection();
if(!_2357.length){
return [];
}
_2357=_2357[0];
var _2358=theme.loader.getType(_2357);
return theme.metadata.getRelativeStyleSelectorsText(_2358,state,null,_2356,this.getTheme().className);
},getSelector:function(_2359,_235a){
var theme=this.getThemeMeta();
if(!theme){
return [];
}
var state="Normal";
var _235b=theme.loader.getType(_2359),_235c=theme.metadata.getStyleSelectors(_235b,state);
if(_235c){
for(var name in _235c){
for(var i=0;i<_235c[name].length;i++){
for(var s=0;s<_235a.length;s++){
if(_235a[s]==_235c[name][i]){
return name;
}
}
}
}
}
},getMetaTargets:function(_235d,_235e){
var name=this.getSelector(_235d,_235e),model=this.getModel();
var rules=model.getRule(name);
var _235f=[];
rules.forEach(function(rule){
if(rule.getSelectorText()===name){
_235f.push(rule);
}
}.bind(this));
return _235f;
},getWidgetTopDom:function(_2360,_2361){
var _2362=this.getSelector(_2360,_2361);
function _2363(_2364,rule){
if(rule.matches(_2364)){
return _2364;
}
for(var i=0;i<_2364.children.length;i++){
return _2363(_2364.children[i],rule);
}
};
if(_2362){
var rule=new _225a();
rule.setText(_2362+"{}");
return _2363(_2360.domNode||_2360,rule);
}
return null;
},getSelectionCssRules:function(_2365){
this._cssCache=this._cssCache||{};
var _2366=function(node){
return node.id+"_"+node.className;
};
var _2367=this.getSelection();
if(!_2365&&!_2367.length){
return {rules:null,matchLevels:null};
}
var _2368=_2365||_2367[0].domNode||_2367[0],_2369=_2366(_2368);
if(_2367.length){
var match=this._cssCache[_2369]=this.model.getMatchingRules(_2368,true);
if(this.cssFiles){
this.cssFiles.forEach(function(file){
file.getMatchingRules(_2368,match.rules,match.matchLevels);
});
}
match.rules.forEach(function(rule){
var _236a=dojo.hitch(rule,"onChange",this,function(){
delete this._cssCache[_2369];
dojo.unsubscribe(_236a);
});
},this);
return match;
}
return {rules:null,matchLevels:null};
},getStyleAttributeValues:function(_236b){
var _236c=_236b?_236b.getStyleValues():[];
var _236d=_2255.getStateContainersForNode(_236b.domNode);
var _236e=true;
for(var sc=0;sc<_236d.length;sc++){
var _236f=_236d[sc];
var state=_2255.getState(_236f);
if(state&&state!=_2255.NORMAL){
_236e=false;
break;
}
}
if(!_236e){
var _2370=davinci.ve.states.getStatesListCurrent(_236b.domNode);
var _2371=davinci.ve.states.getStyle(_236b.domNode,_2370);
if(_2371){
for(var i=0;i<_2371.length;i++){
var sItem=_2371[i];
for(var sProp in sItem){
for(var j=_236c.length-1;j>=0;j--){
var vItem=_236c[j];
for(var vProp in vItem){
if(sProp==vProp){
_236c.splice(j,1);
break;
}
}
}
}
}
_236c=_236c.concat(_2371);
}
}
return _236c;
},getUniqueID:function(node,_2372){
var id=node.getAttribute("id");
if(!id){
var _2373=this.rootWidget?this.rootWidget.domNode.ownerDocument:null,root=_2372||node.tag,num;
while(1){
if(!this._uniqueIDs.hasOwnProperty(root)){
num=this._uniqueIDs[root]=0;
}else{
num=++this._uniqueIDs[root];
}
id=root+"_"+num;
if(_2373){
if(!_2373.getElementById(id)){
break;
}
}else{
break;
}
}
var temp=!_2372;
node.addAttribute("id",id,temp);
}
return id;
},addJavaScriptSrc:function(url,_2374,_2375,_2376){
var _2377=/\/dojo.js$/.test(url),_2378=[];
if(!_2377&&!_2376){
var _2379=this,_237a=new dojo._Url(this.getDocument().baseURI,url).toString();
_2378.push(xhr.get({url:_237a,sync:true}).then(function(data){
_2379.getGlobal()["eval"](data);
}));
}
if(_2374){
var head=this.getDocumentElement().getChildElement("head"),_237b={parseOnLoad:true,async:true,packages:this._getLoaderPackages()},found=head.getChildElements("script").some(function(_237c){
var _237d=_237c.getAttribute("src");
if(_237d&&_237d.indexOf(_2375)>-1){
_237c.setAttribute("src",url);
return true;
}
});
if(found){
if(_2377){
this._updateDojoConfig(_237b);
}
}else{
if(_2377){
this.addHeaderScript(url,{"data-dojo-config":JSON.stringify(_237b).slice(1,-1).replace(/"/g,"'")});
_2378.push(this.addJavaScriptModule("dijit/dijit",true,true));
_2378.push(this.addJavaScriptModule("dojo/parser",true,true));
}else{
this.addHeaderScript(url);
}
}
}
return all(_2378);
},_reRequire:/\brequire\s*\(\s*\[\s*([\s\S]*?)\s*\]\s*\)/,_reModuleId:/[\w.\/]+/g,addJavaScriptModule:function(mid,_237e,_237f){
var _2380=new _2247();
if(!_237f){
this.getGlobal().require([mid],function(_2381){
_2380.resolve(_2381);
});
}else{
_2380.resolve();
}
if(_237e){
if(!this._requireHtmlElem){
var head=this.getDocumentElement().getChildElement("head"),found;
found=head.getChildElements("script").some(function(child){
var _2382=child.find({elementType:"HTMLText"},true);
if(_2382){
if(this._reRequire.test(_2382.getText())){
this._requireHtmlElem=child;
return true;
}
}
},this);
if(!found){
this._requireHtmlElem=this.addHeaderScriptText("require([\""+mid+"\"]);\n");
return _2380;
}
}
var _2383=this._requireHtmlElem.find({elementType:"HTMLText"},true),text=_2383.getText(),m=text.match(this._reRequire),arr=m[1].match(this._reModuleId);
if(arr.indexOf(mid)===-1){
arr.push(mid);
text=text.replace(this._reRequire,"require("+JSON.stringify(arr,null,"  ")+")");
_2383.setText(text);
_2383.parent.setScript(text);
}
}
return _2380;
},addJavaScriptText:function(text,_2384,_2385){
if(!_2385){
try{
this.getGlobal()["eval"](text);
}
catch(e){
var len=text.length;
console.error("eval of \""+text.substr(0,20)+(len>20?"...":"")+"\" failed");
}
}
if(_2384){
this.addHeaderScriptText(text);
}
},addHeaderScript:function(url,_2386){
var _2387=new _225c("script");
_2387.addAttribute("type","text/javascript");
_2387.addAttribute("src",url);
if(_2386){
for(var name in _2386){
_2387.addAttribute(name,_2386[name]);
}
}
var head=this.getDocumentElement().getChildElement("head");
head.addChild(_2387);
},addHeaderScriptText:function(text){
var head=this.getDocumentElement().getChildElement("head"),_2388,_2389=head.children,i,node;
for(i=_2389.length-1;i>=0;i--){
node=_2389[i];
if(node.elementType==="HTMLElement"&&node.tag==="script"){
_2388=node.find({elementType:"HTMLText"},true);
break;
}
}
if(!_2388){
var _238a=new _225c("script");
_238a.addAttribute("type","text/javascript");
_238a.script="";
head.addChild(_238a);
_2388=new _225d();
_238a.addChild(_2388);
}
var _238b=_2388.getText();
if(_238b.indexOf(text)===-1){
var _238c=_238b+"\n"+text;
_2388.setText(_238b+"\n"+text);
_2388.parent.setScript(_238b+"\n"+text);
}
return _2388.parent;
},_significantAttrs:{link:"href",meta:"name"},_addHeadElement:function(tag,attrs,_238d){
var head=this.getDocumentElement().getChildElement("head");
if(!_238d){
var _238e=this._significantAttrs[tag]||"src";
var found=head.getChildElements(tag).some(function(elem){
return elem.getAttribute(_238e)===attrs[_238e];
});
if(found){
return;
}
}
var elem=new _225c(tag);
for(var name in attrs){
if(attrs.hasOwnProperty(name)){
elem.addAttribute(name,attrs[name]);
}
}
head.addChild(elem);
dojo.withGlobal(this.getGlobal(),function(){
dojo.create(tag,attrs,query("head")[0]);
});
},_removeHeadElement:function(tag,attrs){
var head=this.getDocumentElement().getChildElement("head");
head.getChildElements(tag).some(function(elem){
var found=true;
for(var name in attrs){
if(attrs.hasOwnProperty(name)){
if(elem.getAttribute(name)!==attrs[name]){
found=false;
break;
}
}
}
if(found){
head.removeChild(elem);
return true;
}
});
dojo.withGlobal(this.getGlobal(),function(){
var _238f=tag;
for(var name in attrs){
if(attrs.hasOwnProperty(name)){
_238f+="["+name+"=\""+attrs[name]+"\"]";
}
}
var n=query(_238f)[0];
if(n){
dojo.destroy(n);
}
});
},_getDojoJsElem:function(){
if(!this._dojoScriptElem){
var head=this.getDocumentElement().getChildElement("head"),found=head.getChildElements("script").some(function(child){
if(/\/dojo.js$/.test(child.getAttribute("src"))){
this._dojoScriptElem=child;
return true;
}
},this);
if(!found){
console.error("\"dojo.js\" script element not found!");
return;
}
}
return this._dojoScriptElem;
},_updateDojoConfig:function(data){
this.close();
var _2390=this._getDojoJsElem(),_2391=_2390.getAttribute("data-dojo-config");
_2391=_2391?_2245.eval("({ "+_2391+" })","data-dojo-config"):{};
var regEx="";
if(_2391.mblLoadCompatPattern){
regEx=", mblLoadCompatPattern: "+_2391.mblLoadCompatPattern.toString();
delete _2391.mblLoadCompatPattern;
}
for(var prop in data){
if(prop=="mblLoadCompatPattern"){
if(data[prop]===null){
regEx="";
}else{
regEx=", 'mblLoadCompatPattern': "+data[prop];
}
}else{
if(data[prop]===null){
delete _2391[prop];
}else{
_2391[prop]=data[prop];
}
}
}
var str=JSON.stringify(_2391).slice(1,-1).replace(/"/g,"'");
str=str+regEx,_2390.setAttribute("data-dojo-config",str);
},_addCssForDevice:function(_2392,_2393,_2394){
for(var i=0,len=_2393.length;i<len;i++){
var item=_2393[i];
if(item[0]===_2392||item[0]===".*"){
if(!this.themeCssFiles){
this.themeCssFiles=[];
}
var _2395=item[2];
this.themeCssFiles=this.themeCssFiles.concat(_2395);
this._themePath=new davinci.model.Path(this.visualEditor.fileName);
this._getCssFiles().forEach(function(file){
this._loadedCSSConnects.push(dojo.connect(file,"onChange",this,"_themeChange"));
},this);
break;
}
}
},_configDojoxMobile:function(){
try{
var dm=this.getGlobal()["require"]("dojox/mobile");
var _2396=this.getGlobal()["require"]("dojox/mobile/deviceTheme");
var _2397=this.getDojo().config,_2398=this._getDojoJsElem().getAttribute("data-dojo-config"),ua=_2397.mblUserAgent||"none",_2399,_239a,_239b;
_2398=_2398?_2245.eval("({ "+_2398+" })","data-dojo-config"):{};
_2399=_2398.themeMap;
_239a=_2398.mblThemeFiles;
_239b=_2398.mblLoadCompatPattern;
delete this.themeCssFiles;
delete this.cssFiles;
if(!_2399){
_2399=Theme.getDojoxMobileThemeMap(this,dojo.clone(Theme.dojoMobileDefault));
_239a=[];
var _239c=Theme.getThemeLocation().toString().replace(/\//g,"\\/");
var re=new RegExp("/"+_239c+"/.*.css$");
_239b=re;
}
this._addCssForDevice(ua,_2399,this);
_2396.themeMap=_2399;
if(_239a){
_2397.mblThemeFiles=_239a;
}else{
delete _2397.mblThemeFiles;
}
if(_239b){
_2397.mblLoadCompatPattern=_239b;
dm.loadCompatPattern=_239b;
}else{
delete _2397.mblLoadCompatPattern;
dm.loadCompatPattern=/\/mobile\/themes\/.*\.css$/;
}
if(this._selection){
this.onSelectionChange(this._selection);
}
_2396.loadDeviceTheme(ua);
}
catch(e){
}
},dragMoveUpdate:function(_239d){
var _239e=this,cp=this._chooseParent,_239f=_239d.widgets,data=_239d.data,_23a0=_239d.eventTarget,_23a1=_239d.position,_23a2=_239d.absolute,_23a3=_239d.currentParent,rect=_239d.rect,_23a4=_239d.doSnapLinesX,_23a5=_239d.doSnapLinesY,_23a6=_239d.doFindParentsXY,_23a7=_239d.doCursor,_23a8=_239d.beforeAfter,_23a9=dojo.isArray(data)?data[0].type:data.type;
var _23aa=function(_23ab){
if(_239d.widgets){
if(_239d.widgets.indexOf(_23ab)>=0){
return;
}
}
var node=_23ab.domNode,dj=this.getDojo(),_23ac=dj.style(node);
if(_23a4||_23a5){
Snap.findSnapOpportunities(this,_23ab,_23ac,_23a4,_23a5);
}
cp.findParentsXY({data:data,widget:_23ab,absolute:_23a2,position:_23a1,doCursor:_23a7,beforeAfter:_23a8});
dojo.forEach(_23ab.getChildren(),function(w){
_23aa.apply(_239e,[w]);
});
};
if(_23a4||_23a5){
doSnapLines=Snap.updateSnapLinesBeforeTraversal(this,rect);
}
var _23ad=cp.findParentsXYBeforeTraversal(_239d);
_23aa.apply(_239e,[this.rootWidget]);
if(_23a4||_23a5){
Snap.updateSnapLinesAfterTraversal(this);
}
cp.findParentsXYAfterTraversal(_239d);
if(_23ad){
cp.dragUpdateCandidateParents({widgetType:_23a9,showCandidateParents:_23a6,doCursor:_23a7,beforeAfter:_23a8,absolute:_23a2,currentParent:_23a3});
cp.findParentsXYCleanup(_239d);
}
},dragMoveCleanup:function(){
Snap.clearSnapLines(this);
this._chooseParent.cleanup(this);
},getThemeMetaDataByWidget:function(_23ae){
var theme=this.getThemeMeta();
if(!theme){
return null;
}
var _23af=theme.loader.getType(_23ae);
var meta=theme.loader.getMetaData(_23af);
if(!meta&&this.cssFiles){
for(var i=0;i<this.cssFiles.length;i++){
var _23b0=Theme.getThemeByCssFile(this.cssFiles[i]);
if(_23b0){
var _23b1=_2252.getThemeMetadata(_23b0);
meta=_23b1.loader.getMetaData(_23af);
if(meta){
break;
}
}
}
}
return meta;
},registerSceneManager:function(_23b2){
if(!_23b2||!_23b2.id){
return;
}
var id=_23b2.id;
if(!this.sceneManagers[id]){
this.sceneManagers[id]=_23b2;
dojo.publish("/davinci/ui/context/registerSceneManager",[_23b2]);
}
},getStatesScenes:function(){
var _23b3=_2255.getFocus(this.rootNode);
if(!_23b3){
_23b3={};
_23b3.stateContainerNode=this.rootNode;
}
if(typeof _23b3.state!="string"){
_23b3.state=_2255.NORMAL;
}
var _23b4=_2255.getAllStateContainers(this.rootNode);
var _23b5=[];
for(var i=0;i<_23b4.length;i++){
var _23b6=_23b4[i];
var _23b7=_2255.getState(_23b6);
var _23b8=typeof _23b7=="string"?_23b7:_2255.NORMAL;
var xpath=_2256.getXPath(_23b6._dvWidget._srcElement,_2257);
var focus=(_23b3.stateContainerNode==_23b6&&_23b3.state==_23b8);
_23b5.push({currentStateXPath:xpath,state:_23b7,focus:focus});
}
scenesInfo={};
var _23b9=this.sceneManagers;
for(var _23ba in _23b9){
var sm=_23b9[_23ba];
scenesInfo[_23ba]={sm:sm,sceneContainers:[]};
var _23bb=sm.getAllSceneContainers();
for(var i=0;i<_23bb.length;i++){
var o={};
var _23bc=_23bb[i];
var _23bd=sm.getCurrentScene(_23bc);
var xpath=_2256.getXPath(_23bc._dvWidget._srcElement,_2257);
o.sceneContainerXPath=xpath;
var xpath=_2256.getXPath(_23bd._dvWidget._srcElement,_2257);
o.currentSceneXPath=xpath;
scenesInfo[_23ba].sceneContainers.push(o);
}
}
return {statesInfo:_23b5,scenesInfo:scenesInfo};
},setStatesScenes:function(_23be){
var _23bf=_23be.statesInfo;
if(_23bf){
for(var i=0;i<_23bf.length;i++){
var xpath=_23bf[i].currentStateXPath;
var id=this.model.evaluate(xpath).getAttribute("id"),_23c0=_2251.byId(id,this.getDocument()),node=_23c0.domNode;
_2255.setState(_23bf[i].state,node,{focus:_23bf[i].focus});
}
}
var _23c1=_23be.scenesInfo;
var _23c2=this.sceneManagers;
for(var _23c3 in _23c1){
var sm=_23c1[_23c3].sm;
var _23c4=_23c1[_23c3].sceneContainers;
for(var i=0;i<_23c4.length;i++){
var _23c5=_23c4[i];
var xpath=_23c5.sceneContainerXPath;
var id=this.model.evaluate(xpath).getAttribute("id"),_23c0=_2251.byId(id,this.getDocument()),_23c6=_23c0.domNode;
xpath=_23c5.currentSceneXPath;
id=this.model.evaluate(xpath).getAttribute("id");
sm.selectScene({sceneContainerNode:_23c6,sceneId:id});
}
}
},onCommandStackExecute:function(){
this.clearCachedWidgetBounds();
if(this.editor&&this.editor.editorContainer&&this.editor.editorContainer.updateToolbars){
this.editor.editorContainer.updateToolbars();
}
},widgetAddedOrDeleted:function(_23c7){
var _23c8=Theme.getHelper(this.getTheme());
if(_23c8&&_23c8.widgetAddedOrDeleted){
_23c8.widgetAddedOrDeleted(this,_23c7);
}else{
if(_23c8&&_23c8.then){
_23c8.then(function(_23c9){
if(_23c9.helper){
this.theme.helper=_23c9.helper;
if(_23c9.helper.widgetAddedOrDeleted){
_23c9.helper.widgetAddedOrDeleted(this,_23c7);
}
}
}.bind(this));
}
}
},WIDGET_MODIFIED:0,WIDGET_ADDED:1,WIDGET_REMOVED:2,WIDGET_REPARENTED:3,WIDGET_ID_CHANGED:4,widgetChanged:function(type,_23ca){
},getPageLeftTop:function(node){
var _23cb=node.offsetLeft;
var _23cc=node.offsetTop;
var pn=node.offsetParent;
while(pn&&pn.tagName!="BODY"){
_23cb+=pn.offsetLeft;
_23cc+=pn.offsetTop;
pn=pn.offsetParent;
}
return {l:_23cb,t:_23cc};
},resizeAllWidgets:function(){
this.getTopWidgets().forEach(function(_23cd){
if(_23cd.resize){
_23cd.resize();
}
});
},hasDirtyResources:function(){
var dirty=false;
var _23ce=this.getBaseResource();
if(_23ce){
dirty=_23ce.isDirty();
}
if(dirty){
return dirty;
}
var _23cf={visit:function(node){
if((node.elementType=="HTMLFile"||node.elementType=="CSSFile")&&node.isDirty()){
dirty=true;
}
return dirty;
}};
this.getModel().visit(_23cf);
if(dirty){
return dirty;
}
dirty=this.dirtyDynamicCssFiles(this.cssFiles);
return dirty;
},getAllWidgets:function(){
var _23d0=[];
function find(_23d1){
_23d0.push(_23d1);
_23d1.getChildren().forEach(function(child){
find(child);
});
};
if(this.rootWidget){
find(this.rootWidget);
}
return _23d0;
},getParentIframeBounds:function(){
var _23d2=this.getParentIframe();
if(_23d2){
var box=_2260.getBorderBoxPageCoords(_23d2);
return box;
}
},getDesignPaneBounds:function(){
var _23d3=this.getParentIframe();
var node=_23d3;
var _23d4;
while(node&&node.tagName!="BODY"){
if(dojo.hasClass(node,"designCP")){
_23d4=node;
}
node=node.parentNode;
}
if(_23d4){
var box=_2260.getBorderBoxPageCoords(_23d4);
return box;
}else{
console.error("Context.js:getDesignPaneBounds. No designCP");
}
},getFocusContainer:function(){
return document.getElementById("focusContainer");
},clearCachedWidgetBounds:function(){
var _23d5=this.getAllWidgets();
for(var i=0;i<_23d5.length;i++){
var _23d6=_23d5[i].domNode;
if(_23d6){
_2260.clearGeomCache(_23d6);
}
}
},reorderPreserveSiblingOrder:function(_23d7){
var _23d8=[];
for(var i=0;i<_23d7.length;i++){
_23d8[i]=_23d7[i];
}
var j=0;
while(j<(_23d8.length-1)){
var _23d9=_23d8[j];
var _23da=_23d9.getParent();
var k=j+1;
var _23db=false;
while(k<_23d8.length){
var _23dc=_23d8[k].getParent();
if(_23dc==_23da){
_23db=true;
k++;
}else{
break;
}
}
if(_23db){
var _23dd=_23da.getChildren();
for(var m=(k-2);m>=j;m--){
for(var n=j;n<=m;n++){
var _23de=_23dd.indexOf(_23d8[n]);
var _23df=_23dd.indexOf(_23d8[n+1]);
if(_23de>_23df){
var temp=_23d8[n+1];
_23d8[n+1]=_23d8[n];
_23d8[n]=temp;
}
}
}
}
j=k;
}
return _23d8;
}});
});
},"davinci/model/Factory":function(){
define(["dojo/_base/declare","davinci/html/CSSFile","davinci/js/JSFile","davinci/html/HTMLFile","system/resource"],function(_23e0,_23e1,_23e2,_23e3,_23e4){
var _23e5=[];
var _23e6=[];
var _23e7={getModel:function(args){
var url=args.url;
if(!url){
return null;
}
for(var i=0;i<_23e6.length;i++){
if(_23e6[i].url==url){
_23e5[i]++;
this.incrementImports(_23e6[i]);
return _23e6[i];
}
}
if(url.indexOf("css")>0){
return _23e7.newCSS(args);
}
if(url.indexOf("html")>0){
return _23e7.newHTML(args);
}
if(url.indexOf("js")>0){
return _23e7.newJS(args);
}
},closeModel:function(model){
var url=model.url;
if(!url){
return null;
}
for(var i=0;i<_23e6.length;i++){
if(_23e6[i].url==url){
var _23e8=_23e6[i];
_23e5[i]--;
if(_23e5[i]===0){
_23e6.splice(i,1);
_23e5.splice(i,1);
var _23e9=_23e4.findResource(url);
if(_23e9&&_23e9.dirtyResource){
_23e9.removeWorkingCopy();
_23e9.dirtyResource=false;
}
}
}
}
},newHTML:function(args){
var model=new _23e3(args.url);
_23e6.push(model);
var count=_23e6.length-1;
_23e5[count]=1;
return model;
},newCSS:function(args){
var model=new _23e1(args);
_23e6.push(model);
var count=_23e6.length-1;
_23e5[count]=1;
return model;
},newJS:function(args){
var model=new _23e2(args);
_23e6.push(model);
var count=_23e6.length-1;
_23e5[count]=1;
return model;
},getNewFromResource:function(_23ea){
var _23eb=_23ea.extension;
if(!_23eb){
return new _23e3();
}
switch(_23eb){
case "html":
return new _23e3();
break;
case "css":
return new _23e1();
break;
case "js":
case "json":
return new _23e2();
break;
default:
return new _23e3();
}
},incrementImports:function(_23ec){
var _23ed={visit:function(node){
if(node.elementType=="CSSImport"){
var url=node.cssFile.url;
for(var i=0;i<_23e6.length;i++){
if(_23e6[i].url==url){
_23e5[i]++;
}
}
}
return false;
}};
if(_23ec){
_23ec.visit(_23ed);
}
},log:function(){
for(var i=0;i<_23e6.length;i++){
}
}};
var _23ee=require(["dojo/_base/connect"],function(_23ef){
_23ef.subscribe("davinci/model/closeModel",_23e7,_23e7.closeModel);
});
return _23e7;
});
},"dojox/form/uploader/plugins/HTML5":function(){
define("dojox/form/uploader/plugins/HTML5",["dojo/_base/declare","dojo/_base/lang","dojo/_base/array","dojo"],function(_23f0,lang,array,dojo){
var _23f1=_23f0("dojox.form.uploader.plugins.HTML5",[],{errMsg:"Error uploading files. Try checking permissions",uploadType:"html5",postCreate:function(){
this.connectForm();
this.inherited(arguments);
if(this.uploadOnSelect){
this.connect(this,"onChange",function(data){
this.upload(data[0]);
});
}
},_drop:function(e){
dojo.stopEvent(e);
var dt=e.dataTransfer;
this._files=dt.files;
this.onChange(this.getFileList());
},upload:function(_23f2){
this.onBegin(this.getFileList());
if(this.supports("FormData")){
this.uploadWithFormData(_23f2);
}else{
if(this.supports("sendAsBinary")){
this.sendAsBinary(_23f2);
}
}
},addDropTarget:function(node,_23f3){
if(!_23f3){
this.connect(node,"dragenter",dojo.stopEvent);
this.connect(node,"dragover",dojo.stopEvent);
this.connect(node,"dragleave",dojo.stopEvent);
}
this.connect(node,"drop","_drop");
},sendAsBinary:function(data){
if(!this.getUrl()){
console.error("No upload url found.",this);
return;
}
var _23f4="---------------------------"+(new Date).getTime();
var xhr=this.createXhr();
xhr.setRequestHeader("Content-Type","multipart/form-data; boundary="+_23f4);
var msg=this._buildRequestBody(data,_23f4);
if(!msg){
this.onError(this.errMsg);
}else{
xhr.sendAsBinary(msg);
}
},uploadWithFormData:function(data){
if(!this.getUrl()){
console.error("No upload url found.",this);
return;
}
var fd=new FormData(),_23f5=this._getFileFieldName();
array.forEach(this._files,function(f,i){
fd.append(_23f5,f);
},this);
if(data){
for(var nm in data){
fd.append(nm,data[nm]);
}
}
var xhr=this.createXhr();
xhr.send(fd);
},_xhrProgress:function(evt){
if(evt.lengthComputable){
var o={bytesLoaded:evt.loaded,bytesTotal:evt.total,type:evt.type,timeStamp:evt.timeStamp};
if(evt.type=="load"){
o.percent="100%";
o.decimal=1;
}else{
o.decimal=evt.loaded/evt.total;
o.percent=Math.ceil((evt.loaded/evt.total)*100)+"%";
}
this.onProgress(o);
}
},createXhr:function(){
var xhr=new XMLHttpRequest();
var timer;
xhr.upload.addEventListener("progress",lang.hitch(this,"_xhrProgress"),false);
xhr.addEventListener("load",lang.hitch(this,"_xhrProgress"),false);
xhr.addEventListener("error",lang.hitch(this,function(evt){
this.onError(evt);
clearInterval(timer);
}),false);
xhr.addEventListener("abort",lang.hitch(this,function(evt){
this.onAbort(evt);
clearInterval(timer);
}),false);
xhr.onreadystatechange=lang.hitch(this,function(){
if(xhr.readyState===4){
clearInterval(timer);
this.onComplete(JSON.parse(xhr.responseText.replace(/^\{\}&&/,"")));
}
});
xhr.open("POST",this.getUrl());
timer=setInterval(lang.hitch(this,function(){
try{
if(typeof (xhr.statusText)){
}
}
catch(e){
clearInterval(timer);
}
}),250);
return xhr;
},_buildRequestBody:function(data,_23f6){
var EOL="\r\n";
var part="";
_23f6="--"+_23f6;
var _23f7=[],files=this._files,_23f8=this._getFileFieldName();
array.forEach(files,function(f,i){
var _23f9=f.fileName;
var _23fa;
try{
_23fa=f.getAsBinary()+EOL;
part+=_23f6+EOL;
part+="Content-Disposition: form-data; ";
part+="name=\""+_23f8+"\"; ";
part+="filename=\""+_23f9+"\""+EOL;
part+="Content-Type: "+this.getMimeType()+EOL+EOL;
part+=_23fa;
}
catch(e){
_23f7.push({index:i,name:_23f9});
}
},this);
if(_23f7.length){
if(_23f7.length>=files.length){
this.onError({message:this.errMsg,filesInError:_23f7});
part=false;
}
}
if(!part){
return false;
}
if(data){
for(var nm in data){
part+=_23f6+EOL;
part+="Content-Disposition: form-data; ";
part+="name=\""+nm+"\""+EOL+EOL;
part+=data[nm]+EOL;
}
}
part+=_23f6+"--"+EOL;
return part;
}});
dojox.form.addUploaderPlugin(_23f1);
return _23f1;
});
},"url:davinci/ui/templates/SwitchLayout.html":"<div>\n  <select dojoType=\"dijit.form.ComboBox\" dojoAttachPoint=\"combobox\">\n  \t<option>${langObj.abs}</option>\n  \t<option>${langObj.flow}</option>\n  </select>\n</div>\n","url:davinci/ui/templates/SelectProjectDialog.html":"<div>\r\n\t<div class=\"dijitDialogPaneContentArea\">\r\n\t\t<div>${uiNLS.currentProject} <span data-dojo-attach-point=\"currentProjectName\" style=\"font-weight: bold\"></span></div>\r\n\t\t<div style=\"margin-top: 10px;\">${uiNLS.selectProject}</div>\r\n\t\t<div data-dojo-type=\"davinci.ui.widgets.ProjectSelection\" data-dojo-attach-point=\"projectSelection\" data-dojo-attach-event=\"onChange:_onChange\"></div>\r\n\t</div>\t\r\n\t<div class=\"dijitDialogPaneActionBar\">\r\n\t\t<button dojoType='dijit.form.Button' dojoAttachPoint=\"_okButton\" dojoAttachEvent='onClick:okButton' label='${uiNLS.open}' class=\"maqPrimaryButton\" disabled=\"true\" type=\"submit\"></button>\r\n\t\t<button dojoType='dijit.form.Button' dojoAttachEvent='onClick:cancelButton' label='${uiNLS.cancelButtonLabel}' class=\"maqSecondaryButton\"></button>\r\n\t</div>\r\n</div>","davinci/review/actions/RestartVersionAction":function(){
define("davinci/review/actions/RestartVersionAction",["dojo/_base/declare","./_ReviewNavigatorCommon","davinci/review/actions/PublishAction","davinci/Runtime",],function(_23fb,_23fc,_23fd,_23fe){
var _23ff=_23fb("davinci.review.actions.RestartVersionAction",[_23fc],{run:function(_2400){
var _2401=this._getSelection(_2400);
if(!_2401||!_2401.length){
return;
}
var item=_2401[0].resource.elementType=="ReviewFile"?_2401[0].resource.parent:_2401[0].resource;
var _2402=new _23fd(item,true);
_2402.run();
},isEnabled:function(_2403){
var _2404=this._getSelection(_2403);
if(!_2404||_2404.length==0){
return false;
}
var item=_2404[0].resource.elementType=="ReviewFile"?_2404[0].resource.parent:_2404[0].resource;
if(item.designerId==davinci.Runtime.userName){
if(item.closed){
return true;
}
}
return false;
}});
return _23ff;
});
},"davinci/model/resource/File":function(){
define(["dojo/_base/declare","dojo/_base/xhr","davinci/Runtime","davinci/model/resource/Resource","davinci/model/resource/Marker","davinci/ve/utils/URLRewrite"],function(_2405,xhr,_2406,_2407,_2408,_2409){
return _2405("davinci.model.resource.File",_2407,{constructor:function(name,_240a){
this.elementType="File";
this.name=name;
this.parent=_240a;
this.markers=[];
this.extension=name.substr(name.lastIndexOf(".")+1);
},getExtension:function(){
return this.extension;
},clearMarkers:function(){
this.markers=[];
},addMarker:function(type,line,text){
this.markers.push(new _2408(this,type,line,text));
},getMarkers:function(_240b){
var _240c=[];
if(this.markers){
for(var i=0;i<this.markers.length;i++){
var _240d=this.markers[i];
if(!_240b){
_240c.push(_240d);
}else{
if(typeof _240b=="string"){
if(_240d.type==_240b){
_240c.push(_240d);
}
}else{
dojo.forEach(_240b,function(type){
if(type==_240d.type){
_240c.push(_240d);
}
});
}
}
}
}
return _240c;
},setContents:function(_240e,_240f){
var _2410=_240f?"true":"false";
var dirty=_240f?true:false;
if(this.isNew&&!_240f){
this.isNew=false;
}
var _2411=_240f?".workingcopy":"";
var path=encodeURI(this.getPath()+_2411);
return xhr.put({url:path,putData:_240e,handleAs:"text",contentType:"text/html"}).then(function(res){
this.dirtyResource=dirty;
dojo.publish("/davinci/resource/resourceChanged",["modified",this]);
}.bind(this),function(err){
console.error("An error occurred: davinci.model.resource.File.prototype.setContents "+err+" : "+path);
});
},getText:function(){
return this.getContentSync();
},getContentSync:function(){
return _2406.serverJSONRequest({url:_2409.encodeURI(this.getURL()),handleAs:"text",sync:true});
},getContent:function(){
return xhr.get({url:_2409.encodeURI(this.getURL()),handleAs:"text"});
},removeWorkingCopy:function(){
_2406.serverJSONRequest({url:"cmd/removeWorkingCopy",handleAs:"text",content:{path:this.getPath()},sync:true});
if(this.isNew){
this.deleteResource(true);
}
}});
});
},"davinci/html/ui/HTMLOutlineModel":function(){
define(["dojo/_base/declare"],function(_2412){
return _2412("davinci.html.ui.HTMLOutlineModel",null,{constructor:function(root){
this.root=root;
this.subscription=dojo.subscribe("/davinci/ui/modelChanged",this,this._modelChanged);
},getRoot:function(_2413,_2414){
_2413(this.root);
},getIdentity:function(item){
return item.getID();
},getLabel:function(item){
return item.getLabel().replace("<","&lt");
},_getChildren:function(item){
var _2415=[];
if(item.elementType=="HTMLFile"||item.elementType=="HTMLElement"){
dojo.forEach(item.children,function(child){
if(child.elementType=="HTMLElement"){
_2415.push(child);
}
});
}
return _2415;
},mayHaveChildren:function(item){
return (item.children.length>0);
},getChildren:function(item,_2416,_2417){
_2416(this._getChildren(item));
},_modelChanged:function(){
this.onChildrenChange(this.root,this._getChildren(this.root));
},destroy:function(){
dojo.unsubscribe(this.subscription);
}});
});
},"dijit/form/_ButtonMixin":function(){
define("dijit/form/_ButtonMixin",["dojo/_base/declare","dojo/dom","dojo/_base/event","../registry"],function(_2418,dom,event,_2419){
return _2418("dijit.form._ButtonMixin",null,{label:"",type:"button",_onClick:function(e){
if(this.disabled){
event.stop(e);
return false;
}
var _241a=this.onClick(e)===false;
if(!_241a&&this.type=="submit"&&!(this.valueNode||this.focusNode).form){
for(var node=this.domNode;node.parentNode;node=node.parentNode){
var _241b=_2419.byNode(node);
if(_241b&&typeof _241b._onSubmit=="function"){
_241b._onSubmit(e);
_241a=true;
break;
}
}
}
if(_241a){
e.preventDefault();
}
return !_241a;
},postCreate:function(){
this.inherited(arguments);
dom.setSelectable(this.focusNode,false);
},onClick:function(){
return true;
},_setLabelAttr:function(_241c){
this._set("label",_241c);
(this.containerNode||this.focusNode).innerHTML=_241c;
}});
});
},"url:dijit/form/templates/Button.html":"<span class=\"dijit dijitReset dijitInline\" role=\"presentation\"\n\t><span class=\"dijitReset dijitInline dijitButtonNode\"\n\t\tdata-dojo-attach-event=\"ondijitclick:_onClick\" role=\"presentation\"\n\t\t><span class=\"dijitReset dijitStretch dijitButtonContents\"\n\t\t\tdata-dojo-attach-point=\"titleNode,focusNode\"\n\t\t\trole=\"button\" aria-labelledby=\"${id}_label\"\n\t\t\t><span class=\"dijitReset dijitInline dijitIcon\" data-dojo-attach-point=\"iconNode\"></span\n\t\t\t><span class=\"dijitReset dijitToggleButtonIconChar\">&#x25CF;</span\n\t\t\t><span class=\"dijitReset dijitInline dijitButtonText\"\n\t\t\t\tid=\"${id}_label\"\n\t\t\t\tdata-dojo-attach-point=\"containerNode\"\n\t\t\t></span\n\t\t></span\n\t></span\n\t><input ${!nameAttrSetting} type=\"${type}\" value=\"${value}\" class=\"dijitOffScreen\"\n\t\ttabIndex=\"-1\" role=\"presentation\" data-dojo-attach-point=\"valueNode\"\n/></span>\n","davinci/ui/Resource":function(){
define("davinci/ui/Resource",["dojo/_base/declare","system/resource","../model/Path","../Runtime","../Workbench","../workbench/Preferences","../ve/RebuildPage","./Rename","./widgets/NewHTMLFileOptions","./widgets/OpenFile","./widgets/NewFolder","./widgets/NewFile","./widgets/AddFiles","./NewProject","dojox/form/uploader/FileList","dojox/form/Uploader","./Dialog","dojo/i18n!./nls/ui","dojo/i18n!dijit/nls/common","davinci/Theme","davinci/ve/commands/ChangeThemeCommand","dijit/form/Button","dojox/form/uploader/plugins/HTML5",],function(_241d,_241e,Path,_241f,_2420,_2421,_2422,_2423,_2424,_2425,_2426,_2427,_2428,_2429,_242a,_242b,_242c,uiNLS,_242d,Theme,_242e){
var _242f=function(_2430,_2431,type,_2432,_2433,_2434,_2435,_2436){
var _2437=_2435||_2438();
var _2439;
if(_2437){
if(_2437.elementType=="Folder"){
_2439=_2437;
}else{
_2439=_2437.parent;
}
}else{
var base=_2420.getProject();
var prefs=_2421.getPreferences("davinci.ui.ProjectPrefs",base);
if(prefs.webContentFolder!=null&&prefs.webContentFolder!=""){
var _243a=new Path(_2420.getProject()).append(prefs.webContentFolder);
_2439=_241e.findResource(_243a.toString());
}else{
_2439=_241e.findResource(_2420.getProject());
}
}
var _243b=_2434||_243c.getNewFileName("file",_2439,"."+type);
var _243d={newFileName:_243b,fileFieldLabel:_2430,folderFieldLabel:"Where:",finishButtonLabel:_2431,value:_2439,checkFileName:_243e,dialogSpecificClass:_2432,dialogSpecificClassOptions:_2433,optionalMessage:_2436};
return new _2427(_243d);
};
var _243e=function(_243f){
var _2440=_241e.findResource(_243f);
if(_2440){
alert("File already exists!");
}
return !_2440;
};
var _2438=function(){
return (_243c.getSelectedResources()||[])[0];
};
var _243c={newHTMLDialogSpecificClass:"davinci/ui/widgets/NewHTMLFileOptions",newHTMLMobile:function(){
this.newHTML({title:uiNLS.createMobileApplication,dialogSpecificClassOptions:{showDevices:true,showThemeSetsButton:true}});
},newHTMLDesktop:function(){
this.newHTML({title:uiNLS.createDesktopApplication,dialogSpecificClassOptions:{showDevices:false,showThemeSetsButton:true},device:"desktop"});
},newHTMLSketchHiFi:function(){
this.newHTML({title:uiNLS.createSketchHiFi,dialogSpecificClassOptions:{showDevices:false,showThemeSetsButton:true},layout:"absolute",theme:"claro"});
},newHTMLSketchLoFi:function(){
this.newHTML({title:uiNLS.createSketchLoFi,dialogSpecificClassOptions:{showDevices:false,showThemeSetsButton:false},layout:"absolute",theme:"Sketch"});
},newHTML:function(_2441){
var _2442=this.newHTMLDialogSpecificClass;
var _2443=_2441?_2441.dialogSpecificClassOptions:null;
var _2444=_242f(uiNLS.fileName,uiNLS.create,"html",_2442,_2443);
var _2445=function(){
var _2446,_2447;
if(_2444.dialogSpecificWidget){
_2446=_2444.dialogSpecificWidget;
_2447=_2446.getOptions();
}
var _2448=_2444.get("value");
var _2449=_241e.createResource(_2448);
_2449.isNew=true;
_2449.dirtyResource=true;
var text=_241e.createText("HTML",{resource:_2449});
if(text){
_2449.setText(text);
}
var _244a="none";
if(_2441&&_2441.dialogSpecificClassOptions&&_2441.dialogSpecificClassOptions.showDevices){
_244a=_2447?_2447.device:"none";
}
var _244b=(_2441&&_2441.layout)?_2441.layout:true;
_244b=_244b+"";
var theme=(_2441&&_2441.theme)?_2441.theme:null;
var _244c=null;
if(_2441&&_2441.dialogSpecificClassOptions&&_2441.dialogSpecificClassOptions.showThemeSetsButton){
theme=_2447?_2447.theme:null;
_244c=_2444.dialogSpecificWidget?_2444.dialogSpecificWidget._selectedThemeSet:null;
}
var _244d={device:_244a,flowlayout:_244b,theme:theme,themeSet:_244c};
_243c.openResource(_2449,_244d);
_2420.workbenchStateCustomPropSet("nhfo",_2447);
};
_2420.showModal(_2444,_2441.title,"",_2445,true);
},newCSS:function(){
var _244e=_242f(uiNLS.fileName,uiNLS.create,"css");
var _244f=function(){
var _2450=_244e.get("value");
var _2451=_241e.createResource(_2450);
_2451.isNew=true;
var text=_241e.createText("CSS",{resource:_2451});
if(text){
_2451.setText(text);
}
_243c.openResource(_2451);
};
_2420.showModal(_244e,uiNLS.createNewCSSFile,"",_244f,true);
},selectResource:function(_2452){
var _2453=dijit.byId("resourceTree");
var path=[];
for(var i=_2452;i.parent;i=i.parent){
path.unshift(i);
}
_2453.set("path",path);
},newFolder:function(_2454,_2455){
var _2456=_2454||_2438();
var _2457;
if(_2456){
if(_2456.elementType=="Folder"){
_2457=_2456;
}else{
_2457=_2456.parent;
}
}else{
var base=_2420.getProject();
var prefs=_2421.getPreferences("davinci.ui.ProjectPrefs",base);
if(prefs.webContentFolder!=null&&prefs.webContentFolder!=""){
var _2458=new Path(_2420.getProject()).append(prefs.webContentFolder);
_2457=_241e.findResource(_2458.toString());
}
if(!_2457){
_2457=_241e.findResource(_2420.getProject());
}
}
var _2459=_243c.getNewFileName("folder",_2457);
var _245a={newFileName:_2459,fileFieldLabel:uiNLS.folderName,folderFieldLabel:uiNLS.parentFolder,root:_2457,finishButtonLabel:uiNLS.createFolder,checkFileName:_243e};
var _245b=new _2426(_245a);
var _245c=false;
var _245d;
var _245e=function(){
var _245f=_245b.get("value");
_245d=_241e.createResource(_245f,true);
if(_2455){
_2455(_245d);
}
if(_245d!=null){
_243c.selectResource(_245d);
}
};
_2420.showModal(_245b,uiNLS.createNewFolder,"",_245e,true);
},closeEditor:function(_2460,flush){
var _2461=_2420.getOpenEditor(_2460);
if(_2461!=null){
if(flush){
_2461.save();
}
_2461.editorContainer.forceClose(_2461);
}
return _2461!=null;
},save:function(){
var _2462=_2420.getOpenEditor();
if(_2462){
system.resource.findResourceAsync(_2462.fileName).then(dojo.hitch(this,function(_2463){
if(_2463.readOnly()){
this.saveAs(_2463.getExtension(),uiNLS.savingReadonlyFile);
}else{
_2462.save();
}
}));
}
},saveAs:function(_2464,_2465){
var _2466=_2420.getOpenEditor();
var _2467=_2466.fileName;
var _2468=new Path(_2467).lastSegment();
var _2469=_241e.findResource(_2467);
var _246a=_242f(uiNLS.fileName,uiNLS.save,_2464,null,null,_2468,_2469,_2465);
var _246b=function(){
var _246c=_246a.get("value");
var _246d=_241e.findResource(_2467);
var _246e;
var _246f;
var theme;
if(_2466.editorID=="davinci.html.CSSEditor"){
_246e=_2466.getText();
}else{
_246e=(_2466.model&&_2466.model.getText)?_2466.model.getText():_2466.getText();
}
if(_2466.editorID=="davinci.ve.HTMLPageEditor"){
_246f=Theme.getThemeSet(_2466.visualEditor.context);
theme=_2466.visualEditor.context.theme;
}
var _2470=_241e.findResource(_246c);
_2466.editorContainer.forceClose(_2466);
if(_2470){
_2470.removeWorkingCopy();
_2470.deleteResource();
}
_2466.isDirty=false;
var file=_241e.createResource(_246c);
new _2422().rebuildSource(_246e,file,theme,_246f).then(function(_2471){
file.setContents(_2471);
_2420.openEditor({fileName:file,content:_2471});
});
};
_2420.showModal(_246a,uiNLS.saveFileAs,"",_246b);
},newJS:function(){
var _2472=_242f(uiNLS.fileName,uiNLS.create,"js");
var _2473=function(){
var _2474=_2472.get("value");
var _2475=_241e.createResource(_2474);
_2475.isNew=true;
var text=_241e.createText("CSS",{resource:_2475});
if(text){
_2475.setText(text);
}
_243c.openResource(_2475);
};
_2420.showModal(_2472,uiNLS.createNewJSFile,"",_2473);
},openFile:function(){
var _2476,_2477=_2438();
if(_2477){
if(_2477.elementType=="Folder"){
_2476=_2477;
}else{
_2476=_2477.parent;
}
}else{
_2476=_241e.findResource(_2420.getProject());
}
var _2478={finishButtonLabel:uiNLS.open};
var _2479=new _2425(_2478);
var _247a=function(){
_243c.openResource(_2479.get("value"));
};
_2420.showModal(_2479,uiNLS.openFile,{width:350,height:250},_247a,true);
},addFiles:function(){
var _247b=new _2428({selectedResource:_2438()});
_2420.showModal(_247b,uiNLS.addFiles,{width:350},null);
},getNewFileName:function(_247c,_247d,_247e){
var _247f,_2480;
var count=0;
if(!_247e){
_247e="";
}
do{
count++;
if(_247c==="folder"){
_2480="folder"+count;
}else{
_2480="file"+count+_247e;
}
var _2481=_247d.getPath()+"/"+_2480;
_247f=_241e.findResource(_2481);
}while(_247f);
return _2480;
},canModify:function(item){
return !item.readOnly();
},newProject:function(){
var _2482=new _2429({});
_2420.showModal(_2482,uiNLS.newProject,"",null,true);
},renameAction:function(){
var _2483=_243c.getSelectedResources();
if(_2483.length!=1){
return;
}
var _2484=_2483[0];
_2484.parent.getChildren(function(_2485){
var _2486=_2485.map(function(child){
return child.name;
});
var _2487=new _2423({value:_2484.name,invalid:_2486});
_2420.showModal(_2487,uiNLS.renameDialogTitle,"",function(){
var _2488=_2487.attr("cancel");
var _2489=_2487.attr("value");
if(!_2488){
var _248a=_243c.closeEditor(_2484,true);
_2484.rename(_2489).then(function(){
if(_248a){
_243c.openResource(_2484);
}
});
}
return true;
},true);
},true);
},getResourceIcon:function(item,_248b){
var _248c=item.readOnly();
if(item.elementType=="Folder"){
if(_248c){
return _248b?"dijitFolderOpened maqettaReadonlyFolderOpened":"dijitFolderClosed maqettaReadonlyFolderClosed";
}else{
return _248b?"dijitFolderOpened":"dijitFolderClosed";
}
}
if(item.elementType=="File"){
var icon;
fileType=item.getExtension();
extension=_241f.getExtension("davinci.fileType",function(_248d){
return _248d.extension==fileType;
});
if(extension){
icon=extension.iconClass;
if(_248c){
icon+="ReadOnly";
}
}
if(!icon){
icon="dijitLeaf";
if(_248c){
icon+=" maqettaReadonlyFile";
}
}
return icon;
}
return this.prototype.getIconClass(item,_248b);
},getResourceClass:function(item){
if(item.readOnly()){
return "readOnlyResource";
}
},deleteAction:function(){
var _248e=_243c.getSelectedResources(),paths=_248e.map(function(_248f){
return _248f.getPath();
}).join("\n\t");
if(!confirm(dojo.string.substitute(uiNLS.areYouSureDelete,[paths]))){
return;
}
_248e.forEach(function(_2490){
_243c.closeEditor(_2490);
_2490.deleteResource();
});
},getSelectedResources:function(){
var _2491=_241f.getSelection();
if(_2491[0]&&_2491[0].resource){
return dojo.map(_2491,function(item){
return item.resource;
});
}
},alphabeticalSortFilter:{filterList:function(list){
return list.sort(function(file1,file2){
return file1.name>file2.name?1:file1.name<file2.name?-1:0;
});
}},foldersFilter:{filterItem:function(item){
if(item.elementType=="File"){
return true;
}
}},openPath:function(path,text){
var _2492={fileName:path};
if(text){
_2492.text=text;
}
_2420.openEditor(_2492);
},openResource:function(_2493,_2494){
if(_2493.elementType=="File"){
_2493.getContent().then(function(_2495){
_2420.openEditor({fileName:_2493,content:_2495},_2494);
});
}
}};
return dojo.setObject("davinci.ui.Resource",_243c);
});
},"dojox/form/uploader/Base":function(){
define("dojox/form/uploader/Base",["dojo/dom-form","dojo/dom-style","dojo/dom-construct","dojo/dom-attr","dojo/has","dojo/_base/declare","dojo/_base/event","dijit/_Widget","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin"],function(_2496,_2497,_2498,_2499,has,_249a,event,_249b,_249c,_249d){
has.add("FormData",function(){
return !!window.FormData;
});
has.add("xhr-sendAsBinary",function(){
var xhr=window.XMLHttpRequest&&new window.XMLHttpRequest();
return xhr&&!!xhr.sendAsBinary;
});
has.add("file-multiple",function(){
return !!({"true":1,"false":1}[_2499.get(document.createElement("input",{type:"file"}),"multiple")]);
});
return _249a("dojox.form.uploader.Base",[_249b,_249c,_249d],{getForm:function(){
if(!this.form){
var n=this.domNode;
while(n&&n.tagName&&n!==document.body){
if(n.tagName.toLowerCase()=="form"){
this.form=n;
break;
}
n=n.parentNode;
}
}
return this.form;
},getUrl:function(){
if(this.uploadUrl){
this.url=this.uploadUrl;
}
if(this.url){
return this.url;
}
if(this.getForm()){
this.url=this.form.action;
}
return this.url;
},connectForm:function(){
this.url=this.getUrl();
if(!this._fcon&&!!this.getForm()){
this._fcon=true;
this.connect(this.form,"onsubmit",function(evt){
event.stop(evt);
this.submit(this.form);
});
}
},supports:function(what){
switch(what){
case "multiple":
if(this.force=="flash"||this.force=="iframe"){
return false;
}
return has("file-multiple");
case "FormData":
return has(what);
case "sendAsBinary":
return has("xhr-sendAsBinary");
}
return false;
},getMimeType:function(){
return "application/octet-stream";
},getFileType:function(name){
return name.substring(name.lastIndexOf(".")+1).toUpperCase();
},convertBytes:function(bytes){
var kb=Math.round(bytes/1024*100000)/100000;
var mb=Math.round(bytes/1048576*100000)/100000;
var gb=Math.round(bytes/1073741824*100000)/100000;
var value=bytes;
if(kb>1){
value=kb.toFixed(1)+" kb";
}
if(mb>1){
value=mb.toFixed(1)+" mb";
}
if(gb>1){
value=gb.toFixed(1)+" gb";
}
return {kb:kb,mb:mb,gb:gb,bytes:bytes,value:value};
}});
});
},"davinci/actions/Action":function(){
define("davinci/actions/Action",["dojo/_base/declare"],function(_249e){
return _249e("davinci.actions.Action",null,{item:null,run:function(_249f){
},isEnabled:function(_24a0){
return true;
},getName:function(){
return this.item.label;
}});
});
},"dojo/dnd/TimedMoveable":function(){
define("dojo/dnd/TimedMoveable",["../_base/declare","./Moveable"],function(_24a1,_24a2){
var _24a3=_24a2.prototype.onMove;
return _24a1("dojo.dnd.TimedMoveable",_24a2,{timeout:40,constructor:function(node,_24a4){
if(!_24a4){
_24a4={};
}
if(_24a4.timeout&&typeof _24a4.timeout=="number"&&_24a4.timeout>=0){
this.timeout=_24a4.timeout;
}
},onMoveStop:function(mover){
if(mover._timer){
clearTimeout(mover._timer);
_24a3.call(this,mover,mover._leftTop);
}
_24a2.prototype.onMoveStop.apply(this,arguments);
},onMove:function(mover,_24a5){
mover._leftTop=_24a5;
if(!mover._timer){
var _24a6=this;
mover._timer=setTimeout(function(){
mover._timer=null;
_24a3.call(_24a6,mover,mover._leftTop);
},this.timeout);
}
}});
});
},"dojox/widget/Toaster":function(){
define("dojox/widget/Toaster",["dojo/_base/declare","dojo/_base/lang","dojo/_base/connect","dojo/_base/fx","dojo/dom-style","dojo/dom-class","dojo/dom-geometry","dijit/registry","dijit/_WidgetBase","dijit/_TemplatedMixin","dijit/BackgroundIframe","dojo/fx","dojo/has","dojo/_base/window","dojo/window"],function(_24a7,lang,_24a8,_24a9,_24aa,_24ab,_24ac,_24ad,_24ae,_24af,_24b0,_24b1,has,_24b2,_24b3){
lang.getObject("dojox.widget",true);
var _24b4=function(w){
return w.substring(0,1).toUpperCase()+w.substring(1);
};
return _24a7("dojox.widget.Toaster",[_24ae,_24af],{templateString:"<div class=\"dijitToasterClip\" dojoAttachPoint=\"clipNode\"><div class=\"dijitToasterContainer\" dojoAttachPoint=\"containerNode\" dojoAttachEvent=\"onclick:onSelect\"><div class=\"dijitToasterContent\" dojoAttachPoint=\"contentNode\"></div></div></div>",messageTopic:"",messageTypes:{MESSAGE:"message",WARNING:"warning",ERROR:"error",FATAL:"fatal"},defaultType:"message",positionDirection:"br-up",positionDirectionTypes:["br-up","br-left","bl-up","bl-right","tr-down","tr-left","tl-down","tl-right"],duration:2000,slideDuration:500,separator:"<hr></hr>",postCreate:function(){
this.inherited(arguments);
this.hide();
_24b2.body().appendChild(this.domNode);
if(this.messageTopic){
_24a8.subscribe(this.messageTopic,this,"_handleMessage");
}
},_handleMessage:function(_24b5){
if(lang.isString(_24b5)){
this.setContent(_24b5);
}else{
this.setContent(_24b5.message,_24b5.type,_24b5.duration);
}
},setContent:function(_24b6,_24b7,_24b8){
_24b8=_24b8||this.duration;
if(this.slideAnim){
if(this.slideAnim.status()!="playing"){
this.slideAnim.stop();
}
if(this.slideAnim.status()=="playing"||(this.fadeAnim&&this.fadeAnim.status()=="playing")){
setTimeout(lang.hitch(this,function(){
this.setContent(_24b6,_24b7,_24b8);
}),50);
return;
}
}
for(var type in this.messageTypes){
_24ab.remove(this.containerNode,"dijitToaster"+_24b4(this.messageTypes[type]));
}
_24aa.set(this.containerNode,"opacity",1);
this._setContent(_24b6);
_24ab.add(this.containerNode,"dijitToaster"+_24b4(_24b7||this.defaultType));
this.show();
var _24b9=_24ac.getMarginBox(this.containerNode);
this._cancelHideTimer();
if(this.isVisible){
this._placeClip();
if(!this._stickyMessage){
this._setHideTimer(_24b8);
}
}else{
var style=this.containerNode.style;
var pd=this.positionDirection;
if(pd.indexOf("-up")>=0){
style.left=0+"px";
style.top=_24b9.h+10+"px";
}else{
if(pd.indexOf("-left")>=0){
style.left=_24b9.w+10+"px";
style.top=0+"px";
}else{
if(pd.indexOf("-right")>=0){
style.left=0-_24b9.w-10+"px";
style.top=0+"px";
}else{
if(pd.indexOf("-down")>=0){
style.left=0+"px";
style.top=0-_24b9.h-10+"px";
}else{
throw new Error(this.id+".positionDirection is invalid: "+pd);
}
}
}
}
this.slideAnim=_24b1.slideTo({node:this.containerNode,top:0,left:0,duration:this.slideDuration});
this.connect(this.slideAnim,"onEnd",function(nodes,anim){
this.fadeAnim=_24a9.fadeOut({node:this.containerNode,duration:1000});
this.connect(this.fadeAnim,"onEnd",function(evt){
this.isVisible=false;
this.hide();
});
this._setHideTimer(_24b8);
this.connect(this,"onSelect",function(evt){
this._cancelHideTimer();
this._stickyMessage=false;
this.fadeAnim.play();
});
this.isVisible=true;
});
this.slideAnim.play();
}
},_setContent:function(_24ba){
if(lang.isFunction(_24ba)){
_24ba(this);
return;
}
if(_24ba&&this.isVisible){
_24ba=this.contentNode.innerHTML+this.separator+_24ba;
}
this.contentNode.innerHTML=_24ba;
},_cancelHideTimer:function(){
if(this._hideTimer){
clearTimeout(this._hideTimer);
this._hideTimer=null;
}
},_setHideTimer:function(_24bb){
this._cancelHideTimer();
if(_24bb>0){
this._cancelHideTimer();
this._hideTimer=setTimeout(lang.hitch(this,function(evt){
if(this.bgIframe&&this.bgIframe.iframe){
this.bgIframe.iframe.style.display="none";
}
this._hideTimer=null;
this._stickyMessage=false;
this.fadeAnim.play();
}),_24bb);
}else{
this._stickyMessage=true;
}
},_placeClip:function(){
var view=_24b3.getBox();
var _24bc=_24ac.getMarginBox(this.containerNode);
var style=this.clipNode.style;
style.height=_24bc.h+"px";
style.width=_24bc.w+"px";
var pd=this.positionDirection;
if(pd.match(/^t/)){
style.top=view.t+"px";
}else{
if(pd.match(/^b/)){
style.top=(view.h-_24bc.h-2+view.t)+"px";
}
}
if(pd.match(/^[tb]r-/)){
style.left=(view.w-_24bc.w-1-view.l)+"px";
}else{
if(pd.match(/^[tb]l-/)){
style.left=0+"px";
}
}
style.clip="rect(0px, "+_24bc.w+"px, "+_24bc.h+"px, 0px)";
if(has("ie")){
if(!this.bgIframe){
this.clipNode.id=_24ad.getUniqueId("dojox_widget_Toaster_clipNode");
this.bgIframe=new _24b0(this.clipNode);
}
var _24bd=this.bgIframe.iframe;
if(_24bd){
_24bd.style.display="block";
}
}
},onSelect:function(e){
},show:function(){
_24aa.set(this.domNode,"display","block");
this._placeClip();
if(!this._scrollConnected){
this._scrollConnected=_24a8.connect(_24b3,"onscroll",this,this._placeClip);
}
},hide:function(){
_24aa.set(this.domNode,"display","none");
if(this._scrollConnected){
_24a8.disconnect(this._scrollConnected);
this._scrollConnected=false;
}
_24aa.set(this.containerNode,"opacity",1);
}});
});
},"davinci/ve/themeEditor/themeEditor.plugin":function(){
define(["require"],function(_24be){
return {id:"davinci.themeEdit","davinci.perspective":{id:"themeEdit",title:"Theme Editor",views:[{viewID:"davinci.ve.Palette",position:"left",hidden:true},{viewID:"davinci.ui.outline",position:"left",hidden:true},{viewID:"davinci.ve.style",position:"right"},{viewID:"davinci.ui.comment",position:"right",hidden:true},{viewID:"davinci.ve.states",position:"right-bottom",selected:true},{viewID:"davinci.ui.navigator",position:"left-bottom",selected:true},{viewID:"davinci.review.reviewNavigator",position:"left"}]},"davinci.editor":{id:"ThemeEditor",name:"Theme Editor",extensions:"theme",defaultContent:"./defaultContent.css",isDefault:true,editorClass:"davinci/ve/themeEditor/ThemeEditor",palettePerspective:"davinci.themeEdit.themeEdit",expandPalettes:["right"]},"davinci.editorActions":{editorContribution:{targetID:"davinci.ve.ThemeEditor",actions:[{id:"undo",action:"davinci/actions/UndoAction",label:"Undo",className:"maqLabelButton",showLabel:true,toolbarPath:"undoredo",keyBinding:{accel:true,charOrCode:"z"}},{id:"redo",action:"davinci/actions/RedoAction",className:"maqLabelButton",showLabel:true,label:"Redo",toolbarPath:"undoredo",keyBinding:{accel:true,shift:true,charOrCode:"z"}},{id:"save",className:"maqLabelButton",showLabel:true,label:"Save",toolbarPath:"save",run:function(){
_24be("../../Workbench").getOpenEditor().save();
},isEnabled:function(_24bf){
return _24be("../../Workbench").getOpenEditor();
}}]}}};
});
},"url:davinci/ui/widgets/templates/ThemeSetSelection.html":"<div>\n  <div class=\"dijitDialogPaneContentArea\">\n\t\t<table style=\"width: 100%; padding-left:10px; padding-right:10px;\">\n\t\t\t<tr>\n\t\t\t\t<td style=\"\" NOWRAP>${uiNLS.themeSet}</td>\n\t\t\t\t<td style=\"width: 100%; text-align: center;\"><select dojoType=\"dijit.form.Select\" id=\"theme_select_themeset_theme_select\" type=\"text\" style=\"width: 175px;\" ></select></td>\n\t\t\t</tr>\n\t\t</table>\n\t\n\t\t<div style=\"border-top: 1px solid black; top: 231px; border-top-color: #ccc; left: 429px; width: 300px; height: 11px; margin-top: 6px; padding-left:10px;\"></div>\n\t\t<table style=\"padding-left: 15px; width: 100%;\">\n\t\t\t<tr><td style=\"width: 139px;\">${uiNLS.desktopTheme}</td><td><select dojoType=\"dijit.form.Select\" id=\"theme_select_desktop_theme_select\"type=\"text\"  style=\"width: 175px;\"  ></select></td></tr>\n\t\t\t<tr><td>${uiNLS.mobileTheme}</td><td><select dojoType=\"dijit.form.Select\" id=\"theme_select_mobile_theme_select\"type=\"text\"  style=\"width: 175px;\" ></select></td></tr>\n\t\t</table>\n\t\t<table id=\"theme_select_devices_table\" style=\"padding-left:30px; border-collapse: separate; border-spacing: 0 0; width: 100%\">\n\t\t\t<tr><td style=\"width: 139px;\">${uiNLS.android}</td><td><select dojoType=\"dijit.form.Select\" id=\"theme_select_android_select\" type=\"text\"  style=\"width: 150px;\"></select></td></tr>\n\t\t\t<tr><td>${uiNLS.blackberry}</td><td><select dojoType=\"dijit.form.Select\" id=\"theme_select_blackberry_select\" type=\"text\"  style=\"width: 150px;\"></select></td></tr>\n\t\t\t<tr><td>${uiNLS.ipad}</td><td><select dojoType=\"dijit.form.Select\" id=\"theme_select_ipad_select\" type=\"text\"  style=\"width: 150px;\"></select></td></tr>\n\t\t\t<tr><td>${uiNLS.iphone}</td><td><select dojoType=\"dijit.form.Select\" id=\"theme_select_iphone_select\" type=\"text\"  style=\"width: 150px;\"></select></td></tr>\n\t\t\t<tr><td>${uiNLS.other}</td><td><select dojoType=\"dijit.form.Select\" id=\"theme_select_other_select\" type=\"text\"  style=\"width: 150px;\"></select></td></tr>\n\t\t</table>\n\t</div>\n\n\t<div class=\"dijitDialogPaneActionBar\">\n\t\t<button dojoType=\"dijit.form.Button\" id=\"theme_select_ok_button\" label=\"${uiNLS.select}\" class=\"maqPrimaryButton\" type=\"submit\"></button>\n\t\t<button dojoType=\"dijit.form.Button\" id=\"theme_select_cancel_button\" label=\"${commonNLS.buttonCancel}\" class=\"maqSecondaryButton\"></button>\n\t</div>\n</div>\n","dojo/dnd/Manager":function(){
define("dojo/dnd/Manager",["../_base/array","../_base/declare","../_base/event","../_base/lang","../_base/window","../dom-class","../Evented","../has","../keys","../on","../topic","../touch","./common","./autoscroll","./Avatar"],function(array,_24c0,event,lang,win,_24c1,_24c2,has,keys,on,topic,touch,dnd,_24c3,_24c4){
var _24c5=_24c0("dojo.dnd.Manager",[_24c2],{constructor:function(){
this.avatar=null;
this.source=null;
this.nodes=[];
this.copy=true;
this.target=null;
this.canDropFlag=false;
this.events=[];
},OFFSET_X:has("touch")?0:16,OFFSET_Y:has("touch")?-64:16,overSource:function(_24c6){
if(this.avatar){
this.target=(_24c6&&_24c6.targetState!="Disabled")?_24c6:null;
this.canDropFlag=Boolean(this.target);
this.avatar.update();
}
topic.publish("/dnd/source/over",_24c6);
},outSource:function(_24c7){
if(this.avatar){
if(this.target==_24c7){
this.target=null;
this.canDropFlag=false;
this.avatar.update();
topic.publish("/dnd/source/over",null);
}
}else{
topic.publish("/dnd/source/over",null);
}
},startDrag:function(_24c8,nodes,copy){
_24c3.autoScrollStart(win.doc);
this.source=_24c8;
this.nodes=nodes;
this.copy=Boolean(copy);
this.avatar=this.makeAvatar();
win.body().appendChild(this.avatar.node);
topic.publish("/dnd/start",_24c8,nodes,this.copy);
this.events=[on(win.doc,touch.move,lang.hitch(this,"onMouseMove")),on(win.doc,touch.release,lang.hitch(this,"onMouseUp")),on(win.doc,"keydown",lang.hitch(this,"onKeyDown")),on(win.doc,"keyup",lang.hitch(this,"onKeyUp")),on(win.doc,"dragstart",event.stop),on(win.body(),"selectstart",event.stop)];
var c="dojoDnd"+(copy?"Copy":"Move");
_24c1.add(win.body(),c);
},canDrop:function(flag){
var _24c9=Boolean(this.target&&flag);
if(this.canDropFlag!=_24c9){
this.canDropFlag=_24c9;
this.avatar.update();
}
},stopDrag:function(){
_24c1.remove(win.body(),["dojoDndCopy","dojoDndMove"]);
array.forEach(this.events,function(_24ca){
_24ca.remove();
});
this.events=[];
this.avatar.destroy();
this.avatar=null;
this.source=this.target=null;
this.nodes=[];
},makeAvatar:function(){
return new _24c4(this);
},updateAvatar:function(){
this.avatar.update();
},onMouseMove:function(e){
var a=this.avatar;
if(a){
_24c3.autoScrollNodes(e);
var s=a.node.style;
s.left=(e.pageX+this.OFFSET_X)+"px";
s.top=(e.pageY+this.OFFSET_Y)+"px";
var copy=Boolean(this.source.copyState(dnd.getCopyKeyState(e)));
if(this.copy!=copy){
this._setCopyStatus(copy);
}
}
if(has("touch")){
e.preventDefault();
}
},onMouseUp:function(e){
if(this.avatar){
if(this.target&&this.canDropFlag){
var copy=Boolean(this.source.copyState(dnd.getCopyKeyState(e)));
topic.publish("/dnd/drop/before",this.source,this.nodes,copy,this.target,e);
topic.publish("/dnd/drop",this.source,this.nodes,copy,this.target,e);
}else{
topic.publish("/dnd/cancel");
}
this.stopDrag();
}
},onKeyDown:function(e){
if(this.avatar){
switch(e.keyCode){
case keys.CTRL:
var copy=Boolean(this.source.copyState(true));
if(this.copy!=copy){
this._setCopyStatus(copy);
}
break;
case keys.ESCAPE:
topic.publish("/dnd/cancel");
this.stopDrag();
break;
}
}
},onKeyUp:function(e){
if(this.avatar&&e.keyCode==keys.CTRL){
var copy=Boolean(this.source.copyState(false));
if(this.copy!=copy){
this._setCopyStatus(copy);
}
}
},_setCopyStatus:function(copy){
this.copy=copy;
this.source._markDndStatus(this.copy);
this.updateAvatar();
_24c1.replace(win.body(),"dojoDnd"+(this.copy?"Copy":"Move"),"dojoDnd"+(this.copy?"Move":"Copy"));
}});
dnd._manager=null;
_24c5.manager=dnd.manager=function(){
if(!dnd._manager){
dnd._manager=new _24c5();
}
return dnd._manager;
};
return _24c5;
});
},"davinci/html/ui/CSSOutline":function(){
define("davinci/html/ui/CSSOutline",["dojo/_base/declare","davinci/html/ui/CSSOutlineModel"],function(_24cb,_24cc){
return _24cb("davinci.html.ui.CSSOutline",null,{constructor:function(model){
this._cssModel=model;
},getModel:function(){
this._model=new _24cc(this._cssModel);
return this._model;
}});
});
},"url:dijit/templates/Tooltip.html":"<div class=\"dijitTooltip dijitTooltipLeft\" id=\"dojoTooltip\"\n\t><div class=\"dijitTooltipContainer dijitTooltipContents\" data-dojo-attach-point=\"containerNode\" role='alert'></div\n\t><div class=\"dijitTooltipConnector\" data-dojo-attach-point=\"connectorNode\"></div\n></div>\n","davinci/ve/widget":function(){
define(["davinci/html/HTMLElement","davinci/ve/metadata","dojo/Deferred","davinci/ve/DijitWidget","davinci/ve/GenericWidget","davinci/ve/HTMLWidget","davinci/ve/ObjectWidget","dojo/window"],function(_24cd,_24ce,_24cf){
var _24d0={};
var _24d1=function(_24d2,node,_24d3){
for(var i=0;i<_24d3.children.length;i++){
var _24d4=node.childNodes[i];
var _24d5=_24d3.children[i];
if((_24d4&&_24d4.nodeType==1)&&_24d5.elementType=="HTMLElement"){
_24d4.id=_24d2.getUniqueID(_24d5);
_24d1(_24d2,_24d4,_24d5);
}
}
};
var _24d6=function(node,_24d7){
if(!node){
return undefined;
}
_24d7=_24d7||{};
var data={};
data.properties={};
for(var i=0;i<node.attributes.length;i++){
var a=node.attributes[i];
if(!a.specified||!a.nodeValue){
continue;
}
var n=a.nodeName.toLowerCase();
if(n=="id"||n=="widgetid"||n=="style"){
continue;
}else{
if(n.charAt(0)=="_"){
continue;
}
}
var v=a.nodeValue;
if(v&&n=="class"){
v=v.replace("HtmlWidget","").trim();
if(!v){
continue;
}
}
data.properties[n]=v;
}
if(node.tagName.toLowerCase()=="script"){
data.children=(node.innerHTML||undefined);
}
return data;
};
var _24d8={_dojo:function(node){
var doc=node?(node.ownerDocument||node):dojo.doc;
doc=doc||dojo.doc;
var win=dojo.window.get(doc);
return win.dojo||dojo;
},_dijit:function(node){
var doc=node?(node.ownerDocument||node):dojo.doc;
var win=dojo.window.get(doc);
return win.dijit||dijit;
},parseStyleValues:function(text){
var _24d9=[];
if(text){
dojo.forEach(text.split(";"),function(s){
var i=s.indexOf(":");
if(i>0){
var n=s.substring(0,i).trim();
var v=s.substring(i+1).trim();
var o={};
o[n]=v;
_24d9.push(o);
}
});
}
return _24d9;
},retrieveStyleProperty:function(_24da,_24db,_24dc){
var _24dd=_24dc;
if(_24da){
dojo.some(_24da,function(o){
if(o.hasOwnProperty(_24db)){
_24dd=o[_24db];
return true;
}
});
}
return _24dd;
},setStyleProperty:function(_24de,_24df,value){
var _24e0=false;
if(_24de){
dojo.some(_24de,function(o){
if(o.hasOwnProperty(_24df)){
o[_24df]=value;
_24e0=true;
return true;
}
});
}
if(!_24e0){
var o={};
o[_24df]=value;
_24de.push(o);
}
},getStyleString:function(_24e1){
var _24e2="";
dojo.forEach(_24e1,function(style){
for(var p in style){
if(style[p]){
_24e2=_24e2+p+":"+style[p]+";";
}
}
});
return _24e2;
},getEnclosingWidget:function(node){
var _24e3=_24d8.getEnclosingWidgetForRichText(node);
if(_24e3){
return _24e3;
}
var enc=node;
while(enc){
if(enc._dvWidget){
return enc._dvWidget;
}
enc=enc.parentNode||(enc.domNode&&enc.domNode.parentNode);
}
},getEnclosingWidgetForRichText:function(node){
if(!node||!node._dvWidget){
return;
}
if(node._dvWidget.type==="html.stickynote"||node._dvWidget.type==="html.richtext"){
return node._dvWidget;
}else{
if(node.parentNode){
return _24d8.getEnclosingWidgetForRichText(node.parentNode);
}else{
return null;
}
}
},getUniqueObjectId:function(type,node){
if(!type){
return undefined;
}
var base=type.substring(type.lastIndexOf(".")+1);
var i=1;
var id=base+"_"+i++;
var dj=_24d8._dojo(node);
while(dj.getObject(id)||dj.byId(id)){
id=base+"_"+i++;
}
return id;
},_remove_prefix:function(str){
var _24e4=str;
var _24e5=["dijit.form.","dijit.layout.","dijit.","dojox.mobile.","html.","OpenAjax."];
for(var i=0;i<_24e5.length;i++){
if(str.indexOf(_24e5[i])==0){
_24e4=str.substr(_24e5[i].length);
if(_24e5[i]=="html."){
_24e4="&lt;"+_24e4+"&gt;";
}
break;
}
}
return _24e4;
},_getWidgetNameText:function(type){
var text="<span class='propertiesTitleWidgetName'>";
text+=this._remove_prefix(type);
text+="</span> ";
return text;
},_getWidgetClassText:function(id,_24e6){
var text="<span class='propertiesTitleClassName'>";
if(id){
text+="#"+id;
}
if(_24e6){
text+="."+_24e6.replace(/\s+/g,".");
}
text+="</span> ";
return text;
},getLabelForNode:function(node){
var type=node.getAttribute("data-dojo-type")||node.getAttribute("dojoType");
if(!type){
type=node.tagName.toLowerCase();
}
var text=this._getWidgetNameText(type);
if(node.id){
text+=this._getWidgetClassText(node.id);
}
return text;
},getLabel:function(_24e7){
var text=this._getWidgetNameText(_24e7.type);
var _24e8,_24e9=_24d8.getWidgetHelper(_24e7.type);
if(_24e9&&_24e9.getWidgetText){
_24e8=_24e9.getWidgetText(_24e7);
}
var _24ea=_24e7.domNode;
switch(_24e7.type){
case "dijit.form.ComboBox":
case "dijit.form.Button":
_24e8=_24e7.attr("label");
break;
case "dijit.layout.ContentPane":
_24e8=_24e7.attr("title");
break;
case "html.label":
_24e8=_24ea.innerHTML;
break;
case "html.img":
_24e8=_24ea.alt;
if(!_24e8){
_24e8=_24ea.title;
}
}
if(_24e8){
text+="<span class='propertiesTitleWidgetText'>"+_24e8+"</span> ";
}
if(_24e9&&_24e9.getWidgetDescriptor){
text+=" <span class='propertiesTitleWidgetDescriptor'>"+_24e9.getWidgetDescriptor(_24e7)+"</span> ";
}
var _24eb=_24e7._srcElement;
var id=_24e7.getId();
var _24ec=_24eb&&_24eb.getAttribute("class");
var _24ed=_24ec&&_24ec.trim();
if(id||_24ed){
text+=this._getWidgetClassText(id,_24ed);
}
if(_24e9&&_24e9.getWidgetTextExtra){
text+=_24e9.getWidgetTextExtra(_24e7);
}
if(_24e7.type=="html.img"){
text+="<span>"+_24ea.src.substr(_24ea.src.lastIndexOf("/")+1)+"</span>";
}
return text;
},byId:function(id,doc){
var node=dojo.byId(id,doc&&doc.body?doc:undefined);
if(node){
if(node._dvWidget){
return node._dvWidget;
}
var _24ee=_24d8.getEnclosingWidget(node);
if(_24ee.id==id){
return _24ee;
}
}
if(davinci.Runtime.currentEditor&&davinci.Runtime.currentEditor.currentEditor&&davinci.Runtime.currentEditor.currentEditor.context){
var _24ef=davinci.Runtime.currentEditor.currentEditor.context;
return _24ef.widgetHash[id];
}
return undefined;
},byNode:function(node){
if(node._dvWidget){
return node._dvWidget;
}
},createWidget:function(_24f0){
if(!_24f0||!_24f0.type){
return undefined;
}
var data=dojo.mixin({},_24f0);
if(data.properties){
data.properties=dojo.mixin({},_24f0.properties);
}
var type=data.type,c,theme,_24f1,md=_24ce.query(type);
if(!md){
return undefined;
}
if(data.properties){
if("content" in data.properties&&!data.properties.content){
delete data.properties.content;
}
if(data.properties.theme){
theme=data.properties.theme.themeName;
}
}
var _24f2=_24ce.queryDescriptor(type,"widgetClass");
var _24f3;
if(_24f2=="object"){
_24f1=type;
_24f3="davinci.ve.ObjectWidget";
md.attributes=md.attributes||{};
md.attributes.dojoType=_24f1;
}else{
if(_24f2=="html"){
_24f3="davinci.ve.HTMLWidget";
}else{
if(_24f2=="dijit"){
_24f3="davinci.ve.DijitWidget";
}else{
_24f3="davinci.ve.GenericWidget";
}
}
}
if(!_24f3){
return undefined;
}
c=dojo.getObject(_24f3);
var _24f4=md.content.trim().replace(/\s+/g," ");
var node=dojo.window.get(dojo.doc).dojo._toDom(_24f4);
if(node.nodeType===11){
var count=0,n=null,_24f5=node.childNodes;
for(var i=0;i<_24f5.length;i++){
if(_24f5[i].nodeType!==8){
count++;
n=_24f5[i];
if(count>1){
break;
}
}
}
if(count>1){
console.error("ERROR: complex widget content not supported");
return;
}
node=n;
}
var _24f6=new _24cd(node.tagName.toLowerCase());
if(node.hasAttributes()){
var attrs=node.attributes;
for(var j=attrs.length-1;j>=0;--j){
_24f6.addAttribute(attrs[j].name,attrs[j].value);
}
}
if(node.innerHTML){
_24f6.addText(node.innerHTML);
}
var _24f7=_24ce.queryDescriptor(type,"requiresId"),name=_24ce.queryDescriptor(type,"name"),_24f8=_24f7&&name.match(/^[A-Za-z]\w*$/)?name:undefined;
node.id=(data.properties&&data.properties.id)||data.context.getUniqueID(_24f6,_24f8);
var _24f5=data.children;
if(_24f5){
if(dojo.isString(_24f5)){
node.innerHTML=_24f5;
var _24f9=node.nodeName.toLowerCase();
var _24fa=_24f6._getAttribute("id");
_24f6.addText(_24f5);
var _24fb=_24f6.getText(data.context);
_24f6.children=[];
_24f6.setText(_24fb);
if(_24fa){
_24f6.addAttribute(_24fa.name,_24fa.value,_24fa.noPersist);
}
_24d1(data.context,node,_24f6);
}else{
dojo.forEach(_24f5,function(c){
if(!c){
return;
}
if(dojo.isString(c)){
if(c.length>7&&c.substring(0,4)=="<!--"&&c.substring(c.length-3)=="-->"){
node.appendChild(dojo.doc.createComment(c.substring(4,c.length-3)));
_24f6.addComment(c.substring(4,c.length-3));
}else{
node.appendChild(dojo.doc.createTextNode(c));
_24f6.addText(c);
}
}else{
c.context=data.context;
var child=_24d8.createWidget(c);
if(child){
node.appendChild(child.domNode);
_24f6.addChild(child._srcElement);
}
}
});
}
}
var _24fc=_24d8.getWidgetHelper(type);
if(_24fc&&_24fc.preProcessData){
data=_24fc.preProcessData(data);
}
var _24fd={};
var _24fe={};
for(var p in data.properties){
var _24ff=data.properties[p];
if(_24ff!=null){
if(p.substr(0,2).toLowerCase()!="on"){
_24fd[p]=_24ff;
}else{
_24fe[p]=_24ff;
}
}
}
var _2500=new c(_24fd,node,type,md,_24f6);
_2500._srcElement=_24f6;
if(_2500.chart&&(data.properties&&data.properties.theme)){
_2500.chart.theme.themeName=theme;
}
if(data.scripts){
_2500.scripts=data.scripts;
}
if(data.context){
_2500._edit_context=data.context;
}
if(data.properties){
_2500.setProperties(_24fd);
_2500.setProperties(_24fe,true);
}
if(data.maqAppStates||data.maqDeltas){
if(data.maqAppStates){
_2500.domNode._maqAppStates=dojo.clone(data.maqAppStates);
}
if(data.maqDeltas){
_2500.domNode._maqDeltas=dojo.clone(data.maqDeltas);
}
var obj=davinci.states.serialize(_2500.domNode);
if(obj.maqAppStates){
_2500._srcElement.addAttribute(davinci.states.APPSTATES_ATTRIBUTE,obj.maqAppStates);
}
if(obj.maqDeltas){
_2500._srcElement.addAttribute(davinci.states.DELTAS_ATTRIBUTE,obj.maqDeltas);
}
}
var _24fc=_24d8.getWidgetHelper(type);
if(_24fc&&_24fc.cleanSrcElement){
_24fc.cleanSrcElement(_2500._srcElement);
}
return _2500;
},_createSrcElement:function(node){
var _2501=new _24cd(node.tagName.toLowerCase());
if(node.hasAttributes()){
var attrs=node.attributes;
for(var j=attrs.length-1;j>=0;--j){
_2501.addAttribute(attrs[j].name,attrs[j].value);
}
}
return _2501;
},getWidgetHelper:function(type){
return _24d0[type];
},requireWidgetHelper:function(type){
var d=new _24cf();
_24ce.getHelper(type,"helper").then(function(_2502){
if(_2502){
d.resolve(_24d0[type]=new _2502());
}else{
d.resolve();
}
});
return d;
},getWidget:function(node){
if(!node||node.nodeType!=1){
return undefined;
}
var _2503=_24d8.byNode(node);
if(!_2503){
var ctor;
var data=_24d6(node);
var _2504=node.getAttribute("dvwidget");
if(node.hasAttribute("widgetid")||node.hasAttribute("data-dojo-type")||node.hasAttribute("dojotype")){
var d=_24d8._dijit(node);
var w=d.byNode(node);
if(w){
_2503=new davinci.ve.DijitWidget(data,node,w);
}else{
_2503=new davinci.ve.ObjectWidget(data,node);
}
}else{
if(_2504){
_2503=new davinci.ve.GenericWidget(data,node,_2504);
}else{
if(node.nodeName=="svg"){
return undefined;
}
_2503=new davinci.ve.HTMLWidget(data,node);
}
}
}
return _2503;
}};
dojo.setObject("davinci.ve.widget",_24d8);
return _24d8;
});
},"url:dijit/templates/TooltipDialog.html":"<div role=\"presentation\" tabIndex=\"-1\">\n\t<div class=\"dijitTooltipContainer\" role=\"presentation\">\n\t\t<div class =\"dijitTooltipContents dijitTooltipFocusNode\" data-dojo-attach-point=\"containerNode\" role=\"dialog\"></div>\n\t</div>\n\t<div class=\"dijitTooltipConnector\" role=\"presentation\" data-dojo-attach-point=\"connectorNode\"></div>\n</div>\n","url:dijit/templates/Calendar.html":"<table cellspacing=\"0\" cellpadding=\"0\" class=\"dijitCalendarContainer\" role=\"grid\" aria-labelledby=\"${id}_mddb ${id}_year\">\n\t<thead>\n\t\t<tr class=\"dijitReset dijitCalendarMonthContainer\" valign=\"top\">\n\t\t\t<th class='dijitReset dijitCalendarArrow' data-dojo-attach-point=\"decrementMonth\">\n\t\t\t\t<img src=\"${_blankGif}\" alt=\"\" class=\"dijitCalendarIncrementControl dijitCalendarDecrease\" role=\"presentation\"/>\n\t\t\t\t<span data-dojo-attach-point=\"decreaseArrowNode\" class=\"dijitA11ySideArrow\">-</span>\n\t\t\t</th>\n\t\t\t<th class='dijitReset' colspan=\"5\">\n\t\t\t\t<div data-dojo-attach-point=\"monthNode\">\n\t\t\t\t</div>\n\t\t\t</th>\n\t\t\t<th class='dijitReset dijitCalendarArrow' data-dojo-attach-point=\"incrementMonth\">\n\t\t\t\t<img src=\"${_blankGif}\" alt=\"\" class=\"dijitCalendarIncrementControl dijitCalendarIncrease\" role=\"presentation\"/>\n\t\t\t\t<span data-dojo-attach-point=\"increaseArrowNode\" class=\"dijitA11ySideArrow\">+</span>\n\t\t\t</th>\n\t\t</tr>\n\t\t<tr role=\"row\">\n\t\t\t${!dayCellsHtml}\n\t\t</tr>\n\t</thead>\n\t<tbody data-dojo-attach-point=\"dateRowsNode\" data-dojo-attach-event=\"onclick: _onDayClick\" class=\"dijitReset dijitCalendarBodyContainer\">\n\t\t\t${!dateRowsHtml}\n\t</tbody>\n\t<tfoot class=\"dijitReset dijitCalendarYearContainer\">\n\t\t<tr>\n\t\t\t<td class='dijitReset' valign=\"top\" colspan=\"7\" role=\"presentation\">\n\t\t\t\t<div class=\"dijitCalendarYearLabel\">\n\t\t\t\t\t<span data-dojo-attach-point=\"previousYearLabelNode\" class=\"dijitInline dijitCalendarPreviousYear\" role=\"button\"></span>\n\t\t\t\t\t<span data-dojo-attach-point=\"currentYearLabelNode\" class=\"dijitInline dijitCalendarSelectedYear\" role=\"button\" id=\"${id}_year\"></span>\n\t\t\t\t\t<span data-dojo-attach-point=\"nextYearLabelNode\" class=\"dijitInline dijitCalendarNextYear\" role=\"button\"></span>\n\t\t\t\t</div>\n\t\t\t</td>\n\t\t</tr>\n\t</tfoot>\n</table>\n","dijit/tree/ForestStoreModel":function(){
define("dijit/tree/ForestStoreModel",["dojo/_base/array","dojo/_base/declare","dojo/_base/kernel","dojo/_base/lang","./TreeStoreModel"],function(array,_2505,_2506,lang,_2507){
return _2505("dijit.tree.ForestStoreModel",_2507,{rootId:"$root$",rootLabel:"ROOT",query:null,constructor:function(_2508){
this.root={store:this,root:true,id:_2508.rootId,label:_2508.rootLabel,children:_2508.rootChildren};
},mayHaveChildren:function(item){
return item===this.root||this.inherited(arguments);
},getChildren:function(_2509,_250a,_250b){
if(_2509===this.root){
if(this.root.children){
_250a(this.root.children);
}else{
this.store.fetch({query:this.query,onComplete:lang.hitch(this,function(items){
this.root.children=items;
_250a(items);
}),onError:_250b});
}
}else{
this.inherited(arguments);
}
},isItem:function(_250c){
return (_250c===this.root)?true:this.inherited(arguments);
},fetchItemByIdentity:function(_250d){
if(_250d.identity==this.root.id){
var scope=_250d.scope||_2506.global;
if(_250d.onItem){
_250d.onItem.call(scope,this.root);
}
}else{
this.inherited(arguments);
}
},getIdentity:function(item){
return (item===this.root)?this.root.id:this.inherited(arguments);
},getLabel:function(item){
return (item===this.root)?this.root.label:this.inherited(arguments);
},newItem:function(args,_250e,_250f){
if(_250e===this.root){
this.onNewRootItem(args);
return this.store.newItem(args);
}else{
return this.inherited(arguments);
}
},onNewRootItem:function(){
},pasteItem:function(_2510,_2511,_2512,bCopy,_2513){
if(_2511===this.root){
if(!bCopy){
this.onLeaveRoot(_2510);
}
}
this.inherited(arguments,[_2510,_2511===this.root?null:_2511,_2512===this.root?null:_2512,bCopy,_2513]);
if(_2512===this.root){
this.onAddToRoot(_2510);
}
},onAddToRoot:function(item){
},onLeaveRoot:function(item){
},_requeryTop:function(){
var _2514=this.root.children||[];
this.store.fetch({query:this.query,onComplete:lang.hitch(this,function(_2515){
this.root.children=_2515;
if(_2514.length!=_2515.length||array.some(_2514,function(item,idx){
return _2515[idx]!=item;
})){
this.onChildrenChange(this.root,_2515);
}
})});
},onNewItem:function(item,_2516){
this._requeryTop();
this.inherited(arguments);
},onDeleteItem:function(item){
if(array.indexOf(this.root.children,item)!=-1){
this._requeryTop();
}
this.inherited(arguments);
},onSetItem:function(item,_2517,_2518,_2519){
this._requeryTop();
this.inherited(arguments);
}});
});
},"davinci/workbench/_ToolbaredContainer":function(){
define(["dojo/_base/declare","dijit/layout/_LayoutWidget","dijit/_Templated"],function(_251a,_251b,_251c){
return _251a("davinci.workbench._ToolbaredContainer",[_251b,_251c],{templateString:"<div><div dojoAttachPoint='titleBarDiv' class='palette_titleBarDiv'></div><div dojoAttachPoint='toolbarDiv' class='toolbaredContainer_toolbarDiv'></div><div dojoAttachPoint='containerNode'></div></div>",gutters:false,_toolbarCreated:{},layout:function(){
var _251d=[{domNode:this.titleBarDiv,layoutAlign:"top"},{domNode:this.toolbarDiv,layoutAlign:"top"},{domNode:this.containerNode,layoutAlign:"client"}];
dijit.layout.layoutChildren(this.domNode,this._contentBox,_251d);
this._containerContentBox=dijit.layout.marginBox2contentBox(this.containerNode,_251d[2]);
var _251e=dijit.byNode(this.containerNode);
if(_251e&&_251e.resize){
_251e.resize(this._containerContentBox);
}
dojo.marginBox(this.containerNode,_251d[2]);
},setContent:function(data){
this.mainWidget=data;
var _251f=data.domNode||data;
dojo.place(_251f,this.containerNode,"replace");
this.containerNode=_251f;
if(!this.toolbarCreated(this.declaredClass)){
this._createToolbar(this.declaredClass);
}
this.titleBarDiv.innerHTML="<span class=\"paletteCloseBox\"></span><span class=\"titleBarDivTitle\">"+this.title+"</span>";
var _2520=dojo.query(".paletteCloseBox",this.titleBarDiv);
if(_2520.length>0){
var _2521=_2520[0];
dojo.connect(_2521,"click",this,function(event){
davinci.Workbench.collapsePaletteContainer(event.currentTarget);
});
}
if(this._started){
this.layout();
}
},removeContent:function(){
var _2522=dojo.doc.createElement("div");
dojo.place(_2522,this.containerNode,"replace");
this.containerNode=_2522;
if(this.mainWidget){
this.mainWidget.destroy();
}
delete this.mainWidget;
},_getViewActions:function(){
},getTopAdditions:function(){
},_createToolbar:function(_2523){
var _2524=require("davinci/Workbench");
var _2525=this.getToolbarDiv();
var _2526=this.getTopAdditions();
if(_2526){
_2525.appendChild(_2526);
}
if(this.toolbarMenuActionSets){
var _2527="m"+Date.now();
var _2528=_2527+"_menucontainer";
var _2529=dojo.create("span",{"id":_2528,"class":"paletteDropdown"},_2525);
var _252a=_2527+"_menu";
var _252b=dojo.create("span",{id:_252a},_2529);
_2524.updateMenubar(_252b,this.toolbarMenuActionSets);
}
var _252c=this._getViewActions();
if(_252c&&_252c.length){
var _252d=dojo.create("div",{"class":"toolbaredContainer_toolbarDiv"});
var tb=dojo.create("span",{style:{display:"inline-block"}},_252d);
var _252e=_2524._createToolBar("toolbarPath",tb,_252c,this._getViewContext());
dojo.style(_252e.domNode,{"display":"inline-block","float":"left"});
this.toolbarCreated(_2523,_252e);
}
},_getViewContext:function(){
return this;
},getToolbarDiv:function(){
return this.toolbarDiv;
},toolbarCreated:function(_252f,_2530){
if(arguments.length>1){
this._toolbarCreated[_252f]=_2530;
}
return this._toolbarCreated[_252f];
},attachToolbar:function(){
var _2531=this.toolbarCreated(this.declaredClass);
var _2532=this.getToolbarDiv();
if(_2531&&_2531.domNode&&_2532){
_2532.innerHTML="";
_2532.appendChild(_2531.domNode);
}
}});
});
},"davinci/ui/widgets/DocileDialog":function(){
define(["dojo/_base/declare","dijit/Dialog","dojo/i18n!davinci/ui/nls/ui","dojo/i18n!dijit/nls/common"],function(_2533,_2534,uiNLS,_2535){
return _2533("davinci.ui.widgets.DocileDialog",null,{constructor:function(args){
var _2536=dojo.doc.createElement("div");
var _2537=dojo.doc.createElement("div");
_2537.innerHTML=args.content||this.content;
_2537.innerHTML+="<br><br>";
var _2538=dojo.create("div",{style:"text-align:center"});
var _2539=_2535;
var _253a=[_2539.buttonOk,_2539.buttonCancel];
this.callBack=args.callBack;
function _253b(_253c){
return function(){
return this._onChange({target:_253c});
};
};
function _253d(box){
return function(){
return this._onChangeAlways({target:box});
};
};
for(var i=0;i<_253a.length;i++){
var _253e=dojo.create("button",{innerHTML:_253a[i]});
dojo.connect(_253e,"onclick",this,_253b(_253a[i]));
_2538.appendChild(_253e);
}
var _253f=dojo.create("div",{style:"vertical-align:middle"});
var text=dojo.create("span");
var check=dojo.create("input",{style:"vertical-align:middle"});
check.type="checkbox";
dojo.connect(check,"onchange",this,_253d(check));
var _2540=uiNLS;
text.innerHTML="&nbsp;&nbsp;&nbsp;"+(args.disableText||_2540.dontShowAgain)+"<br><br>";
_253f.appendChild(check);
_253f.appendChild(text);
_2536.appendChild(_2537);
_2536.appendChild(_253f);
_2536.appendChild(_2538);
this.dialog=new _2534({title:args.title||"",content:_2536,style:"width: 250px"});
this.dialog.show();
},_onChange:function(value){
this.value=value.target;
this.dialog.hide();
this.callBack({value:this.value,alwaysShow:this.shouldShow});
},_onChangeAlways:function(_2541){
this.shouldShow=!dojo.attr(_2541.target,"checked");
},shouldShow:function(){
this.shouldShow;
}});
});
},"davinci/html/HTMLParser":function(){
define(["dojo/_base/declare","davinci/html/HTMLText","davinci/html/HTMLElement","davinci/html/HTMLAttribute","davinci/html/HTMLComment","davinci/html/PHPBlock","davinci/model/parser/Tokenizer","davinci/html/CSSParser"],function(_2542,_2543,_2544,_2545,_2546,_2547,_2548,_2549){
var _254a=(function(){
var _254b={autoSelfClosers:{"br":true,"img":true,"hr":true,"link":true,"input":true,"meta":true,"col":true,"frame":true,"base":true,"area":true},doNotIndent:{"pre":true,"!cdata":true}};
var _254c={autoSelfClosers:{},doNotIndent:{"!cdata":true}};
var _254d=_254b;
var _254e=false;
var _254f=(function(){
function _2550(_2551,_2552){
var ch=_2551.next();
if(ch=="<"){
if(_2551.equals("!")){
_2551.next();
if(_2551.equals("[")){
if(_2551.lookAhead("[CDATA[",true)){
_2552(_2553("xml-cdata","]]>"));
return null;
}else{
return "xml-text";
}
}else{
if(_2551.lookAhead("--",true)){
_2552(_2553("xml-comment","-->"));
return null;
}else{
if(_2551.lookAhead("DOCTYPE",true)){
_2551.nextWhileMatches(/[\w\._\-]/);
_2552(_2553("xml-doctype",">"));
return "xml-doctype";
}else{
return "xml-text";
}
}
}
}else{
if(_2551.equals("?")){
_2551.next();
if(_2551.lookAhead("php",true,false,true)){
_2552(_2554("php-block","?>"));
return null;
}else{
_2551.nextWhileMatches(/[\w\._\-]/);
_2552(_2553("xml-processing","?>"));
return "xml-processing";
}
}else{
if(_2551.equals("/")){
_2551.next();
}
_2552(inTag);
return "xml-punctuation";
}
}
}else{
if(ch=="&"){
while(!_2551.endOfLine()){
if(_2551.next()==";"){
break;
}
}
return "xml-entity";
}else{
_2551.nextWhileMatches(/[^&<\n]/);
return "xml-text";
}
}
};
function inTag(_2555,_2556){
var ch=_2555.next();
if(ch==">"){
_2556(_2550);
return "xml-punctuation";
}else{
if(/[?\/]/.test(ch)&&_2555.equals(">")){
_2555.next();
_2556(_2550);
return "xml-punctuation";
}else{
if(ch=="="){
return "xml-punctuation";
}else{
if(/[\'\"]/.test(ch)){
_2556(_2557(ch));
return null;
}else{
_2555.nextWhileMatches(/[^\s\u00a0=<>\"\'\/?]/);
return "xml-name";
}
}
}
}
};
function _2557(quote){
return function(_2558,_2559){
while(!_2558.endOfLine()){
if(_2558.next()==quote){
_2559(inTag);
break;
}
}
return "xml-attribute";
};
};
function _2553(style,_255a){
return function(_255b,_255c){
while(!_255b.endOfLine()){
if(_255b.lookAhead(_255a,true)){
_255c(_2550);
break;
}
_255b.next();
}
return style;
};
};
function _2554(style,_255d){
return function(_255e,_255f){
var _2560=false;
while(!_255e.endOfLine()){
if(_255e.lookAhead(_255d,true)){
_2560=true;
_255f(_2550);
break;
}
_255e.next();
}
if(!_2560&&_255e.endOfLine()){
_255e.next();
}else{
while(_255e.lookAheadRegex(/^[\ \t]/,true)){
}
if(_255e.endOfLine()){
_255e.next();
}
}
return style;
};
};
return function(_2561,_2562){
return _2548.tokenizer(_2561,_2562||_2550);
};
})();
function _2563(_2564){
var _2565=_254f(_2564),token;
var cc=[base];
var _2566=0,_2567=0;
var _2568=null,_2569=null;
var _256a;
function push(fs){
for(var i=fs.length-1;i>=0;i--){
cc.push(fs[i]);
}
};
function cont(){
push(arguments);
_256a=true;
};
function pass(){
push(arguments);
_256a=false;
};
function _256b(){
token.style+=" xml-error";
};
function _256c(text){
return function(style,_256d){
if(_256d==text){
cont();
}else{
_256b();
cont(arguments.callee);
}
};
};
function _256e(_256f,_2570){
var _2571=_254d.doNotIndent.hasOwnProperty(_256f)||(_2569&&_2569.noIndent);
_2569={prev:_2569,name:_256f,indent:_2567,startOfLine:_2570,noIndent:_2571};
};
function _2572(){
_2569=_2569.prev;
};
function _2573(_2574){
return function(_2575,_2576){
var _2577=_2574;
if(_2577&&_2577.noIndent){
return _2576;
}
if(_254e&&/<!\[CDATA\[/.test(_2575)){
return 0;
}
if(_2577&&/^<\//.test(_2575)){
_2577=_2577.prev;
}
while(_2577&&!_2577.startOfLine){
_2577=_2577.prev;
}
if(_2577){
return _2577.indent+indentUnit;
}else{
return 0;
}
};
};
function base(){
return pass(_2578,base);
};
var _2579={"xml-text":true,"xml-entity":true,"xml-comment":true,"xml-processing":true,"xml-doctype":true,"php-block":true};
function _2578(style,_257a){
if(_257a=="<"){
cont(_257b,_257c,_257d(_2566==1));
}else{
if(_257a=="</"){
cont(_257e,_256c(">"));
}else{
if(style=="xml-cdata"){
if(!_2569||_2569.name!="!cdata"){
_256e("!cdata");
}
if(/\]\]>$/.test(_257a)){
_2572();
}
cont();
}else{
if(_2579.hasOwnProperty(style)){
cont();
}else{
_256b();
cont();
}
}
}
}
};
function _257b(style,_257f){
if(style=="xml-name"){
_2568=_257f.toLowerCase();
token.style="xml-tagname";
cont();
}else{
_2568=null;
pass();
}
};
function _257e(style,_2580){
if(style=="xml-name"){
token.style="xml-tagname";
if(_2569&&_2580.toLowerCase()==_2569.name){
_2572();
}else{
_256b();
}
}
cont();
};
function _257d(_2581){
return function(style,_2582){
if(_2582=="/>"||(_2582==">"&&_254d.autoSelfClosers.hasOwnProperty(_2568))){
cont();
}else{
if(_2582==">"){
_256e(_2568,_2581);
cont();
}else{
_256b();
cont(arguments.callee);
}
}
};
};
function _257c(style){
if(style=="xml-name"){
token.style="xml-attname";
cont(_2583,_257c);
}else{
pass();
}
};
function _2583(style,_2584){
if(_2584=="="){
cont(value);
}else{
if(_2584==">"||_2584=="/>"){
pass(_257d);
}else{
pass();
}
}
};
function value(style){
if(style=="xml-attribute"){
cont(value);
}else{
pass();
}
};
return {indentation:function(){
return _2567;
},next:function(){
token=_2565.next();
if(token.style=="whitespace"&&_2566==0){
_2567=token.value.length;
}else{
_2566++;
}
if(token.content=="\n"){
_2567=_2566=0;
token.indentation=_2573(_2569);
}
if(token.style=="whitespace"||token.type=="xml-comment"||token.type=="php-block"){
return token;
}
while(true){
_256a=false;
cc.pop()(token.style,token.content);
if(_256a){
return token;
}
}
},copy:function(){
var _2585=cc.concat([]),_2586=_2565.state,_2587=_2569;
var _2588=this;
return function(input){
cc=_2585.concat([]);
_2566=_2567=0;
_2569=_2587;
_2565=_254f(input,_2586);
return _2588;
};
}};
};
return {make:_2563,electricChars:"/",configure:function(_2589){
if(_2589.useHTMLKludges!=null){
_254d=_2589.useHTMLKludges?_254b:_254c;
}
if(_2589.alignCDATA){
_254e=_2589.alignCDATA;
}
}};
})();
var parse=function(text,_258a){
var _258b={next:function(){
if(++this.count==1){
return text;
}else{
throw StopIteration;
}
},count:0,text:text};
var _258c=_2548.stringStream(_258b);
var _258d=_254a.make(_258c);
var token;
var _258e=[];
function error(text){
_258e.push(text);
};
var stack=[];
stack.push(_258a);
var _258f;
var _2590,_2591;
function _2592(text,_2593){
_258f=new _2543();
_258f.wasParsed=true;
_258f.startOffset=_2593;
stack[stack.length-1].addChild(_258f,undefined,true);
_258f.value=text;
};
function _2594(token){
if(token.content!=token.value){
_2592(token.value.substring(token.content.length),token.offset+token.value.length);
}
};
function _2595(str,_2596){
var lines=str.split("\n");
var _2597=lines[lines.length-1].length;
if(_2596.children.length){
lastElement=_2596.children[_2596.children.length-1];
lastElement._fmLine=lines.length-1;
lastElement._fmIndent=_2597;
}else{
_2596._fmChildLine=lines.length-1;
_2596._fmChildIndent=_2597;
}
};
function _2598(){
if(_258f!=null&&!_258f.value.match(/\S/)){
var _2599=stack[stack.length-1];
_2599.children.pop();
_2595(_258f.value,_2599);
}
_258f=null;
};
function _259a(){
var _259b=stack[stack.length-1];
_258c.nextWhileMatches(/[\s\u00a0]/);
var str=_258c.get();
if(_258f!=null){
_258f.value+=str;
_2598();
}else{
_2595(str,_259b);
}
_2549.parse(_258c,_259b);
};
function _259c(_259d){
token=_258d.next();
while(_259d&&token.style=="whitespace"){
token=_258d.next();
}
return token;
};
try{
do{
token=_258d.next();
switch(token.style){
case "xml-punctuation":
_2598();
if(token.content=="<"){
var model=new _2544();
model.wasParsed=true;
model.startOffset=token.offset;
stack[stack.length-1].addChild(model,undefined,true);
_259c(true);
if(token.style=="xml-tagname"){
model.tag=token.content;
}else{
error("expecting tag name");
}
while((token=_259c(true)).style=="xml-attname"){
var _259e=new _2545();
_259e.wasParsed=true;
model.attributes.push(_259e);
_259e.name=token.content;
_259e.startOffset=token.offset;
_259c(true);
if(token.content=="="){
token=_258d.next();
if(token.style=="xml-attribute"){
var s=token.content;
_259e.setValue(s.substring(1,s.length-1));
}else{
error("expecting attribute value");
}
}else{
_259e.noValue=true;
_259e.setValue(true);
}
_259e.endOffset=token.offset-1;
if(_259e.noValue&&token.style!="xml-attname"){
break;
}
}
if(token.style!="xml-punctuation"){
error("expecting >");
}else{
model.startTagOffset=token.offset;
if(token.content==">"){
stack.push(model);
}else{
model.noEndTag=true;
model=stack[stack.length-1];
}
_2594(token);
}
if(model.tag=="style"){
_259a();
}
}else{
if(token.value=="</"){
var _259f=model;
token=_258d.next();
if(model.tag=="script"){
model.script=model.getElementText();
}
stack.pop();
model=stack[stack.length-1];
token=_258d.next();
_259f.endOffset=token.offset;
_2594(token);
}
}
_2591=null;
break;
case "xml-text":
case "whitespace":
case "xml-entity":
if(_2590){
_2590.value+=token.value;
}else{
if(_2591){
_2591.value+=token.value;
}else{
if(!_258f){
_2592(token.value,token.offset);
}else{
_258f.value+=token.value;
}
}
}
_2591=null;
break;
case "xml-comment":
_2598();
var _25a0=new _2546();
_25a0.wasParsed=true;
_25a0.startOffset=token.offset;
_25a0.value=token.content.substring(4,token.content.length-3);
_25a0.endOffset=token.offset+token.content.length;
stack[stack.length-1].addChild(_25a0,undefined,true);
_2591=null;
break;
case "php-block":
_2598();
var _25a1=new _2547();
_25a1.wasParsed=true;
_25a1.startOffset=token.offset;
_25a1.value=token.content;
_25a1.endOffset=token.offset+token.content.length;
stack[stack.length-1].addChild(_25a1,undefined,true);
_2591=_25a1;
break;
case "xml-doctype":
if(!_2590){
_2598();
var _25a0=new _2546();
_25a0.wasParsed=true;
_25a0.startOffset=token.offset;
_25a0.value=token.value.substring(2);
stack[stack.length-1].addChild(_25a0,undefined,true);
_25a0.isProcessingInstruction=true;
token=_258d.next();
}
var _25a2=token.content.length-1;
if(token.content.charAt(token.content.length-1)==">"){
_25a0.endOffset=token.offset+token.content.length;
_25a0.value+=token.content.substring(0,_25a2);
_2594(token);
_2590=undefined;
}else{
_2590=_25a0;
_25a0.value+=token.content;
}
_2591=null;
break;
}
}while(true);
}
catch(e){
}
return {errors:_258e,endOffset:(token?token.offset:0)};
};
return {parse:parse};
});
},"davinci/ui/widgets/TransformTreeMixin":function(){
define("davinci/ui/widgets/TransformTreeMixin",["dijit/Tree"],function(tree){
var _25a3=dijit.Tree.prototype.postCreate;
dijit.Tree.prototype.postCreate=function(){
var _25a4=dijit.Tree.prototype._onItemChildrenChange;
dijit.Tree.prototype._onItemChildrenChange=function(_25a5,_25a6){
if(this.transforms){
this.transforms.forEach(function(_25a7){
_25a6=_25a7(_25a6);
});
}
_25a4.apply(this,[_25a5,_25a6]);
};
var _25a8=this.model.getChildren;
this.model.getChildren=dojo.hitch(this,function(_25a9,_25aa,_25ab){
var _25ac=_25aa;
if(this.transforms){
_25ac=dojo.hitch(this,function(items){
this.transforms.forEach(function(_25ad){
items=_25ad(items);
});
_25aa(items);
});
}
_25a8.apply(this.model,[_25a9,_25ac,_25ab]);
});
_25a3.apply(this);
};
});
},"dojox/grid/_Builder":function(){
define("dojox/grid/_Builder",["../main","dojo/_base/array","dojo/_base/lang","dojo/_base/window","dojo/_base/event","dojo/_base/sniff","dojo/_base/connect","dojo/dnd/Moveable","dojox/html/metrics","./util","dojo/_base/html"],function(dojox,array,lang,win,event,has,_25ae,_25af,_25b0,util,html){
var dg=dojox.grid;
var _25b1=function(td){
return td.cellIndex>=0?td.cellIndex:array.indexOf(td.parentNode.cells,td);
};
var _25b2=function(tr){
return tr.rowIndex>=0?tr.rowIndex:array.indexOf(tr.parentNode.childNodes,tr);
};
var getTr=function(_25b3,index){
return _25b3&&((_25b3.rows||0)[index]||_25b3.childNodes[index]);
};
var _25b4=function(node){
for(var n=node;n&&n.tagName!="TABLE";n=n.parentNode){
}
return n;
};
var _25b5=function(_25b6,_25b7){
for(var n=_25b6;n&&_25b7(n);n=n.parentNode){
}
return n;
};
var _25b8=function(_25b9){
var name=_25b9.toUpperCase();
return function(node){
return node.tagName!=name;
};
};
var _25ba=util.rowIndexTag;
var _25bb=util.gridViewTag;
var _25bc=dg._Builder=lang.extend(function(view){
if(view){
this.view=view;
this.grid=view.grid;
}
},{view:null,_table:"<table class=\"dojoxGridRowTable\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\" role=\"presentation\"",getTableArray:function(){
var html=[this._table];
if(this.view.viewWidth){
html.push([" style=\"width:",this.view.viewWidth,";\""].join(""));
}
html.push(">");
return html;
},generateCellMarkup:function(_25bd,_25be,_25bf,_25c0){
var _25c1=[],html;
if(_25c0){
var _25c2=_25bd.index!=_25bd.grid.getSortIndex()?"":_25bd.grid.sortInfo>0?"aria-sort=\"ascending\"":"aria-sort=\"descending\"";
if(!_25bd.id){
_25bd.id=this.grid.id+"Hdr"+_25bd.index;
}
html=["<th tabIndex=\"-1\" aria-readonly=\"true\" role=\"columnheader\"",_25c2,"id=\"",_25bd.id,"\""];
}else{
var _25c3=this.grid.editable&&!_25bd.editable?"aria-readonly=\"true\"":"";
html=["<td tabIndex=\"-1\" role=\"gridcell\"",_25c3];
}
if(_25bd.colSpan){
html.push(" colspan=\"",_25bd.colSpan,"\"");
}
if(_25bd.rowSpan){
html.push(" rowspan=\"",_25bd.rowSpan,"\"");
}
html.push(" class=\"dojoxGridCell ");
if(_25bd.classes){
html.push(_25bd.classes," ");
}
if(_25bf){
html.push(_25bf," ");
}
_25c1.push(html.join(""));
_25c1.push("");
html=["\" idx=\"",_25bd.index,"\" style=\""];
if(_25be&&_25be[_25be.length-1]!=";"){
_25be+=";";
}
html.push(_25bd.styles,_25be||"",_25bd.hidden?"display:none;":"");
if(_25bd.unitWidth){
html.push("width:",_25bd.unitWidth,";");
}
_25c1.push(html.join(""));
_25c1.push("");
html=["\""];
if(_25bd.attrs){
html.push(" ",_25bd.attrs);
}
html.push(">");
_25c1.push(html.join(""));
_25c1.push("");
_25c1.push(_25c0?"</th>":"</td>");
return _25c1;
},isCellNode:function(_25c4){
return Boolean(_25c4&&_25c4!=win.doc&&html.attr(_25c4,"idx"));
},getCellNodeIndex:function(_25c5){
return _25c5?Number(html.attr(_25c5,"idx")):-1;
},getCellNode:function(_25c6,_25c7){
for(var i=0,row;((row=getTr(_25c6.firstChild,i))&&row.cells);i++){
for(var j=0,cell;(cell=row.cells[j]);j++){
if(this.getCellNodeIndex(cell)==_25c7){
return cell;
}
}
}
return null;
},findCellTarget:function(_25c8,_25c9){
var n=_25c8;
while(n&&(!this.isCellNode(n)||(n.offsetParent&&_25bb in n.offsetParent.parentNode&&n.offsetParent.parentNode[_25bb]!=this.view.id))&&(n!=_25c9)){
n=n.parentNode;
}
return n!=_25c9?n:null;
},baseDecorateEvent:function(e){
e.dispatch="do"+e.type;
e.grid=this.grid;
e.sourceView=this.view;
e.cellNode=this.findCellTarget(e.target,e.rowNode);
e.cellIndex=this.getCellNodeIndex(e.cellNode);
e.cell=(e.cellIndex>=0?this.grid.getCell(e.cellIndex):null);
},findTarget:function(_25ca,inTag){
var n=_25ca;
while(n&&(n!=this.domNode)&&(!(inTag in n)||(_25bb in n&&n[_25bb]!=this.view.id))){
n=n.parentNode;
}
return (n!=this.domNode)?n:null;
},findRowTarget:function(_25cb){
return this.findTarget(_25cb,_25ba);
},isIntraNodeEvent:function(e){
try{
return (e.cellNode&&e.relatedTarget&&html.isDescendant(e.relatedTarget,e.cellNode));
}
catch(x){
return false;
}
},isIntraRowEvent:function(e){
try{
var row=e.relatedTarget&&this.findRowTarget(e.relatedTarget);
return !row&&(e.rowIndex==-1)||row&&(e.rowIndex==row.gridRowIndex);
}
catch(x){
return false;
}
},dispatchEvent:function(e){
if(e.dispatch in this){
return this[e.dispatch](e);
}
return false;
},domouseover:function(e){
if(e.cellNode&&(e.cellNode!=this.lastOverCellNode)){
this.lastOverCellNode=e.cellNode;
this.grid.onMouseOver(e);
}
this.grid.onMouseOverRow(e);
},domouseout:function(e){
if(e.cellNode&&(e.cellNode==this.lastOverCellNode)&&!this.isIntraNodeEvent(e,this.lastOverCellNode)){
this.lastOverCellNode=null;
this.grid.onMouseOut(e);
if(!this.isIntraRowEvent(e)){
this.grid.onMouseOutRow(e);
}
}
},domousedown:function(e){
if(e.cellNode){
this.grid.onMouseDown(e);
}
this.grid.onMouseDownRow(e);
}});
var _25cc=dg._ContentBuilder=lang.extend(function(view){
_25bc.call(this,view);
},_25bc.prototype,{update:function(){
this.prepareHtml();
},prepareHtml:function(){
var _25cd=this.grid.get,cells=this.view.structure.cells;
for(var j=0,row;(row=cells[j]);j++){
for(var i=0,cell;(cell=row[i]);i++){
cell.get=cell.get||(cell.value==undefined)&&_25cd;
cell.markup=this.generateCellMarkup(cell,cell.cellStyles,cell.cellClasses,false);
if(!this.grid.editable&&cell.editable){
this.grid.editable=true;
}
}
}
},generateHtml:function(_25ce,_25cf){
var html=this.getTableArray(),v=this.view,cells=v.structure.cells,item=this.grid.getItem(_25cf);
util.fire(this.view,"onBeforeRow",[_25cf,cells]);
for(var j=0,row;(row=cells[j]);j++){
if(row.hidden||row.header){
continue;
}
html.push(!row.invisible?"<tr>":"<tr class=\"dojoxGridInvisible\">");
for(var i=0,cell,m,cc,cs;(cell=row[i]);i++){
m=cell.markup;
cc=cell.customClasses=[];
cs=cell.customStyles=[];
m[5]=cell.format(_25cf,item);
m[1]=cc.join(" ");
m[3]=cs.join(";");
html.push.apply(html,m);
}
html.push("</tr>");
}
html.push("</table>");
return html.join("");
},decorateEvent:function(e){
e.rowNode=this.findRowTarget(e.target);
if(!e.rowNode){
return false;
}
e.rowIndex=e.rowNode[_25ba];
this.baseDecorateEvent(e);
e.cell=this.grid.getCell(e.cellIndex);
return true;
}});
var _25d0=dg._HeaderBuilder=lang.extend(function(view){
this.moveable=null;
_25bc.call(this,view);
},_25bc.prototype,{_skipBogusClicks:false,overResizeWidth:4,minColWidth:1,update:function(){
if(this.tableMap){
this.tableMap.mapRows(this.view.structure.cells);
}else{
this.tableMap=new dg._TableMap(this.view.structure.cells);
}
},generateHtml:function(_25d1,_25d2){
var html=this.getTableArray(),cells=this.view.structure.cells;
util.fire(this.view,"onBeforeRow",[-1,cells]);
for(var j=0,row;(row=cells[j]);j++){
if(row.hidden){
continue;
}
html.push(!row.invisible?"<tr>":"<tr class=\"dojoxGridInvisible\">");
for(var i=0,cell,_25d3;(cell=row[i]);i++){
cell.customClasses=[];
cell.customStyles=[];
if(this.view.simpleStructure){
if(cell.draggable){
if(cell.headerClasses){
if(cell.headerClasses.indexOf("dojoDndItem")==-1){
cell.headerClasses+=" dojoDndItem";
}
}else{
cell.headerClasses="dojoDndItem";
}
}
if(cell.attrs){
if(cell.attrs.indexOf("dndType='gridColumn_")==-1){
cell.attrs+=" dndType='gridColumn_"+this.grid.id+"'";
}
}else{
cell.attrs="dndType='gridColumn_"+this.grid.id+"'";
}
}
_25d3=this.generateCellMarkup(cell,cell.headerStyles,cell.headerClasses,true);
_25d3[5]=(_25d2!=undefined?_25d2:_25d1(cell));
_25d3[3]=cell.customStyles.join(";");
_25d3[1]=cell.customClasses.join(" ");
html.push(_25d3.join(""));
}
html.push("</tr>");
}
html.push("</table>");
return html.join("");
},getCellX:function(e){
var n,x=e.layerX;
if(has("mozilla")||has("ie")>=9){
n=_25b5(e.target,_25b8("th"));
x-=(n&&n.offsetLeft)||0;
var t=e.sourceView.getScrollbarWidth();
if(!this.grid.isLeftToRight()){
table=_25b5(n,_25b8("table"));
x-=(table&&table.offsetLeft)||0;
}
}
n=_25b5(e.target,function(){
if(!n||n==e.cellNode){
return false;
}
x+=(n.offsetLeft<0?0:n.offsetLeft);
return true;
});
return x;
},decorateEvent:function(e){
this.baseDecorateEvent(e);
e.rowIndex=-1;
e.cellX=this.getCellX(e);
return true;
},prepareResize:function(e,mod){
do{
var i=e.cellIndex;
e.cellNode=(i?e.cellNode.parentNode.cells[i+mod]:null);
e.cellIndex=(e.cellNode?this.getCellNodeIndex(e.cellNode):-1);
}while(e.cellNode&&e.cellNode.style.display=="none");
return Boolean(e.cellNode);
},canResize:function(e){
if(!e.cellNode||e.cellNode.colSpan>1){
return false;
}
var cell=this.grid.getCell(e.cellIndex);
return !cell.noresize&&cell.canResize();
},overLeftResizeArea:function(e){
if(html.hasClass(win.body(),"dojoDndMove")){
return false;
}
if(has("ie")){
var tN=e.target;
if(html.hasClass(tN,"dojoxGridArrowButtonNode")||html.hasClass(tN,"dojoxGridArrowButtonChar")||html.hasClass(tN,"dojoxGridColCaption")){
return false;
}
}
if(this.grid.isLeftToRight()){
return (e.cellIndex>0)&&(e.cellX>0&&e.cellX<this.overResizeWidth)&&this.prepareResize(e,-1);
}
var t=e.cellNode&&(e.cellX>0&&e.cellX<this.overResizeWidth);
return t;
},overRightResizeArea:function(e){
if(html.hasClass(win.body(),"dojoDndMove")){
return false;
}
if(has("ie")){
var tN=e.target;
if(html.hasClass(tN,"dojoxGridArrowButtonNode")||html.hasClass(tN,"dojoxGridArrowButtonChar")||html.hasClass(tN,"dojoxGridColCaption")){
return false;
}
}
if(this.grid.isLeftToRight()){
return e.cellNode&&(e.cellX>=e.cellNode.offsetWidth-this.overResizeWidth);
}
return (e.cellIndex>0)&&(e.cellX>=e.cellNode.offsetWidth-this.overResizeWidth)&&this.prepareResize(e,-1);
},domousemove:function(e){
if(!this.moveable){
var c=(this.overRightResizeArea(e)?"dojoxGridColResize":(this.overLeftResizeArea(e)?"dojoxGridColResize":""));
if(c&&!this.canResize(e)){
c="dojoxGridColNoResize";
}
html.toggleClass(e.sourceView.headerNode,"dojoxGridColNoResize",(c=="dojoxGridColNoResize"));
html.toggleClass(e.sourceView.headerNode,"dojoxGridColResize",(c=="dojoxGridColResize"));
if(c){
event.stop(e);
}
}
},domousedown:function(e){
if(!this.moveable){
if((this.overRightResizeArea(e)||this.overLeftResizeArea(e))&&this.canResize(e)){
this.beginColumnResize(e);
}else{
this.grid.onMouseDown(e);
this.grid.onMouseOverRow(e);
}
}
},doclick:function(e){
if(this._skipBogusClicks){
event.stop(e);
return true;
}
return false;
},colResizeSetup:function(e,_25d4){
var _25d5=html.contentBox(e.sourceView.headerNode);
if(_25d4){
this.lineDiv=document.createElement("div");
var vw=html.position(e.sourceView.headerNode,true);
var _25d6=html.contentBox(e.sourceView.domNode);
var l=e.pageX;
if(!this.grid.isLeftToRight()&&has("ie")<8){
l-=_25b0.getScrollbar().w;
}
html.style(this.lineDiv,{top:vw.y+"px",left:l+"px",height:(_25d6.h+_25d5.h)+"px"});
html.addClass(this.lineDiv,"dojoxGridResizeColLine");
this.lineDiv._origLeft=l;
win.body().appendChild(this.lineDiv);
}
var _25d7=[],nodes=this.tableMap.findOverlappingNodes(e.cellNode);
for(var i=0,cell;(cell=nodes[i]);i++){
_25d7.push({node:cell,index:this.getCellNodeIndex(cell),width:cell.offsetWidth});
}
var view=e.sourceView;
var adj=this.grid.isLeftToRight()?1:-1;
var views=e.grid.views.views;
var _25d8=[];
for(var j=view.idx+adj,cView;(cView=views[j]);j=j+adj){
_25d8.push({node:cView.headerNode,left:window.parseInt(cView.headerNode.style.left)});
}
var table=view.headerContentNode.firstChild;
var drag={scrollLeft:e.sourceView.headerNode.scrollLeft,view:view,node:e.cellNode,index:e.cellIndex,w:html.contentBox(e.cellNode).w,vw:_25d5.w,table:table,tw:html.contentBox(table).w,spanners:_25d7,followers:_25d8};
return drag;
},beginColumnResize:function(e){
this.moverDiv=document.createElement("div");
html.style(this.moverDiv,{position:"absolute",left:0});
win.body().appendChild(this.moverDiv);
html.addClass(this.grid.domNode,"dojoxGridColumnResizing");
var m=(this.moveable=new _25af(this.moverDiv));
var drag=this.colResizeSetup(e,true);
m.onMove=lang.hitch(this,"doResizeColumn",drag);
_25ae.connect(m,"onMoveStop",lang.hitch(this,function(){
this.endResizeColumn(drag);
if(drag.node.releaseCapture){
drag.node.releaseCapture();
}
this.moveable.destroy();
delete this.moveable;
this.moveable=null;
html.removeClass(this.grid.domNode,"dojoxGridColumnResizing");
}));
if(e.cellNode.setCapture){
e.cellNode.setCapture();
}
m.onMouseDown(e);
},doResizeColumn:function(_25d9,mover,_25da){
var _25db=_25da.l;
var data={deltaX:_25db,w:_25d9.w+(this.grid.isLeftToRight()?_25db:-_25db),vw:_25d9.vw+_25db,tw:_25d9.tw+_25db};
this.dragRecord={inDrag:_25d9,mover:mover,leftTop:_25da};
if(data.w>=this.minColWidth){
if(!mover){
this.doResizeNow(_25d9,data);
}else{
html.style(this.lineDiv,"left",(this.lineDiv._origLeft+data.deltaX)+"px");
}
}
},endResizeColumn:function(_25dc){
if(this.dragRecord){
var _25dd=this.dragRecord.leftTop;
var _25de=this.grid.isLeftToRight()?_25dd.l:-_25dd.l;
_25de+=Math.max(_25dc.w+_25de,this.minColWidth)-(_25dc.w+_25de);
if(has("webkit")&&_25dc.spanners.length){
_25de+=html._getPadBorderExtents(_25dc.spanners[0].node).w;
}
var data={deltaX:_25de,w:_25dc.w+_25de,vw:_25dc.vw+_25de,tw:_25dc.tw+_25de};
this.doResizeNow(_25dc,data);
delete this.dragRecord;
}
html.destroy(this.lineDiv);
html.destroy(this.moverDiv);
html.destroy(this.moverDiv);
delete this.moverDiv;
this._skipBogusClicks=true;
_25dc.view.update();
this._skipBogusClicks=false;
this.grid.onResizeColumn(_25dc.index);
},doResizeNow:function(_25df,data){
_25df.view.convertColPctToFixed();
if(_25df.view.flexCells&&!_25df.view.testFlexCells()){
var t=_25b4(_25df.node);
if(t){
(t.style.width="");
}
}
var i,s,sw,f,fl;
for(i=0;(s=_25df.spanners[i]);i++){
sw=s.width+data.deltaX;
if(sw>0){
s.node.style.width=sw+"px";
_25df.view.setColWidth(s.index,sw);
}
}
if(this.grid.isLeftToRight()||!has("ie")){
for(i=0;(f=_25df.followers[i]);i++){
fl=f.left+data.deltaX;
f.node.style.left=fl+"px";
}
}
_25df.node.style.width=data.w+"px";
_25df.view.setColWidth(_25df.index,data.w);
_25df.view.headerNode.style.width=data.vw+"px";
_25df.view.setColumnsWidth(data.tw);
if(!this.grid.isLeftToRight()){
_25df.view.headerNode.scrollLeft=_25df.scrollLeft+data.deltaX;
}
}});
dg._TableMap=lang.extend(function(rows){
this.mapRows(rows);
},{map:null,mapRows:function(_25e0){
var _25e1=_25e0.length;
if(!_25e1){
return;
}
this.map=[];
var row;
for(var k=0;(row=_25e0[k]);k++){
this.map[k]=[];
}
for(var j=0;(row=_25e0[j]);j++){
for(var i=0,x=0,cell,_25e2,_25e3;(cell=row[i]);i++){
while(this.map[j][x]){
x++;
}
this.map[j][x]={c:i,r:j};
_25e3=cell.rowSpan||1;
_25e2=cell.colSpan||1;
for(var y=0;y<_25e3;y++){
for(var s=0;s<_25e2;s++){
this.map[j+y][x+s]=this.map[j][x];
}
}
x+=_25e2;
}
}
},dumpMap:function(){
for(var j=0,row,h="";(row=this.map[j]);j++,h=""){
for(var i=0,cell;(cell=row[i]);i++){
h+=cell.r+","+cell.c+"   ";
}
}
},getMapCoords:function(inRow,inCol){
for(var j=0,row;(row=this.map[j]);j++){
for(var i=0,cell;(cell=row[i]);i++){
if(cell.c==inCol&&cell.r==inRow){
return {j:j,i:i};
}
}
}
return {j:-1,i:-1};
},getNode:function(_25e4,inRow,inCol){
var row=_25e4&&_25e4.rows[inRow];
return row&&row.cells[inCol];
},_findOverlappingNodes:function(_25e5,inRow,inCol){
var nodes=[];
var m=this.getMapCoords(inRow,inCol);
for(var j=0,row;(row=this.map[j]);j++){
if(j==m.j){
continue;
}
var rw=row[m.i];
var n=(rw?this.getNode(_25e5,rw.r,rw.c):null);
if(n){
nodes.push(n);
}
}
return nodes;
},findOverlappingNodes:function(_25e6){
return this._findOverlappingNodes(_25b4(_25e6),_25b2(_25e6.parentNode),_25b1(_25e6));
}});
return {_Builder:_25bc,_HeaderBuilder:_25d0,_ContentBuilder:_25cc};
});
},"davinci/html/HTMLModel":function(){
define("davinci/html/HTMLModel",["dojo/_base/declare","davinci/model/Model"],function(_25e7,Model){
if(!davinci.html){
davinci.html={};
}
davinci.html._noFormatElements={span:true,b:true,it:true};
davinci.html.escapeXml=function(value){
if(!value){
return value;
}
return value.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;");
};
davinci.html.unEscapeXml=function(value){
if(!value||typeof value!=="string"){
return value;
}
return value.replace(/&quot;/g,"\"").replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/&amp;/g,"&");
};
return _25e7("davinci.html.HTMLModel",Model,{});
});
},"davinci/ve/actions/SelectParentAction":function(){
define(["dojo/_base/declare","davinci/ve/actions/_SelectAncestorAction"],function(_25e8,_25e9){
return _25e8("davinci.ve.actions.SelectParentAction",[_25e9],{run:function(_25ea){
_25ea=this.fixupContext(_25ea);
var _25eb=(_25ea&&_25ea.getSelection());
if(this.selectionSameParentNotBody(_25eb)){
_25ea.select(_25eb[0].getParent());
}
},isEnabled:function(_25ec){
_25ec=this.fixupContext(_25ec);
var _25ed=(_25ec&&_25ec.getSelection());
return this.selectionSameParentNotBody(_25ed);
}});
});
},"url:davinci/ui/templates/NewProject.html":"<div>\n\t<div class=\"dijitDialogPaneContentArea\">\n\t\t<table>\n\t\t<tr>\n\t\t<td class=\"NewProjectDialogLabel\">${newProjectName}</td><td><input class='templateInput' data-dojo-type=\"dijit.form.ValidationTextBox\" type='text' dojoAttachPoint=\"_projectName\"></input></td><td><div dojoAttachPoint='_error4'></div></td>\n\t\t</tr>\n\t\t\n\t\t<td class=\"NewProjectDialogLabel\">${newProjectEclipseSupport}</td><td><input class='templateInput' type='checkbox' dojoAttachPoint=\"_eclipseSupport\"></input></td><td><div dojoAttachPoint='_error5'></div></td>\n\t\t</table>\n\t</div>\n\n\t<div class=\"dijitDialogPaneActionBar\">\n\t\t<button dojoType='dijit.form.Button' dojoAttachPoint=\"_okButton\" dojoAttachEvent='onClick:okButton' label='${create}' class=\"maqPrimaryButton\" type=\"submit\" disabled></button>\n\t\t<button dojoType='dijit.form.Button' dojoAttachEvent='onClick:cancelButton' label='${buttonCancel}' class=\"maqSecondaryButton\"></button>\n\t</div>\n\t\t\n</div>","dojo/date":function(){
define("dojo/date",["./has","./_base/lang"],function(has,lang){
var date={};
date.getDaysInMonth=function(_25ee){
var month=_25ee.getMonth();
var days=[31,28,31,30,31,30,31,31,30,31,30,31];
if(month==1&&date.isLeapYear(_25ee)){
return 29;
}
return days[month];
};
date.isLeapYear=function(_25ef){
var year=_25ef.getFullYear();
return !(year%400)||(!(year%4)&&!!(year%100));
};
date.getTimezoneName=function(_25f0){
var str=_25f0.toString();
var tz="";
var match;
var pos=str.indexOf("(");
if(pos>-1){
tz=str.substring(++pos,str.indexOf(")"));
}else{
var pat=/([A-Z\/]+) \d{4}$/;
if((match=str.match(pat))){
tz=match[1];
}else{
str=_25f0.toLocaleString();
pat=/ ([A-Z\/]+)$/;
if((match=str.match(pat))){
tz=match[1];
}
}
}
return (tz=="AM"||tz=="PM")?"":tz;
};
date.compare=function(date1,date2,_25f1){
date1=new Date(+date1);
date2=new Date(+(date2||new Date()));
if(_25f1=="date"){
date1.setHours(0,0,0,0);
date2.setHours(0,0,0,0);
}else{
if(_25f1=="time"){
date1.setFullYear(0,0,0);
date2.setFullYear(0,0,0);
}
}
if(date1>date2){
return 1;
}
if(date1<date2){
return -1;
}
return 0;
};
date.add=function(date,_25f2,_25f3){
var sum=new Date(+date);
var _25f4=false;
var _25f5="Date";
switch(_25f2){
case "day":
break;
case "weekday":
var days,weeks;
var mod=_25f3%5;
if(!mod){
days=(_25f3>0)?5:-5;
weeks=(_25f3>0)?((_25f3-5)/5):((_25f3+5)/5);
}else{
days=mod;
weeks=parseInt(_25f3/5);
}
var strt=date.getDay();
var adj=0;
if(strt==6&&_25f3>0){
adj=1;
}else{
if(strt==0&&_25f3<0){
adj=-1;
}
}
var trgt=strt+days;
if(trgt==0||trgt==6){
adj=(_25f3>0)?2:-2;
}
_25f3=(7*weeks)+days+adj;
break;
case "year":
_25f5="FullYear";
_25f4=true;
break;
case "week":
_25f3*=7;
break;
case "quarter":
_25f3*=3;
case "month":
_25f4=true;
_25f5="Month";
break;
default:
_25f5="UTC"+_25f2.charAt(0).toUpperCase()+_25f2.substring(1)+"s";
}
if(_25f5){
sum["set"+_25f5](sum["get"+_25f5]()+_25f3);
}
if(_25f4&&(sum.getDate()<date.getDate())){
sum.setDate(0);
}
return sum;
};
date.difference=function(date1,date2,_25f6){
date2=date2||new Date();
_25f6=_25f6||"day";
var _25f7=date2.getFullYear()-date1.getFullYear();
var delta=1;
switch(_25f6){
case "quarter":
var m1=date1.getMonth();
var m2=date2.getMonth();
var q1=Math.floor(m1/3)+1;
var q2=Math.floor(m2/3)+1;
q2+=(_25f7*4);
delta=q2-q1;
break;
case "weekday":
var days=Math.round(date.difference(date1,date2,"day"));
var weeks=parseInt(date.difference(date1,date2,"week"));
var mod=days%7;
if(mod==0){
days=weeks*5;
}else{
var adj=0;
var aDay=date1.getDay();
var bDay=date2.getDay();
weeks=parseInt(days/7);
mod=days%7;
var _25f8=new Date(date1);
_25f8.setDate(_25f8.getDate()+(weeks*7));
var _25f9=_25f8.getDay();
if(days>0){
switch(true){
case aDay==6:
adj=-1;
break;
case aDay==0:
adj=0;
break;
case bDay==6:
adj=-1;
break;
case bDay==0:
adj=-2;
break;
case (_25f9+mod)>5:
adj=-2;
}
}else{
if(days<0){
switch(true){
case aDay==6:
adj=0;
break;
case aDay==0:
adj=1;
break;
case bDay==6:
adj=2;
break;
case bDay==0:
adj=1;
break;
case (_25f9+mod)<0:
adj=2;
}
}
}
days+=adj;
days-=(weeks*2);
}
delta=days;
break;
case "year":
delta=_25f7;
break;
case "month":
delta=(date2.getMonth()-date1.getMonth())+(_25f7*12);
break;
case "week":
delta=parseInt(date.difference(date1,date2,"day")/7);
break;
case "day":
delta/=24;
case "hour":
delta/=60;
case "minute":
delta/=60;
case "second":
delta/=1000;
case "millisecond":
delta*=date2.getTime()-date1.getTime();
}
return Math.round(delta);
};
1&&lang.mixin(lang.getObject("dojo.date",true),date);
return date;
});
},"dojox/grid/cells":function(){
define("dojox/grid/cells",["../main","./cells/_base"],function(dojox){
return dojox.grid.cells;
});
},"davinci/ve/ve.plugin":function(){
define("davinci/ve/ve.plugin",["require"],function(_25fa){
return {id:"davinci.ve","davinci.view":[{id:"Palette",title:"Palette",viewClass:"davinci/ve/palette/HtmlWidgets",iconClass:"paletteIcon paletteIconWidgets"},{id:"states",title:"Scenes",viewClass:"davinci/ve/views/StatesView",iconClass:"paletteIcon paletteIconStates"},{id:"object",title:"Object",viewClass:"davinci/ve/views/ObjectView"},{id:"style",title:"",viewClass:"davinci/ve/views/SwitchingStyleView"}],"davinci.perspective":[{id:"pageDesign",title:"Page Design",views:[{viewID:"davinci.ve.Palette",position:"left",selected:true},{viewID:"davinci.ui.outline",position:"left"},{viewID:"davinci.ve.style",position:"right"},{viewID:"davinci.ui.comment",position:"right",hidden:true},{viewID:"davinci.ve.states",position:"right-bottom",selected:true},{viewID:"davinci.ui.navigator",position:"left-bottom",selected:true},{viewID:"davinci.review.reviewNavigator",position:"left-bottom"}]}],"davinci.editor":[{id:"HTMLPageEditor",name:"HTML Visual Editor",extensions:["html","htm","php"],isDefault:true,editorClass:"davinci/ve/PageEditor",palettePerspective:"davinci.ve.pageDesign",expandPalettes:["left"]}],"davinci.actionSets":[{id:"cutCopyPaste",visible:true,actions:[{label:"Cut",keySequence:"M1+X",iconClass:"editActionIcon editCutIconSmall",action:"davinci/ve/actions/CutAction",menubarPath:"davinci.edit/cut"},{label:"Copy",keySequence:"M1+C",iconClass:"editActionIcon editCopyIconSmall",action:"davinci/ve/actions/CopyAction",menubarPath:"davinci.edit/cut"},{keySequence:"M1+V",iconClass:"editActionIcon editPasteIconSmall",label:"Paste",action:"davinci/ve/actions/PasteAction",menubarPath:"davinci.edit/cut"},{keySequence:"DEL",iconClass:"editActionIcon editDeleteIconSmall",label:"Delete",action:"davinci/ve/actions/DeleteAction",menubarPath:"davinci.edit/cut"},{iconClass:"editActionIcon selectParentIconSmall",label:"Select parent",action:"davinci/ve/actions/SelectParentAction",menubarPath:"davinci.edit/cut"},{iconClass:"editActionIcon selectAncestorIconSmall",label:"Select ancestor...",action:"davinci/ve/actions/SelectAncestorAction",menubarPath:"davinci.edit/cut"},{iconClass:"editActionIcon unselectAllIconSmall",label:"Unselect all",action:"davinci/ve/actions/UnselectAllAction",menubarPath:"davinci.edit/cut"},{iconClass:"editActionIcon",label:"Surround with &lt;A&gt;",action:"davinci/ve/actions/SurroundAction",surroundWithTagName:"a",menubarPath:"davinci.edit/cut"},{iconClass:"editActionIcon",label:"Surround with &lt;DIV&gt;",action:"davinci/ve/actions/SurroundAction",surroundWithTagName:"div",menubarPath:"davinci.edit/cut"},{iconClass:"editActionIcon",label:"Surround with &lt;SPAN&gt;",action:"davinci/ve/actions/SurroundAction",surroundWithTagName:"span",menubarPath:"davinci.edit/cut"},{iconClass:"editActionIcon moveToFrontIconSmall",label:"Move to front",action:"davinci/ve/actions/MoveToFrontAction",menubarPath:"davinci.edit/cut"},{iconClass:"editActionIcon moveForwardIconSmall",label:"Move forward",action:"davinci/ve/actions/MoveForwardAction",menubarPath:"davinci.edit/cut"},{iconClass:"editActionIcon moveBackwardIconSmall",label:"Move backward",action:"davinci/ve/actions/MoveBackwardAction",menubarPath:"davinci.edit/cut"},{iconClass:"editActionIcon moveToBackIconSmall",label:"Move to back",action:"davinci/ve/actions/MoveToBackAction",menubarPath:"davinci.edit/cut"}]},{id:"datastoreActions",visible:true,actions:[{id:"davinci.ui.generateform",label:"Generate Form",run:function(){
_25fa("davinci/ve/views/DataStoresView").generateForm();
},menubarPath:"newfile"},{id:"davinci.ui.generateform",label:"Generate Table",run:function(){
_25fa("davinci/ve/views/DataStoresView").generateTable();
},menubarPath:"newfile"}]}],"davinci.viewActions":[{viewContribution:{targetID:"davinci.ve.outline",actions:[{id:"design",iconClass:"designModeIcon editActionIcon",radioGroup:"displayMode",method:"switchDisplayMode",label:"Widgets",toolbarPath:"displayMode"},{id:"source",iconClass:"sourceModeIcon editActionIcon",method:"switchDisplayMode",radioGroup:"displayMode",label:"Source",toolbarPath:"displayMode"}]}},{viewContribution:{targetID:"davinci.ve.states",actions:[{id:"addState",iconClass:"viewActionIcon addStateIcon",action:"davinci/ve/actions/AddState",label:"Add State",toolbarPath:"states1"},{id:"removeState",iconClass:"viewActionIcon removeStateIcon",action:"davinci/ve/actions/RemoveState",label:"Remove State",toolbarPath:"states1"},{id:"modifyState",iconClass:"viewActionIcon modifyStateIcon",action:"davinci/ve/actions/ModifyState",label:"Modify State",toolbarPath:"states1"}]}}],"davinci.actionSetPartAssociations":[{targetID:"davinci.ve.cutCopyPaste",parts:["davinci.ve.visualEditor","davinci.ve.VisualEditorOutline"]}],"davinci.editorActions":{editorContribution:{targetID:"davinci.ve.HTMLPageEditor",actions:[{id:"savecombo",className:"maqLabelButton",showLabel:true,label:"Save",toolbarPath:"save",type:"ComboButton",run:function(){
_25fa(["../Workbench"],function(_25fb){
_25fa("../ui/Resource").save();
});
},isEnabled:function(_25fc){
return _25fa("../Workbench").getOpenEditor();
},menu:[{iconClass:"saveIcon",run:function(){
_25fa("../ui/Resource").save();
},isEnabled:function(_25fd){
return _25fa("../Workbench").getOpenEditor();
},label:"Save",keyBinding:{accel:true,charOrCode:"s",allowGlobal:true}},{iconClass:"saveAsIcon",run:function(){
_25fa("../ui/Resource").saveAs("html");
},isEnabled:function(_25fe){
return _25fa("../Workbench").getOpenEditor();
},label:"Save As",keyBinding:{accel:true,shift:true,charOrCode:"s",allowGlobal:true}},{id:"saveasdijit",iconClass:"saveAsDijitIcon",run:function(){
return _25fa(["davinci/de/resource"],function(r){
r.createDijiFromNewDialog();
});
},isEnabled:function(_25ff){
return _25fa("../Workbench").getOpenEditor();
},label:"Save As Widget"},]},{id:"undo",iconClass:"editActionIcon undoIcon",action:"davinci/actions/UndoAction",label:"Undo",toolbarPath:"undoredo",keyBinding:{accel:true,charOrCode:"z"}},{id:"redo",iconClass:"editActionIcon redoIcon",action:"davinci/actions/RedoAction",label:"Redo",toolbarPath:"undoredo",keyBinding:{accel:true,shift:true,charOrCode:"z"}},{id:"cut",label:"Cut",iconClass:"editActionIcon editCutIcon",action:"davinci/ve/actions/CutAction",toolbarPath:"cutcopypaste",keyBinding:{accel:true,charOrCode:"x"}},{id:"copy",label:"Copy",iconClass:"editActionIcon editCopyIcon",action:"davinci/ve/actions/CopyAction",toolbarPath:"cutcopypaste",keyBinding:{accel:true,charOrCode:"c"}},{label:"Paste",iconClass:"editActionIcon editPasteIcon",action:"davinci/ve/actions/PasteAction",toolbarPath:"cutcopypaste",keyBinding:{accel:true,charOrCode:"v"}},{id:"delete",iconClass:"editActionIcon editDeleteIcon",label:"Delete",action:"davinci/ve/actions/DeleteAction",toolbarPath:"delete",keyBinding:{charOrCode:[dojo.keys.DELETE,dojo.keys.BACKSPACE]}},{id:"openBrowser",iconClass:"openBrowserIcon",className:"davinciFloatRight openBrowser",run:function(){
_25fa(["../Workbench"],function(_2600){
var _2601=_2600.getOpenEditor();
if(_2601&&_2601.resourceFile){
_2601.previewInBrowser();
}else{
console.error("ERROR. Cannot launch browser window. No editor info.");
}
});
},label:"Preview in Browser",toolbarPath:"undoredo",keyBinding:{accel:true,charOrCode:"0",allowGlobal:true}},{id:"documentSettings",iconClass:"documentSettingsIcon",className:"documentSettings davinciFloatRight",label:"Document settings",toolbarPath:"undoredo",type:"DropDownButton",menu:[{id:"theme",iconClass:"selectThemeIcon",className:"davinciFloatRight",action:"davinci/actions/SelectThemeAction",label:"Switch theme"},{id:"chooseDevice",iconClass:"deviceIcon",className:"davinciFloatRight",action:"davinci/ve/actions/ChooseDeviceAction",label:"Choose device"},{id:"rotateDevice",iconClass:"rotateIcon",className:"davinciFloatRight",action:"davinci/ve/actions/RotateDeviceAction",label:"Rotate device"},{iconClass:"editActionIcon",label:"Select parent",action:"davinci/ve/actions/SelectParentAction"},{iconClass:"editActionIcon",label:"Select ancestor...",action:"davinci/ve/actions/SelectAncestorAction"},{iconClass:"editActionIcon",label:"Unselect all",action:"davinci/ve/actions/UnselectAllAction"},{iconClass:"editActionIcon",label:"Move to front",action:"davinci/ve/actions/MoveToFrontAction"},{iconClass:"editActionIcon",label:"Move forward",action:"davinci/ve/actions/MoveForwardAction"},{iconClass:"editActionIcon",label:"Move backward",action:"davinci/ve/actions/MoveBackwardAction"},{iconClass:"editActionIcon",label:"Move to back",action:"davinci/ve/actions/MoveToBackAction"},{iconClass:"editActionIcon",label:"Surround with &lt;A&gt;",action:"davinci/ve/actions/SurroundAction",surroundWithTagName:"a"},{iconClass:"editActionIcon",label:"Surround with &lt;DIV&gt;",action:"davinci/ve/actions/SurroundAction",surroundWithTagName:"div"},{iconClass:"editActionIcon",label:"Surround with &lt;SPAN&gt;",action:"davinci/ve/actions/SurroundAction",surroundWithTagName:"span"}]},{id:"stickynote",iconClass:"stickynoteIcon",action:"davinci/actions/StickyNoteAction",label:"Add note",toolbarPath:"stickynote"},{id:"layout",className:"maqLabelButton davinciFloatRight maqLayoutDropDownButton",showLabel:true,label:"Flow",toolbarPath:"undoredo",type:"DropDownButton",menu:[{label:"Flow",iconClass:"flowLayoutIcon",method:"selectLayoutFlow"},{label:"Absolute",iconClass:"absoluteLayoutIcon",method:"selectLayoutAbsolute"}]},{id:"sourcecombo",className:"maqLabelButton davinciFloatRight maqSourceComboButton",showLabel:true,label:"Source",action:"davinci/ve/actions/ViewSourceAction",toolbarPath:"undoredo",type:"ComboButton",menu:[{keyBinding:{accel:true,charOrCode:"2",allowGlobal:true},iconClass:"editActionIcon sourceModeIcon sourceMenuIcon",action:"davinci/ve/actions/ViewSourceMenuAction",label:"Source only"},{keyBinding:{accel:true,charOrCode:"3",allowGlobal:true},iconClass:"editActionIcon splitVerticalIcon sourceMenuIcon",action:"davinci/ve/actions/ViewSplitVMenuAction",label:"Split Vertically"},{keyBinding:{accel:true,charOrCode:"4",allowGlobal:true},iconClass:"editActionIcon splitHorizontalIcon sourceMenuIcon",action:"davinci/ve/actions/ViewSplitHMenuAction",label:"Split Horizontally"}]},{id:"design",showLabel:true,className:"maqLabelButton davinciFloatRight maqDesignButton",action:"davinci/ve/actions/ViewDesignAction",label:"Design",toolbarPath:"undoredo",keyBinding:{accel:true,charOrCode:"1",allowGlobal:true}},{id:"closeactiveeditor",run:function(){
_25fa(["../Workbench"],function(_2602){
_2602.closeActiveEditor();
});
},keyBinding:{accel:true,shift:true,charOrCode:"w",allowGlobal:true}},{id:"showWidgetsPalette",run:function(){
var tab=dijit.byId("davinci.ve.Palette");
if(tab){
var _2603=tab.getParent();
if(_2603){
_2603.selectChild(tab);
}
}
},keyBinding:{meta:true,charOrCode:"p",allowGlobal:true}}]}},"davinci.preferences":[{name:"Visual Editor",id:"editorPrefs",category:"davinci.html.general",pane:"davinci/ve/prefs/HTMLEditPreferences",defaultValues:{"flowLayout":true,"snap":true,"showPossibleParents":false,"cssOverrideWarn":true,"absoluteWidgetsZindex":900}}],"davinci.dnd":[{parts:["davinci.ui.navigator"],dragSource:function(_2604){
if(_2604.elementType=="File"){
return (/gif|jpeg|jpg|png|svg|json/i).test(_2604.getExtension());
}
},dragHandler:"davinci/ve/palette/ImageDragSource"}],"davinci.fileType":[{extension:"theme",iconClass:"themeFileIcon",type:"text"}],"davinci.defaultEditorActions":{editorContribution:{actions:[{id:"save",run:function(){
_25fa("../Workbench").getOpenEditor().save();
},isEnabled:function(_2605){
return true;
},className:"maqLabelButton",showLabel:true,label:"Save",toolbarPath:"save",keyBinding:{accel:true,charOrCode:"s"}},{id:"undo",iconClass:"editActionIcon undoIcon",action:"davinci/actions/UndoAction",label:"Undo",toolbarPath:"undoredo",keyBinding:{accel:true,charOrCode:"z"}},{id:"redo",iconClass:"editActionIcon redoIcon",action:"davinci/actions/RedoAction",label:"Redo",toolbarPath:"undoredo",keyBinding:{accel:true,shift:true,charOrCode:"z"}}]}}};
});
},"dojox/html/_base":function(){
define("dojox/html/_base",["dojo/_base/declare","dojo/Deferred","dojo/dom-construct","dojo/html","dojo/_base/kernel","dojo/_base/lang","dojo/ready","dojo/_base/sniff","dojo/_base/url","dojo/_base/xhr","dojo/when","dojo/_base/window"],function(_2606,_2607,_2608,_2609,_260a,lang,ready,has,_260b,_260c,when,_260d){
var html=_260a.getObject("dojox.html",true);
if(has("ie")){
var _260e=/(AlphaImageLoader\([^)]*?src=(['"]))(?![a-z]+:|\/)([^\r\n;}]+?)(\2[^)]*\)\s*[;}]?)/g;
}
var _260f=/(?:(?:@import\s*(['"])(?![a-z]+:|\/)([^\r\n;{]+?)\1)|url\(\s*(['"]?)(?![a-z]+:|\/)([^\r\n;]+?)\3\s*\))([a-z, \s]*[;}]?)/g;
var _2610=html._adjustCssPaths=function(_2611,_2612){
if(!_2612||!_2611){
return;
}
if(_260e){
_2612=_2612.replace(_260e,function(_2613,pre,delim,url,post){
return pre+(new _260b(_2611,"./"+url).toString())+post;
});
}
return _2612.replace(_260f,function(_2614,_2615,_2616,_2617,_2618,media){
if(_2616){
return "@import \""+(new _260b(_2611,"./"+_2616).toString())+"\""+media;
}else{
return "url("+(new _260b(_2611,"./"+_2618).toString())+")"+media;
}
});
};
var _2619=/(<[a-z][a-z0-9]*\s[^>]*)(?:(href|src)=(['"]?)([^>]*?)\3|style=(['"]?)([^>]*?)\5)([^>]*>)/gi;
var _261a=html._adjustHtmlPaths=function(_261b,cont){
var url=_261b||"./";
return cont.replace(_2619,function(tag,start,name,delim,_261c,_261d,_261e,end){
return start+(name?(name+"="+delim+(new _260b(url,_261c).toString())+delim):("style="+_261d+_2610(url,_261e)+_261d))+end;
});
};
var _261f=html._snarfStyles=function(_2620,cont,_2621){
_2621.attributes=[];
cont=cont.replace(/<[!][-][-](.|\s)*?[-][-]>/g,function(_2622){
return _2622.replace(/<(\/?)style\b/ig,"&lt;$1Style").replace(/<(\/?)link\b/ig,"&lt;$1Link").replace(/@import "/ig,"@ import \"");
});
return cont.replace(/(?:<style([^>]*)>([\s\S]*?)<\/style>|<link\s+(?=[^>]*rel=['"]?stylesheet)([^>]*?href=(['"])([^>]*?)\4[^>\/]*)\/?>)/gi,function(_2623,_2624,_2625,_2626,delim,href){
var i,attr=(_2624||_2626||"").replace(/^\s*([\s\S]*?)\s*$/i,"$1");
if(_2625){
i=_2621.push(_2620?_2610(_2620,_2625):_2625);
}else{
i=_2621.push("@import \""+href+"\";");
attr=attr.replace(/\s*(?:rel|href)=(['"])?[^\s]*\1\s*/gi,"");
}
if(attr){
attr=attr.split(/\s+/);
var atObj={},tmp;
for(var j=0,e=attr.length;j<e;j++){
tmp=attr[j].split("=");
atObj[tmp[0]]=tmp[1].replace(/^\s*['"]?([\s\S]*?)['"]?\s*$/,"$1");
}
_2621.attributes[i-1]=atObj;
}
return "";
});
};
var _2627=html._snarfScripts=function(cont,byRef){
byRef.code="";
cont=cont.replace(/<[!][-][-](.|\s)*?[-][-]>/g,function(_2628){
return _2628.replace(/<(\/?)script\b/ig,"&lt;$1Script");
});
function _2629(src){
if(byRef.downloadRemote){
src=src.replace(/&([a-z0-9#]+);/g,function(m,name){
switch(name){
case "amp":
return "&";
case "gt":
return ">";
case "lt":
return "<";
default:
return name.charAt(0)=="#"?String.fromCharCode(name.substring(1)):"&"+name+";";
}
});
_260c.get({url:src,sync:true,load:function(code){
byRef.code+=code+";";
},error:byRef.errBack});
}
};
return cont.replace(/<script\s*(?![^>]*type=['"]?(?:dojo\/|text\/html\b))[^>]*?(?:src=(['"]?)([^>]*?)\1[^>]*)?>([\s\S]*?)<\/script>/gi,function(_262a,delim,src,code){
if(src){
_2629(src);
}else{
byRef.code+=code;
}
return "";
});
};
var _262b=html.evalInGlobal=function(code,_262c){
_262c=_262c||_260d.doc.body;
var n=_262c.ownerDocument.createElement("script");
n.type="text/javascript";
_262c.appendChild(n);
n.text=code;
};
html._ContentSetter=_2606(_2609._ContentSetter,{adjustPaths:false,referencePath:".",renderStyles:false,executeScripts:false,scriptHasHooks:false,scriptHookReplacement:null,_renderStyles:function(_262d){
this._styleNodes=[];
var st,att,_262e,doc=this.node.ownerDocument;
var head=doc.getElementsByTagName("head")[0];
for(var i=0,e=_262d.length;i<e;i++){
_262e=_262d[i];
att=_262d.attributes[i];
st=doc.createElement("style");
st.setAttribute("type","text/css");
for(var x in att){
st.setAttribute(x,att[x]);
}
this._styleNodes.push(st);
head.appendChild(st);
if(st.styleSheet){
st.styleSheet.cssText=_262e;
}else{
st.appendChild(doc.createTextNode(_262e));
}
}
},empty:function(){
this.inherited("empty",arguments);
this._styles=[];
},onBegin:function(){
this.inherited("onBegin",arguments);
var cont=this.content,node=this.node;
var _262f=this._styles;
if(lang.isString(cont)){
if(this.adjustPaths&&this.referencePath){
cont=_261a(this.referencePath,cont);
}
if(this.renderStyles||this.cleanContent){
cont=_261f(this.referencePath,cont,_262f);
}
if(this.executeScripts){
var _2630=this;
var byRef={downloadRemote:true,errBack:function(e){
_2630._onError.call(_2630,"Exec","Error downloading remote script in \""+_2630.id+"\"",e);
}};
cont=_2627(cont,byRef);
this._code=byRef.code;
}
}
this.content=cont;
},onEnd:function(){
var code=this._code,_2631=this._styles;
if(this._styleNodes&&this._styleNodes.length){
while(this._styleNodes.length){
_2608.destroy(this._styleNodes.pop());
}
}
if(this.renderStyles&&_2631&&_2631.length){
this._renderStyles(_2631);
}
if(this.executeScripts&&code){
if(this.cleanContent){
code=code.replace(/(<!--|(?:\/\/)?-->|<!\[CDATA\[|\]\]>)/g,"");
}
if(this.scriptHasHooks){
code=code.replace(/_container_(?!\s*=[^=])/g,this.scriptHookReplacement);
}
try{
_262b(code,this.node);
}
catch(e){
this._onError("Exec","Error eval script in "+this.id+", "+e.message,e);
}
}
var _2632=this.getInherited(arguments),args=arguments,d=new _2607();
ready(lang.hitch(this,function(){
_2632.apply(this,args);
when(this.parseDeferred,function(){
d.resolve();
});
}));
return d.promise;
},tearDown:function(){
this.inherited(arguments);
delete this._styles;
if(this._styleNodes&&this._styleNodes.length){
while(this._styleNodes.length){
_2608.destroy(this._styleNodes.pop());
}
}
delete this._styleNodes;
lang.mixin(this,html._ContentSetter.prototype);
}});
html.set=function(node,cont,_2633){
if(!_2633){
return _2609._setNodeContent(node,cont,true);
}else{
var op=new html._ContentSetter(lang.mixin(_2633,{content:cont,node:node}));
return op.set();
}
};
return html;
});
},"dijit/_KeyNavContainer":function(){
define("dijit/_KeyNavContainer",["dojo/_base/kernel","./_Container","./_FocusMixin","dojo/_base/array","dojo/keys","dojo/_base/declare","dojo/_base/event","dojo/dom-attr","dojo/_base/lang"],function(_2634,_2635,_2636,array,keys,_2637,event,_2638,lang){
return _2637("dijit._KeyNavContainer",[_2636,_2635],{tabIndex:"0",connectKeyNavHandlers:function(_2639,_263a){
var _263b=(this._keyNavCodes={});
var prev=lang.hitch(this,"focusPrev");
var next=lang.hitch(this,"focusNext");
array.forEach(_2639,function(code){
_263b[code]=prev;
});
array.forEach(_263a,function(code){
_263b[code]=next;
});
_263b[keys.HOME]=lang.hitch(this,"focusFirstChild");
_263b[keys.END]=lang.hitch(this,"focusLastChild");
this.connect(this.domNode,"onkeypress","_onContainerKeypress");
this.connect(this.domNode,"onfocus","_onContainerFocus");
},startupKeyNavChildren:function(){
_2634.deprecated("startupKeyNavChildren() call no longer needed","","2.0");
},startup:function(){
this.inherited(arguments);
array.forEach(this.getChildren(),lang.hitch(this,"_startupChild"));
},addChild:function(_263c,_263d){
this.inherited(arguments);
this._startupChild(_263c);
},focus:function(){
this.focusFirstChild();
},focusFirstChild:function(){
this.focusChild(this._getFirstFocusableChild());
},focusLastChild:function(){
this.focusChild(this._getLastFocusableChild());
},focusNext:function(){
this.focusChild(this._getNextFocusableChild(this.focusedChild,1));
},focusPrev:function(){
this.focusChild(this._getNextFocusableChild(this.focusedChild,-1),true);
},focusChild:function(_263e,last){
if(!_263e){
return;
}
if(this.focusedChild&&_263e!==this.focusedChild){
this._onChildBlur(this.focusedChild);
}
_263e.set("tabIndex",this.tabIndex);
_263e.focus(last?"end":"start");
this._set("focusedChild",_263e);
},_startupChild:function(_263f){
_263f.set("tabIndex","-1");
this.connect(_263f,"_onFocus",function(){
_263f.set("tabIndex",this.tabIndex);
});
this.connect(_263f,"_onBlur",function(){
_263f.set("tabIndex","-1");
});
},_onContainerFocus:function(evt){
if(evt.target!==this.domNode||this.focusedChild){
return;
}
this.focusFirstChild();
_2638.set(this.domNode,"tabIndex","-1");
},_onBlur:function(evt){
if(this.tabIndex){
_2638.set(this.domNode,"tabIndex",this.tabIndex);
}
this.focusedChild=null;
this.inherited(arguments);
},_onContainerKeypress:function(evt){
if(evt.ctrlKey||evt.altKey){
return;
}
var func=this._keyNavCodes[evt.charOrCode];
if(func){
func();
event.stop(evt);
}
},_onChildBlur:function(){
},_getFirstFocusableChild:function(){
return this._getNextFocusableChild(null,1);
},_getLastFocusableChild:function(){
return this._getNextFocusableChild(null,-1);
},_getNextFocusableChild:function(child,dir){
if(child){
child=this._getSiblingOfChild(child,dir);
}
var _2640=this.getChildren();
for(var i=0;i<_2640.length;i++){
if(!child){
child=_2640[(dir>0)?0:(_2640.length-1)];
}
if(child.isFocusable()){
return child;
}
child=this._getSiblingOfChild(child,dir);
}
return null;
}});
});
},"davinci/review/actions/DeleteVersionAction":function(){
define(["dojo/_base/declare","./_ReviewNavigatorCommon","davinci/Runtime","dojox/widget/Toaster","dojo/i18n!./nls/actions"],function(_2641,_2642,_2643,_2644,nls){
var _2645=_2641("davinci.review.actions.DeleteVersionAction",[_2642],{run:function(_2646){
var _2647=this._getSelection(_2646);
if(!_2647||!_2647.length){
return;
}
okToClose=confirm(nls.areYouSureDelete);
if(!okToClose){
return;
}
var item=_2647[0].resource.elementType=="ReviewFile"?_2647[0].resource.parent:_2647[0].resource;
var _2648=davinci.Workbench.location()+"cmd/managerVersion";
dojo.xhrGet({url:_2648,sync:false,handleAs:"text",content:{"type":"delete","vTime":item.timeStamp}}).then(function(_2649){
if(_2649=="OK"){
if(typeof hasToaster=="undefined"){
new _2644({position:"br-left",duration:4000,messageTopic:"/davinci/review/resourceChanged"});
hasToaster=true;
}
dojo.publish("/davinci/review/resourceChanged",[{message:nls.deleteSuccessful,type:"message"},"delete",item]);
for(var i=0;i<item.children.length;i++){
dojo.publish("/davinci/resource/resourceChanged",["deleted",item.children[i]]);
}
}
});
},isEnabled:function(_264a){
var _264b=this._getSelection(_264a);
if(_264b&&_264b.length>0){
var item=_264b[0].resource.elementType=="ReviewFile"?_264b[0].resource.parent:_264b[0].resource;
if(item.designerId==davinci.Runtime.userName){
return true;
}
}
return false;
}});
return _2645;
});
},"dijit/form/ComboButton":function(){
require({cache:{"url:dijit/form/templates/ComboButton.html":"<table class=\"dijit dijitReset dijitInline dijitLeft\"\n\tcellspacing='0' cellpadding='0' role=\"presentation\"\n\t><tbody role=\"presentation\"><tr role=\"presentation\"\n\t\t><td class=\"dijitReset dijitStretch dijitButtonNode\" data-dojo-attach-point=\"buttonNode\" data-dojo-attach-event=\"ondijitclick:_onClick,onkeypress:_onButtonKeyPress\"\n\t\t><div id=\"${id}_button\" class=\"dijitReset dijitButtonContents\"\n\t\t\tdata-dojo-attach-point=\"titleNode\"\n\t\t\trole=\"button\" aria-labelledby=\"${id}_label\"\n\t\t\t><div class=\"dijitReset dijitInline dijitIcon\" data-dojo-attach-point=\"iconNode\" role=\"presentation\"></div\n\t\t\t><div class=\"dijitReset dijitInline dijitButtonText\" id=\"${id}_label\" data-dojo-attach-point=\"containerNode\" role=\"presentation\"></div\n\t\t></div\n\t\t></td\n\t\t><td id=\"${id}_arrow\" class='dijitReset dijitRight dijitButtonNode dijitArrowButton'\n\t\t\tdata-dojo-attach-point=\"_popupStateNode,focusNode,_buttonNode\"\n\t\t\tdata-dojo-attach-event=\"onkeypress:_onArrowKeyPress\"\n\t\t\ttitle=\"${optionsTitle}\"\n\t\t\trole=\"button\" aria-haspopup=\"true\"\n\t\t\t><div class=\"dijitReset dijitArrowButtonInner\" role=\"presentation\"></div\n\t\t\t><div class=\"dijitReset dijitArrowButtonChar\" role=\"presentation\">&#9660;</div\n\t\t></td\n\t\t><td style=\"display:none !important;\"\n\t\t\t><input ${!nameAttrSetting} type=\"${type}\" value=\"${value}\" data-dojo-attach-point=\"valueNode\" role=\"presentation\"\n\t\t/></td></tr></tbody\n></table>\n"}});
define("dijit/form/ComboButton",["dojo/_base/declare","dojo/_base/event","dojo/keys","../focus","./DropDownButton","dojo/text!./templates/ComboButton.html"],function(_264c,event,keys,focus,_264d,_264e){
return _264c("dijit.form.ComboButton",_264d,{templateString:_264e,_setIdAttr:"",_setTabIndexAttr:["focusNode","titleNode"],_setTitleAttr:"titleNode",optionsTitle:"",baseClass:"dijitComboButton",cssStateNodes:{"buttonNode":"dijitButtonNode","titleNode":"dijitButtonContents","_popupStateNode":"dijitDownArrowButton"},_focusedNode:null,_onButtonKeyPress:function(evt){
if(evt.charOrCode==keys[this.isLeftToRight()?"RIGHT_ARROW":"LEFT_ARROW"]){
focus.focus(this._popupStateNode);
event.stop(evt);
}
},_onArrowKeyPress:function(evt){
if(evt.charOrCode==keys[this.isLeftToRight()?"LEFT_ARROW":"RIGHT_ARROW"]){
focus.focus(this.titleNode);
event.stop(evt);
}
},focus:function(_264f){
if(!this.disabled){
focus.focus(_264f=="start"?this.titleNode:this._popupStateNode);
}
}});
});
},"dojox/grid/cells/_base":function(){
define("dojox/grid/cells/_base",["dojo/_base/kernel","dojo/_base/declare","dojo/_base/lang","dojo/_base/event","dojo/_base/connect","dojo/_base/array","dojo/_base/sniff","dojo/dom","dojo/dom-attr","dojo/dom-construct","dijit/_Widget","../util"],function(dojo,_2650,lang,event,_2651,array,has,dom,_2652,_2653,_2654,util){
var _2655=_2650("dojox.grid._DeferredTextWidget",_2654,{deferred:null,_destroyOnRemove:true,postCreate:function(){
if(this.deferred){
this.deferred.addBoth(lang.hitch(this,function(text){
if(this.domNode){
this.domNode.innerHTML=text;
}
}));
}
}});
var _2656=function(_2657){
try{
util.fire(_2657,"focus");
util.fire(_2657,"select");
}
catch(e){
}
};
var _2658=function(){
setTimeout(lang.hitch.apply(dojo,arguments),0);
};
var _2659=_2650("dojox.grid.cells._Base",null,{styles:"",classes:"",editable:false,alwaysEditing:false,formatter:null,defaultValue:"...",value:null,hidden:false,noresize:false,draggable:true,_valueProp:"value",_formatPending:false,constructor:function(_265a){
this._props=_265a||{};
lang.mixin(this,_265a);
if(this.draggable===undefined){
this.draggable=true;
}
},_defaultFormat:function(_265b,_265c){
var s=this.grid.formatterScope||this;
var f=this.formatter;
if(f&&s&&typeof f=="string"){
f=this.formatter=s[f];
}
var v=(_265b!=this.defaultValue&&f)?f.apply(s,_265c):_265b;
if(typeof v=="undefined"){
return this.defaultValue;
}
if(v&&v.addBoth){
v=new _2655({deferred:v},_2653.create("span",{innerHTML:this.defaultValue}));
}
if(v&&v.declaredClass&&v.startup){
return "<div class='dojoxGridStubNode' linkWidget='"+v.id+"' cellIdx='"+this.index+"'>"+this.defaultValue+"</div>";
}
return v;
},format:function(_265d,_265e){
var f,i=this.grid.edit.info,d=this.get?this.get(_265d,_265e):(this.value||this.defaultValue);
d=(d&&d.replace&&this.grid.escapeHTMLInData)?d.replace(/&/g,"&amp;").replace(/</g,"&lt;"):d;
if(this.editable&&(this.alwaysEditing||(i.rowIndex==_265d&&i.cell==this))){
return this.formatEditing(d,_265d);
}else{
return this._defaultFormat(d,[d,_265d,this]);
}
},formatEditing:function(_265f,_2660){
},getNode:function(_2661){
return this.view.getCellNode(_2661,this.index);
},getHeaderNode:function(){
return this.view.getHeaderCellNode(this.index);
},getEditNode:function(_2662){
return (this.getNode(_2662)||0).firstChild||0;
},canResize:function(){
var uw=this.unitWidth;
return uw&&(uw!=="auto");
},isFlex:function(){
var uw=this.unitWidth;
return uw&&lang.isString(uw)&&(uw=="auto"||uw.slice(-1)=="%");
},applyEdit:function(_2663,_2664){
if(this.getNode(_2664)){
this.grid.edit.applyCellEdit(_2663,this,_2664);
}
},cancelEdit:function(_2665){
this.grid.doCancelEdit(_2665);
},_onEditBlur:function(_2666){
if(this.grid.edit.isEditCell(_2666,this.index)){
this.grid.edit.apply();
}
},registerOnBlur:function(_2667,_2668){
if(this.commitOnBlur){
_2651.connect(_2667,"onblur",function(e){
setTimeout(lang.hitch(this,"_onEditBlur",_2668),250);
});
}
},needFormatNode:function(_2669,_266a){
this._formatPending=true;
_2658(this,"_formatNode",_2669,_266a);
},cancelFormatNode:function(){
this._formatPending=false;
},_formatNode:function(_266b,_266c){
if(this._formatPending){
this._formatPending=false;
if(!has("ie")){
dom.setSelectable(this.grid.domNode,true);
}
this.formatNode(this.getEditNode(_266c),_266b,_266c);
}
},formatNode:function(_266d,_266e,_266f){
if(has("ie")){
_2658(this,"focus",_266f,_266d);
}else{
this.focus(_266f,_266d);
}
},dispatchEvent:function(m,e){
if(m in this){
return this[m](e);
}
},getValue:function(_2670){
return this.getEditNode(_2670)[this._valueProp];
},setValue:function(_2671,_2672){
var n=this.getEditNode(_2671);
if(n){
n[this._valueProp]=_2672;
}
},focus:function(_2673,_2674){
_2656(_2674||this.getEditNode(_2673));
},save:function(_2675){
this.value=this.value||this.getValue(_2675);
},restore:function(_2676){
this.setValue(_2676,this.value);
},_finish:function(_2677){
dom.setSelectable(this.grid.domNode,false);
this.cancelFormatNode();
},apply:function(_2678){
this.applyEdit(this.getValue(_2678),_2678);
this._finish(_2678);
},cancel:function(_2679){
this.cancelEdit(_2679);
this._finish(_2679);
}});
_2659.markupFactory=function(node,_267a){
var _267b=lang.trim(_2652.get(node,"formatter")||"");
if(_267b){
_267a.formatter=lang.getObject(_267b)||_267b;
}
var get=lang.trim(_2652.get(node,"get")||"");
if(get){
_267a.get=lang.getObject(get);
}
var _267c=function(attr,cell,_267d){
var value=lang.trim(_2652.get(node,attr)||"");
if(value){
cell[_267d||attr]=!(value.toLowerCase()=="false");
}
};
_267c("sortDesc",_267a);
_267c("editable",_267a);
_267c("alwaysEditing",_267a);
_267c("noresize",_267a);
_267c("draggable",_267a);
var value=lang.trim(_2652.get(node,"loadingText")||_2652.get(node,"defaultValue")||"");
if(value){
_267a.defaultValue=value;
}
var _267e=function(attr,cell,_267f){
var value=lang.trim(_2652.get(node,attr)||"")||undefined;
if(value){
cell[_267f||attr]=value;
}
};
_267e("styles",_267a);
_267e("headerStyles",_267a);
_267e("cellStyles",_267a);
_267e("classes",_267a);
_267e("headerClasses",_267a);
_267e("cellClasses",_267a);
};
var Cell=_2650("dojox.grid.cells.Cell",_2659,{constructor:function(){
this.keyFilter=this.keyFilter;
},keyFilter:null,formatEditing:function(_2680,_2681){
this.needFormatNode(_2680,_2681);
return "<input class=\"dojoxGridInput\" type=\"text\" value=\""+_2680+"\">";
},formatNode:function(_2682,_2683,_2684){
this.inherited(arguments);
this.registerOnBlur(_2682,_2684);
},doKey:function(e){
if(this.keyFilter){
var key=String.fromCharCode(e.charCode);
if(key.search(this.keyFilter)==-1){
event.stop(e);
}
}
},_finish:function(_2685){
this.inherited(arguments);
var n=this.getEditNode(_2685);
try{
util.fire(n,"blur");
}
catch(e){
}
}});
Cell.markupFactory=function(node,_2686){
_2659.markupFactory(node,_2686);
var _2687=lang.trim(_2652.get(node,"keyFilter")||"");
if(_2687){
_2686.keyFilter=new RegExp(_2687);
}
};
var _2688=_2650("dojox.grid.cells.RowIndex",Cell,{name:"Row",postscript:function(){
this.editable=false;
},get:function(_2689){
return _2689+1;
}});
_2688.markupFactory=function(node,_268a){
Cell.markupFactory(node,_268a);
};
var _268b=_2650("dojox.grid.cells.Select",Cell,{options:null,values:null,returnIndex:-1,constructor:function(_268c){
this.values=this.values||this.options;
},formatEditing:function(_268d,_268e){
this.needFormatNode(_268d,_268e);
var h=["<select class=\"dojoxGridSelect\">"];
for(var i=0,o,v;((o=this.options[i])!==undefined)&&((v=this.values[i])!==undefined);i++){
v=v.replace?v.replace(/&/g,"&amp;").replace(/</g,"&lt;"):v;
o=o.replace?o.replace(/&/g,"&amp;").replace(/</g,"&lt;"):o;
h.push("<option",(_268d==v?" selected":"")," value=\""+v+"\"",">",o,"</option>");
}
h.push("</select>");
return h.join("");
},_defaultFormat:function(_268f,_2690){
var v=this.inherited(arguments);
if(!this.formatter&&this.values&&this.options){
var i=array.indexOf(this.values,v);
if(i>=0){
v=this.options[i];
}
}
return v;
},getValue:function(_2691){
var n=this.getEditNode(_2691);
if(n){
var i=n.selectedIndex,o=n.options[i];
return this.returnIndex>-1?i:o.value||o.innerHTML;
}
}});
_268b.markupFactory=function(node,cell){
Cell.markupFactory(node,cell);
var _2692=lang.trim(_2652.get(node,"options")||"");
if(_2692){
var o=_2692.split(",");
if(o[0]!=_2692){
cell.options=o;
}
}
var _2693=lang.trim(_2652.get(node,"values")||"");
if(_2693){
var v=_2693.split(",");
if(v[0]!=_2693){
cell.values=v;
}
}
};
var _2694=_2650("dojox.grid.cells.AlwaysEdit",Cell,{alwaysEditing:true,_formatNode:function(_2695,_2696){
this.formatNode(this.getEditNode(_2696),_2695,_2696);
},applyStaticValue:function(_2697){
var e=this.grid.edit;
e.applyCellEdit(this.getValue(_2697),this,_2697);
e.start(this,_2697,true);
}});
_2694.markupFactory=function(node,cell){
Cell.markupFactory(node,cell);
};
var Bool=_2650("dojox.grid.cells.Bool",_2694,{_valueProp:"checked",formatEditing:function(_2698,_2699){
return "<input class=\"dojoxGridInput\" type=\"checkbox\""+(_2698?" checked=\"checked\"":"")+" style=\"width: auto\" />";
},doclick:function(e){
if(e.target.tagName=="INPUT"){
this.applyStaticValue(e.rowIndex);
}
}});
Bool.markupFactory=function(node,cell){
_2694.markupFactory(node,cell);
};
return _2659;
});
},"orion/editor/htmlGrammar":function(){
define("orion/editor/htmlGrammar",[],function(){
function _269a(){
return {"scopeName":"source.html","uuid":"3B5C76FB-EBB5-D930-F40C-047D082CE99B","patterns":[{"begin":"<!(doctype|DOCTYPE)","end":">","contentName":"entity.name.tag.doctype.html","beginCaptures":{"0":{"name":"entity.name.tag.doctype.html"}},"endCaptures":{"0":{"name":"entity.name.tag.doctype.html"}}},{"begin":"<!--","end":"-->","beginCaptures":{"0":{"name":"punctuation.definition.comment.html"}},"endCaptures":{"0":{"name":"punctuation.definition.comment.html"}},"patterns":[{"match":"--","name":"invalid.illegal.badcomment.html"}],"contentName":"comment.block.html"},{"match":"<[A-Za-z0-9_\\-:]+(?= ?)","name":"entity.name.tag.html"},{"include":"#attrName"},{"include":"#qString"},{"include":"#qqString"},{"include":"#entity"},{"match":"</[A-Za-z0-9_\\-:]+>","name":"entity.name.tag.html"},{"match":">","name":"entity.name.tag.html"}],"repository":{"attrName":{"match":"[A-Za-z\\-:]+(?=\\s*=\\s*['\"])","name":"entity.other.attribute.name.html"},"qqString":{"match":"(\")[^\"]+(\")","name":"string.quoted.double.html"},"qString":{"match":"(')[^']+(')","name":"string.quoted.single.html"},"entity":{"match":"&[A-Za-z0-9]+;","name":"constant.character.entity.html"}}};
};
return {HtmlGrammar:_269a};
});
},"davinci/ve/actions/ViewSplitHMenuAction":function(){
define("davinci/ve/actions/ViewSplitHMenuAction",["dojo/_base/declare","davinci/ve/actions/ContextAction"],function(_269b,_269c){
return _269b("davinci.ve.actions.ViewSplitHMenuAction",[_269c],{run:function(_269d){
_269d=this.fixupContext(_269d);
if(_269d&&_269d.editor&&_269d.editor.switchDisplayModeSplitHorizontal){
_269d.editor.switchDisplayModeSplitHorizontal();
}
}});
});
},"davinci/html/ui/HTMLEditor":function(){
define(["dojo/_base/declare","davinci/ui/ModelEditor","davinci/model/Factory","davinci/html/ui/HTMLOutline"],function(_269e,_269f,_26a0,_26a1){
return _269e("davinci.html.ui.HTMLEditor",_269f,{constructor:function(_26a2,_26a3){
var args={url:_26a3};
this.htmlFile=_26a0.getModel(args);
this.model=this.htmlFile;
this._handle=dojo.connect(this.htmlFile.getDocumentElement(),"onkeydown",this,"onKeyDown");
},destroy:function(){
this.htmlFile.close();
dojo.disconnect(this._handle);
this.inherited(arguments);
},getOutline:function(){
if(!this.outline){
this.outline=new _26a1(this.model);
}
return this.outline;
},getDefaultContent:function(){
return "<html>\n <head></head>\n <body></body>\n</html>";
},onKeyDown:function(e){
}});
});
},"davinci/html/CSSSelector":function(){
define("davinci/html/CSSSelector",["require","dojo/_base/declare","davinci/html/CSSElement"],function(_26a4,_26a5,_26a6){
var _26a7=_26a5("davinci.html.CSSSelector",_26a6,{constructor:function(){
this.elementType="CSSSelector";
},matchesSelector:function(_26a8){
if(_26a8.elementType==this.elementType&&this.id==_26a8.id&&this.cls==_26a8.cls&&this.element==_26a8.element&&this.pseudoRule==_26a8.pseudoRule){
return true;
}
},getText:function(_26a9){
var s="";
if(this.element){
s=s+this.element;
}
if(this.id){
s=s+"#"+this.id;
}
if(this.cls){
s=s+"."+this.cls;
}
if(this.pseudoRule){
s=s+":"+this.pseudoRule;
}
if(this.pseudoElement){
s=s+"::"+this.pseudoElement;
}
if(this.attribute){
s=s+"["+this.attribute.name;
if(this.attribute.type){
s=s+this.attribute.type+"\""+this.attribute.value+"\"";
}
s=s+"]";
}
return s;
},matches:function(_26aa,index){
var inx=index||0;
var node=_26aa[inx];
var _26ab=0;
var _26ac=false;
if(this.id){
if(this.id!=node.id){
return -1;
}
_26ab+=100;
_26ac=true;
}
if(this.element){
if(this.element=="*"){
_26ac=true;
}else{
if(this.element!=node.tagName){
if(this.element.toUpperCase()!=node.tagName){
return -1;
}
}
_26ab+=1;
_26ac=true;
}
}
if(this.cls&&node.classes){
var _26ad=node.classes;
if(this.cls.indexOf(".")>=0){
var _26ae=this.cls.split(".");
for(var j=0;j<_26ae.length;j++){
var found=false;
for(var i=0;i<_26ad.length;i++){
if(found=(_26ad[i]==_26ae[j])){
break;
}
}
if(!found){
return -1;
}
}
_26ab+=(_26ae.length*10);
_26ac=true;
}else{
var found=false;
for(var i=0;i<_26ad.length;i++){
if(found=((_26ad[i]==this.cls)&&(!this.pseudoRule))){
break;
}
}
if(!found){
return -1;
}
_26ab+=10;
_26ac=true;
}
}
if(!_26ac){
return -1;
}else{
return _26ab;
}
},getCSSRule:function(){
if(this.parent.elementType=="CSSRule"){
return this.parent;
}
return this.parent.parent;
}});
_26a7.parseSelectors=function(_26af){
if(typeof _26af=="string"){
_26af=_26af+"{}";
var _26b0=_26a4("davinci/html/CSSFile");
var _26b1=new _26b0();
_26b1.setText(_26af);
return _26b1.children[0].selectors;
}else{
return _26af;
}
};
return _26a7;
});
},"dijit/layout/StackContainer":function(){
define("dijit/layout/StackContainer",["dojo/_base/array","dojo/cookie","dojo/_base/declare","dojo/dom-class","dojo/has","dojo/_base/lang","dojo/ready","dojo/topic","../registry","../_WidgetBase","./_LayoutWidget","dojo/i18n!../nls/common"],function(array,_26b2,_26b3,_26b4,has,lang,ready,topic,_26b5,_26b6,_26b7){
if(has("dijit-legacy-requires")){
ready(0,function(){
var _26b8=["dijit/layout/StackController"];
require(_26b8);
});
}
var _26b9=_26b3("dijit.layout.StackContainer",_26b7,{doLayout:true,persist:false,baseClass:"dijitStackContainer",buildRendering:function(){
this.inherited(arguments);
_26b4.add(this.domNode,"dijitLayoutContainer");
this.containerNode.setAttribute("role","tabpanel");
},postCreate:function(){
this.inherited(arguments);
this.connect(this.domNode,"onkeypress",this._onKeyPress);
},startup:function(){
if(this._started){
return;
}
var _26ba=this.getChildren();
array.forEach(_26ba,this._setupChild,this);
if(this.persist){
this.selectedChildWidget=_26b5.byId(_26b2(this.id+"_selectedChild"));
}else{
array.some(_26ba,function(child){
if(child.selected){
this.selectedChildWidget=child;
}
return child.selected;
},this);
}
var _26bb=this.selectedChildWidget;
if(!_26bb&&_26ba[0]){
_26bb=this.selectedChildWidget=_26ba[0];
_26bb.selected=true;
}
topic.publish(this.id+"-startup",{children:_26ba,selected:_26bb});
this.inherited(arguments);
},resize:function(){
if(!this._hasBeenShown){
this._hasBeenShown=true;
var _26bc=this.selectedChildWidget;
if(_26bc){
this._showChild(_26bc);
}
}
this.inherited(arguments);
},_setupChild:function(child){
this.inherited(arguments);
_26b4.replace(child.domNode,"dijitHidden","dijitVisible");
child.domNode.title="";
},addChild:function(child,_26bd){
this.inherited(arguments);
if(this._started){
topic.publish(this.id+"-addChild",child,_26bd);
this.layout();
if(!this.selectedChildWidget){
this.selectChild(child);
}
}
},removeChild:function(page){
this.inherited(arguments);
if(this._started){
topic.publish(this.id+"-removeChild",page);
}
if(this._descendantsBeingDestroyed){
return;
}
if(this.selectedChildWidget===page){
this.selectedChildWidget=undefined;
if(this._started){
var _26be=this.getChildren();
if(_26be.length){
this.selectChild(_26be[0]);
}
}
}
if(this._started){
this.layout();
}
},selectChild:function(page,_26bf){
page=_26b5.byId(page);
if(this.selectedChildWidget!=page){
var d=this._transition(page,this.selectedChildWidget,_26bf);
this._set("selectedChildWidget",page);
topic.publish(this.id+"-selectChild",page);
if(this.persist){
_26b2(this.id+"_selectedChild",this.selectedChildWidget.id);
}
}
return d;
},_transition:function(_26c0,_26c1){
if(_26c1){
this._hideChild(_26c1);
}
var d=this._showChild(_26c0);
if(_26c0.resize){
if(this.doLayout){
_26c0.resize(this._containerContentBox||this._contentBox);
}else{
_26c0.resize();
}
}
return d;
},_adjacent:function(_26c2){
var _26c3=this.getChildren();
var index=array.indexOf(_26c3,this.selectedChildWidget);
index+=_26c2?1:_26c3.length-1;
return _26c3[index%_26c3.length];
},forward:function(){
return this.selectChild(this._adjacent(true),true);
},back:function(){
return this.selectChild(this._adjacent(false),true);
},_onKeyPress:function(e){
topic.publish(this.id+"-containerKeyPress",{e:e,page:this});
},layout:function(){
var child=this.selectedChildWidget;
if(child&&child.resize){
if(this.doLayout){
child.resize(this._containerContentBox||this._contentBox);
}else{
child.resize();
}
}
},_showChild:function(page){
var _26c4=this.getChildren();
page.isFirstChild=(page==_26c4[0]);
page.isLastChild=(page==_26c4[_26c4.length-1]);
page._set("selected",true);
_26b4.replace(page.domNode,"dijitVisible","dijitHidden");
return (page._onShow&&page._onShow())||true;
},_hideChild:function(page){
page._set("selected",false);
_26b4.replace(page.domNode,"dijitHidden","dijitVisible");
page.onHide&&page.onHide();
},closeChild:function(page){
var _26c5=page.onClose(this,page);
if(_26c5){
this.removeChild(page);
page.destroyRecursive();
}
},destroyDescendants:function(_26c6){
this._descendantsBeingDestroyed=true;
this.selectedChildWidget=undefined;
array.forEach(this.getChildren(),function(child){
if(!_26c6){
this.removeChild(child);
}
child.destroyRecursive(_26c6);
},this);
this._descendantsBeingDestroyed=false;
}});
_26b9.ChildWidgetProperties={selected:false,disabled:false,closable:false,iconClass:"dijitNoIcon",showTitle:true};
lang.extend(_26b6,_26b9.ChildWidgetProperties);
return _26b9;
});
},"orion/textview/annotations":function(){
define("orion/textview/annotations",["i18n!orion/textview/nls/messages","orion/textview/eventTarget"],function(_26c7,_26c8){
function _26c9(start,end,_26ca){
this.start=start;
this.end=end;
this._projectionModel=_26ca;
this.html=this._expandedHTML;
this.style=this._expandedStyle;
this.expanded=true;
};
_26c9.prototype={_expandedHTML:"<div class='annotationHTML expanded'></div>",_expandedStyle:{styleClass:"annotation expanded"},_collapsedHTML:"<div class='annotationHTML collapsed'></div>",_collapsedStyle:{styleClass:"annotation collapsed"},collapse:function(){
if(!this.expanded){
return;
}
this.expanded=false;
this.html=this._collapsedHTML;
this.style=this._collapsedStyle;
var _26cb=this._projectionModel;
var _26cc=_26cb.getBaseModel();
this._projection={start:_26cc.getLineStart(_26cc.getLineAtOffset(this.start)+1),end:_26cc.getLineEnd(_26cc.getLineAtOffset(this.end),true)};
_26cb.addProjection(this._projection);
},expand:function(){
if(this.expanded){
return;
}
this.expanded=true;
this.html=this._expandedHTML;
this.style=this._expandedStyle;
this._projectionModel.removeProjection(this._projection);
}};
function _26cd(){
};
_26cd.ANNOTATION_ERROR="orion.annotation.error";
_26cd.ANNOTATION_WARNING="orion.annotation.warning";
_26cd.ANNOTATION_TASK="orion.annotation.task";
_26cd.ANNOTATION_BREAKPOINT="orion.annotation.breakpoint";
_26cd.ANNOTATION_BOOKMARK="orion.annotation.bookmark";
_26cd.ANNOTATION_FOLDING="orion.annotation.folding";
_26cd.ANNOTATION_CURRENT_BRACKET="orion.annotation.currentBracket";
_26cd.ANNOTATION_MATCHING_BRACKET="orion.annotation.matchingBracket";
_26cd.ANNOTATION_CURRENT_LINE="orion.annotation.currentLine";
_26cd.ANNOTATION_CURRENT_SEARCH="orion.annotation.currentSearch";
_26cd.ANNOTATION_MATCHING_SEARCH="orion.annotation.matchingSearch";
var _26ce={};
_26cd.registerType=function(type,_26cf){
var _26d0=_26cf;
if(typeof _26d0!=="function"){
_26d0=function(start,end,title){
this.start=start;
this.end=end;
if(title){
this.title=title;
}
};
_26d0.prototype=_26cf;
}
_26d0.prototype.type=type;
_26ce[type]=_26d0;
return type;
};
_26cd.createAnnotation=function(type,start,end,title){
return new (this.getType(type))(start,end,title);
};
_26cd.getType=function(type){
return _26ce[type];
};
function _26d1(type,_26d2){
var index=type.lastIndexOf(".");
var _26d3=type.substring(index+1);
var _26d4={title:_26c7[_26d3],style:{styleClass:"annotation "+_26d3},html:"<div class='annotationHTML "+_26d3+"'></div>",overviewStyle:{styleClass:"annotationOverview "+_26d3}};
if(_26d2){
_26d4.lineStyle={styleClass:"annotationLine "+_26d3};
}else{
_26d4.rangeStyle={styleClass:"annotationRange "+_26d3};
}
_26cd.registerType(type,_26d4);
};
_26d1(_26cd.ANNOTATION_ERROR);
_26d1(_26cd.ANNOTATION_WARNING);
_26d1(_26cd.ANNOTATION_TASK);
_26d1(_26cd.ANNOTATION_BREAKPOINT);
_26d1(_26cd.ANNOTATION_BOOKMARK);
_26d1(_26cd.ANNOTATION_CURRENT_BRACKET);
_26d1(_26cd.ANNOTATION_MATCHING_BRACKET);
_26d1(_26cd.ANNOTATION_CURRENT_SEARCH);
_26d1(_26cd.ANNOTATION_MATCHING_SEARCH);
_26d1(_26cd.ANNOTATION_CURRENT_LINE,true);
_26cd.registerType(_26cd.ANNOTATION_FOLDING,_26c9);
function _26d5(){
};
_26d5.addMixin=function(_26d6){
var proto=_26d5.prototype;
for(var p in proto){
if(proto.hasOwnProperty(p)){
_26d6[p]=proto[p];
}
}
};
_26d5.prototype={addAnnotationType:function(type){
if(!this._annotationTypes){
this._annotationTypes=[];
}
this._annotationTypes.push(type);
},getAnnotationTypePriority:function(type){
if(this._annotationTypes){
for(var i=0;i<this._annotationTypes.length;i++){
if(this._annotationTypes[i]===type){
return i+1;
}
}
}
return 0;
},getAnnotationsByType:function(_26d7,start,end){
var iter=_26d7.getAnnotations(start,end);
var _26d8,_26d9=[];
while(iter.hasNext()){
_26d8=iter.next();
var _26da=this.getAnnotationTypePriority(_26d8.type);
if(_26da===0){
continue;
}
_26d9.push(_26d8);
}
var self=this;
_26d9.sort(function(a,b){
return self.getAnnotationTypePriority(a.type)-self.getAnnotationTypePriority(b.type);
});
return _26d9;
},isAnnotationTypeVisible:function(type){
return this.getAnnotationTypePriority(type)!==0;
},removeAnnotationType:function(type){
if(!this._annotationTypes){
return;
}
for(var i=0;i<this._annotationTypes.length;i++){
if(this._annotationTypes[i]===type){
this._annotationTypes.splice(i,1);
break;
}
}
}};
function _26db(_26dc){
this._annotations=[];
var self=this;
this._listener={onChanged:function(_26dd){
self._onChanged(_26dd);
}};
this.setTextModel(_26dc);
};
_26db.prototype={addAnnotation:function(_26de){
if(!_26de){
return;
}
var _26df=this._annotations;
var index=this._binarySearch(_26df,_26de.start);
_26df.splice(index,0,_26de);
var e={type:"Changed",added:[_26de],removed:[],changed:[]};
this.onChanged(e);
},getTextModel:function(){
return this._model;
},getAnnotations:function(start,end){
var _26e0=this._annotations,_26e1;
var i=0;
var skip=function(){
while(i<_26e0.length){
var a=_26e0[i++];
if((start===a.start)||(start>a.start?start<a.end:a.start<end)){
return a;
}
if(a.start>=end){
break;
}
}
return null;
};
_26e1=skip();
return {next:function(){
var _26e2=_26e1;
if(_26e2){
_26e1=skip();
}
return _26e2;
},hasNext:function(){
return _26e1!==null;
}};
},modifyAnnotation:function(_26e3){
if(!_26e3){
return;
}
var index=this._getAnnotationIndex(_26e3);
if(index<0){
return;
}
var e={type:"Changed",added:[],removed:[],changed:[_26e3]};
this.onChanged(e);
},onChanged:function(e){
return this.dispatchEvent(e);
},removeAnnotations:function(type){
var _26e4=this._annotations;
var _26e5,i;
if(type){
_26e5=[];
for(i=_26e4.length-1;i>=0;i--){
var _26e6=_26e4[i];
if(_26e6.type===type){
_26e4.splice(i,1);
}
_26e5.splice(0,0,_26e6);
}
}else{
_26e5=_26e4;
_26e4=[];
}
var e={type:"Changed",removed:_26e5,added:[],changed:[]};
this.onChanged(e);
},removeAnnotation:function(_26e7){
if(!_26e7){
return;
}
var index=this._getAnnotationIndex(_26e7);
if(index<0){
return;
}
var e={type:"Changed",removed:this._annotations.splice(index,1),added:[],changed:[]};
this.onChanged(e);
},replaceAnnotations:function(_26e8,add){
var _26e9=this._annotations,i,index,_26ea,_26eb=[];
if(_26e8){
for(i=_26e8.length-1;i>=0;i--){
_26ea=_26e8[i];
index=this._getAnnotationIndex(_26ea);
if(index<0){
continue;
}
_26e9.splice(index,1);
_26eb.splice(0,0,_26ea);
}
}
if(!add){
add=[];
}
for(i=0;i<add.length;i++){
_26ea=add[i];
index=this._binarySearch(_26e9,_26ea.start);
_26e9.splice(index,0,_26ea);
}
var e={type:"Changed",removed:_26eb,added:add,changed:[]};
this.onChanged(e);
},setTextModel:function(_26ec){
if(this._model){
this._model.removeEventListener("Changed",this._listener.onChanged);
}
this._model=_26ec;
if(this._model){
this._model.addEventListener("Changed",this._listener.onChanged);
}
},_binarySearch:function(array,_26ed){
var high=array.length,low=-1,index;
while(high-low>1){
index=Math.floor((high+low)/2);
if(_26ed<=array[index].start){
high=index;
}else{
low=index;
}
}
return high;
},_getAnnotationIndex:function(_26ee){
var _26ef=this._annotations;
var index=this._binarySearch(_26ef,_26ee.start);
while(index<_26ef.length&&_26ef[index].start===_26ee.start){
if(_26ef[index]===_26ee){
return index;
}
index++;
}
return -1;
},_onChanged:function(_26f0){
var start=_26f0.start;
var _26f1=_26f0.addedCharCount;
var _26f2=_26f0.removedCharCount;
var _26f3=this._annotations,end=start+_26f2;
var _26f4=0;
if(!(0<=_26f4&&_26f4<_26f3.length)){
return;
}
var e={type:"Changed",added:[],removed:[],changed:[],textModelChangedEvent:_26f0};
var _26f5=_26f1-_26f2,i;
for(i=_26f4;i<_26f3.length;i++){
var _26f6=_26f3[i];
if(_26f6.start>=end){
_26f6.start+=_26f5;
_26f6.end+=_26f5;
e.changed.push(_26f6);
}else{
if(_26f6.end<=start){
}else{
if(_26f6.start<start&&end<_26f6.end){
_26f6.end+=_26f5;
e.changed.push(_26f6);
}else{
_26f3.splice(i,1);
e.removed.push(_26f6);
i--;
}
}
}
}
if(e.added.length>0||e.removed.length>0||e.changed.length>0){
this.onChanged(e);
}
}};
_26c8.EventTarget.addMixin(_26db.prototype);
function _26f7(view,_26f8){
this._view=view;
this._annotationModel=_26f8;
var self=this;
this._listener={onDestroy:function(e){
self._onDestroy(e);
},onLineStyle:function(e){
self._onLineStyle(e);
},onChanged:function(e){
self._onAnnotationModelChanged(e);
}};
view.addEventListener("Destroy",this._listener.onDestroy);
view.addEventListener("LineStyle",this._listener.onLineStyle);
_26f8.addEventListener("Changed",this._listener.onChanged);
};
_26f7.prototype={destroy:function(){
var view=this._view;
if(view){
view.removeEventListener("Destroy",this._listener.onDestroy);
view.removeEventListener("LineStyle",this._listener.onLineStyle);
this.view=null;
}
var _26f9=this._annotationModel;
if(_26f9){
_26f9.removeEventListener("Changed",this._listener.onChanged);
_26f9=null;
}
},_mergeStyle:function(_26fa,style){
if(style){
if(!_26fa){
_26fa={};
}
if(_26fa.styleClass&&style.styleClass&&_26fa.styleClass!==style.styleClass){
_26fa.styleClass+=" "+style.styleClass;
}else{
_26fa.styleClass=style.styleClass;
}
var prop;
if(style.style){
if(!_26fa.style){
_26fa.style={};
}
for(prop in style.style){
if(!_26fa.style[prop]){
_26fa.style[prop]=style.style[prop];
}
}
}
if(style.attributes){
if(!_26fa.attributes){
_26fa.attributes={};
}
for(prop in style.attributes){
if(!_26fa.attributes[prop]){
_26fa.attributes[prop]=style.attributes[prop];
}
}
}
}
return _26fa;
},_mergeStyleRanges:function(_26fb,_26fc){
if(!_26fb){
_26fb=[];
}
var _26fd,i;
for(i=0;i<_26fb.length&&_26fc;i++){
var range=_26fb[i];
if(_26fc.end<=range.start){
break;
}
if(_26fc.start>=range.end){
continue;
}
_26fd=this._mergeStyle({},range.style);
_26fd=this._mergeStyle(_26fd,_26fc.style);
var args=[];
args.push(i,1);
if(_26fc.start<range.start){
args.push({start:_26fc.start,end:range.start,style:_26fc.style});
}
if(_26fc.start>range.start){
args.push({start:range.start,end:_26fc.start,style:range.style});
}
args.push({start:Math.max(range.start,_26fc.start),end:Math.min(range.end,_26fc.end),style:_26fd});
if(_26fc.end<range.end){
args.push({start:_26fc.end,end:range.end,style:range.style});
}
if(_26fc.end>range.end){
_26fc={start:range.end,end:_26fc.end,style:_26fc.style};
}else{
_26fc=null;
}
Array.prototype.splice.apply(_26fb,args);
}
if(_26fc){
_26fd=this._mergeStyle({},_26fc.style);
_26fb.splice(i,0,{start:_26fc.start,end:_26fc.end,style:_26fd});
}
return _26fb;
},_onAnnotationModelChanged:function(e){
if(e.textModelChangedEvent){
return;
}
var view=this._view;
if(!view){
return;
}
var self=this;
var model=view.getModel();
function _26fe(_26ff){
for(var i=0;i<_26ff.length;i++){
if(!self.isAnnotationTypeVisible(_26ff[i].type)){
continue;
}
var start=_26ff[i].start;
var end=_26ff[i].end;
if(model.getBaseModel){
start=model.mapOffset(start,true);
end=model.mapOffset(end,true);
}
if(start!==-1&&end!==-1){
view.redrawRange(start,end);
}
}
};
_26fe(e.added);
_26fe(e.removed);
_26fe(e.changed);
},_onDestroy:function(e){
this.destroy();
},_onLineStyle:function(e){
var _2700=this._annotationModel;
var _2701=e.textView.getModel();
var _2702=_2700.getTextModel();
var start=e.lineStart;
var end=e.lineStart+e.lineText.length;
if(_2702!==_2701){
start=_2701.mapOffset(start);
end=_2701.mapOffset(end);
}
var _2703=_2700.getAnnotations(start,end);
while(_2703.hasNext()){
var _2704=_2703.next();
if(!this.isAnnotationTypeVisible(_2704.type)){
continue;
}
if(_2704.rangeStyle){
var _2705=_2704.start;
var _2706=_2704.end;
if(_2702!==_2701){
_2705=_2701.mapOffset(_2705,true);
_2706=_2701.mapOffset(_2706,true);
}
e.ranges=this._mergeStyleRanges(e.ranges,{start:_2705,end:_2706,style:_2704.rangeStyle});
}
if(_2704.lineStyle){
e.style=this._mergeStyle({},e.style);
e.style=this._mergeStyle(e.style,_2704.lineStyle);
}
}
}};
_26d5.addMixin(_26f7.prototype);
return {FoldingAnnotation:_26c9,AnnotationType:_26cd,AnnotationTypeList:_26d5,AnnotationModel:_26db,AnnotationStyler:_26f7};
});
},"davinci/review/model/store/GeneralReviewReadStore":function(){
define(["dojo/_base/declare"],function(_2707){
return _2707("davinci.review.model.store.GeneralReviewReadStore",null,{constructor:function(args){
dojo.mixin(this,args);
this._features={"dojo.data.api.Read":true,"dojo.data.api.Identity":true};
this._loadedItems=[];
},getFeatures:function(){
return this._features;
},getIdentity:function(item){
return item.getPath();
},fetchItemByIdentity:function(_2708){
var _2709;
if(_2708.identity&&this.isItemLoaded(_2708.identity)){
dojo.some(this._loadedItems,function(item){
if(_2708.identity==this.getIdentity(item)){
_2709=item;
return true;
}
},this);
if(_2709&&_2708.onItem){
var scope=_2708.scope?_2708.scope:dojo.global;
_2708.onItem.call(scope,_2709);
}
}else{
throw new Error("GeneralReviewReadStore: The item cannot be found or it is not loaded!");
}
},getValue:function(item,_270a,_270b){
var ret=this.getValues(item,_270a);
if(ret.length>0){
return ret[0];
}
},getValues:function(item,_270c){
var ret=[];
if(item[_270c]){
if(item[_270c].length>=0){
ret=ret.concat(item[_270c]);
}else{
ret.push(item[_270c]);
}
}
return ret;
},isItem:function(_270d){
if(typeof _270d=="string"){
return dojo.some(this._loadedItems,function(item){
if(_270d==this.getIdentity(item)){
return true;
}
},this);
}else{
if(_270d){
return typeof _270d.r!="undefined"&&_270d.r===this;
}
}
},isItemLoaded:function(_270e){
var _270f=this.isItem(_270e);
if(_270f&&typeof _270e=="object"){
_270f=_270e.isLoaded;
}
return _270f;
},loadItem:function(_2710){
var item=_2710.item;
if(item){
var self=this;
item.getChildren(function(_2711){
var scope=_2710.scope?_2710.scope:dojo.global;
self._loadedItems=self._loadedItems.concat(_2711);
item.children=_2711;
item.isLoaded=true;
dojo.forEach(_2711,function(child){
child.r=self;
});
_2710.onItem&&_2710.onItem.call(scope,item);
},true);
}
},fetch:function(_2712){
if(_2712.onComplete){
var scope=_2712.scope?_2712.scope:dojo.global;
this.root.r=this;
this._loadedItems.push(this.root);
this.loadItem({item:this.root});
_2712.onComplete.call(scope,[this.root]);
}
return _2712;
},close:function(_2713){
this._loadedItems.length=0;
},getLabel:function(item){
throw new Error("GeneralReviewReadStore: getLabel method is abstract!");
},hasAttribute:function(item,_2714){
return this.isItem(item)&&(_2714=="children"?item.elementType=="Folder":typeof item[_2714]);
}});
});
},"davinci/ve/actions/CutAction":function(){
define("davinci/ve/actions/CutAction",["dojo/_base/declare","davinci/Workbench","./_CutCopyAction","davinci/commands/CompoundCommand","davinci/ve/commands/RemoveCommand","davinci/ve/widget"],function(_2715,_2716,_2717,_2718,_2719,_271a){
return _2715("davinci.ve.actions.CutAction",[_2717],{_invokeSourceEditorAction:function(_271b){
_271b.htmlEditor.cutAction.run();
},_executeAction:function(_271c,_271d,data,_271e){
davinci.Runtime.clipboard=data;
_271c.select(null);
_271c.getCommandStack().execute(_271e);
}});
});
},"davinci/ve/actions/ArrangeAction":function(){
define(["dojo/_base/declare","./_ReorderAction","davinci/commands/CompoundCommand","davinci/ve/commands/ReparentCommand"],function(_271f,_2720,_2721,_2722){
return _271f("davinci.ve.actions.ArrangeAction",[_2720],{run:function(_2723){
},isEnabled:function(_2724){
return true;
},shouldShow:function(_2725){
_2725=this.fixupContext(_2725);
var _2726=_2725?_2725.editor:null;
return (_2726&&_2726.declaredClass=="davinci.ve.PageEditor");
}});
});
},"davinci/ui/NewProject":function(){
define(["dojo/_base/declare","dijit/_Templated","dijit/_Widget","davinci/library","system/resource","davinci/workbench/Preferences","davinci/Runtime","davinci/Workbench","dojo/i18n!davinci/ui/nls/ui","dojo/i18n!dijit/nls/common","dojo/text!./templates/NewProject.html","dijit/form/Button","dijit/form/RadioButton","dijit/form/ValidationTextBox"],function(_2727,_2728,_2729,_272a,_272b,_272c,_272d,_272e,uiNLS,_272f,_2730){
return dojo.declare("davinci.ui.NewProject",[_2729,_2728],{widgetsInTemplate:true,templateString:_2730,_okButton:null,_projectName:null,_eclipseSupport:null,postMixInProperties:function(){
var _2731=uiNLS;
var _2732=_272f;
dojo.mixin(this,_2731);
dojo.mixin(this,_2732);
_272b.listProjects(dojo.hitch(this,this.setProjects));
this.inherited(arguments);
},setProjects:function(_2733){
this._projects={};
_2733.forEach(dojo.hitch(this,function(_2734){
if(_2734){
this._projects[_2734.name]=true;
}
}));
},postCreate:function(){
this.inherited(arguments);
dojo.connect(this._projectName,"onKeyUp",this,"_checkValid");
this._projectName.validator=dojo.hitch(this,function(value,_2735){
var _2736=true;
if(!this._projects||!value){
_2736=false;
}else{
if(this._projects[value]){
_2736=false;
this._projectName.invalidMessage=uiNLS.newProjectNameExists;
}else{
this._projectName.invalidMessage=null;
}
}
return _2736;
});
},_checkValid:function(){
if(!this._projects){
return false;
}
var valid=this._projectName.isValid();
this._okButton.set("disabled",!valid);
},okButton:function(){
var _2737=dojo.attr(this._projectName,"value");
var _2738=dojo.attr(this._eclipseSupport,"checked");
_272b.createProject(_2737,true,_2738).then(function(){
if(_2738){
_272c.savePreferences("davinci.ui.ProjectPrefs",_2737,{webContentFolder:"WebContent",themeFolder:"WebContent/themes",widgetFolder:"WebContent/lib/custom"});
}
if(_272e.singleProjectMode()){
_272e.loadProject(_2737);
}
});
},_getEclipseProjectAttr:function(){
return dojo.attr(this._eclipseSupport,"checked");
},_getValueAttr:function(){
return this.value;
},cancelButton:function(){
this.cancel=true;
this.onClose();
},onClose:function(){
}});
});
},"url:davinci/review/widgets/templates/MailFailureDialogContent.html":"<div>\r\n<div class='mailFailureInfo'>${inviteNotSent}</div>\r\n<div class='mailFailureExtraInfo'>${mailFailureMsg}</div>\r\n<div class='mailFailureContent'>${htmlContent}</div>\r\n</div>\r\n","davinci/ve/actions/ChooseDeviceAction":function(){
define(["dojo/_base/declare","davinci/actions/Action","dijit/_WidgetBase","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","davinci/commands/CompoundCommand","davinci/ve/commands/RemoveCommand","../../Workbench","dojo/store/Memory","dojo/text!../../ui/templates/ChooseDevice.html","dojo/i18n!davinci/ve/nls/ve","dojo/i18n!../../actions/nls/actions","dojo/i18n!dijit/nls/common","dijit/form/Select"],function(_2739,_273a,_273b,_273c,_273d,_273e,_273f,_2740,_2741,_2742,veNls,_2743,_2744){
_2739("davinci.ve.actions.ChooseDeviceActionContent",[_273b,_273c,_273d],{templateString:_2742,widgetsInTemplate:true,select:null,device:null,deviceList:null,postCreate:function(){
var store=new _2741({data:this.deviceList,idProperty:"name"});
this.select.labelAttr="name";
this.select.setStore(store);
this.select.set("value",this.device);
},getValue:function(){
return this.select.get("value");
}});
return _2739("davinci.ve.actions.ChooseDeviceAction",[_273a],{run:function(_2745){
if(!this.isEnabled(null)){
return;
}
var e=davinci.Workbench.getOpenEditor();
if(e&&e.isDirty){
var _2746=e.getOnUnloadWarningMessage();
if(!_2746){
_2746=dojo.string.substitute(veNls.filesHasUnsavedChanges,[e.fileName]);
}
_2740.showDialog(veNls.chooseDeviceSilhouette,_2746,{width:300},dojo.hitch(this,this._okToSwitch),"Save",null);
}else{
this._okToSwitch();
}
},_okToSwitch:function(){
var e=davinci.Workbench.getOpenEditor();
if(e.isDirty){
e.save();
}
this.showDevices();
},isEnabled:function(_2747){
var e=davinci.Workbench.getOpenEditor();
return e.declaredClass=="davinci.ve.PageEditor";
},showDevices:function(){
var e=davinci.Workbench.getOpenEditor();
var c=e.getContext();
var _2748=c.visualEditor.deviceName;
var _2749=[{name:"none"},{name:"iphone"},{name:"ipad"},{name:"android_340x480"},{name:"android_480x800"},{name:"androidtablet"},{name:"blackberry"}];
var ui=new davinci.ve.actions.ChooseDeviceActionContent({device:_2748,deviceList:_2749});
function _274a(){
var e=davinci.Workbench.getOpenEditor();
var _274b=e.getContext();
_274b.visualEditor.setDevice(ui.getValue());
e._visualChanged();
};
_2740.showDialog(veNls.chooseDeviceSilhouette,ui,{width:300},dojo.hitch(this,_274a),_2743.select);
}});
});
},"davinci/maqetta/AppStates":function(){
define(["dojo/_base/connect","dojo/dom-style","dojo/dom","dojo/_base/html","dojo/_base/window","dojo/_base/array","dojo/parser","require"],function(_274c,_274d,dom,dhtml,_274e,_274f,_2750,_2751){
var _2752=function(){
};
_2752.prototype={NORMAL:"Normal",DELTAS_ATTRIBUTE:"data-maq-deltas",DELTAS_ATTRIBUTE_P6:"dvStates",APPSTATES_ATTRIBUTE:"data-maq-appstates",APPSTATES_ATTRIBUTE_P6:"dvStates",reImportant:/^(.*)(!\ *important)(.*)/,isStateContainer:function(node){
return !!(node&&node._maqAppStates);
},getStateContainersForNode:function(node){
var _2753=[];
var n=node;
while(n){
if(n._maqAppStates){
_2753.splice(0,0,n);
}
if(n.tagName=="BODY"){
break;
}
n=n.parentNode;
}
return _2753;
},getAllStateContainers:function(_2754){
var _2755=[];
var that=this;
function _2756(_2757){
if(_2757._maqAppStates){
_2755.push(_2757);
}
var _2758=that._getChildrenOfNode(_2757);
for(var i=0;i<_2758.length;i++){
_2756(_2758[i]);
}
};
_2756(_2754);
return _2755;
},getStatesArray:function(node,_2759,_275a,_275b){
var _275c=[];
if(node){
var pn=node.parentNode;
while(pn){
if(pn._maqAppStates){
if(pn==_275b){
_275c.splice(0,0,{node:pn,oldState:_2759,newState:_275a});
}else{
var _275d=pn._maqAppStates.states?pn._maqAppStates.states.current:undefined;
_275c.splice(0,0,{node:pn,oldState:_275d,newState:_275d});
}
}
if(pn.tagName=="BODY"){
break;
}
pn=pn.parentNode;
}
}
return _275c;
},findStateContainer:function(node,state){
if(node){
var pn=node.parentNode;
while(pn){
if(pn._maqAppStates&&(!state||state==this.NORMAL||(pn._maqAppStates.states&&pn._maqAppStates.states.indexOf(state)>=0))){
return pn;
}
if(pn.tagName=="BODY"){
break;
}
pn=pn.parentNode;
}
}
},getAllStatesForNode:function(node){
var _275e=[this.NORMAL];
if(node){
var pn=node.parentNode;
while(pn){
if(pn._maqAppStates&&pn._maqAppStates.states){
var _275f=pn._maqAppStates.states?pn._maqAppStates.states:[];
for(var i=0;i<_275f.length;i++){
_275e.push(_275f[i]);
}
}
if(pn.tagName=="BODY"){
break;
}
pn=pn.parentNode;
}
}
return _275e;
},getStatesListCurrent:function(node){
var _2760=[];
if(node){
var pn=node.parentNode;
while(pn){
if(pn._maqAppStates){
_2760.splice(0,0,pn._maqAppStates.current);
}
if(pn.tagName=="BODY"){
break;
}
pn=pn.parentNode;
}
}
return _2760;
},getAllCurrentStates:function(_2761){
var _2762=this.getAllStateContainers(_2761);
var _2763=[];
for(var i=0;i<_2762.length;i++){
var node=_2762[i];
var state=this.getState(node);
_2763.push({stateContainerNode:node,state:state});
}
return _2763;
},getStates:function(node){
var _2764=node&&node._maqAppStates;
var names=["Normal"];
if(_2764){
var _2765=_2764.states?_2764.states:[];
for(var i=0;i<_2765.length;i++){
var name=_2765[i];
if(name!="Normal"){
names.push(name);
}
}
}
return names;
},_getSCNodeFromElemOrEvent:function(state,_2766){
var node;
if(_2766&&_2766.tagName&&_2766.nodeName){
node=_2766._maqAppStates?_2766:this.findStateContainer(_2766,state);
}else{
if(_2766&&_2766.target&&_2766.currentTarget){
node=_2766.currentTarget;
if(!node._maqAppStates){
node=this.findStateContainer(node,state);
}
}else{
node=this.getContainer();
}
}
return node;
},_updateSrcState:function(node){
},hasState:function(node,state){
return !!(node&&node._maqAppStates&&node._maqAppStates.states&&node._maqAppStates.states.indexOf(state)>=0);
},getState:function(node){
return node&&node._maqAppStates&&node._maqAppStates.current;
},setState:function(_2767,_2768,_2769){
var _276a=_2769?_2769.updateWhenCurrent:false;
var _276b=_2769?_2769.silent:false;
var focus=_2769?_2769.focus:false;
var node=this._getSCNodeFromElemOrEvent(_2767,_2768);
if(!node||!node._maqAppStates||(!_276a&&node._maqAppStates.current==_2767)){
return;
}
var _276c=node._maqAppStates.current;
if(this.isNormalState(_2767)){
if(node._maqAppStates.hasOwnProperty("current")){
delete node._maqAppStates.current;
}
_2767=undefined;
}else{
node._maqAppStates.current=_2767;
}
if(focus){
this._setFocus(_2767,node);
}
if(_2769&&_2769.hasOwnProperty("initial")){
if(_2769.initial){
node._maqAppStates.initial=_2767;
}else{
if(node._maqAppStates.initial==_2767){
delete node._maqAppStates.initial;
}
}
}
if(!_276b){
_274c.publish("/maqetta/appstates/state/changed",[{node:node,newState:_2767,oldState:_276c,stateContainerNode:node}]);
}
this._updateSrcState(node,!_2767);
},getInitial:function(node){
return node&&node._maqAppStates&&node._maqAppStates.initial;
},getFocus:function(_276d){
if(!_276d){
return null;
}
var _276e=this.getAllStateContainers(_276d);
for(var i=0;i<_276e.length;i++){
var _276f=_276e[i]._maqAppStates;
if(_276f&&_276f.hasOwnProperty("focus")){
return {stateContainerNode:_276e[i],state:_276f.focus};
}
}
return null;
},_setFocus:function(_2770,node){
if(!node||!node._maqAppStates){
return;
}
var _2771=(node.ownerDocument&&node.ownerDocument.body);
if(!_2771){
return;
}
var _2772=this.getFocus(_2771);
if(_2772&&_2772.stateContainerNode==node&&_2772.state==_2770){
return;
}
var _2773;
var _2774=this.getAllStateContainers(_2771);
for(var i=0;i<_2774.length;i++){
_2773=_2774[i]._maqAppStates;
if(_2773){
delete _2773.focus;
}
}
node._maqAppStates.focus=_2770;
},isNormalState:function(state){
if(arguments.length==0){
state=this.getState();
}
return !state||state==this.NORMAL;
},_styleArrayMixin:function(_2775,_2776){
if(_2776){
for(var j=0;j<_2776.length;j++){
var item2=_2776[j];
for(var prop2 in item2){
for(var i=_2775.length-1;i>=0;i--){
var item1=_2775[i];
if(item1.hasOwnProperty(prop2)){
_2775.splice(i,1);
}
}
}
}
for(var k=0;k<_2776.length;k++){
_2775.push(_2776[k]);
}
}
},getStyle:function(node,_2777,name){
var _2778,_2779=[];
for(var i=0;i<_2777.length;i++){
var state=_2777[i];
_2778=node&&node._maqDeltas&&node._maqDeltas[state]&&node._maqDeltas[state].style;
this._styleArrayMixin(_2779,_2778);
if(arguments.length>2){
if(_2779){
for(var j=_2779.length-1;j>=0;j--){
var item=_2779[j];
for(var prop in item){
if(prop!=name){
_2779.splice(j,1);
break;
}
}
}
}
}
}
return _2779;
},hasStyle:function(node,state,name){
if(!node||!name){
return;
}
if(node._maqDeltas&&node._maqDeltas[state]&&node._maqDeltas[state].style){
var _277a=node._maqDeltas[state].style;
for(var i=0;i<_277a[i];i++){
if(_277a[i].hasProperty(name)){
return true;
}
}
}else{
return false;
}
},setStyle:function(node,state,_277b,_277c){
if(!node||!_277b){
return;
}
node._maqDeltas=node._maqDeltas||{};
node._maqDeltas[state]=node._maqDeltas[state]||{};
node._maqDeltas[state].style=node._maqDeltas[state].style||[];
var _277d=node._maqDeltas[state].style;
if(_277b){
for(var i=0;i<_277b.length;i++){
var _277e=_277b[i];
for(var _277f in _277e){
for(var j=_277d.length-1;j>=0;j--){
var _2780=_277d[j];
for(var _2781 in _2780){
if(_277f==_2781){
_277d.splice(j,1);
break;
}
}
}
}
}
}
var _2782;
if(_277b){
for(var j=0;j<_277b.length;j++){
for(var p in _277b[j]){
var value=_277b[j][p];
if(typeof value!="undefined"&&value!==null){
if(typeof _2782=="undefined"){
_2782=[];
}
var o={};
o[p]=this._getFormattedValue(p,value);
_2782.push(o);
}
}
}
}
if(_277d&&_2782){
node._maqDeltas[state].style=_277d.concat(_2782);
}else{
if(_277d){
node._maqDeltas[state].style=_277d;
}else{
if(_2782){
node._maqDeltas[state].style=_2782;
}else{
node._maqDeltas[state].style=undefined;
}
}
}
if(!_277c){
_274c.publish("/davinci/states/state/style/changed",[{node:node,state:state,style:_277b}]);
}
this._updateSrcState(node);
},_convertStyleName:function(name){
if(name.indexOf("-")>=0){
var names=name.split("-");
name=names[0];
for(var i=1;i<names.length;i++){
var n=names[i];
name+=(n.charAt(0).toUpperCase()+n.substring(1));
}
}
return name;
},_DYNAMIC_PROPERTIES:{width:1,height:1,top:1,right:1,bottom:1,left:1},_getFormattedValue:function(name,value){
if(name in this._DYNAMIC_PROPERTIES){
if(typeof value!="string"){
return value+"px";
}
var _2783=_2751("dojo/_base/lang").trim(value);
if(/^[-+]?[0-9]*\.?[0-9]+$/.test(_2783)){
value=_2783+"px";
}
}
return value;
},_getStatesListUsingPropName:function(_2784,_2785){
var _2786=[];
if(_2784){
for(var i=0;i<_2784.length;i++){
_2786.push(_2784[i][_2785]);
}
}
return _2786;
},_resetAndCacheNormalStyle:function(node,_2787){
if(!node||!_2787){
return;
}
for(var i=0;i<_2787.length;i++){
var _2788=_2787[i].oldState;
var _2789=this._getStatesListUsingPropName(_2787,"oldState");
var _278a=this.getStyle(node,_2789);
var _278b=this._getStatesListUsingPropName(_2787);
var _278c=this.getStyle(node,_278b);
if(_278a){
for(var j=0;j<_278a.length;j++){
var oItem=_278a[j];
for(var oProp in oItem){
var _278d=this._convertStyleName(oProp);
node.style[_278d]="";
}
}
}
if(_278c){
for(var k=0;k<_278c.length;k++){
var nItem=_278c[k];
for(var nProp in nItem){
var _278d=this._convertStyleName(nProp);
var style=node.style;
var value=this._getFormattedValue(nProp,nItem[nProp])+"";
var _278e=value?value.match(this.reImportant):null;
if(_278e){
if(style.setProperty){
style.setProperty(nProp,_278e[1]+_278e[3],"important");
}else{
node.style[_278d]=_278e[1]+_278e[3];
}
}else{
node.style[_278d]=value;
}
}
}
}
}
},_update:function(node,_278f){
if(!node||!node._maqDeltas){
return;
}
var _2790=this._getStatesListUsingPropName(_278f,"newState");
var _2791=this.getStyle(node,_2790);
this._resetAndCacheNormalStyle(node,_278f);
if(_2791){
for(var i=0;i<_2791.length;i++){
var style=_2791[i];
for(var name in style){
var _2792=this._convertStyleName(name);
var value=style[name]+"";
var _2793=value?value.match(this.reImportant):null;
if(_2793){
if(style.setProperty){
style.setProperty(name,_2793[1]+_2793[3],"important");
}else{
node.style[_2792]=_2793[1]+_2793[3];
}
}else{
node.style[_2792]=value;
}
}
}
}
var _2794,_2795;
if(node.id&&node.ownerDocument){
var byId=node.ownerDocument.defaultView.dijit.byId;
if(byId){
_2794=byId&&byId(node.id);
}
}
if(_2794&&_2794.getParent){
_2795=_2794.getParent();
}
if(_2795&&_2795.resize){
_2795.resize();
}else{
if(_2794&&_2794.resize){
_2794.resize();
}
}
},isContainer:function(node){
var _2796=false;
if(node){
var doc=this.getDocument();
if(node===(doc&&doc.body)||node.tagName=="BODY"){
_2796=true;
}
}
return _2796;
},getContainer:function(){
return document.body;
},add:function(node,state){
if(!node||this.hasState(node,state)){
return;
}
node._maqAppStates=node._maqAppStates||{};
node._maqAppStates.states=node._maqAppStates.states||[];
node._maqAppStates.states.push(state);
_274c.publish("/davinci/states/state/added",[{node:node,state:state}]);
this._updateSrcState(node);
},remove:function(node,state){
if(!node||!node._maqAppStates||!node._maqAppStates.states||!this.hasState(node,state)){
return;
}
var idx=node._maqAppStates.states.indexOf(state);
if(idx<0){
return;
}
var _2797=this.getState(node);
var body=node.ownerDocument.body;
var _2798=this.getFocus(body);
node._maqAppStates.states.splice(idx,1);
var _2799={};
if(_2798&&_2798.stateContainerNode==node&&_2798.state==state){
_2799.focus=true;
_2799.updateWhenCurrent=true;
}
if(state==_2797){
this.setState(undefined,node,_2799);
}
_274c.publish("/davinci/states/state/removed",[{node:node,state:state}]);
this._updateSrcState(node);
},rename:function(_279a,_279b){
if(!_279b){
return false;
}
var _279c=_279b.oldName;
var _279d=_279b.newName;
if(!_279a||!_279a._maqAppStates||!_279a._maqAppStates.states||!_279a._maqAppStates.states.length){
return false;
}
var _279e=_279a._maqAppStates.states;
if(_279e.indexOf(_279c)<0||_279e.indexOf(_279d)>=0){
return false;
}
_279e.splice(_279e.indexOf(_279c),1,_279d);
if(_279a._maqAppStates.focus===_279c){
_279a._maqAppStates.focus=_279d;
}
if(_279a._maqAppStates.current===_279c){
_279a._maqAppStates.current=_279d;
}
var nodes=[_279a];
var _279f=this.getState(_279a);
nodes=nodes.concat(this._getChildrenOfNode(_279a));
while(nodes.length){
var node=nodes.shift();
if(node._maqDeltas&&node._maqDeltas[_279c]){
node._maqDeltas[_279d]=node._maqDeltas[_279c];
delete node._maqDeltas[_279c];
}
nodes=nodes.concat(this._getChildrenOfNode(node));
var _27a0=this.getStatesArray(node,null,_279d,_279a);
this._update(node,_27a0);
this._updateSrcState(node);
}
_274c.publish("/davinci/states/state/renamed",[{node:node,oldName:_279c,newName:_279d,stateContainerNode:node}]);
return true;
},_isEmpty:function(_27a1){
for(var name in _27a1){
if(_27a1.hasOwnProperty(name)){
return false;
}
}
return true;
},serialize:function(node){
var that=this;
function munge(_27a2){
var str=null;
if(node[_27a2]){
var o=_2751("dojo/_base/lang").clone(node[_27a2]);
delete o["undefined"];
if(!that._isEmpty(o)){
str=JSON.stringify(o);
str=str.replace(/(\\)?'/g,function($0,$1){
return $1?$0:"\\'";
});
str=str.replace(/"/g,"'");
}
}
return str;
};
var obj={};
if(!node){
return obj;
}
var _27a3=munge("_maqAppStates");
if(typeof _27a3=="string"){
obj.maqAppStates=_27a3;
}
var _27a4=munge("_maqDeltas");
if(typeof _27a4=="string"){
obj.maqDeltas=_27a4;
}
return obj;
},deserialize:function(_27a5,_27a6){
if(typeof _27a5=="string"){
_27a5=_27a5.replace(/(\\)?'/g,function($0,$1){
return $1?"'":"\"";
});
_27a5=JSON.parse(_27a5);
this._migrate_m4_m5(_27a5);
_27a5=this._migrate_m6_m7(_27a5,_27a6&&_27a6.isBody);
}
return _27a5;
},_migrate_m4_m5:function(_27a7){
for(var s in _27a7){
var state=_27a7[s];
if(state){
var style=state.style;
if(style&&!style.length){
var _27a8=[];
for(var prop in style){
var o={};
o[prop]=style[prop];
_27a8.push(o);
}
state.style=_27a8;
}
}
}
},_migrate_m6_m7:function(_27a9,_27aa){
if(!_27a9||_27a9.states){
return _27a9;
}
if(_27aa){
var _27ab=[];
for(var s in _27a9){
if(s!="current"){
_27ab.push(s);
}
}
if(_27ab.length>0){
return {states:_27ab};
}else{
return undefined;
}
}else{
delete _27a9.current;
return _27a9;
}
},store:function(node,_27ac,_27ad){
if(!node){
return;
}
this.clear(node);
var _27ae=(node.tagName=="BODY");
if(_27ac){
node._maqAppStates=this.deserialize(_27ac,{isBody:_27ae});
}
if(_27ad){
node._maqDeltas=this.deserialize(_27ad,{isBody:_27ae});
}
_274c.publish("/davinci/states/stored",[]);
},retrieve:function(node){
if(!node){
return;
}
var _27af=node.getAttribute(this.APPSTATES_ATTRIBUTE);
if(!_27af&&node.tagName==="BODY"){
_27af=node.getAttribute(this.APPSTATES_ATTRIBUTE_P6);
}
var _27b0=node.getAttribute(this.DELTAS_ATTRIBUTE);
if(!_27b0&&node.tagName!=="BODY"){
_27b0=node.getAttribute(this.DELTAS_ATTRIBUTE_P6);
}
return {maqAppStates:_27af,maqDeltas:_27b0};
},clear:function(node){
if(!node){
return;
}
delete node._maqAppStates;
delete node._maqDeltas;
},_parseStyleValues:function(text){
var _27b1=[];
if(text){
_274f.forEach(text.split(";"),function(s){
var i=s.indexOf(":");
if(i>0){
var n=s.substring(0,i).trim();
var v=s.substring(i+1).trim();
var o={};
o[n]=v;
_27b1.push(o);
}
});
}
return _27b1;
},transferElementStyle:function(node,_27b2){
if(node){
var _27b3=node._maqDeltas;
var _27b4=this._parseStyleValues(_27b2);
if(!_27b3["undefined"]){
_27b3["undefined"]={};
}
_27b3["undefined"].style=_27b4;
}
},getDocument:function(){
return document;
},_shouldInitialize:function(){
var _27b5=window.frameElement;
var _27b6=top.davinci&&top.davinci.Runtime&&(!_27b5||_27b5.dvContext);
return !_27b6;
},_getChildrenOfNode:function(node){
var _27b7=[];
for(var i=0;i<node.childNodes.length;i++){
var n=node.childNodes[i];
if(n.nodeType===1){
_27b7.push(n);
}
}
return _27b7;
},initialize:function(){
if(!this.subscribed){
_274c.subscribe("/maqetta/appstates/state/changed",this,function(e){
if(e.editorClass){
return;
}
var _27b8=davinci.states._getChildrenOfNode(e.node);
while(_27b8.length){
var child=_27b8.shift();
if(!davinci.states.isContainer(child)){
_27b8=_27b8.concat(davinci.states._getChildrenOfNode(child));
}
var _27b9=this.getStatesArray(child,e.oldState,e.newState,e.stateContainerNode);
davinci.states._update(child,_27b9);
}
});
this.subscribed=true;
}
}};
if(typeof davinci==="undefined"){
davinci={};
}
var _27ba=davinci.states=new _2752();
(function(){
_27ba.initialize();
if(_27ba._shouldInitialize()){
if(typeof _2751!="undefined"){
_2751(["dojo/_base/lang","dojo/query","dojo/aspect"],function(lang,query,_27bb){
var count=0,_27bc=false;
var hook=function(_27bd){
if(!_27bc){
_27bb.around(_27bd,"parse",function(parse){
var cache={};
return function(_27be,args){
var root;
if(!args&&_27be&&_27be.rootNode){
args=_27be;
root=args.rootNode;
}else{
root=_27be;
}
root=root?dhtml.byId(root):_274e.body();
_27bf(cache);
var _27c0=parse.apply(this,arguments);
_27c1(cache,root);
return _27c0;
};
});
dojo.parser.parse=_27bd.parse;
_27bc=true;
}
};
try{
var _27c2=_2751("dojox/mobile/parser");
hook.apply(_27c2);
}
catch(e){
}
if(!_27c2){
hook.call(null,_2750);
}
var _27bf=function(cache){
var _27c3="maqTempClass";
var doc=_27ba.getDocument();
if(!doc.body._maqAlreadyPreserved){
var _27c4=davinci.states.retrieve(doc.body);
if(_27c4&&_27c4.maqAppStates){
cache.body=_27c4.maqAppStates;
}
doc.body._maqAlreadyPreserved=true;
}
query("*",doc).forEach(function(node){
var _27c5=node.getAttribute("class");
if(!_27c5){
_27c5="";
}
if(!node._maqAlreadyPreserved&&_27c5.indexOf(_27c3)<0){
node._maqAlreadyPreserved=true;
var _27c6=_27ba.retrieve(node);
if(node.tagName!="BODY"&&_27c6&&(_27c6.maqAppStates||_27c6.maqDeltas)){
var _27c7=_27c3+count;
_27c5=_27c5+" "+_27c7;
node.setAttribute("class",_27c5);
count++;
cache[_27c7]={};
if(_27c6.maqAppStates){
cache[_27c7].maqAppStates=_27c6.maqAppStates;
}
if(_27c6.maqDeltas){
cache[_27c7].maqDeltas=_27c6.maqDeltas;
}
if(node.style){
cache[_27c7].style=node.style.cssText;
}else{
console.error("States.js _preserveStates. No value for node.style.");
}
}
}
});
};
var _27c1=function(cache,_27c8){
var doc=_27ba.getDocument(),_27c9=[],_27ca,_27cb,_27cc,_27cd;
for(var id in cache){
var node;
if(id=="body"){
node=doc.body;
}else{
node=doc.querySelectorAll("."+id)[0];
}
if(node){
var _27ce=(node.tagName=="BODY");
_27ca=_27cb=_27cc=_27cd=null;
if(_27ce){
_27ca=cache[id];
}else{
_27ca=cache[id].maqAppStates;
_27cb=cache[id].maqDeltas;
}
if(_27ca){
_27cc=_27ba.deserialize(_27ca,{isBody:_27ce});
}
if(_27cb){
_27cd=_27ba.deserialize(_27cb,{isBody:_27ce});
}
if(_27cc){
if(_27cc.initial){
_27cc.current=_27cc.initial;
}else{
if(_27cc.focus){
delete _27cc.focus;
}
delete _27cc.current;
}
}
_27ba.store(node,_27cc,_27cd);
if(_27cb){
davinci.states.transferElementStyle(node,cache[id].style);
}
}
}
var _27cf=_27ba.getAllStateContainers(doc.body);
var _27d0=[];
for(var i=0;i<_27cf.length;i++){
var _27d1=_27cf[i];
if(_27d1._maqAppStates&&typeof _27d1._maqAppStates.current=="string"){
var focus=_27d1._maqAppStates.focus;
_27ba.setState(_27d1._maqAppStates.current,_27d1,{updateWhenCurrent:true,focus:focus});
}
}
};
});
}
}
})();
if(!davinci.Workbench&&typeof dijit!="undefined"){
_274c.subscribe("/maqetta/appstates/state/changed",function(args){
var w;
var byId=(args&&args.node&&args.node.ownerDocument&&args.node.ownerDocument.defaultView&&args.node.ownerDocument.defaultView.dijit.byId);
if(byId){
if(args.newState&&!args.newState.indexOf("_show:")){
w=byId(args.newState.substring(6));
w&&w.show&&w.show();
}else{
if(args.oldState&&!args.oldState.indexOf("_show:")){
w=byId(args.oldState.substring(6));
w&&w.hide&&w.hide();
}
}
}
});
}
return _2752;
});
},"davinci/review/actions/PublishAction":function(){
define(["dojo/_base/declare","davinci/actions/Action","davinci/review/widgets/PublishWizard","davinci/Runtime","dojox/widget/Toaster","davinci/ui/Dialog","dojo/i18n!./nls/actions"],function(_27d2,_27d3,_27d4,_27d5,_27d6,_27d7,_27d8){
var _27d9=_27d2("davinci.review.actions.PublishAction",[_27d3],{constructor:function(node,_27da){
this.node=node;
this.isRestart=_27da;
if(node&&node.isRestart){
this.isRestart=true;
}
},run:function(){
var _27db=this.publishWizard=new _27d4();
this.dialog=new _27d7({contentStyle:{width:650,height:350},title:this.node?_27d8.editReview:_27d8.newReview,onCancel:dojo.hitch(this,this.close),onHide:dojo.hitch(this,this.hide)});
this.dialog.setContent(_27db);
this.dialog.show();
dojo.connect(_27db,"onClose",this,this.close);
_27db.initData(this.node,this.isRestart).then(function(){
_27db.updateSubmit();
_27db.reviewerStackContainer.resize();
});
},hide:function(){
this.dialog.destroyRecursive();
},close:function(){
this.dialog.hide();
}});
return _27d9;
});
},"davinci/ve/VisualEditorOutline":function(){
define(["dojo/_base/declare","dojo/_base/connect","./commands/ReparentCommand","./commands/StyleCommand","./widget","./States","dijit/tree/dndSource"],function(_27dc,_27dd,_27de,_27df,_27e0,_27e1,_27e2){
var _27e3=_27dc(null,{toggleMode:true,betweenThreshold:4,showRoot:true,dndController:"dijit.tree.dndSource",constructor:function(_27e4){
this._context=_27e4;
this._handles=[];
this._connect("activate","_rebuild");
this._connect("widgetChanged","_widgetChanged");
},getRoot:function(_27e5,_27e6){
_27e5(this._context.rootWidget||{id:"myapp",label:"application"});
},getLabel:function(item){
if(item.id=="myapp"){
return this._context.model.fileName;
}
var _27e7=this._getWidget(item);
if(_27e7.isWidget){
label=_27e0.getLabel(_27e7);
return label;
}
var type=_27e7.type;
if(!type){
return;
}
var lt=this.useRichTextLabel?"&lt;":"<";
var gt=this.useRichTextLabel?"&gt;":">";
if(type.indexOf("html.")===0){
label=lt+type.substring("html.".length)+gt;
}else{
if(type.indexOf("OpenAjax.")===0){
label=lt+type.substring("OpenAjax.".length)+gt;
}else{
if(type.indexOf(".")>0){
label=type.substring(type.lastIndexOf(".")+1);
}else{
label=_27e7.label||type;
}
}
}
var _27e7=_27e0.byId(_27e7.id,this._context.getDocument());
if(_27e7){
var id=_27e7.getId();
if(id){
label+=" id="+id;
}
}
return label;
},_getChildren:function(item){
var _27e8;
if(!this._context.rootWidget||item.type=="state"||item.type=="html.stickynote"||item.type=="html.richtext"){
return [];
}
if(item.id=="myapp"||item===this._context.rootNode){
_27e8=this._context.getTopWidgets();
}else{
_27e8=this._getWidget(item).getChildren();
}
return _27e8.filter(function(_27e9){
return _27e9&&_27e9.getContext&&_27e9.getContext()&&!_27e9.internal;
}).map(this._buildItem);
},mayHaveChildren:function(item){
var _27ea=this._getWidget(item);
if(_27ea&&_27ea.type&&_27ea.type.indexOf("OpenAjax.")===0){
return false;
}
return this._getChildren(_27ea).length>0;
},getIdentity:function(item){
return item.id;
},getChildren:function(item,_27eb,_27ec){
_27eb(this._getChildren(item));
},put:function(item,_27ed){
var _27ee=this._getWidget(item);
var _27ef=_27ee.getParent();
this.onChildrenChange(_27ef,this._getChildren(_27ef));
return this.getIdentity(_27ee);
},add:function(item,_27f0){
(_27f0=_27f0||{}).overwrite=false;
return this.put(item,_27f0);
},remove:function(item){
this.onDelete(item);
},newItem:function(args,_27f1){
},pasteItem:function(_27f2,_27f3,_27f4,bCopy,_27f5,_27f6){
if(!_27f2||!_27f4||!_27f3){
return;
}
if(_27f4.id=="myapp"){
_27f4=this._context.rootWidget;
}else{
_27f4=this._getWidget(_27f4);
}
if(_27f3.id=="myapp"){
_27f3=this._context.rootWidget;
}else{
_27f3=this._getWidget(_27f3);
}
_27f2=this._getWidget(_27f2);
if(_27f3==_27f4&&!bCopy){
var _27f7=dojo.indexOf(_27f3.getChildren(),_27f2);
if(_27f7<_27f5){
_27f5++;
}
}
var _27f8=new _27de(_27f2,_27f4,_27f5);
this._context.getCommandStack().execute(_27f8);
},checkItemAcceptance:function(_27f9,_27fa,_27fb){
switch(_27fb){
case "before":
case "after":
return true;
default:
var item=dijit.getEnclosingWidget(_27f9).item;
var _27fc=this.tree.model._getWidget(item);
return (_27fc.getContainerNode&&_27fc.getContainerNode())||_27fc.id=="myapp";
}
},onChildrenChange:function(_27fd,_27fe){
},_rebuild:function(){
if(this._skipRefresh){
return;
}
var node=this._context.rootNode;
if(node){
this.onChildrenChange(this._buildItem(node),this._getChildren(node));
}
},_widgetChanged:function(type,_27ff,args){
try{
if(type===this._context.WIDGET_ADDED){
this.add(_27ff);
}else{
if(type===this._context.WIDGET_REMOVED){
this.remove(_27ff);
}else{
if(type===this._context.WIDGET_MODIFIED){
this.onChange(_27ff);
this.onChildrenChange(_27ff,this._getChildren(_27ff));
}else{
if(type===this._context.WIDGET_REPARENTED){
this.remove(_27ff);
this.put(_27ff,{overwrite:true,parent:args[1]});
}else{
if(type===this._context.WIDGET_ID_CHANGED){
this.remove({id:args});
this.add(_27ff);
}
}
}
}
}
}
catch(e){
console.error("VisualEditorOutline._widgetChanged: e = "+e);
}
},toggle:function(item,on,node){
var _2800=this._getWidget(item);
var _2801=_2800.getHelper();
var _2802=true;
if(_2801&&_2801.onToggleVisibility){
_2802=_2801.onToggleVisibility(_2800,on);
}
if(_2802){
this._toggle(_2800,on,node);
return true;
}else{
return false;
}
},_toggle:function(_2803,on,node){
var _2804=!on;
var value=_2804?"":"none !important";
var state;
var _2805=_27e1.getFocus(_2803.domNode.ownerDocument.body);
if(_2805){
state=_2805.state;
}else{
var _2806=_27e1.getStatesListCurrent(_2803.domNode);
for(var i=0;i<_2806.length;i++){
if(_2806[i]){
state=_2806[i];
break;
}
}
}
var _2807=new _27df(_2803,[{display:value}],state);
this._context.getCommandStack().execute(_2807);
},shouldShowElement:function(_2808,item){
if(_2808=="toggleNode"){
return item.type!="states"&&item.id!="myapp";
}
return true;
},_getToggledItemsAttr:function(){
var items=[];
for(var i in this.toggledItems){
items.push(i);
}
return items;
},isToggleOn:function(item){
var _2809=this._getWidget(item);
return (_2809.domNode.style.display==="none");
},_getWidget:function(item){
return _27e0.byId(item.id);
},_buildItem:function(_280a){
if(_280a){
return {id:_280a.id,type:_280a.type};
}
},_connect:function(_280b,_280c){
this._handles.push(_27dd.connect(this._context,_280b,this,_280c));
},destroy:function(){
this._handles.forEach(_27dd.disconnect);
}});
return _27dc("davinci.ve.VisualEditorOutline",null,{toolbarID:"davinci.ve.outline",_outlineMode:"design",constructor:function(_280d){
this._editor=_280d;
this._context=_280d.visualEditor.context;
this._handles=[];
this._connect("onSelectionChange","onSelectionChange");
this._connect("deselect","deselect");
this._widgetModel=new _27e3(this._context);
_27dd.subscribe("/maqetta/appstates/state/changed/end",this,function(e){
var _280e=(typeof davinci!=="undefined")&&davinci.Runtime.currentEditor&&davinci.Runtime.currentEditor.declaredClass;
if(_280e==="davinci.themeEditor.ThemeEditor"){
return;
}
if(!this._tree){
return;
}
var _280f=(e&&e.node&&e.node._dvWidget);
if(!_280f){
return;
}
var _2810=_280f.getChildren();
while(_2810.length){
var child=_2810.shift();
if(child){
var _2811=(child.domNode.style.display!=="none");
this._tree.toggleNode(child,!_2811);
_2810=_2810.concat(child.getChildren());
}
}
});
},getActionsID:function(){
if(this._outlineMode==="design"){
return "davinci.ve.VisualEditorOutline";
}
},_connect:function(_2812,_2813){
this._handles.push(_27dd.connect(this._context,_2812,this,_2813));
},switchDisplayMode:function(_2814){
this._outlineMode=_2814;
this._outlineView.createTree();
},getModel:function(){
switch(this._outlineMode){
case "design":
this._model=this._widgetModel;
break;
case "source":
this._model=this._srcModel;
break;
}
return this._model;
},getSelectedItem:function(){
return this._tree&&this._tree._getSelectedItemAttr();
},onSelectionChange:function(_2815,add){
if(this._outlineMode!="design"){
return;
}
_2815=_2815||this._context.getSelection();
if(_2815){
this._tree.selectNode(_2815,add);
}
},deselect:function(){
this._tree.deselectAll();
},getIconClass:function(item,_2816){
if(this._outlineMode==="design"){
var type=item.type;
var icon;
if(type){
icon="davinciOutlineTreeIcon davinci_"+type.replace(/\./g,"_");
}else{
icon=_2816?"dijitFolderOpened":"dijitFolderClosed";
}
return icon;
}
}});
});
},"davinci/review/model/Resource":function(){
define("davinci/review/model/Resource",["dojo/_base/declare","davinci/review/model/resource/root"],function(_2817,root){
var _2818=null;
return {getRoot:function(){
if(!_2818){
_2818=root;
}
return _2818;
}};
});
},"dojox/grid/_RowManager":function(){
define("dojox/grid/_RowManager",["dojo/_base/declare","dojo/_base/lang","dojo/dom-class"],function(_2819,lang,_281a){
var _281b=function(_281c,_281d){
if(_281c.style.cssText==undefined){
_281c.setAttribute("style",_281d);
}else{
_281c.style.cssText=_281d;
}
};
return _2819("dojox.grid._RowManager",null,{constructor:function(_281e){
this.grid=_281e;
},linesToEms:2,overRow:-2,prepareStylingRow:function(_281f,_2820){
return {index:_281f,node:_2820,odd:Boolean(_281f&1),selected:!!this.grid.selection.isSelected(_281f),over:this.isOver(_281f),customStyles:"",customClasses:"dojoxGridRow"};
},styleRowNode:function(_2821,_2822){
var row=this.prepareStylingRow(_2821,_2822);
this.grid.onStyleRow(row);
this.applyStyles(row);
},applyStyles:function(inRow){
var i=inRow;
i.node.className=i.customClasses;
var h=i.node.style.height;
_281b(i.node,i.customStyles+";"+(i.node._style||""));
i.node.style.height=h;
},updateStyles:function(_2823){
this.grid.updateRowStyles(_2823);
},setOverRow:function(_2824){
var last=this.overRow;
this.overRow=_2824;
if((last!=this.overRow)&&(lang.isString(last)||last>=0)){
this.updateStyles(last);
}
this.updateStyles(this.overRow);
},isOver:function(_2825){
return (this.overRow==_2825&&!_281a.contains(this.grid.domNode,"dojoxGridColumnResizing"));
}});
});
},"davinci/actions/DownloadAction":function(){
define("davinci/actions/DownloadAction",["dojo/_base/declare","./Action","../Workbench","../ui/DownloadSelected","system/resource","davinci/ui/Resource","dojo/i18n!davinci/ui/nls/ui","dojo/i18n!./nls/actions","dijit/form/ValidationTextBox"],function(_2826,_2827,_2828,_2829,_282a,_282b,_282c){
return _2826("davinci.actions.DownloadAction",_2827,{run:function(){
_2828.showModal(new _2829(),_282c.downloadFile,{width:"400px"});
},isEnabled:function(_282d){
var files=_282b.getSelectedResources();
return files&&files.length>0;
}});
});
},"dojo/store/util/QueryResults":function(){
define("dojo/store/util/QueryResults",["../../_base/array","../../_base/lang","../../_base/Deferred"],function(array,lang,_282e){
var _282f=function(_2830){
if(!_2830){
return _2830;
}
if(_2830.then){
_2830=lang.delegate(_2830);
}
function _2831(_2832){
if(!_2830[_2832]){
_2830[_2832]=function(){
var args=arguments;
return _282e.when(_2830,function(_2833){
Array.prototype.unshift.call(args,_2833);
return _282f(array[_2832].apply(array,args));
});
};
}
};
_2831("forEach");
_2831("filter");
_2831("map");
if(!_2830.total){
_2830.total=_282e.when(_2830,function(_2834){
return _2834.length;
});
}
return _2830;
};
lang.setObject("dojo.store.util.QueryResults",_282f);
return _282f;
});
},"davinci/ve/actions/MoveBackwardAction":function(){
define("davinci/ve/actions/MoveBackwardAction",["dojo/_base/declare","./_ReorderAction","davinci/commands/CompoundCommand","davinci/ve/commands/ReparentCommand"],function(_2835,_2836,_2837,_2838){
return _2835("davinci.ve.actions.MoveBackwardAction",[_2836],{name:"MoveBackward",iconClass:"editActionIcon editMoveBackwardIcon",run:function(_2839){
_2839=this.fixupContext(_2839);
if(!_2839){
return;
}
var _283a=(_2839&&_2839.getSelection)?_2839.getSelection():[];
if(_283a.length===0){
return;
}
if(!this.selectionSameParentAllAbsoluteAdjacent(_283a)){
return;
}
var _283b;
var _283c=_283a[0].getParent();
var _283d=_283c.getChildren();
var _283e=this.getAbsoluteSiblings(_283a[0]);
var _283f=new _2837();
var _2840=_283a.slice(0);
for(var j=_283e.length-1;j>=0;j--){
_283b=_283e[j];
var _2841=_2840.indexOf(_283b);
if(_2841>=0){
_2840.splice(_2841,1);
}else{
if(_2840.length===0){
break;
}
}
}
var index=_283d.indexOf(_283b);
for(var i=_283e.length-1;i>=0;i--){
_283b=_283e[i];
if(_283a.indexOf(_283b)>=0){
_283f.add(new _2838(_283b,_283c,index));
}
}
_2839.getCommandStack().execute(_283f);
},isEnabled:function(_2842){
_2842=this.fixupContext(_2842);
var _2843=(_2842&&_2842.getSelection)?_2842.getSelection():[];
if(_2843.length===0){
return false;
}
if(!this.selectionSameParentAllAbsoluteAdjacent(_2843)){
return false;
}
var _2844=this.getAbsoluteSiblings(_2843[0]);
for(var j=0;j<_2843.length;j++){
var _2845=_2843[j];
if(_2844.indexOf(_2845)>(_2843.length-1)){
return true;
}
}
return false;
}});
});
},"davinci/ve/tools/SelectTool":function(){
define(["dojo/_base/declare","dojo/dom-geometry","../../Workbench","../../workbench/Preferences","./_Tool","../widget","../metadata","dojo/dnd/Mover","../../XPathUtils","../../html/HtmlFileXPathAdapter","../Snap","../../commands/CompoundCommand","../commands/AddCommand","../commands/RemoveCommand","../commands/ReparentCommand","../commands/MoveCommand","../commands/ResizeCommand","../commands/ModifyCommand","../States","../utils/GeomUtils"],function(_2846,_2847,_2848,_2849,tool,_284a,_284b,Mover,_284c,_284d,Snap,_284e,_284f,_2850,_2851,_2852,_2853,_2854,_2855,_2856){
return _2846("davinci.ve.tools.SelectTool",tool,{CONSTRAIN_MIN_DIST:3,activate:function(_2857){
this._context=_2857;
},deactivate:function(){
this._setTarget(null);
},onMouseDown:function(event){
var _2858=this._context;
if(_2858.isFocusNode(event.target)){
return;
}
this._shiftKey=event.shiftKey;
this._spaceKey=false;
this._sKey=false;
var _2859=false;
this._areaSelectClear();
var _285a=_2858.checkFocusXY(event.pageX,event.pageY);
if(_285a&&_284b.getAllowedChild(_285a.type)[0]!=="NONE"){
_285a=null;
}
var _285b=this._getTarget()||_284a.getEnclosingWidget(event.target);
if(!_285a){
_285a=_285b;
}
while(_285a){
if(_285a.getContext()){
break;
}
_285a=_284a.getEnclosingWidget(_285a.domNode.parentNode);
}
if(!_285a){
return;
}
if((dojo.isMac&&event.ctrlKey)||event.button==2){
_2858.select(_285a);
return;
}
var _285c=_2858.getSelection();
var _285d=null;
for(var i=0;i<_285c.length;i++){
var _285e=_285c[i];
var w=_285a;
while(w&&w!=_2858.rootWidget){
if(w==_285e){
_285d=_285e;
break;
}
w=w.getParent();
}
if(_285d){
break;
}
}
var _285f=null;
var _2860=dojo.isMac?event.metaKey:event.ctrlKey;
this._mouseDownInfo=null;
if(dojo.indexOf(_285c,_285a)>=0){
if(_2860){
_2858.deselect(_285a);
}else{
_285f=_285a;
this._mouseDownInfo={widget:_285a,eventTargetWidget:_285b,pageX:event.pageX,pageY:event.pageY,dateValue:Date.now()};
}
}else{
if(_2860){
if(_285a==_2858.rootWidget){
return;
}
_2858.select(_285a,_2860);
}else{
if(_285d){
_285f=_285d;
this._mouseDownInfo={widget:_285a,eventTargetWidget:_285b,pageX:event.pageX,pageY:event.pageY,dateValue:Date.now()};
}else{
if(_285a==_2858.rootWidget){
_2858.deselect();
this._areaSelectInit(event.pageX,event.pageY);
return;
}
if(_284b.getAllowedChild(_285a.type)[0]==="NONE"){
_2858.select(_285a,_2860);
_285f=_285a;
}else{
this._mouseDownInfo={widget:_285a,eventTargetWidget:_285b,pageX:event.pageX,pageY:event.pageY,dateValue:Date.now()};
this._areaSelectInit(event.pageX,event.pageY);
}
}
}
}
if(_285f){
var _2861;
var _2862=_2858.getDocument();
var _2863=_2862.defaultView&&_2862.defaultView.dojo;
if(_2863){
_2861=_2863.style(_285f.domNode,"position");
this._moverAbsolute=(_2861=="absolute");
var _2864=_285f.getParent();
var _2865=_285f.getHelper();
if(!(_2865&&_2865.disableDragging&&_2865.disableDragging(_285f))&&(!_2864||!_2864.isLayout||!_2864.isLayout())){
this._moverWidget=_285f;
this._moverWidgets=[_285f];
this._moverLastEventTarget=null;
var cp=_2858._chooseParent;
cp.setProposedParentWidget(null);
_285c=_2858.getSelection();
this._moverStartLocations=[];
this._moverStartLocationsRel=[];
for(var i=0;i<_285c.length;i++){
if(_285c[i]!=_285f){
this._moverWidgets.push(_285c[i]);
}
var _2866=null;
var _2867=_285c[i].getHelper();
if(_2867&&_2867.getMarginBoxPageCoords){
_2866=_2867.getMarginBoxPageCoords(_285c[i]);
}else{
_2866=_2856.getMarginBoxPageCoordsCached(_285c[i].domNode);
}
this._moverStartLocations.push(_2866);
var _2868,_2869;
var _286a=_285c[i].domNode.offsetParent;
if(_286a&&_286a.tagName!="BODY"){
var _286b=_2856.getBorderBoxPageCoordsCached(_286a);
var _286c=_2847.getBorderExtents(_286a);
_2868=_2866.l-(_286b.l+_286c.l);
_2869=_2866.t-(_286b.t+_286c.t);
}else{
_2868=_2866.l;
_2869=_2866.t;
}
this._moverStartLocationsRel.push({l:_2868,t:_2869});
}
var n=_285f.domNode;
var _286d=n.offsetWidth;
var _286e=n.offsetHeight;
var _286f=null;
if(_2865&&_2865.getMarginBoxPageCoords){
_286f=_2865.getMarginBoxPageCoords(_285f);
_286d=_286f.w;
_286e=_286f.h;
}else{
_286f=_2856.getMarginBoxPageCoordsCached(n);
}
var l=_286f.l;
var t=_286f.t;
var w=_286f.w;
var h=_286f.h;
if(this._moverAbsolute){
this._moverDragDiv=dojo.create("div",{className:"selectToolDragDiv",style:"left:"+l+"px;top:"+t+"px;width:"+w+"px;height:"+h+"px"},_2858.rootNode);
this._mover=new Mover(this._moverDragDiv,event,this);
}else{
var _2870=10;
var _2871=8;
l-=_2870/2;
t-=_2870/2;
var w1=_286d+_2870;
var h1=_286e+_2870;
var w2=w1-_2871;
var h2=h1-_2871;
this._moverDragDiv=dojo.create("div",{className:"flowDragOuter",style:"left:"+l+"px;top:"+t+"px;width:"+w1+"px;height:"+h1+"px"},_2858.rootNode);
dojo.create("div",{className:"flowDragInner","style":"width:"+w2+"px;height:"+h2+"px"},this._moverDragDiv);
this._mover=new Mover(this._moverDragDiv,event,this);
}
this._altKey=event.altKey;
this._updateMoveCursor();
document.getElementById("davinci-help-dropdown").focus();
_2862.defaultView.focus();
}
}
}
},onMouseUp:function(event){
var _2872=this._context;
if(_2872.isFocusNode(event.target)){
return;
}
var _2873=(event.which===1);
var _2874=750;
var _2875=750;
var _2876=10;
var _2877=Date.now();
if(this._mouseDownInfo){
if(Math.abs(event.pageX-this._mouseDownInfo.pageX)<=_2876&&Math.abs(event.pageY-this._mouseDownInfo.pageY)<=_2876&&(_2877-this._mouseDownInfo.dateValue)<=_2874){
var _2878=this._mouseDownInfo.eventTargetWidget?this._mouseDownInfo.eventTargetWidget:this._mouseDownInfo.widget;
this._context.select(_2878);
_2873=false;
}
this._mouseDownInfo=null;
}
if(this._lastMouseUp){
if(Math.abs(event.pageX-this._lastMouseUp.pageX)<=_2876&&Math.abs(event.pageY-this._lastMouseUp.pageY)<=_2876&&(_2877-this._lastMouseUp.dateValue)<=_2875){
this.onDblClick(event);
}
}
this._lastMouseUp={pageX:event.pageX,pageY:event.pageY,dateValue:_2877};
if(this._areaSelect&&_2873){
this._areaSelectSelectWidgets(event.pageX,event.pageY);
}
this._areaSelectClear();
},onDblClick:function(event){
var _2879=this._context;
if(_2879.isFocusNode(event.target)){
return;
}
var _287a=event.target.getAttribute("class");
var _287b=(_287a==="selectToolDragDiv")?this._context.getSelection()[0]:(this._getTarget()||_284a.getEnclosingWidget(event.target));
while(_287b){
if(_287b.getContext()){
break;
}
_287b=_284a.getEnclosingWidget(_287b.domNode.parentNode);
}
if(!_287b){
return;
}
var _287c=this._context.getSelection();
var _287d=dojo.isMac?event.ctrlKey:event.metaKey;
if(dojo.indexOf(_287c,_287b)>=0){
if(_287d&&event.button!==2){
this._context.deselect(_287b);
}else{
if(event.button!==2){
this._context.select(_287b,null,true);
}
}
}else{
this._context.select(_287b,_287d,true);
}
},onMouseMove:function(event){
var _287e=this._context;
if(_287e.isFocusNode(event.target)){
return;
}
this._setTarget(event.target,event);
if(this._areaSelect){
if(event.which===1){
this._areaSelectUpdate(event.pageX,event.pageY);
}else{
this._areaSelectClear();
}
}
},onMouseOver:function(event){
try{
if(!dojo.hasClass(event.target,"editFeedback")&&!dojo.hasClass(event.target,"selectToolDragDiv")){
this._onMouseOverEventTargetXPath=_284c.getXPath(event.target);
}
this._setTarget(event.target,event);
}
catch(e){
}
},onMouseOut:function(event){
try{
this._setTarget(event.relatedTarget,event);
}
catch(e){
}
},onExtentChange:function(_287f){
var index=_287f.index;
var _2880=_287f.newBox;
var copy=_287f.copy;
var _2881=_287f.oldBoxes;
var _2882=_287f.applyToWhichStates;
var _2883=this._context;
var cp=_2883._chooseParent;
var _2884=_2883.getSelection();
var _2885=[];
if(_2884.length<=index){
return;
}
var _2886=_2884[index];
var _2887=undefined;
if("w" in _2880||"h" in _2880){
var _2888=_284b.queryDescriptor(_2886.type,"resizable"),w,h;
var _2889=_2886.domNode;
var _288a=_2889.ownerDocument.defaultView;
var _288b=_288a.getComputedStyle(_2889);
var me=_2856.getMarginExtents(_2889,_288b);
var be=_2847.getBorderExtents(_2889,_288b);
var pe=_2847.getPadExtents(_2889,_288b);
if(typeof _2880.w=="number"){
_2880.w-=(me.w+be.w+pe.w);
}
if(typeof _2880.h=="number"){
_2880.h-=(me.h+be.h+pe.h);
}
switch(_2888){
case "width":
w=_2880.w;
break;
case "height":
h=_2880.h;
case "both":
w=_2880.w;
h=_2880.h;
break;
}
var _288c=new _2853(_2886,w,h,_2882);
if(!_2887){
_2887=new _284e();
}
_2887.add(_288c);
var _288d=dojo.style(_2886.domNode,"position");
if("l" in _2880&&"t" in _2880&&_288d=="absolute"){
var left=_2880.l;
var top=_2880.t;
var _288e=new _2852(_2886,left,top,null,null,_2882);
_2887.add(_288e);
}
}else{
var IDs=[];
var _288f=[];
var _2890=[];
var _2891=[];
dojo.forEach(_2884,function(w,idx){
_2890[idx]=_2884[idx].getParent();
_2891[idx]=_2890[idx].indexOf(w);
});
var _2889=_2886.getStyleNode();
var _2892=(dojo.style(_2889,"position")=="absolute");
if(!_2892){
var ppw=cp.getProposedParentWidget();
if(ppw){
if(!_2887){
_2887=new _284e();
}
var _2893=null;
var _2894=_2883.reorderPreserveSiblingOrder(_2884);
dojo.forEach(_2894,function(w){
IDs.push(w.getId());
var _2895,d=w.getData({identify:false});
d.context=_2883;
dojo.withDoc(_2883.getDocument(),function(){
_2895=_284a.createWidget(d);
},this);
if(!_2895){
return;
}
_288f.push(_2895);
if(ppw.refChild){
if(_2893!==null){
idx=_2893+1;
}else{
var _2896=ppw.parent.getChildren();
var idx=_2896.indexOf(ppw.refChild);
if(idx>=0){
if(ppw.refAfter){
idx++;
}
}else{
idx=null;
}
}
_2893=idx;
}
_2887.add(new _284f(_2895,ppw.parent,idx));
_2885.push(_2895);
},this);
if(!copy){
dojo.forEach(_2884,function(w){
var _2897=_288f.shift();
_2887.add(new _2850(w));
var id=IDs.shift();
if(id){
_2887.add(new _2854(_2897,{id:id}));
}
},this);
}
_2883.select(null);
}else{
console.error("SelectTool: ppw is null");
}
}else{
var left=_2880.l,top=_2880.t;
if(!_2887){
_2887=new _284e();
}
var ppw=cp.getProposedParentWidget();
var _2898=ppw?ppw.parent:null;
var _2899=_2886.getParent();
var _289a=undefined;
var _289b=undefined;
if(_2898&&_2898!=_2899){
_289a=_2898;
}
var dx=left-_2881[0].l;
var dy=top-_2881[0].t;
if(copy){
var _2894=_2883.reorderPreserveSiblingOrder(_2884);
dojo.forEach(_2894,function(w){
IDs.push(w.getId());
var _289c=w.getParent();
if(!_289c){
return;
}
var _289d=_289c.getChildren();
for(var widx=0;widx<_289d.length;widx++){
if(_289d[widx]==w){
break;
}
}
var _289e,d=w.getData({identify:false});
d.context=_2883;
dojo.withDoc(_2883.getDocument(),function(){
_289e=_284a.createWidget(d);
},this);
if(!_289e){
return;
}
_288f.push(_289e);
if(_2898){
_2887.add(new _284f(_289e,_2898,-1));
}else{
_2887.add(new _284f(_289e,_289c,widx));
}
_2885.push(_289e);
},this);
newWidget=_2885[index];
}
var _289f=copy?newWidget:_2886;
var _28a0=new _2852(_289f,left,top,null,_2881[index],_2882);
_2887.add(_28a0);
if(_289a){
_2887.add(new _2851(_289f,_2898,"last"));
_2887.add(new _2852(_289f,left,top,null,null,_2882));
}
dojo.forEach(_2884,dojo.hitch(this,function(w,idx){
_289f=copy?_2885[idx]:w;
if(w!=_2886){
var _28a1=_2881[idx].l+dx;
var _28a2=_2881[idx].t+dy;
if(w.getStyleNode().style.position=="absolute"){
var c=new _2852(_289f,_28a1,_28a2,_28a0,_2881[idx],_2882,true);
_2887.add(c);
}
var _28a3=w.getParent();
if(_2898&&_2898!=_28a3){
_2887.add(new _2851(_289f,_2898,"last"));
_2887.add(new _2852(_289f,_28a1,_28a2,null,null,_2882,true));
}
}
}));
if(copy){
dojo.forEach(_2884,dojo.hitch(this,function(w,idx){
_2887.add(new _2851(_2884[idx],_2890[idx],_2891[idx]));
_2887.add(new _2852(_2884[idx],_2881[idx].l,_2881[idx].t,null,_2881[idx],_2882,true));
}));
}
}
}
if(_2887){
_2883.getCommandStack().execute(_2887);
dojo.forEach(_2885,function(w,i){
_2883.select(w,i>0);
},this);
}else{
_2883.select(_2886);
}
},_updateMoveCursor:function(){
var body=this._context.getDocument().body;
if(this._moverDragDiv){
if(this._altKey){
dojo.removeClass(body,"selectToolDragMove");
dojo.addClass(body,"selectToolDragCopy");
}else{
dojo.removeClass(body,"selectToolDragCopy");
dojo.addClass(body,"selectToolDragMove");
}
}else{
dojo.removeClass(body,"selectToolDragMove");
dojo.removeClass(body,"selectToolDragCopy");
}
},onKeyDown:function(event){
if(event){
dojo.stopEvent(event);
switch(event.keyCode){
case dojo.keys.SHIFT:
this._shiftKey=true;
Snap.clearSnapLines(this._context);
break;
case dojo.keys.ALT:
this._altKey=true;
this._updateMoveCursor();
break;
case dojo.keys.SPACE:
this._spaceKey=true;
break;
case 83:
this._sKey=true;
break;
case dojo.keys.TAB:
if(this._moveFocus(event)){
dojo.stopEvent(event);
}else{
}
break;
case dojo.keys.RIGHT_ARROW:
case dojo.keys.LEFT_ARROW:
case dojo.keys.DOWN_ARROW:
case dojo.keys.UP_ARROW:
this._move(event);
}
}
},onKeyUp:function(event){
if(event&&this._moverWidget){
dojo.stopEvent(event);
switch(event.keyCode){
case dojo.keys.SHIFT:
this._shiftKey=false;
break;
case dojo.keys.ALT:
this._altKey=false;
this._updateMoveCursor();
break;
case dojo.keys.SPACE:
this._spaceKey=false;
break;
case 83:
this._sKey=false;
break;
}
}
},_move:function(event){
var _28a4=this._context.getSelection();
if(_28a4.length===0){
return;
}
var dx=0,dy=0;
var pitch=event.shiftKey?10:1;
switch(event.keyCode){
case dojo.keys.RIGHT_ARROW:
dx=pitch;
break;
case dojo.keys.LEFT_ARROW:
dx=-pitch;
break;
case dojo.keys.DOWN_ARROW:
dy=pitch;
break;
case dojo.keys.UP_ARROW:
dy=-pitch;
break;
default:
break;
}
var _28a5=new _284e();
dojo.forEach(_28a4,function(w){
var _28a6=null;
var _28a7=w.getHelper();
if(_28a7&&_28a7.getMarginBoxPageCoords){
_28a6=_28a7.getMarginBoxPageCoords(w);
}else{
_28a6=_2856.getMarginBoxPageCoords(w.domNode);
}
var _28a8={x:_28a6.l+dx,y:_28a6.t+dy};
_28a5.add(new _2852(w,_28a8.x,_28a8.y));
},this);
if(!_28a5.isEmpty()){
this._context.getCommandStack().execute(_28a5);
this._updateTargetOverlays();
}
},_moveFocus:function(event){
var _28a9=event.shiftKey?-1:+1,_28aa=this._context.getSelection()[0],_28ab=this._context.getTopWidgets(),_28ac=_28aa?dojo.indexOf(_28ab,_28aa)+_28a9:(_28a9>0?0:_28ab.length-1),next=_28ab[_28ac];
while(next&&!next.getContext()){
_28ac=_28ac+_28a9;
next=_28ab[_28ac];
}
if(next){
this._context.select(next);
}
return next;
},onMove:function(mover,box,event){
this._mouseDownInfo=null;
var _28ad=this._context;
var cp=_28ad._chooseParent;
var _28ae=_28ad.getSelection();
var index=_28ae.indexOf(this._moverWidget);
if(index<0){
console.error("SelectTool.js onMove error. move widget is not selected");
return;
}
this._context.selectionHideFocus();
var _28af=false;
var _28b0=cp.getProposedParentWidget();
if(_28b0&&_28b0.parent&&_28b0.parent.domNode){
var _28b1=_28b0.parent.domNode;
if(_28b0.parent.domNode.tagName=="BODY"){
_28af=true;
}else{
var n=event.target;
while(n&&n.tagName!="BODY"){
if(n==_28b1){
_28af=true;
break;
}
n=n.parentNode;
}
}
}
if(!_28af||event.target!=this._moverLastEventTarget){
cp.setProposedParentWidget(null);
}
this._moverLastEventTarget=event.target;
this._moverBox=box;
this._moverDragDiv.style.left=box.l+"px";
this._moverDragDiv.style.top=box.t+"px";
if(this._moverAbsolute){
var _28b2=box.l;
var _28b3=box.t;
var dx=_28b2-this._moverStartLocations[index].l;
var dy=_28b3-this._moverStartLocations[index].t;
var absDx=Math.abs(dx);
var absDy=Math.abs(dy);
if(this._shiftKey&&(absDx>=this.CONSTRAIN_MIN_DIST||absDy>=this.CONSTRAIN_MIN_DIST)){
if(absDx>absDy){
dy=0;
}else{
dx=0;
}
}
for(var i=0;i<_28ae.length;i++){
var w=_28ae[i];
var l=this._moverStartLocationsRel[i].l;
var t=this._moverStartLocationsRel[i].t;
w.domNode.style.left=(l+dx)+"px";
w.domNode.style.top=(t+dy)+"px";
}
}
var _28b4=this._moverWidget.type;
var _28b5=this._moverWidget.getParent();
var _28b6=cp.parentListDivGet();
if(!_28b6){
_28b6=cp.parentListDivCreate({widgetType:_28b4,absolute:this._moverAbsolute,doCursor:!this._moverAbsolute,beforeAfter:null,currentParent:_28b5});
}
var _28b7=_28ad.getParentIframe();
if(_28b7){
offsetLeft=0;
offsetTop=0;
offsetNode=_28b7;
while(offsetNode&&offsetNode.tagName!="BODY"){
offsetLeft+=offsetNode.offsetLeft;
offsetTop+=offsetNode.offsetTop;
offsetNode=offsetNode.offsetParent;
}
_28b6.style.left=(offsetLeft+event.pageX)+"px";
_28b6.style.top=(offsetTop+event.pageY)+"px";
}
var _28b8=_2849.getPreferences("davinci.ve.editorPrefs",_2848.getProject());
var _28b9=(!this._shiftKey&&_28b8.snap&&this._moverAbsolute);
var _28ba=_28b9;
var _28bb=_28ad.getPreference("showPossibleParents");
var _28bc=(cp.isSpaceKeyDown()||this._spaceKey);
var _28bd=(!_28bb&&_28bc)||(_28bb&&!_28bc);
var data={type:_28b4};
var _28be={x:event.pageX,y:event.pageY};
var _28bf=null;
var _28c0=this._moverWidget.getHelper();
if(_28c0&&_28c0.getMarginBoxPageCoords){
_28bf=_28c0.getMarginBoxPageCoords(this._moverWidget);
}else{
_28bf=_2856.getMarginBoxPageCoords(this._moverWidget.domNode);
}
_28ad.dragMoveUpdate({widgets:this._moverWidgets,data:data,eventTarget:event.target,position:_28be,absolute:this._moverAbsolute,currentParent:_28b5,rect:_28bf,doSnapLinesX:_28b9,doSnapLinesY:_28ba,doFindParentsXY:_28bd,doCursor:!this._moverAbsolute});
},onFirstMove:function(mover){
},onMoveStart:function(mover){
},onMoveStop:function(mover){
var _28c1=this._context;
var cp=this._context._chooseParent;
var xpath,oldId;
if(this._moverWidget&&this._moverWidget._srcElement){
xpath=_284c.getXPath(this._moverWidget._srcElement,_284d);
oldId=this._moverWidget.id;
}
var _28c2=true;
var index,_28c3;
if(!this._moverBox||!this._moverWidget||!this._moverWidget.domNode){
_28c2=false;
}else{
_28c3={l:this._moverBox.l,t:this._moverBox.t};
var _28c4=_28c1.getSelection();
index=_28c4.indexOf(this._moverWidget);
if(index<0){
_28c2=false;
}
}
if(_28c2){
var _28c5=undefined;
if(this._sKey){
var _28c6=_2855.getStatesListCurrent(this._moverWidget.domNode);
for(var i=0;i<_28c6.length;i++){
if(_28c6[i]){
_28c5=_28c6[i];
break;
}
}
}else{
_28c5=_2855.propertyDefinedForAnyCurrentState(this._moverWidget.domNode,["left","top","right","bottom"]);
}
var _28c7=this._context.getPageLeftTop(this._moverWidget.domNode.offsetParent);
var _28c8=(_28c3.l-_28c7.l);
var _28c9=(_28c3.t-_28c7.t);
var dx=_28c8-this._moverStartLocations[index].l;
var dy=_28c9-this._moverStartLocations[index].t;
var absDx=Math.abs(dx);
var absDy=Math.abs(dy);
if(this._shiftKey&&(absDx>=this.CONSTRAIN_MIN_DIST||absDy>=this.CONSTRAIN_MIN_DIST)){
if(absDx>absDy){
_28c3.t=this._moverStartLocations[index].t;
}else{
_28c3.l=this._moverStartLocations[index].l;
}
}
this.onExtentChange({index:index,newBox:_28c3,oldBoxes:this._moverStartLocations,copy:this._altKey,applyToWhichStates:_28c5});
}
if(this._moverDragDiv){
var _28ca=this._moverDragDiv.parentNode;
if(_28ca){
_28ca.removeChild(this._moverDragDiv);
}
this._moverDragDiv=null;
}
this._mover=this._moverBox=this._moverWidget=this._moverWidgets=this._moverLastEventTarget=null;
this._updateMoveCursor();
_28c1.dragMoveCleanup();
cp.parentListDivDelete();
_28c1.selectionShowFocus();
var query=_284c.toCssPath(this._onMouseOverEventTargetXPath);
var _28cb=_28c1.getDocument();
var _28cc=query?_28cb.querySelector(query):null;
if(_28cc){
this._setTarget(_28cc);
}
},_areaSelectInit:function(_28cd,_28ce){
this._areaSelect={x:_28cd,y:_28ce,attached:false};
this._areaSelectDiv=dojo.create("div",{className:"areaSelectDiv",style:"display:none"});
},_areaSelectUpdate:function(endX,endY){
if(!this._areaSelect||!this._areaSelectDiv){
return;
}
var o=this._getBounds(this._areaSelect.x,this._areaSelect.y,endX,endY);
var style=this._areaSelectDiv.style;
style.display="block";
style.left=o.l+"px";
style.top=o.t+"px";
style.width=o.w+"px";
style.height=o.h+"px";
if(!this._areaSelect.attached){
this._context.rootNode.appendChild(this._areaSelectDiv);
this._areaSelect.attached=true;
}
},_areaSelectClear:function(){
this._areaSelect=null;
if(this._areaSelectDiv){
var _28cf=this._areaSelectDiv.parentNode;
if(_28cf){
_28cf.removeChild(this._areaSelectDiv);
}
this._areaSelectDiv=null;
}
},_areaSelectSelectWidgets:function(endX,endY){
if(!this._areaSelect){
return;
}
var o=this._getBounds(this._areaSelect.x,this._areaSelect.y,endX,endY);
var l=o.l,t=o.t,w=o.w,h=o.h;
var _28d0=this._context;
_28d0.deselect();
var _28d1=_28d0.getTopWidgets();
for(var i=0;i<_28d1.length;i++){
this._areaSelectRecursive(_28d1[i],l,t,w,h);
}
},_areaSelectRecursive:function(_28d2,l,t,w,h){
if(!_28d2||!_28d2.domNode){
return;
}
var _28d3=dojo.position(_28d2.domNode,true);
if(_28d3.x>=l&&_28d3.y>=t&&_28d3.x+_28d3.w<=l+w&&_28d3.y+_28d3.h<=t+h){
this._context.select(_28d2,true);
}else{
var _28d4=_28d2.getChildren();
for(var i=0;i<_28d4.length;i++){
this._areaSelectRecursive(_28d4[i],l,t,w,h);
}
}
},_getBounds:function(_28d5,_28d6,endX,endY){
var o={};
if(_28d5<=endX){
o.l=_28d5;
o.w=endX-_28d5;
}else{
o.l=endX;
o.w=_28d5-endX;
}
if(_28d6<=endY){
o.t=_28d6;
o.h=endY-_28d6;
}else{
o.t=endY;
o.h=_28d6-endY;
}
return o;
}});
});
},"dojo/data/util/simpleFetch":function(){
define("dojo/data/util/simpleFetch",["../../_base/lang","../../_base/kernel","./sorter"],function(lang,_28d7,_28d8){
var _28d9={};
lang.setObject("dojo.data.util.simpleFetch",_28d9);
_28d9.errorHandler=function(_28da,_28db){
if(_28db.onError){
var scope=_28db.scope||_28d7.global;
_28db.onError.call(scope,_28da,_28db);
}
};
_28d9.fetchHandler=function(items,_28dc){
var _28dd=_28dc.abort||null,_28de=false,_28df=_28dc.start?_28dc.start:0,_28e0=(_28dc.count&&(_28dc.count!==Infinity))?(_28df+_28dc.count):items.length;
_28dc.abort=function(){
_28de=true;
if(_28dd){
_28dd.call(_28dc);
}
};
var scope=_28dc.scope||_28d7.global;
if(!_28dc.store){
_28dc.store=this;
}
if(_28dc.onBegin){
_28dc.onBegin.call(scope,items.length,_28dc);
}
if(_28dc.sort){
items.sort(_28d8.createSortFunction(_28dc.sort,this));
}
if(_28dc.onItem){
for(var i=_28df;(i<items.length)&&(i<_28e0);++i){
var item=items[i];
if(!_28de){
_28dc.onItem.call(scope,item,_28dc);
}
}
}
if(_28dc.onComplete&&!_28de){
var _28e1=null;
if(!_28dc.onItem){
_28e1=items.slice(_28df,_28e0);
}
_28dc.onComplete.call(scope,_28e1,_28dc);
}
};
_28d9.fetch=function(_28e2){
_28e2=_28e2||{};
if(!_28e2.store){
_28e2.store=this;
}
this._fetchItems(_28e2,lang.hitch(this,"fetchHandler"),lang.hitch(this,"errorHandler"));
return _28e2;
};
return _28d9;
});
},"davinci/ve/actions/_SelectAncestorAction":function(){
define(["dojo/_base/declare","davinci/ve/actions/ContextAction"],function(_28e3,_28e4){
return _28e3("davinci.ve.actions._SelectAncestorAction",[_28e4],{shouldShow:function(_28e5){
_28e5=this.fixupContext(_28e5);
return _28e5&&_28e5.editor&&_28e5.editor.editorID=="davinci.ve.HTMLPageEditor";
},selectionSameParentNotBody:function(_28e6){
if(!_28e6||_28e6.length===0){
return false;
}
var _28e7=_28e6[0].getParent();
if(_28e7.domNode.tagName=="BODY"){
return false;
}
for(var i=0;i<_28e6.length;i++){
if(_28e6[i].getParent()!=_28e7){
return false;
}
}
return true;
}});
});
},"davinci/actions/SelectThemeAction":function(){
define(["dojo/_base/declare","./Action","../ui/widgets/ThemeSetSelection","../ve/commands/ChangeThemeCommand","dojo/i18n!davinci/actions/nls/actions","davinci/Workbench"],function(_28e8,_28e9,_28ea,_28eb,_28ec,_28ed){
return _28e8("davinci.actions.SelectThemeAction",_28e9,{run:function(_28ee){
var e=davinci.Workbench.getOpenEditor();
if(e&&e.isDirty){
var _28ef=e.getOnUnloadWarningMessage();
if(!_28ef){
_28ef=dojo.string.substitute(_28ec.filesHasUnsavedChanges,[e.fileName]);
}
_28ed.showDialog(_28ec.switchingThemes,_28ef,{width:300},dojo.hitch(this,this._okToSwitch),_28ec.save,null);
}else{
this._okToSwitch();
}
},_okToSwitch:function(){
var e=davinci.Workbench.getOpenEditor();
if(e.isDirty){
e.save();
}
var theme=e.getContext().getTheme();
var _28f0=e.getContext().getDojo().version.major+"."+e.getContext().getDojo().version.minor;
this._themeChooser=new _28ea({value:theme,workspaceOnly:false,dojoVersion:_28f0});
this._themeChooser.buildRendering();
},_changeTheme:function(){
var _28f1=this._themeChooser.attr("value");
this._themeChooser.onClose();
this._themeChooser.destroy();
var e=davinci.Workbench.getOpenEditor();
if(e&&e.getContext){
e.getContext().getCommandStack().execute(new _28eb(_28f1,e.getContext()));
}
}});
});
},"orion/textview/undoStack":function(){
define("orion/textview/undoStack",[],function(){
function _28f2(_28f3,text,_28f4){
this.offset=_28f3;
this.text=text;
this.previousText=_28f4;
};
_28f2.prototype={undo:function(view,_28f5){
this._doUndoRedo(this.offset,this.previousText,this.text,view,_28f5);
},redo:function(view,_28f6){
this._doUndoRedo(this.offset,this.text,this.previousText,view,_28f6);
},_doUndoRedo:function(_28f7,text,_28f8,view,_28f9){
var model=view.getModel();
if(model.mapOffset&&view.annotationModel){
var _28fa=model.mapOffset(_28f7,true);
if(_28fa<0){
var _28fb=view.annotationModel;
var iter=_28fb.getAnnotations(_28f7,_28f7+1);
while(iter.hasNext()){
var _28fc=iter.next();
if(_28fc.type==="orion.annotation.folding"){
_28fc.expand();
_28fa=model.mapOffset(_28f7,true);
break;
}
}
}
if(_28fa<0){
return;
}
_28f7=_28fa;
}
view.setText(text,_28f7,_28f7+_28f8.length);
if(_28f9){
view.setSelection(_28f7,_28f7+text.length);
}
}};
function _28fd(){
this.changes=[];
};
_28fd.prototype={add:function(_28fe){
this.changes.push(_28fe);
},end:function(view){
this.endSelection=view.getSelection();
this.endCaret=view.getCaretOffset();
},undo:function(view,_28ff){
for(var i=this.changes.length-1;i>=0;i--){
this.changes[i].undo(view,false);
}
if(_28ff){
var start=this.startSelection.start;
var end=this.startSelection.end;
view.setSelection(this.startCaret?start:end,this.startCaret?end:start);
}
},redo:function(view,_2900){
for(var i=0;i<this.changes.length;i++){
this.changes[i].redo(view,false);
}
if(_2900){
var start=this.endSelection.start;
var end=this.endSelection.end;
view.setSelection(this.endCaret?start:end,this.endCaret?end:start);
}
},start:function(view){
this.startSelection=view.getSelection();
this.startCaret=view.getCaretOffset();
}};
function _2901(view,size){
this.view=view;
this.size=size!==undefined?size:100;
this.reset();
var model=view.getModel();
if(model.getBaseModel){
model=model.getBaseModel();
}
this.model=model;
var self=this;
this._listener={onChanging:function(e){
self._onChanging(e);
},onDestroy:function(e){
self._onDestroy(e);
}};
model.addEventListener("Changing",this._listener.onChanging);
view.addEventListener("Destroy",this._listener.onDestroy);
};
_2901.prototype={add:function(_2902){
if(this.compoundChange){
this.compoundChange.add(_2902);
}else{
var _2903=this.stack.length;
this.stack.splice(this.index,_2903-this.index,_2902);
this.index++;
if(this.stack.length>this.size){
this.stack.shift();
this.index--;
this.cleanIndex--;
}
}
},markClean:function(){
this.endCompoundChange();
this._commitUndo();
this.cleanIndex=this.index;
},isClean:function(){
return this.cleanIndex===this.getSize().undo;
},canUndo:function(){
return this.getSize().undo>0;
},canRedo:function(){
return this.getSize().redo>0;
},endCompoundChange:function(){
if(this.compoundChange){
this.compoundChange.end(this.view);
}
this.compoundChange=undefined;
},getSize:function(){
var index=this.index;
var _2904=this.stack.length;
if(this._undoStart!==undefined){
index++;
}
return {undo:index,redo:(_2904-index)};
},undo:function(){
this._commitUndo();
if(this.index<=0){
return false;
}
var _2905=this.stack[--this.index];
this._ignoreUndo=true;
_2905.undo(this.view,true);
this._ignoreUndo=false;
return true;
},redo:function(){
this._commitUndo();
if(this.index>=this.stack.length){
return false;
}
var _2906=this.stack[this.index++];
this._ignoreUndo=true;
_2906.redo(this.view,true);
this._ignoreUndo=false;
return true;
},reset:function(){
this.index=this.cleanIndex=0;
this.stack=[];
this._undoStart=undefined;
this._undoText="";
this._undoType=0;
this._ignoreUndo=false;
this._compoundChange=undefined;
},startCompoundChange:function(){
this._commitUndo();
var _2907=new _28fd();
this.add(_2907);
this.compoundChange=_2907;
this.compoundChange.start(this.view);
},_commitUndo:function(){
if(this._undoStart!==undefined){
if(this._undoType===-1){
this.add(new _28f2(this._undoStart,"",this._undoText));
}else{
this.add(new _28f2(this._undoStart,this._undoText,""));
}
this._undoStart=undefined;
this._undoText="";
this._undoType=0;
}
},_onDestroy:function(evt){
this.model.removeEventListener("Changing",this._listener.onChanging);
this.view.removeEventListener("Destroy",this._listener.onDestroy);
},_onChanging:function(e){
var _2908=e.text;
var start=e.start;
var _2909=e.removedCharCount;
var _290a=e.addedCharCount;
if(this._ignoreUndo){
return;
}
if(this._undoStart!==undefined&&!((_290a===1&&_2909===0&&this._undoType===1&&start===this._undoStart+this._undoText.length)||(_290a===0&&_2909===1&&this._undoType===-1&&(((start+1)===this._undoStart)||(start===this._undoStart))))){
this._commitUndo();
}
if(!this.compoundChange){
if(_290a===1&&_2909===0){
if(this._undoStart===undefined){
this._undoStart=start;
}
this._undoText=this._undoText+_2908;
this._undoType=1;
return;
}else{
if(_290a===0&&_2909===1){
var _290b=this._undoText.length>0&&this._undoStart===start;
this._undoStart=start;
this._undoType=-1;
if(_290b){
this._undoText=this._undoText+this.model.getText(start,start+_2909);
}else{
this._undoText=this.model.getText(start,start+_2909)+this._undoText;
}
return;
}
}
}
this.add(new _28f2(start,_2908,this.model.getText(start,start+_2909)));
}};
return {UndoStack:_2901};
});
},"orion/textview/textModel":function(){
define("orion/textview/textModel",["orion/textview/eventTarget"],function(_290c){
var _290d=window.navigator.platform.indexOf("Win")!==-1;
function _290e(text,_290f){
this._lastLineIndex=-1;
this._text=[""];
this._lineOffsets=[0];
this.setText(text);
this.setLineDelimiter(_290f);
};
_290e.prototype={find:function(_2910){
if(this._text.length>1){
this._text=[this._text.join("")];
}
var _2911=_2910.string;
var regex=_2910.regex;
var _2912=_2911;
if(!regex&&_2911){
_2912=_2911.replace(/([\\$\^*\/+?\.\(\)|{}\[\]])/g,"\\$&");
}
var _2913=null,skip;
if(_2912){
var _2914=_2910.reverse;
var wrap=_2910.wrap;
var _2915=_2910.wholeWord;
var _2916=_2910.caseInsensitive;
var start=_2910.start||0;
var end=_2910.end;
var _2917=_2910.end!==undefined;
var flags="";
if(flags.indexOf("g")===-1){
flags+="g";
}
if(_2916){
if(flags.indexOf("i")===-1){
flags+="i";
}
}
if(_2915){
_2912="\\b"+_2912+"\\b";
}
var text=this._text[0],_2918,_2919,_291a=0;
if(_2917){
text=text.substring(start,end);
_291a=start;
}
var re=new RegExp(_2912,flags);
if(_2914){
skip=function(){
var match=null;
re.lastIndex=0;
while(true){
_2919=re.lastIndex;
_2918=re.exec(text);
if(_2919===re.lastIndex){
return null;
}
if(_2918){
if(_2918.index<start){
match={start:_2918.index+_291a,end:re.lastIndex+_291a};
}else{
if(!wrap||match){
break;
}
start=text.length;
match={start:_2918.index+_291a,end:re.lastIndex+_291a};
}
}else{
break;
}
}
if(match){
start=match.start;
}
return match;
};
}else{
if(!_2917){
re.lastIndex=start;
}
skip=function(){
while(true){
_2919=re.lastIndex;
_2918=re.exec(text);
if(_2919===re.lastIndex){
return null;
}
if(_2918){
return {start:_2918.index+_291a,end:re.lastIndex+_291a};
}
if(_2919!==0){
if(wrap){
continue;
}
}
break;
}
return null;
};
}
_2913=skip();
}
return {next:function(){
var _291b=_2913;
if(_291b){
_2913=skip();
}
return _291b;
},hasNext:function(){
return _2913!==null;
}};
},getCharCount:function(){
var count=0;
for(var i=0;i<this._text.length;i++){
count+=this._text[i].length;
}
return count;
},getLine:function(_291c,_291d){
var _291e=this.getLineCount();
if(!(0<=_291c&&_291c<_291e)){
return null;
}
var start=this._lineOffsets[_291c];
if(_291c+1<_291e){
var text=this.getText(start,this._lineOffsets[_291c+1]);
if(_291d){
return text;
}
var end=text.length,c;
while(((c=text.charCodeAt(end-1))===10)||(c===13)){
end--;
}
return text.substring(0,end);
}else{
return this.getText(start);
}
},getLineAtOffset:function(_291f){
var _2920=this.getCharCount();
if(!(0<=_291f&&_291f<=_2920)){
return -1;
}
var _2921=this.getLineCount();
if(_291f===_2920){
return _2921-1;
}
var _2922,_2923;
var index=this._lastLineIndex;
if(0<=index&&index<_2921){
_2922=this._lineOffsets[index];
_2923=index+1<_2921?this._lineOffsets[index+1]:_2920;
if(_2922<=_291f&&_291f<_2923){
return index;
}
}
var high=_2921;
var low=-1;
while(high-low>1){
index=Math.floor((high+low)/2);
_2922=this._lineOffsets[index];
_2923=index+1<_2921?this._lineOffsets[index+1]:_2920;
if(_291f<=_2922){
high=index;
}else{
if(_291f<_2923){
high=index;
break;
}else{
low=index;
}
}
}
this._lastLineIndex=high;
return high;
},getLineCount:function(){
return this._lineOffsets.length;
},getLineDelimiter:function(){
return this._lineDelimiter;
},getLineEnd:function(_2924,_2925){
var _2926=this.getLineCount();
if(!(0<=_2924&&_2924<_2926)){
return -1;
}
if(_2924+1<_2926){
var end=this._lineOffsets[_2924+1];
if(_2925){
return end;
}
var text=this.getText(Math.max(this._lineOffsets[_2924],end-2),end);
var i=text.length,c;
while(((c=text.charCodeAt(i-1))===10)||(c===13)){
i--;
}
return end-(text.length-i);
}else{
return this.getCharCount();
}
},getLineStart:function(_2927){
if(!(0<=_2927&&_2927<this.getLineCount())){
return -1;
}
return this._lineOffsets[_2927];
},getText:function(start,end){
if(start===undefined){
start=0;
}
if(end===undefined){
end=this.getCharCount();
}
if(start===end){
return "";
}
var _2928=0,chunk=0,_2929;
while(chunk<this._text.length){
_2929=this._text[chunk].length;
if(start<=_2928+_2929){
break;
}
_2928+=_2929;
chunk++;
}
var _292a=_2928;
var _292b=chunk;
while(chunk<this._text.length){
_2929=this._text[chunk].length;
if(end<=_2928+_2929){
break;
}
_2928+=_2929;
chunk++;
}
var _292c=_2928;
var _292d=chunk;
if(_292b===_292d){
return this._text[_292b].substring(start-_292a,end-_292c);
}
var _292e=this._text[_292b].substring(start-_292a);
var _292f=this._text[_292d].substring(0,end-_292c);
return _292e+this._text.slice(_292b+1,_292d).join("")+_292f;
},onChanging:function(_2930){
return this.dispatchEvent(_2930);
},onChanged:function(_2931){
return this.dispatchEvent(_2931);
},setLineDelimiter:function(_2932,all){
if(_2932==="auto"){
_2932=undefined;
if(this.getLineCount()>1){
_2932=this.getText(this.getLineEnd(0),this.getLineEnd(0,true));
}
}
this._lineDelimiter=_2932?_2932:(_290d?"\r\n":"\n");
if(all){
var _2933=this.getLineCount();
if(_2933>1){
var lines=new Array(_2933);
for(var i=0;i<_2933;i++){
lines[i]=this.getLine(i);
}
this.setText(lines.join(this._lineDelimiter));
}
}
},setText:function(text,start,end){
if(text===undefined){
text="";
}
if(start===undefined){
start=0;
}
if(end===undefined){
end=this.getCharCount();
}
if(start===end&&text===""){
return;
}
var _2934=this.getLineAtOffset(start);
var _2935=this.getLineAtOffset(end);
var _2936=start;
var _2937=end-start;
var _2938=_2935-_2934;
var _2939=text.length;
var _293a=0;
var _293b=this.getLineCount();
var cr=0,lf=0,index=0;
var _293c=[];
while(true){
if(cr!==-1&&cr<=index){
cr=text.indexOf("\r",index);
}
if(lf!==-1&&lf<=index){
lf=text.indexOf("\n",index);
}
if(lf===-1&&cr===-1){
break;
}
if(cr!==-1&&lf!==-1){
if(cr+1===lf){
index=lf+1;
}else{
index=(cr<lf?cr:lf)+1;
}
}else{
if(cr!==-1){
index=cr+1;
}else{
index=lf+1;
}
}
_293c.push(start+index);
_293a++;
}
var _293d={type:"Changing",text:text,start:_2936,removedCharCount:_2937,addedCharCount:_2939,removedLineCount:_2938,addedLineCount:_293a};
this.onChanging(_293d);
if(_293c.length===0){
var _293e=this.getLineStart(_2934),_293f;
if(_2935+1<_293b){
_293f=this.getLineStart(_2935+1);
}else{
_293f=this.getCharCount();
}
if(start!==_293e){
text=this.getText(_293e,start)+text;
start=_293e;
}
if(end!==_293f){
text=text+this.getText(end,_293f);
end=_293f;
}
}
var _2940=_2939-_2937;
for(var j=_2934+_2938+1;j<_293b;j++){
this._lineOffsets[j]+=_2940;
}
var args=[_2934+1,_2938].concat(_293c);
Array.prototype.splice.apply(this._lineOffsets,args);
var _2941=0,chunk=0,_2942;
while(chunk<this._text.length){
_2942=this._text[chunk].length;
if(start<=_2941+_2942){
break;
}
_2941+=_2942;
chunk++;
}
var _2943=_2941;
var _2944=chunk;
while(chunk<this._text.length){
_2942=this._text[chunk].length;
if(end<=_2941+_2942){
break;
}
_2941+=_2942;
chunk++;
}
var _2945=_2941;
var _2946=chunk;
var _2947=this._text[_2944];
var _2948=this._text[_2946];
var _2949=_2947.substring(0,start-_2943);
var _294a=_2948.substring(end-_2945);
var _294b=[_2944,_2946-_2944+1];
if(_2949){
_294b.push(_2949);
}
if(text){
_294b.push(text);
}
if(_294a){
_294b.push(_294a);
}
Array.prototype.splice.apply(this._text,_294b);
if(this._text.length===0){
this._text=[""];
}
var _294c={type:"Changed",start:_2936,removedCharCount:_2937,addedCharCount:_2939,removedLineCount:_2938,addedLineCount:_293a};
this.onChanged(_294c);
}};
_290c.EventTarget.addMixin(_290e.prototype);
return {TextModel:_290e};
});
},"davinci/ve/palette/HtmlWidgets":function(){
define(["dojo/_base/declare","davinci/workbench/ViewPart","davinci/ve/palette/Palette"],function(_294d,_294e,_294f){
return _294d("davinci.ve.palette.HtmlWidgets",_294e,{constructor:function(_2950,_2951){
dojo.subscribe("/davinci/ui/editorSelected",dojo.hitch(this,this._editorSelected));
},_editorSelected:function(_2952){
if(_2952.editor&&_2952.editor.supports("palette")){
this.setContext([_2952.editor.getContext()]);
dojo.removeClass(this.palette.domNode,"dijitHidden");
}else{
this.palette.domNode.scrollTop=0;
dojo.addClass(this.palette.domNode,"dijitHidden");
}
},postCreate:function(){
this.inherited(arguments);
this.palette=new _294f();
this.palette.descriptors="dijit,dojox,html,OpenAjax";
this.setContent(this.palette);
this.attachToolbar();
this.palette._loadPalette();
dojo.addClass(this.palette.domNode,"dijitHidden");
},setContext:function(_2953){
this.palette.setContext(_2953[0]);
}});
});
},"davinci/ui/UserLibraries":function(){
require({cache:{"url:davinci/ui/templates/UserLibraries.html":"<div class='userLibDialog'>\r\n\t<div class=\"dijitDialogPaneContentArea\">\r\n\t\t<div dojoAttachPoint=\"_tableDiv\"></div>\r\n\t</div>\r\n\r\n\t<div class=\"dijitDialogPaneActionBar\">\r\n\t\t<button dojoType='dijit.form.Button' type='submit' dojoAttachEvent='onClick:okButton' label='${modify}' class=\"maqPrimaryButton\"></button> \r\n\t\t<button dojoType='dijit.form.Button' dojoAttachEvent='onClick:cancelButton' label='${buttonCancel}' class=\"maqSecondaryButton\"></button> \r\n\t</div> \r\n</div>"}});
define("davinci/ui/UserLibraries",["dojo/_base/declare","dijit/_WidgetBase","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","dojo/promise/all","../Workbench","dijit/form/Button","dijit/form/TextBox","dijit/form/RadioButton","dijit/MenuItem","dijit/Menu","../library","dijit/form/ComboBox","dojo/i18n!./nls/ui","dojo/i18n!dijit/nls/common","../model/Path","system/resource","../ve/RebuildPage","dojo/text!./templates/UserLibraries.html","../Theme"],function(_2954,_2955,_2956,_2957,all,_2958,_2959,_295a,_295b,_295c,Menu,_295d,_295e,uiNLS,_295f,Path,_2960,_2961,_2962,Theme){
return _2954([_2955,_2956,_2957],{postMixInProperties:function(){
dojo.mixin(this,_295f);
dojo.mixin(this,uiNLS);
this.inherited(arguments);
},_tableDiv:null,templateString:_2962,buildRendering:function(){
this.inherited(arguments);
this._handles=[];
this._allLibs=_295d.getInstalledLibs();
this._userLibs=_295d.getUserLibs(this.getResourceBase());
var _2963=["<table cellspacing='0' cellpadding='0' width='100%'>","<tr><td class='header'></td><td class='header'>{library}</td><td class='header'>{version}</td><td class='header'>{workspaceLocation}</td></tr>","<tr></tr>"];
this.libraries={};
this._allLibs.forEach(function(lib,i){
lib.initRoot=this._getLibRoot(lib.id,lib.version);
var name=lib.id;
lib.checked=false;
if(this._getUserLib(lib.id,lib.version)){
lib.checked=true;
}
var _2964="";
var _2965=lib.checked||lib.required?"checked":"";
if(lib.required){
_2963.push("<tr style='display:none'>");
}else{
_2963.push("<tr>");
}
_2963.push("<td class='columna'><input type='checkbox' libItemCheck='"+i+"'"+_2965+"></input></td>");
_2963.push("<td class='columnb'>"+name+"</td>");
_2963.push("<td class='columnc'>"+lib.version+"</td>");
if(lib.initRoot){
_2963.push("<td class='columnd'><input type='text' value='"+lib.initRoot+"' libItemPath='"+i+"'></input></td>");
}else{
_2963.push("<td class='columnd'></td>");
}
_2963.push("</tr>");
},this);
_2963.push("</table>");
var html=dojo.replace(_2963.join(""),uiNLS);
dojo.place(html,this._tableDiv);
},getResourceBase:function(){
if(_2958.singleProjectMode()){
return _2960.getRoot().getName();
}
},_destroy:function(){
var _2966=this.domNode;
dojo.forEach(dojo.query("[widgetId]",_2966).map(dijit.byNode),function(w){
w.destroy();
});
while(_2966.firstChild){
dojo._destroyElement(_2966.firstChild);
}
this.topDiv=dojo.doc.createElement("div");
this.container.appendChild(this.topDiv);
dojo.forEach(this._handles,dojo.disconnect);
this._handles=[];
},_getLibRoot:function(id,_2967){
var _2968;
if(!this._userLibs.some(function(lib){
if(lib.id==id&&lib.version==_2967){
_2968=lib.root;
return true;
}
})){
this._allLibs.some(function(lib){
if(lib.id==id&&lib.version==_2967){
_2968=lib.root;
return true;
}
});
}
return _2968;
},_getUserLib:function(id,_2969){
return this._userLibs.some(function(lib){
return lib.id==id&&lib.version==_2969;
});
},_makeChange:function(_296a){
if(_296a.length){
var isOk=_295d.modifyLib(_296a);
var _296b=[];
for(var i=0;i<_296a.length;i++){
var _296c=new Path(_296a[i].base);
var found=_296b.some(function(path){
return path.equals(_296c);
});
if(!found){
_296b.push(_296c);
}
}
dojo.subscribe("/davinci/ui/libraryChanged",this,function(){
_2960.findResourceAsync("*.html",true,this.getResourceBase(),true).then(function(pages){
var _296d=new _2961(),_296e=[];
pages.forEach(function(page){
if(Theme.isThemeHTML(page)){
return;
}
_296e.push(_296d.rebuildSource(page.getContentSync(),page).then(function(_296f){
page.setContents(_296f,false);
}));
});
all(_296e).then(function(){
this.onClose();
});
}.bind(this));
});
_296b.forEach(function(path){
var loc=path.toString();
_2960.resourceChanged("reload",loc);
_295d.themesChanged(loc);
});
dojo.publish("/davinci/ui/libraryChanged/start");
}
},_processChanges:function(){
var _2970=[];
function _2971(id,_2972){
for(var i=0;i<_2970.length;i++){
if(_2970[i].id==id&&_2970[i].version==_2972){
return _2970[i];
}
}
};
dojo.query("[libItemCheck]",this.domNode).forEach(function(node){
var _2973=parseInt(dojo.attr(node,"libItemCheck")),value=dojo.attr(node,"checked"),lib=this._allLibs[_2973];
if(lib.checked!=value){
var item=_2971(lib.id,lib.version);
if(!item){
item={id:lib.id,version:lib.version};
_2970.push(item);
}
item.installed=value;
item.base=this.getResourceBase();
}
},this);
dojo.query("[libItemPath]",this.domNode).forEach(function(node){
var _2974=parseInt(dojo.attr(node,"libItemPath")),value=dojo.attr(node,"value"),lib=this._allLibs[_2974];
if(lib.initRoot!=value){
var item=_2971(lib.id,lib.version);
if(!item){
item={id:lib.id,version:lib.version};
_2970.push(item);
}
item.path=value;
item.oldPath=lib.initRoot;
item.base=this.getResourceBase();
}
},this);
this._makeChange(_2970);
},okButton:function(){
this._processChanges();
},cancelButton:function(){
this.onClose();
},_rewriteDojo:function(){
var _2975=dojo.attr(this.__rewriteDojo,"checked");
dojo.attr(this.__rewriteDojoURL,"disabled",!_2975);
}});
});
},"dijit/form/ComboBoxMixin":function(){
require({cache:{"url:dijit/form/templates/DropDownBox.html":"<div class=\"dijit dijitReset dijitInline dijitLeft\"\n\tid=\"widget_${id}\"\n\trole=\"combobox\"\n\t><div class='dijitReset dijitRight dijitButtonNode dijitArrowButton dijitDownArrowButton dijitArrowButtonContainer'\n\t\tdata-dojo-attach-point=\"_buttonNode, _popupStateNode\" role=\"presentation\"\n\t\t><input class=\"dijitReset dijitInputField dijitArrowButtonInner\" value=\"&#9660; \" type=\"text\" tabIndex=\"-1\" readonly=\"readonly\" role=\"presentation\"\n\t\t\t${_buttonInputDisabled}\n\t/></div\n\t><div class='dijitReset dijitValidationContainer'\n\t\t><input class=\"dijitReset dijitInputField dijitValidationIcon dijitValidationInner\" value=\"&#935; \" type=\"text\" tabIndex=\"-1\" readonly=\"readonly\" role=\"presentation\"\n\t/></div\n\t><div class=\"dijitReset dijitInputField dijitInputContainer\"\n\t\t><input class='dijitReset dijitInputInner' ${!nameAttrSetting} type=\"text\" autocomplete=\"off\"\n\t\t\tdata-dojo-attach-point=\"textbox,focusNode\" role=\"textbox\" aria-haspopup=\"true\"\n\t/></div\n></div>\n"}});
define("dijit/form/ComboBoxMixin",["dojo/_base/declare","dojo/_base/Deferred","dojo/_base/kernel","dojo/_base/lang","dojo/store/util/QueryResults","./_AutoCompleterMixin","./_ComboBoxMenu","../_HasDropDown","dojo/text!./templates/DropDownBox.html"],function(_2976,_2977,_2978,lang,_2979,_297a,_297b,_297c,_297d){
return _2976("dijit.form.ComboBoxMixin",[_297c,_297a],{dropDownClass:_297b,hasDownArrow:true,templateString:_297d,baseClass:"dijitTextBox dijitComboBox",cssStateNodes:{"_buttonNode":"dijitDownArrowButton"},_setHasDownArrowAttr:function(val){
this._set("hasDownArrow",val);
this._buttonNode.style.display=val?"":"none";
},_showResultList:function(){
this.displayMessage("");
this.inherited(arguments);
},_setStoreAttr:function(store){
if(!store.get){
lang.mixin(store,{_oldAPI:true,get:function(id){
var _297e=new _2977();
this.fetchItemByIdentity({identity:id,onItem:function(_297f){
_297e.resolve(_297f);
},onError:function(error){
_297e.reject(error);
}});
return _297e.promise;
},query:function(query,_2980){
var _2981=new _2977(function(){
_2982.abort&&_2982.abort();
});
_2981.total=new _2977();
var _2982=this.fetch(lang.mixin({query:query,onBegin:function(count){
_2981.total.resolve(count);
},onComplete:function(_2983){
_2981.resolve(_2983);
},onError:function(error){
_2981.reject(error);
}},_2980));
return _2979(_2981);
}});
}
this._set("store",store);
},postMixInProperties:function(){
var store=this.params.store||this.store;
if(store){
this._setStoreAttr(store);
}
this.inherited(arguments);
if(!this.params.store&&!this.store._oldAPI){
var clazz=this.declaredClass;
lang.mixin(this.store,{getValue:function(item,attr){
_2978.deprecated(clazz+".store.getValue(item, attr) is deprecated for builtin store.  Use item.attr directly","","2.0");
return item[attr];
},getLabel:function(item){
_2978.deprecated(clazz+".store.getLabel(item) is deprecated for builtin store.  Use item.label directly","","2.0");
return item.name;
},fetch:function(args){
_2978.deprecated(clazz+".store.fetch() is deprecated for builtin store.","Use store.query()","2.0");
var shim=["dojo/data/ObjectStore"];
require(shim,lang.hitch(this,function(_2984){
new _2984({objectStore:this}).fetch(args);
}));
}});
}
}});
});
},"dijit/tree/dndSource":function(){
define("dijit/tree/dndSource",["dojo/_base/array","dojo/_base/connect","dojo/_base/declare","dojo/dom-class","dojo/dom-geometry","dojo/_base/lang","dojo/on","dojo/touch","dojo/topic","dojo/dnd/Manager","./_dndSelector"],function(array,_2985,_2986,_2987,_2988,lang,on,touch,topic,_2989,_298a){
var _298b=_2986("dijit.tree.dndSource",_298a,{isSource:true,accept:["text","treeNode"],copyOnly:false,dragThreshold:5,betweenThreshold:0,generateText:true,constructor:function(tree,_298c){
if(!_298c){
_298c={};
}
lang.mixin(this,_298c);
var type=_298c.accept instanceof Array?_298c.accept:["text","treeNode"];
this.accept=null;
if(type.length){
this.accept={};
for(var i=0;i<type.length;++i){
this.accept[type[i]]=1;
}
}
this.isDragging=false;
this.mouseDown=false;
this.targetAnchor=null;
this.targetBox=null;
this.dropPosition="";
this._lastX=0;
this._lastY=0;
this.sourceState="";
if(this.isSource){
_2987.add(this.node,"dojoDndSource");
}
this.targetState="";
if(this.accept){
_2987.add(this.node,"dojoDndTarget");
}
this.topics=[topic.subscribe("/dnd/source/over",lang.hitch(this,"onDndSourceOver")),topic.subscribe("/dnd/start",lang.hitch(this,"onDndStart")),topic.subscribe("/dnd/drop",lang.hitch(this,"onDndDrop")),topic.subscribe("/dnd/cancel",lang.hitch(this,"onDndCancel"))];
},checkAcceptance:function(){
return true;
},copyState:function(_298d){
return this.copyOnly||_298d;
},destroy:function(){
this.inherited(arguments);
var h;
while(h=this.topics.pop()){
h.remove();
}
this.targetAnchor=null;
},_onDragMouse:function(e,_298e){
var m=_2989.manager(),_298f=this.targetAnchor,_2990=this.current,_2991=this.dropPosition;
var _2992="Over";
if(_2990&&this.betweenThreshold>0){
if(!this.targetBox||_298f!=_2990){
this.targetBox=_2988.position(_2990.rowNode,true);
}
if((e.pageY-this.targetBox.y)<=this.betweenThreshold){
_2992="Before";
}else{
if((e.pageY-this.targetBox.y)>=(this.targetBox.h-this.betweenThreshold)){
_2992="After";
}
}
}
if(_298e||_2990!=_298f||_2992!=_2991){
if(_298f){
this._removeItemClass(_298f.rowNode,_2991);
}
if(_2990){
this._addItemClass(_2990.rowNode,_2992);
}
if(!_2990){
m.canDrop(false);
}else{
if(_2990==this.tree.rootNode&&_2992!="Over"){
m.canDrop(false);
}else{
var _2993=false;
if(m.source==this){
for(var _2994 in this.selection){
var _2995=this.selection[_2994];
if(_2995.item===_2990.item){
_2993=true;
break;
}
}
}
if(_2993){
m.canDrop(false);
}else{
if(this.checkItemAcceptance(_2990.rowNode,m.source,_2992.toLowerCase())&&!this._isParentChildDrop(m.source,_2990.rowNode)){
m.canDrop(true);
}else{
m.canDrop(false);
}
}
}
}
this.targetAnchor=_2990;
this.dropPosition=_2992;
}
},onMouseMove:function(e){
if(this.isDragging&&this.targetState=="Disabled"){
return;
}
this.inherited(arguments);
var m=_2989.manager();
if(this.isDragging){
this._onDragMouse(e);
}else{
if(this.mouseDown&&this.isSource&&(Math.abs(e.pageX-this._lastX)>=this.dragThreshold||Math.abs(e.pageY-this._lastY)>=this.dragThreshold)){
var nodes=this.getSelectedTreeNodes();
if(nodes.length){
if(nodes.length>1){
var seen=this.selection,i=0,r=[],n,p;
nextitem:
while((n=nodes[i++])){
for(p=n.getParent();p&&p!==this.tree;p=p.getParent()){
if(seen[p.id]){
continue nextitem;
}
}
r.push(n);
}
nodes=r;
}
nodes=array.map(nodes,function(n){
return n.domNode;
});
m.startDrag(this,nodes,this.copyState(_2985.isCopyKey(e)));
this._onDragMouse(e,true);
}
}
}
},onMouseDown:function(e){
this.mouseDown=true;
this.mouseButton=e.button;
this._lastX=e.pageX;
this._lastY=e.pageY;
this.inherited(arguments);
},onMouseUp:function(e){
if(this.mouseDown){
this.mouseDown=false;
this.inherited(arguments);
}
},onMouseOut:function(){
this.inherited(arguments);
this._unmarkTargetAnchor();
},checkItemAcceptance:function(){
return true;
},onDndSourceOver:function(_2996){
if(this!=_2996){
this.mouseDown=false;
this._unmarkTargetAnchor();
}else{
if(this.isDragging){
var m=_2989.manager();
m.canDrop(false);
}
}
},onDndStart:function(_2997,nodes,copy){
if(this.isSource){
this._changeState("Source",this==_2997?(copy?"Copied":"Moved"):"");
}
var _2998=this.checkAcceptance(_2997,nodes);
this._changeState("Target",_2998?"":"Disabled");
if(this==_2997){
_2989.manager().overSource(this);
}
this.isDragging=true;
},itemCreator:function(nodes){
return array.map(nodes,function(node){
return {"id":node.id,"name":node.textContent||node.innerText||""};
});
},onDndDrop:function(_2999,nodes,copy){
if(this.containerState=="Over"){
var tree=this.tree,model=tree.model,_299a=this.targetAnchor;
this.isDragging=false;
var _299b;
var _299c;
var _299d;
_299b=(_299a&&_299a.item)||tree.item;
if(this.dropPosition=="Before"||this.dropPosition=="After"){
_299b=(_299a.getParent()&&_299a.getParent().item)||tree.item;
_299c=_299a.getIndexInParent();
if(this.dropPosition=="After"){
_299c=_299a.getIndexInParent()+1;
_299d=_299a.getNextSibling()&&_299a.getNextSibling().item;
}else{
_299d=_299a.item;
}
}else{
_299b=(_299a&&_299a.item)||tree.item;
}
var _299e;
array.forEach(nodes,function(node,idx){
var _299f=_2999.getItem(node.id);
if(array.indexOf(_299f.type,"treeNode")!=-1){
var _29a0=_299f.data,_29a1=_29a0.item,_29a2=_29a0.getParent().item;
}
if(_2999==this){
if(typeof _299c=="number"){
if(_299b==_29a2&&_29a0.getIndexInParent()<_299c){
_299c-=1;
}
}
model.pasteItem(_29a1,_29a2,_299b,copy,_299c,_299d);
}else{
if(model.isItem(_29a1)){
model.pasteItem(_29a1,_29a2,_299b,copy,_299c,_299d);
}else{
if(!_299e){
_299e=this.itemCreator(nodes,_299a.rowNode,_2999);
}
model.newItem(_299e[idx],_299b,_299c,_299d);
}
}
},this);
this.tree._expandNode(_299a);
}
this.onDndCancel();
},onDndCancel:function(){
this._unmarkTargetAnchor();
this.isDragging=false;
this.mouseDown=false;
delete this.mouseButton;
this._changeState("Source","");
this._changeState("Target","");
},onOverEvent:function(){
this.inherited(arguments);
_2989.manager().overSource(this);
},onOutEvent:function(){
this._unmarkTargetAnchor();
var m=_2989.manager();
if(this.isDragging){
m.canDrop(false);
}
m.outSource(this);
this.inherited(arguments);
},_isParentChildDrop:function(_29a3,_29a4){
if(!_29a3.tree||_29a3.tree!=this.tree){
return false;
}
var root=_29a3.tree.domNode;
var ids=_29a3.selection;
var node=_29a4.parentNode;
while(node!=root&&!ids[node.id]){
node=node.parentNode;
}
return node.id&&ids[node.id];
},_unmarkTargetAnchor:function(){
if(!this.targetAnchor){
return;
}
this._removeItemClass(this.targetAnchor.rowNode,this.dropPosition);
this.targetAnchor=null;
this.targetBox=null;
this.dropPosition=null;
},_markDndStatus:function(copy){
this._changeState("Source",copy?"Copied":"Moved");
}});
return _298b;
});
},"davinci/ve/ChooseParent":function(){
define(["dojo/_base/declare","davinci/Runtime","./widget","./_Widget","./metadata","davinci/ve/utils/GeomUtils"],function(_29a5,_29a6,_29a7,_29a8,_29a9,_29aa){
return _29a5("davinci.ve.ChooseParent",null,{constructor:function(args){
this._context=args.context;
},getAllowedTargetWidget:function(_29ab,data,climb,_29ac){
var _29ad=_29a7.getEnclosingWidget,_29ae=_29ab,_29af=[],_29b0=[];
data=data.length?data:[data];
var _29b1=this;
data.forEach(function(elem){
_29b0.push({type:elem.type,allowedParent:_29a9.getAllowedParent(elem.type),classList:_29b1.getClassList(elem.type)});
});
do{
var _29b2=_29ae instanceof _29a8?_29ae.type:_29ae._dvWidget.type;
var _29b3=this.getClassList(_29b2);
if(this.isAllowed(_29b0,_29ae,_29b2,_29b3,_29ac)){
_29af.push(_29ae);
}
_29ae=_29ad(_29ae);
}while(_29ae&&climb);
return _29af;
},isAllowed:function(_29b4,_29b5,_29b6,_29b7,_29b8){
function _29b9(arr,_29ba){
return _29ba.some(function(elem){
return arr.indexOf(elem)!==-1;
});
};
var _29bb=_29a9.getAllowedChild(_29b6);
if(_29b6==="html.body"){
_29bb=["ANY"];
}
return _29b4.every(function(child){
var _29bc=_29bb[0]!=="NONE"&&(_29bb[0]==="ANY"||_29b9(_29bb,child.classList));
var _29bd=child.allowedParent[0]==="ANY"||_29b9(child.allowedParent,_29b7);
var _29be=_29a7.getWidgetHelper(child.type);
if(_29be&&_29be.isAllowed){
return _29be.isAllowed({childType:child.type,childClassList:child.classList,parentType:_29b6,parentClassList:_29b7,absolute:_29b8.absolute,isAllowedChild:_29bc,isAllowedParent:_29bd});
}else{
return _29bc&&_29bd;
}
});
},getClassList:function(type){
var _29bf=_29a9.queryDescriptor(type,"class");
if(_29bf){
_29bf=_29bf.split(/\s+/);
_29bf.push(type);
return _29bf;
}
return [type];
},dragUpdateCandidateParents:function(_29c0){
var _29c1=_29c0.widgetType,_29c2=_29c0.showCandidateParents,_29c3=_29c0.doCursor,_29c4=_29c0.absolute,_29c5=_29c0.currentParent;
var _29c6=this._XYParent;
if(!this._proposedParentWidget){
this._proposedParentWidget=this._getDefaultParent(_29c1,_29c6,_29c4,_29c5);
}
if(_29c2||_29c3){
this.highlightNewWidgetParent(this._proposedParentWidget);
}
var _29c7=this._context;
var _29c8=_29c7.getActiveDragDiv();
var _29c9;
if(_29c8){
var elems=dojo.query(".maqCandidateParents",_29c8);
if(elems.length==1){
_29c9=elems[0];
}
}
if(_29c9){
if(_29c2){
var same=true;
if(this._lastProposedParentWidget!=this._proposedParentWidget){
same=false;
}else{
if(typeof this._lastAllowedParentList=="undefined"||this._lastAllowedParentList===null){
same=false;
}else{
if(this._lastAllowedParentList.length!=_29c6.length){
same=false;
}else{
for(var i=0;i<_29c6.length;i++){
if(this._lastAllowedParentList[i]!=_29c6[i]){
same=false;
break;
}
}
}
}
}
this._lastProposedParentWidget=this._proposedParentWidget;
if(!same){
var _29ca=dojo.i18n.getLocalization("davinci.ve","ve");
var len;
_29c9.innerHTML="";
if(typeof _29c6=="undefined"||_29c6===null){
this._lastAllowedParentList=null;
len=0;
}else{
this._lastAllowedParentList=_29c6.slice();
len=_29c6.length;
var _29cb=dojo.create("div",{className:"maqCandidateParentsHeader"},_29c9);
var _29cc=dojo.create("div",{className:"maqCandidateParentsList"},_29c9);
var _29cd=dojo.create("div",{className:"maqCandidateParentsHelp"},_29c9);
var div;
if(len===0){
_29cb.innerHTML=_29ca.noValidParents;
}else{
if(len==1){
_29cb.innerHTML=_29ca.willBeChildOf;
div=dojo.create("div",{className:"maqCandidateListItem maqCandidateCurrent",innerHTML:_29a7.getLabel(_29c6[0])},_29cc);
}else{
_29cb.innerHTML=_29ca.candidateParents;
var s="<table>";
for(var i=_29c6.length-1,j=1;i>=0;i--,j++){
var _29ce="maqCandidateListItem";
if(_29c6[i]==this._proposedParentWidget){
_29ce+=" maqCandidateCurrent";
}
s+="<tr class=\""+_29ce+"\"><td class=\"maqCandidateCheckedColumn\">&rarr;</td><td class=\"maqCandidateNumberColumn\">"+j+"</td><td class=\"maqCandidateParentColumn\">"+_29a7.getLabel(_29c6[i])+"</td></tr>";
}
s+="</table>";
_29cc.innerHTML=s;
_29cd.innerHTML=_29ca.toChangePress;
}
}
}
}
}else{
_29c9.innerHTML="";
this._lastAllowedParentList=null;
}
}
if(_29c3){
var idx;
for(var i=0;i<this._XYParent.length;i++){
if(this._XYParent[i]===this._proposedParentWidget){
idx=i;
break;
}
}
if(idx!==undefined){
if(!this._cursorSpan){
this._cursorSpan=dojo.create("span",{className:"editCursor"});
this._timer=_29c7.getGlobal().setInterval(function(node,_29cf){
var _29d0=_29a6.currentEditor;
var _29d1=(_29d0.getContext&&_29d0.getContext());
if(_29d1!==_29cf){
this.cleanup();
return;
}
dojo.toggleClass(node,"editCursorBlink");
}.bind(this),400,this._cursorSpan,_29c7);
}
var _29d2=this._XYParent[idx].domNode;
var _29d3=this._XYRefChild[idx];
var _29d4=_29d3?_29d3.domNode:null;
var _29d5=this._XYRefAfter[idx];
var _29d6,cursL,cursT,cursH;
if(_29d4){
if(_29d5){
if(_29d4.nextSibling&&_29d4.nextSibling._dvWidget){
var _29d7=_29d4.nextSibling;
_29d6=_29aa.getBorderBoxPageCoordsCached(_29d7);
cursL=_29d6.l;
cursT=_29d6.t;
cursH=_29d6.h;
}else{
_29d6=_29aa.getBorderBoxPageCoordsCached(_29d4);
cursL=_29d6.l+_29d6.w;
cursT=_29d6.t;
cursH=_29d6.h;
}
}else{
_29d6=_29aa.getBorderBoxPageCoordsCached(_29d4);
cursL=_29d6.l;
cursT=_29d6.t;
cursH=_29d6.h;
}
}else{
_29d6=_29aa.getBorderBoxPageCoordsCached(_29d2);
cursL=_29d6.l;
cursT=_29d6.t;
cursH=16;
}
var style=this._cursorSpan.style;
style.height=cursH+"px";
style.left=cursL+"px";
style.top=cursT+"px";
var body=_29d2.ownerDocument.body;
body.appendChild(this._cursorSpan);
}
}
},_getDefaultParent:function(_29d8,_29d9,_29da,_29db){
var _29dc=this._context;
var _29dd;
if(_29d9){
var _29de=_29a7.getWidgetHelper(_29d8);
if(_29d9.length>1&&_29de&&_29de.chooseParent){
_29dd=_29de.chooseParent(_29d9);
}else{
if(_29d9.length===0){
_29dd=null;
}else{
if(_29da&&_29db){
_29dd=_29db;
}else{
var last=_29d9.length-1;
_29dd=_29d9[last];
}
}
}
}
return _29dd;
},cleanup:function(){
if(this._cursorSpan){
this._cursorSpan.parentNode.removeChild(this._cursorSpan);
this._cursorSpan=null;
}
if(this._timer){
this._context.getGlobal().clearInterval(this._timer);
this._timer=null;
}
var _29df=this._context;
this.highlightNewWidgetParent(null);
this._lastAllowedParentList=null;
},highlightNewWidgetParent:function(_29e0){
var _29e1=this._context;
if(_29e0!=this.newWidgetParent){
if(this.newWidgetParent){
this.newWidgetParent.domNode.style.outline="";
}
this.newWidgetParent=_29e0;
if(_29e0){
_29e0.domNode.style.outline="1px solid rgba(165,42,42,.7)";
}
}
},getProposedParentWidget:function(){
var ppw=null;
if(this._XYParent){
var idx=this._XYParent.indexOf(this._proposedParentWidget);
if(idx>=0){
ppw={};
ppw.parent=this._XYParent[idx];
ppw.refChild=this._XYRefChild[idx];
ppw.refAfter=this._XYRefAfter[idx];
}
}
return ppw;
},setProposedParentWidget:function(wdgt){
this._proposedParentWidget=wdgt;
},getProposedParentsList:function(){
return this._XYParent;
},findParentsXYBeforeTraversal:function(_29e2){
var _29e3=_29e2.position;
this._XYParent=[];
this._XYRefChild=[];
this._XYRefAfter=[];
if(typeof this.findParentsXYLastPosition=="undefined"){
this.findParentsXYLastPosition={};
}
var last=this.findParentsXYLastPosition;
if(_29e3.x===last.x&&_29e3.y===last.y){
return false;
}else{
last.x=_29e3.x;
last.y=_29e3.y;
return true;
}
},findParentsXY:function(_29e4){
var data=_29e4.data,wdgt=_29e4.widget,_29e5=_29e4.absolute,_29e6=_29e4.position,_29e7=_29e4.doCursor,_29e8=_29e4.beforeAfter;
var x=_29e6.x;
var y=_29e6.y;
var _29e9=wdgt.getHelper();
if(_29e9&&_29e9.getMarginBoxPageCoords){
marginBoxPageCoords=_29e9.getMarginBoxPageCoords(wdgt);
}else{
var _29ea=wdgt.domNode;
marginBoxPageCoords=_29aa.getMarginBoxPageCoordsCached(_29ea);
}
var l=marginBoxPageCoords.l;
var t=marginBoxPageCoords.t;
var w=marginBoxPageCoords.w;
var h=marginBoxPageCoords.h;
var r=l+w;
var b=t+h;
var i,child;
if(x>=l&&x<=r&&y>=t&&y<=b){
var _29eb=this.getAllowedTargetWidget(wdgt,data,false,{absolute:_29e5});
if(_29eb.length===1){
if(_29e5===true){
this._XYParent.push(wdgt);
this._XYRefChild.push(null);
this._XYRefAfter.push(true);
}else{
var _29ec=wdgt.getChildren();
var _29ed=[];
for(i=0;i<_29ec.length;i++){
child=_29ec[i];
var node=child.domNode;
var _29ee=_29aa.getBorderBoxPageCoordsCached(node);
w=node.offsetWidth;
h=node.offsetHeight;
l=_29ee.l;
t=_29ee.t;
r=l+w;
b=t+h;
var c=l+w/2;
_29ed.push({l:l,t:t,r:r,b:b,c:c});
}
var _29ef,_29f0,_29f1;
for(i=0;i<_29ed.length;i++){
var cd=_29ed[i];
child=_29ec[i];
if(x>=cd.l&&x<=cd.r&&y>=cd.t&&y<=cd.b){
_29ef=child;
_29f0=x>=cd.c?true:false;
break;
}
if(i===0){
_29ef=child;
_29f0=(y>cd.b||x>=cd.c)?true:false;
_29f1=cd.b;
}else{
if((y>=cd.t||y>=_29f1)&&x>=cd.l){
_29ef=child;
_29f0=(y>cd.b||x>=cd.c)?true:false;
}else{
if(y>=_29f1&&y>=cd.b){
_29ef=child;
_29f0=true;
}
}
}
if(cd.b>_29f1){
_29f1=cd.b;
}
}
this._XYParent.push(wdgt);
this._XYRefChild.push(_29ef);
_29f0=_29e8==="after"?true:(_29e8==="before"?false:_29f0);
this._XYRefAfter.push(_29f0);
}
}
}
},findParentsXYAfterTraversal:function(_29f2){
var _29f3=_29f2.widgets;
var _29f4=_29f2.eventTarget;
var _29f5=_29f2.currentParent;
var _29f6=_29f2.absolute;
var _29f7=_29f4.ownerDocument.body._dvWidget;
if(_29f6&&_29f5&&_29f5!=_29f7){
var found=false;
this._XYParent.forEach(function(w){
if(w==_29f5){
found=true;
}
});
if(!found){
this._XYParent.push(_29f5);
this._XYRefChild.push(_29f3[0]);
this._XYRefAfter.push(true);
}
}
this.findParentsXYLastPosition={};
for(var i=0;i<this._XYRefAfter.length-1;i++){
this._XYRefAfter[i]=true;
}
},findParentsXYCleanup:function(_29f8){
this.findParentsXYLastPosition={};
},parentListDivCreate:function(_29f9){
var _29fa=_29f9.widgetType,_29fb=_29f9.absolute,_29fc=_29f9.doCursor,_29fd=_29f9.beforeAfter,_29fe=_29f9.currentParent;
var _29ff=this._context;
if(!_29fa){
return;
}
var _2a00=_29ff.getDocument();
this._oldActiveElement=document.activeElement;
_2a00.defaultView.focus();
this._keyDownHandler=dojo.connect(_2a00,"onkeydown",dojo.hitch(this,function(args,evt){
var _2a01=args[0];
var _2a02=args[1];
var _2a03=args[2];
var _2a04=args[3];
var _2a05=args[4];
this.onKeyDown(evt,_2a01,_2a02,_2a03,_2a04,_2a05);
},[_29fa,_29fb,_29fc,_29fd,_29fe]));
this._keyUpHandler=dojo.connect(_2a00,"onkeyup",dojo.hitch(this,function(args,evt){
var _2a06=args[0];
var _2a07=args[1];
var _2a08=args[2];
var _2a09=args[3];
var _2a0a=args[4];
this.onKeyUp(evt,_2a06,_2a07,_2a08,_2a09,_2a0a);
},[_29fa,_29fb,_29fc,_29fd,_29fe]));
var body=document.body;
var _2a0b=this._parentListDiv=dojo.create("div",{className:"maqParentListDiv"},body);
_29ff.setActiveDragDiv(_2a0b);
dojo.create("div",{className:"maqCandidateParents"},_2a0b);
return _2a0b;
},parentListDivGet:function(){
return this._parentListDiv;
},parentListDivDelete:function(){
var _2a0c=this._context;
var _2a0d=this._parentListDiv;
if(_2a0d){
if(this._oldActiveElement){
this._oldActiveElement.focus();
this._oldActiveElement=null;
}
dojo.disconnect(this._keyDownHandler);
dojo.disconnect(this._keyUpHandler);
this._keyDownHandler=this._keyUpHandler=null;
var _2a0e=_2a0d.parentNode;
_2a0e.removeChild(_2a0d);
_2a0c.setActiveDragDiv(null);
this._parentListDiv=null;
}
},_keyEventDoUpdate:function(_2a0f,_2a10,_2a11,_2a12,_2a13){
var _2a14=this._context.getPreference("showPossibleParents");
var _2a15=(!_2a14&&this._spaceKeyDown)||(_2a14&&!this._spaceKeyDown);
this.dragUpdateCandidateParents({widgetType:_2a0f,showCandidateParents:_2a15,doCursor:_2a11,beforeAfter:_2a12,absolute:_2a10,currentParent:_2a13});
},onKeyDown:function(event,_2a16,_2a17,_2a18,_2a19,_2a1a){
dojo.stopEvent(event);
if(event.keyCode==dojo.keys.SPACE){
this._spaceKeyDown=true;
}else{
this._processKeyDown(event.keyCode);
}
this._keyEventDoUpdate(_2a16,_2a17,_2a18,_2a19,_2a1a);
},onKeyUp:function(event,_2a1b,_2a1c,_2a1d,_2a1e,_2a1f){
dojo.stopEvent(event);
if(event.keyCode==dojo.keys.SPACE){
this._spaceKeyDown=false;
}
this._keyEventDoUpdate(_2a1b,_2a1c,_2a1d,_2a1e,_2a1f);
},_processKeyDown:function(_2a20){
if(_2a20>=49&&_2a20<=57){
var _2a21=this._context;
var _2a22=this.getProposedParentsList();
if(_2a22.length>1){
var index=_2a22.length-(_2a20-48);
if(index>=0){
this.setProposedParentWidget(_2a22[index]);
}
}
}
},isSpaceKeyDown:function(){
return this._spaceKeyDown;
}});
});
},"davinci/html/PHPBlock":function(){
define(["dojo/_base/declare","davinci/html/HTMLItem"],function(_2a23,_2a24){
return _2a23("davinci.html.PHPBlock",_2a24,{constructor:function(value){
this.elementType="PHPBlock";
this.value=value||"";
},getText:function(_2a25){
return _2a25.excludeIgnoredContent?"":this.value;
}});
});
},"system/resource":function(){
define("system/resource",["require","dojo/_base/declare","dojo/_base/xhr","dojo/Deferred","davinci/model/Path","davinci/Runtime","davinci/model/resource/Folder"],function(_2a26,_2a27,xhr,_2a28,Path,_2a29,_2a2a){
var _2a2b={root:null,__CASE_SENSITIVE:false,resourceChanged:function(type,_2a2c){
if(_2a2c==system.resource.getRoot()){
_2a2c.reload();
system.resource.getRoot().getChildrenSync(dojo.hitch(system.resource,function(_2a2d){
system.resource.onChildrenChange(system.resource.getRoot(),_2a2d);
}));
return system.resource.getRoot();
}else{
if(type=="created"||type=="deleted"||type=="renamed"||type=="updated"||type=="reload"){
var _2a2e,_2a2f;
if(_2a2c.parent){
_2a2e=_2a2c.parent;
_2a2f=_2a2c.getPath();
}else{
var p1=new Path(_2a2c).removeLastSegments();
_2a2e=system.resource.findResource(p1.toString())||system.resource.getRoot();
_2a2f=_2a2c;
}
if(type=="deleted"&&_2a2c.elementType=="Folder"){
system.resource.onChildrenChange(_2a2c,[]);
}
if(_2a2e.elementType=="Folder"&&type=="reload"){
_2a2e.reload();
}
if(type=="renamed"){
system.resource.onChange(_2a2c);
}
_2a2e.getChildrenSync(function(_2a30){
system.resource.onChildrenChange(_2a2e,_2a30);
},function(e){
console.error(e);
});
}
}
if(type=="deleted"){
var _2a31=dijit.byId("resourceTree");
_2a31.attr("selectedItem",null);
}
},createText:function(type,_2a32){
return "";
},createResource:function(_2a33,_2a34,_2a35){
var _2a36=_2a33.split("/");
_2a35=_2a35||system.resource.getWorkspace();
var _2a37=!_2a34?_2a36.length-1:_2a36.length;
for(var i=0;i<_2a37;i++){
if(_2a36[i]=="."||_2a36[i]==""){
continue;
}
var _2a38=_2a35.getChildSync(_2a36[i]);
if(_2a38!=null){
_2a35=_2a38;
}else{
_2a35=_2a35.createResource(_2a36[i],true);
}
}
if(!_2a34){
_2a35=_2a35.createResource(_2a36[_2a36.length-1]);
}
return _2a35;
},listProjects:function(_2a39,_2a3a){
var _2a3b=system.resource.getRoot();
if(_2a3b.parent){
_2a3b=_2a3b.parent;
}
_2a3b.getChildren(_2a39,_2a3a);
},createProject:function(_2a3c,_2a3d,_2a3e){
return xhr.get({url:"cmd/createProject",handleAs:"text",content:{name:_2a3c,initContent:_2a3d,eclipseSupport:_2a3e}});
},newItem:function(args,_2a3f){
},pasteItem:function(_2a40,_2a41,_2a42,bCopy){
},onChange:function(item){
},onChildrenChange:function(_2a43,_2a44){
},getLabel:function(item){
var label=item.getName();
if(item.link){
label=label+"  ["+item.link+"]";
}
return label;
},getIdentity:function(item){
return item.getId();
},destroy:function(){
system.resource.subscriptions.forEach(dojo.unsubscribe);
},mayHaveChildren:function(item){
return item.elementType=="Folder";
},getRoot:function(_2a45,_2a46){
if(!system.resource.root){
var _2a47=system.resource.getWorkspace(),_2a48=_2a26("davinci/Workbench");
if(_2a48.singleProjectMode()){
var _2a49=_2a48.getProject();
system.resource.root=system.resource.findResource(_2a49,false,_2a47);
}else{
system.resource.root=_2a47;
}
system.resource.root._readOnly=false;
}
if(_2a45){
_2a45(system.resource.root);
}else{
return system.resource.root;
}
},getWorkspace:function(){
if(!this.workspace){
this.workspace=new _2a2a(".",null);
}
return this.workspace;
},getChildren:function(_2a4a,_2a4b,_2a4c){
_2a4a.getChildren(_2a4b,_2a4c);
},copy:function(_2a4d,_2a4e,_2a4f){
var path=_2a4d.getPath?_2a4d.getPath():_2a4d;
var _2a50=_2a4e.getPath?_2a4e.getPath():_2a4e;
var _2a51=_2a29.serverJSONRequest({url:"cmd/copy",handleAs:"text",sync:true,content:{source:path,dest:_2a50,recurse:String(_2a4f)}});
system.resource.resourceChanged("reload",_2a4e);
},download:function(files,_2a52,root,_2a53,_2a54){
var _2a55="";
var _2a56="";
if(_2a53){
_2a55="&libs="+encodeURIComponent(dojo.toJson(_2a53));
}
if(root){
_2a56="&root="+encodeURIComponent(root);
}
if(_2a54){
for(var name in _2a54){
_2a56+="&"+encodeURIComponent(name)+"="+encodeURIComponent(_2a54[name]);
}
}
window.location.href="cmd/download?fileName="+_2a52+_2a56+"&resources="+encodeURIComponent(dojo.toJson(files))+_2a55;
},findResourceAsync:function(name,_2a57,_2a58,_2a59){
var _2a5a=new _2a28();
var _2a5b=this.findResource(name,_2a57,_2a58,_2a59);
_2a5a.resolve(_2a5b);
return _2a5a;
},findResource:function(name,_2a5c,_2a5d,_2a5e){
_2a5c=_2a5c||!system.resource.__CASE_SENSITIVE;
var seg1=0,_2a5f;
var _2a60=system.resource.getWorkspace();
if(_2a5d){
if(typeof _2a5d=="string"){
var _2a61=_2a5d;
_2a5d=system.resource.findResource(_2a5d,_2a5c);
if(!_2a5d){
console.error("resource.findResoure: Folder "+_2a61+" not found");
return null;
}
}
_2a60=_2a5d;
}
if(typeof name=="string"){
_2a5f=name.split("/");
if(_2a5f[0]=="."){
seg1=1;
}
}else{
if(name.getSegments){
_2a5f=name.getSegments();
name=name.toString();
}
}
var _2a62=_2a5f.some(function(_2a63){
return _2a63.indexOf("*")!=-1;
});
var _2a64;
function _2a65(){
for(var i=seg1;i<_2a5f.length;i++){
var found=null;
if(!_2a60._isLoaded){
_2a64=true;
break;
}
if(_2a5f[i]==".."){
found=_2a60=_2a60.parent;
}else{
if(_2a5f[i]!="."){
found=_2a60=_2a60.getChildSync(_2a5f[i]);
}
}
if(!found){
return;
}
}
return found;
};
var found;
if(!_2a62){
found=_2a65();
}
var _2a66=[];
if(!found&&(_2a64||_2a62)){
var _2a67=_2a29.serverJSONRequest({url:"cmd/findResource",content:{path:name,ignoreCase:_2a5c,workspaceOnly:_2a5e,inFolder:_2a5d?_2a5d.getPath():null},sync:true});
if(_2a67&&_2a67.length){
_2a66=_2a67.map(function(_2a68){
var _2a69=system.resource.getWorkspace();
for(var j=0;j<_2a68.parents.length;j++){
if(!_2a69._isLoaded){
_2a69.setChildrenSync(_2a68.parents[j].members);
}
if(j+1<_2a68.parents.length){
var name=_2a68.parents[j+1].name;
var _2a6a=_2a69.getChildSync(name);
if(!_2a6a){
_2a6a=new _2a2a(name,_2a69);
}
_2a69=_2a6a;
}
}
_2a60=system.resource.getWorkspace();
seg1=0;
_2a5f=_2a68.file.split("/");
if(_2a5f[0]=="."){
seg1=1;
}
return _2a65();
});
}
}else{
_2a66=[found];
}
return _2a62?_2a66:_2a66[0];
},alphabeticalSort:function(items){
return items.sort(function(a,b){
a=a.name.toLowerCase();
b=b.name.toLowerCase();
return a<b?-1:(a>b?1:0);
});
}};
var _2a6b=[dojo.subscribe("/davinci/resource/resourceChanged",_2a2b,function(){
return _2a2b.resourceChanged;
}())];
return dojo.setObject("system.resource",_2a2b);
});
},"davinci/ve/States":function(){
define(["dojo/_base/declare","dojo/_base/connect","davinci/Runtime","davinci/maqetta/AppStates","./commands/EventCommand","./commands/StyleCommand","davinci/ve/utils/StyleArray"],function(_2a6c,_2a6d,_2a6e,_2a6f,_2a70,_2a71,_2a72){
var _2a73=_2a6c(_2a6f,{_update:function(node,_2a74){
if(!_2a6e.currentEditor||_2a6e.currentEditor.declaredClass!="davinci.ve.PageEditor"){
return;
}
if(!node||!node._dvWidget||(!node._maqAppStates&&node._maqDeltas)){
return;
}
var _2a75=node._dvWidget;
this._refresh(_2a75);
},_refresh:function(_2a76){
var _2a77=_2a76.getParent();
if(_2a77.dijitWidget){
this._refresh(_2a77);
}else{
if(_2a76&&_2a76.resize){
_2a76.resize();
}
}
},_updateEvents:function(node,state,name){
if(!node||!node._dvWidget){
return;
}
var _2a78=node._dvWidget;
var _2a79=["onclick","onmouseover","onmouseout","onfocus","onblur"];
var _2a7a;
for(var i in _2a79){
var event=_2a79[i];
var value=_2a78&&_2a78.properties&&_2a78.properties[event];
if(typeof value=="string"&&value.indexOf("davinci.states.setState")>=0){
var _2a7b=value;
value=value.replace("'"+state+"'","'"+name+"'");
if(value!==_2a7b){
_2a7a=_2a7a||{};
_2a7a[event]=value;
}
}
}
var _2a7c=this.getContext();
if(_2a7c){
var _2a7d=new _2a70(_2a78,_2a7a);
_2a7c.getCommandStack().execute(_2a7d);
}
},normalize:function(type,node,name,value){
switch(type){
case "style":
var _2a7e=this.getStatesListCurrent(node);
for(var i=0;i<_2a7e.length;i++){
_2a7e[i]="Normal";
}
var _2a7f=this.getStyle(node,_2a7e,name);
if(_2a7f){
for(var i=0;i<_2a7f.length;i++){
if(_2a7f[i][name]){
value=_2a7f[i][name];
}
}
}
break;
}
return value;
},normalizeArray:function(type,node,name,_2a80){
var _2a81=dojo.clone(_2a80);
switch(type){
case "style":
var _2a82=this.getStatesListCurrent(node);
for(var i=0;i<_2a82.length;i++){
_2a82[i]="Normal";
}
var _2a83=this.getStyle(node,_2a82,name);
if(_2a83){
for(var i=0;i<_2a83.length;i++){
var nItem=_2a83[i];
for(var nProp in nItem){
for(var j=_2a81.length-1;j>=0;j--){
var vItem=_2a81[j];
for(var vProp in vItem){
if(vProp==nProp){
_2a81.splice(j,1);
break;
}
}
}
}
}
_2a81=_2a81.concat(_2a83);
}
break;
}
return _2a81;
},getEditor:function(){
return top.davinci&&top.davinci.Runtime&&top.davinci.Runtime.currentEditor;
},getContext:function(){
var _2a84=this.getEditor();
return _2a84&&(_2a84.getContext&&_2a84.getContext()||_2a84.context);
},getDocument:function(){
var _2a85=this.getContext();
return _2a85&&_2a85.getDocument&&_2a85.getDocument();
},resetState:function(node){
if(!node){
return;
}
var _2a86=this.getStateContainersForNode(node);
var _2a87=this.getFocus(node.ownerDocument.body);
for(var i=0;i<_2a86.length;i++){
var _2a88=_2a86[i];
var _2a89=this.getState(_2a88);
var focus=(_2a87&&_2a88==_2a87.stateContainerNode&&_2a89==_2a87.state);
this.setState(_2a89,_2a88,{focus:focus,updateWhenCurrent:true,silent:true});
}
},_updateSrcState:function(node,_2a8a){
var _2a8b=(node&&node._dvWidget);
if(!_2a8b){
return;
}
var _2a8c=_2a8b._srcElement.getAttribute(davinci.states.APPSTATES_ATTRIBUTE);
var _2a8d=_2a8b._srcElement.getAttribute(davinci.states.DELTAS_ATTRIBUTE);
if(_2a8b&&_2a8b._srcElement){
var obj=this.serialize(node);
if(obj.maqAppStates){
obj.maqAppStates.trim();
}
if(obj.maqAppStates){
_2a8b._srcElement.addAttribute(davinci.states.APPSTATES_ATTRIBUTE,obj.maqAppStates);
}else{
_2a8b._srcElement.removeAttribute(davinci.states.APPSTATES_ATTRIBUTE);
}
if(obj.maqDeltas){
obj.maqDeltas.trim();
}
if(obj.maqDeltas){
_2a8b._srcElement.addAttribute(davinci.states.DELTAS_ATTRIBUTE,obj.maqDeltas);
}else{
_2a8b._srcElement.removeAttribute(davinci.states.DELTAS_ATTRIBUTE);
}
var _2a8e=_2a8b._srcElement.getAttribute(davinci.states.APPSTATES_ATTRIBUTE);
var _2a8f=_2a8b._srcElement.getAttribute(davinci.states.DELTAS_ATTRIBUTE);
if(_2a8c!==_2a8e||_2a8d!==_2a8f){
var _2a90=this.getEditor();
if(_2a90&&_2a90._visualChanged){
_2a90._visualChanged(_2a8a);
}
}
}
},_removeStateFromNodeRecursive:function(node,state){
var _2a91=node._dvWidget;
if(!node||!_2a91||!state){
return;
}
this._removeStateFromNode(node,state);
var _2a92=_2a91.getChildren();
for(var i=0;i<_2a92.length;i++){
this._removeStateFromNodeRecursive(_2a92[i].domNode,state);
}
},_removeStateFromNode:function(node,state){
if(node&&node._maqDeltas&&node._maqDeltas[state]){
delete node._maqDeltas[state];
var _2a93=false;
for(var prop in node._maqDeltas){
if(prop!=="undefined"){
_2a93=true;
break;
}
}
if(!_2a93){
delete node._maqDeltas;
}
this._updateSrcState(node);
}
},removeUnusedStates:function(_2a94){
if(!_2a94){
return;
}
var _2a95=_2a94.getAllWidgets();
for(var i=0;i<_2a95.length;i++){
var node=_2a95[i].domNode;
if(node.tagName!=="BODY"){
if(node&&node._maqDeltas){
var _2a96=this.getAllStatesForNode(node);
for(var state in node._maqDeltas){
if(state!=="undefined"&&_2a96.indexOf(state)<0){
this._removeStateFromNode(node,state);
}
}
}
}
}
},_getStateIndex:function(state){
var _2a97;
if(!state||state=="Normal"||state=="undefined"){
_2a97="undefined";
}else{
_2a97=state;
}
return _2a97;
},getCurrentStateIndex:function(){
return this._getStateIndex(this.getState());
},getApplyToStateIndex:function(_2a98){
var _2a99=this.getState();
var state;
if(_2a98==="current"&&_2a99&&_2a99!="Normal"&&_2a99!="undefined"){
state=_2a99;
}else{
state=undefined;
}
return this._getStateIndex(state);
},propertyDefinedForAnyCurrentState:function(node,_2a9a){
var _2a9b;
var _2a9c=node._maqDeltas;
if(_2a9c){
var _2a9d=this.getStateContainersForNode(node);
outer_loop:
for(var i=_2a9d.length-1;i>=0;i--){
var _2a9e=_2a9d[i];
var _2a9f=this.getState(_2a9e);
var _2aa0=(!_2a9f||_2a9f==this.NORMAL)?"undefined":_2a9f;
var _2aa1=_2a9c[_2aa0]&&_2a9c[_2aa0].style;
if(_2aa1){
for(var s=0;s<_2aa1.length;s++){
var o=_2aa1[s];
for(var j=0;j<_2a9a.length;j++){
if(o.hasOwnProperty(_2a9a[j])){
_2a9b=_2a9f;
break outer_loop;
}
}
}
}
}
}
return _2a9b;
},initialize:function(){
if(!this.subscribed){
_2a6d.subscribe("/maqetta/appstates/state/changed",dojo.hitch(this,function(e){
var _2aa2=this.getEditor();
if(!dojo.isObject(e.node)||!_2aa2||_2aa2.declaredClass!="davinci.ve.PageEditor"){
return;
}
dojo.publish("/maqetta/appstates/state/changed/start",[e]);
var _2aa3=(e.node&&e.node._dvWidget);
var _2aa3=(_2aa3==this.getContext().rootWidget)?_2aa3:_2aa3.getParent();
var n=_2aa3.domNode;
var _2aa4=davinci.states._getChildrenOfNode(n);
while(_2aa4.length){
var child=_2aa4.shift();
if(!this.isContainer(child)){
_2aa4=_2aa4.concat(davinci.states._getChildrenOfNode(child));
}
var _2aa5=this.getStatesArray(child,e.oldState,e.newState,e.stateContainerNode);
this._update(child,_2aa5);
}
dojo.publish("/maqetta/appstates/state/changed/end",[e]);
var _2aa6=this.getContext();
if(_2aa6){
_2aa6.clearCachedWidgetBounds();
_2aa6.updateFocusAll();
}
}));
_2a6d.subscribe("/davinci/states/state/renamed",dojo.hitch(this,function(e){
var _2aa7=this.getEditor();
if(!_2aa7||_2aa7.declaredClass=="davinci.themeEditor.ThemeEditor"){
return;
}
var _2aa8=(e.node&&e.node._dvWidget);
var _2aa9=davinci.states._getChildrenOfNode(e.node);
while(_2aa9.length){
var child=_2aa9.shift();
if(!this.isContainer(child)){
_2aa9=_2aa9.concat(davinci.states._getChildrenOfNode(child));
}
this.rename(child,e.oldName,e.newName,true);
this._updateEvents(child,e.oldName,e.newName);
}
var state=this.getState(e.stateContainerNode);
if(state===e.oldName){
this.setState(e.newName,e.stateContainerNode,{updateWhenCurrent:false,silent:true});
}
}));
_2a6d.subscribe("/davinci/states/state/style/changed",dojo.hitch(this,function(e){
var _2aaa=this.getState();
if(_2aaa==e.state){
var _2aab=this.findStateContainer(e.node,e.state);
var _2aac=this.getStatesArray(e.node,e.state,e.state,_2aab);
this._update(e.node,_2aac);
}
}));
_2a6d.subscribe("/davinci/ui/widget/replaced",dojo.hitch(this,function(_2aad,_2aae){
var _2aaf=this.getState();
if(_2aaf){
var _2ab0=this.findStateContainer(_2aad.domNode,_2aaf);
var _2ab1=this.getStatesArray(_2aad.domNode,_2aaf,_2aaf,_2ab0);
this._update(_2aad.domNode,_2ab1);
}
}));
_2a6d.subscribe("/davinci/states/state/removed",dojo.hitch(this,function(_2ab2){
if(!_2ab2){
return;
}
this._removeStateFromNodeRecursive(_2ab2.node,_2ab2.state);
}));
this.subscribed=true;
}
}});
davinci.ve.states=new _2a73();
davinci.ve.states.initialize();
return davinci.ve.states;
});
},"davinci/library":function(){
define("davinci/library",["davinci/Runtime","davinci/model/Path","davinci/ve/themeEditor/metadata/CSSThemeProvider","davinci/ve/themeEditor/metadata/query","davinci/workbench/Preferences"],function(_2ab3,Path,_2ab4,Query,_2ab5){
var _2ab6={_customWidgets:{}},_2ab7={},_2ab8={},_2ab9={},_2aba={};
dojo.subscribe("/davinci/ui/libraryChanged/start",this,function(){
_2aba={};
_2ab9={};
});
dojo.subscribe("/davinci/resource/resourceChanged",this,function(type,_2abb){
var _2abc=require("davinci/Workbench");
var base=_2abc.getProject();
if(type=="deleted"||type=="renamed"){
var prefs=_2ab5.getPreferences("davinci.ui.ProjectPrefs",base);
var _2abd=new Path(base).append(prefs.themeFolder);
var _2abe=new Path(_2abb.getPath());
if(_2abe.startsWith(_2abd)){
delete _2ab7[base];
}
}
if(_2abb.elementType=="File"&&_2abb.extension=="theme"){
if(type=="modified"){
var d=_2abb.getContent();
d.then(function(_2abf){
var t=JSON.parse(_2abf);
t.file=_2abb;
for(var i=0;i<_2ab7[base].length;i++){
if(_2ab7[base][i].name==t.name){
_2ab7[base][i]=t;
return;
}
}
_2ab7[base].push(t);
}.bind(this));
}
}
});
_2ab6={themesChanged:function(base){
_2ab7[base]=base?null:[];
},getThemes:function(base,_2ac0,_2ac1){
if(_2ac1){
delete _2ab7[base];
}
function _2ac2(){
var rlt=[];
if(_2ab7[base]){
rlt=_2ac0?_2ab7[base].filter(function(entry){
return !entry.file.isVirtual();
}):_2ab7[base];
}
return rlt;
};
if(_2ab7[base]){
return _2ac2();
}
var prefs=_2ab5.getPreferences("davinci.ui.ProjectPrefs",base),_2ac3=new Path(base).append(prefs.themeFolder);
var _2ac4=system.resource.findResource("*.theme",false,_2ac3.toString());
_2ab7[base]=[];
for(var i=0;i<_2ac4.length;i++){
if(_2ac4[i]){
var t=JSON.parse(_2ac4[i].getContentSync());
t.file=_2ac4[i];
_2ab7[base].push(t);
}else{
console.error("library.getThemes: undefined theme returned by system.resource.findResource(\"*.theme\", false, projectThemeBase.toString());");
}
}
return _2ac2();
},getThemeMetadata:function(theme){
if(_2ab8[theme.name]){
return _2ab8[theme.name];
}
var _2ac5=new Path(theme.file.getPath()).removeLastSegments();
var _2ac6=theme.files.filter(function(file){
return file.indexOf(".css")>-1;
}).map(_2ac5.append,_2ac5);
var _2ac7=theme.meta.map(function(_2ac8){
var _2ac9=_2ac5.append(_2ac8);
return system.resource.findResource(_2ac9.toString());
});
var _2aca=new _2ab4(_2ac7,theme);
_2ab8[theme.name]={loader:new Query(_2ac7),css:_2ac6,metadata:_2aca};
return _2ab8[theme.name];
},addCustomWidgets:function(base,_2acb){
var prefs=_2ab5.getPreferences("davinci.ui.ProjectPrefs",base);
if(!prefs.widgetFolder){
prefs.widgetFolder="./lib/custom";
_2ab5.savePreferences("davinci.ui.ProjectPrefs",base,prefs);
}
var _2acc=require("davinci/ve/metadata").parseMetaData(_2acb.name,_2acb,new Path(prefs.widgetFolder),true);
if(!_2ab6._customWidgets[base].hasOwnProperty("name")){
_2ab6._customWidgets[base].name="custom";
_2ab6._customWidgets[base].metaPath=prefs.widgetFolder;
_2ab6._customWidgets[base].localPath=true;
}
_2ab6._customWidgets[base]=_2acc;
dojo.publish("/davinci/ui/addedCustomWidget",[_2acc]);
return _2acc;
},getCustomWidgets:function(base){
if(!_2ab6._customWidgets||!_2ab6._customWidgets[base]){
if(!_2ab6._customWidgets){
_2ab6._customWidgets={};
}
if(!_2ab6._customWidgets[base]){
_2ab6._customWidgets[base]=[];
}
var prefs=_2ab5.getPreferences("davinci.ui.ProjectPrefs",base);
if(!prefs.widgetFolder){
prefs.widgetFolder="./lib/custom";
_2ab5.savePreferences("davinci.ui.ProjectPrefs",base,prefs);
}
var _2acd=new Path(base).append(prefs.widgetFolder);
var _2ace=_2acd.getSegments();
parent=system.resource.findResource(_2ace[0]);
for(var i=1;i<_2ace.length;i++){
var _2acf=parent.getChildSync(_2ace[i]);
if(_2acf){
parent=_2acf;
}else{
parent=parent.createResource(_2ace[i],true);
}
}
var _2ad0=system.resource.findResource("*_widgets.json",false,parent);
for(var i=0;i<_2ad0.length;i++){
_2ab6.addCustomWidgets(base,dojo.fromJson(_2ad0[i].getContentSync()));
}
}
return {custom:_2ab6._customWidgets[base]};
},getInstalledLibs:function(){
if(!_2ab6._serverLibs){
_2ab6._serverLibs=_2ab3.serverJSONRequest({url:"cmd/listLibs",handleAs:"json",content:{},sync:true})[0].userLibs;
}
return _2ab6._serverLibs;
},getUserLibs:function(base){
if(_2ab9.base){
return _2ab9.base;
}
_2ab9.base=_2ab3.serverJSONRequest({url:"cmd/getUserLibs",handleAs:"json",content:{base:base},sync:true})[0].userLibs;
return _2ab9.base;
},getLibRoot:function(id,_2ad1,base){
var cache=_2aba;
if(cache[base]&&cache[base][id]&&cache[base][id][_2ad1]!==undefined){
return cache[base][id][_2ad1];
}
if(!cache[base]){
cache[base]={};
}
if(!cache[base][id]){
cache[base][id]={};
}
var _2ad2=_2ab3.serverJSONRequest({url:"cmd/getLibRoots",handleAs:"json",content:{libId:id,version:_2ad1,base:base},sync:true});
var value=_2ad2?_2ad2[0].libRoot.root:null;
if(!cache[id]){
cache[id]={};
}
cache[base][id][_2ad1]=value;
return value;
},getMetaRoot:function(id,_2ad3){
return _2ab3.serverJSONRequest({url:"cmd/getMetaRoot",handleAs:"text",content:{id:id,version:_2ad3},sync:true});
},modifyLib:function(_2ad4){
return _2ab3.serverJSONRequest({url:"cmd/modifyLib",handleAs:"text",content:{libChanges:dojo.toJson(_2ad4)},sync:true});
},addLib:function(id,_2ad5){
return _2ab3.serverJSONRequest({url:"cmd/getLibRoots",handleAs:"json",content:{libId:id,version:_2ad5},sync:true})[0].libRoot.root;
},getLibraryId:function(_2ad6,_2ad7){
var libs={sketch:"sketch",claro:"claro"};
return libs[_2ad6]+(_2ad7||"");
},getLibraryName:function(lib){
var libId;
var _2ad8;
for(var name in lib){
libId=name;
_2ad8=lib[libId];
}
return libId;
}};
return _2ab6;
});
},"dijit/form/SimpleTextarea":function(){
define("dijit/form/SimpleTextarea",["dojo/_base/declare","dojo/dom-class","dojo/sniff","./TextBox"],function(_2ad9,_2ada,has,_2adb){
return _2ad9("dijit.form.SimpleTextarea",_2adb,{baseClass:"dijitTextBox dijitTextArea",rows:"3",cols:"20",templateString:"<textarea ${!nameAttrSetting} data-dojo-attach-point='focusNode,containerNode,textbox' autocomplete='off'></textarea>",postMixInProperties:function(){
if(!this.value&&this.srcNodeRef){
this.value=this.srcNodeRef.value;
}
this.inherited(arguments);
},buildRendering:function(){
this.inherited(arguments);
if(has("ie")&&this.cols){
_2ada.add(this.textbox,"dijitTextAreaCols");
}
},filter:function(value){
if(value){
value=value.replace(/\r/g,"");
}
return this.inherited(arguments);
},_onInput:function(e){
if(this.maxLength){
var _2adc=parseInt(this.maxLength);
var value=this.textbox.value.replace(/\r/g,"");
var _2add=value.length-_2adc;
if(_2add>0){
var _2ade=this.textbox;
if(_2ade.selectionStart){
var pos=_2ade.selectionStart;
var cr=0;
if(has("opera")){
cr=(this.textbox.value.substring(0,pos).match(/\r/g)||[]).length;
}
this.textbox.value=value.substring(0,pos-_2add-cr)+value.substring(pos-cr);
_2ade.setSelectionRange(pos-_2add,pos-_2add);
}else{
if(this.ownerDocument.selection){
_2ade.focus();
var range=this.ownerDocument.selection.createRange();
range.moveStart("character",-_2add);
range.text="";
range.select();
}
}
}
}
this.inherited(arguments);
}});
});
},"orion/editor/editor":function(){
define("orion/editor/editor",["i18n!orion/editor/nls/messages","orion/textview/keyBinding","orion/textview/eventTarget","orion/textview/tooltip","orion/textview/annotations","orion/textview/i18nUtil"],function(_2adf,_2ae0,_2ae1,_2ae2,_2ae3,_2ae4){
var _2ae5;
var _2ae6="orion.annotation.highlightError";
function _2ae7(_2ae8){
this._textViewFactory=_2ae8.textViewFactory;
this._undoStackFactory=_2ae8.undoStackFactory;
this._textDNDFactory=_2ae8.textDNDFactory;
this._annotationFactory=_2ae8.annotationFactory;
this._foldingRulerFactory=_2ae8.foldingRulerFactory;
this._lineNumberRulerFactory=_2ae8.lineNumberRulerFactory;
this._contentAssistFactory=_2ae8.contentAssistFactory;
this._keyBindingFactory=_2ae8.keyBindingFactory;
this._statusReporter=_2ae8.statusReporter;
this._domNode=_2ae8.domNode;
this._annotationStyler=null;
this._annotationModel=null;
this._annotationRuler=null;
this._lineNumberRuler=null;
this._overviewRuler=null;
this._foldingRuler=null;
this._dirty=false;
this._contentAssist=null;
this._title=null;
this._keyModes=[];
};
_2ae7.prototype={getAnnotationModel:function(){
return this._annotationModel;
},getAnnotationRuler:function(){
return this._annotationRuler;
},getAnnotationStyler:function(){
return this._annotationStyler;
},getFoldingRuler:function(){
return this._foldingRuler;
},getLineNumberRuler:function(){
return this._lineNumberRuler;
},getModel:function(){
var model=this._textView.getModel();
if(model.getBaseModel){
model=model.getBaseModel();
}
return model;
},getOverviewRuler:function(){
return this._overviewRuler;
},getTextView:function(){
return this._textView;
},getTitle:function(){
return this._title;
},getKeyModes:function(){
return this._keyModes;
},isDirty:function(){
return this._dirty;
},setAnnotationRulerVisible:function(_2ae9){
if(this._annotationRulerVisible===_2ae9){
return;
}
this._annotationRulerVisible=_2ae9;
if(!this._annotationRuler){
return;
}
var _2aea=this._textView;
if(_2ae9){
_2aea.addRuler(this._annotationRuler,0);
}else{
_2aea.removeRuler(this._annotationRuler);
}
},setFoldingRulerVisible:function(_2aeb){
if(this._foldingRulerVisible===_2aeb){
return;
}
this._foldingRulerVisible=_2aeb;
if(!this._foldingRuler){
return;
}
var _2aec=this._textView;
if(!_2aec.getModel().getBaseModel){
return;
}
if(_2aeb){
_2aec.addRuler(this._foldingRuler,100);
}else{
_2aec.removeRuler(this._foldingRuler);
}
},setDirty:function(dirty){
if(this._dirty===dirty){
return;
}
this._dirty=dirty;
this.onDirtyChanged({type:"DirtyChanged"});
},setLineNumberRulerVisible:function(_2aed){
if(this._lineNumberRulerVisible===_2aed){
return;
}
this._lineNumberRulerVisible=_2aed;
if(!this._lineNumberRuler){
return;
}
var _2aee=this._textView;
if(_2aed){
_2aee.addRuler(this._lineNumberRuler,1);
}else{
_2aee.removeRuler(this._lineNumberRuler);
}
},setOverviewRulerVisible:function(_2aef){
if(this._overviewRulerVisible===_2aef){
return;
}
this._overviewRulerVisible=_2aef;
if(!this._overviewRuler){
return;
}
var _2af0=this._textView;
if(_2aef){
_2af0.addRuler(this._overviewRuler);
}else{
_2af0.removeRuler(this._overviewRuler);
}
},mapOffset:function(_2af1,_2af2){
var _2af3=this._textView;
var model=_2af3.getModel();
if(model.getBaseModel){
_2af1=model.mapOffset(_2af1,_2af2);
}
return _2af1;
},getCaretOffset:function(){
return this.mapOffset(this._textView.getCaretOffset());
},getSelection:function(){
var _2af4=this._textView;
var _2af5=_2af4.getSelection();
var model=_2af4.getModel();
if(model.getBaseModel){
_2af5.start=model.mapOffset(_2af5.start);
_2af5.end=model.mapOffset(_2af5.end);
}
return _2af5;
},getText:function(start,end){
var _2af6=this._textView;
var model=_2af6.getModel();
if(model.getBaseModel){
model=model.getBaseModel();
}
return model.getText(start,end);
},_expandOffset:function(_2af7){
var model=this._textView.getModel();
var _2af8=this._annotationModel;
if(!_2af8||!model.getBaseModel){
return;
}
var _2af9=_2af8.getAnnotations(_2af7,_2af7+1);
while(_2af9.hasNext()){
var _2afa=_2af9.next();
if(_2afa.type===_2ae3.AnnotationType.ANNOTATION_FOLDING){
if(_2afa.expand){
_2afa.expand();
_2af8.modifyAnnotation(_2afa);
}
}
}
},setCaretOffset:function(_2afb){
var _2afc=this._textView;
var model=_2afc.getModel();
if(model.getBaseModel){
this._expandOffset(_2afb);
_2afb=model.mapOffset(_2afb,true);
}
_2afc.setCaretOffset(_2afb);
},setText:function(text,start,end){
var _2afd=this._textView;
var model=_2afd.getModel();
if(model.getBaseModel){
if(start!==undefined){
this._expandOffset(start);
start=model.mapOffset(start,true);
}
if(end!==undefined){
this._expandOffset(end);
end=model.mapOffset(end,true);
}
}
_2afd.setText(text,start,end);
},setFoldingEnabled:function(_2afe){
this.setFoldingRulerVisible(_2afe);
},setSelection:function(start,end,show){
var _2aff=this._textView;
var model=_2aff.getModel();
if(model.getBaseModel){
this._expandOffset(start);
this._expandOffset(end);
start=model.mapOffset(start,true);
end=model.mapOffset(end,true);
}
_2aff.setSelection(start,end,show);
},moveSelection:function(start,end,_2b00,focus){
end=end||start;
var _2b01=this._textView;
this.setSelection(start,end,false);
var _2b02=_2b01.getTopPixel();
var _2b03=_2b01.getBottomPixel();
var model=this.getModel();
var line=model.getLineAtOffset(start);
var _2b04=_2b01.getLinePixel(line);
if(_2b04<_2b02||_2b04>_2b03){
var _2b05=_2b03-_2b02;
var _2b06=Math.max(0,_2b04-Math.floor((_2b04<_2b02?3:1)*_2b05/4));
var a=new _2ae5({node:_2b01,duration:300,curve:[_2b02,_2b06],onAnimate:function(x){
_2b01.setTopPixel(Math.floor(x));
},onEnd:function(){
_2b01.showSelection();
if(focus===undefined||focus){
_2b01.focus();
}
if(_2b00){
_2b00();
}
}});
a.play();
}else{
_2b01.showSelection();
if(focus===undefined||focus){
_2b01.focus();
}
if(_2b00){
_2b00();
}
}
},checkDirty:function(){
this.setDirty(!this._undoStack.isClean());
},reportStatus:function(_2b07,type,_2b08){
if(this._statusReporter){
this._statusReporter(_2b07,type,_2b08);
}else{
window.alert(type==="error"?"ERROR: "+_2b07:_2b07);
}
},_getTooltipInfo:function(x,y){
var _2b09=this._textView;
var _2b0a=this.getAnnotationModel();
if(!_2b0a){
return null;
}
var _2b0b=this._annotationStyler;
if(!_2b0b){
return null;
}
var _2b0c=_2b09.getOffsetAtLocation(x,y);
if(_2b0c===-1){
return null;
}
_2b0c=this.mapOffset(_2b0c);
var _2b0d=_2b0b.getAnnotationsByType(_2b0a,_2b0c,_2b0c+1);
var _2b0e=[];
for(var i=0;i<_2b0d.length;i++){
if(_2b0d[i].rangeStyle){
_2b0e.push(_2b0d[i]);
}
}
if(_2b0e.length===0){
return null;
}
var pt=_2b09.convert({x:x,y:y},"document","page");
var info={contents:_2b0e,anchor:"left",x:pt.x+10,y:pt.y+20};
return info;
},_highlightCurrentLine:function(_2b0f,_2b10){
var _2b11=this._annotationModel;
if(!_2b11){
return;
}
var _2b12=this._textView;
var model=_2b12.getModel();
var _2b13=_2b10?model.getLineAtOffset(_2b10.start):-1;
var _2b14=model.getLineAtOffset(_2b0f.start);
var _2b15=_2b0f.start===_2b0f.end;
var _2b16=!_2b10||_2b10.start===_2b10.end;
if(!(_2b13===_2b14&&_2b16&&_2b15)){
var _2b17=this._currentLineAnnotation?[this._currentLineAnnotation]:null;
this._currentLineAnnotation=null;
var add;
if(_2b15){
var start=model.getLineStart(_2b14);
var end=model.getLineEnd(_2b14);
if(model.getBaseModel){
start=model.mapOffset(start);
end=model.mapOffset(end);
}
var type=_2ae3.AnnotationType.ANNOTATION_CURRENT_LINE;
this._currentLineAnnotation=_2ae3.AnnotationType.createAnnotation(type,start,end);
add=[this._currentLineAnnotation];
}
_2b11.replaceAnnotations(_2b17,add);
}
},highlightAnnotations:function(){
if(this._annotationStyler){
this._annotationStyler.destroy();
this._annotationStyler=null;
}
if(this._annotationFactory){
this._annotationStyler=this._annotationFactory.createAnnotationStyler(this.getTextView(),this._annotationModel);
this._annotationStyler.addAnnotationType(_2ae3.AnnotationType.ANNOTATION_CURRENT_SEARCH);
this._annotationStyler.addAnnotationType(_2ae3.AnnotationType.ANNOTATION_MATCHING_SEARCH);
this._annotationStyler.addAnnotationType(_2ae3.AnnotationType.ANNOTATION_ERROR);
this._annotationStyler.addAnnotationType(_2ae3.AnnotationType.ANNOTATION_WARNING);
this._annotationStyler.addAnnotationType(_2ae3.AnnotationType.ANNOTATION_MATCHING_BRACKET);
this._annotationStyler.addAnnotationType(_2ae3.AnnotationType.ANNOTATION_CURRENT_BRACKET);
this._annotationStyler.addAnnotationType(_2ae3.AnnotationType.ANNOTATION_CURRENT_LINE);
this._annotationStyler.addAnnotationType(_2ae6);
}
},installTextView:function(){
this._textView=this._textViewFactory();
if(this._undoStackFactory){
this._undoStack=this._undoStackFactory.createUndoStack(this);
}
if(this._textDNDFactory){
this._textDND=this._textDNDFactory.createTextDND(this,this._undoStack);
}
if(this._contentAssistFactory){
var _2b18=this._contentAssistFactory.createContentAssistMode(this);
this._keyModes.push(_2b18);
this._contentAssist=_2b18.getContentAssist();
}
var _2b19=this,_2b1a=this._textView;
var self=this;
this._listener={onModelChanged:function(e){
self.checkDirty();
},onMouseOver:function(e){
self._listener.onMouseMove(e);
},onMouseMove:function(e){
var _2b1b=_2ae2.Tooltip.getTooltip(_2b1a);
if(!_2b1b){
return;
}
_2b1b.setTarget({x:e.x,y:e.y,getTooltipInfo:function(){
return self._getTooltipInfo(this.x,this.y);
}});
},onMouseOut:function(_2b1c,e){
var _2b1d=_2ae2.Tooltip.getTooltip(_2b1a);
if(!_2b1d){
return;
}
_2b1d.setTarget(null);
},onSelection:function(e){
self._updateCursorStatus();
self._highlightCurrentLine(e.newValue,e.oldValue);
}};
_2b1a.addEventListener("ModelChanged",this._listener.onModelChanged);
_2b1a.addEventListener("Selection",this._listener.onSelection);
_2b1a.addEventListener("MouseOver",this._listener.onMouseOver);
_2b1a.addEventListener("MouseOut",this._listener.onMouseOut);
_2b1a.addEventListener("MouseMove",this._listener.onMouseMove);
if(this._keyBindingFactory){
this._keyBindingFactory(this,this._keyModes,this._undoStack,this._contentAssist);
}
_2b1a.setKeyBinding(new _2ae0.KeyBinding(27),"cancelMode");
_2b1a.setAction("cancelMode",function(){
var _2b1e=false;
for(var i=0;i<this._keyModes.length;i++){
if(this._keyModes[i].isActive()){
_2b1e=this._keyModes[i].cancel()||_2b1e;
}
}
return _2b1e;
}.bind(this),{name:_2adf.cancelMode});
_2b1a.setAction("lineUp",function(){
for(var i=0;i<this._keyModes.length;i++){
if(this._keyModes[i].isActive()){
return this._keyModes[i].lineUp();
}
}
return false;
}.bind(this));
_2b1a.setAction("lineDown",function(){
for(var i=0;i<this._keyModes.length;i++){
if(this._keyModes[i].isActive()){
return this._keyModes[i].lineDown();
}
}
return false;
}.bind(this));
_2b1a.setAction("enter",function(){
for(var i=0;i<this._keyModes.length;i++){
if(this._keyModes[i].isActive()){
return this._keyModes[i].enter();
}
}
return false;
}.bind(this));
if(this._annotationFactory){
var _2b1f=_2b1a.getModel();
if(_2b1f.getBaseModel){
_2b1f=_2b1f.getBaseModel();
}
this._annotationModel=this._annotationFactory.createAnnotationModel(_2b1f);
_2b1a.annotationModel=this._annotationModel;
var _2b20=this._annotationFactory.createAnnotationRulers(this._annotationModel);
var ruler=this._annotationRuler=_2b20.annotationRuler;
if(ruler){
ruler.onClick=function(_2b21,e){
if(_2b21===undefined){
return;
}
if(_2b21===-1){
return;
}
var _2b22=_2b1a.getModel();
var _2b23=this.getAnnotationModel();
var _2b24=_2b19.mapOffset(_2b22.getLineStart(_2b21));
var _2b25=_2b19.mapOffset(_2b22.getLineEnd(_2b21));
var _2b26=_2b23.getAnnotations(_2b24,_2b25);
while(_2b26.hasNext()){
var _2b27=_2b26.next();
if(!this.isAnnotationTypeVisible(_2b27.type)){
continue;
}
var model=_2b19.getModel();
_2b19.onGotoLine(model.getLineAtOffset(_2b24),_2b27.start-_2b24,_2b27.end-_2b24);
break;
}
};
ruler.setMultiAnnotationOverlay({html:"<div class='annotationHTML overlay'></div>"});
ruler.addAnnotationType(_2ae3.AnnotationType.ANNOTATION_ERROR);
ruler.addAnnotationType(_2ae3.AnnotationType.ANNOTATION_WARNING);
ruler.addAnnotationType(_2ae3.AnnotationType.ANNOTATION_TASK);
}
this.setAnnotationRulerVisible(true);
ruler=this._overviewRuler=_2b20.overviewRuler;
if(ruler){
ruler.onClick=function(_2b28,e){
if(_2b28===undefined){
return;
}
var _2b29=_2b1a.getModel().getLineStart(_2b28);
_2b19.moveSelection(_2b19.mapOffset(_2b29));
};
ruler.addAnnotationType(_2ae3.AnnotationType.ANNOTATION_CURRENT_SEARCH);
ruler.addAnnotationType(_2ae3.AnnotationType.ANNOTATION_MATCHING_SEARCH);
ruler.addAnnotationType(_2ae3.AnnotationType.ANNOTATION_ERROR);
ruler.addAnnotationType(_2ae3.AnnotationType.ANNOTATION_WARNING);
ruler.addAnnotationType(_2ae3.AnnotationType.ANNOTATION_TASK);
ruler.addAnnotationType(_2ae3.AnnotationType.ANNOTATION_MATCHING_BRACKET);
ruler.addAnnotationType(_2ae3.AnnotationType.ANNOTATION_CURRENT_BRACKET);
ruler.addAnnotationType(_2ae3.AnnotationType.ANNOTATION_CURRENT_LINE);
}
this.setOverviewRulerVisible(true);
}
if(this._lineNumberRulerFactory){
this._lineNumberRuler=this._lineNumberRulerFactory.createLineNumberRuler(this._annotationModel);
this.setLineNumberRulerVisible(true);
}
if(this._foldingRulerFactory){
this._foldingRuler=this._foldingRulerFactory.createFoldingRuler(this._annotationModel);
this._foldingRuler.addAnnotationType(_2ae3.AnnotationType.ANNOTATION_FOLDING);
this.setFoldingRulerVisible(false);
}
var _2b2a={type:"TextViewInstalled",textView:_2b1a};
this.dispatchEvent(_2b2a);
},_updateCursorStatus:function(){
var model=this.getModel();
var _2b2b=this.getCaretOffset();
var _2b2c=model.getLineAtOffset(_2b2b);
var _2b2d=model.getLineStart(_2b2c);
var _2b2e=_2b2b-_2b2d;
for(var i=0;i<this._keyModes.length;i++){
var mode=this._keyModes[i];
if(mode.isActive()&&mode.isStatusActive&&mode.isStatusActive()){
return;
}
}
},showProblems:function(_2b2f){
var _2b30=this._annotationModel;
if(!_2b30){
return;
}
var _2b31=[],add=[];
var model=_2b30.getTextModel();
var _2b32=_2b30.getAnnotations(0,model.getCharCount()),_2b33;
while(_2b32.hasNext()){
_2b33=_2b32.next();
if(_2b33.type===_2ae3.AnnotationType.ANNOTATION_ERROR||_2b33.type===_2ae3.AnnotationType.ANNOTATION_WARNING){
_2b31.push(_2b33);
}
}
if(_2b2f){
for(var i=0;i<_2b2f.length;i++){
var _2b34=_2b2f[i];
if(_2b34){
var _2b35=_2b34.description.replace(/'/g,"&#39;").replace(/"/g,"&#34;");
var _2b36=_2b34.line-1;
var _2b37=model.getLineStart(_2b36);
var _2b38=_2b34.severity;
var type=_2b38==="error"?_2ae3.AnnotationType.ANNOTATION_ERROR:_2ae3.AnnotationType.ANNOTATION_WARNING;
var start=_2b37+_2b34.start-1;
var end=_2b37+_2b34.end;
_2b33=_2ae3.AnnotationType.createAnnotation(type,start,end,_2b35);
add.push(_2b33);
}
}
}
_2b30.replaceAnnotations(_2b31,add);
},showSelection:function(start,end,line,_2b39,_2b3a){
if(typeof (start)==="number"){
if(typeof (end)!=="number"){
end=start;
}
this.moveSelection(start,end);
}else{
if(typeof (line)==="number"){
var model=this.getModel();
var pos=model.getLineStart(line-1);
if(typeof (_2b39)==="number"){
pos=pos+_2b39;
}
if(typeof (_2b3a)!=="number"){
_2b3a=0;
}
this.moveSelection(pos,pos+_2b3a);
}
}
},setInput:function(title,_2b3b,_2b3c,_2b3d){
this._title=title;
if(this._textView){
if(_2b3d){
this._undoStack.markClean();
this.checkDirty();
}else{
if(_2b3b){
this._textView.setText(_2b3b);
}else{
if(_2b3c!==null&&_2b3c!==undefined){
this._textView.setText(_2b3c);
this._textView.getModel().setLineDelimiter("auto");
this._highlightCurrentLine(this._textView.getSelection());
}
}
this._undoStack.reset();
this.checkDirty();
this._textView.focus();
}
}
this.onInputChanged({type:"InputChanged",title:title,message:_2b3b,contents:_2b3c,contentsSaved:_2b3d});
},onInputChanged:function(_2b3e){
return this.dispatchEvent(_2b3e);
},onGotoLine:function(line,_2b3f,end){
if(this._textView){
var model=this.getModel();
var _2b40=model.getLineStart(line);
var start=0;
if(end===undefined){
end=0;
}
if(typeof _2b3f==="string"){
var index=model.getLine(line).indexOf(_2b3f);
if(index!==-1){
start=index;
end=start+_2b3f.length;
}
}else{
start=_2b3f;
var _2b41=model.getLineEnd(line)-_2b40;
start=Math.min(start,_2b41);
end=Math.min(end,_2b41);
}
this.moveSelection(_2b40+start,_2b40+end);
}
},onDirtyChanged:function(_2b42){
return this.dispatchEvent(_2b42);
}};
_2ae1.EventTarget.addMixin(_2ae7.prototype);
_2ae5=(function(){
function _2ae5(_2b43){
this.options=_2b43;
};
_2ae5.prototype.play=function(){
var _2b44=(typeof this.options.duration==="number")?this.options.duration:350,rate=(typeof this.options.rate==="number")?this.options.rate:20,_2b45=this.options.easing||this.defaultEasing,_2b46=this.options.onAnimate||function(){
},onEnd=this.options.onEnd||function(){
},start=this.options.curve[0],end=this.options.curve[1],range=(end-start);
var _2b47,_2b48,_2b49=-1;
function _2b4a(){
_2b49=(_2b49===-1)?new Date().getTime():_2b49;
var now=new Date().getTime(),_2b4b=(now-_2b49)/_2b44;
if(_2b4b<1){
var eased=_2b45(_2b4b);
_2b47=start+(eased*range);
_2b46(_2b47);
}else{
clearInterval(_2b48);
onEnd();
}
};
_2b48=setInterval(_2b4a,rate);
};
_2ae5.prototype.defaultEasing=function(x){
return Math.sin(x*(Math.PI/2));
};
return _2ae5;
}());
function bind(_2b4c){
var fn=this,fixed=Array.prototype.slice.call(arguments,1);
if(fixed.length){
return function(){
return arguments.length?fn.apply(_2b4c,fixed.concat(Array.prototype.slice.call(arguments))):fn.apply(_2b4c,fixed);
};
}
return function(){
return arguments.length?fn.apply(_2b4c,arguments):fn.call(_2b4c);
};
};
if(!Function.prototype.bind){
Function.prototype.bind=bind;
}
return {Editor:_2ae7,util:{bind:bind}};
});
},"davinci/ui/widgets/_ToggleTreeNode":function(){
define(["dojo/_base/declare","dijit/Tree","dojo/text!./templates/TreeNode.html"],function(_2b4d,Tree,_2b4e){
return _2b4d("davinci.ui.widgets._ToggleTreeNode",dijit._TreeNode,{_setLabelAttr:{node:"labelNode",type:"innerHTML"},postCreate:function(){
this.inherited(arguments);
if(this.tree.model.useRichTextLabel){
this.labelNode.innerHTML=this.label;
}
if(!this.tree.model.toggleMode||!this.shouldShowElement("toggleNode",this.item)){
dojo.addClass(this.toggleNode,"dijitHidden");
}else{
if(this.tree.model.isToggleOn(this.item)){
this._setToggleAttr(true);
}
}
if(this.tree.model.postCreate){
this.tree.model.postCreate(this);
}
},shouldShowElement:function(_2b4f,item){
return this.tree.model.shouldShowElement&&this.tree.model.shouldShowElement(_2b4f,item);
},toggle:false,templateString:_2b4e,_onToggleClick:function(e){
var _2b50=this.tree.model.toggle(this.item,!this.toggle,this);
if(_2b50!==false){
this._setToggleAttr(!this.toggle);
}
},_setToggleAttr:function(on){
this.toggle=(on===undefined)?!this.toggle:on;
if(this.toggleNode){
dojo.toggleClass(this.toggleNode,"dvOutlineVisibilityOn",!on);
dojo.toggleClass(this.toggleNode,"dvOutlineVisibilityOff",on);
}
if(this.toggle){
this.tree.toggledItems[this.item]=true;
}else{
delete this.tree.toggledItems[this.item];
}
},_getToggleAttr:function(){
return this.toggle;
}});
});
},"dijit/MenuBar":function(){
require({cache:{"url:dijit/templates/MenuBar.html":"<div class=\"dijitMenuBar dijitMenuPassive\" data-dojo-attach-point=\"containerNode\"  role=\"menubar\" tabIndex=\"${tabIndex}\" data-dojo-attach-event=\"onkeypress: _onKeyPress\"></div>\n"}});
define("dijit/MenuBar",["dojo/_base/declare","dojo/_base/event","dojo/keys","./_MenuBase","dojo/text!./templates/MenuBar.html"],function(_2b51,event,keys,_2b52,_2b53){
return _2b51("dijit.MenuBar",_2b52,{templateString:_2b53,baseClass:"dijitMenuBar",_isMenuBar:true,postCreate:function(){
this.inherited(arguments);
var l=this.isLeftToRight();
this.connectKeyNavHandlers(l?[keys.LEFT_ARROW]:[keys.RIGHT_ARROW],l?[keys.RIGHT_ARROW]:[keys.LEFT_ARROW]);
this._orient=["below"];
},_moveToPopup:function(evt){
if(this.focusedChild&&this.focusedChild.popup&&!this.focusedChild.disabled){
this.onItemClick(this.focusedChild,evt);
}
},focusChild:function(item){
var _2b54=this.focusedChild,_2b55=_2b54&&_2b54.popup&&_2b54.popup.isShowingNow;
this.inherited(arguments);
if(_2b55&&item.popup&&!item.disabled){
this._openPopup(true);
}
},_onKeyPress:function(evt){
if(evt.ctrlKey||evt.altKey){
return;
}
switch(evt.charOrCode){
case keys.DOWN_ARROW:
this._moveToPopup(evt);
event.stop(evt);
}
},onItemClick:function(item,evt){
if(item.popup&&item.popup.isShowingNow&&(evt.type!=="keypress"||evt.keyCode!==keys.DOWN_ARROW)){
item.popup.onCancel();
}else{
this.inherited(arguments);
}
}});
});
},"davinci/ui/widgets/ThemeSetSelection":function(){
require({cache:{"url:davinci/ui/widgets/templates/ThemeSetSelection.html":"<div>\n  <div class=\"dijitDialogPaneContentArea\">\n\t\t<table style=\"width: 100%; padding-left:10px; padding-right:10px;\">\n\t\t\t<tr>\n\t\t\t\t<td style=\"\" NOWRAP>${uiNLS.themeSet}</td>\n\t\t\t\t<td style=\"width: 100%; text-align: center;\"><select dojoType=\"dijit.form.Select\" id=\"theme_select_themeset_theme_select\" type=\"text\" style=\"width: 175px;\" ></select></td>\n\t\t\t</tr>\n\t\t</table>\n\t\n\t\t<div style=\"border-top: 1px solid black; top: 231px; border-top-color: #ccc; left: 429px; width: 300px; height: 11px; margin-top: 6px; padding-left:10px;\"></div>\n\t\t<table style=\"padding-left: 15px; width: 100%;\">\n\t\t\t<tr><td style=\"width: 139px;\">${uiNLS.desktopTheme}</td><td><select dojoType=\"dijit.form.Select\" id=\"theme_select_desktop_theme_select\"type=\"text\"  style=\"width: 175px;\"  ></select></td></tr>\n\t\t\t<tr><td>${uiNLS.mobileTheme}</td><td><select dojoType=\"dijit.form.Select\" id=\"theme_select_mobile_theme_select\"type=\"text\"  style=\"width: 175px;\" ></select></td></tr>\n\t\t</table>\n\t\t<table id=\"theme_select_devices_table\" style=\"padding-left:30px; border-collapse: separate; border-spacing: 0 0; width: 100%\">\n\t\t\t<tr><td style=\"width: 139px;\">${uiNLS.android}</td><td><select dojoType=\"dijit.form.Select\" id=\"theme_select_android_select\" type=\"text\"  style=\"width: 150px;\"></select></td></tr>\n\t\t\t<tr><td>${uiNLS.blackberry}</td><td><select dojoType=\"dijit.form.Select\" id=\"theme_select_blackberry_select\" type=\"text\"  style=\"width: 150px;\"></select></td></tr>\n\t\t\t<tr><td>${uiNLS.ipad}</td><td><select dojoType=\"dijit.form.Select\" id=\"theme_select_ipad_select\" type=\"text\"  style=\"width: 150px;\"></select></td></tr>\n\t\t\t<tr><td>${uiNLS.iphone}</td><td><select dojoType=\"dijit.form.Select\" id=\"theme_select_iphone_select\" type=\"text\"  style=\"width: 150px;\"></select></td></tr>\n\t\t\t<tr><td>${uiNLS.other}</td><td><select dojoType=\"dijit.form.Select\" id=\"theme_select_other_select\" type=\"text\"  style=\"width: 150px;\"></select></td></tr>\n\t\t</table>\n\t</div>\n\n\t<div class=\"dijitDialogPaneActionBar\">\n\t\t<button dojoType=\"dijit.form.Button\" id=\"theme_select_ok_button\" label=\"${uiNLS.select}\" class=\"maqPrimaryButton\" type=\"submit\"></button>\n\t\t<button dojoType=\"dijit.form.Button\" id=\"theme_select_cancel_button\" label=\"${commonNLS.buttonCancel}\" class=\"maqSecondaryButton\"></button>\n\t</div>\n</div>\n"}});
define("davinci/ui/widgets/ThemeSetSelection",["dojo/_base/declare","dijit/_WidgetBase","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","davinci/library","system/resource","davinci/workbench/Preferences","davinci/Runtime","davinci/Workbench","davinci/ve/commands/ChangeThemeCommand","davinci/ui/Dialog","dojo/i18n!davinci/ui/nls/ui","dojo/i18n!dijit/nls/common","dijit/form/Button","dijit/form/Select","davinci/Theme","dojo/text!./templates/ThemeSetSelection.html",],function(_2b56,_2b57,_2b58,_2b59,_2b5a,_2b5b,_2b5c,_2b5d,_2b5e,_2b5f,_2b60,uiNLS,_2b61,_2b62,_2b63,Theme,_2b64){
_2b56("davinci.ui.widgets.ThemeSetSelectionWidget",[_2b57,_2b58,_2b59],{templateString:_2b64,widgetsInTemplate:true,uiNLS:uiNLS,commonNLS:_2b61});
return _2b56("davinci.ui.widgets.ThemeSetSelection",null,{workspaceOnly:false,_connections:[],_selectedThemeSet:null,constructor:function(args){
dojo.safeMixin(this,args);
},buildRendering:function(){
var _2b65=uiNLS;
this._dialog=new _2b60({title:_2b65.selectTheme,contentStyle:{width:372}});
dojo.connect(this._dialog,"onCancel",this,"onClose");
var _2b66=null;
if(!this.newFile){
_2b66=_2b5e.getOpenEditor().getContext();
}
var _2b67=Theme.getThemeSet(_2b66);
if(!_2b67){
_2b67=Theme.dojoThemeSets.themeSets[0];
}
this._selectedThemeSet=_2b67;
this._dialog.attr("content",new davinci.ui.widgets.ThemeSetSelectionWidget({}));
this._connections.push(dojo.connect(dijit.byId("theme_select_themeset_theme_select"),"onChange",this,"onChange"));
this._connections.push(dojo.connect(dijit.byId("theme_select_desktop_theme_select"),"onChange",this,"onDesktopChange"));
this._connections.push(dojo.connect(dijit.byId("theme_select_mobile_theme_select"),"onChange",this,"onMobileChange"));
this._connections.push(dojo.connect(this._dialog,"onExecute",this,"onOk"));
this._connections.push(dojo.connect(dijit.byId("theme_select_cancel_button"),"onClick",this,"onClose"));
this._connections.push(dojo.connect(dijit.byId("theme_select_android_select"),"onChange",this,"onAndroidThemeChange"));
this._connections.push(dojo.connect(dijit.byId("theme_select_blackberry_select"),"onChange",this,"onBlackberryThemeChange"));
this._connections.push(dojo.connect(dijit.byId("theme_select_ipad_select"),"onChange",this,"oniPadThemeChange"));
this._connections.push(dojo.connect(dijit.byId("theme_select_iphone_select"),"onChange",this,"oniPhoneThemeChange"));
this._connections.push(dojo.connect(dijit.byId("theme_select_other_select"),"onChange",this,"onOtherThemeChange"));
this.addThemeSets();
var _2b68=dijit.byId("theme_select_themeset_theme_select");
_2b68.attr("value",_2b67.name);
this._dialog.show();
},addThemeSets:function(){
this._dojoThemeSets=_2b5c.getPreferences("maqetta.dojo.themesets",_2b5e.getProject());
if(!this._dojoThemeSets){
this._dojoThemeSets=Theme.dojoThemeSets;
}
this._dojoThemeSets=dojo.clone(this._dojoThemeSets);
if(this._selectedThemeSet.name==Theme.none_themeset_name){
this._dojoThemeSets.themeSets.unshift(this._selectedThemeSet);
}else{
this._dojoThemeSets.themeSets.unshift(Theme.none_themeset);
}
var _2b69=dijit.byId("theme_select_themeset_theme_select");
for(var i=0;i<this._dojoThemeSets.themeSets.length;i++){
opt={value:this._dojoThemeSets.themeSets[i].name,label:this._dojoThemeSets.themeSets[i].name};
_2b69.addOption(opt);
}
},addThemes:function(_2b6a){
this._themeData=_2b5a.getThemes(_2b5e.getProject(),this.workspaceOnly,true);
var _2b6b=dijit.byId("theme_select_desktop_theme_select");
_2b6b.options=[];
var _2b6c=dijit.byId("theme_select_android_select");
_2b6c.options=[];
var _2b6d=dijit.byId("theme_select_blackberry_select");
_2b6d.options=[];
var _2b6e=dijit.byId("theme_select_ipad_select");
_2b6e.options=[];
var _2b6f=dijit.byId("theme_select_iphone_select");
_2b6f.options=[];
var _2b70=dijit.byId("theme_select_other_select");
_2b70.options=[];
var _2b71=dijit.byId("theme_select_mobile_theme_select");
_2b6b.options=[];
_2b71.options=[];
_2b71.addOption({value:Theme.default_theme,label:Theme.default_theme});
this._themeCount=this._themeData.length;
for(var i=0;i<this._themeData.length;i++){
var opt={value:this._themeData[i].name,label:this._themeData[i].name};
if(this._themeData[i].type==="dojox.mobile"){
_2b71.addOption(opt);
_2b6c.addOption(opt);
_2b6d.addOption(opt);
_2b6e.addOption(opt);
_2b6f.addOption(opt);
_2b70.addOption(opt);
}else{
_2b6b.addOption(opt);
}
}
_2b6b.attr("value",_2b6a.desktopTheme);
for(var d=0;d<_2b6a.mobileTheme.length;d++){
var _2b72=_2b6a.mobileTheme[d].device.toLowerCase();
switch(_2b72){
case "android":
_2b6c.attr("value",_2b6a.mobileTheme[d].theme);
break;
case "blackberry":
_2b6d.attr("value",_2b6a.mobileTheme[d].theme);
break;
case "ipad":
_2b6e.attr("value",_2b6a.mobileTheme[d].theme);
break;
case "iphone":
_2b6f.attr("value",_2b6a.mobileTheme[d].theme);
break;
case "other":
_2b70.attr("value",_2b6a.mobileTheme[d].theme);
break;
}
}
if(Theme.singleMobileTheme(_2b6a)){
_2b71.attr("value",_2b6a.mobileTheme[_2b6a.mobileTheme.length-1].theme);
}else{
_2b71.attr("value",Theme.default_theme);
}
},onChange:function(e){
for(var i=0;i<this._dojoThemeSets.themeSets.length;i++){
if(this._dojoThemeSets.themeSets[i].name==e){
this.addThemes(this._dojoThemeSets.themeSets[i]);
this._selectedThemeSet=this._dojoThemeSets.themeSets[i];
break;
}
}
var _2b73=dijit.byId("theme_select_mobile_theme_select");
var _2b74=dijit.byId("theme_select_desktop_theme_select");
var _2b75=dijit.byId("theme_select_android_select");
var _2b76=dijit.byId("theme_select_blackberry_select");
var _2b77=dijit.byId("theme_select_ipad_select");
var _2b78=dijit.byId("theme_select_iphone_select");
var _2b79=dijit.byId("theme_select_other_select");
if(e===Theme.none_themeset_name){
_2b73.set("disabled",false);
_2b74.set("disabled",false);
_2b75.set("disabled",false);
_2b76.set("disabled",false);
_2b77.set("disabled",false);
_2b78.set("disabled",false);
_2b79.set("disabled",false);
}else{
_2b73.set("disabled",true);
_2b74.set("disabled",true);
_2b75.set("disabled",true);
_2b76.set("disabled",true);
_2b77.set("disabled",true);
_2b78.set("disabled",true);
_2b79.set("disabled",true);
}
},onDesktopChange:function(e){
this._selectedThemeSet.desktopTheme=e;
},onDeviceThemeChange:function(_2b7a,e){
for(var d=0;d<this._selectedThemeSet.mobileTheme.length;d++){
if(this._selectedThemeSet.mobileTheme[d].device.toLowerCase()===_2b7a.toLowerCase()){
this._selectedThemeSet.mobileTheme[d].theme=e;
break;
}
}
},onAndroidThemeChange:function(e){
this.onDeviceThemeChange("android",e);
},onBlackberryThemeChange:function(e){
this.onDeviceThemeChange("blackberry",e);
},oniPadThemeChange:function(e){
this.onDeviceThemeChange("ipad",e);
},oniPhoneThemeChange:function(e){
this.onDeviceThemeChange("iphone",e);
},onOtherThemeChange:function(e){
this.onDeviceThemeChange("other",e);
},onMobileChange:function(e){
if(this._selectedThemeSet.name!=Theme.none_themeset_name){
return;
}
var _2b7b=dijit.byId("theme_select_android_select");
var _2b7c=dijit.byId("theme_select_blackberry_select");
var _2b7d=dijit.byId("theme_select_ipad_select");
var _2b7e=dijit.byId("theme_select_iphone_select");
var _2b7f=dijit.byId("theme_select_other_select");
if((e==="(device-specific)")&&(this._selectedThemeSet.name===Theme.none_themeset_name)){
_2b7b.set("disabled",false);
_2b7c.set("disabled",false);
_2b7d.set("disabled",false);
_2b7e.set("disabled",false);
_2b7f.set("disabled",false);
}else{
for(var d=0;d<this._selectedThemeSet.mobileTheme.length;d++){
var _2b80=this._selectedThemeSet.mobileTheme[d].device.toLowerCase();
this._selectedThemeSet.mobileTheme[d].theme=e;
switch(_2b80){
case "android":
_2b7b.attr("value",e);
_2b7b.set("disabled",true);
break;
case "blackberry":
_2b7c.attr("value",e);
_2b7c.set("disabled",true);
break;
case "ipad":
_2b7d.attr("value",e);
_2b7d.set("disabled",true);
break;
case "iphone":
_2b7e.attr("value",e);
_2b7e.set("disabled",true);
break;
case "other":
_2b7f.attr("value",e);
_2b7f.set("disabled",true);
break;
}
}
}
},updateDeviceThemes:function(){
for(var i=0;i<this._selectedThemeSet.mobileTheme.length;i++){
var _2b81;
switch(this._selectedThemeSet.mobileTheme[i].device.toLowerCase()){
case "android":
_2b81=dijit.byId("theme_select_android_select");
break;
case "blackberry":
_2b81=dijit.byId("theme_select_blackberry_select");
break;
case "ipad":
_2b81=dijit.byId("theme_select_ipad_select");
break;
case "iphone":
_2b81=dijit.byId("theme_select_iphone_select");
break;
default:
_2b81=dijit.byId("theme_select_other_select");
}
this._selectedThemeSet.mobileTheme[i].theme=_2b81.attr("value");
}
},_changeTheme:function(){
debugger;
var e=_2b5e.getOpenEditor();
if(e&&e.getContext){
e.getContext().getCommandStack().execute(new _2b5f(newTheme,e.getContext()));
}
},_onChange:function(){
var _2b82=uiNLS;
var loc=_2b61;
var _2b83=this._getValueAttr();
if(_2b83==null||this._blockChange){
return;
}
this.value=_2b83;
this._cookieName="maqetta_"+_2b83.name+"_"+_2b83.version;
var _2b84=dojo.cookie(this._cookieName);
if(this.dojoVersion&&_2b83.version!==this.dojoVersion&&!_2b84){
this._warnDiv.innerHTML="<table>"+"<tr><td></td><td>"+_2b82.themeVersionMessage+"</td><td></td></tr>"+"<tr><td></td><td align=\"center\"><button data-dojo-type=\"dijit.form.Button\" type=\"button\" id=\"davinci.ui.widgets.ThemeSelection.ok\">"+loc.buttonOk+"</button><button data-dojo-type=\"dijit.form.Button\" type=\"button\" id=\"davinci.ui.widgets.ThemeSelection.cancel\">"+loc.buttonCancel+"</button></td><td></td></tr>"+"</table>";
var ok=dijit.byId("davinci.ui.widgets.ThemeSelection.ok");
var _2b85=dijit.byId("davinci.ui.widgets.ThemeSelection.cancel");
dojo.connect(ok,"onClick",this,"_warnOk");
dojo.connect(_2b85,"onClick",this,"_warnCancel");
}else{
this.onChange();
}
},_warnOk:function(){
dojo.cookie(this._cookieName,"true");
this._destroy();
this.onChange();
},_warnCancel:function(){
this._destroy();
this.onClose();
},_destroy:function(){
var ok=dijit.byId("davinci.ui.widgets.ThemeSelection.ok");
dojo.disconnect(ok);
ok.destroy();
var _2b86=dijit.byId("davinci.ui.widgets.ThemeSelection.cancel");
dojo.disconnect(_2b86);
_2b86.destroy();
},onOk:function(e){
this.onClose(e);
if(!this.newFile){
var e=_2b5e.getOpenEditor();
if(e&&e.getContext){
e.getContext().getCommandStack().execute(new _2b5f(this._selectedThemeSet,e.getContext()));
}
}
},onClose:function(e){
while(connection=this._connections.pop()){
dojo.disconnect(connection);
}
this._dialog.destroyRecursive();
delete this._dialog;
},_getTemplate:function(){
var _2b87=uiNLS;
var loc=_2b61;
var _2b88=""+"<table style=\"width: 100%; margin-left:10px; margin-right:10px;\">"+"<tr><td style=\"width: 18%;\">"+_2b87.themeSet+"</td><td style=\"text-align: center;\"><select dojoType=\"dijit.form.Select\" id=\"theme_select_themeset_theme_select\" type=\"text\" style=\"width: 175px;\" ></select></td></tr>"+"</table>"+"<div style=\"border-top: 1px solid black; top: 231px; border-top-color: #ccc; left: 429px; width: 300px; height: 11px; margin-top: 6px; margin-left:10px;\"></div>"+"<table style=\"margin-left: 15px; width: 100%;\">"+"<tr><td>"+_2b87.desktopTheme+"</td><td><select dojoType=\"dijit.form.Select\" id=\"theme_select_desktop_theme_select\"type=\"text\"  style=\"width: 175px;\"  ></select></td></tr>"+"<tr><td>"+_2b87.mobileTheme+"</td><td><select dojoType=\"dijit.form.Select\" id=\"theme_select_mobile_theme_select\"type=\"text\"  style=\"width: 175px;\" ></select></td></tr>"+"</table>"+"<table id=\"theme_select_devices_table\" style=\"margin-left:30px; border-collapse: separate; border-spacing: 0 0; width: 100%\">"+"<tr><td style=\"width: 139px;\">"+_2b87.android+"</td><td><select dojoType=\"dijit.form.Select\" id=\"theme_select_android_select\" type=\"text\"  style=\"width: 150px;\"></select></td></tr>"+"<tr><td>"+_2b87.blackberry+"</td><td><select dojoType=\"dijit.form.Select\" id=\"theme_select_blackberry_select\" type=\"text\"  style=\"width: 150px;\"></select></td></tr>"+"<tr><td>"+_2b87.ipad+"</td><td><select dojoType=\"dijit.form.Select\" id=\"theme_select_ipad_select\" type=\"text\"  style=\"width: 150px;\"></select></td></tr>"+"<tr><td>"+_2b87.iphone+"</td><td><select dojoType=\"dijit.form.Select\" id=\"theme_select_iphone_select\" type=\"text\"  style=\"width: 150px;\"></select></td></tr>"+"<tr><td>"+_2b87.other+"</td><td><select dojoType=\"dijit.form.Select\" id=\"theme_select_other_select\" type=\"text\"  style=\"width: 150px;\"></select></td></tr>"+"</table>"+"<table style=\"width:100%; margin-top: 10px;\">"+"<tr><td style=\"text-align:right; width:80%;\"><input type=\"button\" dojoType=\"dijit.form.Button\" id=\"theme_select_ok_button\" label=\""+loc.buttonOk+"\"></input></td><td><input type=\"button\" dojoType=\"dijit.form.Button\" id=\"theme_select_cancel_button\" label=\""+loc.buttonCancel+"\"></input></td></tr>"+"</table>"+"";
return _2b88;
}});
});
},"davinci/review/review.plugin":function(){
define(["davinci/css!./resources/Comment.css"],function(){
return {id:"davinci.review","davinci.view":[{id:"comment",title:"Comments",viewClass:"davinci/review/view/CommentView",iconClass:"paletteIcon paletteIconComments"},{id:"reviewNavigator",title:"Reviews",viewClass:"davinci/review/view/CommentExplorerView",iconClass:"paletteIcon paletteIconReviews"},{id:"state",title:"States",viewClass:"davinci/ve/views/StatesView",iconClass:"paletteIcon paletteIconStates"}],"davinci.perspective":{id:"review",title:"Review",views:[{viewID:"davinci.ve.Palette",position:"left",hidden:true},{viewID:"davinci.ui.outline",position:"left",hidden:true},{viewID:"davinci.ve.style",position:"right"},{viewID:"davinci.ui.comment",position:"right",selected:true},{viewID:"davinci.ve.states",position:"right-bottom"},{viewID:"davinci.ui.navigator",position:"left-bottom"},{viewID:"davinci.review.reviewNavigator",position:"left",selected:true}]},"davinci.editor":[{id:"CommentReviewEditor",name:"Review Editor",extensions:"rev",isDefault:true,editorClass:"davinci/review/editor/ReviewEditor",editorClassName:"ReviewEditor",palettePerspective:"davinci.review.review",expandPalettes:["right"]}],"davinci.fileType":[{extension:"rev",iconClass:"reviewFileIcon",type:"text"}],"davinci.actionSets":[{id:"editorActionsReview",visible:true,actions:[{id:"newReview",action:"davinci/review/actions/PublishAction",iconClass:"newOpenMenuItem newReviewMenuItem",label:"Review...",menubarPath:"davinci.new/newTheme"}]},{id:"reviewExplorerActions",visible:true,actions:[{id:"davinci.review.view",label:"Open",action:"davinci/review/actions/ViewFileAction",menubarPath:"newfile"},{id:"davinci.review.edit",label:"Edit...",action:"davinci/review/actions/EditVersionAction",menubarPath:"newfile"},{id:"davinci.review.open",label:"Start",action:"davinci/review/actions/OpenVersionAction",menubarPath:"newfile"},{id:"davinci.review.close",label:"Stop...",action:"davinci/review/actions/CloseVersionAction",menubarPath:"newfile"},{id:"davinci.review.delete",label:"Delete...",action:"davinci/review/actions/DeleteVersionAction",menubarPath:"newfile",keyBinding:{charOrCode:[dojo.keys.DELETE,dojo.keys.BACKSPACE]}},{id:"davinci.review.restart",label:"Republish...",action:"davinci/review/actions/RestartVersionAction",menubarPath:"newfile"}]}],"davinci.actionSetPartAssociations":[{targetID:"davinci.review.editorActionsReview",parts:["davinci.ui.editorMenuBar"]},{targetID:"davinci.review.reviewExplorerActions",parts:["davinci.review.reviewNavigator"]}],"davinci.annotationActions":{editorContribution:{actions:[{id:"arrow",label:"Draw arrow",iconClass:"davinciAnnotationIcon davinciAnnotationIconArrow",action:"davinci/review/actions/ArrowAction",toolbarPath:"annotationtools"},{id:"rect",label:"Draw rectangle",iconClass:"davinciAnnotationIcon davinciAnnotationIconRect",action:"davinci/review/actions/RectAction",toolbarPath:"annotationtools"},{id:"ellipse",label:"Draw ellipse",iconClass:"davinciAnnotationIcon davinciAnnotationIconEllipse",action:"davinci/review/actions/EllipseAction",toolbarPath:"annotationtools"},{id:"textAnnotation",label:"Draw text",iconClass:"davinciAnnotationIcon davinciAnnotationIconText",action:"davinci/review/actions/TextAction",toolbarPath:"annotationtools"},{id:"deleteAnnotation",iconClass:"davinciAnnotationIcon davinciAnnotationIconDelete",label:"Delete Annotation",action:"davinci/review/actions/DeleteAnnotationAction",toolbarPath:"annotationtools_delete",keyBinding:{charOrCode:[dojo.keys.DELETE,dojo.keys.BACKSPACE]}}]}},"davinci.editorActions":{editorContribution:{targetID:"davinci.review.CommentReviewEditor",actions:[{id:"ReviewToolBarText",type:"davinci/review/widgets/ReviewToolBarText",toolbarPath:"ReviewToolBarText"}]}}};
});
},"dijit/form/_RadioButtonMixin":function(){
define("dijit/form/_RadioButtonMixin",["dojo/_base/array","dojo/_base/declare","dojo/dom-attr","dojo/_base/event","dojo/_base/lang","dojo/query","../registry"],function(array,_2b89,_2b8a,event,lang,query,_2b8b){
return _2b89("dijit.form._RadioButtonMixin",null,{type:"radio",_getRelatedWidgets:function(){
var ary=[];
query("input[type=radio]",this.focusNode.form||this.ownerDocument).forEach(lang.hitch(this,function(_2b8c){
if(_2b8c.name==this.name&&_2b8c.form==this.focusNode.form){
var _2b8d=_2b8b.getEnclosingWidget(_2b8c);
if(_2b8d){
ary.push(_2b8d);
}
}
}));
return ary;
},_setCheckedAttr:function(value){
this.inherited(arguments);
if(!this._created){
return;
}
if(value){
array.forEach(this._getRelatedWidgets(),lang.hitch(this,function(_2b8e){
if(_2b8e!=this&&_2b8e.checked){
_2b8e.set("checked",false);
}
}));
}
},_getSubmitValue:function(value){
return value===null?"on":value;
},_onClick:function(e){
if(this.checked||this.disabled){
event.stop(e);
return false;
}
if(this.readOnly){
event.stop(e);
array.forEach(this._getRelatedWidgets(),lang.hitch(this,function(_2b8f){
_2b8a.set(this.focusNode||this.domNode,"checked",_2b8f.checked);
}));
return false;
}
return this.inherited(arguments);
}});
});
},"davinci/workbench/Explorer":function(){
define("davinci/workbench/Explorer",["dojo/_base/declare","davinci/workbench/ViewPart","davinci/Workbench","davinci/Runtime","dijit/Tree","dojo/mouse","davinci/ui/dnd/DragSource","davinci/ui/Resource","davinci/ui/widgets/TransformTreeMixin","system/resource","davinci/ui/widgets/ProjectToolbar","davinci/ui/Download","davinci/ui/DownloadSelected","davinci/ui/UserLibraries",],function(_2b90,_2b91,_2b92,_2b93,Tree,mouse,_2b94){
return _2b90("davinci.workbench.Explorer",_2b91,{toolbarID:"workbench.Explorer",getActionsID:function(){
return "davinci.workbench.Explorer";
},postCreate:function(){
this.inherited(arguments);
var _2b95=_2b93.getExtensions("davinci.dnd",function(_2b96){
return dojo.some(_2b96.parts,function(item){
return item=="davinci.ui.navigator";
})&&_2b96.dragSource;
});
var model=system.resource;
var _2b97=_2b90(Tree,{_createTreeNode:function(args){
var _2b98=this.inherited(arguments);
if(_2b95&&args.item){
_2b95.forEach(function(_2b99){
if(_2b99.dragSource(args.item)){
var ds=new _2b94(_2b98.domNode,"component",_2b98);
ds.targetShouldShowCaret=true;
ds.returnCloneOnFailure=false;
require([_2b99.dragHandler],function(_2b9a){
ds.dragHandler=new _2b9a(args.item);
this.connect(ds,"initDrag",function(e){
if(ds.dragHandler.initDrag){
ds.dragHandler.initDrag(e);
}
});
this.connect(ds,"onDragStart",function(e){
ds.dragHandler.dragStart(e);
});
this.connect(ds,"onDragEnd",function(e){
ds.dragHandler.dragEnd(e);
});
}.bind(this));
}
},this);
}
return _2b98;
}});
var tree=this.tree=new _2b97({showRoot:false,persist:false,cookieName:"maqExplorer",model:model,id:"resourceTree",labelAttr:"name",childrenAttrs:"children",getIconClass:davinci.ui.Resource.getResourceIcon,getRowClass:davinci.ui.Resource.getResourceClass,transforms:[system.resource.alphabeticalSort],isMultiSelect:true});
dojo.style(tree.domNode,{width:"100%","overflow-x":"hidden",position:"absolute",bottom:0,top:"20px"});
var down=tree.dndController.onMouseDown,_2b9b=function(_2b9c,event){
if(mouse.isRight(event)){
var w=dijit.getEnclosingWidget(event.target);
if(this.tree.get("selectedItems").indexOf(w.item)===-1){
this.tree.set("selectedItems",[w.item]);
}
}
var stop=dojo.stopEvent;
dojo.stopEvent=function(){
};
try{
_2b9c.call(tree.dndController,event);
}
finally{
dojo.stopEvent=stop;
}
};
tree.dndController.onMouseDown=dojo.hitch(null,_2b9b,down);
var _2b9d=dojo.doc.createElement("div");
if(_2b92.singleProjectMode()){
var _2b9e=new davinci.ui.widgets.ProjectToolbar({});
_2b9d.appendChild(_2b9e.domNode);
dojo.connect(_2b9e,"onChange",function(){
_2b92.loadProject(this.value);
});
}
_2b9d.appendChild(tree.domNode);
this.setContent(_2b9d);
this.attachToolbar();
tree.startup();
dojo.connect(tree,"onDblClick",dojo.hitch(this,this._dblClick));
tree.watch("selectedItems",dojo.hitch(this,function(prop,_2b9f,_2ba0){
var items=dojo.map(_2ba0,function(item){
return {resource:item};
});
this.publish("/davinci/ui/selectionChanged",[items,this]);
}));
_2b92.createPopup({partID:"davinci.ui.navigator",domNode:this.tree.domNode,openCallback:function(event){
var w=dijit.getEnclosingWidget(event.target);
if(w&&w.item){
var nodes=tree.get("selectedNodes");
if(dojo.indexOf(nodes,w)==-1){
tree.set("selectedNodes",[w]);
}
}
}});
var o=_2b92.getActionSets("davinci.ui.navigator");
var _2ba1=o.clonedActionSets;
if(_2ba1){
dojo.forEach(_2ba1[0].actions,dojo.hitch(this,function(_2ba2){
if(_2ba2.keyBinding){
if(!this.keyBindings){
this.keyBindings=[];
}
this.keyBindings.push({keyBinding:_2ba2.keyBinding,action:_2ba2});
}
}));
}
dojo.connect(tree.domNode,"onkeypress",this,"_onKeyPress");
},destroy:function(){
this.inherited(arguments);
},_dblClick:function(node){
if(node.elementType=="File"){
_2b92.openEditor({fileName:node,content:node.getText(),isDirty:node.isDirty()});
}
},_onKeyPress:function(e){
var _2ba3=dojo.some(this.keyBindings,dojo.hitch(this,function(_2ba4){
if(_2b93.isKeyEqualToEvent(_2ba4.keyBinding,e)){
davinci.Workbench._runAction(_2ba4.action);
return true;
}
}));
if(_2ba3){
dojo.stopEvent(e);
}
return _2ba3;
}});
});
},"dojox/form/uploader/FileList":function(){
define("dojox/form/uploader/FileList",["dojo/_base/fx","dojo/dom-style","dojo/dom-class","dojo/_base/declare","dojo/_base/lang","dojo/_base/array","dijit/_base/manager","dojox/form/uploader/Base"],function(fx,_2ba5,_2ba6,_2ba7,lang,array,_2ba8,_2ba9){
return _2ba7("dojox.form.uploader.FileList",[_2ba9],{uploaderId:"",uploader:null,headerIndex:"#",headerType:"Type",headerFilename:"File Name",headerFilesize:"Size",_upCheckCnt:0,rowAmt:0,templateString:"<div class=\"dojoxUploaderFileList\">"+"<div dojoAttachPoint=\"progressNode\" class=\"dojoxUploaderFileListProgress\"><div dojoAttachPoint=\"percentBarNode\" class=\"dojoxUploaderFileListProgressBar\"></div><div dojoAttachPoint=\"percentTextNode\" class=\"dojoxUploaderFileListPercentText\">0%</div></div>"+"<table class=\"dojoxUploaderFileListTable\">"+"<thead><tr class=\"dojoxUploaderFileListHeader\"><th class=\"dojoxUploaderIndex\">${headerIndex}</th><th class=\"dojoxUploaderIcon\">${headerType}</th><th class=\"dojoxUploaderFileName\">${headerFilename}</th><th class=\"dojoxUploaderFileSize\" dojoAttachPoint=\"sizeHeader\">${headerFilesize}</th></tr></thead>"+"<tbody class=\"dojoxUploaderFileListContent\" dojoAttachPoint=\"listNode\">"+"</tbody>"+"</table>"+"<div>",postCreate:function(){
this.setUploader();
this.hideProgress();
},reset:function(){
for(var i=0;i<this.rowAmt;i++){
this.listNode.deleteRow(0);
}
this.rowAmt=0;
},setUploader:function(){
if(!this.uploaderId&&!this.uploader){
console.warn("uploaderId not passed to UploaderFileList");
}else{
if(this.uploaderId&&!this.uploader){
this.uploader=_2ba8.byId(this.uploaderId);
}else{
if(this._upCheckCnt>4){
console.warn("uploader not found for ID ",this.uploaderId);
return;
}
}
}
if(this.uploader){
this.connect(this.uploader,"onChange","_onUploaderChange");
this.connect(this.uploader,"reset","reset");
this.connect(this.uploader,"onBegin",function(){
this.showProgress(true);
});
this.connect(this.uploader,"onProgress","_progress");
this.connect(this.uploader,"onComplete",function(){
setTimeout(lang.hitch(this,function(){
this.hideProgress(true);
}),1250);
});
if(!(this._fileSizeAvail={"html5":1,"flash":1}[this.uploader.uploadType])){
this.sizeHeader.style.display="none";
}
}else{
this._upCheckCnt++;
setTimeout(lang.hitch(this,"setUploader"),250);
}
},hideProgress:function(_2baa){
var o=_2baa?{ani:true,endDisp:"none",beg:15,end:0}:{endDisp:"none",ani:false};
this._hideShowProgress(o);
},showProgress:function(_2bab){
var o=_2bab?{ani:true,endDisp:"block",beg:0,end:15}:{endDisp:"block",ani:false};
this._hideShowProgress(o);
},_progress:function(_2bac){
this.percentTextNode.innerHTML=_2bac.percent;
_2ba5.set(this.percentBarNode,"width",_2bac.percent);
},_hideShowProgress:function(o){
var node=this.progressNode;
var onEnd=function(){
_2ba5.set(node,"display",o.endDisp);
};
if(o.ani){
_2ba5.set(node,"display","block");
fx.animateProperty({node:node,properties:{height:{start:o.beg,end:o.end,units:"px"}},onEnd:onEnd}).play();
}else{
onEnd();
}
},_onUploaderChange:function(_2bad){
this.reset();
array.forEach(_2bad,function(f,i){
this._addRow(i+1,this.getFileType(f.name),f.name,f.size);
},this);
},_addRow:function(index,type,name,size){
var c,r=this.listNode.insertRow(-1);
c=r.insertCell(-1);
_2ba6.add(c,"dojoxUploaderIndex");
c.innerHTML=index;
c=r.insertCell(-1);
_2ba6.add(c,"dojoxUploaderIcon");
c.innerHTML=type;
c=r.insertCell(-1);
_2ba6.add(c,"dojoxUploaderFileName");
c.innerHTML=name;
if(this._fileSizeAvail){
c=r.insertCell(-1);
_2ba6.add(c,"dojoxUploaderSize");
c.innerHTML=this.convertBytes(size).value;
}
this.rowAmt++;
}});
});
},"davinci/ve/actions/DuplicateAction":function(){
define(["dojo/_base/declare","dojo/dom-style","davinci/ve/actions/ContextAction","davinci/commands/CompoundCommand","davinci/ve/commands/AddCommand","davinci/ve/commands/MoveCommand","davinci/ve/widget","davinci/ve/utils/GeomUtils"],function(_2bae,_2baf,_2bb0,_2bb1,_2bb2,_2bb3,_2bb4,_2bb5){
return _2bae("davinci.ve.actions.DuplicateAction",[_2bb0],{run:function(_2bb6){
_2bb6=this.fixupContext(_2bb6);
if(_2bb6){
if(_2bb6.declaredClass!=="davinci.ve.Context"){
return;
}
var _2bb7=this._normalizeSelection(_2bb6);
if(!this.selectionSameParent(_2bb7)){
return;
}
var _2bb8=[];
if(_2bb7.length>0){
var _2bb9=new _2bb1();
dojo.forEach(_2bb7,function(w){
var _2bba;
var d=w.getData({identify:false});
if(d){
d.context=_2bb6;
dojo.withDoc(_2bb6.getDocument(),function(){
_2bba=_2bb4.createWidget(d);
},this);
if(_2bba){
_2bb9.add(new _2bb2(_2bba,w.getParent(),undefined));
_2bb8.push(_2bba);
var _2bbb=(w&&w.domNode)?_2baf.get(w.domNode,"position"):null;
var _2bbc=(_2bbb=="absolute");
if(_2bbc){
var box=_2bb5.getMarginBoxPageCoords(w.domNode);
box.l+=25;
_2bb9.add(new _2bb3(_2bba,box.l,box.t,undefined,undefined,undefined,true));
}
}
}
});
_2bb6.getCommandStack().execute(_2bb9);
dojo.forEach(_2bb8,function(w,i){
_2bb6.select(w,i>0);
},this);
}
}
},isEnabled:function(_2bbd){
_2bbd=this.fixupContext(_2bbd);
var _2bbe=(_2bbd&&_2bbd.getSelection)?_2bbd.getSelection():[];
if(_2bbe.length===0){
return false;
}
if(!this.selectionSameParent(_2bbe)){
return false;
}
return true;
},shouldShow:function(_2bbf){
_2bbf=this.fixupContext(_2bbf);
var _2bc0=_2bbf?_2bbf.editor:null;
return (_2bc0&&_2bc0.declaredClass=="davinci.ve.PageEditor");
},selectionSameParent:function(_2bc1){
if(_2bc1.length===0){
return false;
}
var _2bc2=_2bc1[0].getParent();
for(var i=0;i<_2bc1.length;i++){
var _2bc3=_2bc1[i];
if(_2bc3.getParent()!=_2bc2){
return false;
}
}
return true;
}});
});
},"davinci/html/HTMLComment":function(){
define("davinci/html/HTMLComment",["dojo/_base/declare","davinci/html/HTMLItem"],function(_2bc4,_2bc5){
return _2bc4("davinci.html.HTMLComment",_2bc5,{constructor:function(value){
this.elementType="HTMLComment";
this.value=value||"";
},getText:function(_2bc6){
var dash=this.isProcessingInstruction?"":"--";
return "<!"+dash+this.value+dash+">";
}});
});
},"davinci/ui/Editor":function(){
define(["../commands/CommandStack","dojox/timing/doLater","dojo/_base/declare","../actions/Action","./TextStyler","orion/editor/editor","orion/editor/editorFeatures","orion/editor/htmlGrammar","orion/editor/textMateStyler","orion/textview/textView","orion/textview/textModel","orion/editor/contentAssist","orion/editor/jsContentAssist","orion/editor/cssContentAssist","../UserActivityMonitor"],function(_2bc7,_2bc8,_2bc9,_2bca,_2bcb,_2bcc,_2bcd,_2bce,_2bcf,_2bd0,_2bd1,_2bd2,_2bd3,_2bd4,_2bd5){
_2bc9("davinci.ui._EditorCutAction",_2bca,{constructor:function(_2bd6){
this._editor=_2bd6;
},run:function(_2bd7){
this._editor.getTextView()._doCut();
},isEnabled:function(_2bd8){
return !this._editor.getTextView()._getSelection().isEmpty();
}});
_2bc9("davinci.ui._EditorCopyAction",_2bca,{constructor:function(_2bd9){
this._editor=_2bd9;
},run:function(_2bda){
this._editor.getTextView()._doCopy();
},isEnabled:function(_2bdb){
return !this._editor.getTextView()._getSelection().isEmpty();
}});
_2bc9("davinci.ui._EditorPasteAction",_2bca,{constructor:function(_2bdc){
this._editor=_2bdc;
},run:function(_2bdd){
this._editor.getTextView()._doPaste();
}});
var _2bde=function(_2bdf){
if(this._dontNotifyChange){
this._dontNotifyChange=false;
return;
}
this.lastChangeStamp=Date.now();
if(this.handleChange&&!("waiter" in this)){
try{
this.waiter=true;
(function(that){
if(_2bc8(Date.now()-that.lastChangeStamp>1000,that)){
return;
}
delete that.waiter;
that.isTyping=true;
that.handleChange(that._textModel.getText());
delete that.isTyping;
})(this);
}
catch(e){
console.error(e);
}
}
};
var _2be0=function(_2be1){
if(this._progSelect){
return;
}
this.selectionChange({startOffset:_2be1.newValue.start,endOffset:_2be1.newValue.end});
};
return _2bc9(null,{constructor:function(_2be2,_2be3,_2be4){
this.contentDiv=_2be2;
this.commandStack=new _2bc7();
this._existWhenVisible=_2be4;
this._isVisible=!_2be4;
},setContent:function(_2be5,_2be6){
if(!this.editor&&(!this._existWhenVisible||this._isVisible)){
this._createEditor();
}
if(!this._textModel){
this._textModel=this.editor?this.editor.getModel():new _2bd1.TextModel();
}
this.fileName=_2be5;
this.setValue(_2be6,true);
this._updateStyler();
if(this._textModel){
dojo.disconnect(this._textModelConnection);
this._textModelConnection=dojo.connect(this._textModel,"onChanged",this,_2bde);
}
},setVisible:function(_2be7){
if(_2be7!=this._isVisible&&this._existWhenVisible){
if(_2be7&&this._existWhenVisible){
this._dontNotifyChange=true;
this._createEditor();
this._updateStyler();
}else{
this.editor.getTextView().removeEventListener("Selection",dojo.hitch(this,_2be0));
delete this.editor;
}
}
this._isVisible=_2be7;
},setValue:function(_2be8,_2be9){
this._dontNotifyChange=_2be9;
if(this.editor){
this.editor.setText(_2be8);
}else{
this._textModel.setText(_2be8);
}
},_createEditor:function(){
var _2bea;
var _2beb={createContentAssistMode:function(_2bec){
_2bea=new _2bd2.ContentAssist(_2bec.getTextView());
var _2bed=new _2bd2.ContentAssistWidget(_2bea,"contentassist");
return new _2bd2.ContentAssistMode(_2bea,_2bed);
}};
var _2bee=new _2bd4.CssContentAssistProvider();
var _2bef=new _2bd3.JavaScriptContentAssistProvider();
var _2bf0=this.contentDiv,model=this._textModel,_2bf1={statusReporter:function(_2bf2,_2bf3){
if(_2bf3){
console.error("orion.editor: "+_2bf2);
}
},textViewFactory:function(){
return new _2bd0.TextView({parent:_2bf0,model:model,tabSize:4});
},undoStackFactory:new _2bcd.UndoFactory(),annotationFactory:new _2bcd.AnnotationFactory(),lineNumberRulerFactory:new _2bcd.LineNumberRulerFactory(),contentAssistFactory:_2beb,domNode:_2bf0};
this.editor=new _2bcc.Editor(_2bf1);
this.editor.installTextView();
if(/\.css$/.test(this.fileName)){
_2bea.setProviders([_2bee]);
}else{
if(/\.js$/.test(this.fileName)){
_2bea.setProviders([_2bef]);
}
}
this._activityConnections=_2bd5.addInActivityMonitor(this.contentDiv.ownerDocument);
this.editor.getTextView().focus();
dojo.style(this.contentDiv,"overflow","hidden");
if(this.selectionChange){
this.editor.getTextView().addEventListener("Selection",dojo.hitch(this,_2be0));
}
this.cutAction=new davinci.ui._EditorCutAction(this.editor);
this.copyAction=new davinci.ui._EditorCopyAction(this.editor);
this.pasteAction=new davinci.ui._EditorPasteAction(this.editor);
},_updateStyler:function(){
if(!this.editor){
return;
}
var lang=this.fileName.substr(this.fileName.lastIndexOf(".")+1),view=this.editor.getTextView();
if(this._styler){
this._styler.destroy();
delete this._styler;
}
if(lang=="json"){
lang="js";
}
switch(lang){
case "js":
case "java":
case "css":
this._styler=new _2bcb.TextStyler(view,lang,this.editor._annotationModel);
break;
case "html":
this._styler=new _2bcf.TextMateStyler(view,new _2bce.HtmlGrammar());
}
view.setText(this.getText());
},selectionChange:function(_2bf4){
},destroy:function(){
dojo.forEach(this._activityConnections,dojo.disconnect);
},select:function(_2bf5){
if(this.editor){
try{
this._progSelect=true;
this.editor.setSelection(_2bf5.endOffset,_2bf5.startOffset);
}
finally{
delete this._progSelect;
}
}
},getText:function(){
return this._textModel.getText(0);
},getOnUnloadWarningMessage:function(){
return null;
}});
});
},"orion/editor/regex":function(){
define("orion/editor/regex",[],function(){
function _2bf6(str){
return str.replace(/([\\$\^*\/+?\.\(\)|{}\[\]])/g,"\\$&");
};
function parse(str){
var _2bf7=/^\s*\/(.+)\/([gim]{0,3})\s*$/.exec(str);
if(_2bf7){
return {pattern:_2bf7[1],flags:_2bf7[2]};
}
return null;
};
return {escape:_2bf6,parse:parse};
});
},"dojox/grid/_EditManager":function(){
define("dojox/grid/_EditManager",["dojo/_base/lang","dojo/_base/array","dojo/_base/declare","dojo/_base/connect","dojo/_base/sniff","./util"],function(lang,array,_2bf8,_2bf9,has,util){
return _2bf8("dojox.grid._EditManager",null,{constructor:function(_2bfa){
this.grid=_2bfa;
if(has("ie")){
this.connections=[_2bf9.connect(document.body,"onfocus",lang.hitch(this,"_boomerangFocus"))];
}else{
this.connections=[_2bf9.connect(this.grid,"onBlur",this,"apply")];
}
},info:{},destroy:function(){
array.forEach(this.connections,_2bf9.disconnect);
},cellFocus:function(_2bfb,_2bfc){
if(this.grid.singleClickEdit||this.isEditRow(_2bfc)){
this.setEditCell(_2bfb,_2bfc);
}else{
this.apply();
}
if(this.isEditing()||(_2bfb&&_2bfb.editable&&_2bfb.alwaysEditing)){
this._focusEditor(_2bfb,_2bfc);
}
},rowClick:function(e){
if(this.isEditing()&&!this.isEditRow(e.rowIndex)){
this.apply();
}
},styleRow:function(inRow){
if(inRow.index==this.info.rowIndex){
inRow.customClasses+=" dojoxGridRowEditing";
}
},dispatchEvent:function(e){
var c=e.cell,ed=(c&&c["editable"])?c:0;
return ed&&ed.dispatchEvent(e.dispatch,e);
},isEditing:function(){
return this.info.rowIndex!==undefined;
},isEditCell:function(_2bfd,_2bfe){
return (this.info.rowIndex===_2bfd)&&(this.info.cell.index==_2bfe);
},isEditRow:function(_2bff){
return this.info.rowIndex===_2bff;
},setEditCell:function(_2c00,_2c01){
if(!this.isEditCell(_2c01,_2c00.index)&&this.grid.canEdit&&this.grid.canEdit(_2c00,_2c01)){
this.start(_2c00,_2c01,this.isEditRow(_2c01)||_2c00.editable);
}
},_focusEditor:function(_2c02,_2c03){
util.fire(_2c02,"focus",[_2c03]);
},focusEditor:function(){
if(this.isEditing()){
this._focusEditor(this.info.cell,this.info.rowIndex);
}
},_boomerangWindow:500,_shouldCatchBoomerang:function(){
return this._catchBoomerang>new Date().getTime();
},_boomerangFocus:function(){
if(this._shouldCatchBoomerang()){
this.grid.focus.focusGrid();
this.focusEditor();
this._catchBoomerang=0;
}
},_doCatchBoomerang:function(){
if(has("ie")){
this._catchBoomerang=new Date().getTime()+this._boomerangWindow;
}
},start:function(_2c04,_2c05,_2c06){
if(!this._isValidInput()){
return;
}
this.grid.beginUpdate();
this.editorApply();
if(this.isEditing()&&!this.isEditRow(_2c05)){
this.applyRowEdit();
this.grid.updateRow(_2c05);
}
if(_2c06){
this.info={cell:_2c04,rowIndex:_2c05};
this.grid.doStartEdit(_2c04,_2c05);
this.grid.updateRow(_2c05);
}else{
this.info={};
}
this.grid.endUpdate();
this.grid.focus.focusGrid();
this._focusEditor(_2c04,_2c05);
this._doCatchBoomerang();
},_editorDo:function(_2c07){
var c=this.info.cell;
if(c&&c.editable){
c[_2c07](this.info.rowIndex);
}
},editorApply:function(){
this._editorDo("apply");
},editorCancel:function(){
this._editorDo("cancel");
},applyCellEdit:function(_2c08,_2c09,_2c0a){
if(this.grid.canEdit(_2c09,_2c0a)){
this.grid.doApplyCellEdit(_2c08,_2c0a,_2c09.field);
}
},applyRowEdit:function(){
this.grid.doApplyEdit(this.info.rowIndex,this.info.cell.field);
},apply:function(){
if(this.isEditing()&&this._isValidInput()){
this.grid.beginUpdate();
this.editorApply();
this.applyRowEdit();
this.info={};
this.grid.endUpdate();
this.grid.focus.focusGrid();
this._doCatchBoomerang();
}
},cancel:function(){
if(this.isEditing()){
this.grid.beginUpdate();
this.editorCancel();
this.info={};
this.grid.endUpdate();
this.grid.focus.focusGrid();
this._doCatchBoomerang();
}
},save:function(_2c0b,_2c0c){
var c=this.info.cell;
if(this.isEditRow(_2c0b)&&(!_2c0c||c.view==_2c0c)&&c.editable){
c.save(c,this.info.rowIndex);
}
},restore:function(_2c0d,_2c0e){
var c=this.info.cell;
if(this.isEditRow(_2c0e)&&c.view==_2c0d&&c.editable){
c.restore(this.info.rowIndex);
}
},_isValidInput:function(){
var w=(this.info.cell||{}).widget;
if(!w||!w.isValid){
return true;
}
w.focused=true;
return w.isValid(true);
}});
});
},"davinci/workbench/ProblemsView":function(){
define(["dojo/_base/declare","davinci/Workbench","davinci/workbench/ViewPart","dojox/grid/DataGrid","dojo/data/ItemFileWriteStore"],function(_2c0f,_2c10,_2c11,_2c12,_2c13){
return _2c0f("davinci.workbench.ProblemsView",_2c11,{postCreate:function(){
this.inherited(arguments);
this.subscribe("/davinci/resource/resourceChanged",this.resourceChanged);
var _2c14={items:this._getProblems()};
this.dataStore=new _2c13({data:_2c14,jsId:"problemsDataStore"});
var grid=new _2c12({id:"problemsViewGrid",store:this.dataStore,structure:[{field:"text",name:"Description",width:"300px"},{field:"fileName",name:"File Name"},{field:"path",name:"Path"},{field:"line",name:"Line",width:"50px"},{field:"type",name:"Type",width:"150px"}]});
dojo.connect(grid,"onRowDblClick",dojo.hitch(this,function(e){
var item=e.grid.getItem(e.rowIndex),line=this.dataStore.getValue(item,"line"),_2c15=this.dataStore.getValue(item,"resource");
_2c10.openEditor({fileName:_2c15,startLine:line});
}));
this.setContent(grid);
grid.startup();
},destroy:function(){
this.inherited(arguments);
this.unsubscribe("/davinci/resource/resourceChanged");
delete this.dataStore;
},_getProblems:function(){
this._currentProblems=[];
var _2c16=system.resource.root.getMarkers(["problem","warning"],true);
dojo.forEach(_2c16,function(_2c17){
this._currentProblems.push(this._createProblem(_2c17));
},this);
return this._currentProblems;
},_createProblem:function(_2c18){
return {text:_2c18.text,fileName:_2c18.resource.getName(),path:_2c18.resource.parent.getPath(),resource:_2c18.resource,line:_2c18.line,type:_2c18.type};
},resourceChanged:function(type,_2c19){
var items,_2c1a=_2c19;
this.dataStore.fetch({query:{resource:_2c1a},onComplete:dojo.hitch(this,function(_2c1b){
dojo.forEach(_2c1b,function(item){
this.dataStore.deleteItem(item);
},this);
})});
var _2c1c=_2c1a.getMarkers(["error","warning"]);
dojo.forEach(_2c1c,function(_2c1d){
var _2c1e=this._createProblem(_2c1d);
this.dataStore.newItem(_2c1e,null);
},this);
}});
});
},"davinci/ui/DownloadSelected":function(){
define(["dojo/_base/declare","./Download","./Resource","dojo/i18n!./nls/ui"],function(_2c1f,_2c20,_2c21,uiNLS){
return _2c1f([_2c20],{buildRendering:function(){
this.inherited(arguments);
this._files=_2c21.getSelectedResources();
var _2c22=["<div class='downloadSelectedHeader'>"+uiNLS.selectedFiles+"</div>","<div class='downloadSelectedList'>"];
if(!this._files){
_2c22.push("<b>"+uiNLS.noFilesSelected+"</b>");
this._files=[];
dojo.attr(this._okButton,"disabled","true");
}
for(var i=0;i<this._files.length;i++){
_2c22.push(this._files[i].getPath()+"<br>");
}
_2c22.push("</div><br><br>");
var html=_2c22.join("");
dojo.place(html,this._selectionDiv);
},_getResources:function(){
return {userFiles:this._files.map(function(item){
return item.getPath();
}),userLibs:this._getLibs()};
}});
});
},"dijit/DropDownMenu":function(){
require({cache:{"url:dijit/templates/Menu.html":"<table class=\"dijit dijitMenu dijitMenuPassive dijitReset dijitMenuTable\" role=\"menu\" tabIndex=\"${tabIndex}\"\n\t   data-dojo-attach-event=\"onkeypress:_onKeyPress\" cellspacing=\"0\">\n\t<tbody class=\"dijitReset\" data-dojo-attach-point=\"containerNode\"></tbody>\n</table>\n"}});
define("dijit/DropDownMenu",["dojo/_base/declare","dojo/_base/event","dojo/keys","dojo/text!./templates/Menu.html","./_OnDijitClickMixin","./_MenuBase"],function(_2c23,event,keys,_2c24,_2c25,_2c26){
return _2c23("dijit.DropDownMenu",[_2c26,_2c25],{templateString:_2c24,baseClass:"dijitMenu",postCreate:function(){
this.inherited(arguments);
var l=this.isLeftToRight();
this._openSubMenuKey=l?keys.RIGHT_ARROW:keys.LEFT_ARROW;
this._closeSubMenuKey=l?keys.LEFT_ARROW:keys.RIGHT_ARROW;
this.connectKeyNavHandlers([keys.UP_ARROW],[keys.DOWN_ARROW]);
},_onKeyPress:function(evt){
if(evt.ctrlKey||evt.altKey){
return;
}
switch(evt.charOrCode){
case this._openSubMenuKey:
this._moveToPopup(evt);
event.stop(evt);
break;
case this._closeSubMenuKey:
if(this.parentMenu){
if(this.parentMenu._isMenuBar){
this.parentMenu.focusPrev();
}else{
this.onCancel(false);
}
}else{
event.stop(evt);
}
break;
}
}});
});
},"davinci/review/view/CommentExplorerView":function(){
define(["dojo/_base/declare","davinci/Runtime","davinci/review/model/ReviewTreeModel","davinci/Workbench","davinci/workbench/ViewPart","dijit/Tree","dojo/date/stamp","dojo/date/locale","davinci/review/actions/CloseVersionAction","davinci/review/actions/EditVersionAction","davinci/review/actions/OpenVersionAction","dijit/Toolbar","dijit/ToolbarSeparator","dijit/form/Button","dijit/form/TextBox","dojo/i18n!./nls/view","dojo/i18n!../widgets/nls/widgets","davinci/ui/widgets/TransformTreeMixin"],function(_2c27,_2c28,_2c29,_2c2a,_2c2b,Tree,stamp,_2c2c,_2c2d,_2c2e,_2c2f,_2c30,_2c31,_2c32,_2c33,_2c34,_2c35){
var _2c36=function(item,_2c37){
if(item.elementType=="ReviewVersion"){
if(item.isDraft){
return "draft-open";
}
if(item.closed){
return _2c37?"reviewFolder-open-disabled":"reviewFolder-closed-disabled";
}
if(!item.closed){
return _2c37?"reviewFolder-open":"reviewFolder-closed";
}
}
if(item.elementType=="ReviewFile"){
if(item.parent.closed){
return "disabledReviewFileIcon";
}
var icon;
var _2c38=item.getExtension();
var _2c39=_2c28.getExtension("davinci.fileType",function(_2c3a){
return _2c3a.extension==_2c38;
});
if(_2c39){
icon=_2c39.iconClass;
}
return icon||"dijitLeaf";
}
return "dijitLeaf";
};
getLabelClass=function(item,_2c3b){
var _2c3c="dijitTreeLabel";
if(item.elementType=="ReviewVersion"){
if(item.designerId==_2c28.userName){
_2c3c="reviewOwnedByUserLabel";
}else{
_2c3c="reviewOwnedByOtherLabel";
}
}
return _2c3c;
};
var _2c3d=function(){
return [function(items){
return items.sort(function(file1,file2){
return file1.timeStamp>file2.timeStamp?-1:file1.timeStamp<file2.timeStamp?1:0;
});
}];
};
var _2c3e=_2c27(_2c2b,{postCreate:function(){
this.inherited(arguments);
var model=new _2c29();
this.model=model;
var _2c3f=_2c3d();
_2c3f.push(function(items){
return items.filter(this.commentingFilter.filterItem,this);
}.bind(this));
this.tree=new Tree({id:"reviewCommentExplorerViewTree",persist:false,showRoot:false,model:model,labelAttr:"name",childrenAttrs:"children",getIconClass:dojo.hitch(this,this._getIconClass),getLabelClass:dojo.hitch(this,this._getLabelClass),transforms:_2c3f,isMultiSelect:true});
this.setContent(this.tree);
this.attachToolbar();
this.tree.startup();
dojo.connect(this.tree,"onDblClick",dojo.hitch(this,this._dblClick));
dojo.connect(this.tree,"onClick",dojo.hitch(this,this._click));
dojo.connect(this.tree,"_onNodeMouseEnter",dojo.hitch(this,this._over));
dojo.connect(this.tree,"_onNodeMouseLeave",dojo.hitch(this,this._leave));
dojo.connect(this.tree,"_setSelectedNodesAttr",function(){
this._publishSelectionChanges();
}.bind(this));
this.subscribe("/davinci/review/selectionChanged","_updateActionBar");
this.subscribe("/davinci/review/resourceChanged",function(_2c40,type,_2c41){
if(_2c41&&_2c41.timeStamp){
davinci.review.model.resource.root.findVersion(_2c41.timeStamp).then(function(node){
if(node){
this.tree.set("selectedItem",node);
}else{
this.tree.set("selectedItems",[]);
}
this._publishSelectionChanges();
this.tree.rootNode.expand();
}.bind(this));
}
});
var popup=_2c2a.createPopup({partID:"davinci.review.reviewNavigator",context:this,domNode:this.tree.domNode,openCallback:function(event){
var w=dijit.getEnclosingWidget(event.target);
if(!w||!w.item){
return;
}
this.tree.set("path",this._buildTreePath(w.item));
}.bind(this)});
var o=_2c2a.getActionSets("davinci.review.reviewNavigator");
var _2c42=o.clonedActionSets;
if(_2c42&&_2c42.length==1){
dojo.forEach(_2c42[0].actions,dojo.hitch(this,function(_2c43){
if(_2c43.keyBinding){
if(!this.keyBindings){
this.keyBindings=[];
}
this.keyBindings.push({keyBinding:_2c43.keyBinding,action:_2c43});
}
}));
}
dojo.connect(this.tree.domNode,"onkeypress",this,"_onKeyPress");
this.infoCardContent=dojo.cache("davinci","review/widgets/templates/InfoCard.html","<div class=\"detail_title\">${detail_title}</div>\r\n<div>\r\n\t<div class=\"detail_div\"><span>${your_role}:</span><span class=\"detail_role\">${detail_role}</span><span>${due_by}:</span><span class=\"${detail_dueDate_class}\">${detail_dueDate}</span></div>\r\n\t<div class=\"detail_div\"><span>${created_by}:</span><span class=\"detail_creator\">${detail_creator}</div>\r\n\t<div class=\"detail_div\"><span>${creation_date}:</span><span class=\"detail_creationDate\">${detail_creationDate}</div>\r\n</div>\r\n<div class=\"detail_div\"><strong>${artifacts_in_rev}</strong></div>\r\n${detail_files}\r\n<div class=\"detail_div\"><strong>${reviewers}</strong></div>\r\n${detail_reviewers}");
if(!dijit._masterTT){
dijit._masterTT=new dijit._MasterTooltip();
}
this.connect(dijit._masterTT.domNode,"mouseover",function(){
if(this._delTimer){
clearTimeout(this._delTimer);
this._delTimer=null;
}
});
this.connect(dijit._masterTT.domNode,"mouseleave",function(){
this._lastAnchorNode&&this._leave();
});
dojo.subscribe("/davinci/ui/editorSelected",function(obj){
var _2c44=obj.editor;
if(_2c44&&_2c44.editorID==="davinci.review.CommentReviewEditor"){
var _2c45=_2c44.resourceFile;
var _2c46=_2c45.parent;
dojo.forEach(this.model.root.children,function(_2c47){
if(_2c47!=_2c46){
var _2c48=this.tree.getNodesByItem(_2c47);
if(_2c48.length>0){
var _2c49=_2c48[0];
if(_2c49.isExpanded){
this.tree._collapseNode(_2c49);
}
}
}
}.bind(this));
this.tree.set("path",this._buildTreePath(_2c45));
}
}.bind(this));
},_buildTreePath:function(item){
var path=[];
for(var _2c4a=item;_2c4a;_2c4a=_2c4a.parent){
path.unshift(_2c4a);
}
return path;
},_updateActionBar:function(item,_2c4b){
if(_2c4b!=this||!item||!item.length){
this.closeBtn.set("disabled",true);
this.editBtn.set("disabled",true);
return;
}
var _2c4c=item[0].resource.elementType=="ReviewFile"?item[0].resource.parent:item[0].resource;
_2c28.reviewers=_2c4c.reviewers||[];
var _2c4d=_2c4c.designerId==_2c28.userName;
var _2c4e=_2c4c.elementType=="ReviewVersion";
var _2c4f=_2c4c.isDraft;
this.closeBtn.set("disabled",!_2c4d||!_2c4e||_2c4c.closed||_2c4f);
this.openBtn.set("disabled",!_2c4d||!_2c4e||!_2c4c.closedManual||_2c4f);
this.editBtn.set("disabled",!_2c4d||!_2c4e);
},getTopAdditions:function(){
var _2c50=new _2c30({},dojo.create("div"));
var _2c51=new _2c32({id:_2c50.get("id")+".Close",showLabel:false,label:_2c34.closeVersion,disabled:true,iconClass:"viewActionIcon closeVersionIcon",onClick:dojo.hitch(this,"_closeVersion")});
this.closeBtn=_2c51;
var _2c52=new _2c32({id:_2c50.get("id")+".Open",showLabel:false,label:_2c34.openVersion,disabled:true,iconClass:"viewActionIcon openVersionIcon",onClick:dojo.hitch(this,"_openVersion")});
this.openBtn=_2c52;
var _2c53=new _2c32({id:_2c50.get("id")+".Edit",showLabel:false,label:_2c34.editVersion,disabled:true,iconClass:"viewActionIcon editVersionIcon",onClick:dojo.hitch(this,"_editVersion")});
this.editBtn=_2c53;
var input=new _2c33({id:"reviewExplorerFilter",placeHolder:_2c34.filter,onKeyUp:dojo.hitch(this,this._filter)});
_2c50.addChild(_2c51);
_2c50.addChild(_2c52);
_2c50.addChild(new dijit.ToolbarSeparator());
_2c50.addChild(_2c53);
dojo.place(dojo.create("br"),_2c50.domNode);
_2c50.addChild(input);
dojo.addClass(_2c50.domNode,"davinciCommentExplorer");
return _2c50.domNode;
},_closeVersion:function(){
(new _2c2d()).run(this);
},_openVersion:function(){
(new _2c2f()).run(this);
},_editVersion:function(){
(new _2c2e()).run(this);
},_filter:function(e){
var text=dijit.byId("reviewExplorerFilter").get("value");
this.commentingFilter.filterString=text;
dojo.forEach(this.model.root.children,dojo.hitch(this,function(item){
item.getChildren(function(_2c54){
this.model.onChildrenChange(item,_2c54);
}.bind(this));
}));
},commentingFilter:{filterString:"",filterItem:function(item){
var _2c55=this.commentingFilter.filterString;
if(!_2c55){
return true;
}else{
if(item.elementType=="ReviewFile"){
return item.name.toLowerCase().indexOf(_2c55.toLowerCase())>=0;
}
return true;
}
}},destroy:function(){
this.inherited(arguments);
},_dblClick:function(node){
if(node.isDraft||node.parent.isDraft){
if(node.designerId==_2c28.userName||node.parent.designerId==_2c28.userName){
this._openPublishWizard(node.isDraft?node:node.parent);
}
return;
}
if(node.elementType=="ReviewFile"){
_2c2a.openEditor({fileName:node,content:node.getText()});
}
},_location:function(){
var _2c56=document.location.href;
var split=_2c56.split("?");
var _2c57=split[0].match(/http:\/\/.+:\d+\//);
return _2c57;
},_click:function(node){
this._publishSelectionChanges();
},_publishSelectionChanges:function(){
var items=this.getSelection();
this.publish("/davinci/review/selectionChanged",[items,this]);
},getSelection:function(){
var items=dojo.map(this.tree.get("selectedItems"),function(item){
return {resource:item};
});
return items;
},_over:function(node){
if(node.item.elementType!="ReviewVersion"){
return;
}
if(!this._showTimer){
var item=node.item,_2c58={},c;
_2c58.detail_title=item.name;
_2c58.your_role=_2c35.yourRole;
_2c58.due_by=_2c35.dueBy;
_2c58.created_by=_2c35.createdBy;
_2c58.creation_date=_2c35.creationDate;
_2c58.artifacts_in_rev=_2c35.artifactsInRev;
_2c58.reviewers=_2c35.reviewers;
_2c58.detail_role=(item.designerId==davinci.Runtime.userName)?_2c34.designer:_2c34.reviewer;
_2c58.detail_dueDate=item.dueDate=="infinite"?_2c34.infinite:_2c2c.format(item.dueDate,{selector:"date",formatLength:"long"});
var _2c59=_2c28.getUserDisplayNamePlusEmail({email:item.designerEmail,userFirstName:item.designerFirstName,userId:item.designerId,userLastName:item.designerLastName});
_2c58.detail_creator=_2c59;
var _2c5a=stamp.fromISOString(item.timeStamp);
_2c58.detail_creationDate=_2c2c.format(_2c5a,{formatLength:"medium"});
_2c58.detail_files="";
item.getChildren(function(_2c5b){
dojo.forEach(_2c5b,function(i){
var label=i.getLabel();
_2c58.detail_files+="<div><span>"+label.substr(0,label.length-4)+"</span><span class='dijitTreeIcon reviewFileIcon detail_file'></span></div>";
});
_2c58.detail_reviewers="";
dojo.forEach(item.reviewers,function(i){
if(i.email!=item.designerEmail){
_2c58.detail_reviewers+="<div>"+i.email+"</div>";
}
});
item.closed?_2c58.detail_dueDate_class="closed":_2c58.detail_dueDate_class="notClosed";
this._showTimer=setTimeout(dojo.hitch(this,function(){
if(this._delTimer){
clearTimeout(this._delTimer);
delete this._delTimer;
}
dijit.showTooltip(dojo.string.substitute(this.infoCardContent,_2c58),node.rowNode);
this._lastAnchorNode=node;
delete this._showTimer;
}),1000);
}.bind(this));
}
},_leave:function(node){
if(this._showTimer){
clearTimeout(this._showTimer);
delete this._showTimer;
}
if(this._lastAnchorNode){
this._delTimer=setTimeout(dojo.hitch(this,function(){
dijit.hideTooltip(this._lastAnchorNode.rowNode);
delete this._delTimer;
}),1000);
}
},_openPublishWizard:function(node){
var _2c5c=new davinci.review.actions.PublishAction(node);
_2c5c.run();
},_getIconClass:function(item,_2c5d){
return _2c36(item,_2c5d);
},_getLabelClass:function(item,_2c5e){
return getLabelClass(item,_2c5e);
},_onKeyPress:function(e){
var _2c5f=dojo.some(this.keyBindings,dojo.hitch(this,function(_2c60){
if(_2c28.isKeyEqualToEvent(_2c60.keyBinding,e)){
davinci.Workbench._runAction(_2c60.action,this,_2c60.action.id);
return true;
}
}));
if(_2c5f){
dojo.stopEvent(e);
}
return _2c5f;
}});
_2c3e.getIconClass=_2c36;
_2c3e.getLabelClass=getLabelClass;
_2c3e.getSortTransforms=_2c3d;
return _2c3e;
});
},"davinci/ve/widgets/HTMLStringUtil":function(){
define(["davinci/Runtime","./FontDataStore","./FontComboBox","./MultiInputDropDown","dijit/form/ComboBox","./MetaDataStore","./ColorPicker","./Background"],function(_2c61,_2c62){
var _2c63=dojo.getObject("davinci.ve.widgets.HTMLStringUtil",true);
dojo.mixin(_2c63,{__id:0,idPrefix:"davinci_ve_widgets_properties_generated",_currentPropSection:null,animSS:null,animRuleIndex:{},getCurrentPropSection:function(){
return this._currentPropSection;
},getId:function(){
return this.idPrefix+(this.__id++);
},injectId:function(_2c64,id){
var _2c65=_2c64.indexOf(">");
if(!_2c65){
return "<span id='"+id+"'>"+_2c64+"</span";
}
return _2c64.substring(0,_2c65)+" id='"+id+"'"+_2c64.substring(_2c65,_2c64.length);
},getEditor:function(_2c66){
function _2c67(value){
var obj={};
obj.value=(typeof (value.value)!="undefined"&&value.value!==null)?value.value:value;
obj.title=value.title||obj.value;
return obj;
};
var _2c68=_2c66.type;
var id=this.getId();
var _2c69="";
_2c66.id=id;
var _2c6a=_2c66.disabled?" disabled='true' ":"";
switch(_2c68){
case "multi":
var _2c6b="";
if(_2c66.values){
_2c6b="data='"+dojo.toJson(dojo.map(_2c66.values,function(v){
return {value:v};
}))+"'";
}
var text="<div dojoType='davinci.ve.widgets.MultiInputDropDown' "+_2c6b+"  class='propertyPaneEditablevalue' style='display:inline-block; width:100%;' id='"+id+"'"+_2c6a+"></div>";
return text;
case "boolean":
var text="<input type='checkbox' class='propertyPaneEditablevalue' style='display:inline-block;margin-left:5px' id='"+id+"'></input>";
return text;
case "comboEdit":
var _2c6c=_2c66.values;
var text="<select dojoType='dijit.form.ComboBox' autoComplete='false' style='display:inline-block; width:100%;' id='"+id+"'"+_2c6a+">";
for(var i=0;i<_2c6c.length;i++){
var obj=_2c67(_2c6c[i]);
text+="<option value='"+obj.value+"'>"+obj.title+"</option>";
}
text+="</select>";
return text;
case "combo":
var _2c6c=_2c66.values;
var text="<select style='display:inline-block; width:100%;' id='"+id+"'"+_2c6a+">";
for(var i=0;i<_2c6c.length;i++){
var obj=_2c67(_2c6c[i]);
text+="<option value='"+obj.value+"'>"+obj.title+"</option>";
}
text+="</select>";
return text;
case "font":
var text="<div dojoType='davinci.ve.widgets.FontDataStore' jsId='"+id+("_fontStore")+"'>";
text+="<div dojoType='davinci.ve.widgets.FontComboBox' value='"+_2c62.fonts[0].value+"' store='"+id+("_fontStore")+"'  id='"+id+"' class='propertyPaneEditablevalue' style='display:inline-block; width:100%;'></div>";
return text;
case "state":
var text="<div dojoType='davinci.ve.widgets.MetaDataStore' jsId='davinci.properties.event"+(id)+("_Store")+"'>";
text+="<div dojoType='dijit.form.ComboBox' id='"+id+"'store='davinci.properties.event"+(id)+("_Store")+"' class='propertyPaneEditablevalue' style='display:inline-block; width:100%;' autoComplete='false'></div>";
return text;
case "color":
var text="<div class='propertyPaneEditablevalue' dojoType='davinci.ve.widgets.ColorPicker' id='"+id+"' ></div>";
return text;
case "background":
var _2c6b=dojo.isArray(_2c66.values)?" data='"+dojo.toJson(_2c66.values)+"'":"";
var _2c6d=dojo.isArray(_2c66.target)?_2c66.target[0]:_2c66.target;
var _2c6e=" propname='"+_2c6d+"'";
var _2c6f=_2c66.colorswatch?" colorswatch='true'":"";
var text="<div dojoType='davinci.ve.widgets.Background' id='"+id+"'"+_2c6b+_2c6e+_2c6f+"></div>";
return text;
case "border":
case "number":
case "object":
case "text":
case "array":
case "string":
default:
var text="<input type='text' class='propertyPaneEditablevalue' style='display:inline-block; width:100%;' id='"+id+"'></input>";
return text;
}
},loadTemplate:function(_2c70,_2c71){
var url=_2c70;
if(_2c71){
url=(_2c71.split(".")).join("/")+"/"+_2c70;
}
var text=_2c61.serverJSONRequest({url:url,handleAs:"text",sync:true});
return text;
},generateMainSection:function(_2c72){
_2c72.id=this.getId();
var title=_2c72.title;
var _2c73="";
_2c73+="<div class='property_toc_item hideInThemeEditor' id='"+_2c72.id+"'>";
_2c73+="<table cellspacing='0' cellpadding='0' border='0' class='property_toc_item_table'>";
_2c73+="<colgroup><col style='width: auto;'/><col style='width: 1px;'/></colgroup>";
_2c73+="<tr><td class='property_toc_item_label'>"+title+"</td><td class='property_toc_item_arrow'></td></tr>";
_2c73+="</table>";
_2c73+="</div>";
return _2c73;
},generateTable:function(page,_2c74){
var _2c75=_2c74?_2c74.rowsOnly:false;
var _2c76=_2c74?_2c74.zeroSpaceForIncrDecr:false;
var _2c77=_2c76?"0px":"20px";
var _2c78="";
if(page.html){
page.id=this.getId();
return this.injectId(page.html,page.id);
}
var _2c79="<table class='property_table_stretchable' border='0' width='100%' align='center' cellspacing='0' cellpadding='0'>";
_2c79+="<colgroup>";
_2c79+="<col style='width:6px;' />";
_2c79+="<col class='gap02' />";
_2c79+="<col class='gap03' />";
_2c79+="<col style='width:"+_2c77+";' />";
_2c79+="<col style='width:6px;' />";
_2c79+="</colgroup>";
if(!_2c75){
_2c78+=_2c79;
}
for(var i=0;i<page.length;i++){
if(page[i].widgetHtml){
page[i].id=this.getId();
page[i].rowId=this.getId();
_2c78+="<tr id='"+page[i].rowId+"'";
if(page[i].rowClass){
_2c78+=" class='"+page[i].rowClass+"'";
}
_2c78+=">";
_2c78+="<td colspan='5' width='100%'>";
_2c78+=this.injectId(page[i].widgetHtml,page[i].id);
_2c78+="</td>";
_2c78+="</tr>";
}else{
if(page[i].html){
page[i].id=this.getId();
page[i].rowId=this.getId();
_2c78+="<tr id='"+page[i].rowId+"'";
_2c78+=" class='cssPropertySection";
if(page[i].rowClass){
_2c78+=" "+page[i].rowClass;
}
_2c78+="'>";
_2c78+="<td colspan='5' width='100%'>";
_2c78+=page[i].html;
_2c78+="</td>";
_2c78+="</tr>";
}else{
if(page[i].type=="toggleSection"){
_2c78+="<tr id='"+page[i].id+"'  class='cssPropertySection'><td colspan='5'>";
var _2c7a="";
var _2c7b=this.generateTable(page[i].pageTemplate,{rowsOnly:true});
for(var j=0;j<page[i].pageTemplate.length;j++){
if(page[i].pageTemplate[j].rowId){
_2c7a+="dojo.toggleClass('"+page[i].pageTemplate[j].rowId+"','propertiesSectionHidden');";
}
if(page[i].pageTemplate[j].cascadeSectionRowId){
_2c7a+="if(this.checked){dojo.removeClass('"+page[i].pageTemplate[j].cascadeSectionRowId+"','propertiesSectionHidden');}else{{dojo.addClass('"+page[i].pageTemplate[j].cascadeSectionRowId+"','propertiesSectionHidden');}}";
}
}
_2c78+="<input type='checkbox' onclick=\""+_2c7a+"\"></input>";
_2c78+=page[i].display;
_2c78+="</td></tr>";
_2c78+=_2c7b;
}else{
if(page[i].display){
page[i].toggleCascade=this.getId();
page[i].cascadeSection=this.getId();
page[i].rowId=this.getId();
page[i].cascadeSectionRowId=this.getId();
_2c78+="<tr id='"+page[i].rowId+"'";
_2c78+=" class='cssPropertySection";
if(page[i].rowClass){
_2c78+=" "+page[i].rowClass;
}
_2c78+="'";
_2c78+=" propName='"+page[i].display+"'";
_2c78+=">";
_2c78+="<td/>";
_2c78+="<td class='propertyDisplayName'>"+page[i].display+":&nbsp;</td>";
_2c78+="<td class='propertyInputField'>"+this.getEditor(page[i])+"</td>";
_2c78+="<td class='propertyExtra' nowrap='true'>";
if(page[i].target&&!page[i].hideCascade){
_2c78+="<div width='100%'><button class='showCss propertyButton' id='"+page[i].toggleCascade+"'";
_2c78+=" onClick=\"davinci.ve.widgets.HTMLStringUtil.showProperty(";
_2c78+="'"+page[i].rowId+"'";
_2c78+=")\">&gt;</button>";
_2c78+="</div>";
}
_2c78+="<td/>";
_2c78+="</tr>";
if(page[i].target&&!page[i].hideCascade){
var _2c7c="{'cascadeSectionRowId':\""+page[i].cascadeSectionRowId+"\",'toggleCascade':\""+page[i].toggleCascade+"\"}";
_2c78+="<tr id='"+page[i].cascadeSectionRowId+"' class='cssCascadeSection cascadeRowHidden'>";
_2c78+="<td colspan='5' width='100%' class='showCascadeDiv'><div dojoType='davinci.ve.widgets.Cascade' toggleClasses="+_2c7c+" target='"+dojo.toJson(page[i].target)+"' targetField='\""+page[i].id+"\"' id='"+page[i].cascadeSection+"'></div></td></tr>";
}
}else{
_2c78+="</table>";
_2c78+=this.getEditor(page[i]);
_2c78+=_2c79;
}
}
}
}
}
if(!_2c75){
_2c78+="</table>";
}
return _2c78;
},generateTemplate:function(_2c7d){
var _2c7e="";
if(_2c7d.pageTemplate){
if(_2c7d.key){
_2c7d.id=this.getId();
_2c7e="<div class='propGroup' id='"+_2c7d.id+"' propGroup='"+_2c7d.key+"'>";
}
_2c7e+=this.generateTable(_2c7d.pageTemplate);
_2c7e+="</div>";
}else{
if(_2c7d.html){
_2c7e+=_2c7d.html;
}else{
if(_2c7d.widgetHtml){
_2c7d.id=this.getId();
_2c7e+=this.injectId(_2c7d.widgetHtml,_2c7d.id);
}
}
}
return _2c7e;
},stylesheetHref:"propview.css",animShowSectionClass:"propRootDetailsContainer",animShowSectionClassSelector:".propRootDetailsContainer",animShowDetailsClass:"property_table_stretchable",animShowDetailsClassSelector:".property_table_stretchable",showPropAnimClasses:["propRowFadeIn","propRowFadeOut","propRowTransparent","propRowOpaque","propRowHidden"],showRoot:function(){
var Util=this;
Util._hideSectionShowRoot();
Util._currentPropSection=null;
return false;
},showSection:function(_2c7f,_2c80){
var Util=this;
Util._initSection(_2c7f);
return false;
},showProperty:function(_2c81){
var _2c82=function(){
for(var i=0;i<_2c83.children.length;i++){
var node=_2c83.children[i];
if(node.nodeType==1&&dojo.hasClass(node,"cssPropertySection")){
if(node==_2c84){
Util._addRemoveClasses(node,_2c85,[]);
}else{
Util._addRemoveClasses(node,_2c85,["propRowHidden"]);
}
}
}
};
var _2c86=function(){
if(_2c87){
dojo.removeClass(_2c87,"cascadeRowHidden");
dojo.addClass(_2c87,"cascadeRowTransparent");
setTimeout(function(){
dojo.removeClass(_2c87,"cascadeRowTransparent");
dojo.addClass(_2c87,"cascadeRowFadeIn");
},1);
}
};
function _2c88(event){
dojo.disconnect(_2c89);
dojo.disconnect(_2c8a);
_2c82();
var _2c8b=Util._findRule(Util.animShowDetailsClassSelector);
if(!_2c8b){
console.error("HTMLStringUtil showProperty: transEnd: rule not found");
return;
}else{
var ss=_2c8b.ss;
var _2c8c=_2c8b.ruleIndex;
}
ss.deleteRule(_2c8c);
ss.insertRule(Util.animShowDetailsClassSelector+" { margin-top:0px; }",_2c8c);
_2c86();
};
dojo.addClass(dojo.byId("davinci_app"),"showingCascade");
var Util=this;
var _2c85=this.showPropAnimClasses;
var _2c84=dojo.byId(_2c81);
var _2c83=_2c84.parentNode;
var _2c8d=Util._searchSiblingsByTagClass(_2c83.children[0],"TR","cssPropertySection");
var _2c87=Util._searchSiblingsByTagClass(_2c84.nextSibling,"TR","cssCascadeSection");
var _2c8e=Util._searchUpByTagClass(_2c83,"TABLE",Util.animShowDetailsClass);
var _2c8f=Util._searchUpByTagClass(_2c84,"DIV","propGroup");
var _2c90=dojo.attr(_2c8f,"propGroup");
var _2c91=dojo.attr(_2c84,"propName");
var _2c92=dojo.getObject("davinci.ve.views.SwitchingStyleView");
var _2c93=_2c92.prototype.sectionTitleFromKey(_2c90);
if(_2c61.supportsCSS3Transitions){
var _2c94=dojo.marginBox(_2c8d);
var _2c95=dojo.marginBox(_2c84);
var _2c96=_2c95.t-_2c94.t;
var _2c97=Util._findRule(Util.animShowDetailsClassSelector);
if(!_2c97){
console.error("HTMLStringUtil showProperty: transEnd: rule not found");
return;
}else{
var ss=_2c97.ss;
var _2c98=_2c97.ruleIndex;
}
var _2c89=dojo.connect(_2c8e,"webkitTransitionEnd",_2c88);
var _2c8a=dojo.connect(_2c8e,"transitionend",_2c88);
ss.deleteRule(_2c98);
ss.insertRule(Util.animShowDetailsClassSelector+" { margin-top:-"+_2c96+"px; opacity:.99; -webkit-transition: all .6s ease; -moz-transition: all .6s ease; }",_2c98);
var _2c99=false;
for(var i=0;i<_2c83.children.length;i++){
var node=_2c83.children[i];
if(node.nodeType==1&&dojo.hasClass(node,"cssPropertySection")){
if(node==_2c84){
Util._addRemoveClasses(node,_2c85,["propRowFadeIn"]);
_2c99=true;
}else{
if(!_2c99){
Util._addRemoveClasses(node,_2c85,["propRowTransparent"]);
}else{
Util._addRemoveClasses(node,_2c85,["propRowHidden"]);
}
}
}
}
}else{
_2c82();
_2c86();
}
},_initSection:function(_2c9a){
var Util=this;
var _2c9b=Util.showPropAnimClasses;
var _2c9c=Util._getRootTD();
var _2c9d=dojo.query(".propGroup",_2c9c);
var _2c9e;
for(var i=0;i<_2c9d.length;i++){
var _2c9f=_2c9d[i];
var name=dojo.attr(_2c9f,"propGroup");
if(name==_2c9a){
dojo.removeClass(_2c9f,"dijitHidden");
_2c9e=_2c9f;
}else{
dojo.addClass(_2c9f,"dijitHidden");
}
}
var _2ca0=dojo.query(".cssPropertySection",_2c9e);
for(var i=0;i<_2ca0.length;i++){
Util._addRemoveClasses(_2ca0[i],_2c9b,[]);
}
var _2ca1=dojo.query(".cssCascadeSection",_2c9e);
for(var i=0;i<_2ca1.length;i++){
dojo.addClass(_2ca1[i],"cascadeRowHidden");
}
Util._currentPropSection=_2c9a;
dojo.removeClass(dojo.byId("davinci_app"),"showingCascade");
},_hideSectionShowRoot:function(){
var Util=this;
var _2ca2=Util._getRootTD();
dojo.removeClass(_2ca2,"dijitHidden");
},_findRule:function(_2ca3){
if(this.animSS&&typeof this.animRuleIndex[_2ca3]=="number"){
var idx=this.animRuleIndex[_2ca3];
if(this.animSS.cssRules[idx].selectorText==_2ca3){
return {ss:this.animSS,ruleIndex:idx};
}
}
function _2ca4(ss,_2ca5){
for(var _2ca6=0;_2ca6<ss.cssRules.length;_2ca6++){
var rule=ss.cssRules[_2ca6];
if(rule.type===3){
var _2ca7=rule.styleSheet;
var _2ca8=_2ca4(_2ca7,_2ca5);
if(_2ca8){
return _2ca8;
}
}else{
if(rule.selectorText==_2ca5){
return {ss:ss,ruleIndex:_2ca6};
}
}
}
};
for(var i=0;i<document.styleSheets.length;i++){
var ss=document.styleSheets[i];
var _2ca9=_2ca4(ss,_2ca3);
if(_2ca9){
this.animSS=_2ca9.ss;
this.animRuleIndex[_2ca3]=_2ca9.ruleIndex;
return _2ca9;
}
}
return null;
},_addRemoveClasses:function(elem,_2caa,_2cab){
var _2cac=[];
for(var i=0;i<_2caa.length;i++){
var found=false;
for(var j=0;j<_2cab.length;j++){
if(_2caa[i]==_2cab[j]){
found=true;
break;
}
}
if(!found){
_2cac.push(_2caa[i]);
}
}
for(var i=0;i<_2cac.length;i++){
dojo.removeClass(elem,_2cac[i]);
}
for(var i=0;i<_2cab.length;i++){
dojo.addClass(elem,_2cab[i]);
}
},_searchUpByTagClass:function(_2cad,_2cae,_2caf){
while(_2cad!=null&&_2cad.nodeName!="BODY"){
if(_2cad.nodeName==_2cae&&(!_2caf||dojo.hasClass(_2cad,_2caf))){
return _2cad;
}
_2cad=_2cad.parentNode;
}
return null;
},_searchSiblingsByTagClass:function(_2cb0,_2cb1,_2cb2){
while(_2cb0!=null){
if(_2cb0.nodeName==_2cb1&&(!_2cb2||dojo.hasClass(_2cb0,_2cb2))){
return _2cb0;
}
_2cb0=_2cb0.nextSibling;
}
return null;
},_getRootDetailsContainer:function(){
var Util=this;
if(!Util._rootDetailsContainer){
Util._rootDetailsContainer=dojo.query(Util.animShowSectionClassSelector)[0];
}
return Util._rootDetailsContainer;
},_getRootTD:function(){
var Util=this;
var _2cb3=Util._getRootDetailsContainer();
if(!Util._rootTD){
Util._rootTD=dojo.query(".propPaletteRoot",_2cb3)[0];
}
return Util._rootTD;
}});
return _2c63;
});
},"dojox/validate/regexp":function(){
define("dojox/validate/regexp",["dojo/_base/lang","dojo/regexp","dojox/main"],function(lang,_2cb4,dojox){
var _2cb5=lang.getObject("validate.regexp",true,dojox);
_2cb5=dojox.validate.regexp={ipAddress:function(flags){
flags=(typeof flags=="object")?flags:{};
if(typeof flags.allowDottedDecimal!="boolean"){
flags.allowDottedDecimal=true;
}
if(typeof flags.allowDottedHex!="boolean"){
flags.allowDottedHex=true;
}
if(typeof flags.allowDottedOctal!="boolean"){
flags.allowDottedOctal=true;
}
if(typeof flags.allowDecimal!="boolean"){
flags.allowDecimal=true;
}
if(typeof flags.allowHex!="boolean"){
flags.allowHex=true;
}
if(typeof flags.allowIPv6!="boolean"){
flags.allowIPv6=true;
}
if(typeof flags.allowHybrid!="boolean"){
flags.allowHybrid=true;
}
var _2cb6="((\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])\\.){3}(\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])";
var _2cb7="(0[xX]0*[\\da-fA-F]?[\\da-fA-F]\\.){3}0[xX]0*[\\da-fA-F]?[\\da-fA-F]";
var _2cb8="(0+[0-3][0-7][0-7]\\.){3}0+[0-3][0-7][0-7]";
var _2cb9="(0|[1-9]\\d{0,8}|[1-3]\\d{9}|4[01]\\d{8}|42[0-8]\\d{7}|429[0-3]\\d{6}|"+"4294[0-8]\\d{5}|42949[0-5]\\d{4}|429496[0-6]\\d{3}|4294967[01]\\d{2}|42949672[0-8]\\d|429496729[0-5])";
var hexRE="0[xX]0*[\\da-fA-F]{1,8}";
var _2cba="([\\da-fA-F]{1,4}\\:){7}[\\da-fA-F]{1,4}";
var _2cbb="([\\da-fA-F]{1,4}\\:){6}"+"((\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])\\.){3}(\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])";
var a=[];
if(flags.allowDottedDecimal){
a.push(_2cb6);
}
if(flags.allowDottedHex){
a.push(_2cb7);
}
if(flags.allowDottedOctal){
a.push(_2cb8);
}
if(flags.allowDecimal){
a.push(_2cb9);
}
if(flags.allowHex){
a.push(hexRE);
}
if(flags.allowIPv6){
a.push(_2cba);
}
if(flags.allowHybrid){
a.push(_2cbb);
}
var _2cbc="";
if(a.length>0){
_2cbc="("+a.join("|")+")";
}
return _2cbc;
},host:function(flags){
flags=(typeof flags=="object")?flags:{};
if(typeof flags.allowIP!="boolean"){
flags.allowIP=true;
}
if(typeof flags.allowLocal!="boolean"){
flags.allowLocal=false;
}
if(typeof flags.allowPort!="boolean"){
flags.allowPort=true;
}
if(typeof flags.allowNamed!="boolean"){
flags.allowNamed=false;
}
var _2cbd="(?:[\\da-zA-Z](?:[-\\da-zA-Z]{0,61}[\\da-zA-Z])?)";
var _2cbe="(?:[a-zA-Z](?:[-\\da-zA-Z]{0,6}[\\da-zA-Z])?)";
var _2cbf=flags.allowPort?"(\\:\\d+)?":"";
var _2cc0="((?:"+_2cbd+"\\.)+"+_2cbe+"\\.?)";
if(flags.allowIP){
_2cc0+="|"+_2cb5.ipAddress(flags);
}
if(flags.allowLocal){
_2cc0+="|localhost";
}
if(flags.allowNamed){
_2cc0+="|^[^-][a-zA-Z0-9_-]*";
}
return "("+_2cc0+")"+_2cbf;
},url:function(flags){
flags=(typeof flags=="object")?flags:{};
if(!("scheme" in flags)){
flags.scheme=[true,false];
}
var _2cc1=_2cb4.buildGroupRE(flags.scheme,function(q){
if(q){
return "(https?|ftps?)\\://";
}
return "";
});
var _2cc2="(/(?:[^?#\\s/]+/)*(?:[^?#\\s/]+(?:\\?[^?#\\s/]*)?(?:#[A-Za-z][\\w.:-]*)?)?)?";
return _2cc1+_2cb5.host(flags)+_2cc2;
},emailAddress:function(flags){
flags=(typeof flags=="object")?flags:{};
if(typeof flags.allowCruft!="boolean"){
flags.allowCruft=false;
}
flags.allowPort=false;
var _2cc3="([!#-'*+\\-\\/-9=?A-Z^-~]+[.])*[!#-'*+\\-\\/-9=?A-Z^-~]+";
var _2cc4=_2cc3+"@"+_2cb5.host(flags);
if(flags.allowCruft){
_2cc4="<?(mailto\\:)?"+_2cc4+">?";
}
return _2cc4;
},emailAddressList:function(flags){
flags=(typeof flags=="object")?flags:{};
if(typeof flags.listSeparator!="string"){
flags.listSeparator="\\s;,";
}
var _2cc5=_2cb5.emailAddress(flags);
var _2cc6="("+_2cc5+"\\s*["+flags.listSeparator+"]\\s*)*"+_2cc5+"\\s*["+flags.listSeparator+"]?\\s*";
return _2cc6;
},numberFormat:function(flags){
flags=(typeof flags=="object")?flags:{};
if(typeof flags.format=="undefined"){
flags.format="###-###-####";
}
var _2cc7=function(_2cc8){
return _2cb4.escapeString(_2cc8,"?").replace(/\?/g,"\\d?").replace(/#/g,"\\d");
};
return _2cb4.buildGroupRE(flags.format,_2cc7);
},ca:{postalCode:function(){
return "([A-Z][0-9][A-Z] [0-9][A-Z][0-9])";
},province:function(){
return "(AB|BC|MB|NB|NL|NS|NT|NU|ON|PE|QC|SK|YT)";
}},us:{state:function(flags){
flags=(typeof flags=="object")?flags:{};
if(typeof flags.allowTerritories!="boolean"){
flags.allowTerritories=true;
}
if(typeof flags.allowMilitary!="boolean"){
flags.allowMilitary=true;
}
var _2cc9="AL|AK|AZ|AR|CA|CO|CT|DE|DC|FL|GA|HI|ID|IL|IN|IA|KS|KY|LA|ME|MD|MA|MI|MN|MS|MO|MT|"+"NE|NV|NH|NJ|NM|NY|NC|ND|OH|OK|OR|PA|RI|SC|SD|TN|TX|UT|VT|VA|WA|WV|WI|WY";
var _2cca="AS|FM|GU|MH|MP|PW|PR|VI";
var _2ccb="AA|AE|AP";
if(flags.allowTerritories){
_2cc9+="|"+_2cca;
}
if(flags.allowMilitary){
_2cc9+="|"+_2ccb;
}
return "("+_2cc9+")";
}}};
return _2cb5;
});
},"davinci/ui/Dialog":function(){
define(["dojo/_base/declare","dijit/form/Button","dijit/Dialog","dojo/dom-geometry","dojo/dom-style","dojo/_base/connect","dojo/window","dojo/parser","dojo/i18n!davinci/ve/nls/common","dojox/layout/ResizeHandle",],function(_2ccc,_2ccd,_2cce,_2ccf,style,_2cd0,_2cd1,_2cd2,veNLS,_2cd3){
var _2cd4=_2ccc(_2cce,{contentStyle:null,buildRendering:function(){
this.inherited(arguments);
dojo.addClass(this.domNode,"resizableDialog");
if(this.submitOnEnter){
dojo.addClass(this.domNode,"submitOnEnter");
}
},_setContent:function(cont,_2cd5){
this.inherited(arguments);
var div=dojo.doc.createElement("div");
this.containerNode.appendChild(div);
new _2cd3({targetId:this.id},div);
var _2cd6=dojo.query(".dijitDialogPaneContentArea",this.containerNode)[0];
if(_2cd6){
dojo.connect(_2cd6,"onkeydown",this,"_onKeyDown");
}else{
dojo.connect(this.domNode,"onkeydown",this,"_onKeyDown");
}
},resize:function(_2cd7){
if(_2cd7){
var _2cd8=style.getComputedStyle(this.containerNode);
var _2cd9=_2ccf.getPadExtents(this.containerNode,_2cd8);
var c={w:_2cd7.w-_2cd9.w,h:_2cd7.h-_2cd9.h};
c.h-=_2ccf.getMarginBox(this.titleBar).h;
var _2cda=dojo.query(".dijitDialogPaneContentArea",this.containerNode)[0];
var _2cdb=dojo.query(".dijitDialogPaneActionBar",this.containerNode)[0];
c.h-=_2ccf.getMarginBox(_2cdb).h;
if(c.w){
dojo.style(_2cda,"width",c.w+"px");
}
if(c.h){
dojo.style(_2cda,"height",c.h+"px");
}
dojo.forEach(this.getChildren(),dojo.hitch(this,function(child){
if(child.resize){
child.resize({w:c.w,h:c.h});
}
}));
}
},show:function(){
var _2cdc=this.inherited(arguments);
if(this.contentStyle){
if(typeof (this.contentStyle)=="object"){
var r={};
if(this.contentStyle.width){
r.w=parseInt(this.contentStyle.width);
}
if(this.contentStyle.height){
r.h=parseInt(this.contentStyle.height);
}
var _2cdd=_2cd1.getBox(this.ownerDocument);
_2cdd.w*=this.maxRatio;
_2cdd.h*=this.maxRatio;
if(r.h>_2cdd.h){
var _2cde=_2ccf.position(this.containerNode),w=Math.min(r.w,_2cdd.w)-(r.w-_2cde.w),h=Math.min(r.h,_2cdd.h)-(r.h-_2cde.h);
r.h=_2cdd.h;
}
this.resize(r);
}
this._size();
this._position();
dojo.style(this.containerNode,"width","auto");
dojo.style(this.containerNode,"height","auto");
}
return _2cdc;
},_onKeyDown:function(e){
var _2cdf=((e.ctrlKey&&!dojo.isMac)||(dojo.isMac&&e.metaKey));
if(e.which==dojo.keys.ENTER&&(_2cdf||this.submitOnEnter)){
var _2ce0=dojo.query("input[type=submit]",this.containerNode);
if(_2ce0.length>0){
var b=dijit.getEnclosingWidget(_2ce0[0]);
var evt=document.createEvent("MouseEvents");
evt.initMouseEvent("click",true,true,window,0,0,0,0,0,false,false,false,false,0,null);
b._onClick(evt);
}
}
}});
_2cd4._timedDestroy=function(_2ce1,_2ce2){
if(_2ce2){
_2ce2.forEach(_2cd0.disconnect);
}
var hndl=_2cd0.connect(_2ce1,"onHide",function(){
_2cd0.disconnect(hndl);
_2ce1.destroyRecursive();
});
_2ce1.hide();
};
_2cd4.showModal=function(_2ce3,title,style,_2ce4,_2ce5){
var _2ce6=[];
var _2ce7=new _2cd4({title:title,content:_2ce3,contentStyle:style,submitOnEnter:_2ce5});
var _2ce8=dojo.hitch(this,function(){
var _2ce9=false;
if(_2ce4){
_2ce9=_2ce4();
}
if(_2ce9){
return;
}
this._timedDestroy(_2ce7,_2ce6);
});
_2ce6.push(_2cd0.connect(_2ce7,"onExecute",_2ce3,_2ce8));
if(_2ce3.onExecute){
_2ce6.push(_2cd0.connect(_2ce3,"onExecute",_2ce3,_2ce8));
}
_2ce6.push(_2cd0.connect(_2ce3,"onClose",dojo.hitch(this,function(){
this._timedDestroy(_2ce7,_2ce6);
})));
_2ce6.push(_2cd0.connect(_2ce7,"onCancel",dojo.hitch(this,function(){
this._timedDestroy(_2ce7,_2ce6);
})));
_2ce7.show();
return _2ce7;
},_2cd4.showMessage=function(title,_2cea,style,_2ceb,_2cec){
return this.showDialog(title,_2cea,style,_2ceb,null,true);
},_2cd4.showDialog=function(title,_2ced,style,_2cee,_2cef,_2cf0,_2cf1){
var _2cf2;
var _2cf3=[];
var _2cf4=document.createElement("div");
var _2cf5=document.createElement("div");
dojo.addClass(_2cf5,"dijitDialogPaneContentArea");
_2cf4.appendChild(_2cf5);
var _2cf6=document.createElement("div");
dojo.addClass(_2cf6,"dijitDialogPaneActionBar");
var _2cf7=new _2ccd({label:_2cef?_2cef:veNLS.ok,type:"submit","class":"maqPrimaryButton"});
_2cf6.appendChild(_2cf7.domNode);
var _2cf8=dojo.hitch(this,function(){
this._timedDestroy(_2cf2,_2cf3);
});
if(!_2cf0){
function _2cf9(){
_2cf2.onCancel();
};
_2cf6.appendChild(new _2ccd({label:veNLS.cancel,onClick:_2cf9,"class":"maqSecondaryButton"}).domNode);
}
_2cf4.appendChild(_2cf6);
_2cf2=new _2cd4({title:title,content:_2cf4,contentStyle:style,submitOnEnter:_2cf1});
if(dojo.isString(_2ced)){
_2cf5.innerHTML=_2ced;
_2cd2.parse(_2cf5);
}else{
if(_2ced.domNode){
_2cf5.appendChild(_2ced.domNode);
}else{
_2cf5.appendChild(_2ced);
}
}
_2cf3.push(_2cd0.connect(_2cf2,"onExecute",dojo.hitch(this,function(){
if(_2cee){
_2cee();
}
_2cf8();
})));
_2cf3.push(_2cd0.connect(_2cf2,"onCancel",dojo.hitch(this,function(){
_2cf8();
})));
_2cf2.show();
return _2cf2;
};
return _2cd4;
});
},"url:dijit/layout/templates/_TabButton.html":"<div role=\"presentation\" data-dojo-attach-point=\"titleNode,innerDiv,tabContent\" class=\"dijitTabInner dijitTabContent\">\n\t<img src=\"${_blankGif}\" alt=\"\" class=\"dijitIcon dijitTabButtonIcon\" data-dojo-attach-point='iconNode'/>\n\t<span data-dojo-attach-point='containerNode,focusNode' class='tabLabel'></span>\n\t<span class=\"dijitInline dijitTabCloseButton dijitTabCloseIcon\" data-dojo-attach-point='closeNode'\n\t\t  role=\"presentation\">\n\t\t<span data-dojo-attach-point='closeText' class='dijitTabCloseText'>[x]</span\n\t\t\t\t></span>\n</div>\n","davinci/ui/NewTheme":function(){
require({cache:{"url:davinci/ui/templates/newtheme.html":"<div>\r\n\t<div class=\"dijitDialogPaneContentArea\">\r\n\t\t<table>\r\n\t\t<tr>\r\n\t\t<td>${themeToClone}:</td><td> <div dojoType=\"davinci.ui.widgets.ThemeSelection\" workspaceOnly=\"false\" dojoAttachPoint = '_themeSelection'></div></td><td><div dojoAttachPoint='_error1'></div></td>\r\n\t\t</tr>\r\n\t\t<tr><td colspan='3'><hr></hr></td></tr>\r\n\t\t<!-- \r\n\t\t<tr>\r\n\t\t<td>New Name:</td><td><input style='width:100%' type='select' dojoAttachPoint=\"_themeName\"></input></td><td><div dojoAttachPoint='_error2'></div></td>\r\n\t\t</tr>\r\n\t\t<tr>\r\n\t\t<td>Version:</td><td><input style='width:100%' type='text' dojoAttachPoint=\"_version\"></input></td><td><div dojoAttachPoint='_error3'></div></td>\r\n\t\t</tr>\r\n\t\t -->\r\n\t\t<tr>\r\n\t\t<td>${newName}:</td><td><input class='templateInput' type='text' \r\n\t\t\tdojoAttachPoint=\"_selector\"\r\n\t\t\tdojoType=\"dijit.form.ValidationTextBox\"\r\n\t\t\trequired=\"true\" \r\n\t\t\tinvalidMessage='${invalidThemeName}'></input></td><td><div dojoAttachPoint='_error4'></div></td>\r\n\t\t</tr>\r\n\t\t</table>\r\n\t</div>\r\n\t<div class=\"dijitDialogPaneActionBar\">\r\n\t\t<button dojoType='dijit.form.Button' dojoAttachPoint=\"_okButton\" dojoAttachEvent='onClick:okButton' label='${create}' class=\"maqPrimaryButton\" type=\"submit\" disabled></button>\r\n\t\t<button dojoType='dijit.form.Button' dojoAttachEvent='onClick:cancelButton' label='${buttonCancel}' class=\"maqSecondaryButton\"></button>\r\n\t</div>\t\t\r\n</div>"}});
define("davinci/ui/NewTheme",["dojo/_base/declare","dijit/_TemplatedMixin","dijit/_WidgetBase","dijit/_WidgetsInTemplateMixin","system/resource","../model/Path","../Workbench","../workbench/Preferences","dojo/i18n!./nls/ui","dojo/i18n!dijit/nls/common","dojo/text!./templates/newtheme.html","../Theme","./widgets/ThemeSelection","dijit/form/Button","dijit/form/ValidationTextBox"],function(_2cfa,_2cfb,_2cfc,_2cfd,_2cfe,Path,_2cff,_2d00,uiNLS,_2d01,_2d02,Theme,_2d03,_2d04,_2d05){
return _2cfa([_2cfc,_2cfb,_2cfd],{templateString:_2d02,_themeSelection:null,_okButton:null,_folder:null,_themeName:null,_folder:null,_version:null,_selector:null,_themeLocation:null,_error1:null,_error2:null,_error3:null,_error4:null,_errorMsg:null,_themeValidator:/^[-]?([_a-z]|[^\0-\237]|\[0-9a-f]{1,6}(\r\n|[ \n\r\t\f])?|\[^\n\r\f0-9a-f])([_a-z0-9-]|[^\0-\237]|\[0-9a-f]{1,6}(\r\n|[ \n\r\t\f])?|\[^\n\r\f0-9a-f])*$/i,postMixInProperties:function(){
var _2d06=uiNLS;
var _2d07=_2d01;
dojo.mixin(this,_2d06);
dojo.mixin(this,_2d07);
this.inherited(arguments);
},postCreate:function(){
this.inherited(arguments);
dojo.connect(this._themeSelection,"onChange",this,"_baseThemeChanged");
dojo.connect(this._themeSelection,"onChange",this,"_checkValid");
this._selector.validator=dojo.hitch(this,function(value,_2d08){
var _2d09=this._themeValidator.test(value);
this._okButton.set("disabled",!_2d09);
return _2d09;
});
},_baseThemeChanged:function(){
this._theme=this._themeSelection.get("value");
},_createTheme:function(){
this._okButton.set("disabled",true);
var _2d0a=uiNLS;
var _2d0b=this._themeSelection.get("value");
var _2d0c=this._selector.get("value");
var _2d0d=_2d0c;
var _2d0e=null;
var base=_2d0c;
var _2d0f=this._getThemeLocation();
var r1=_2cfe.findResource(_2d0f+"/"+base+".theme");
if(r1){
alert(_2d0a.themeAlreadyExists);
}else{
this._loading=dojo.create("div",null,dojo.body(),"first");
this._loading.innerHTML=dojo.string.substitute("<table><tr><td><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>&nbsp;${0}...</td></tr></table>",[_2d0a.creatingTheme]);
dojo.addClass(this._loading,"loading");
dojo.style(this._loading,"opacity","0.5");
var _2d10=this.getBase();
var a=Theme.CloneTheme(_2d0d,_2d0e,_2d0c,_2d0f,_2d0b,true);
a.promise.then(function(_2d11){
var _2d12=a.themeFile;
if(_2d12){
_2d12.isNew=false;
return _2d12.getContent().then(function(_2d13){
_2cff.openEditor({fileName:_2d12,content:_2d13});
});
}else{
throw new Error(_2d0a.errorCreatingTheme+base);
}
}).otherwise(function(_2d14){
var _2d15="Uh oh! An error has occurred:<br><b>"+_2d14.message+"</b>";
if(_2d14.fileName){
_2d15+="<br>file: "+_2d14.fileName+"<br>line: "+_2d14.lineNumber;
}
if(_2d14.stack){
_2d15+="<br><pre>"+_2d14.stack+"</pre>";
}
console.error(_2d15);
}).otherwise(function(){
if(this._loading){
this._loading.parentNode.removeChild(this._loading);
delete this._loading;
}
}.bind(this));
}
},getBase:function(){
if(_2cff.singleProjectMode()){
return _2cff.getProject();
}
},_getThemeLocation:function(){
var _2d16=this._selector.get("value");
var base=this.getBase();
var prefs=_2d00.getPreferences("davinci.ui.ProjectPrefs",base);
var _2d17=new Path(base).append(prefs.themeFolder);
return _2d17.append(_2d16).toString();
},_checkValid:function(){
var isOk=true;
var _2d18=this._themeSelection.get("value");
var _2d19=this._selector.get("value");
if(_2d18==null||_2d18==""||_2d19==null||_2d19==""){
isOk=false;
}
this._okButton.set("disabled",!isOk);
},okButton:function(){
this._createTheme();
},cancelButton:function(){
this.cancel=true;
this.onClose();
},onClose:function(){
}});
});
},"davinci/commands/CommandStack":function(){
define(["dojo/_base/declare"],function(_2d1a){
return _2d1a("davinci.commands.CommandStack",null,{constructor:function(_2d1b){
this._context=_2d1b;
this._undoStack=[];
this._redoStack=[];
},execute:function(_2d1c){
if(!_2d1c){
return;
}
if(this._context&&this._context.declaredClass!="davinci.ve.themeEditor.Context"){
dojo.withDoc(this._context.getDocument(),"execute",_2d1c,[this._context]);
}else{
_2d1c.execute();
}
this._undoStack.push(_2d1c);
this._redoStack=[];
this.onExecute(_2d1c,"execute");
},undo:function(){
if(!this.canUndo()){
return;
}
var _2d1d=this._undoStack.pop();
if(_2d1d._runDelegate){
_2d1d._runDelegate.undoDelegate(_2d1d);
}else{
if(this._context&&this._context.declaredClass!="davinci.ve.themeEditor.Context"){
dojo.withDoc(this._context.getDocument(),"undo",_2d1d);
}else{
_2d1d.undo();
}
}
this._redoStack.push(_2d1d);
this.onExecute(_2d1d,"undo");
},redo:function(){
if(!this.canRedo()){
return;
}
var _2d1e=this._redoStack.pop();
if(_2d1e._runDelegate){
_2d1e._runDelegate.redoDelegate(_2d1e);
}else{
if(this._context&&this._context.declaredClass!="davinci.ve.themeEditor.Context"){
dojo.withDoc(this._context.getDocument(),"execute",_2d1e);
}else{
_2d1e.execute();
}
}
this._undoStack.push(_2d1e);
this.onExecute(_2d1e,"redo");
},canUndo:function(){
return this._undoStack.length>0;
},canRedo:function(){
return this._redoStack.length>0;
},getUndoCount:function(){
return this._undoStack.length;
},getRedoCount:function(){
return this._redoStack.length;
},clear:function(){
this._undoStack=[];
this._redoStack=[];
},jump:function(point,_2d1f){
var _2d20=this.getUndoCount();
var _2d21=this.getRedoCount();
if(point==_2d20){
return point;
}
if(point<0||point>_2d20+_2d21){
return -1;
}
var n=point-_2d20;
if(_2d1f){
if(n<0){
while(n<0){
this._redoStack.push(this._undoStack.pop());
n++;
}
}else{
while(n>0){
this._undoStack.push(this._redoStack.pop());
n--;
}
}
}else{
if(n<0){
while(n<0){
this.undo();
n++;
}
}else{
while(n>0){
this.redo();
n--;
}
}
}
return point;
},onExecute:function(_2d22,_2d23){
},undoDelegate:function(_2d24){
},redoDelegate:function(_2d25){
}});
});
},"url:davinci/ui/templates/download.html":"<div class='downloadDialog'>\t \r\n\t<div class=\"dijitDialogPaneContentArea\">\r\n\t\t<div style=\"margin-bottom: 20px\">\r\n\t\t  ${fileName}: <input dojoType='dijit.form.ValidationTextBox' type=\"text\" maxLength='${_fileNameMaxLength}' dojoAttachPoint=\"__fileName\" value='workspace1.zip' data-dojo-props=\"regExp:'${_fileNameValidationRegExp}', required:true, invalidMessage:'${invalidDownloadFileName}'\"></input>\r\n\t\t</div>\r\n\t\t\r\n\t\t<div dojoAttachPoint=\"_selectionDiv\"></div>\r\n\t\t<div dojoAttachPoint=\"_tableDiv\"></div>\r\n\r\n\t\t<div style=\"margin-top: 8px\">\r\n\t\t  Select: <a href=\"javascript:;\" data-dojo-attach-event=\"onclick: _selectAll\">${selectAll}</a> / <a href=\"javascript:;\" data-dojo-attach-event=\"onclick: _selectNone\">${selectNone}</a>\r\n\t\t</div>\r\n\r\n\t\t<div style=\"margin-top: 20px\">\r\n\t\t\t<input dojoType='dijit.form.CheckBox' type=\"text\" dojoAttachPoint=\"__fullSource\" data-dojo-props=\"\"></input><span style='padding-left: 3px;'>${downloadFullSource}</span>\r\n\t\t\t<br>\r\n\t\t\t<input dojoType='dijit.form.CheckBox' type=\"text\" dojoAttachPoint=\"__optimize\" data-dojo-props=\"\"></input><span style='padding-left: 3px;'>${optimizeOption}</span>\r\n\t\t</div>\r\n  </div>\r\n\t<div class=\"dijitDialogPaneActionBar\">\r\n\t\t<button dojoType='dijit.form.Button' dojoAttachPoint=\"_okButton\" dojoAttachEvent='onClick:okButton' label='${downloadButtonLabel}' class=\"maqPrimaryButton\" type=\"submit\"></button>\r\n\t\t<button dojoType='dijit.form.Button' dojoAttachEvent='onClick:cancelButton' label='${buttonCancel}' class=\"maqSecondaryButton\"></button>\r\n\t</div>\r\n</div>","dijit/form/_FormMixin":function(){
define("dijit/form/_FormMixin",["dojo/_base/array","dojo/_base/declare","dojo/_base/kernel","dojo/_base/lang","dojo/on","dojo/window"],function(array,_2d26,_2d27,lang,on,_2d28){
return _2d26("dijit.form._FormMixin",null,{state:"",_getDescendantFormWidgets:function(_2d29){
var res=[];
array.forEach(_2d29||this.getChildren(),function(child){
if("value" in child){
res.push(child);
}else{
res=res.concat(this._getDescendantFormWidgets(child.getChildren()));
}
},this);
return res;
},reset:function(){
array.forEach(this._getDescendantFormWidgets(),function(_2d2a){
if(_2d2a.reset){
_2d2a.reset();
}
});
},validate:function(){
var _2d2b=false;
return array.every(array.map(this._getDescendantFormWidgets(),function(_2d2c){
_2d2c._hasBeenBlurred=true;
var valid=_2d2c.disabled||!_2d2c.validate||_2d2c.validate();
if(!valid&&!_2d2b){
_2d28.scrollIntoView(_2d2c.containerNode||_2d2c.domNode);
_2d2c.focus();
_2d2b=true;
}
return valid;
}),function(item){
return item;
});
},setValues:function(val){
_2d27.deprecated(this.declaredClass+"::setValues() is deprecated. Use set('value', val) instead.","","2.0");
return this.set("value",val);
},_setValueAttr:function(obj){
var map={};
array.forEach(this._getDescendantFormWidgets(),function(_2d2d){
if(!_2d2d.name){
return;
}
var entry=map[_2d2d.name]||(map[_2d2d.name]=[]);
entry.push(_2d2d);
});
for(var name in map){
if(!map.hasOwnProperty(name)){
continue;
}
var _2d2e=map[name],_2d2f=lang.getObject(name,false,obj);
if(_2d2f===undefined){
continue;
}
if(!lang.isArray(_2d2f)){
_2d2f=[_2d2f];
}
if(typeof _2d2e[0].checked=="boolean"){
array.forEach(_2d2e,function(w){
w.set("value",array.indexOf(_2d2f,w.value)!=-1);
});
}else{
if(_2d2e[0].multiple){
_2d2e[0].set("value",_2d2f);
}else{
array.forEach(_2d2e,function(w,i){
w.set("value",_2d2f[i]);
});
}
}
}
},getValues:function(){
_2d27.deprecated(this.declaredClass+"::getValues() is deprecated. Use get('value') instead.","","2.0");
return this.get("value");
},_getValueAttr:function(){
var obj={};
array.forEach(this._getDescendantFormWidgets(),function(_2d30){
var name=_2d30.name;
if(!name||_2d30.disabled){
return;
}
var value=_2d30.get("value");
if(typeof _2d30.checked=="boolean"){
if(/Radio/.test(_2d30.declaredClass)){
if(value!==false){
lang.setObject(name,value,obj);
}else{
value=lang.getObject(name,false,obj);
if(value===undefined){
lang.setObject(name,null,obj);
}
}
}else{
var ary=lang.getObject(name,false,obj);
if(!ary){
ary=[];
lang.setObject(name,ary,obj);
}
if(value!==false){
ary.push(value);
}
}
}else{
var prev=lang.getObject(name,false,obj);
if(typeof prev!="undefined"){
if(lang.isArray(prev)){
prev.push(value);
}else{
lang.setObject(name,[prev,value],obj);
}
}else{
lang.setObject(name,value,obj);
}
}
});
return obj;
},isValid:function(){
return this.state=="";
},onValidStateChange:function(){
},_getState:function(){
var _2d31=array.map(this._descendants,function(w){
return w.get("state")||"";
});
return array.indexOf(_2d31,"Error")>=0?"Error":array.indexOf(_2d31,"Incomplete")>=0?"Incomplete":"";
},disconnectChildren:function(){
},connectChildren:function(_2d32){
this._descendants=this._getDescendantFormWidgets();
array.forEach(this._descendants,function(child){
if(!child._started){
child.startup();
}
});
if(!_2d32){
this._onChildChange();
}
},_onChildChange:function(attr){
if(!attr||attr=="state"||attr=="disabled"){
this._set("state",this._getState());
}
if(!attr||attr=="value"||attr=="disabled"||attr=="checked"){
if(this._onChangeDelayTimer){
this._onChangeDelayTimer.remove();
}
this._onChangeDelayTimer=this.defer(function(){
delete this._onChangeDelayTimer;
this._set("value",this.get("value"));
},10);
}
},startup:function(){
this.inherited(arguments);
this._descendants=this._getDescendantFormWidgets();
this.value=this.get("value");
this.state=this._getState();
var self=this;
this.own(on(this.containerNode,"attrmodified-state, attrmodified-disabled, attrmodified-value, attrmodified-checked",function(evt){
if(evt.target==self.domNode){
return;
}
self._onChildChange(evt.type.replace("attrmodified-",""));
}));
this.watch("state",function(attr,_2d33,_2d34){
this.onValidStateChange(_2d34=="");
});
},destroy:function(){
this.inherited(arguments);
}});
});
},"davinci/ve/widgets/Background":function(){
define(["dojo/_base/declare","dojo/Deferred","davinci/workbench/WidgetLite","davinci/ve/widgets/ColorPickerFlat","davinci/ve/widgets/ColorStore","davinci/ve/widgets/MutableStore","dijit/form/ComboBox","davinci/ve/widgets/BackgroundDialog","davinci/Workbench","davinci/ve/utils/URLRewrite","davinci/model/Path","dojo/i18n!davinci/ve/nls/ve","dojo/i18n!dijit/nls/common","davinci/ve/utils/CssUtils","davinci/ve/widgets/ColorPicker"],function(_2d35,_2d36,_2d37,_2d38,_2d39,_2d3a,_2d3b,_2d3c,_2d3d,_2d3e,Path,veNLS,_2d3f,_2d40,_2d41){
var _2d42="davinci_ve_widgets_properties_border_generated";
var _2d43=0,getId=function(){
return _2d42+(_2d43++);
};
return _2d35("davinci.ve.widgets.Background",[_2d37],{__id:0,data:null,buildRendering:function(){
this.domNode=dojo.doc.createElement("div",{style:"width:100%"});
this._textFieldId=getId();
this._buttonId=getId();
var _2d44=dojo.create("div",{className:"bgPropButtonDiv",style:"float:right; width:28px;"});
var _2d45=dojo.create("button",{innerHTML:"...",id:this._buttonId,className:"bgPropButton",style:"font-size:1em;"},_2d44);
var _2d46=38;
var _2d47=this._colorswatch=(this.colorswatch=="true");
if(_2d47){
_2d46=56;
var _2d48=dojo.doc.createElement("div");
dojo.addClass(_2d48,"colorPicker");
this._selectedColor=dojo.doc.createElement("div");
this._selectedColor.innerHTML="&nbsp;";
dojo.addClass(this._selectedColor,"colorPickerSelected");
dojo.addClass(this._selectedColor,"colorPickerSelectedSkinny");
this._colorPickerFlat=new _2d38({});
}
var _2d49=dojo.create("div",{className:"bgPropComboDiv",style:"margin-right:"+_2d46+"px;padding:1px 0;"});
var _2d4a=dojo.isArray(this.data)?this.data:[""];
var _2d4b=this.langObjVE=veNLS;
if(_2d47){
this._statics=["",davinci.ve.widgets.ColorPicker.divider,_2d4b.colorPicker,_2d4b.removeValue];
this._run={};
if(!this.data){
this.data=[{value:this._statics[0]}];
this.data.push({value:this._statics[2],run:this._chooseColorValue});
this.data.push({value:this._statics[3],run:function(){
this.set("value","");
}});
this.data.push({value:this._statics[1]});
this.data.push({value:"transparent"});
this.data.push({value:"black"});
this.data.push({value:"white"});
this.data.push({value:"red"});
this.data.push({value:"green"});
this.data.push({value:"blue"});
}else{
this.data.push({value:davinci.ve.widgets.ColorPicker.divider});
this.data.push({value:langObj.removeValue,run:function(){
this.set("value","");
}});
}
var _2d4c=[];
for(var i=0;i<this.data.length;i++){
_2d4c.push(this.data[i].value);
if(this.data[i].run){
this._run[this.data[i].value]=this.data[i].run;
}
}
this._store=new _2d39({values:_2d4c,noncolors:this._statics});
}else{
this._store=new _2d3a({values:_2d4a});
}
this._comboBox=new _2d3b({store:this._store,id:this._textFieldId,style:"width:100%;"});
_2d49.appendChild(this._comboBox.domNode);
this.domNode.appendChild(_2d44);
if(_2d47){
this.domNode.appendChild(_2d48);
dojo.connect(_2d48,"onclick",dojo.hitch(this,function(event){
dojo.stopEvent(event);
this._chooseColorValue();
}));
_2d48.appendChild(this._selectedColor);
this._colorPickerFlat_comboBoxUpdateDueTo="colorSwatch";
}
this.domNode.appendChild(_2d49);
if(typeof this.propname=="string"&&this._comboBox){
if(!davinci.ve._BackgroundWidgets){
davinci.ve._BackgroundWidgets={};
}
davinci.ve._BackgroundWidgets[this.propname]={propPaletteWidget:this,comboBox:this._comboBox};
}
this.inherited(arguments);
},startup:function(){
this.inherited(arguments);
this._button=dojo.byId(this._buttonId);
dojo.connect(this._button,"onclick",this,function(){
var _2d4d=(this._cascade&&this._cascade._widget&&this._cascade._widget.getContext)?this._cascade._widget.getContext():null;
var _2d4e=new _2d3c({context:_2d4d});
var _2d4f=dojo.hitch(this,function(_2d50){
if(!_2d4d){
console.error("Background.js. no context");
return;
}
var _2d51=_2d4d.cascadeBatch={};
var _2d52=0;
var _2d53=_2d51.propList=[];
var _2d54=_2d51.actions={};
var _2d55=_2d51.deferreds={};
_2d51.askUserResponse=undefined;
if(!_2d50.cancel){
var xref=davinci.ve._BackgroundWidgets;
for(var _2d56 in xref){
var o=xref[_2d56];
if(o.bgdWidget){
var _2d57=o.bgdWidget.get("value");
var _2d58=o.propPaletteWidget.get("value");
if(_2d57!==_2d58){
_2d53.push(_2d56);
_2d54[_2d56]=dojo.hitch(this,function(o,_2d59){
o.propPaletteWidget._comboBoxUpdateDueTo="backgroundDialog";
o.propPaletteWidget.set("value",_2d59);
},o,_2d57);
_2d55[_2d56]=new _2d36();
}
}
}
var _2d56="background-image";
var o=xref[_2d56];
var a=_2d40.buildBackgroundImage(_2d50.bgddata);
for(var i=0;i<a.length;i++){
var val=a[i];
if(_2d3e.containsUrl(val)&&!_2d3e.isAbsolute(val)){
var _2d5a=_2d3e.getUrl(val);
if(_2d5a){
var _2d5b=new Path(_2d5a);
var _2d5c=_2d5b.toString();
val="url('"+_2d5c+"')";
}
a[i]=val;
}
}
var _2d57;
if(a.length==0){
_2d57="";
}else{
_2d57=a[a.length-1];
}
var _2d58=o.propPaletteWidget.get("value");
if(_2d57!==_2d58){
if(o.propPaletteWidget._cascade){
o.propPaletteWidget._cascade._valueArrayNew=a;
}
_2d53.push(_2d56);
_2d54[_2d56]=dojo.hitch(this,function(i,_2d5d){
o.propPaletteWidget._comboBoxUpdateDueTo="backgroundDialog";
o.propPaletteWidget.set("value",_2d5d);
},o,_2d57);
_2d55[_2d56]=new _2d36();
}
for(var i=0;i<_2d53.length;i++){
var _2d56=_2d53[i];
var _2d5e=_2d55[_2d56];
_2d5e.then(dojo.hitch(this,function(_2d5f){
var _2d60=_2d53[_2d5f+1];
if(_2d60){
_2d54[_2d60].apply();
}else{
delete _2d4d.cascadeBatch;
}
},i));
}
if(_2d53.length>0){
var _2d56=_2d53[0];
_2d54[_2d56].apply();
}
}
return true;
},_2d4e);
var xref=davinci.ve._BackgroundWidgets;
for(var _2d61 in xref){
var o=xref[_2d61];
var _2d62=o.propPaletteWidget._cascade;
if(_2d62){
_2d62._valueArrayNew=_2d62._valueArray;
}
}
_2d4e.set("baseLocation",this._baseLocation);
_2d3d.showModal(_2d4e,"Background","",_2d4f);
});
this.connect(this._comboBox,"onChange",dojo.hitch(this,function(event){
if(event==davinci.ve.widgets.ColorPicker.divider||event==this.langObjVE.colorPicker){
this._comboBox.set("value",this.value);
}
var dueTo=this._comboBoxUpdateDueTo;
this._comboBoxUpdateDueTo=undefined;
if(dueTo=="setAttr"){
return;
}
this._onChange(event);
}));
this.connect(this._comboBox,"onFocus",dojo.hitch(this,function(event){
var xref=davinci.ve._BackgroundWidgets;
for(var _2d63 in xref){
var o=xref[_2d63];
var _2d64=o.propPaletteWidget._cascade;
if(_2d64){
_2d64._valueArrayNew=undefined;
}
}
var _2d65=(this._cascade&&this._cascade._widget&&this._cascade._widget.getContext)?this._cascade._widget.getContext():null;
if(_2d65){
delete _2d65.cascadeBatch;
}
}));
this._maqStartupComplete=true;
},_setBaseLocationAttr:function(_2d66){
this._baseLocation=_2d66;
},_setValueAttr:function(value){
var _2d67=this._comboBox.get("value");
var _2d68;
if(this._colorswatch){
dojo.style(this._selectedColor,"backgroundColor",value);
}
if(!dojo.isArray(value)){
_2d68=value;
}else{
if(value.length>0){
_2d68=value[value.length-1];
}else{
_2d68="";
}
}
if(_2d67!==_2d68){
if(this._comboBoxUpdateDueTo!=="backgroundDialog"&&this._comboBoxUpdateDueTo!=="colorSwatch"){
this._comboBoxUpdateDueTo="setAttr";
}
this._comboBox.set("value",_2d68);
}
},_onChange:function(event){
if(this._colorswatch&&typeof event=="string"){
if(event in this._run){
dojo.hitch(this,this._run[event])();
}else{
if(event==davinci.ve.widgets.ColorPicker.divider){
this._comboBox.set("value",this._store.getItemNumber(0));
}else{
dojo.style(this._selectedColor,"backgroundColor",event);
}
}
}
var value=this._comboBox.get("value");
this.value=value;
this.onChange(event);
},onChange:function(event){
},_getValueAttr:function(){
return this._comboBox.get("value");
},_setReadOnlyAttr:function(_2d69){
if(!this._maqStartupComplete){
return;
}
this._isReadOnly=_2d69;
this._comboBox.set("disabled",_2d69);
this._button.disabled=_2d69;
},_chooseColorValue:function(){
if(this._isReadOnly){
return;
}
var _2d6a=this._comboBox.get("value");
var _2d6b=this.isLeftToRight();
davinci.ve.widgets.ColorPickerFlat.show(this._colorPickerFlat,_2d6a,this,_2d6b);
}});
});
},"davinci/html/CSSModel":function(){
define({shorthand:[["border",["border-width","border-style","border-color","border-top","border-left","border-right","border-bottom"]],["border-width",["border-top-width","border-right-width","border-bottom-width","border-left-width"]],["border-style",["border-top-style","border-right-style","border-bottom-style","border-left-style"]],["border-color",["border-top-color","border-right-color","border-bottom-color","border-left-color"]],["border-bottom",["border-bottom-width","border-bottom-style","border-bottom-color"]],["border-top",["border-top-width","border-top-style","border-top-color"]],["border-left",["border-left-width","border-left-style","border-left-color"]],["border-right",["border-right-width","border-right-style","border-right-color"]],["font",["font-size","line-height","font-weight","font-style","font-family","line-height"]],["border-radius",["border-top-left-radius","border-top-right-radius","border-bottom-right-radius","border-bottom-left-radius"]],["-moz-border-radius",["-moz-border-radius-topleft","-moz-border-radius-topright","-moz-border-radius-bottomright","-moz-border-radius-bottomleft"]],["margin",["margin-top","margin-right","margin-bottom","margin-left"]],["padding",["padding-top","padding-right","padding-bottom","padding-left"]],["background",["background-color","background-image","background-repeat","background-position","background-attachment"]]]});
},"davinci/review/model/resource/Folder":function(){
define("davinci/review/model/resource/Folder",["dojo/_base/declare","davinci/model/resource/Resource","davinci/review/model/resource/File","dojo/_base/xhr","dojo/date/stamp"],function(_2d6c,_2d6d,_2d6e,xhr,stamp){
return _2d6c("davinci.review.model.resource.Folder",_2d6d,{isDraft:false,closed:false,width:0,height:0,constructor:function(proc){
dojo.mixin(this,proc);
this.elementType="ReviewVersion";
this.dueDate=this.dueDate=="infinite"?this.dueDate:stamp.fromISOString(this.dueDate);
},getChildrenSync:function(_2d6f,sync){
this.getChildren(_2d6f);
},getChildren:function(_2d70,_2d71){
if(this._isLoaded){
_2d70.call(null,this.children);
}else{
if(this._loading){
this._loading.then(function(){
_2d70.call(null,this.children);
}.bind(this),_2d71);
}else{
var _2d72=this.designerId||"";
this._loading=xhr.get({url:"cmd/listReviewFiles",handleAs:"json",content:{designer:_2d72,version:this.timeStamp}}).then(function(_2d73,_2d74){
this.children=_2d73.map(function(file){
return new _2d6e(file.path,this);
},this);
this._isLoaded=true;
_2d70.call(null,this.children);
delete this._loading;
}.bind(this),_2d71);
}
}
},getPath:function(){
if(this.parent){
return this.parent.getPath()+"/"+this.timeStamp;
}
return this.timeStamp;
}});
});
},"davinci/html/CSSEditorContext":function(){
define("davinci/html/CSSEditorContext",["dojo/_base/declare","davinci/html/CSSEditorWidget"],function(_2d75,_2d76){
return _2d75("davinci.html.CSSEditorContext",null,{constructor:function(_2d77){
this.editor=_2d77;
this.connects=[];
this.subscriptions=[];
this.subscriptions.push(dojo.subscribe("/davinci/ui/selectionChanged",this,this._selection));
},_selection:function(_2d78){
if(_2d78[0]&&_2d78[0].model){
var model=_2d78[0].model;
var _2d79;
if(model._edit_context){
return;
}
if(model.elementType.substring(0,3)=="CSS"){
var rule=model.getCSSRule();
var fire=rule!=this.selectedRule;
if(rule){
this.selectedWidget=new _2d76(this);
}else{
this.selectedWidget=null;
}
this.selectedRule=rule;
if(fire){
this.onSelectionChange();
}
}
}
},getSelection:function(){
if(this.selectedWidget){
return [this.selectedWidget];
}
return [];
},onSelectionChange:function(){
}});
});
},"davinci/actions/StickyNoteAction":function(){
define("davinci/actions/StickyNoteAction",["dojo/_base/declare","./Action","../Workbench","davinci/commands/CompoundCommand","../ve/commands/AddCommand","../ve/commands/MoveCommand","../ve/commands/ResizeCommand","../ve/widget","../ve/metadata"],function(_2d7a,_2d7b,_2d7c,_2d7d,_2d7e,_2d7f,_2d80,_2d81,_2d82){
return _2d7a("davinci.actions.StickyNoteAction",_2d7b,{run:function(_2d83){
var e=_2d7c.getOpenEditor();
var _2d84=davinci.ve.metadata.queryDescriptor("html.stickynote");
if(!_2d84){
return;
}
var data=dojo.clone(_2d84);
data.context=e.getContext();
if(e&&e.getContext){
var _2d85=undefined;
dojo.withDoc(e.getContext().getDocument(),function(){
_2d85=_2d81.createWidget(data);
});
if(!_2d85){
return;
}
var _2d86=new _2d7d();
var doc=e.getContext().getDocument();
var _2d87=doc.body;
var _2d88=e.getContext().getContainerNode();
_2d86.add(new _2d7e(_2d85,e.getContext().getContainerNode()));
_2d86.add(new _2d7f(_2d85,50,50));
if(_2d85.isLayoutContainer){
var w=args.size&&args.size.w,h=args.size&&args.size.h;
_2d86.add(new _2d80(_2d85,w,h));
}
e.getContext().getCommandStack().execute(_2d86);
_2d82.getSmartInput(_2d85.type).then(function(_2d89){
if(_2d89&&_2d89.displayOnCreate){
e.getContext().select(_2d85,null,true);
}else{
e.getContext().select(_2d85);
}
}.bind(this));
}
},isEnabled:function(_2d8a){
var e=_2d7c.getOpenEditor();
return (e&&e.getContext);
}});
});
},"url:dijit/templates/MenuBar.html":"<div class=\"dijitMenuBar dijitMenuPassive\" data-dojo-attach-point=\"containerNode\"  role=\"menubar\" tabIndex=\"${tabIndex}\" data-dojo-attach-event=\"onkeypress: _onKeyPress\"></div>\n","dojo/data/util/filter":function(){
define("dojo/data/util/filter",["../../_base/lang"],function(lang){
var _2d8b={};
lang.setObject("dojo.data.util.filter",_2d8b);
_2d8b.patternToRegExp=function(_2d8c,_2d8d){
var rxp="^";
var c=null;
for(var i=0;i<_2d8c.length;i++){
c=_2d8c.charAt(i);
switch(c){
case "\\":
rxp+=c;
i++;
rxp+=_2d8c.charAt(i);
break;
case "*":
rxp+=".*";
break;
case "?":
rxp+=".";
break;
case "$":
case "^":
case "/":
case "+":
case ".":
case "|":
case "(":
case ")":
case "{":
case "}":
case "[":
case "]":
rxp+="\\";
default:
rxp+=c;
}
}
rxp+="$";
if(_2d8d){
return new RegExp(rxp,"mi");
}else{
return new RegExp(rxp,"m");
}
};
return _2d8b;
});
},"dijit/form/Textarea":function(){
define("dijit/form/Textarea",["dojo/_base/declare","dojo/dom-style","./_ExpandingTextAreaMixin","./SimpleTextarea"],function(_2d8e,_2d8f,_2d90,_2d91){
return _2d8e("dijit.form.Textarea",[_2d91,_2d90],{baseClass:"dijitTextBox dijitTextArea dijitExpandingTextArea",cols:"",buildRendering:function(){
this.inherited(arguments);
_2d8f.set(this.textbox,{overflowY:"hidden",overflowX:"auto",boxSizing:"border-box",MsBoxSizing:"border-box",WebkitBoxSizing:"border-box",MozBoxSizing:"border-box"});
}});
});
},"dijit/tree/TreeStoreModel":function(){
define("dijit/tree/TreeStoreModel",["dojo/_base/array","dojo/aspect","dojo/_base/declare","dojo/_base/lang"],function(array,_2d92,_2d93,lang){
return _2d93("dijit.tree.TreeStoreModel",null,{store:null,childrenAttrs:["children"],newItemIdAttr:"id",labelAttr:"",root:null,query:null,deferItemLoadingUntilExpand:false,constructor:function(args){
lang.mixin(this,args);
this.connects=[];
var store=this.store;
if(!store.getFeatures()["dojo.data.api.Identity"]){
throw new Error("dijit.tree.TreeStoreModel: store must support dojo.data.Identity");
}
if(store.getFeatures()["dojo.data.api.Notification"]){
this.connects=this.connects.concat([_2d92.after(store,"onNew",lang.hitch(this,"onNewItem"),true),_2d92.after(store,"onDelete",lang.hitch(this,"onDeleteItem"),true),_2d92.after(store,"onSet",lang.hitch(this,"onSetItem"),true)]);
}
},destroy:function(){
var h;
while(h=this.connects.pop()){
h.remove();
}
},getRoot:function(_2d94,_2d95){
if(this.root){
_2d94(this.root);
}else{
this.store.fetch({query:this.query,onComplete:lang.hitch(this,function(items){
if(items.length!=1){
throw new Error("dijit.tree.TreeStoreModel: root query returned "+items.length+" items, but must return exactly one");
}
this.root=items[0];
_2d94(this.root);
}),onError:_2d95});
}
},mayHaveChildren:function(item){
return array.some(this.childrenAttrs,function(attr){
return this.store.hasAttribute(item,attr);
},this);
},getChildren:function(_2d96,_2d97,_2d98){
var store=this.store;
if(!store.isItemLoaded(_2d96)){
var _2d99=lang.hitch(this,arguments.callee);
store.loadItem({item:_2d96,onItem:function(_2d9a){
_2d99(_2d9a,_2d97,_2d98);
},onError:_2d98});
return;
}
var _2d9b=[];
for(var i=0;i<this.childrenAttrs.length;i++){
var vals=store.getValues(_2d96,this.childrenAttrs[i]);
_2d9b=_2d9b.concat(vals);
}
var _2d9c=0;
if(!this.deferItemLoadingUntilExpand){
array.forEach(_2d9b,function(item){
if(!store.isItemLoaded(item)){
_2d9c++;
}
});
}
if(_2d9c==0){
_2d97(_2d9b);
}else{
array.forEach(_2d9b,function(item,idx){
if(!store.isItemLoaded(item)){
store.loadItem({item:item,onItem:function(item){
_2d9b[idx]=item;
if(--_2d9c==0){
_2d97(_2d9b);
}
},onError:_2d98});
}
});
}
},isItem:function(_2d9d){
return this.store.isItem(_2d9d);
},fetchItemByIdentity:function(_2d9e){
this.store.fetchItemByIdentity(_2d9e);
},getIdentity:function(item){
return this.store.getIdentity(item);
},getLabel:function(item){
if(this.labelAttr){
return this.store.getValue(item,this.labelAttr);
}else{
return this.store.getLabel(item);
}
},newItem:function(args,_2d9f,_2da0){
var pInfo={parent:_2d9f,attribute:this.childrenAttrs[0]},_2da1;
if(this.newItemIdAttr&&args[this.newItemIdAttr]){
this.fetchItemByIdentity({identity:args[this.newItemIdAttr],scope:this,onItem:function(item){
if(item){
this.pasteItem(item,null,_2d9f,true,_2da0);
}else{
_2da1=this.store.newItem(args,pInfo);
if(_2da1&&(_2da0!=undefined)){
this.pasteItem(_2da1,_2d9f,_2d9f,false,_2da0);
}
}
}});
}else{
_2da1=this.store.newItem(args,pInfo);
if(_2da1&&(_2da0!=undefined)){
this.pasteItem(_2da1,_2d9f,_2d9f,false,_2da0);
}
}
},pasteItem:function(_2da2,_2da3,_2da4,bCopy,_2da5){
var store=this.store,_2da6=this.childrenAttrs[0];
if(_2da3){
array.forEach(this.childrenAttrs,function(attr){
if(store.containsValue(_2da3,attr,_2da2)){
if(!bCopy){
var _2da7=array.filter(store.getValues(_2da3,attr),function(x){
return x!=_2da2;
});
store.setValues(_2da3,attr,_2da7);
}
_2da6=attr;
}
});
}
if(_2da4){
if(typeof _2da5=="number"){
var _2da8=store.getValues(_2da4,_2da6).slice();
_2da8.splice(_2da5,0,_2da2);
store.setValues(_2da4,_2da6,_2da8);
}else{
store.setValues(_2da4,_2da6,store.getValues(_2da4,_2da6).concat(_2da2));
}
}
},onChange:function(){
},onChildrenChange:function(){
},onDelete:function(){
},onNewItem:function(item,_2da9){
if(!_2da9){
return;
}
this.getChildren(_2da9.item,lang.hitch(this,function(_2daa){
this.onChildrenChange(_2da9.item,_2daa);
}));
},onDeleteItem:function(item){
this.onDelete(item);
},onSetItem:function(item,_2dab){
if(array.indexOf(this.childrenAttrs,_2dab)!=-1){
this.getChildren(item,lang.hitch(this,function(_2dac){
this.onChildrenChange(item,_2dac);
}));
}else{
this.onChange(item);
}
}});
});
},"davinci/ve/Snap":function(){
define("davinci/ve/Snap",["davinci/ve/utils/GeomUtils"],function(_2dad){
dojo.getObject("davinci.ve.Snap",true);
return davinci.ve.Snap={updateSnapLinesBeforeTraversal:function(_2dae,rect){
_2dae._snapX=null;
_2dae._snapY=null;
if(_2dae._lastSnapBox){
if(_2dae._lastSnapBox.l==rect.l&&_2dae._lastSnapBox.t==rect.t&&_2dae._lastSnapBox.w==rect.w&&_2dae._lastSnapBox.h==rect.h){
return false;
}
}
snapBox={l:rect.l,t:rect.t,w:rect.w,h:rect.h,c:rect.l+rect.w/2,r:rect.l+rect.w,m:rect.t+rect.h/2,b:rect.t+rect.h};
_2dae._lastSnapBox=snapBox;
return true;
},findSnapOpportunities:function(_2daf,_2db0,_2db1,_2db2,_2db3){
var _2db4=75;
var _2db5=_2daf._lastSnapBox;
var node=_2db0.domNode;
if(node.tagName=="BODY"){
return;
}
var _2db6=null;
var _2db7=_2db0.getHelper();
if(_2db7&&_2db7.getMarginBoxPageCoords){
_2db6=_2db7.getMarginBoxPageCoords(_2db0);
}else{
_2db6=_2dad.getMarginBoxPageCoordsCached(node);
}
_2db6.x=_2db6.l;
_2db6.y=_2db6.t;
var _2db8=5;
var _2db9=_2daf._snapX?_2daf._snapX.delta:_2db8+1;
var _2dba=_2daf._snapY?_2daf._snapY.delta:_2db8+1;
var _2dbb={snapRect:{l:_2db6.x,c:_2db6.x+(_2db6.w/2),r:_2db6.x+_2db6.w,t:_2db6.y,m:_2db6.y+(_2db6.h/2),b:_2db6.y+_2db6.h}};
if(_2db7&&_2db7.getSnapInfo){
_2dbb=_2db7.getSnapInfo(_2db0,_2dbb);
}
function snapX(_2dbc,_2dbd,x,delta){
if(delta<_2db9){
_2daf._snapX={type:_2dbc,typeRefObj:_2dbc,typeCurrObj:_2dbd,x:x,widget:_2db0,delta:delta};
_2db9=delta;
_2daf._snapXLast=_2daf._snapX;
}
};
function snapY(_2dbe,_2dbf,y,delta){
if(delta<_2dba){
_2daf._snapY={type:_2dbe,typeRefObj:_2dbe,typeCurrObj:_2dbf,y:y,widget:_2db0,delta:delta};
_2dba=delta;
_2daf._snapYLast=_2daf._snapY;
}
};
var rect=_2dbb.snapRect;
var _2dc0,_2dc1,_2dc2,_2dc3,_2dc4,_2dc5,delta;
if(rect){
if(_2db2){
var _2dc6=(_2daf._snapXLast&&_2daf._snapXLast.widget===_2db0)?Infinity:_2db4;
var _2dc7=Math.abs(rect.t-_2db5.t);
var _2dc8=Math.abs(rect.t-_2db5.b);
var _2dc9=Math.abs(rect.b-_2db5.t);
var _2dca=Math.abs(rect.b-_2db5.b);
if(_2dc7<=_2dc6||_2dc8<=_2dc6||_2dc9<=_2dc6||_2dca<=_2dc6){
_2dc0=Math.abs(rect.l-_2db5.l);
_2dc1=Math.abs(rect.c-_2db5.c);
_2dc2=Math.abs(rect.r-_2db5.r);
snapX("left","left",rect.l,_2dc0);
snapX("center","center",rect.c,_2dc1);
snapX("right","right",rect.r,_2dc2);
snapX("left","center",rect.c,Math.abs(rect.c-_2db5.l));
snapX("left","right",rect.r,Math.abs(rect.r-_2db5.l));
snapX("right","left",rect.l,Math.abs(rect.l-_2db5.r));
snapX("right","center",rect.c,Math.abs(rect.c-_2db5.r));
snapX("center","left",rect.l,Math.abs(rect.l-_2db5.c));
snapX("center","right",rect.r,Math.abs(rect.r-_2db5.c));
}
}
if(_2db3){
var _2dcb=(_2daf._snapYLast&&_2daf._snapYLast.widget===_2db0)?Infinity:_2db4;
var _2dcc=Math.abs(rect.l-_2db5.l);
var _2dcd=Math.abs(rect.l-_2db5.r);
var _2dce=Math.abs(rect.r-_2db5.l);
var _2dcf=Math.abs(rect.r-_2db5.r);
if(_2dcc<=_2dcb||_2dcd<=_2dcb||_2dce<=_2dcb||_2dcf<=_2dcb){
_2dc3=Math.abs(rect.t-_2db5.t);
_2dc4=Math.abs(rect.m-_2db5.m);
_2dc5=Math.abs(rect.b-_2db5.b);
snapY("top","top",rect.t,_2dc3);
snapY("middle","middle",rect.m,_2dc4);
snapY("bottom","bottom",rect.b,_2dc5);
snapY("top","middle",rect.m,Math.abs(rect.m-_2db5.t));
snapY("top","bottom",rect.b,Math.abs(rect.b-_2db5.t));
snapY("bottom","top",rect.t,Math.abs(rect.t-_2db5.b));
snapY("bottom","middle",rect.m,Math.abs(rect.m-_2db5.b));
snapY("middle","top",rect.t,Math.abs(rect.t-_2db5.m));
snapY("middle","bottom",rect.b,Math.abs(rect.b-_2db5.m));
}
}
}
var _2dd0=_2dbb.snapPoints;
if(_2dd0){
for(var i=0;i<_2dd0.length;i++){
var p=_2dd0[i];
_2dc0=Math.abs(p.x-_2db5.l);
_2dc1=Math.abs(p.x-_2db5.c);
_2dc2=Math.abs(p.x-_2db5.r);
snapX("point",p.x,_2dc0);
snapX("point",p.x,_2dc1);
snapX("point",p.x,_2dc2);
_2dc3=Math.abs(p.y-_2db5.t);
_2dc4=Math.abs(p.y-_2db5.m);
_2dc5=Math.abs(p.y-_2db5.b);
snapY("point",p.y,_2dc3);
snapY("point",p.y,_2dc4);
snapY("point",p.y,_2dc5);
}
}
},updateSnapLinesAfterTraversal:function(_2dd1){
var _2dd2=_2dd1.getContainerNode();
if(!_2dd1._snapLinesDiv){
_2dd1._snapLinesDiv=dojo.create("div",{"class":"snaplines",style:"position:absolute;top:0px;left:0px;z-index:1000001;pointer-events:none;"},_2dd2);
_2dd1._snapLinesDivWidgetX=dojo.create("div",{"class":"snaplinesWidgetX",style:"position:absolute;pointer-events:none;"},_2dd1._snapLinesDiv);
_2dd1._snapLinesDivAlignX=dojo.create("div",{"class":"snaplinesAlignX",style:"position:absolute;pointer-events:none;"},_2dd1._snapLinesDiv);
_2dd1._snapLinesDivWidgetY=dojo.create("div",{"class":"snaplinesWidgetY",style:"position:absolute;pointer-events:none;"},_2dd1._snapLinesDiv);
_2dd1._snapLinesDivAlignY=dojo.create("div",{"class":"snaplinesAlignY",style:"position:absolute;pointer-events:none;"},_2dd1._snapLinesDiv);
}
_2dd1._snapLinesDiv.style.display="block";
var box;
function _2dd3(_2dd4,_2dd5,_2dd6,_2dd7){
_2dd6.style.display="block";
_2dd7.style.display="block";
var _2dd8=_2dd5.getHelper();
if(_2dd8&&_2dd8.getMarginBoxPageCoords){
box=_2dd8.getMarginBoxPageCoords(_2dd5);
}else{
box=_2dad.getMarginBoxPageCoordsCached(_2dd5.domNode);
}
box.x=box.l;
box.y=box.t;
box.r=box.x+box.w;
box.b=box.y+box.h;
box.c=box.x+box.w/2;
box.m=box.y+box.h/2;
_2dd6.style.left=box.x+"px";
_2dd6.style.top=box.y+"px";
_2dd6.style.width=box.w+"px";
_2dd6.style.height=box.h+"px";
_2dd6.style.backgroundColor="rgba(255,0,255,.05)";
};
var _2dd9=_2dd1._snapLinesDivAlignX.style;
var _2dda=_2dd1._snapLinesDivWidgetX.style;
if(_2dd1._snapX){
var snapX=_2dd1._snapX;
_2dd3(_2dd1,snapX.widget,_2dd1._snapLinesDivWidgetX,_2dd1._snapLinesDivAlignX);
var t,h;
if(box.y<snapBox.t){
t=box.y;
h=snapBox.t-box.y;
}else{
t=snapBox.t;
h=box.y-snapBox.t;
}
if(snapX.typeCurrObj=="point"){
_2dd9.left=_2dd1._snapX.x+"px";
}else{
if(snapX.typeCurrObj=="left"){
_2dd9.left=box.x+"px";
}else{
if(snapX.typeCurrObj=="center"){
_2dd9.left=box.c+"px";
}else{
_2dd9.left=box.r+"px";
}
}
}
_2dd9.top=t+"px";
_2dd9.width="1px";
_2dd9.height=h+"px";
_2dd9.backgroundColor="rgba(255,0,255,.75)";
}else{
_2dd9.display="none";
_2dda.display="none";
}
var _2dd9=_2dd1._snapLinesDivAlignY.style;
var _2dda=_2dd1._snapLinesDivWidgetY.style;
if(_2dd1._snapY){
var snapY=_2dd1._snapY;
_2dd3(_2dd1,snapY.widget,_2dd1._snapLinesDivWidgetY,_2dd1._snapLinesDivAlignY);
var l,w;
if(box.x<snapBox.l){
l=box.x;
w=snapBox.l-box.x;
}else{
l=snapBox.l;
w=box.x-snapBox.l;
}
if(snapY.type=="point"){
_2dd9.top=snapY.y+"px";
}else{
if(snapY.typeCurrObj=="top"){
_2dd9.top=box.y+"px";
}else{
if(snapY.typeCurrObj=="middle"){
_2dd9.top=box.m+"px";
}else{
_2dd9.top=box.b+"px";
}
}
}
_2dd9.left=l+"px";
_2dd9.height="1px";
_2dd9.width=w+"px";
_2dd9.backgroundColor="rgba(255,0,255,.75)";
}else{
_2dd9.display="none";
_2dda.display="none";
}
},clearSnapLines:function(_2ddb){
if(_2ddb._snapLinesDiv){
_2ddb._snapLinesDiv.style.display="none";
}
_2ddb._snapX=_2ddb._snapY=null;
}};
});
},"dijit/tree/_dndSelector":function(){
define("dijit/tree/_dndSelector",["dojo/_base/array","dojo/_base/connect","dojo/_base/declare","dojo/_base/Deferred","dojo/_base/kernel","dojo/_base/lang","dojo/cookie","dojo/mouse","dojo/on","dojo/touch","./_dndContainer"],function(array,_2ddc,_2ddd,_2dde,_2ddf,lang,_2de0,mouse,on,touch,_2de1){
return _2ddd("dijit.tree._dndSelector",_2de1,{constructor:function(){
this.selection={};
this.anchor=null;
if(!this.cookieName&&this.tree.id){
this.cookieName=this.tree.id+"SaveSelectedCookie";
}
this.events.push(on(this.tree.domNode,touch.press,lang.hitch(this,"onMouseDown")),on(this.tree.domNode,touch.release,lang.hitch(this,"onMouseUp")),on(this.tree.domNode,touch.move,lang.hitch(this,"onMouseMove")));
},singular:false,getSelectedTreeNodes:function(){
var nodes=[],sel=this.selection;
for(var i in sel){
nodes.push(sel[i]);
}
return nodes;
},selectNone:function(){
this.setSelection([]);
return this;
},destroy:function(){
this.inherited(arguments);
this.selection=this.anchor=null;
},addTreeNode:function(node,_2de2){
this.setSelection(this.getSelectedTreeNodes().concat([node]));
if(_2de2){
this.anchor=node;
}
return node;
},removeTreeNode:function(node){
this.setSelection(this._setDifference(this.getSelectedTreeNodes(),[node]));
return node;
},isTreeNodeSelected:function(node){
return node.id&&!!this.selection[node.id];
},setSelection:function(_2de3){
var _2de4=this.getSelectedTreeNodes();
array.forEach(this._setDifference(_2de4,_2de3),lang.hitch(this,function(node){
node.setSelected(false);
if(this.anchor==node){
delete this.anchor;
}
delete this.selection[node.id];
}));
array.forEach(this._setDifference(_2de3,_2de4),lang.hitch(this,function(node){
node.setSelected(true);
this.selection[node.id]=node;
}));
this._updateSelectionProperties();
},_setDifference:function(xs,ys){
array.forEach(ys,function(y){
y.__exclude__=true;
});
var ret=array.filter(xs,function(x){
return !x.__exclude__;
});
array.forEach(ys,function(y){
delete y["__exclude__"];
});
return ret;
},_updateSelectionProperties:function(){
var _2de5=this.getSelectedTreeNodes();
var paths=[],nodes=[],_2de6=[];
array.forEach(_2de5,function(node){
var ary=node.getTreePath(),model=this.tree.model;
nodes.push(node);
paths.push(ary);
ary=array.map(ary,function(item){
return model.getIdentity(item);
},this);
_2de6.push(ary.join("/"));
},this);
var items=array.map(nodes,function(node){
return node.item;
});
this.tree._set("paths",paths);
this.tree._set("path",paths[0]||[]);
this.tree._set("selectedNodes",nodes);
this.tree._set("selectedNode",nodes[0]||null);
this.tree._set("selectedItems",items);
this.tree._set("selectedItem",items[0]||null);
if(this.tree.persist&&_2de6.length>0){
_2de0(this.cookieName,_2de6.join(","),{expires:365});
}
},_getSavedPaths:function(){
var tree=this.tree;
if(tree.persist&&tree.dndController.cookieName){
var oreo,paths=[];
oreo=_2de0(tree.dndController.cookieName);
if(oreo){
paths=array.map(oreo.split(","),function(path){
return path.split("/");
});
}
return paths;
}
},onMouseDown:function(e){
if(!this.current||this.tree.isExpandoNode(e.target,this.current)){
return;
}
if(e.type!="touchstart"&&!mouse.isLeft(e)){
return;
}
e.preventDefault();
var _2de7=this.current,copy=_2ddc.isCopyKey(e),id=_2de7.id;
if(!this.singular&&!e.shiftKey&&this.selection[id]){
this._doDeselect=true;
return;
}else{
this._doDeselect=false;
}
this.userSelect(_2de7,copy,e.shiftKey);
},onMouseUp:function(e){
if(!this._doDeselect){
return;
}
this._doDeselect=false;
this.userSelect(this.current,_2ddc.isCopyKey(e),e.shiftKey);
},onMouseMove:function(){
this._doDeselect=false;
},_compareNodes:function(n1,n2){
if(n1===n2){
return 0;
}
if("sourceIndex" in document.documentElement){
return n1.sourceIndex-n2.sourceIndex;
}else{
if("compareDocumentPosition" in document.documentElement){
return n1.compareDocumentPosition(n2)&2?1:-1;
}else{
if(document.createRange){
var r1=doc.createRange();
r1.setStartBefore(n1);
var r2=doc.createRange();
r2.setStartBefore(n2);
return r1.compareBoundaryPoints(r1.END_TO_END,r2);
}else{
throw Error("dijit.tree._compareNodes don't know how to compare two different nodes in this browser");
}
}
}
},userSelect:function(node,multi,range){
if(this.singular){
if(this.anchor==node&&multi){
this.selectNone();
}else{
this.setSelection([node]);
this.anchor=node;
}
}else{
if(range&&this.anchor){
var cr=this._compareNodes(this.anchor.rowNode,node.rowNode),begin,end,_2de8=this.anchor;
if(cr<0){
begin=_2de8;
end=node;
}else{
begin=node;
end=_2de8;
}
var nodes=[];
while(begin!=end){
nodes.push(begin);
begin=this.tree._getNextNode(begin);
}
nodes.push(end);
this.setSelection(nodes);
}else{
if(this.selection[node.id]&&multi){
this.removeTreeNode(node);
}else{
if(multi){
this.addTreeNode(node,true);
}else{
this.setSelection([node]);
this.anchor=node;
}
}
}
}
},getItem:function(key){
var _2de9=this.selection[key];
return {data:_2de9,type:["treeNode"]};
},forInSelectedItems:function(f,o){
o=o||_2ddf.global;
for(var id in this.selection){
f.call(o,this.getItem(id),id,this);
}
}});
});
},"dojox/grid/_Layout":function(){
define("dojox/grid/_Layout",["dojo/_base/kernel","../main","dojo/_base/declare","dojo/_base/array","dojo/_base/lang","dojo/dom-geometry","./cells","./_RowSelector"],function(dojo,dojox,_2dea,array,lang,_2deb){
return _2dea("dojox.grid._Layout",null,{constructor:function(_2dec){
this.grid=_2dec;
},cells:[],structure:null,defaultWidth:"6em",moveColumn:function(_2ded,_2dee,_2def,_2df0,_2df1){
var _2df2=this.structure[_2ded].cells[0];
var _2df3=this.structure[_2dee].cells[0];
var cell=null;
var _2df4=0;
var _2df5=0;
for(var i=0,c;c=_2df2[i];i++){
if(c.index==_2def){
_2df4=i;
break;
}
}
cell=_2df2.splice(_2df4,1)[0];
cell.view=this.grid.views.views[_2dee];
for(i=0,c=null;c=_2df3[i];i++){
if(c.index==_2df0){
_2df5=i;
break;
}
}
if(!_2df1){
_2df5+=1;
}
_2df3.splice(_2df5,0,cell);
var _2df6=this.grid.getCell(this.grid.getSortIndex());
if(_2df6){
_2df6._currentlySorted=this.grid.getSortAsc();
}
this.cells=[];
_2def=0;
var v;
for(i=0;v=this.structure[i];i++){
for(var j=0,cs;cs=v.cells[j];j++){
for(var k=0;c=cs[k];k++){
c.index=_2def;
this.cells.push(c);
if("_currentlySorted" in c){
var si=_2def+1;
si*=c._currentlySorted?1:-1;
this.grid.sortInfo=si;
delete c._currentlySorted;
}
_2def++;
}
}
}
array.forEach(this.cells,function(c){
var marks=c.markup[2].split(" ");
var _2df7=parseInt(marks[1].substring(5));
if(_2df7!=c.index){
marks[1]="idx=\""+c.index+"\"";
c.markup[2]=marks.join(" ");
}
});
this.grid.setupHeaderMenu();
},setColumnVisibility:function(_2df8,_2df9){
var cell=this.cells[_2df8];
if(cell.hidden==_2df9){
cell.hidden=!_2df9;
var v=cell.view,w=v.viewWidth;
if(w&&w!="auto"){
v._togglingColumn=_2deb.getMarginBox(cell.getHeaderNode()).w||0;
}
v.update();
return true;
}else{
return false;
}
},addCellDef:function(_2dfa,_2dfb,inDef){
var self=this;
var _2dfc=function(inDef){
var w=0;
if(inDef.colSpan>1){
w=0;
}else{
w=inDef.width||self._defaultCellProps.width||self.defaultWidth;
if(!isNaN(w)){
w=w+"em";
}
}
return w;
};
var props={grid:this.grid,subrow:_2dfa,layoutIndex:_2dfb,index:this.cells.length};
if(inDef&&inDef instanceof dojox.grid.cells._Base){
var _2dfd=lang.clone(inDef);
props.unitWidth=_2dfc(_2dfd._props);
_2dfd=lang.mixin(_2dfd,this._defaultCellProps,inDef._props,props);
return _2dfd;
}
var _2dfe=inDef.type||inDef.cellType||this._defaultCellProps.type||this._defaultCellProps.cellType||dojox.grid.cells.Cell;
if(lang.isString(_2dfe)){
_2dfe=lang.getObject(_2dfe);
}
props.unitWidth=_2dfc(inDef);
return new _2dfe(lang.mixin({},this._defaultCellProps,inDef,props));
},addRowDef:function(_2dff,inDef){
var _2e00=[];
var _2e01=0,_2e02=0,doRel=true;
for(var i=0,def,cell;(def=inDef[i]);i++){
cell=this.addCellDef(_2dff,i,def);
_2e00.push(cell);
this.cells.push(cell);
if(doRel&&cell.relWidth){
_2e01+=cell.relWidth;
}else{
if(cell.width){
var w=cell.width;
if(typeof w=="string"&&w.slice(-1)=="%"){
_2e02+=window.parseInt(w,10);
}else{
if(w=="auto"){
doRel=false;
}
}
}
}
}
if(_2e01&&doRel){
array.forEach(_2e00,function(cell){
if(cell.relWidth){
cell.width=cell.unitWidth=((cell.relWidth/_2e01)*(100-_2e02))+"%";
}
});
}
return _2e00;
},addRowsDef:function(inDef){
var _2e03=[];
if(lang.isArray(inDef)){
if(lang.isArray(inDef[0])){
for(var i=0,row;inDef&&(row=inDef[i]);i++){
_2e03.push(this.addRowDef(i,row));
}
}else{
_2e03.push(this.addRowDef(0,inDef));
}
}
return _2e03;
},addViewDef:function(inDef){
this._defaultCellProps=inDef.defaultCell||{};
if(inDef.width&&inDef.width=="auto"){
delete inDef.width;
}
return lang.mixin({},inDef,{cells:this.addRowsDef(inDef.rows||inDef.cells)});
},setStructure:function(_2e04){
this.fieldIndex=0;
this.cells=[];
var s=this.structure=[];
if(this.grid.rowSelector){
var sel={type:dojox._scopeName+".grid._RowSelector"};
if(lang.isString(this.grid.rowSelector)){
var width=this.grid.rowSelector;
if(width=="false"){
sel=null;
}else{
if(width!="true"){
sel["width"]=width;
}
}
}else{
if(!this.grid.rowSelector){
sel=null;
}
}
if(sel){
s.push(this.addViewDef(sel));
}
}
var _2e05=function(def){
return ("name" in def||"field" in def||"get" in def);
};
var _2e06=function(def){
if(lang.isArray(def)){
if(lang.isArray(def[0])||_2e05(def[0])){
return true;
}
}
return false;
};
var _2e07=function(def){
return (def!==null&&lang.isObject(def)&&("cells" in def||"rows" in def||("type" in def&&!_2e05(def))));
};
if(lang.isArray(_2e04)){
var _2e08=false;
for(var i=0,st;(st=_2e04[i]);i++){
if(_2e07(st)){
_2e08=true;
break;
}
}
if(!_2e08){
s.push(this.addViewDef({cells:_2e04}));
}else{
for(i=0;(st=_2e04[i]);i++){
if(_2e06(st)){
s.push(this.addViewDef({cells:st}));
}else{
if(_2e07(st)){
s.push(this.addViewDef(st));
}
}
}
}
}else{
if(_2e07(_2e04)){
s.push(this.addViewDef(_2e04));
}
}
this.cellCount=this.cells.length;
this.grid.setupHeaderMenu();
}});
});
},"dijit/form/RadioButton":function(){
define("dijit/form/RadioButton",["dojo/_base/declare","./CheckBox","./_RadioButtonMixin"],function(_2e09,_2e0a,_2e0b){
return _2e09("dijit.form.RadioButton",[_2e0a,_2e0b],{baseClass:"dijitRadio"});
});
},"url:davinci/ui/widgets/templates/TreeNode.html":"<div class=\"dijitTreeNode\" role=\"presentation\"\n\t><div data-dojo-attach-point=\"toggleNode\" class=\"dijitInline dvOutlineToggleNode dvOutlineVisibility dvOutlineVisibilityOn\" dojoAttachEvent=\"onclick:_onToggleClick\"></div\n\t><div data-dojo-attach-point=\"rowNode\" class=\"dijitTreeRow dijitInline\" role=\"presentation\"\n\t\t><div data-dojo-attach-point=\"indentNode\" class=\"dijitInline\"></div\n\t\t><img src=\"${_blankGif}\" alt=\"\" data-dojo-attach-point=\"expandoNode\" class=\"dijitTreeExpando\" role=\"presentation\"\n\t\t><span data-dojo-attach-point=\"expandoNodeText\" class=\"dijitExpandoText\" role=\"presentation\"\n\t\t></span\n\t\t><span data-dojo-attach-point=\"contentNode\"\n\t\t\tclass=\"dijitTreeContent\" role=\"presentation\">\n\t\t\t<img src=\"${_blankGif}\" alt=\"\" data-dojo-attach-point=\"iconNode\" class=\"dijitIcon dijitTreeIcon\" role=\"presentation\"\n\t\t\t/><img src=\"${_blankGif}\" alt=\"\" class=\"treeReadOnlyLabelNode\" role=\"presentation\"\n\t\t\t/><span data-dojo-attach-point=\"labelNode\" class=\"dijitTreeLabel\" role=\"treeitem\" tabindex=\"-1\" aria-selected=\"false\"></span>\n\t\t</span\n\t></div>\n\t<div data-dojo-attach-point=\"containerNode\" class=\"dijitTreeContainer\" role=\"presentation\" style=\"display: none;\"></div>\n</div>\n","davinci/js/ui/JavaScriptEditor":function(){
define(["dojo/_base/declare","davinci/js/ui/JavaScriptOutline","davinci/model/Factory","davinci/ui/ModelEditor"],function(_2e0c,_2e0d,_2e0e,_2e0f){
return _2e0c(_2e0f,{constructor:function(_2e10){
this.jsFile=_2e0e.newJS();
this.model=this.jsFile;
},getOutline:function(){
if(!this.outline){
this.outline=new _2e0d(this.model);
}
return this.outline;
},getDefaultContent:function(){
return "function functionName ()\n{\n}\n";
}});
});
},"dijit/form/ValidationTextBox":function(){
require({cache:{"url:dijit/form/templates/ValidationTextBox.html":"<div class=\"dijit dijitReset dijitInline dijitLeft\"\n\tid=\"widget_${id}\" role=\"presentation\"\n\t><div class='dijitReset dijitValidationContainer'\n\t\t><input class=\"dijitReset dijitInputField dijitValidationIcon dijitValidationInner\" value=\"&#935; \" type=\"text\" tabIndex=\"-1\" readonly=\"readonly\" role=\"presentation\"\n\t/></div\n\t><div class=\"dijitReset dijitInputField dijitInputContainer\"\n\t\t><input class=\"dijitReset dijitInputInner\" data-dojo-attach-point='textbox,focusNode' autocomplete=\"off\"\n\t\t\t${!nameAttrSetting} type='${type}'\n\t/></div\n></div>\n"}});
define("dijit/form/ValidationTextBox",["dojo/_base/declare","dojo/_base/kernel","dojo/i18n","./TextBox","../Tooltip","dojo/text!./templates/ValidationTextBox.html","dojo/i18n!./nls/validate"],function(_2e11,_2e12,i18n,_2e13,_2e14,_2e15){
var _2e16;
return _2e16=_2e11("dijit.form.ValidationTextBox",_2e13,{templateString:_2e15,required:false,promptMessage:"",invalidMessage:"$_unset_$",missingMessage:"$_unset_$",message:"",constraints:{},pattern:".*",regExp:"",regExpGen:function(){
},state:"",tooltipPosition:[],_deprecateRegExp:function(attr,value){
if(value!=_2e16.prototype[attr]){
_2e12.deprecated("ValidationTextBox id="+this.id+", set('"+attr+"', ...) is deprecated.  Use set('pattern', ...) instead.","","2.0");
this.set("pattern",value);
}
},_setRegExpGenAttr:function(_2e17){
this._deprecateRegExp("regExpGen",_2e17);
this.regExpGen=this._getPatternAttr;
},_setRegExpAttr:function(value){
this._deprecateRegExp("regExp",value);
},_setValueAttr:function(){
this.inherited(arguments);
this.validate(this.focused);
},validator:function(value,_2e18){
return (new RegExp("^(?:"+this._getPatternAttr(_2e18)+")"+(this.required?"":"?")+"$")).test(value)&&(!this.required||!this._isEmpty(value))&&(this._isEmpty(value)||this.parse(value,_2e18)!==undefined);
},_isValidSubset:function(){
return this.textbox.value.search(this._partialre)==0;
},isValid:function(){
return this.validator(this.textbox.value,this.constraints);
},_isEmpty:function(value){
return (this.trim?/^\s*$/:/^$/).test(value);
},getErrorMessage:function(){
var _2e19=this.invalidMessage=="$_unset_$"?this.messages.invalidMessage:!this.invalidMessage?this.promptMessage:this.invalidMessage;
var _2e1a=this.missingMessage=="$_unset_$"?this.messages.missingMessage:!this.missingMessage?_2e19:this.missingMessage;
return (this.required&&this._isEmpty(this.textbox.value))?_2e1a:_2e19;
},getPromptMessage:function(){
return this.promptMessage;
},_maskValidSubsetError:true,validate:function(_2e1b){
var _2e1c="";
var _2e1d=this.disabled||this.isValid(_2e1b);
if(_2e1d){
this._maskValidSubsetError=true;
}
var _2e1e=this._isEmpty(this.textbox.value);
var _2e1f=!_2e1d&&_2e1b&&this._isValidSubset();
this._set("state",_2e1d?"":(((((!this._hasBeenBlurred||_2e1b)&&_2e1e)||_2e1f)&&this._maskValidSubsetError)?"Incomplete":"Error"));
this.focusNode.setAttribute("aria-invalid",_2e1d?"false":"true");
if(this.state=="Error"){
this._maskValidSubsetError=_2e1b&&_2e1f;
_2e1c=this.getErrorMessage(_2e1b);
}else{
if(this.state=="Incomplete"){
_2e1c=this.getPromptMessage(_2e1b);
this._maskValidSubsetError=!this._hasBeenBlurred||_2e1b;
}else{
if(_2e1e){
_2e1c=this.getPromptMessage(_2e1b);
}
}
}
this.set("message",_2e1c);
return _2e1d;
},displayMessage:function(_2e20){
if(_2e20&&this.focused){
_2e14.show(_2e20,this.domNode,this.tooltipPosition,!this.isLeftToRight());
}else{
_2e14.hide(this.domNode);
}
},_refreshState:function(){
if(this._created){
this.validate(this.focused);
}
this.inherited(arguments);
},constructor:function(_2e21){
this.constraints={};
this.baseClass+=" dijitValidationTextBox";
},startup:function(){
this.inherited(arguments);
this._refreshState();
},_setConstraintsAttr:function(_2e22){
if(!_2e22.locale&&this.lang){
_2e22.locale=this.lang;
}
this._set("constraints",_2e22);
this._refreshState();
},_getPatternAttr:function(_2e23){
var p=this.pattern;
var type=(typeof p).toLowerCase();
if(type=="function"){
p=this.pattern(_2e23||this.constraints);
}
if(p!=this._lastRegExp){
var _2e24="";
this._lastRegExp=p;
if(p!=".*"){
p.replace(/\\.|\[\]|\[.*?[^\\]{1}\]|\{.*?\}|\(\?[=:!]|./g,function(re){
switch(re.charAt(0)){
case "{":
case "+":
case "?":
case "*":
case "^":
case "$":
case "|":
case "(":
_2e24+=re;
break;
case ")":
_2e24+="|$)";
break;
default:
_2e24+="(?:"+re+"|$)";
break;
}
});
}
try{
"".search(_2e24);
}
catch(e){
_2e24=this.pattern;
console.warn("RegExp error in "+this.declaredClass+": "+this.pattern);
}
this._partialre="^(?:"+_2e24+")$";
}
return p;
},postMixInProperties:function(){
this.inherited(arguments);
this.messages=i18n.getLocalization("dijit.form","validate",this.lang);
this._setConstraintsAttr(this.constraints);
},_setDisabledAttr:function(value){
this.inherited(arguments);
this._refreshState();
},_setRequiredAttr:function(value){
this._set("required",value);
this.focusNode.setAttribute("aria-required",value);
this._refreshState();
},_setMessageAttr:function(_2e25){
this._set("message",_2e25);
this.displayMessage(_2e25);
},reset:function(){
this._maskValidSubsetError=true;
this.inherited(arguments);
},_onBlur:function(){
this.displayMessage("");
this.inherited(arguments);
}});
});
},"davinci/html/HTMLAttribute":function(){
define(["dojo/_base/declare","davinci/html/HTMLItem"],function(_2e26,_2e27){
return _2e26("davinci.html.HTMLAttribute",_2e27,{constructor:function(){
this.elementType="HTMLAttribute";
this.name="";
this.value="";
},getText:function(_2e28){
if(this.noPersist&&!_2e28.includeNoPersist){
return "";
}
var s=this.name;
var bool={checked:1,selected:1,disabled:1,readonly:1,multiple:1,ismap:1,autofocus:1,autoplay:1,controls:1,formnovalidate:1,loop:1,muted:1,required:1};
if(bool[this.name.toLowerCase()]){
if(this.value&&this.value!="false"){
s+="=\""+this.name+"\"";
}else{
s="";
}
}else{
if(!this.noValue){
s=s+"=\""+davinci.html.escapeXml(String(this.value))+"\"";
}
}
return s;
},setValue:function(value){
this.value=davinci.html.unEscapeXml(value);
this.onChange();
}});
});
},"davinci/ve/input/SmartInput":function(){
define(["dojo/_base/declare","dojo/dom-geometry","davinci/ve/commands/ModifyRichTextCommand","dijit/layout/ContentPane","dijit/form/SimpleTextarea","dijit/form/TextBox","dojox/html/entities","dojox/html/ellipsis","dojox/layout/ResizeHandle","dojo/i18n!davinci/ve/nls/ve","dojo/i18n!dijit/nls/common"],function(_2e29,_2e2a,_2e2b,_2e2c,_2e2d,_2e2e,_2e2f,_2e30,_2e31,veNls,_2e32){
return _2e29("davinci.ve.input.SmartInput",null,{property:null,_X_MOVE_RANGE:10,_Y_MOVE_RANGE:10,_POINTER_TOP_OFFSET:-13,multiLine:"false",displayOnCreate:"true",_connection:[],getHelpText:function(){
if(this.helpText){
return this.helpText;
}
if(this.isHtmlSupported()){
return veNls.smartInputHelp1;
}
return veNls.smartInputHelp2;
},isHtmlSupported:function(){
if(!this.supportsHTML){
if(this._widget.type.match("^html")=="html"){
this.supportsHTML="true";
}else{
this.supportsHTML="false";
}
}
if(typeof (this.supportsHTML)==="boolean"){
return this.supportsHTML;
}
if(this.supportsHTML==="true"){
return true;
}else{
return false;
}
},parse:function(input){
return input;
},parseItems:function(input){
if(this.trim){
input=dojo.trim(input);
}
var items;
if(input.match(/[^\\][\r\n]/)){
items=this.parseItemsInRows(input);
}else{
items=this.parseItemsInColumns(input);
}
return items;
},parseItemsInRows:function(input){
var items=this.splitRows(input);
var _2e33=items.length;
for(var i=0;i<_2e33;i++){
var item=items[i];
item=this.parseItem(item);
items[i]=item;
}
return items;
},parseItemsInColumns:function(input){
var items=this.splitColumns(input);
var _2e34=items.length;
for(var i=0;i<_2e34;i++){
var item=items[i];
item=this.parseItem(item);
items[i]=item;
}
return items;
},parseGrid:function(input){
var rows=this.splitRows(input);
var _2e35=rows.length;
for(var i=0;i<_2e35;i++){
var row=rows[i];
var items=this.parseItemsInColumns(row);
rows[i]=items;
}
return rows;
},parseItem:function(item){
var regex=/^([-~!>|(*)[+\]]*) ?(.*)$/;
var _2e36=null;
var text=item;
var _2e37=item.match(regex);
if(_2e37){
_2e36=_2e37[1];
text=_2e37[2];
}
var _2e38=0;
var _2e39=false;
var _2e3a=false;
var _2e3b=false;
if(_2e36){
for(var i=0;i<_2e36.length;i++){
var c=_2e36[i];
switch(c){
case "-":
case "~":
case "!":
_2e39=true;
break;
case ">":
_2e38++;
break;
case "*":
case "+":
_2e3a=true;
break;
default:
}
}
}
var _2e3c={original:item,specialChars:_2e36,text:text,indent:_2e38,disabled:_2e39,selected:_2e3a};
return _2e3c;
},splitRows:function(text){
var split=[];
var i;
var line="";
var _2e3d=false;
for(i=0;i<text.length;i++){
var c=text.charAt(i);
switch(c){
case "\\":
if(_2e3d){
line+=c;
}
_2e3d=!_2e3d;
break;
case "r":
if(_2e3d){
line+="\r";
_2e3d=false;
}else{
line+=c;
}
break;
case "n":
if(_2e3d){
line+="\n";
_2e3d=false;
}else{
line+=c;
}
break;
case "\r":
case "\n":
if(_2e3d){
line+=c;
_2e3d=false;
}else{
if(this.trim){
line=dojo.trim(line);
}
split.push(line);
line="";
}
break;
default:
line+=c;
_2e3d=false;
}
}
if(line){
if(this.trim){
line=dojo.trim(line);
}
split.push(line);
}
return split;
},splitColumns:function(text){
var split=[];
var i;
var line="";
var _2e3e=false;
for(i=0;i<text.length;i++){
var c=text.charAt(i);
switch(c){
case "\\":
if(_2e3e){
line+=c;
}
_2e3e=!_2e3e;
break;
case "r":
if(_2e3e){
line+="\r";
_2e3e=false;
}else{
line+=c;
}
break;
case "n":
if(_2e3e){
line+="\n";
_2e3e=false;
}else{
line+=c;
}
break;
case ",":
if(_2e3e){
line+=c;
_2e3e=false;
}else{
if(this.trim){
line=dojo.trim(line);
}
split.push(line);
line="";
}
break;
default:
line+=c;
_2e3e=false;
}
}
if(line){
if(this.trim){
line=dojo.trim(line);
}
split.push(line);
}
return split;
},serializeItems:function(items){
var _2e3f=this.format=="columns"?this.serializeColumns(items):this.serializeRows(items);
return _2e3f;
},serializeColumns:function(items){
for(var i=0;i<items.length;i++){
var item=items[i];
item=item.replace(/\\/g,"\\\\");
items[i]=item.replace(/,/g,"\\,");
}
var _2e40=items.join(", ");
return _2e40;
},serializeRows:function(items){
for(var i=0;i<items.length;i++){
var item=items[i];
item=item.replace(/\\/g,"\\\\");
items[i]=item.replace(/\n/g,"\\\n");
}
var _2e41=items.join("\n");
return _2e41;
},inlineEditActive:function(){
if(this._inline&&this._inline.style.display!="none"&&this._inline.eb){
return true;
}else{
return false;
}
},show:function(_2e42){
this._widget=davinci.ve.widget.byId(_2e42);
if(!this._inline){
this._createInline();
}
var _2e43=dojo.hitch(this,function(value){
this._inline.style.display="block";
this.setFormat(value);
var _2e44=[["&","amp"],["\"","quot"],["<","lt"],[">","gt"]];
value=_2e2f.decode(value,_2e44);
this._inline.eb.set("value",String(value));
this.updateFormats();
this.help(false);
dijit.selectInputText(this._inline.eb.textbox);
this.updateSimStyle();
this._inline.eb.textbox.focus();
});
var node=this._node(this._widget);
var _2e45=this.property;
var _2e46=(_2e45==="maq_innerText")?"innerHTML":_2e45;
var value;
if(_2e45){
if(node){
value=dojo.attr(node,_2e46);
}else{
if(_2e46==="innerHTML"||_2e46=="textContent"){
value=this._widget._srcElement.getElementText(this._context);
value=value.replace(/\s+/g," ");
}else{
value=this._widget.attr(_2e45);
}
}
}
if(this.serialize){
this.serialize(node||this._widget,_2e43,value);
}else{
if(_2e45){
_2e43(value);
}
}
},_createInline:function(){
if(this.multiLine&&this.multiLine!="false"){
this._loading(115,200);
var t=this._getTemplate();
this._inline.set("content",t);
}else{
this._loading(85,200);
var t=this._getTemplate();
this._inline.set("content",t);
}
this._inline.eb=dijit.byId("davinciIleb");
this._connection.push(dojo.connect(this._inline.eb,"onMouseDown",this,"stopEvent"));
this._connection.push(dojo.connect(this._inline.eb,"onKeyDown",this,"stopEvent"));
this._connection.push(dojo.connect(this._inline.eb,"onKeyUp",this,"handleEvent"));
if(this.multiLine=="true"){
this._connection.push(dojo.connect(this._inline.eb,"onBlur",this,"onBlur"));
this._connectSimDiv();
}
var text=this._widget._srcElement.getElementText(this._context);
this._inline.eb.setValue(text);
this._loadingDiv.style.backgroundImage="none";
this._inline._setStyleAttr({display:"block"});
this._connectHelpDiv();
this._connectResizeHandle();
window.setTimeout(function(){
this._inline.eb.textbox.focus();
this._connection.push(dojo.connect(this._inline,"onBlur",this,"onOk"));
}.bind(this),500);
this.resize(null);
},_connectHelpDiv:function(){
var help=dojo.byId("davinci.ve.input.SmartInput_img_help");
this._connection.push(dojo.connect(help,"onclick",this,"toggleHelp"));
this._connection.push(dojo.connect(dijit.byId("davinci.ve.input.SmartInput_ok"),"_onSubmit",this,"onOk"));
this._connection.push(dojo.connect(dijit.byId("davinci.ve.input.SmartInput_cancel"),"onClick",this,"onCancel"));
},_findSmartInputContainer:function(_2e47){
return document.body;
var _2e48=_2e47.parentNode;
while(!dojo.hasClass(_2e48,"dijitContentPane")){
_2e48=_2e48.parentNode;
}
return _2e48;
},_loading:function(_2e49,width){
var _2e4a=this._widget._edit_context.frameNode;
var doc=_2e4a.ownerDocument;
var _2e4b=doc.createElement("div");
var _2e4c=this._findSmartInputContainer(_2e4a);
if(!_2e4c){
return;
}
_2e4c.appendChild(_2e4b);
this._loadingDiv=_2e4b;
dojo.addClass(_2e4b,"smartInputLoading");
var _2e4d=doc.createElement("div");
_2e4d.id="ieb";
dojo.addClass(_2e4d,"inlineEdit dijitTooltipContainer");
var _2e4e=doc.createElement("div");
_2e4e.id="iebPointer";
this._inline=_2e4d;
_2e4c.appendChild(_2e4d);
_2e4c.appendChild(_2e4e);
var m2=new dojo.dnd.Moveable("ieb");
this._connection.push(dojo.connect(m2,"onMoveStart",this,"onMoveStart"));
this._connection.push(dojo.connect(m2,"onMoveStop",this,"onMoveStop"));
var _2e4f=new _2e2c({},_2e4d);
this._inline=_2e4f;
var _2e50=dijit.byId("editorsStackContainer").domNode;
var p=_2e2a.position(_2e50);
this._loadingDiv.style.position="absolute";
this._loadingDiv.style.left=p.x+"px";
this._loadingDiv.style.top=p.y+"px";
this._loadingDiv.style.width=p.w+"px";
this._loadingDiv.style.height=p.h+"px";
var box=this._widget.getMarginBox();
var _2e51=dojo.position(_2e4a);
var _2e52=dojo.position(_2e4c);
var _2e53=(_2e51.x-_2e52.x)+_2e4c.scrollLeft-1;
var _2e54=(_2e51.y-_2e52.y)+_2e4c.scrollTop-1;
var _2e55=_2e4c.clientHeight;
var _2e56=_2e4c.clientWidth;
var _2e57=26;
var top=_2e57;
var _2e58=0;
if((box.y+_2e49+_2e57)<_2e55){
top=box.y+_2e57;
dojo.addClass(_2e4e,"inlineEditConnectorBelow");
}else{
if((box.y-_2e49)>0){
top=box.y-_2e49;
_2e58=_2e49+12;
}else{
top=0+_2e57;
}
}
var left="0";
if((box.x+width+20)<_2e56){
left=box.x;
}else{
if((box.x+width)>_2e56){
var t=box.x-width+box.w;
if(t<0){
t=0;
}
left=t;
}
}
left+=_2e53;
top+=_2e54;
this._inline._setStyleAttr({display:"block",top:top+"px",left:left+"px",padding:"1px",overflow:"hidden",backgroundImage:"none"});
this._startTop=top;
this._startLeft=left;
dojo.style(_2e4e,"left",box.x+20+_2e53+"px");
dojo.style(_2e4e,"top",top+_2e58+this._POINTER_TOP_OFFSET+"px");
},handleEvent:function(event){
switch(event.keyCode){
case 13:
var _2e59=this.multiLine;
if(!_2e59||_2e59=="false"||this._lastKeyCode==13||event.ctrlKey){
this.onOk();
}else{
if(event.which==dojo.keys.ENTER&&event.ctrlKey){
this.onOk();
}
}
break;
case 27:
this.onCancel();
break;
default:
this.updateFormats();
}
this._lastKeyCode=event.keyCode;
this.updateSimStyle();
},onOk:function(e){
this.hide();
},onCancel:function(e){
this.hide(true);
},onMoveStart:function(mover){
dojo.style("iebPointer","display","none");
},onMoveStop:function(mover){
var left=dojo.style("ieb","left");
var top=dojo.style("ieb","top");
var _2e5a=this._startLeft-left;
var _2e5b=top-this._startTop;
if(_2e5b<this._Y_MOVE_RANGE&&_2e5b>(-this._Y_MOVE_RANGE)){
dojo.style("iebPointer","display","");
dojo.style("iebPointer","top",this._startTop+this._POINTER_TOP_OFFSET+_2e5b+"px");
}else{
dojo.style("iebPointer","display","none");
return;
}
if(_2e5a<this._X_MOVE_RANGE&&_2e5a>(-this._X_MOVE_RANGE)){
dojo.style("iebPointer","display","");
}else{
dojo.style("iebPointer","display","none");
return;
}
},stopEvent:function(e){
e.stopPropagation();
this.updateSimStyle();
},_node:function(){
var node;
var path=this.path;
var _2e5c=this.selector;
if(path||_2e5c){
node=this._widget.domNode;
if(path){
node=dojo.getObject(path,false,this._widget);
}
if(_2e5c){
node=dojo.query(_2e5c,node)[0];
}
}
return node;
},updateWidget:function(value){
if(this._widget._destroyed){
return;
}
if(this.parse){
value=this.parse(value);
}
var node=this._node(this._widget);
var _2e5d=this._widget.getContext();
var _2e5e=this.property;
var _2e5f=(_2e5e==="maq_innerText")?"innerHTML":_2e5e;
if(this.update){
var _2e60=this.update(node||this._widget,value,_2e5e);
if(_2e60){
this._widget=_2e60;
}
_2e5d.select(this._widget,null,false);
}else{
if(_2e5e){
if(node){
dojo.attr(node,_2e5f,value);
}else{
var _2e61={};
if(value&&(typeof value=="string")){
value=value.replace(/\n/g,"");
}
var _2e62=null;
if(_2e5e=="textContent"){
_2e62=value;
}else{
_2e61[_2e5e]=value;
}
var _2e63;
if(_2e5f==="innerHTML"){
_2e61.richText=_2e61[_2e5e];
delete _2e61[_2e5e];
_2e63=new _2e2b(this._widget,_2e61,null,_2e5d);
}else{
_2e63=new davinci.ve.commands.ModifyCommand(this._widget,_2e61,_2e62,_2e5d);
}
this._widget._edit_context.getCommandStack().execute(_2e63);
this._widget=_2e63.newWidget;
this._widget._edit_context._focuses[0]._selectedWidget=this._widget;
}
_2e5d.select(this._widget,null,false);
}
}
},hide:function(_2e64){
if(this._inline){
var value;
while(connection=this._connection.pop()){
if(connection){
dojo.disconnect(connection);
}
}
var _2e65=this._findSmartInputContainer(this._widget._edit_context.frameNode);
if(!_2e65){
return;
}
if(this._loadingDiv){
_2e65.removeChild(this._loadingDiv);
}
if(this._inline.style.display!="none"&&this._inline.eb){
value=this._inline.eb.get("value");
this._value=value;
this._format=this.getFormat();
this._inline.style.display="none";
if(this._inline.eb){
this._inline.eb.destroyRecursive();
delete this._inline.eb;
}
this._inline.destroyRecursive();
delete this._inline;
var _2e66=_2e65.ownerDocument.getElementById("iebPointer");
_2e65.removeChild(_2e66);
if(value!=null&&!_2e64){
if(!this.disableEncode&&this._format==="text"){
value=_2e2f.encode(value);
}
this.updateWidget(value);
}
var _2e67=this._widget.getContext();
var _2e68=_2e67.getDocument();
_2e68.defaultView.focus();
}
}
},getFormat:function(){
var _2e69=dijit.byId("davinci.ve.input.SmartInput_radio_html");
var _2e6a="text";
if(_2e69&&_2e69.checked){
_2e6a="html";
}
return _2e6a;
},containsHtmlMarkUp:function(str){
var n=dojo.create("div",{innerHTML:str});
if(n.children.length>0){
return true;
}else{
return false;
}
},toggleHelp:function(){
var help=dojo.byId("davinci.ve.input.SmartInput_img_help");
if(dojo.hasClass(help,"inlineEditHelpSelected")){
this.help(false);
}else{
this.help(true);
}
dojo.toggleClass(help,"inlineEditHelpSelected");
},setFormat:function(value){
var _2e6b=dijit.byId("davinci.ve.input.SmartInput_radio_html");
var _2e6c=dijit.byId("davinci.ve.input.SmartInput_radio_text");
var n=dojo.create("div",{innerHTML:value});
var _2e6d=n.children.length?"html":"text";
if(_2e6d==="html"){
_2e6b.set("checked",true);
_2e6c.set("checked",false);
}else{
_2e6b.set("checked",false);
_2e6c.set("checked",true);
}
this._format=_2e6d;
},help:function(_2e6e){
var _2e6f=dojo.byId("davinci.ve.input.SmartInput_div_help");
var _2e70=dojo.byId("davinci.ve.input.SmartInput_radio_div");
if(_2e6e){
dojo.style(_2e6f,"display","");
}else{
dojo.style(_2e6f,"display","none");
}
},updateFormats:function(){
var value=this._inline.eb.get("value");
var _2e71=true;
if(this.containsHtmlMarkUp(value)){
_2e71=false;
}
var _2e72=this._widget.getContext().getDojo();
var _2e73=dojo.byId("davinci.ve.input.SmartInput_radio_text_width_div");
var what=_2e2f.encode(value);
_2e73.innerHTML="<div class=\"dojoxEllipsis\">"+dojo.replace("Plain text ({0})",[what])+"</div>";
var _2e74=dojo.byId("davinci.ve.input.SmartInput_radio_html_width_div");
_2e74.innerHTML="<div id=\"davinci.ve.input.SmartInput_radio_html_div\" class=\"dojoxEllipsis\">"+veNls.htmlMarkup+"</div>";
var _2e75=dijit.byId("davinci.ve.input.SmartInput_radio_html");
var _2e76=dijit.byId("davinci.ve.input.SmartInput_radio_text");
var table=dojo.byId("davinci.ve.input.SmartInput_table");
_2e75.setDisabled(_2e71);
_2e76.setDisabled(_2e71);
if(_2e71){
dojo.addClass(_2e73,"inlineEditDisabled");
dojo.addClass(_2e74,"inlineEditDisabled");
_2e75.set("checked",false);
_2e76.set("checked",true);
}else{
dojo.removeClass(_2e73,"inlineEditDisabled");
dojo.removeClass(_2e74,"inlineEditDisabled");
}
if(!_2e71&&this.isHtmlSupported()){
dojo.style(_2e76.domNode,"display","");
dojo.style(_2e75.domNode,"display","");
dojo.style(_2e74,"display","");
dojo.style(_2e73,"display","");
dojo.style(table,"display","");
}else{
dojo.style(_2e76.domNode,"display","none");
dojo.style(_2e75.domNode,"display","none");
dojo.style(_2e74,"display","none");
dojo.style(_2e73,"display","none");
dojo.style(table,"display","none");
}
},resize:function(e){
var _2e77=dojo.byId("iedResizeDiv");
var _2e78=dijit.byId("davinciIleb");
var _2e79=_2e77.clientWidth-5;
var _2e7a=_2e77.clientHeight-6;
var _2e7b=_2e77.clientWidth-10;
_2e79=_2e77.clientWidth-8;
_2e7a=_2e77.clientHeight-20;
_2e7b=_2e77.clientWidth-9;
var _2e7c=dojo.byId("smartInputSim");
dojo.style(_2e7c,"width",_2e79+10+"px");
this.updateSimStyle();
if(_2e78){
_2e78._setStyleAttr({width:_2e79+"px",height:_2e7a+"px",maxHeight:_2e7a+"px"});
_2e78._setStyleAttr({width:_2e77.clientWidth+"px"});
}
var obj=dojo.byId("davinci.ve.input.SmartInput_radio_div");
dojo.style(obj,"width",_2e7b+2+"px");
obj=dojo.byId("davinci.ve.input.SmartInput_radio_text_width_div");
dojo.style(obj,"width",_2e77.clientWidth-50+"px");
obj=dojo.byId("davinci.ve.input.SmartInput_radio_html_width_div");
dojo.style(obj,"width",_2e77.clientWidth-50+"px");
},onBlur:function(e){
this.updateSimStyle(e);
},updateSimStyle:function(e){
var _2e7d=dijit.byId("davinciIleb");
var _2e7e=dojo.byId("smartInputSim");
if(_2e7e){
var s=dojo.style(_2e7d.domNode);
dojo.style(_2e7e,"borderColor",s.borderTopColor);
dojo.style(_2e7e,"backgroundColor",s.backgroundColor);
}
},_getTemplate:function(){
var _2e7f=""+"<div id=\"iedResizeDiv\" class=\"iedResizeDiv\" >"+"<textarea  dojoType=\"dijit.form.SimpleTextarea\" name=\"davinciIleb\" trim=\"true\" id=\"davinciIleb\" class=\"smartInputTextArea\" ></textarea>"+"<div id=\"smartInputSim\" class=\"smartInputSim\" ></div>"+"<div id=\"iedResizeHandle\" dojoType=\"dojox.layout.ResizeHandle\" targetId=\"iedResizeDiv\" constrainMin=\"true\" maxWidth=\"200\" maxHeight=\"600\" minWidth=\"200\" minHeight=\"55\"  activeResize=\"true\" intermediateChanges=\"true\" ></div>"+"</div>";
if(this.multiLine==="true"){
_2e7f=""+"<div id=\"iedResizeDiv\" class=\"iedResizeDiv\" >"+"<textarea  dojoType=\"dijit.form.SimpleTextarea\" name=\"davinciIleb\" trim=\"true\" id=\"davinciIleb\" class=\"smartInputTextAreaMulti\" ></textarea>"+"<div id=\"smartInputSim\" class=\"smartInputSim\" ></div>"+"<div id=\"iedResizeHandle\" dojoType=\"dojox.layout.ResizeHandle\" targetId=\"iedResizeDiv\" constrainMin=\"true\" maxWidth=\"200\" maxHeight=\"600\" minWidth=\"200\" minHeight=\"80\"  activeResize=\"true\" intermediateChanges=\"true\" ></div>"+"</div>";
}
var _2e80=""+_2e7f+"<div  id=\"davinci.ve.input.SmartInput_div\"  class=\"davinciVeInputSmartInputDiv\" >"+"<div id=\"davinci.ve.input.SmartInput_radio_div\" class=\"smartInputRadioDiv\" >"+"<table id=\"davinci.ve.input.SmartInput_table\"> "+"<tbody>"+"<tr> "+"<td class=\"smartInputTd1\" > "+"<input id=\"davinci.ve.input.SmartInput_radio_text\" showlabel=\"true\" type=\"radio\" dojoType=\"dijit.form.RadioButton\" disabled=\"false\" readOnly=\"false\" intermediateChanges=\"false\" checked=\"true\"> </input> "+"</td> "+"<td class=\"smartInputTd2\" >"+"<div id=\"davinci.ve.input.SmartInput_radio_text_width_div\" class=\"smartInputRadioTextDiv\">"+"</div>"+"</td> "+"</tr>"+"<tr> "+"<td class=\"smartInputTd1\"> <input id=\"davinci.ve.input.SmartInput_radio_html\" showlabel=\"true\" type=\"radio\" dojoType=\"dijit.form.RadioButton\"> </input>  </td> "+"<td class=\"smartInputTd2\">"+"<div id=\"davinci.ve.input.SmartInput_radio_html_width_div\" class=\"smartInputRadioTextDiv\">"+"</div>"+"</td> "+"</tr> "+"</tbody>"+"</table> "+"<div class=\"smartInputHelpDiv\" > "+"<span id=\"davinci.ve.input.SmartInput_img_help\"  title=\"Help\" class=\"inlineEditHelp\" > </span>"+"<span class=\"smartInputSpacerSpan\" >"+"<button id=\"davinci.ve.input.SmartInput_ok\"  dojoType=\"dijit.form.Button\" type=\"submit\" class=\"inlineEditHelpOk\" >"+_2e32.buttonOk+"</button> <button id=davinci.ve.input.SmartInput_cancel dojoType=\"dijit.form.Button\" class=\"inlineEditHelpCancel\"> "+_2e32.buttonCancel+"</button>  "+"</span>   "+"</div> "+"<div id=\"davinci.ve.input.SmartInput_div_help\" style=\"display:none;\" class=\"smartInputHelpTextDiv\" > "+"<div dojoType=\"dijit.layout.ContentPane\" class=\"smartInputHelpTextDivContentPane \"style=\"padding:0;\" >"+this.getHelpText()+"</div> "+"<div style=\"text-align: left; padding:0; height:2px;\" ></div> "+"</div> "+"</div>"+"</div> "+"";
return _2e80;
},_connectResizeHandle:function(){
var _2e81=dijit.byId("iedResizeHandle");
this._connection.push(dojo.connect(_2e81,"onResize",this,"resize"));
},_connectSimDiv:function(){
this._connection.push(dojo.connect(this._inline.eb,"onFocus",this,"updateSimStyle"));
this._connection.push(dojo.connect(this._inline.eb,"onMouseOver",this,"updateSimStyle"));
this._connection.push(dojo.connect(this._inline.eb,"onMouseOut",this,"updateSimStyle"));
this._connection.push(dojo.connect(dojo.byId(" davinci.ve.input.SmartInput_div"),"onclick",this,"updateSimStyle"));
}});
});
},"url:davinci/ve/widgets/templates/BackgroundDialog.html":"<div class=\"backgroundDialog\" style=\"position:relative\" dojoAttachPoint=\"_fileDialog\">\n\t<style type=\"text/css\">\n\t\t.backgroundDialog {\n\t\t\twidth:31em;\n\t\t}\n\t\t.bgdTopDiv {\n\t\t\tmargin-top: 4px;\n\t\t\tpadding-left: .75em;\n\t\t}\n\t\t.bgdTopTable {\n\t\t\twidth:100%;\n\t\t\tborder-collapse:collapse;\n\t\t}\n\t\t.bgdTopLabel, .bgdTopField, .bgdTopPreview {\n\t\t\twidth:1px;\n\t\t\twhite-space:nowrap;\n\t\t}\n\t\t.bgdTopLabel {\n\t\t\ttext-align:right;\n\t\t\tpadding-right:6px;\n\t\t}\n\t\t.bgdTopTable .dijitSelect .dijitButtonContents {\n\t\t\twidth:8em;\n\t\t}\n\t\t.bgdTopTable .dijitTextBox {\n\t\t\twidth: 9.8em;\n\t\t}\n\t\t.bgdPreview {\n\t\t\tdisplay:inline-block;\n\t\t\twidth: 6em;\n\t\t\theight: 2.8em;\n\t\t\tmargin-left:12px;\n\t\t\tborder:1px solid gray;\n\t\t\tvertical-align: middle;\n\t\t}\n\t\t.bgdOptionsDiv {\n\t\t\tmargin:0.3em 0em 1em 1em;\n\t\t}\n\t\t.bgdOptionsDiv > table {\n\t\t\twidth:27em;\n\t\t}\n\t\t.bgdSection {\n\t\t\tbackground-color:#d8d8d8;\n\t\t}\n\t\tdiv.bgdSection, .bgdSection td, .bgdSection.bgdUrlSectionLabel {\n\t\t\tpadding:2px 5px;\n\t\t}\n\t\t.bgdBeforeStopsLabel {\n\t\t\theight:6px;\n\t\t}\n\t\t.bgdStopsLabel {\n\t\t\tmargin-top:1em;\n\t\t}\n\t\t.bgdAfterStopsLabel {\n\t\t\theight:0px;\n\t\t}\n\t\t.bgdBeforeOptionsLabel {\n\t\t\theight:16px;\n\t\t}\n\t\t.bgdOptionsLabel {\n\t\t\tmargin-top:1em;\n\t\t}\n\t\t.bgdAfterOptionsLabel {\n\t\t\theight:4px;\n\t\t}\n\t\t.bgdCol1 {\n\t\t\twidth:10px;\n\t\t}\n\t\t.bgdPlusMinusButtons {\n\t\t\twhite-space:nowrap;\n\t\t\twidth:51px;\n\t\t}\n\t\t.bgdOptionsDiv th {\n\t\t\ttext-align:center;\n\t\t\tfont-style:italic;\n\t\t}\n\t\t.bgdOptsLabel {\n\t\t\ttext-align:right;\n\t\t\tpadding-right: 6px;\n\t\t\twhite-space:nowrap;\n\t\t}\n\t\t.bgdColor.dijitTextBox {\n\t\t\twidth:9em;\n\t\t}\n\t\t.bgdOptionsDiv .bgdPosition.dijitTextBox {\n\t\t\twidth:5em;\n\t\t}\n\t\t.bgdOptionsDiv .dijitTextBox {\n\t\t\twidth:10.6em;\n\t\t}\n\t\t.bgdStopColorTD .dijitTextBox {\n\t\t\twidth:14em;\n\t\t}\n\t\t.bgdOptionsDiv .dijitSelect {\n\t\t\tmargin:0;\n\t\t}\n\t\t.bgdOptionsDiv .dijitSelect .dijitButtonContents {\n\t\t\twidth:9em;\n\t\t}\n\t\t.bgdUrlContainerOuter {\n\t\t\tmargin-top:1em;\n\t\t\tmargin-left:1em;\n\t\t}\n\t\t.bgdUrlContainerInner {\n\t\t\tmargin:0 1em;\n\t\t}\n\t\t.bgdUrlSectionLabel {\n\t\t\tmargin:1em 0 .25em;\n\t\t}\n\t\t.bgdFileTreeContainer {\n\t\t\tmargin: 0 0 0 3px;\n\t\t\tborder: 1px solid #26A;\n\t\t}\n\t\t.bgdFileTreeContainer .dijitTree {\n\t\t\theight:125px;\n\t\t}\t\t\n\t\t.backgroundDialog .fileNameRow  {\n\t\t\tmargin:8px 0 .4em;\n\t\t}\n\t\t.backgroundDialog .fileNameRow label {\n\t\t\tvertical-align:middle;\n\t\t\tmargin-right:4px;\n\t\t}\n\t\t.backgroundDialog .fileNameRow .dijitTextBox {\n\t\t\twidth:16em;\n\t\t}\n\t\t.bgdOptionsDiv .bgdOtherRow .dijitTextBox {\n\t\t\twidth:15em;\n\t\t}\n\t\t\n\t</style>\n\n\t<div class=\"dijitDialogPaneContentArea\">\n\t\t<div class='bgdTopDiv'>\n\t\t\t<table class='bgdTopTable'>\n\t\t\t\t<tr>\n\t\t\t\t\t<td class='bgdTopLabel'><label class='bgdTypeDivTypeLabel'>${veNLS.bgdBackgroundColor}</label></td>\n\t\t\t\t\t<td class='bgdTopField'>\n\t\t\t\t\t\t<select dojoType=\"dijit.form.ComboBox\" dojoAttachPoint='bgdColorCB'>\n\t\t\t\t\t\t\t<!--  values added dynamically -->\n\t\t\t\t\t\t</select>\n\t\t\t\t\t</td>\n\t\t\t\t\t<td rowspan='2' class='bgdTopPreview' style='border-collapse:collapse'><span class='bgdPreview'></span></td>\n\t\t\t\t\t<td class='bgdTopExpando'>&nbsp;</td>\n\t\t\t\t</tr>\n\t\t\t\t<tr>\n\t\t\t\t\t<td class='bgdTopLabel'><label class='bgdTypeDivTypeLabel'>${veNLS.bgdBackgroundImageType}</label></td>\n\t\t\t\t\t<td class='bgdTopField'>\n\t\t\t\t\t\t<select dojoType='dijit.form.Select' value='linear' dojoAttachPoint='bgdTypeSelect'>\n\t\t\t\t\t\t\t<!--  values added dynamically -->\n\t<!-- FIXME: Add plain text type-in box if unrecognized syntax -->\n\t\t\t\t\t\t</select>\n\t\t\t\t\t</td>\n\t\t\t\t\t<td class='bgdTopExpando'>&nbsp;</td>\n\t\t\t\t</tr>\n\t\t\t</table>\n\t\t</div>\n\t\t\n\t\t<div class=\"bgdUrlContainerOuter bgdImageOptRow\">\n\t\t\t<div class=\"bgdSection bgdOptionsLabel\">${veNLS.bgdImageUrl}</div>\n\t\t\t<div class=\"bgdUrlContainerInner\">\n\t\t\t\t<div class='fileNameRow'>\n\t\t\t\t\t<td class=\"fileDialogLabelCell\">\n\t\t\t\t\t<label>${veNLS.bgdUrl}</label>\n\t\t\t\t\t</td>\n\t\t\t\t\t<td>\n\t\t\t\t\t<div dojoType='davinci.ui.widgets.FileFieldDialog' dojoAttachPoint=\"_filePicker\"></div>\n\t\t\t\t\t</td>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t\t<div class=\"bgdOptionsDiv\">\n\t\t\t<table>\n\t\t\t\t<tr class=\"bgdGradOptRow bgdBeforeStopsLabel\"></tr>\n\t\t\t\t<tr class=\"bgdGradOptRow bgdSection bgdStopsLabel\">\n\t\t\t\t\t<td colspan=\"5\">${veNLS.bgdColorStops}</td>\n\t\t\t\t</tr>\n\t\t\t\t<tr class=\"bgdGradOptRow bgdAfterStopsLabel\"></tr>\n\t\t\t\t<tr class='bgdGradOptRow bgdStopRow'>\n\t\t\t\t\t<th></th><th></th><th>${veNLS.bgdColor}</th><th>${veNLS.bgdPosition}</th><th></th>\n\t\t\t\t</tr>\n\t\t\t\t<!--  gradient stop rows added dynamically -->\n\t\t\t\t<tr class=\"bgdBeforeOptionsLabel bgdOptionsLabelRow\"></tr>\n\t\t\t\t<tr class=\"bgdSection bgdOptionsLabel bgdOptionsLabelRow\">\n\t\t\t\t\t<td colspan=\"5\">${veNLS.bgdOptions}</td>\n\t\t\t\t</tr>\n\t\t\t\t<tr class=\"bgdAfterOptionsLabel bgdOptionsLabelRow\"></tr>\n\t\t\t\t<tr class=\"bgdGradOptRow bgdLinearOptRow\">\t\n\t\t\t\t\t<td class='bgdCol1'></td>\n\t\t\t\t\t<td class='bgdOptsLabel'><label>${veNLS.bgdAngle}</label></td>\n\t\t\t\t\t<td colspan='3'>\n\t\t\t\t\t\t<select dojoType=\"dijit.form.ComboBox\" dojoAttachPoint='bgdLinearAngleCB'>\n\t\t\t\t\t\t\t<!--  values added dynamically -->\n\t\t\t\t\t\t</select>\n\t\t\t\t\t</td>\n\t\t\t\t</tr>\n\t\t\t\t<tr class=\"bgdGradOptRow bgdRadialOptRow\">\t\n\t\t\t\t\t<td class='bgdCol1'></td>\n\t\t\t\t\t<td class='bgdOptsLabel'>${veNLS.bgdPosition2}</td>\n\t\t\t\t\t<td colspan='3'>\n\t\t\t\t\t\t<select dojoType=\"dijit.form.ComboBox\" dojoAttachPoint='bgdRadialPosCB'>\n\t\t\t\t\t\t\t<!--  values added dynamically -->\n\t\t\t\t\t\t</select>\n\t\t\t\t\t</td>\n\t\t\t\t</tr>\n\t\t\t\t<tr dojoAttachPoint=\"bgdShapeRow\" class=\"bgdGradOptRow bgdRadialOptRow\">\t\n\t\t\t\t\t<td class='bgdCol1'></td>\n\t\t\t\t\t<td class='bgdOptsLabel'><label>${veNLS.bgdShape}</label></td>\n\t\t\t\t\t<td colspan='3'>\n\t\t\t\t\t\t<select dojoType=\"dijit.form.ComboBox\" dojoAttachPoint='bgdRadialShapeCB'>\n\t\t\t\t\t\t\t<!--  values added dynamically -->\n\t\t\t\t\t\t</select>\n\t\t\t\t\t</td>\n\t\t\t\t</tr>\n\t\t\t\t<tr dojoAttachPoint=\"bgdExtentRow\" class=\"bgdGradOptRow bgdRadialOptRow\">\t\n\t\t\t\t\t<td class='bgdCol1'></td>\n\t\t\t\t\t<td class='bgdOptsLabel'><label>${veNLS.bgdExtent}</label></td>\n\t\t\t\t\t<td colspan='3'>\n\t\t\t\t\t\t<select dojoType=\"dijit.form.ComboBox\" dojoAttachPoint='bgdRadialExtentCB'>\n\t\t\t\t\t\t\t<!--  values added dynamically -->\n\t\t\t\t\t\t</select>\n\t\t\t\t\t</td>\n\t\t\t\t</tr>\n\t\t\t\t<tr dojoAttachPoint=\"bgdRepeatRow\" class=\"bgdImageOptRow\">\t\n\t\t\t\t\t<td class='bgdCol1'></td>\n\t\t\t\t\t<td class='bgdOptsLabel'><label>${veNLS.bgdBackgroundRepeat}</label></td>\n\t\t\t\t\t<td colspan='3'>\n\t\t\t\t\t\t<select dojoType=\"dijit.form.ComboBox\" dojoAttachPoint='bgdRepeatCB'>\n\t\t\t\t\t\t\t<!--  values added dynamically -->\n\t\t\t\t\t\t</select>\n\t\t\t\t\t</td>\n\t\t\t\t</tr>\n\t\t\t\t<tr dojoAttachPoint=\"bgdPositionRow\" class=\"bgdImageOptRow\">\t\n\t\t\t\t\t<td class='bgdCol1'></td>\n\t\t\t\t\t<td class='bgdOptsLabel'>${veNLS.bgdBackgroundPosition}</td>\n\t\t\t\t\t<td colspan='3'>\n\t<!-- FIXME: regExp, invalidMessage -->\n\t\t\t\t\t\t<select dojoType=\"dijit.form.ComboBox\" dojoAttachPoint='bgdPositionCB'>\n\t\t\t\t\t\t\t<!--  values added dynamically -->\n\t\t\t\t\t\t</select>\n\t\t\t\t\t</td>\n\t\t\t\t</tr>\n\t\t\t\t<tr dojoAttachPoint=\"bgdSizeRow\" class=\"bgdImageOptRow\">\t\n\t\t\t\t\t<td class='bgdCol1'></td>\n\t\t\t\t\t<td class='bgdOptsLabel'>${veNLS.bgdBackgroundSize}</td>\n\t\t\t\t\t<td colspan='3'>\n\t<!-- FIXME: regExp, invalidMessage -->\n\t\t\t\t\t\t<select dojoType=\"dijit.form.ComboBox\" dojoAttachPoint='bgdSizeCB'>\n\t\t\t\t\t\t\t<!--  values added dynamically -->\n\t\t\t\t\t\t</select>\n\t\t\t\t\t</td>\n\t\t\t\t</tr>\n\t\t\t\t<tr dojoAttachPoint=\"bgdOriginRow\" class=\"bgdImageOptRow\">\t\n\t\t\t\t\t<td class='bgdCol1'></td>\n\t\t\t\t\t<td class='bgdOptsLabel'><label>${veNLS.bgdBackgroundOrigin}</label></td>\n\t\t\t\t\t<td colspan='3'>\n\t\t\t\t\t\t<select dojoType=\"dijit.form.ComboBox\" dojoAttachPoint='bgdOriginCB'>\n\t\t\t\t\t\t\t<!--  values added dynamically -->\n\t\t\t\t\t\t</select>\n\t\t\t\t\t</td>\n\t\t\t\t</tr>\n\t\t\t\t<tr dojoAttachPoint=\"bgdClipRow\" class=\"bgdImageOptRow\">\t\n\t\t\t\t\t<td class='bgdCol1'></td>\n\t\t\t\t\t<td class='bgdOptsLabel'><label>${veNLS.bgdBackgroundClip}</label></td>\n\t\t\t\t\t<td colspan='3'>\n\t\t\t\t\t\t<select dojoType=\"dijit.form.ComboBox\" dojoAttachPoint='bgdClipCB'>\n\t\t\t\t\t\t\t<!--  values added dynamically -->\n\t\t\t\t\t\t</select>\n\t\t\t\t\t</td>\n\t\t\t\t</tr>\n\t\t\t\t<tr dojoAttachPoint=\"bgdOtherTypeInRow\" class=\"bgdOtherRow\">\t\n\t\n\t\t\t\t\t<td class='bgdCol1'></td>\n\t\t\t\t\t<td class='bgdOptsLabel'><label>${veNLS.bgdBackgroundImageValue}</label></td>\n\t\t\t\t\t<td colspan='3'>\n\t\t\t\t\t\t<textarea dojoType=\"dijit.form.Textarea\" dojoAttachPoint='bgdOtherTA'></textarea>\n\t\t\t\t\t</td>\n\t\n\t\t\t\t</tr>\n\t\n\t\t\t</table>\n\t\t</div>\n\t</div>\n\n\t<div class=\"dijitDialogPaneActionBar\">\n\t\t<span dojoType='dijit.form.Button' dojoAttachPoint=\"_okButton\" dojoAttachEvent='onClick:okButton' label='${buttonOk}' class=\"maqPrimaryButton\" type=\"submit\"></span> \n\t\t<span dojoType='dijit.form.Button' dojoAttachEvent='onClick:cancelButton' label='${buttonCancel}' class=\"maqSecondaryButton\"/></span> \n\t</div>\t\t\n</div>\n","dojox/grid/_FocusManager":function(){
define("dojox/grid/_FocusManager",["dojo/_base/array","dojo/_base/lang","dojo/_base/declare","dojo/_base/connect","dojo/_base/event","dojo/_base/sniff","dojo/query","./util","dojo/_base/html"],function(array,lang,_2e82,_2e83,event,has,query,util,html){
return _2e82("dojox.grid._FocusManager",null,{constructor:function(_2e84){
this.grid=_2e84;
this.cell=null;
this.rowIndex=-1;
this._connects=[];
this._headerConnects=[];
this.headerMenu=this.grid.headerMenu;
this._connects.push(_2e83.connect(this.grid.domNode,"onfocus",this,"doFocus"));
this._connects.push(_2e83.connect(this.grid.domNode,"onblur",this,"doBlur"));
this._connects.push(_2e83.connect(this.grid.domNode,"mousedown",this,"_mouseDown"));
this._connects.push(_2e83.connect(this.grid.domNode,"mouseup",this,"_mouseUp"));
this._connects.push(_2e83.connect(this.grid.domNode,"oncontextmenu",this,"doContextMenu"));
this._connects.push(_2e83.connect(this.grid.lastFocusNode,"onfocus",this,"doLastNodeFocus"));
this._connects.push(_2e83.connect(this.grid.lastFocusNode,"onblur",this,"doLastNodeBlur"));
this._connects.push(_2e83.connect(this.grid,"_onFetchComplete",this,"_delayedCellFocus"));
this._connects.push(_2e83.connect(this.grid,"postrender",this,"_delayedHeaderFocus"));
},destroy:function(){
array.forEach(this._connects,_2e83.disconnect);
array.forEach(this._headerConnects,_2e83.disconnect);
delete this.grid;
delete this.cell;
},_colHeadNode:null,_colHeadFocusIdx:null,_contextMenuBindNode:null,tabbingOut:false,focusClass:"dojoxGridCellFocus",focusView:null,initFocusView:function(){
this.focusView=this.grid.views.getFirstScrollingView()||this.focusView||this.grid.views.views[0];
this._initColumnHeaders();
},isFocusCell:function(_2e85,_2e86){
return (this.cell==_2e85)&&(this.rowIndex==_2e86);
},isLastFocusCell:function(){
if(this.cell){
return (this.rowIndex==this.grid.rowCount-1)&&(this.cell.index==this.grid.layout.cellCount-1);
}
return false;
},isFirstFocusCell:function(){
if(this.cell){
return (this.rowIndex===0)&&(this.cell.index===0);
}
return false;
},isNoFocusCell:function(){
return (this.rowIndex<0)||!this.cell;
},isNavHeader:function(){
return (!!this._colHeadNode);
},getHeaderIndex:function(){
if(this._colHeadNode){
return array.indexOf(this._findHeaderCells(),this._colHeadNode);
}else{
return -1;
}
},_focusifyCellNode:function(_2e87){
var n=this.cell&&this.cell.getNode(this.rowIndex);
if(n){
html.toggleClass(n,this.focusClass,_2e87);
if(_2e87){
var sl=this.scrollIntoView();
try{
if(has("webkit")||!this.grid.edit.isEditing()){
util.fire(n,"focus");
if(sl){
this.cell.view.scrollboxNode.scrollLeft=sl;
}
}
}
catch(e){
}
}
}
},_delayedCellFocus:function(){
if(this.isNavHeader()||!this.grid.focused){
return;
}
var n=this.cell&&this.cell.getNode(this.rowIndex);
if(n){
try{
if(!this.grid.edit.isEditing()){
html.toggleClass(n,this.focusClass,true);
if(this._colHeadNode){
this.blurHeader();
}
util.fire(n,"focus");
}
}
catch(e){
}
}
},_delayedHeaderFocus:function(){
if(this.isNavHeader()){
this.focusHeader();
}
},_initColumnHeaders:function(){
array.forEach(this._headerConnects,_2e83.disconnect);
this._headerConnects=[];
var _2e88=this._findHeaderCells();
for(var i=0;i<_2e88.length;i++){
this._headerConnects.push(_2e83.connect(_2e88[i],"onfocus",this,"doColHeaderFocus"));
this._headerConnects.push(_2e83.connect(_2e88[i],"onblur",this,"doColHeaderBlur"));
}
},_findHeaderCells:function(){
var _2e89=query("th",this.grid.viewsHeaderNode);
var _2e8a=[];
for(var i=0;i<_2e89.length;i++){
var aHead=_2e89[i];
var _2e8b=html.hasAttr(aHead,"tabIndex");
var _2e8c=html.attr(aHead,"tabIndex");
if(_2e8b&&_2e8c<0){
_2e8a.push(aHead);
}
}
return _2e8a;
},_setActiveColHeader:function(_2e8d,_2e8e,_2e8f){
this.grid.domNode.setAttribute("aria-activedescendant",_2e8d.id);
if(_2e8f!=null&&_2e8f>=0&&_2e8f!=_2e8e){
html.toggleClass(this._findHeaderCells()[_2e8f],this.focusClass,false);
}
html.toggleClass(_2e8d,this.focusClass,true);
this._colHeadNode=_2e8d;
this._colHeadFocusIdx=_2e8e;
this._scrollHeader(this._colHeadFocusIdx);
},scrollIntoView:function(){
var info=(this.cell?this._scrollInfo(this.cell):null);
if(!info||!info.s){
return null;
}
var rt=this.grid.scroller.findScrollTop(this.rowIndex);
if(info.n&&info.sr){
if(info.n.offsetLeft+info.n.offsetWidth>info.sr.l+info.sr.w){
info.s.scrollLeft=info.n.offsetLeft+info.n.offsetWidth-info.sr.w;
}else{
if(info.n.offsetLeft<info.sr.l){
info.s.scrollLeft=info.n.offsetLeft;
}
}
}
if(info.r&&info.sr){
if(rt+info.r.offsetHeight>info.sr.t+info.sr.h){
this.grid.setScrollTop(rt+info.r.offsetHeight-info.sr.h);
}else{
if(rt<info.sr.t){
this.grid.setScrollTop(rt);
}
}
}
return info.s.scrollLeft;
},_scrollInfo:function(cell,_2e90){
if(cell){
var cl=cell,sbn=cl.view.scrollboxNode,sbnr={w:sbn.clientWidth,l:sbn.scrollLeft,t:sbn.scrollTop,h:sbn.clientHeight},rn=cl.view.getRowNode(this.rowIndex);
return {c:cl,s:sbn,sr:sbnr,n:(_2e90?_2e90:cell.getNode(this.rowIndex)),r:rn};
}
return null;
},_scrollHeader:function(_2e91){
var info=null;
if(this._colHeadNode){
var cell=this.grid.getCell(_2e91);
if(!cell){
return;
}
info=this._scrollInfo(cell,cell.getNode(0));
}
if(info&&info.s&&info.sr&&info.n){
var _2e92=info.sr.l+info.sr.w;
if(info.n.offsetLeft+info.n.offsetWidth>_2e92){
info.s.scrollLeft=info.n.offsetLeft+info.n.offsetWidth-info.sr.w;
}else{
if(info.n.offsetLeft<info.sr.l){
info.s.scrollLeft=info.n.offsetLeft;
}else{
if(has("ie")<=7&&cell&&cell.view.headerNode){
cell.view.headerNode.scrollLeft=info.s.scrollLeft;
}
}
}
}
},_isHeaderHidden:function(){
var _2e93=this.focusView;
if(!_2e93){
for(var i=0,cView;(cView=this.grid.views.views[i]);i++){
if(cView.headerNode){
_2e93=cView;
break;
}
}
}
return (_2e93&&html.getComputedStyle(_2e93.headerNode).display=="none");
},colSizeAdjust:function(e,_2e94,delta){
var _2e95=this._findHeaderCells();
var view=this.focusView;
if(!view||!view.header.tableMap.map){
for(var i=0,cView;(cView=this.grid.views.views[i]);i++){
if(cView.header.tableMap.map){
view=cView;
break;
}
}
}
var _2e96=_2e95[_2e94];
if(!view||(_2e94==_2e95.length-1&&_2e94===0)){
return;
}
view.content.baseDecorateEvent(e);
e.cellNode=_2e96;
e.cellIndex=view.content.getCellNodeIndex(e.cellNode);
e.cell=(e.cellIndex>=0?this.grid.getCell(e.cellIndex):null);
if(view.header.canResize(e)){
var _2e97={l:delta};
var drag=view.header.colResizeSetup(e,false);
view.header.doResizeColumn(drag,null,_2e97);
view.update();
}
},styleRow:function(inRow){
return;
},setFocusIndex:function(_2e98,_2e99){
this.setFocusCell(this.grid.getCell(_2e99),_2e98);
},setFocusCell:function(_2e9a,_2e9b){
if(_2e9a&&!this.isFocusCell(_2e9a,_2e9b)){
this.tabbingOut=false;
if(this._colHeadNode){
this.blurHeader();
}
this._colHeadNode=this._colHeadFocusIdx=null;
this.focusGridView();
this._focusifyCellNode(false);
this.cell=_2e9a;
this.rowIndex=_2e9b;
this._focusifyCellNode(true);
}
if(has("opera")){
setTimeout(lang.hitch(this.grid,"onCellFocus",this.cell,this.rowIndex),1);
}else{
this.grid.onCellFocus(this.cell,this.rowIndex);
}
},next:function(){
if(this.cell){
var row=this.rowIndex,col=this.cell.index+1,cc=this.grid.layout.cellCount-1,rc=this.grid.rowCount-1;
if(col>cc){
col=0;
row++;
}
if(row>rc){
col=cc;
row=rc;
}
if(this.grid.edit.isEditing()){
var _2e9c=this.grid.getCell(col);
if(!this.isLastFocusCell()&&(!_2e9c.editable||this.grid.canEdit&&!this.grid.canEdit(_2e9c,row))){
this.cell=_2e9c;
this.rowIndex=row;
this.next();
return;
}
}
this.setFocusIndex(row,col);
}
},previous:function(){
if(this.cell){
var row=(this.rowIndex||0),col=(this.cell.index||0)-1;
if(col<0){
col=this.grid.layout.cellCount-1;
row--;
}
if(row<0){
row=0;
col=0;
}
if(this.grid.edit.isEditing()){
var _2e9d=this.grid.getCell(col);
if(!this.isFirstFocusCell()&&!_2e9d.editable){
this.cell=_2e9d;
this.rowIndex=row;
this.previous();
return;
}
}
this.setFocusIndex(row,col);
}
},move:function(_2e9e,_2e9f){
var _2ea0=_2e9f<0?-1:1;
if(this.isNavHeader()){
var _2ea1=this._findHeaderCells();
var _2ea2=currentIdx=array.indexOf(_2ea1,this._colHeadNode);
currentIdx+=_2e9f;
while(currentIdx>=0&&currentIdx<_2ea1.length&&_2ea1[currentIdx].style.display=="none"){
currentIdx+=_2ea0;
}
if((currentIdx>=0)&&(currentIdx<_2ea1.length)){
this._setActiveColHeader(_2ea1[currentIdx],currentIdx,_2ea2);
}
}else{
if(this.cell){
var sc=this.grid.scroller,r=this.rowIndex,rc=this.grid.rowCount-1,row=Math.min(rc,Math.max(0,r+_2e9e));
if(_2e9e){
if(_2e9e>0){
if(row>sc.getLastPageRow(sc.page)){
this.grid.setScrollTop(this.grid.scrollTop+sc.findScrollTop(row)-sc.findScrollTop(r));
}
}else{
if(_2e9e<0){
if(row<=sc.getPageRow(sc.page)){
this.grid.setScrollTop(this.grid.scrollTop-sc.findScrollTop(r)-sc.findScrollTop(row));
}
}
}
}
var cc=this.grid.layout.cellCount-1,i=this.cell.index,col=Math.min(cc,Math.max(0,i+_2e9f));
var cell=this.grid.getCell(col);
while(col>=0&&col<cc&&cell&&cell.hidden===true){
col+=_2ea0;
cell=this.grid.getCell(col);
}
if(!cell||cell.hidden===true){
col=i;
}
var n=cell.getNode(row);
if(!n&&_2e9e){
if((row+_2e9e)>=0&&(row+_2e9e)<=rc){
this.move(_2e9e>0?++_2e9e:--_2e9e,_2e9f);
}
return;
}else{
if((!n||html.style(n,"display")==="none")&&_2e9f){
if((col+_2e9f)>=0&&(col+_2e9f)<=cc){
this.move(_2e9e,_2e9f>0?++_2e9f:--_2e9f);
}
return;
}
}
this.setFocusIndex(row,col);
if(_2e9e){
this.grid.updateRow(r);
}
}
}
},previousKey:function(e){
if(this.grid.edit.isEditing()){
event.stop(e);
this.previous();
}else{
if(!this.isNavHeader()&&!this._isHeaderHidden()){
this.grid.domNode.focus();
event.stop(e);
}else{
this.tabOut(this.grid.domNode);
if(this._colHeadFocusIdx!=null){
html.toggleClass(this._findHeaderCells()[this._colHeadFocusIdx],this.focusClass,false);
this._colHeadFocusIdx=null;
}
this._focusifyCellNode(false);
}
}
},nextKey:function(e){
var _2ea3=(this.grid.rowCount===0);
if(e.target===this.grid.domNode&&this._colHeadFocusIdx==null){
this.focusHeader();
event.stop(e);
}else{
if(this.isNavHeader()){
this.blurHeader();
if(!this.findAndFocusGridCell()){
this.tabOut(this.grid.lastFocusNode);
}
this._colHeadNode=this._colHeadFocusIdx=null;
}else{
if(this.grid.edit.isEditing()){
event.stop(e);
this.next();
}else{
this.tabOut(this.grid.lastFocusNode);
}
}
}
},tabOut:function(_2ea4){
this.tabbingOut=true;
_2ea4.focus();
},focusGridView:function(){
util.fire(this.focusView,"focus");
},focusGrid:function(_2ea5){
this.focusGridView();
this._focusifyCellNode(true);
},findAndFocusGridCell:function(){
var _2ea6=true;
var _2ea7=(this.grid.rowCount===0);
if(this.isNoFocusCell()&&!_2ea7){
var _2ea8=0;
var cell=this.grid.getCell(_2ea8);
if(cell.hidden){
_2ea8=this.isNavHeader()?this._colHeadFocusIdx:0;
}
this.setFocusIndex(0,_2ea8);
}else{
if(this.cell&&!_2ea7){
if(this.focusView&&!this.focusView.rowNodes[this.rowIndex]){
this.grid.scrollToRow(this.rowIndex);
}
this.focusGrid();
}else{
_2ea6=false;
}
}
this._colHeadNode=this._colHeadFocusIdx=null;
return _2ea6;
},focusHeader:function(){
var _2ea9=this._findHeaderCells();
var _2eaa=this._colHeadFocusIdx;
if(this._isHeaderHidden()){
this.findAndFocusGridCell();
}else{
if(!this._colHeadFocusIdx){
if(this.isNoFocusCell()){
this._colHeadFocusIdx=0;
}else{
this._colHeadFocusIdx=this.cell.index;
}
}
}
this._colHeadNode=_2ea9[this._colHeadFocusIdx];
while(this._colHeadNode&&this._colHeadFocusIdx>=0&&this._colHeadFocusIdx<_2ea9.length&&this._colHeadNode.style.display=="none"){
this._colHeadFocusIdx++;
this._colHeadNode=_2ea9[this._colHeadFocusIdx];
}
if(this._colHeadNode&&this._colHeadNode.style.display!="none"){
if(this.headerMenu&&this._contextMenuBindNode!=this.grid.domNode){
this.headerMenu.unBindDomNode(this.grid.viewsHeaderNode);
this.headerMenu.bindDomNode(this.grid.domNode);
this._contextMenuBindNode=this.grid.domNode;
}
this._setActiveColHeader(this._colHeadNode,this._colHeadFocusIdx,_2eaa);
this._scrollHeader(this._colHeadFocusIdx);
this._focusifyCellNode(false);
}else{
this.findAndFocusGridCell();
}
},blurHeader:function(){
html.removeClass(this._colHeadNode,this.focusClass);
html.removeAttr(this.grid.domNode,"aria-activedescendant");
if(this.headerMenu&&this._contextMenuBindNode==this.grid.domNode){
var _2eab=this.grid.viewsHeaderNode;
this.headerMenu.unBindDomNode(this.grid.domNode);
this.headerMenu.bindDomNode(_2eab);
this._contextMenuBindNode=_2eab;
}
},doFocus:function(e){
if(e&&e.target!=e.currentTarget){
event.stop(e);
return;
}
if(this._clickFocus){
return;
}
if(!this.tabbingOut){
this.focusHeader();
}
this.tabbingOut=false;
event.stop(e);
},doBlur:function(e){
event.stop(e);
},doContextMenu:function(e){
if(!this.headerMenu){
event.stop(e);
}
},doLastNodeFocus:function(e){
if(this.tabbingOut){
this._focusifyCellNode(false);
}else{
if(this.grid.rowCount>0){
if(this.isNoFocusCell()){
this.setFocusIndex(0,0);
}
this._focusifyCellNode(true);
}else{
this.focusHeader();
}
}
this.tabbingOut=false;
event.stop(e);
},doLastNodeBlur:function(e){
event.stop(e);
},doColHeaderFocus:function(e){
this._setActiveColHeader(e.target,html.attr(e.target,"idx"),this._colHeadFocusIdx);
this._scrollHeader(this.getHeaderIndex());
event.stop(e);
},doColHeaderBlur:function(e){
html.toggleClass(e.target,this.focusClass,false);
},_mouseDown:function(e){
this._clickFocus=dojo.some(this.grid.views.views,function(v){
return v.scrollboxNode===e.target;
});
},_mouseUp:function(e){
this._clickFocus=false;
}});
});
},"davinci/ve/actions/SurroundAction":function(){
define(["dojo/_base/declare","davinci/ve/actions/ContextAction","davinci/commands/CompoundCommand","davinci/ve/commands/RemoveCommand","davinci/ve/commands/AddCommand","davinci/ve/commands/ReparentCommand","davinci/ve/widget"],function(_2eac,_2ead,_2eae,_2eaf,_2eb0,_2eb1,_2eb2){
return _2eac("davinci.ve.actions.SurroundAction",[_2ead],{run:function(_2eb3){
_2eb3=this.fixupContext(_2eb3);
var _2eb4,tag=this.item.surroundWithTagName;
if(!tag){
console.error("missing surroundWithTagName");
return;
}
dojo.withDoc(_2eb3.getDocument(),function(){
_2eb4=_2eb2.createWidget({type:"html."+tag,properties:{},children:[],context:_2eb3});
});
var _2eb5=new _2eae(),_2eb6=[].concat(_2eb3.getSelection()),first=_2eb6[0],_2eb7=first.getParent();
_2eb6.sort(function(a,b){
return _2eb7.indexOf(a)-_2eb7.indexOf(b);
});
_2eb5.add(new _2eb0(_2eb4,_2eb7,_2eb7.indexOf(first)));
dojo.forEach(_2eb6,function(w){
_2eb5.add(new _2eb1(w,_2eb4,"last"));
});
_2eb3.getCommandStack().execute(_2eb5);
},isEnabled:function(_2eb8){
_2eb8=this.fixupContext(_2eb8);
if(_2eb8&&_2eb8.getSelection().length){
var _2eb9=_2eb8.getSelection()[0].getParent(),_2eba=[];
var _2ebb=dojo.every(_2eb8.getSelection(),function(_2ebc){
_2eba.push(_2eb9.indexOf(_2ebc));
return _2eb9.id==_2ebc.getParent().id;
});
if(_2ebb){
_2eba.sort();
var i,j;
for(i=_2eba.shift();_2eba.length;i=j){
j=_2eba.shift();
if(j!=i+1){
return false;
}
}
return true;
}
}
return false;
}});
});
},"davinci/ui/TextStyler":function(){
define(["orion/textview/annotations"],function(_2ebd){
var _2ebe=["break","case","class","catch","continue","const","debugger","default","delete","do","else","enum","export","extends","false","finally","for","function","if","implements","import","in","instanceof","interface","let","new","null","package","private","protected","public","return","static","super","switch","this","throw","true","try","typeof","undefined","var","void","while","with","yield"];
var _2ebf=["abstract","boolean","break","byte","case","catch","char","class","continue","default","do","double","else","extends","false","final","finally","float","for","if","implements","import","instanceof","int","interface","long","native","new","null","package","private","protected","public","return","short","static","super","switch","synchronized","this","throw","throws","transient","true","try","void","volatile","while"];
var _2ec0=["alignment-adjust","alignment-baseline","animation","animation-delay","animation-direction","animation-duration","animation-iteration-count","animation-name","animation-play-state","animation-timing-function","appearance","azimuth","backface-visibility","background","background-attachment","background-clip","background-color","background-image","background-origin","background-position","background-repeat","background-size","baseline-shift","binding","bleed","bookmark-label","bookmark-level","bookmark-state","bookmark-target","border","border-bottom","border-bottom-color","border-bottom-left-radius","border-bottom-right-radius","border-bottom-style","border-bottom-width","border-collapse","border-color","border-image","border-image-outset","border-image-repeat","border-image-slice","border-image-source","border-image-width","border-left","border-left-color","border-left-style","border-left-width","border-radius","border-right","border-right-color","border-right-style","border-right-width","border-spacing","border-style","border-top","border-top-color","border-top-left-radius","border-top-right-radius","border-top-style","border-top-width","border-width","bottom","box-align","box-decoration-break","box-direction","box-flex","box-flex-group","box-lines","box-ordinal-group","box-orient","box-pack","box-shadow","box-sizing","break-after","break-before","break-inside","caption-side","clear","clip","color","color-profile","column-count","column-fill","column-gap","column-rule","column-rule-color","column-rule-style","column-rule-width","column-span","column-width","columns","content","counter-increment","counter-reset","crop","cue","cue-after","cue-before","cursor","direction","display","dominant-baseline","drop-initial-after-adjust","drop-initial-after-align","drop-initial-before-adjust","drop-initial-before-align","drop-initial-size","drop-initial-value","elevation","empty-cells","fit","fit-position","flex-align","flex-flow","flex-inline-pack","flex-order","flex-pack","float","float-offset","font","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","grid-columns","grid-rows","hanging-punctuation","height","hyphenate-after","hyphenate-before","hyphenate-character","hyphenate-lines","hyphenate-resource","hyphens","icon","image-orientation","image-rendering","image-resolution","inline-box-align","left","letter-spacing","line-height","line-stacking","line-stacking-ruby","line-stacking-shift","line-stacking-strategy","list-style","list-style-image","list-style-position","list-style-type","margin","margin-bottom","margin-left","margin-right","margin-top","mark","mark-after","mark-before","marker-offset","marks","marquee-direction","marquee-loop","marquee-play-count","marquee-speed","marquee-style","max-height","max-width","min-height","min-width","move-to","nav-down","nav-index","nav-left","nav-right","nav-up","opacity","orphans","outline","outline-color","outline-offset","outline-style","outline-width","overflow","overflow-style","overflow-x","overflow-y","padding","padding-bottom","padding-left","padding-right","padding-top","page","page-break-after","page-break-before","page-break-inside","page-policy","pause","pause-after","pause-before","perspective","perspective-origin","phonemes","pitch","pitch-range","play-during","position","presentation-level","punctuation-trim","quotes","rendering-intent","resize","rest","rest-after","rest-before","richness","right","rotation","rotation-point","ruby-align","ruby-overhang","ruby-position","ruby-span","size","speak","speak-header","speak-numeral","speak-punctuation","speech-rate","stress","string-set","table-layout","target","target-name","target-new","target-position","text-align","text-align-last","text-decoration","text-emphasis","text-height","text-indent","text-justify","text-outline","text-shadow","text-transform","text-wrap","top","transform","transform-origin","transform-style","transition","transition-delay","transition-duration","transition-property","transition-timing-function","unicode-bidi","vertical-align","visibility","voice-balance","voice-duration","voice-family","voice-pitch","voice-pitch-range","voice-rate","voice-stress","voice-volume","volume","white-space","white-space-collapse","widows","width","word-break","word-spacing","word-wrap","z-index"];
var _2ec1=1;
var _2ec2=2;
var _2ec3=3;
var _2ec4=4;
var _2ec5=5;
var _2ec6=6;
var _2ec7=7;
var _2ec8=8;
var WHITE=9;
var _2ec9=10;
var _2eca=11;
var _2ecb=12;
var _2ecc=13;
var _2ecd=14;
var _2ece={styleClass:"token_singleline_comment"};
var _2ecf={styleClass:"token_multiline_comment"};
var _2ed0={styleClass:"token_doc_comment"};
var _2ed1={styleClass:"token_doc_html_markup"};
var _2ed2={styleClass:"token_task_tag"};
var _2ed3={styleClass:"token_doc_tag"};
var _2ed4={styleClass:"token_string"};
var _2ed5={styleClass:"token_number"};
var _2ed6={styleClass:"token_keyword"};
var _2ed7={styleClass:"token_space"};
var _2ed8={styleClass:"token_tab"};
var _2ed9={styleClass:"line_caret"};
var _2eda={styleClass:"ruler"};
var _2edb={styleCLass:"ruler.annotations"};
var _2edc={styleClass:"ruler.lines"};
var _2edd={styleClass:"ruler.overview"};
var _2ede={styleCLass:"rulerLines"};
var _2edf={styleClass:"rulerLines.even"};
var _2ee0={styleClass:"rulerLines.odd"};
function _2ee1(_2ee2,_2ee3){
this.keywords=_2ee2;
this.whitespacesVisible=_2ee3;
this.setText("");
};
_2ee1.prototype={getOffset:function(){
return this.offset;
},getStartOffset:function(){
return this.startOffset;
},getData:function(){
return this.text.substring(this.startOffset,this.offset);
},getDataLength:function(){
return this.offset-this.startOffset;
},_default:function(c){
switch(c){
case 32:
case 9:
if(this.whitespacesVisible){
return c===32?_2eca:_2ec9;
}
do{
c=this._read();
}while(c===32||c===9);
this._unread(c);
return WHITE;
case 123:
case 125:
case 40:
case 41:
case 91:
case 93:
case 60:
case 62:
return c;
default:
var isCSS=this.isCSS;
var off=this.offset-1;
if(!isCSS&&48<=c&&c<=57){
var _2ee4=false,_2ee5=false,hex=false,_2ee6=c;
do{
c=this._read();
if(c===46&&!_2ee4){
_2ee4=true;
}else{
if(c===101&&!_2ee5){
_2ee4=_2ee5=true;
c=this._read();
if(c!==45){
this._unread(c);
}
}else{
if(c===120&&_2ee6===48&&(this.offset-off===2)){
_2ee4=_2ee5=hex=true;
}else{
if(!(48<=c&&c<=57||(hex&&((65<=c&&c<=70)||(97<=c&&c<=102))))){
break;
}
}
}
}
}while(true);
this._unread(c);
return _2ec3;
}
if((97<=c&&c<=122)||(65<=c&&c<=90)||c===95||(45===c&&isCSS)){
do{
c=this._read();
}while((97<=c&&c<=122)||(65<=c&&c<=90)||c===95||(48<=c&&c<=57)||(45===c&&isCSS));
this._unread(c);
var _2ee7=this.keywords;
if(_2ee7.length>0){
var word=this.text.substring(off,this.offset);
for(var i=0;i<_2ee7.length;i++){
if(this.keywords[i]===word){
return _2ec2;
}
}
}
}
return _2ec1;
}
},_read:function(){
if(this.offset<this.text.length){
return this.text.charCodeAt(this.offset++);
}
return -1;
},_unread:function(c){
if(c!==-1){
this.offset--;
}
},nextToken:function(){
this.startOffset=this.offset;
while(true){
var c=this._read(),_2ee8;
switch(c){
case -1:
return null;
case 47:
c=this._read();
if(!this.isCSS){
if(c===47){
while(true){
c=this._read();
if((c===-1)||(c===10)||(c===13)){
this._unread(c);
return _2ec6;
}
}
}
}
if(c===42){
c=this._read();
var token=_2ec7;
if(c===42){
token=_2ec8;
}
while(true){
while(c===42){
c=this._read();
if(c===47){
return token;
}
}
if(c===-1){
this._unread(c);
return token;
}
c=this._read();
}
}
this._unread(c);
return _2ec1;
case 39:
_2ee8=_2ec4;
while(true){
c=this._read();
switch(c){
case 39:
return _2ee8;
case 13:
case 10:
case -1:
this._unread(c);
return _2ee8;
case 92:
c=this._read();
switch(c){
case 10:
_2ee8=_2ec5;
break;
case 13:
_2ee8=_2ec5;
c=this._read();
if(c!==10){
this._unread(c);
}
break;
}
break;
}
}
break;
case 34:
_2ee8=_2ec4;
while(true){
c=this._read();
switch(c){
case 34:
return _2ee8;
case 13:
case 10:
case -1:
this._unread(c);
return _2ee8;
case 92:
c=this._read();
switch(c){
case 10:
_2ee8=_2ec5;
break;
case 13:
_2ee8=_2ec5;
c=this._read();
if(c!==10){
this._unread(c);
}
break;
}
break;
}
}
break;
default:
return this._default(c);
}
}
},setText:function(text){
this.text=text;
this.offset=0;
this.startOffset=0;
}};
function _2ee9(){
_2ee1.call(this,null,true);
};
_2ee9.prototype=new _2ee1(null);
_2ee9.prototype.nextToken=function(){
this.startOffset=this.offset;
while(true){
var c=this._read();
switch(c){
case -1:
return null;
case 32:
return _2eca;
case 9:
return _2ec9;
default:
do{
c=this._read();
}while(!(c===32||c===9||c===-1));
this._unread(c);
return _2ec1;
}
}
};
function _2eea(_2eeb){
_2ee1.call(this,null,_2eeb);
};
_2eea.prototype=new _2ee1(null);
_2eea.prototype.setType=function(type){
this._type=type;
};
_2eea.prototype.nextToken=function(){
this.startOffset=this.offset;
while(true){
var c=this._read();
switch(c){
case -1:
return null;
case 32:
case 9:
if(this.whitespacesVisible){
return c===32?_2eca:_2ec9;
}
do{
c=this._read();
}while(c===32||c===9);
this._unread(c);
return WHITE;
case 60:
if(this._type===_2ec8){
do{
c=this._read();
}while(!(c===62||c===-1));
if(c===62){
return _2ecb;
}
}
return _2ec1;
case 64:
if(this._type===_2ec8){
do{
c=this._read();
}while((97<=c&&c<=122)||(65<=c&&c<=90)||c===95||(48<=c&&c<=57));
this._unread(c);
return _2ecc;
}
return _2ec1;
case 84:
if((c=this._read())===79){
if((c=this._read())===68){
if((c=this._read())===79){
c=this._read();
if(!((97<=c&&c<=122)||(65<=c&&c<=90)||c===95||(48<=c&&c<=57))){
this._unread(c);
return _2ecd;
}
this._unread(c);
}else{
this._unread(c);
}
}else{
this._unread(c);
}
}else{
this._unread(c);
}
default:
do{
c=this._read();
}while(!(c===32||c===9||c===-1||c===60||c===64||c===84));
this._unread(c);
return _2ec1;
}
}
};
function _2eec(){
_2ee1.call(this,null,false);
};
_2eec.prototype=new _2ee1(null);
_2eec.prototype._default=function(c){
while(true){
c=this._read();
switch(c){
case 47:
case 34:
case 39:
case -1:
this._unread(c);
return _2ec1;
}
}
};
function _2eed(view,lang,_2eee){
this.commentStart="/*";
this.commentEnd="*/";
var _2eef=[];
switch(lang){
case "java":
_2eef=_2ebf;
break;
case "js":
_2eef=_2ebe;
break;
case "css":
_2eef=_2ec0;
break;
}
this.whitespacesVisible=false;
this.detectHyperlinks=true;
this.highlightCaretLine=false;
this.foldingEnabled=true;
this.detectTasks=true;
this._scanner=new _2ee1(_2eef,this.whitespacesVisible);
this._firstScanner=new _2eec();
this._commentScanner=new _2eea(this.whitespacesVisible);
this._whitespaceScanner=new _2ee9();
if(lang==="css"){
this._scanner.isCSS=true;
this._firstScanner.isCSS=true;
}
this.view=view;
this.annotationModel=_2eee;
this._bracketAnnotations=undefined;
var self=this;
this._listener={onChanged:function(e){
self._onModelChanged(e);
},onDestroy:function(e){
self._onDestroy(e);
},onLineStyle:function(e){
self._onLineStyle(e);
},onSelection:function(e){
self._onSelection(e);
}};
var model=view.getModel();
if(model.getBaseModel){
model.getBaseModel().addEventListener("Changed",this._listener.onChanged);
}else{
view.addEventListener("ModelChanged",this._listener.onChanged);
}
view.addEventListener("Selection",this._listener.onSelection);
view.addEventListener("Destroy",this._listener.onDestroy);
view.addEventListener("LineStyle",this._listener.onLineStyle);
this._computeComments();
this._computeFolding();
view.redrawLines();
};
_2eed.prototype={getClassNameForToken:function(token){
switch(token){
case "singleLineComment":
return _2ece.styleClass;
case "multiLineComment":
return _2ecf.styleClass;
case "docComment":
return _2ed0.styleClass;
case "docHtmlComment":
return _2ed1.styleClass;
case "tasktag":
return _2ed2.styleClass;
case "doctag":
return _2ed3.styleClass;
case "string":
return _2ed4.styleClass;
case "number":
return _2ed5.styleClass;
case "keyword":
return _2ed6.styleClass;
case "space":
return _2ed7.styleClass;
case "tab":
return _2ed8.styleClass;
case "caretLine":
return _2ed9.styleClass;
case "rulerStyle":
return _2eda.styleClass;
case "annotationsStyle":
return _2edb.styleClass;
case "rulerFolding":
return _2ede.styleClass;
case "rulerOverview":
return _2edd.styleClass;
case "rulerLines":
return _2ede.styleClass;
case "rulerLinesEven":
return _2edf.styleClass;
case "rulerLinesOdd":
return _2ee0.styleClass;
}
return null;
},destroy:function(){
var view=this.view;
if(view){
var model=view.getModel();
if(model.getBaseModel){
model.getBaseModel().removeEventListener("Changed",this._listener.onChanged);
}else{
view.removeEventListener("ModelChanged",this._listener.onChanged);
}
view.removeEventListener("Selection",this._listener.onSelection);
view.removeEventListener("Destroy",this._listener.onDestroy);
view.removeEventListener("LineStyle",this._listener.onLineStyle);
this.view=null;
}
},setHighlightCaretLine:function(_2ef0){
this.highlightCaretLine=_2ef0;
},setWhitespacesVisible:function(_2ef1){
this.whitespacesVisible=_2ef1;
this._scanner.whitespacesVisible=_2ef1;
this._commentScanner.whitespacesVisible=_2ef1;
},setDetectHyperlinks:function(_2ef2){
this.detectHyperlinks=_2ef2;
},setFoldingEnabled:function(_2ef3){
this.foldingEnabled=_2ef3;
},setDetectTasks:function(_2ef4){
this.detectTasks=_2ef4;
},_binarySearch:function(array,_2ef5,_2ef6,low,high){
var index;
if(low===undefined){
low=-1;
}
if(high===undefined){
high=array.length;
}
while(high-low>1){
index=Math.floor((high+low)/2);
if(_2ef5<=array[index].start){
high=index;
}else{
if(_2ef6&&_2ef5<array[index].end){
high=index;
break;
}else{
low=index;
}
}
}
return high;
},_computeComments:function(){
var model=this.view.getModel();
if(model.getBaseModel){
model=model.getBaseModel();
}
this.comments=this._findComments(model.getText());
},_computeFolding:function(){
if(!this.foldingEnabled){
return;
}
var view=this.view;
var _2ef7=view.getModel();
if(!_2ef7.getBaseModel){
return;
}
var _2ef8=this.annotationModel;
if(!_2ef8){
return;
}
_2ef8.removeAnnotations(_2ebd.AnnotationType.ANNOTATION_FOLDING);
var add=[];
var _2ef9=_2ef7.getBaseModel();
var _2efa=this.comments;
for(var i=0;i<_2efa.length;i++){
var _2efb=_2efa[i];
var _2efc=this._createFoldingAnnotation(_2ef7,_2ef9,_2efb.start,_2efb.end);
if(_2efc){
add.push(_2efc);
}
}
_2ef8.replaceAnnotations(null,add);
},_createFoldingAnnotation:function(_2efd,_2efe,start,end){
var _2eff=_2efe.getLineAtOffset(start);
var _2f00=_2efe.getLineAtOffset(end);
if(_2eff===_2f00){
return null;
}
return new (_2ebd.AnnotationType.getType(_2ebd.AnnotationType.ANNOTATION_FOLDING))(start,end,_2efd);
},_computeTasks:function(type,_2f01,_2f02){
if(!this.detectTasks){
return;
}
var _2f03=this.annotationModel;
if(!_2f03){
return;
}
var view=this.view;
var _2f04=view.getModel(),_2f05=_2f04;
if(_2f04.getBaseModel){
_2f05=_2f04.getBaseModel();
}
var _2f06=_2f03.getAnnotations(_2f01,_2f02);
var _2f07=[];
var _2f08=_2ebd.AnnotationType.ANNOTATION_TASK;
while(_2f06.hasNext()){
var _2f09=_2f06.next();
if(_2f09.type===_2f08){
_2f07.push(_2f09);
}
}
var add=[];
var _2f0a=this._commentScanner;
_2f0a.setText(_2f05.getText(_2f01,_2f02));
var token;
while((token=_2f0a.nextToken())){
var _2f0b=_2f0a.getStartOffset()+_2f01;
if(token===_2ecd){
var end=_2f05.getLineEnd(_2f05.getLineAtOffset(_2f0b));
if(type!==_2ec6){
end=Math.min(end,_2f02-this.commentEnd.length);
}
add.push(_2ebd.AnnotationType.createAnnotation(_2f08,_2f0b,end,_2f05.getText(_2f0b,end)));
}
}
_2f03.replaceAnnotations(_2f07,add);
},_getLineStyle:function(_2f0c){
if(this.highlightCaretLine){
var view=this.view;
var model=view.getModel();
var _2f0d=view.getSelection();
if(_2f0d.start===_2f0d.end&&model.getLineAtOffset(_2f0d.start)===_2f0c){
return _2ed9;
}
}
return null;
},_getStyles:function(model,text,start){
if(model.getBaseModel){
start=model.mapOffset(start);
}
var end=start+text.length;
var _2f0e=[];
var _2f0f=start,_2f10=this.comments;
var _2f11=this._binarySearch(_2f10,start,true);
for(var i=_2f11;i<_2f10.length;i++){
if(_2f10[i].start>=end){
break;
}
var _2f12=_2f10[i].start;
var _2f13=_2f10[i].end;
if(_2f0f<_2f12){
this._parse(text.substring(_2f0f-start,_2f12-start),_2f0f,_2f0e);
}
var type=_2f10[i].type,style;
switch(type){
case _2ec8:
style=_2ed0;
break;
case _2ec7:
style=_2ecf;
break;
case _2ec5:
style=_2ed4;
break;
}
var s=Math.max(_2f0f,_2f12);
var e=Math.min(end,_2f13);
if((type===_2ec8||type===_2ec7)&&(this.whitespacesVisible||this.detectHyperlinks)){
this._parseComment(text.substring(s-start,e-start),s,_2f0e,style,type);
}else{
if(type===_2ec5&&this.whitespacesVisible){
this._parseString(text.substring(s-start,e-start),s,_2f0e,_2ed4);
}else{
_2f0e.push({start:s,end:e,style:style});
}
}
_2f0f=_2f13;
}
if(_2f0f<end){
this._parse(text.substring(_2f0f-start,end-start),_2f0f,_2f0e);
}
if(model.getBaseModel){
for(var j=0;j<_2f0e.length;j++){
var _2f14=_2f0e[j].end-_2f0e[j].start;
_2f0e[j].start=model.mapOffset(_2f0e[j].start,true);
_2f0e[j].end=_2f0e[j].start+_2f14;
}
}
return _2f0e;
},_parse:function(text,_2f15,_2f16){
var _2f17=this._scanner;
_2f17.setText(text);
var token;
while((token=_2f17.nextToken())){
var _2f18=_2f17.getStartOffset()+_2f15;
var style=null;
switch(token){
case _2ec2:
style=_2ed6;
break;
case _2ec3:
style=_2ed5;
break;
case _2ec5:
case _2ec4:
if(this.whitespacesVisible){
this._parseString(_2f17.getData(),_2f18,_2f16,_2ed4);
continue;
}else{
style=_2ed4;
}
break;
case _2ec8:
this._parseComment(_2f17.getData(),_2f18,_2f16,_2ed0,token);
continue;
case _2ec6:
this._parseComment(_2f17.getData(),_2f18,_2f16,_2ece,token);
continue;
case _2ec7:
this._parseComment(_2f17.getData(),_2f18,_2f16,_2ecf,token);
continue;
case _2ec9:
if(this.whitespacesVisible){
style=_2ed8;
}
break;
case _2eca:
if(this.whitespacesVisible){
style=_2ed7;
}
break;
}
_2f16.push({start:_2f18,end:_2f17.getOffset()+_2f15,style:style});
}
},_parseComment:function(text,_2f19,_2f1a,s,type){
var _2f1b=this._commentScanner;
_2f1b.setText(text);
_2f1b.setType(type);
var token;
while((token=_2f1b.nextToken())){
var _2f1c=_2f1b.getStartOffset()+_2f19;
var style=s;
switch(token){
case _2ec9:
if(this.whitespacesVisible){
style=_2ed8;
}
break;
case _2eca:
if(this.whitespacesVisible){
style=_2ed7;
}
break;
case _2ecb:
style=_2ed1;
break;
case _2ecc:
style=_2ed3;
break;
case _2ecd:
style=_2ed2;
break;
default:
if(this.detectHyperlinks){
style=this._detectHyperlinks(_2f1b.getData(),_2f1c,_2f1a,style);
}
}
if(style){
_2f1a.push({start:_2f1c,end:_2f1b.getOffset()+_2f19,style:style});
}
}
},_parseString:function(text,_2f1d,_2f1e,s){
var _2f1f=this._whitespaceScanner;
_2f1f.setText(text);
var token;
while((token=_2f1f.nextToken())){
var _2f20=_2f1f.getStartOffset()+_2f1d;
var style=s;
switch(token){
case _2ec9:
if(this.whitespacesVisible){
style=_2ed8;
}
break;
case _2eca:
if(this.whitespacesVisible){
style=_2ed7;
}
break;
}
if(style){
_2f1e.push({start:_2f20,end:_2f1f.getOffset()+_2f1d,style:style});
}
}
},_detectHyperlinks:function(text,_2f21,_2f22,s){
var href=null,index,_2f23;
if((index=text.indexOf("://"))>0){
href=text;
var start=index;
while(start>0){
var c=href.charCodeAt(start-1);
if(!((97<=c&&c<=122)||(65<=c&&c<=90)||45===c||(48<=c&&c<=57))){
break;
}
start--;
}
if(start>0){
var _2f24="\"\"''(){}[]<>";
index=_2f24.indexOf(href.substring(start-1,start));
if(index!==-1&&(index&1)===0&&(index=href.lastIndexOf(_2f24.substring(index+1,index+2)))!==-1){
var end=index;
_2f23=this._clone(s);
_2f23.tagName="A";
_2f23.attributes={href:href.substring(start,end)};
_2f22.push({start:_2f21,end:_2f21+start,style:s});
_2f22.push({start:_2f21+start,end:_2f21+end,style:_2f23});
_2f22.push({start:_2f21+end,end:_2f21+text.length,style:s});
return null;
}
}
}else{
if(text.toLowerCase().indexOf("bug#")===0){
href="https://bugs.eclipse.org/bugs/show_bug.cgi?id="+parseInt(text.substring(4),10);
}
}
if(href){
_2f23=this._clone(s);
_2f23.tagName="A";
_2f23.attributes={href:href};
return _2f23;
}
return s;
},_clone:function(obj){
if(!obj){
return obj;
}
var _2f25={};
for(var p in obj){
if(obj.hasOwnProperty(p)){
var value=obj[p];
_2f25[p]=value;
}
}
return _2f25;
},_findComments:function(text,_2f26){
_2f26=_2f26||0;
var _2f27=this._firstScanner,token;
_2f27.setText(text);
var _2f28=[];
while((token=_2f27.nextToken())){
if(token===_2ec7||token===_2ec8||token===_2ec5){
_2f28.push({start:_2f27.getStartOffset()+_2f26,end:_2f27.getOffset()+_2f26,type:token});
}
if(token===_2ec6||token===_2ec7||token===_2ec8){
this._computeTasks(token,_2f27.getStartOffset()+_2f26,_2f27.getOffset()+_2f26);
}
}
return _2f28;
},_findMatchingBracket:function(model,_2f29){
var _2f2a="{}()[]<>";
var _2f2b=model.getText(_2f29,_2f29+1);
var _2f2c=_2f2a.indexOf(_2f2b,0);
if(_2f2c===-1){
return -1;
}
var _2f2d;
if(_2f2c&1){
_2f2d=_2f2a.substring(_2f2c-1,_2f2c);
}else{
_2f2d=_2f2a.substring(_2f2c+1,_2f2c+2);
}
var _2f2e=model.getLineAtOffset(_2f29);
var _2f2f=model.getLine(_2f2e);
var _2f30=model.getLineStart(_2f2e);
var _2f31=model.getLineEnd(_2f2e);
_2f2a=this._findBrackets(_2f2b,_2f2d,_2f2f,_2f30,_2f30,_2f31);
for(var i=0;i<_2f2a.length;i++){
var sign=_2f2a[i]>=0?1:-1;
if(_2f2a[i]*sign===_2f29){
var level=1;
if(_2f2c&1){
i--;
for(;i>=0;i--){
sign=_2f2a[i]>=0?1:-1;
level+=sign;
if(level===0){
return _2f2a[i]*sign;
}
}
_2f2e-=1;
while(_2f2e>=0){
_2f2f=model.getLine(_2f2e);
_2f30=model.getLineStart(_2f2e);
_2f31=model.getLineEnd(_2f2e);
_2f2a=this._findBrackets(_2f2b,_2f2d,_2f2f,_2f30,_2f30,_2f31);
for(var j=_2f2a.length-1;j>=0;j--){
sign=_2f2a[j]>=0?1:-1;
level+=sign;
if(level===0){
return _2f2a[j]*sign;
}
}
_2f2e--;
}
}else{
i++;
for(;i<_2f2a.length;i++){
sign=_2f2a[i]>=0?1:-1;
level+=sign;
if(level===0){
return _2f2a[i]*sign;
}
}
_2f2e+=1;
var _2f32=model.getLineCount();
while(_2f2e<_2f32){
_2f2f=model.getLine(_2f2e);
_2f30=model.getLineStart(_2f2e);
_2f31=model.getLineEnd(_2f2e);
_2f2a=this._findBrackets(_2f2b,_2f2d,_2f2f,_2f30,_2f30,_2f31);
for(var k=0;k<_2f2a.length;k++){
sign=_2f2a[k]>=0?1:-1;
level+=sign;
if(level===0){
return _2f2a[k]*sign;
}
}
_2f2e++;
}
}
break;
}
}
return -1;
},_findBrackets:function(_2f33,_2f34,text,_2f35,start,end){
var _2f36=[];
var _2f37=_2f33.charCodeAt(0);
var _2f38=_2f34.charCodeAt(0);
var _2f39=start,_2f3a=this._scanner,token,_2f3b=this.comments;
var _2f3c=this._binarySearch(_2f3b,start,true);
for(var i=_2f3c;i<_2f3b.length;i++){
if(_2f3b[i].start>=end){
break;
}
var _2f3d=_2f3b[i].start;
var _2f3e=_2f3b[i].end;
if(_2f39<_2f3d){
_2f3a.setText(text.substring(_2f39-start,_2f3d-start));
while((token=_2f3a.nextToken())){
if(token===_2f37){
_2f36.push(_2f3a.getStartOffset()+_2f39-start+_2f35);
}else{
if(token===_2f38){
_2f36.push(-(_2f3a.getStartOffset()+_2f39-start+_2f35));
}
}
}
}
_2f39=_2f3e;
}
if(_2f39<end){
_2f3a.setText(text.substring(_2f39-start,end-start));
while((token=_2f3a.nextToken())){
if(token===_2f37){
_2f36.push(_2f3a.getStartOffset()+_2f39-start+_2f35);
}else{
if(token===_2f38){
_2f36.push(-(_2f3a.getStartOffset()+_2f39-start+_2f35));
}
}
}
}
return _2f36;
},_onDestroy:function(e){
this.destroy();
},_onLineStyle:function(e){
if(e.textView===this.view){
e.style=this._getLineStyle(e.lineIndex);
}
e.ranges=this._getStyles(e.textView.getModel(),e.lineText,e.lineStart);
},_onSelection:function(e){
var _2f3f=e.oldValue;
var _2f40=e.newValue;
var view=this.view;
var model=view.getModel();
var _2f41;
if(this.highlightCaretLine){
var _2f42=model.getLineAtOffset(_2f3f.start);
_2f41=model.getLineAtOffset(_2f40.start);
var _2f43=_2f40.start===_2f40.end;
var _2f44=_2f3f.start===_2f3f.end;
if(!(_2f42===_2f41&&_2f44&&_2f43)){
if(_2f44){
view.redrawLines(_2f42,_2f42+1);
}
if((_2f42!==_2f41||!_2f44)&&_2f43){
view.redrawLines(_2f41,_2f41+1);
}
}
}
if(!this.annotationModel){
return;
}
var _2f45=this._bracketAnnotations,add,caret;
if(_2f40.start===_2f40.end&&(caret=view.getCaretOffset())>0){
var _2f46=caret-1;
if(model.getBaseModel){
_2f46=model.mapOffset(_2f46);
model=model.getBaseModel();
}
var _2f47=this._findMatchingBracket(model,_2f46);
if(_2f47!==-1){
add=[_2ebd.AnnotationType.createAnnotation(_2ebd.AnnotationType.ANNOTATION_MATCHING_BRACKET,_2f47,_2f47+1),_2ebd.AnnotationType.createAnnotation(_2ebd.AnnotationType.ANNOTATION_CURRENT_BRACKET,_2f46,_2f46+1)];
}
}
this._bracketAnnotations=add;
this.annotationModel.replaceAnnotations(_2f45,add);
},_onModelChanged:function(e){
var start=e.start;
var _2f48=e.removedCharCount;
var _2f49=e.addedCharCount;
var _2f4a=_2f49-_2f48;
var view=this.view;
var _2f4b=view.getModel();
var _2f4c=_2f4b.getBaseModel?_2f4b.getBaseModel():_2f4b;
var end=start+_2f48;
var _2f4d=_2f4c.getCharCount();
var _2f4e=this.comments.length;
var _2f4f=_2f4c.getLineStart(_2f4c.getLineAtOffset(start));
var _2f50=this._binarySearch(this.comments,_2f4f,true);
var _2f51=this._binarySearch(this.comments,end,false,_2f50-1,_2f4e);
var ts;
if(_2f50<_2f4e&&this.comments[_2f50].start<=_2f4f&&_2f4f<this.comments[_2f50].end){
ts=this.comments[_2f50].start;
if(ts>start){
ts+=_2f4a;
}
}else{
if(_2f50===_2f4e&&_2f4e>0&&_2f4d-_2f4a===this.comments[_2f4e-1].end){
ts=this.comments[_2f4e-1].start;
}else{
ts=_2f4f;
}
}
var te;
if(_2f51<_2f4e){
te=this.comments[_2f51].end;
if(te>start){
te+=_2f4a;
}
_2f51+=1;
}else{
_2f51=_2f4e;
te=_2f4d;
}
var text=_2f4c.getText(ts,te),_2f52;
var _2f53=this._findComments(text,ts),i;
for(i=_2f50;i<this.comments.length;i++){
_2f52=this.comments[i];
if(_2f52.start>start){
_2f52.start+=_2f4a;
}
if(_2f52.start>start){
_2f52.end+=_2f4a;
}
}
var _2f54=(_2f51-_2f50)!==_2f53.length;
if(!_2f54){
for(i=0;i<_2f53.length;i++){
_2f52=this.comments[_2f50+i];
var _2f55=_2f53[i];
if(_2f52.start!==_2f55.start||_2f52.end!==_2f55.end||_2f52.type!==_2f55.type){
_2f54=true;
break;
}
}
}
var args=[_2f50,_2f51-_2f50].concat(_2f53);
Array.prototype.splice.apply(this.comments,args);
if(_2f54){
var _2f56=ts;
var _2f57=te;
if(_2f4b!==_2f4c){
_2f56=_2f4b.mapOffset(_2f56,true);
_2f57=_2f4b.mapOffset(_2f57,true);
}
view.redrawRange(_2f56,_2f57);
}
if(this.foldingEnabled&&_2f4c!==_2f4b&&this.annotationModel){
var _2f58=this.annotationModel;
var iter=_2f58.getAnnotations(ts,te);
var _2f59=[],all=[];
var _2f5a;
while(iter.hasNext()){
_2f5a=iter.next();
if(_2f5a.type===_2ebd.AnnotationType.ANNOTATION_FOLDING){
all.push(_2f5a);
for(i=0;i<_2f53.length;i++){
if(_2f5a.start===_2f53[i].start&&_2f5a.end===_2f53[i].end){
break;
}
}
if(i===_2f53.length){
_2f59.push(_2f5a);
_2f5a.expand();
}else{
var _2f5b=_2f5a.start;
var _2f5c=_2f5a.end;
if(_2f5b>start){
_2f5b-=_2f4a;
}
if(_2f5c>start){
_2f5c-=_2f4a;
}
if(_2f5b<=start&&start<_2f5c&&_2f5b<=end&&end<_2f5c){
var _2f5d=_2f4c.getLineAtOffset(_2f5a.start);
var _2f5e=_2f4c.getLineAtOffset(_2f5a.end);
if(_2f5d!==_2f5e){
if(!_2f5a.expanded){
_2f5a.expand();
_2f58.modifyAnnotation(_2f5a);
}
}else{
_2f58.removeAnnotation(_2f5a);
}
}
}
}
}
var add=[];
for(i=0;i<_2f53.length;i++){
_2f52=_2f53[i];
for(var j=0;j<all.length;j++){
if(all[j].start===_2f52.start&&all[j].end===_2f52.end){
break;
}
}
if(j===all.length){
_2f5a=this._createFoldingAnnotation(_2f4b,_2f4c,_2f52.start,_2f52.end);
if(_2f5a){
add.push(_2f5a);
}
}
}
_2f58.replaceAnnotations(_2f59,add);
}
}};
return {TextStyler:_2eed};
});
},"davinci/workbench/ViewPart":function(){
define("davinci/workbench/ViewPart",["dojo/_base/declare","davinci/workbench/_ToolbaredContainer","davinci/ve/States"],function(_2f5f,_2f60,_2f61){
return _2f5f("davinci.workbench.ViewPart",_2f60,{constructor:function(_2f62,_2f63){
this.viewExt=_2f62.view;
this.subscriptions=[];
this.publishing={};
},startup:function(){
this.inherited(arguments);
this.domNode.view=this;
if(this.viewExt.startup){
this.viewExt.startup();
}
},subscribe:function(topic,func){
this.subscriptions.push(dojo.subscribe(topic,this,func));
},publish:function(topic,data){
this.publishing[topic]=true;
try{
dojo.publish(topic,data);
}
catch(e){
console.error(e);
}
delete this.publishing[topic];
},destroy:function(){
dojo.forEach(this.subscriptions,dojo.unsubscribe);
delete this.subscriptions;
},_getViewActions:function(){
var _2f64=this.toolbarID||this.viewExt.id;
var _2f65=[];
var _2f66=davinci.Runtime.getExtensions("davinci.viewActions",function(ext){
if(_2f64==ext.viewContribution.targetID){
_2f65.push(ext.viewContribution);
return true;
}
});
return _2f65;
}});
});
},"url:dijit/templates/Dialog.html":"<div class=\"dijitDialog\" role=\"dialog\" aria-labelledby=\"${id}_title\">\n\t<div data-dojo-attach-point=\"titleBar\" class=\"dijitDialogTitleBar\">\n\t\t<span data-dojo-attach-point=\"titleNode\" class=\"dijitDialogTitle\" id=\"${id}_title\"\n\t\t\t\trole=\"header\" level=\"1\"></span>\n\t\t<span data-dojo-attach-point=\"closeButtonNode\" class=\"dijitDialogCloseIcon\" data-dojo-attach-event=\"ondijitclick: onCancel\" title=\"${buttonCancel}\" role=\"button\" tabIndex=\"-1\">\n\t\t\t<span data-dojo-attach-point=\"closeText\" class=\"closeText\" title=\"${buttonCancel}\">x</span>\n\t\t</span>\n\t</div>\n\t<div data-dojo-attach-point=\"containerNode\" class=\"dijitDialogPaneContent\"></div>\n</div>\n","davinci/model/Path":function(){
define("davinci/model/Path",["dojo/_base/declare"],function(_2f67){
if(typeof davinci.model==="undefined"){
davinci.model={};
}
if(typeof davinci.model.Path==="undefined"){
davinci.model.Path={};
}
var Path=_2f67("davinci.model.Path",null,{constructor:function(path,_2f68,_2f69){
path=path||".";
if(typeof path=="string"){
this.path=path;
this.getSegments();
}else{
this.segments=path;
this.hasLeading=_2f68;
this.hasTrailing=_2f69;
}
},endsWith:function(tail){
var _2f6a=dojo.clone(this.segments);
var _2f6b=(new Path(tail)).getSegments();
while(_2f6b.length>0&&_2f6a.length>0){
if(_2f6b.pop()!=_2f6a.pop()){
return false;
}
}
return true;
},getExtension:function(){
if(!this.extension){
this.extension=this.path.substr(this.path.lastIndexOf(".")+1);
}
return this.extension;
},segment:function(index){
var segs=this.getSegments();
if(segs.length<index){
return null;
}
return segs[index];
},getSegments:function(){
if(!this.segments){
var path=this.path;
this.segments=path.split("/");
if(path.charAt(0)=="/"){
this.hasLeading=true;
}
if(path.charAt(path.length-1)=="/"){
this.hasTrailing=true;
this.segments.pop();
}
this._canonicalize();
}
return this.segments;
},isAbsolute:function(){
return this.hasLeading;
},getParentPath:function(){
if(!this._parentPath){
var _2f6c=dojo.clone(this.segments);
_2f6c.pop();
this._parentPath=new Path(_2f6c,this.hasLeading);
}
return dojo.clone(this._parentPath);
},_clone:function(){
return new Path(dojo.clone(this.segments),this.hasLeading,this.hasTrailing);
},append:function(tail){
tail=tail||"";
if(typeof tail=="string"){
tail=new Path(tail);
}
if(tail.isAbsolute()){
return tail;
}
var _2f6d=this.segments;
var _2f6e=tail.getSegments();
var _2f6f=_2f6d.concat(_2f6e);
var _2f70=new Path(_2f6f,this.hasLeading,tail.hasTrailing);
if(_2f6e[0]==".."||_2f6e[0]=="."){
_2f70._canonicalize();
}
return _2f70;
},toString:function(){
var _2f71=[];
if(this.hasLeading){
_2f71.push("/");
}
for(var i=0;i<this.segments.length;i++){
if(i>0){
_2f71.push("/");
}
_2f71.push(this.segments[i]);
}
if(this.hasTrailing){
_2f71.push("/");
}
return _2f71.join("");
},removeRelative:function(){
var segs=this.getSegments();
if(segs.length>0&&segs[1]=="."){
return this.removeFirstSegments(1);
}
return this;
},relativeTo:function(base,_2f72){
if(typeof base=="string"){
base=new Path(base);
}
var _2f73=this.segments;
if(this.isAbsolute()){
return this;
}
var _2f74=base.getSegments();
var _2f75=this.matchingFirstSegments(base);
var _2f76=_2f74.length;
if(_2f72){
_2f76=_2f76-1;
}
var _2f77=_2f76-_2f75;
var _2f78=_2f77+_2f73.length-_2f75;
if(_2f78==0){
return davinci.model.Path.EMPTY;
}
var _2f79=[];
for(var i=0;i<_2f77;i++){
_2f79.push("..");
}
for(var i=_2f75;i<_2f73.length;i++){
_2f79.push(_2f73[i]);
}
return new Path(_2f79,false,this.hasTrailing);
},startsWith:function(_2f7a){
var count=this.matchingFirstSegments(_2f7a);
return _2f7a._length()==count;
},_length:function(_2f7b){
return this.segments.length;
},matchingFirstSegments:function(_2f7c){
var _2f7d=this.segments;
var _2f7e=_2f7c.getSegments();
var max=Math.min(_2f7d.length,_2f7e.length);
var count=0;
for(var i=0;i<max;i++){
if(_2f7d[i]!=_2f7e[i]){
return count;
}
count++;
}
return count;
},removeFirstSegments:function(count){
return new Path(this.segments.slice(count,this.segments.length),this.hasLeading,this.hasTrailing);
},removeMatchingLastSegments:function(_2f7f){
var match=this.matchingFirstSegments(_2f7f);
return this.removeLastSegments(match);
},removeMatchingFirstSegments:function(_2f80){
var match=this.matchingFirstSegments(_2f80);
return this._clone().removeFirstSegments(match);
},removeLastSegments:function(count){
if(!count){
count=1;
}
return new Path(this.segments.slice(0,this.segments.length-count),this.hasLeading,this.hasTrailing);
},lastSegment:function(){
return this.segments[this.segments.length-1];
},firstSegment:function(_2f81){
return this.segments[_2f81||0];
},equals:function(_2f82){
if(this.segments.length!=_2f82.segments.length){
return false;
}
for(var i=0;i<this.segments.length;i++){
if(_2f82.segments[i]!=this.segments[i]){
return false;
}
}
return true;
},_canonicalize:function(){
var doIt;
var _2f83=this.segments;
for(var i=0;i<_2f83.length;i++){
if(_2f83[i]=="."||_2f83[i]==".."){
doIt=true;
break;
}
}
if(doIt){
var stack=[];
for(var i=0;i<_2f83.length;i++){
if(_2f83[i]==".."){
if(stack.length==0){
if(!this.hasLeading){
stack.push(_2f83[i]);
}
}else{
if(".."==stack[stack.length-1]){
stack.push("..");
}else{
stack.pop();
}
}
}else{
if(_2f83[i]!="."||this.segments.length==1){
stack.push(_2f83[i]);
}
}
}
if(stack.length==_2f83.length){
return;
}
this.segments=stack;
}
}});
davinci.model.Path.EMPTY=new Path("");
return Path;
});
},"davinci/ui/widgets/ThemeSelection":function(){
define(["dojo/_base/declare","dijit/_Widget","davinci/library","davinci/Runtime","davinci/Workbench","system/resource","dojo/i18n!davinci/ui/nls/ui","dojo/i18n!dijit/nls/common"],function(_2f84,_2f85,_2f86,_2f87,_2f88,_2f89,uiNLS,_2f8a){
return _2f84("davinci.ui.widgets.ThemeSelection",[_2f85],{workspaceOnly:true,message:"Theme version does not match workspace version this could produce unexpected results. We suggest recreating the custom theme using the current version of Maqetta and deleting the existing theme.",buildRendering:function(){
var div=dojo.doc.createElement("div");
this._select=dojo.doc.createElement("select");
div.appendChild(this._select);
this._warnDiv=dojo.doc.createElement("div");
div.appendChild(this._warnDiv);
this.domNode=div;
dojo.style(this._select,"width","180px");
dojo.style(this.domNode,"width","100%");
dojo.connect(this._select,"onchange",this,"_onChange");
},postCreate:function(){
this._themeData=_2f86.getThemes(_2f88.getProject(),this.workspaceOnly);
this._themeCount=this._themeData.length;
for(var i=0;i<this._themeData.length;i++){
var op=dojo.doc.createElement("option");
op.value=this._themeData[i].name;
op.text=this._themeData[i].name;
this._select.appendChild(op);
}
if(this._selection){
this._selectValue(this._selection);
}
},_setBaseAttr:function(base){
this._base=base;
},_getBaseAttr:function(){
return this._base;
},_getNumberOfThemesAttr:function(){
return this._themeCount;
},_setValueAttr:function(value){
if(!this._hasValue(value)){
return;
}
this._selection=value;
if(value&&value.name){
this._selection=value.name;
}
this._selectValue(this._selection);
},_hasValue:function(_2f8b){
for(var i=0;i<this._select.children.length;i++){
if(this._select.children[i].value==_2f8b){
return true;
}
}
return false;
},_selectValue:function(value){
var found=false;
for(var i=0;i<this._select.children.length;i++){
if(this._select.children[i].selected){
this._select.children[i].selected=false;
}
if(!found&&this._select.children[i].value==value){
this._select.children[i].selected=true;
var found=true;
}
}
if(!found&&value!=null){
var op=dojo.doc.createElement("option");
op.value=value;
op.text=value;
op.selected=true;
this._select.appendChild(op);
}
},_getValueAttr:function(){
var name=dojo.attr(this._select,"value");
for(var i=0;i<this._themeData.length;i++){
if(this._themeData[i]["name"]==name){
return this._themeData[i];
}
}
return null;
},_setWorkspaceOnlyAttr:function(value){
this.workspaceOnly=value;
},onChange:function(){
},_onChange:function(){
var _2f8c=this._getValueAttr();
if(_2f8c==null||this._blockChange){
return;
}
this.value=_2f8c;
this._cookieName="maqetta_"+_2f8c.name+"_"+_2f8c.version;
var _2f8d=dojo.cookie(this._cookieName);
if(this.dojoVersion&&_2f8c.version!==this.dojoVersion&&!_2f8d){
this._warnDiv.innerHTML="<table>"+"<tr><td></td><td>"+this.message+"</td><td></td></tr>"+"<tr><td></td><td align=\"center\"><button data-dojo-type=\"dijit.form.Button\" type=\"button\" id=\"davinci.ui.widgets.ThemeSelection.ok\">Ok</button><button data-dojo-type=\"dijit.form.Button\" type=\"button\" id=\"davinci.ui.widgets.ThemeSelection.cancel\">Cancel</button></td><td></td></tr>"+"</table>";
var ok=dijit.byId("davinci.ui.widgets.ThemeSelection.ok");
var _2f8e=dijit.byId("davinci.ui.widgets.ThemeSelection.cancel");
dojo.connect(ok,"onClick",this,"_warnOk");
dojo.connect(_2f8e,"onClick",this,"_warnCancel");
}else{
this.onChange();
}
},_getThemeDataAttr:function(){
return this._themeData;
},_warnOk:function(){
dojo.cookie(this._cookieName,"true");
this._destroy();
this.onChange();
},_warnCancel:function(){
this._destroy();
this.onClose();
},_destroy:function(){
var ok=dijit.byId("davinci.ui.widgets.ThemeSelection.ok");
dojo.disconnect(ok);
ok.destroy();
var _2f8f=dijit.byId("davinci.ui.widgets.ThemeSelection.cancel");
dojo.disconnect(_2f8f);
_2f8f.destroy();
}});
});
},"davinci/ve/RebaseDownload":function(){
define("davinci/ve/RebaseDownload",["dojo/_base/declare","./RebuildPage","../library"],function(_2f90,_2f91,_2f92){
return _2f90("davinci.ve.RebaseDownload",_2f91,{constructor:function(libs){
this.libs=libs;
},getLibraryBase:function(id,_2f93){
for(var name in this.libs){
var item=this.libs[name];
if(item.id==id&&item.version==_2f93){
return item.root;
}
}
return _2f92.getLibRoot(id,_2f93)||"";
}});
});
},"dojo/cookie":function(){
define("dojo/cookie",["./_base/kernel","./regexp"],function(dojo,_2f94){
dojo.cookie=function(name,value,props){
var c=document.cookie,ret;
if(arguments.length==1){
var _2f95=c.match(new RegExp("(?:^|; )"+_2f94.escapeString(name)+"=([^;]*)"));
ret=_2f95?decodeURIComponent(_2f95[1]):undefined;
}else{
props=props||{};
var exp=props.expires;
if(typeof exp=="number"){
var d=new Date();
d.setTime(d.getTime()+exp*24*60*60*1000);
exp=props.expires=d;
}
if(exp&&exp.toUTCString){
props.expires=exp.toUTCString();
}
value=encodeURIComponent(value);
var _2f96=name+"="+value,_2f97;
for(_2f97 in props){
_2f96+="; "+_2f97;
var _2f98=props[_2f97];
if(_2f98!==true){
_2f96+="="+_2f98;
}
}
document.cookie=_2f96;
}
return ret;
};
dojo.cookie.isSupported=function(){
if(!("cookieEnabled" in navigator)){
this("__djCookieTest__","CookiesAllowed");
navigator.cookieEnabled=this("__djCookieTest__")=="CookiesAllowed";
if(navigator.cookieEnabled){
this("__djCookieTest__","",{expires:-1});
}
}
return navigator.cookieEnabled;
};
return dojo.cookie;
});
},"url:dijit/templates/Tree.html":"<div class=\"dijitTree dijitTreeContainer\" role=\"tree\">\n\t<div class=\"dijitInline dijitTreeIndent\" style=\"position: absolute; top: -9999px\" data-dojo-attach-point=\"indentDetector\"></div>\n</div>\n","dijit/form/_ExpandingTextAreaMixin":function(){
define("dijit/form/_ExpandingTextAreaMixin",["dojo/_base/declare","dojo/dom-construct","dojo/has","dojo/_base/lang","dojo/_base/window","../Viewport"],function(_2f99,_2f9a,has,lang,win,_2f9b){
has.add("textarea-needs-help-shrinking",function(){
var body=win.body(),te=_2f9a.create("textarea",{rows:"5",cols:"20",value:" ",style:{zoom:1,overflow:"hidden",visibility:"hidden",position:"absolute",border:"0px solid black",padding:"0px"}},body,"last");
var _2f9c=te.scrollHeight>=te.clientHeight;
body.removeChild(te);
return _2f9c;
});
return _2f99("dijit.form._ExpandingTextAreaMixin",null,{_setValueAttr:function(){
this.inherited(arguments);
this.resize();
},postCreate:function(){
this.inherited(arguments);
var _2f9d=this.textbox;
this.connect(_2f9d,"onscroll","_resizeLater");
this.connect(_2f9d,"onresize","_resizeLater");
this.connect(_2f9d,"onfocus","_resizeLater");
this.own(_2f9b.on("resize",lang.hitch(this,"_resizeLater")));
_2f9d.style.overflowY="hidden";
this._estimateHeight();
this._resizeLater();
},_onInput:function(e){
this.inherited(arguments);
this.resize();
},_estimateHeight:function(){
var _2f9e=this.textbox;
_2f9e.style.height="auto";
_2f9e.rows=(_2f9e.value.match(/\n/g)||[]).length+2;
},_resizeLater:function(){
this.defer("resize");
},resize:function(){
var _2f9f=this.textbox;
function _2fa0(){
var empty=false;
if(_2f9f.value===""){
_2f9f.value=" ";
empty=true;
}
var sh=_2f9f.scrollHeight;
if(empty){
_2f9f.value="";
}
return sh;
};
if(_2f9f.style.overflowY=="hidden"){
_2f9f.scrollTop=0;
}
if(this.busyResizing){
return;
}
this.busyResizing=true;
if(_2fa0()||_2f9f.offsetHeight){
var _2fa1=_2f9f.style.height;
if(!(/px/.test(_2fa1))){
_2fa1=_2fa0();
_2f9f.rows=1;
_2f9f.style.height=_2fa1+"px";
}
var newH=Math.max(Math.max(_2f9f.offsetHeight,parseInt(_2fa1))-_2f9f.clientHeight,0)+_2fa0();
var _2fa2=newH+"px";
if(_2fa2!=_2f9f.style.height){
_2f9f.rows=1;
_2f9f.style.height=_2fa2;
}
if(has("textarea-needs-help-shrinking")){
var _2fa3=_2fa0(),_2fa4=_2fa3,_2fa5=_2f9f.style.minHeight,_2fa6=4,_2fa7;
_2f9f.style.minHeight=_2fa2;
_2f9f.style.height="auto";
while(newH>0){
_2f9f.style.minHeight=Math.max(newH-_2fa6,4)+"px";
_2fa7=_2fa0();
var _2fa8=_2fa4-_2fa7;
newH-=_2fa8;
if(_2fa8<_2fa6){
break;
}
_2fa4=_2fa7;
_2fa6<<=1;
}
_2f9f.style.height=newH+"px";
_2f9f.style.minHeight=_2fa5;
}
_2f9f.style.overflowY=_2fa0()>_2f9f.clientHeight?"auto":"hidden";
}else{
this._estimateHeight();
}
this.busyResizing=false;
}});
});
},"davinci/ve/palette/PaletteItem":function(){
define(["dojo/_base/declare","dijit/_WidgetBase","davinci/ve/tools/CreateTool","davinci/ui/dnd/DragManager","davinci/ve/utils/GeomUtils","davinci/ve/metadata"],function(_2fa9,_2faa,_2fab,_2fac,_2fad,_2fae){
return _2fa9("davinci.ve.palette.PaletteItem",_2faa,{icon:"",displayName:"",name:"",paletteId:"",type:"",data:null,tool:"",palette:null,category:"",buildRendering:function(){
this.palette=dijit.byId(this.paletteId);
var div=this.domNode=this.palette.itemTemplate.cloneNode(true);
var a=div.firstChild;
dojo.attr(a,"tabIndex","0");
a.onclick=this.palette.nop;
var img=a.firstChild;
img.src=this.icon;
a.appendChild(dojo.doc.createTextNode(this.displayName));
dojo.create("span",{className:"maqWidgetsCategory"},a).textContent=this.category;
this.domNode.componentClassName=this.name;
dojo.setSelectable(this.domNode,false);
},postCreate:function(){
this.connect(this.domNode,"onmouseover","itemMouseOverHandler");
this.connect(this.domNode,"onmouseout","itemMouseOutHandler");
this.connect(this.domNode,"onmousedown","itemMouseDownHandler");
this.connect(this.domNode,"onmouseup","itemMouseUpHandler");
this.connect(this.domNode,"onkeydown","itemKeyDownHandler");
},startup:function(){
},isFocusable:function(){
return dojo.style(this.domNode,"display")!="none";
},focus:function(){
dijit.focus(this.domNode);
},itemMouseOverHandler:function(e){
var div=this.domNode;
if(this.palette.selectedItem==this){
}else{
this.raised(div);
}
},itemMouseOutHandler:function(e){
var div=this.domNode;
if(this.palette.selectedItem==this){
this.sunken(div);
}else{
this.flat(div);
}
if(this.tooltip){
this.tooltip.close();
}
},itemMouseDownHandler:function(e){
var div=this.domNode;
this.focus();
this.sunken(div);
if(this.palette.selectedItem&&this.palette.selectedItem!=this){
this.flat(this.palette.selectedItem.domNode);
this.palette.selectedItem=null;
this.palette.currentItem=null;
}
this.palette.pushedItem=this;
_2fac.document=this.palette._context.getDocument();
var _2faf=this.palette._context.frameNode;
if(_2faf){
var _2fb0=dojo.coords(_2faf);
var _2fb1=this.palette._context.getContainerNode();
_2fac.documentX=_2fb0.x-_2fad.getScrollLeft(_2fb1);
_2fac.documentY=_2fb0.y-_2fad.getScrollTop(_2fb1);
}
_2fae.getHelper(this.type,"helper");
},itemMouseUpHandler:function(e){
if(this.palette.pushedItem!=this){
this.palette.pushedItem=null;
var div=this.domNode;
this.raised(div);
return;
}
if(this.palette.selectedItem==this){
var div=this.domNode;
this.raised(div);
this.palette.selectedItem=null;
this.palette.currentItem=this;
this.palette._context.setActiveTool(null);
return;
}
this.palette.selectedItem=this;
this.palette.pushedItem=null;
this.palette.currentItem=this;
_2fae.getHelper(this.type,"tool").then(function(_2fb2){
var tool=new (_2fb2||_2fab)(dojo.clone(this.data));
this.palette._context.setActiveTool(tool);
}.bind(this));
var _2fb3=function(){
if(this.palette._contextMouseUpHandler){
this.disconnect(this.palette._contextMouseUpHandler);
this.palette._contextMouseUpHandler=null;
}
if(this.palette._docMouseUpHandler){
dojo.disconnect(this.palette._docMouseUpHandler);
this.palette._docMouseUpHandler=null;
}
this.palette.selectedItem=null;
this.palette.currentItem=null;
this.flat(this.domNode);
this.palette._context.dragMoveCleanup();
}.bind(this);
this.palette._contextMouseUpHandler=this.connect(this.palette._context,"onMouseUp",function(e){
_2fb3();
}.bind(this));
setTimeout(function(){
this.palette._docMouseUpHandler=dojo.connect(document,"onmouseup",function(e){
if(this.palette.currentItem){
_2fb3();
this.palette._context.setActiveTool(null);
}
}.bind(this));
}.bind(this),0);
},itemKeyDownHandler:function(e){
if(e.keyCode!=dojo.keys.ENTER){
return;
}
if(this.palette.selectedItem){
this.flat(this.palette.selectedItem.domNode);
this.palette.selectedItem=null;
}
_2fae.getHelper(this.type,"tool").then(function(_2fb4){
var tool=new (_2fb4||_2fab)(dojo.clone(this.data)),_2fb5=this.palette._context;
_2fb5.setActiveTool(tool);
tool.create({target:_2fb5.getSelection()[0],position:{x:50,y:50}});
_2fb5.setActiveTool(null);
_2fb5.getContainerNode().focus();
});
_2fae.getHelper(this.type,"helper");
},flat:function(div){
dojo.removeClass(div,"dojoyPaletteItemRaised");
dojo.removeClass(div,"dojoyPaletteItemSunken");
dojo.addClass(div,"dojoyPaletteItemFlat");
},raised:function(div){
dojo.removeClass(div,"dojoyPaletteItemFlat");
dojo.removeClass(div,"dojoyPaletteItemSunken");
dojo.addClass(div,"dojoyPaletteItemRaised");
},sunken:function(div){
dojo.removeClass(div,"dojoyPaletteItemFlat");
dojo.removeClass(div,"dojoyPaletteItemRaised");
dojo.addClass(div,"dojoyPaletteItemSunken");
}});
});
},"davinci/ui/widgets/NewFolder":function(){
define(["dojo/_base/declare","dijit/_Templated","dijit/_Widget","davinci/library","davinci/Workbench","system/resource","davinci/workbench/Preferences","davinci/Runtime","dijit/Menu","dijit/MenuItem","davinci/model/Path","dijit/form/DropDownButton","dojo/i18n!davinci/ui/nls/ui","dojo/i18n!dijit/nls/common","dojo/text!./templates/NewFolder.html","dijit/form/Button","dijit/form/TextBox","dijit/form/RadioButton"],function(_2fb6,_2fb7,_2fb8,_2fb9,_2fba,_2fbb,_2fbc,_2fbd,Menu,_2fbe,Path,_2fbf,uiNLS,_2fc0,_2fc1){
return _2fb6("davinci.ui.widgets.NewFolder",[_2fb8,_2fb7],{widgetsInTemplate:true,templateString:_2fc1,folderName:null,fileDialogParentFolder:null,okButton:null,uiNLS:uiNLS,postMixInProperties:function(){
this.inherited(arguments);
},postCreate:function(){
this.inherited(arguments);
dojo.connect(this.folderName,"onkeyup",this,"_checkValid");
if(!this._value){
this._setRootAttr(this._getRootAttr());
}
this.okButton.onClick=dojo.hitch(this,this._okButton);
},_setValueAttr:function(value){
if(value==this._value){
return;
}
this._value=value;
var _2fc2="";
if(value&&value.elementType=="Folder"){
this.fileDialogParentFolder.innerHTML=value.getName();
}else{
if(value){
this.fileDialogParentFolder.innerHTML=value.parent.getPath();
}
}
},_setNewFileNameAttr:function(name){
this.folderName.set("value",name);
},_getRootAttr:function(){
if(this._root){
return this._root;
}
var prefs=_2fbc.getPreferences("davinci.ui.ProjectPrefs",base);
if(prefs.webContentFolder!=null&&prefs.webContentFolder!=""){
var _2fc3=new Path(_2fba.getProject()).append(prefs.webContentFolder);
var _2fc4=_2fbb.findResource(_2fc3.toString());
return _2fc4;
}
return _2fbb.findResource(_2fba.getProject());
},_setRootAttr:function(value){
this._root=value;
this.fileDialogParentFolder.innerHTML=value.getPath();
},_checkValid:function(){
var name=this.folderName.get("value");
var valid=name!=null&&name.length>0;
this._okButton.set("disabled",!valid);
},_okButton:function(){
this.value=this.fileDialogParentFolder.innerHTML+"/"+this.folderName.get("value");
var check=this.checkFileName(this.value);
if(check){
return true;
}else{
return false;
}
},_getValueAttr:function(){
this.value=this.fileDialogParentFolder.innerHTML+"/"+this.folderName.get("value");
return this.value;
},_cancelButton:function(){
this.onClose();
},_createResource:function(){
var _2fc5=_2fbb.findResource(this.fileDialogParentFolder.innerHTML+"/"+this.folderName.get("value"));
if(_2fc5){
return _2fc5;
}
var _2fc6=_2fbb.findResource(this.fileDialogParentFolder.innerHTML);
return _2fc6.createResource(this.folderName.get("value"));
},onClose:function(){
}});
});
},"dijit/_Templated":function(){
define("dijit/_Templated",["./_WidgetBase","./_TemplatedMixin","./_WidgetsInTemplateMixin","dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/_base/kernel"],function(_2fc7,_2fc8,_2fc9,array,_2fca,lang,_2fcb){
lang.extend(_2fc7,{waiRole:"",waiState:""});
return _2fca("dijit._Templated",[_2fc8,_2fc9],{widgetsInTemplate:false,constructor:function(){
_2fcb.deprecated(this.declaredClass+": dijit._Templated deprecated, use dijit._TemplatedMixin and if necessary dijit._WidgetsInTemplateMixin","","2.0");
},_attachTemplateNodes:function(_2fcc,_2fcd){
this.inherited(arguments);
var nodes=lang.isArray(_2fcc)?_2fcc:(_2fcc.all||_2fcc.getElementsByTagName("*"));
var x=lang.isArray(_2fcc)?0:-1;
for(;x<nodes.length;x++){
var _2fce=(x==-1)?_2fcc:nodes[x];
var role=_2fcd(_2fce,"waiRole");
if(role){
_2fce.setAttribute("role",role);
}
var _2fcf=_2fcd(_2fce,"waiState");
if(_2fcf){
array.forEach(_2fcf.split(/\s*,\s*/),function(_2fd0){
if(_2fd0.indexOf("-")!=-1){
var pair=_2fd0.split("-");
_2fce.setAttribute("aria-"+pair[0],pair[1]);
}
});
}
}
}});
});
},"dijit/layout/ScrollingTabController":function(){
require({cache:{"url:dijit/layout/templates/ScrollingTabController.html":"<div class=\"dijitTabListContainer-${tabPosition}\" style=\"visibility:hidden\">\n\t<div data-dojo-type=\"dijit.layout._ScrollingTabControllerMenuButton\"\n\t\t\tclass=\"tabStripButton-${tabPosition}\"\n\t\t\tid=\"${id}_menuBtn\"\n\t\t\tdata-dojo-props=\"containerId: '${containerId}', iconClass: 'dijitTabStripMenuIcon',\n\t\t\t\t\tdropDownPosition: ['below-alt', 'above-alt']\"\n\t\t\tdata-dojo-attach-point=\"_menuBtn\" showLabel=\"false\" title=\"\">&#9660;</div>\n\t<div data-dojo-type=\"dijit.layout._ScrollingTabControllerButton\"\n\t\t\tclass=\"tabStripButton-${tabPosition}\"\n\t\t\tid=\"${id}_leftBtn\"\n\t\t\tdata-dojo-props=\"iconClass:'dijitTabStripSlideLeftIcon', showLabel:false, title:''\"\n\t\t\tdata-dojo-attach-point=\"_leftBtn\" data-dojo-attach-event=\"onClick: doSlideLeft\">&#9664;</div>\n\t<div data-dojo-type=\"dijit.layout._ScrollingTabControllerButton\"\n\t\t\tclass=\"tabStripButton-${tabPosition}\"\n\t\t\tid=\"${id}_rightBtn\"\n\t\t\tdata-dojo-props=\"iconClass:'dijitTabStripSlideRightIcon', showLabel:false, title:''\"\n\t\t\tdata-dojo-attach-point=\"_rightBtn\" data-dojo-attach-event=\"onClick: doSlideRight\">&#9654;</div>\n\t<div class='dijitTabListWrapper' data-dojo-attach-point='tablistWrapper'>\n\t\t<div role='tablist' data-dojo-attach-event='onkeypress:onkeypress'\n\t\t\t\tdata-dojo-attach-point='containerNode' class='nowrapTabStrip'></div>\n\t</div>\n</div>","url:dijit/layout/templates/_ScrollingTabControllerButton.html":"<div data-dojo-attach-event=\"onclick:_onClick\" class=\"dijitTabInnerDiv dijitTabContent dijitButtonContents\"  data-dojo-attach-point=\"focusNode\">\n\t<img role=\"presentation\" alt=\"\" src=\"${_blankGif}\" class=\"dijitTabStripIcon\" data-dojo-attach-point=\"iconNode\"/>\n\t<span data-dojo-attach-point=\"containerNode,titleNode\" class=\"dijitButtonText\"></span>\n</div>"}});
define("dijit/layout/ScrollingTabController",["dojo/_base/array","dojo/_base/declare","dojo/dom-class","dojo/dom-geometry","dojo/dom-style","dojo/_base/fx","dojo/_base/lang","dojo/on","dojo/query","dojo/sniff","../registry","dojo/text!./templates/ScrollingTabController.html","dojo/text!./templates/_ScrollingTabControllerButton.html","./TabController","./utils","../_WidgetsInTemplateMixin","../Menu","../MenuItem","../form/Button","../_HasDropDown","dojo/NodeList-dom"],function(array,_2fd1,_2fd2,_2fd3,_2fd4,fx,lang,on,query,has,_2fd5,_2fd6,_2fd7,_2fd8,_2fd9,_2fda,Menu,_2fdb,_2fdc,_2fdd){
var _2fde=_2fd1("dijit.layout.ScrollingTabController",[_2fd8,_2fda],{baseClass:"dijitTabController dijitScrollingTabController",templateString:_2fd6,useMenu:true,useSlider:true,tabStripClass:"",widgetsInTemplate:true,_minScroll:5,_setClassAttr:{node:"containerNode",type:"class"},buildRendering:function(){
this.inherited(arguments);
var n=this.domNode;
this.scrollNode=this.tablistWrapper;
this._initButtons();
if(!this.tabStripClass){
this.tabStripClass="dijitTabContainer"+this.tabPosition.charAt(0).toUpperCase()+this.tabPosition.substr(1).replace(/-.*/,"")+"None";
_2fd2.add(n,"tabStrip-disabled");
}
_2fd2.add(this.tablistWrapper,this.tabStripClass);
},onStartup:function(){
this.inherited(arguments);
_2fd4.set(this.domNode,"visibility","");
this._postStartup=true;
this.own(on(this.containerNode,"attrmodified-label, attrmodified-iconclass",lang.hitch(this,function(evt){
if(this._dim){
this.resize(this._dim);
}
})));
},onAddChild:function(page,_2fdf){
this.inherited(arguments);
_2fd4.set(this.containerNode,"width",(_2fd4.get(this.containerNode,"width")+200)+"px");
},onRemoveChild:function(page,_2fe0){
var _2fe1=this.pane2button[page.id];
if(this._selectedTab===_2fe1.domNode){
this._selectedTab=null;
}
this.inherited(arguments);
},_initButtons:function(){
this._btnWidth=0;
this._buttons=query("> .tabStripButton",this.domNode).filter(function(btn){
if((this.useMenu&&btn==this._menuBtn.domNode)||(this.useSlider&&(btn==this._rightBtn.domNode||btn==this._leftBtn.domNode))){
this._btnWidth+=_2fd3.getMarginSize(btn).w;
return true;
}else{
_2fd4.set(btn,"display","none");
return false;
}
},this);
},_getTabsWidth:function(){
var _2fe2=this.getChildren();
if(_2fe2.length){
var _2fe3=_2fe2[this.isLeftToRight()?0:_2fe2.length-1].domNode,_2fe4=_2fe2[this.isLeftToRight()?_2fe2.length-1:0].domNode;
return _2fe4.offsetLeft+_2fd4.get(_2fe4,"width")-_2fe3.offsetLeft;
}else{
return 0;
}
},_enableBtn:function(width){
var _2fe5=this._getTabsWidth();
width=width||_2fd4.get(this.scrollNode,"width");
return _2fe5>0&&width<_2fe5;
},resize:function(dim){
this._dim=dim;
this.scrollNode.style.height="auto";
var cb=this._contentBox=_2fd9.marginBox2contentBox(this.domNode,{h:0,w:dim.w});
cb.h=this.scrollNode.offsetHeight;
_2fd3.setContentSize(this.domNode,cb);
var _2fe6=this._enableBtn(this._contentBox.w);
this._buttons.style("display",_2fe6?"":"none");
this._leftBtn.layoutAlign="left";
this._rightBtn.layoutAlign="right";
this._menuBtn.layoutAlign=this.isLeftToRight()?"right":"left";
_2fd9.layoutChildren(this.domNode,this._contentBox,[this._menuBtn,this._leftBtn,this._rightBtn,{domNode:this.scrollNode,layoutAlign:"client"}]);
if(this._selectedTab){
if(this._anim&&this._anim.status()=="playing"){
this._anim.stop();
}
this.scrollNode.scrollLeft=this._convertToScrollLeft(this._getScrollForSelectedTab());
}
this._setButtonClass(this._getScroll());
this._postResize=true;
return {h:this._contentBox.h,w:dim.w};
},_getScroll:function(){
return (this.isLeftToRight()||has("ie")<8||(has("ie")&&has("quirks"))||has("webkit"))?this.scrollNode.scrollLeft:_2fd4.get(this.containerNode,"width")-_2fd4.get(this.scrollNode,"width")+(has("ie")>=8?-1:1)*this.scrollNode.scrollLeft;
},_convertToScrollLeft:function(val){
if(this.isLeftToRight()||has("ie")<8||(has("ie")&&has("quirks"))||has("webkit")){
return val;
}else{
var _2fe7=_2fd4.get(this.containerNode,"width")-_2fd4.get(this.scrollNode,"width");
return (has("ie")>=8?-1:1)*(val-_2fe7);
}
},onSelectChild:function(page){
var tab=this.pane2button[page.id];
if(!tab||!page){
return;
}
var node=tab.domNode;
if(node!=this._selectedTab){
this._selectedTab=node;
if(this._postResize){
var sl=this._getScroll();
if(sl>node.offsetLeft||sl+_2fd4.get(this.scrollNode,"width")<node.offsetLeft+_2fd4.get(node,"width")){
this.createSmoothScroll().play();
}
}
}
this.inherited(arguments);
},_getScrollBounds:function(){
var _2fe8=this.getChildren(),_2fe9=_2fd4.get(this.scrollNode,"width"),_2fea=_2fd4.get(this.containerNode,"width"),_2feb=_2fea-_2fe9,_2fec=this._getTabsWidth();
if(_2fe8.length&&_2fec>_2fe9){
return {min:this.isLeftToRight()?0:_2fe8[_2fe8.length-1].domNode.offsetLeft,max:this.isLeftToRight()?(_2fe8[_2fe8.length-1].domNode.offsetLeft+_2fd4.get(_2fe8[_2fe8.length-1].domNode,"width"))-_2fe9:_2feb};
}else{
var _2fed=this.isLeftToRight()?0:_2feb;
return {min:_2fed,max:_2fed};
}
},_getScrollForSelectedTab:function(){
var w=this.scrollNode,n=this._selectedTab,_2fee=_2fd4.get(this.scrollNode,"width"),_2fef=this._getScrollBounds();
var pos=(n.offsetLeft+_2fd4.get(n,"width")/2)-_2fee/2;
pos=Math.min(Math.max(pos,_2fef.min),_2fef.max);
return pos;
},createSmoothScroll:function(x){
if(arguments.length>0){
var _2ff0=this._getScrollBounds();
x=Math.min(Math.max(x,_2ff0.min),_2ff0.max);
}else{
x=this._getScrollForSelectedTab();
}
if(this._anim&&this._anim.status()=="playing"){
this._anim.stop();
}
var self=this,w=this.scrollNode,anim=new fx.Animation({beforeBegin:function(){
if(this.curve){
delete this.curve;
}
var oldS=w.scrollLeft,newS=self._convertToScrollLeft(x);
anim.curve=new fx._Line(oldS,newS);
},onAnimate:function(val){
w.scrollLeft=val;
}});
this._anim=anim;
this._setButtonClass(x);
return anim;
},_getBtnNode:function(e){
var n=e.target;
while(n&&!_2fd2.contains(n,"tabStripButton")){
n=n.parentNode;
}
return n;
},doSlideRight:function(e){
this.doSlide(1,this._getBtnNode(e));
},doSlideLeft:function(e){
this.doSlide(-1,this._getBtnNode(e));
},doSlide:function(_2ff1,node){
if(node&&_2fd2.contains(node,"dijitTabDisabled")){
return;
}
var _2ff2=_2fd4.get(this.scrollNode,"width");
var d=(_2ff2*0.75)*_2ff1;
var to=this._getScroll()+d;
this._setButtonClass(to);
this.createSmoothScroll(to).play();
},_setButtonClass:function(_2ff3){
var _2ff4=this._getScrollBounds();
this._leftBtn.set("disabled",_2ff3<=_2ff4.min);
this._rightBtn.set("disabled",_2ff3>=_2ff4.max);
}});
var _2ff5=_2fd1("dijit.layout._ScrollingTabControllerButtonMixin",null,{baseClass:"dijitTab tabStripButton",templateString:_2fd7,tabIndex:"",isFocusable:function(){
return false;
}});
_2fd1("dijit.layout._ScrollingTabControllerButton",[_2fdc,_2ff5]);
_2fd1("dijit.layout._ScrollingTabControllerMenuButton",[_2fdc,_2fdd,_2ff5],{containerId:"",tabIndex:"-1",isLoaded:function(){
return false;
},loadDropDown:function(_2ff6){
this.dropDown=new Menu({id:this.containerId+"_menu",ownerDocument:this.ownerDocument,dir:this.dir,lang:this.lang,textDir:this.textDir});
var _2ff7=_2fd5.byId(this.containerId);
array.forEach(_2ff7.getChildren(),function(page){
var _2ff8=new _2fdb({id:page.id+"_stcMi",label:page.title,iconClass:page.iconClass,disabled:page.disabled,ownerDocument:this.ownerDocument,dir:page.dir,lang:page.lang,textDir:page.textDir,onClick:function(){
_2ff7.selectChild(page);
}});
this.dropDown.addChild(_2ff8);
},this);
_2ff6();
},closeDropDown:function(focus){
this.inherited(arguments);
if(this.dropDown){
this.dropDown.destroyRecursive();
delete this.dropDown;
}
}});
return _2fde;
});
},"dojo/dnd/Source":function(){
define("dojo/dnd/Source",["../_base/array","../_base/connect","../_base/declare","../_base/kernel","../_base/lang","../dom-class","../dom-geometry","../mouse","../ready","../topic","./common","./Selector","./Manager"],function(array,_2ff9,_2ffa,_2ffb,lang,_2ffc,_2ffd,mouse,ready,topic,dnd,_2ffe,_2fff){
if(!_2ffb.isAsync){
ready(0,function(){
var _3000=["dojo/dnd/AutoSource","dojo/dnd/Target"];
require(_3000);
});
}
var _3001=_2ffa("dojo.dnd.Source",_2ffe,{isSource:true,horizontal:false,copyOnly:false,selfCopy:false,selfAccept:true,skipForm:false,withHandles:false,autoSync:false,delay:0,accept:["text"],generateText:true,constructor:function(node,_3002){
lang.mixin(this,lang.mixin({},_3002));
var type=this.accept;
if(type.length){
this.accept={};
for(var i=0;i<type.length;++i){
this.accept[type[i]]=1;
}
}
this.isDragging=false;
this.mouseDown=false;
this.targetAnchor=null;
this.targetBox=null;
this.before=true;
this._lastX=0;
this._lastY=0;
this.sourceState="";
if(this.isSource){
_2ffc.add(this.node,"dojoDndSource");
}
this.targetState="";
if(this.accept){
_2ffc.add(this.node,"dojoDndTarget");
}
if(this.horizontal){
_2ffc.add(this.node,"dojoDndHorizontal");
}
this.topics=[topic.subscribe("/dnd/source/over",lang.hitch(this,"onDndSourceOver")),topic.subscribe("/dnd/start",lang.hitch(this,"onDndStart")),topic.subscribe("/dnd/drop",lang.hitch(this,"onDndDrop")),topic.subscribe("/dnd/cancel",lang.hitch(this,"onDndCancel"))];
},checkAcceptance:function(_3003,nodes){
if(this==_3003){
return !this.copyOnly||this.selfAccept;
}
for(var i=0;i<nodes.length;++i){
var type=_3003.getItem(nodes[i].id).type;
var flag=false;
for(var j=0;j<type.length;++j){
if(type[j] in this.accept){
flag=true;
break;
}
}
if(!flag){
return false;
}
}
return true;
},copyState:function(_3004,self){
if(_3004){
return true;
}
if(arguments.length<2){
self=this==_2fff.manager().target;
}
if(self){
if(this.copyOnly){
return this.selfCopy;
}
}else{
return this.copyOnly;
}
return false;
},destroy:function(){
_3001.superclass.destroy.call(this);
array.forEach(this.topics,function(t){
t.remove();
});
this.targetAnchor=null;
},onMouseMove:function(e){
if(this.isDragging&&this.targetState=="Disabled"){
return;
}
_3001.superclass.onMouseMove.call(this,e);
var m=_2fff.manager();
if(!this.isDragging){
if(this.mouseDown&&this.isSource&&(Math.abs(e.pageX-this._lastX)>this.delay||Math.abs(e.pageY-this._lastY)>this.delay)){
var nodes=this.getSelectedNodes();
if(nodes.length){
m.startDrag(this,nodes,this.copyState(dnd.getCopyKeyState(e),true));
}
}
}
if(this.isDragging){
var _3005=false;
if(this.current){
if(!this.targetBox||this.targetAnchor!=this.current){
this.targetBox=_2ffd.position(this.current,true);
}
if(this.horizontal){
_3005=(e.pageX-this.targetBox.x<this.targetBox.w/2)==_2ffd.isBodyLtr(this.current.ownerDocument);
}else{
_3005=(e.pageY-this.targetBox.y)<(this.targetBox.h/2);
}
}
if(this.current!=this.targetAnchor||_3005!=this.before){
this._markTargetAnchor(_3005);
m.canDrop(!this.current||m.source!=this||!(this.current.id in this.selection));
}
}
},onMouseDown:function(e){
if(!this.mouseDown&&this._legalMouseDown(e)&&(!this.skipForm||!dnd.isFormElement(e))){
this.mouseDown=true;
this._lastX=e.pageX;
this._lastY=e.pageY;
_3001.superclass.onMouseDown.call(this,e);
}
},onMouseUp:function(e){
if(this.mouseDown){
this.mouseDown=false;
_3001.superclass.onMouseUp.call(this,e);
}
},onDndSourceOver:function(_3006){
if(this!==_3006){
this.mouseDown=false;
if(this.targetAnchor){
this._unmarkTargetAnchor();
}
}else{
if(this.isDragging){
var m=_2fff.manager();
m.canDrop(this.targetState!="Disabled"&&(!this.current||m.source!=this||!(this.current.id in this.selection)));
}
}
},onDndStart:function(_3007,nodes,copy){
if(this.autoSync){
this.sync();
}
if(this.isSource){
this._changeState("Source",this==_3007?(copy?"Copied":"Moved"):"");
}
var _3008=this.accept&&this.checkAcceptance(_3007,nodes);
this._changeState("Target",_3008?"":"Disabled");
if(this==_3007){
_2fff.manager().overSource(this);
}
this.isDragging=true;
},onDndDrop:function(_3009,nodes,copy,_300a){
if(this==_300a){
this.onDrop(_3009,nodes,copy);
}
this.onDndCancel();
},onDndCancel:function(){
if(this.targetAnchor){
this._unmarkTargetAnchor();
this.targetAnchor=null;
}
this.before=true;
this.isDragging=false;
this.mouseDown=false;
this._changeState("Source","");
this._changeState("Target","");
},onDrop:function(_300b,nodes,copy){
if(this!=_300b){
this.onDropExternal(_300b,nodes,copy);
}else{
this.onDropInternal(nodes,copy);
}
},onDropExternal:function(_300c,nodes,copy){
var _300d=this._normalizedCreator;
if(this.creator){
this._normalizedCreator=function(node,hint){
return _300d.call(this,_300c.getItem(node.id).data,hint);
};
}else{
if(copy){
this._normalizedCreator=function(node){
var t=_300c.getItem(node.id);
var n=node.cloneNode(true);
n.id=dnd.getUniqueId();
return {node:n,data:t.data,type:t.type};
};
}else{
this._normalizedCreator=function(node){
var t=_300c.getItem(node.id);
_300c.delItem(node.id);
return {node:node,data:t.data,type:t.type};
};
}
}
this.selectNone();
if(!copy&&!this.creator){
_300c.selectNone();
}
this.insertNodes(true,nodes,this.before,this.current);
if(!copy&&this.creator){
_300c.deleteSelectedNodes();
}
this._normalizedCreator=_300d;
},onDropInternal:function(nodes,copy){
var _300e=this._normalizedCreator;
if(this.current&&this.current.id in this.selection){
return;
}
if(copy){
if(this.creator){
this._normalizedCreator=function(node,hint){
return _300e.call(this,this.getItem(node.id).data,hint);
};
}else{
this._normalizedCreator=function(node){
var t=this.getItem(node.id);
var n=node.cloneNode(true);
n.id=dnd.getUniqueId();
return {node:n,data:t.data,type:t.type};
};
}
}else{
if(!this.current){
return;
}
this._normalizedCreator=function(node){
var t=this.getItem(node.id);
return {node:node,data:t.data,type:t.type};
};
}
this._removeSelection();
this.insertNodes(true,nodes,this.before,this.current);
this._normalizedCreator=_300e;
},onDraggingOver:function(){
},onDraggingOut:function(){
},onOverEvent:function(){
_3001.superclass.onOverEvent.call(this);
_2fff.manager().overSource(this);
if(this.isDragging&&this.targetState!="Disabled"){
this.onDraggingOver();
}
},onOutEvent:function(){
_3001.superclass.onOutEvent.call(this);
_2fff.manager().outSource(this);
if(this.isDragging&&this.targetState!="Disabled"){
this.onDraggingOut();
}
},_markTargetAnchor:function(_300f){
if(this.current==this.targetAnchor&&this.before==_300f){
return;
}
if(this.targetAnchor){
this._removeItemClass(this.targetAnchor,this.before?"Before":"After");
}
this.targetAnchor=this.current;
this.targetBox=null;
this.before=_300f;
if(this.targetAnchor){
this._addItemClass(this.targetAnchor,this.before?"Before":"After");
}
},_unmarkTargetAnchor:function(){
if(!this.targetAnchor){
return;
}
this._removeItemClass(this.targetAnchor,this.before?"Before":"After");
this.targetAnchor=null;
this.targetBox=null;
this.before=true;
},_markDndStatus:function(copy){
this._changeState("Source",copy?"Copied":"Moved");
},_legalMouseDown:function(e){
if(e.type!="touchstart"&&!mouse.isLeft(e)){
return false;
}
if(!this.withHandles){
return true;
}
for(var node=e.target;node&&node!==this.node;node=node.parentNode){
if(_2ffc.contains(node,"dojoDndHandle")){
return true;
}
if(_2ffc.contains(node,"dojoDndItem")||_2ffc.contains(node,"dojoDndIgnore")){
break;
}
}
return false;
}});
return _3001;
});
},"dijit/form/_ComboBoxMenu":function(){
define("dijit/form/_ComboBoxMenu",["dojo/_base/declare","dojo/dom-class","dojo/dom-style","dojo/keys","../_WidgetBase","../_TemplatedMixin","./_ComboBoxMenuMixin","./_ListMouseMixin"],function(_3010,_3011,_3012,keys,_3013,_3014,_3015,_3016){
return _3010("dijit.form._ComboBoxMenu",[_3013,_3014,_3016,_3015],{templateString:"<div class='dijitReset dijitMenu' data-dojo-attach-point='containerNode' style='overflow: auto; overflow-x: hidden;'>"+"<div class='dijitMenuItem dijitMenuPreviousButton' data-dojo-attach-point='previousButton' role='option'></div>"+"<div class='dijitMenuItem dijitMenuNextButton' data-dojo-attach-point='nextButton' role='option'></div>"+"</div>",baseClass:"dijitComboBoxMenu",postCreate:function(){
this.inherited(arguments);
if(!this.isLeftToRight()){
_3011.add(this.previousButton,"dijitMenuItemRtl");
_3011.add(this.nextButton,"dijitMenuItemRtl");
}
},_createMenuItem:function(){
var item=this.ownerDocument.createElement("div");
item.className="dijitReset dijitMenuItem"+(this.isLeftToRight()?"":" dijitMenuItemRtl");
item.setAttribute("role","option");
return item;
},onHover:function(node){
_3011.add(node,"dijitMenuItemHover");
},onUnhover:function(node){
_3011.remove(node,"dijitMenuItemHover");
},onSelect:function(node){
_3011.add(node,"dijitMenuItemSelected");
},onDeselect:function(node){
_3011.remove(node,"dijitMenuItemSelected");
},_page:function(up){
var _3017=0;
var _3018=this.domNode.scrollTop;
var _3019=_3012.get(this.domNode,"height");
if(!this.getHighlightedOption()){
this.selectNextNode();
}
while(_3017<_3019){
var _301a=this.getHighlightedOption();
if(up){
if(!_301a.previousSibling||_301a.previousSibling.style.display=="none"){
break;
}
this.selectPreviousNode();
}else{
if(!_301a.nextSibling||_301a.nextSibling.style.display=="none"){
break;
}
this.selectNextNode();
}
var _301b=this.domNode.scrollTop;
_3017+=(_301b-_3018)*(up?-1:1);
_3018=_301b;
}
},handleKey:function(evt){
switch(evt.keyCode){
case keys.DOWN_ARROW:
this.selectNextNode();
return false;
case keys.PAGE_DOWN:
this._page(false);
return false;
case keys.UP_ARROW:
this.selectPreviousNode();
return false;
case keys.PAGE_UP:
this._page(true);
return false;
default:
return true;
}
}});
});
},"davinci/XPathUtils":function(){
define("davinci/XPathUtils",function(){
function _301c(node){
this.node=node;
};
var _301d="__XPATH_UTILS_TEMP_ID__";
_301c.prototype={name:function(){
return this.node.nodeName;
},parent:function(){
var _301e=this.node.parentNode;
if(_301e!==this.node.ownerDocument){
return new _301c(_301e);
}
},index:function(){
var tag=this.node.nodeName,_301f=this.node.parentNode,_3020=false,elems,idx=0;
if(!_301f.id){
_301f.id=_301d+Date.now();
_3020=true;
}
elems=_301f.querySelectorAll("#"+_301f.id+">"+tag);
if(elems.length>1){
for(var i=0,len=elems.length;i<len;i++){
if(elems[i]===this.node){
idx=i+1;
break;
}
}
}
if(_3020){
_301f.id="";
}
return idx;
}};
var _3021=/(\w+)(?:\[(\d+)\])?/;
return {getXPath:function(node,_3022){
function _3023(path,elem){
var tag=elem.name(),_3024=elem.parent();
if(_3024){
var idx=elem.index();
if(idx){
tag+="["+idx+"]";
}
path=tag+(path?"/"+path:"");
return _3023(path,_3024);
}
return "/"+tag+"/"+path;
};
_3022=_3022||_301c;
var elem=new _3022(node);
return _3023("",elem).toLowerCase();
},toCssPath:function(xpath){
if(xpath.charAt(0)==="/"){
xpath=xpath.substr(1);
}
var str="";
xpath.split("/").forEach(function(path){
var m=path.match(_3021),tag=m[1],idx=m[2];
str+=(str?">":"")+tag;
if(idx){
str+=":nth-of-type("+idx+")";
}
});
return str;
}};
});
},"davinci/html/ui/CSSOutlineModel":function(){
define(["dojo/_base/declare","davinci/ui/widgets/DavinciModelTreeModel"],function(_3025,_3026){
return _3025("davinci.html.ui.CSSOutlineModel",_3026,{_childList:function(item){
var _3027=[];
switch(item.elementType){
case "CSSFile":
_3027=item.children;
break;
case "CSSRule":
_3027=item.properties;
break;
default:
}
return _3027;
}});
});
},"davinci/ve/metadata":function(){
define(["require","dojo/Deferred","dojo/promise/all","dojo/_base/lang","dojo/_base/connect","../library","../model/Path","../repositoryinfo"],function(_3028,_3029,all,lang,_302a,_302b,Path,info){
var _302c,_302d,_302e={},_302f={},_3030={},l10n=null,_3031=[],_3032={},_3033={id:{datatype:"string",hidden:true},lang:{datatype:"string",hidden:true},dir:{datatype:"string",hidden:true},"class":{datatype:"string",hidden:true},style:{datatype:"string",hidden:true},title:{datatype:"string",hidden:true}};
dojo.subscribe("/davinci/ui/libraryChanged/start",function(){
_302e={};
_302f={};
_3030={};
l10n=null;
_302c.init().then(function(){
dojo.publish("/davinci/ui/libraryChanged");
});
});
function _3034(dest,srcs){
dest=dest||{};
for(var i=1,l=arguments.length;i<l;i++){
var src=arguments[i],name,val;
for(name in src){
if(src.hasOwnProperty(name)){
val=src[name];
if(!(name in dest)||(typeof val!=="object"&&dest[name]!==val)){
dest[name]=val;
}else{
_3034(dest[name],val);
}
}
}
}
return dest;
};
function _3035(pkg,path){
_302e[pkg.name]=pkg;
path=new Path(path);
var _3036=pkg.overlays;
for(var name in _3036){
if(_3036.hasOwnProperty(name)){
if(name==="oam"||name==="maqetta"){
_3034(pkg,_3036[name]);
}
}
}
delete pkg.overlays;
pkg.__metadataModuleId="maq-metadata-"+pkg.name;
var _3037=new Path(location.href);
var _3038=[{name:pkg.__metadataModuleId,location:_3037.append(path).append(pkg.directories.metadata).toString()}];
if(pkg.name!="dojo"){
pkg.__libraryModuleId=pkg.name;
var _3039="app/static/lib/"+pkg.name+"/"+pkg.version;
_3038.push({name:pkg.__libraryModuleId,location:_3037.append(_3039).toString()});
}
_3028=_3028({packages:_3038});
var _303a;
if(lang.exists("scripts.widget_metadata",pkg)){
if(typeof pkg.scripts.widget_metadata=="string"){
var _303b=path.append(pkg.scripts.widget_metadata);
_303a=dojo.xhrGet({url:_303b.toString()+"?"+info.revision,handleAs:"json"}).then(function(data){
if(data){
return _303c(pkg.name,data,_303b.getParentPath());
}
});
}else{
_303a=_303c(pkg.name,pkg.scripts.widget_metadata,path);
}
}
if(lang.exists("scripts.callbacks",pkg)){
var d=new _3029();
_3028([pkg.scripts.callbacks],function(cb){
pkg.$callbacks=cb;
d.resolve();
});
_3031.push(d);
}
return _303a;
};
function _303c(_303d,_303e,path){
if(!_303d){
console.error("parseLibraryDescriptor: missing 'libName' arg");
}
var pkg=_302e[_303d];
_303e.$path=path.toString();
if(!pkg){
_302e[_303d]={$wm:_303e,name:_303e.name,version:_303e.version};
pkg=_302e[_303d];
}else{
if(pkg.$widgets){
_303e.widgets.forEach(function(item){
pkg.$wm.widgets.push(item);
});
for(var name in _303e.categories){
if(!pkg.$wm.categories.hasOwnProperty(name)){
pkg.$wm.categories[name]=_303e.categories[name];
}
}
}else{
if(pkg.$wm){
for(var z=0;z<_303e.widgets.length;z++){
var found=false;
for(var ll=0;!found&&ll<pkg.$wm.widgets.length;ll++){
if(pkg.$wm.widgets[ll].type==_303e.widgets[z].type){
found=true;
}
}
if(!found){
pkg.$wm.widgets.push(_303e.widgets[z]);
}
}
}else{
if(!pkg.$wm){
pkg.$wm=_303e;
}
}
}
}
var wm=pkg.$wm;
wm.$providedTypes=wm.$providedTypes||{};
wm.widgets.forEach(function(item){
wm.$providedTypes[item.type]=item;
if(item.icon&&!item.iconLocal){
item.icon=path.append(item.icon).toString();
}
item.widgetClass=wm.categories[item.category].widgetClass;
});
dojo.mixin(wm,{_maqGetString:_303f});
if(wm.extend){
for(var _3040 in wm.extend){
if(wm.extend.hasOwnProperty(_3040)){
if(_302e[_3040]&&_302e[_3040].$wm){
_3041(_302e[_3040].$wm,[wm.extend[_3040]]);
}else{
var ext=_3032[_3040]||[];
ext.push(wm.extend[_3040]);
_3032[_3040]=ext;
}
}
}
}
if(_3032[_303d]){
_3041(wm,_3032[_303d]);
}
return pkg;
};
function _3041(wm,_3042){
function _3043(val1,val2){
if(typeof val1==="string"){
return val1+","+val2;
}
if(val1 instanceof Array){
return val1.concat(val2);
}
console.error("Unhandled type for \"concat()\"");
};
var _3044=wm.$providedTypes;
_3042.forEach(function(ext){
for(var type in ext){
if(ext.hasOwnProperty(type)){
var e=ext[type];
var w=_3044[type];
if(e.mixin){
lang.mixin(w,e.mixin);
}
if(e.concat){
for(var prop in e.concat){
if(e.concat.hasOwnProperty(prop)){
var val=e.concat[prop];
if(w[prop]){
w[prop]=_3043(w[prop],val);
}else{
w[prop]=val;
}
}
}
}
}
}
});
};
function _3045(type){
if(type){
for(var name in _302e){
if(_302e.hasOwnProperty(name)){
var lib=_302e[name];
if(lib.$wm&&lib.$wm.$providedTypes[type]){
return lib;
}
}
}
}
return null;
};
var _3046=false;
function _303f(key){
if(!_3046){
_3046=true;
}
return null;
};
function _3047(type){
if(!type){
return undefined;
}
if(_302f.hasOwnProperty(type)){
return _302f[type];
}
var lib=_3045(type),wm,_3048;
if(lib){
_3048=lib.$wm.$path;
}
if(!_3048){
return null;
}
wm=lib.$wm;
var _3049=null;
var _304a=[_3048,"/",type.replace(/\./g,"/"),"_oam.json"].join("");
if(!wm.localPath){
dojo.xhrGet({url:_304a+"?"+info.revision,handleAs:"json",sync:true}).then(function(data){
_3049=data;
});
}else{
var base=_302d.getProject();
var _304b=system.resource.findResource("./"+base+"/"+_304a);
_3049=dojo.fromJson(_304b.getContentSync());
}
if(!_3049){
console.error("ERROR: Could not load metadata for type: "+type);
return null;
}
_3049.$ownproperty=dojo.mixin({},_3049.property);
_3049.property=dojo.mixin({},_3033,_3049.property);
_3049.$src=_304a;
_302f[type]=_3049;
_3034(_3049,wm.$providedTypes[type].metadata);
return _3049;
};
function _304c(obj,_304d){
if(!_304d){
return obj;
}
dojo.every(_304d.split("."),function(name){
if(obj[name]===undefined){
obj=undefined;
return false;
}
obj=obj[name];
return true;
});
return obj;
};
function _304e(name,type){
var _304f="allowed"+name,prop=_302c.queryDescriptor(type,_304f);
if(!prop){
prop=name==="Parent"?"ANY":"NONE";
}
return prop.split(/\s*,\s*/);
};
function _3050(type,_3051){
var value=_302c.queryDescriptor(type,_3051);
if(!value){
return null;
}
var lib=_3045(type);
return _3052(lib,value);
};
function _3052(lib,_3053){
if(!lib||!_3053){
return null;
}
var _3054;
if(typeof _3053==="string"&&_3053.substr(0,2)==="./"){
_3054=new Path(lib.__metadataModuleId).append(_3053).toString();
}else{
_3054=_3053;
}
return _3054;
};
_302c={init:function(){
var _3055=[];
_302d=_3028("../Workbench");
_302b.getUserLibs(_302d.getProject()).forEach(function(lib){
var path=lib.metaRoot;
if(path){
_3055.push(dojo.xhrGet({url:path+"/package.json"+"?"+info.revision,handleAs:"json"}).then(function(data){
return _3035(data,path);
}));
}
});
return all(_3055);
},parseMetaData:function(name,_3056,path){
return _303c(name,_3056,path);
},getLibrary:function(name){
return name?_302e[name]:_302e;
},getLibraryActions:function(_3057,_3058){
var _3059=[];
for(var name in _302e){
if(_302e.hasOwnProperty(name)){
var lib=_302e[name];
var wm=lib.$wm;
if(!wm){
continue;
}
var _305a=lib.$wm["davinci.actionSets"];
if(!_305a){
continue;
}
dojo.forEach(_305a,function(_305b){
if(_305b.id==_3057){
if(!_3058||(_305b.targetID===_3058)){
var _305c=dojo.clone(_305b.actions);
dojo.forEach(_305c,function(_305d){
if(_305d.action){
var _305e=_3052(lib,_305d.action);
_305d.action=_305e;
}
if(_305d.menu){
_305d.menu.forEach(function(item){
if(item.action){
var _305f=_3052(lib,item.action);
item.action=_305f;
}
});
}
_3059.push(_305d);
});
}
}
});
}
}
return _3059;
},loadThemeMeta:function(model){
var style=model.find({elementType:"HTMLElement",tag:"style"});
var _3060=[];
var _3061="claro";
var _3062;
for(var z=0;z<style.length;z++){
for(var i=0;i<style[z].children.length;i++){
if(style[z].children[i].elementType=="CSSImport"){
_3060.push(style[z].children[i]);
}
}
}
var _3063=new Path(model.fileName);
var _3064=_302b.getThemes(_302d.getProject());
var _3065={};
for(var i=0;i<_3064.length;i++){
if(_3064[i].files){
for(var k=0;k<_3064[i].files.length;k++){
_3065[_3064[i].files[k]]=_3064[i];
}
}
}
for(var i=0;i<_3060.length;i++){
var url=_3060[i].url;
for(var _3066 in _3065){
if(_3066.indexOf(_3061)>-1){
_3062=_3066;
}
if(url.indexOf(_3066)>-1){
return {themeUrl:url,themeMetaCache:_302b.getThemeMetadata(_3065[_3066]),theme:_3065[_3066]};
}
}
}
var ro=_302c._loadThemeMetaDojoxMobile(model,_3065);
if(ro){
return ro;
}
if(_3062){
var _3067=_3061;
var _3068;
for(var i=0;i<_3060.length;i++){
var _3069=_3060[i].url.match(/\/([^\/]*)\.css$/);
if(_3069&&_3069.length==2){
var _306a=_3069[1];
var _306b=_3060[i].url.match(new RegExp("themes/"+_306a+"/"+_306a+".css$"));
if(_306b){
_3068=_306a;
break;
}
}
}
if(_3068){
var _306c=model.getDocumentElement();
var head=_306c.getChildElement("head");
var _306d=_306c.getChildElement("body");
var _306e=_306d.getAttribute("class");
if(_306e){
_306d.setAttribute("class",_306e.replace(new RegExp("\\b"+_3068+"\\b","g"),_3067));
}
var _306f=head.getChildElements("style");
dojo.forEach(_306f,function(_3070){
dojo.forEach(_3070.children,function(_3071){
if(_3071.elementType=="CSSImport"){
_3071.url=_3071.url.replace(new RegExp("/"+_3068,"g"),"/"+_3067);
}
});
});
var url=_3060[i].url.replace(new RegExp("/"+_3068,"g"),"/"+_3067);
var _3072={themeUrl:url,themeMetaCache:_302b.getThemeMetadata(_3065[_3062]),theme:_3065[_3062]};
_3072.themeMetaCache.usingSubstituteTheme={oldThemeName:_3068,newThemeName:_3067};
return _3072;
}
}
},_loadThemeMetaDojoxMobile:function(model,_3073){
var _3074=model.find({elementType:"HTMLElement",tag:"script"});
for(var s=0;s<_3074.length;s++){
var text=_3074[s].getElementText();
if(text.length){
var start=text.indexOf("dojoxMobile.themeMap");
if(start>0){
start=text.indexOf("=",start);
var stop=text.indexOf(";",start);
if(stop>start){
var _3075=dojo.fromJson(text.substring(start+1,stop));
var url=_3075[0][2][0];
for(var _3076 in _3073){
if(url.indexOf(_3076)>-1){
return {themeUrl:url,themeMetaCache:_302b.getThemeMetadata(_3073[_3076]),theme:_3073[_3076]};
}
}
}
}
}
}
return;
},getLibraryForType:function(type){
return _3045(type);
},getLibraryBase:function(type){
var lib=_3045(type);
if(lib){
return lib.$wm.$path;
}
},invokeCallback:function(_3077,_3078,args){
var _3079=_3077,fn;
if(typeof _3077==="string"){
_3079=_3045(type);
}
if(_3079&&_3079.$callbacks){
fn=_3079.$callbacks[_3078];
if(fn){
fn.apply(_3079.$callbacks,args);
}
}
},query:function(_307a,_307b){
if(!_307a){
return;
}
var type,_307c;
if(_307a.declaredClass){
if(_307a.metadata){
_307c=_307a.metadata;
}
type=_307a.type;
}else{
type=_307a;
}
if(!_307c){
_307c=_3047(type);
if(!_307c){
return;
}
if(_307a.declaredClass){
_307a.metadata=_307c;
}
}
return _304c(_307c,_307b);
},queryDescriptorByName:function(name,type,_307d){
var lib=_3045(type),item;
if(lib){
var _307e=lib.$wm.widgets;
for(var i=0;i<_307e.length;i++){
if(_307e[i].name==name){
item=_307e[i];
break;
}
}
}
return this._queryDescriptor(item,_307d);
},queryDescriptor:function(type,_307f){
var lib=_3045(type),item;
if(lib){
item=lib.$wm.$providedTypes[type];
}
return this._queryDescriptor(item,_307f);
},_queryDescriptor:function(item,_3080){
if(!item||typeof item!=="object"){
return;
}
var value=_304c(item,_3080);
if(_3080==="resizable"){
if(!value){
value="both";
}
}
return value;
},getAllowedParent:function(type){
return _304e("Parent",type);
},getAllowedChild:function(type){
return _304e("Child",type);
},getHelper:function(type,_3081){
var d=new _3029(),idx=type+":"+_3081;
if(idx in _3030){
d.resolve(_3030[idx]);
return d;
}
var _3082=_3050(type,_3081);
if(!_3082){
d.resolve();
}else{
_3028([_3082],function(_3083){
d.resolve(_3083);
_3030[idx]=_3083;
});
}
return d;
},getSmartInput:function(type){
var d=new _3029();
if(type in _3084){
d.resolve(_3084[type]);
}else{
var _3085=_3050(type,"inlineEdit");
if(!_3085){
d.resolve(null);
}else{
if(typeof _3085==="string"){
_3028([_3085],function(_3086){
d.resolve(_3084[type]=new _3086());
});
}else{
_3028(["davinci/ve/input/SmartInput"],function(_3087){
var si=new _3087();
lang.mixin(si,_3085);
d.resolve(_3084[type]=si);
});
}
}
}
return d;
},getDeferreds:function(){
return _3031;
}};
var _3084={};
_302a.subscribe("/davinci/ui/libraryChanged/start",function(){
_3084={};
});
return dojo.setObject("davinci.ve.metadata",_302c);
});
},"dijit/layout/BorderContainer":function(){
define("dijit/layout/BorderContainer",["dojo/_base/array","dojo/cookie","dojo/_base/declare","dojo/dom-class","dojo/dom-construct","dojo/dom-geometry","dojo/dom-style","dojo/_base/event","dojo/keys","dojo/_base/lang","dojo/on","dojo/touch","../_WidgetBase","../_Widget","../_TemplatedMixin","./_LayoutWidget","./utils"],function(array,_3088,_3089,_308a,_308b,_308c,_308d,event,keys,lang,on,touch,_308e,_308f,_3090,_3091,_3092){
var _3093=_3089("dijit.layout._Splitter",[_308f,_3090],{live:true,templateString:"<div class=\"dijitSplitter\" data-dojo-attach-event=\"onkeypress:_onKeyPress,press:_startDrag,onmouseenter:_onMouse,onmouseleave:_onMouse\" tabIndex=\"0\" role=\"separator\"><div class=\"dijitSplitterThumb\"></div></div>",constructor:function(){
this._handlers=[];
},postMixInProperties:function(){
this.inherited(arguments);
this.horizontal=/top|bottom/.test(this.region);
this._factor=/top|left/.test(this.region)?1:-1;
this._cookieName=this.container.id+"_"+this.region;
},buildRendering:function(){
this.inherited(arguments);
_308a.add(this.domNode,"dijitSplitter"+(this.horizontal?"H":"V"));
if(this.container.persist){
var _3094=_3088(this._cookieName);
if(_3094){
this.child.domNode.style[this.horizontal?"height":"width"]=_3094;
}
}
},_computeMaxSize:function(){
var dim=this.horizontal?"h":"w",_3095=_308c.getMarginBox(this.child.domNode)[dim],_3096=array.filter(this.container.getChildren(),function(child){
return child.region=="center";
})[0],_3097=_308c.getMarginBox(_3096.domNode)[dim];
return Math.min(this.child.maxSize,_3095+_3097);
},_startDrag:function(e){
if(!this.cover){
this.cover=_308b.place("<div class=dijitSplitterCover></div>",this.child.domNode,"after");
}
_308a.add(this.cover,"dijitSplitterCoverActive");
if(this.fake){
_308b.destroy(this.fake);
}
if(!(this._resize=this.live)){
(this.fake=this.domNode.cloneNode(true)).removeAttribute("id");
_308a.add(this.domNode,"dijitSplitterShadow");
_308b.place(this.fake,this.domNode,"after");
}
_308a.add(this.domNode,"dijitSplitterActive dijitSplitter"+(this.horizontal?"H":"V")+"Active");
if(this.fake){
_308a.remove(this.fake,"dijitSplitterHover dijitSplitter"+(this.horizontal?"H":"V")+"Hover");
}
var _3098=this._factor,_3099=this.horizontal,axis=_3099?"pageY":"pageX",_309a=e[axis],_309b=this.domNode.style,dim=_3099?"h":"w",_309c=_308c.getMarginBox(this.child.domNode)[dim],max=this._computeMaxSize(),min=this.child.minSize||20,_309d=this.region,_309e=_309d=="top"||_309d=="bottom"?"top":"left",_309f=parseInt(_309b[_309e],10),_30a0=this._resize,_30a1=lang.hitch(this.container,"_layoutChildren",this.child.id),de=this.ownerDocument;
this._handlers=this._handlers.concat([on(de,touch.move,this._drag=function(e,_30a2){
var delta=e[axis]-_309a,_30a3=_3098*delta+_309c,_30a4=Math.max(Math.min(_30a3,max),min);
if(_30a0||_30a2){
_30a1(_30a4);
}
_309b[_309e]=delta+_309f+_3098*(_30a4-_30a3)+"px";
}),on(de,"dragstart",event.stop),on(this.ownerDocumentBody,"selectstart",event.stop),on(de,touch.release,lang.hitch(this,"_stopDrag"))]);
event.stop(e);
},_onMouse:function(e){
var o=(e.type=="mouseover"||e.type=="mouseenter");
_308a.toggle(this.domNode,"dijitSplitterHover",o);
_308a.toggle(this.domNode,"dijitSplitter"+(this.horizontal?"H":"V")+"Hover",o);
},_stopDrag:function(e){
try{
if(this.cover){
_308a.remove(this.cover,"dijitSplitterCoverActive");
}
if(this.fake){
_308b.destroy(this.fake);
}
_308a.remove(this.domNode,"dijitSplitterActive dijitSplitter"+(this.horizontal?"H":"V")+"Active dijitSplitterShadow");
this._drag(e);
this._drag(e,true);
}
finally{
this._cleanupHandlers();
delete this._drag;
}
if(this.container.persist){
_3088(this._cookieName,this.child.domNode.style[this.horizontal?"height":"width"],{expires:365});
}
},_cleanupHandlers:function(){
var h;
while(h=this._handlers.pop()){
h.remove();
}
},_onKeyPress:function(e){
this._resize=true;
var _30a5=this.horizontal;
var tick=1;
switch(e.charOrCode){
case _30a5?keys.UP_ARROW:keys.LEFT_ARROW:
tick*=-1;
case _30a5?keys.DOWN_ARROW:keys.RIGHT_ARROW:
break;
default:
return;
}
var _30a6=_308c.getMarginSize(this.child.domNode)[_30a5?"h":"w"]+this._factor*tick;
this.container._layoutChildren(this.child.id,Math.max(Math.min(_30a6,this._computeMaxSize()),this.child.minSize));
event.stop(e);
},destroy:function(){
this._cleanupHandlers();
delete this.child;
delete this.container;
delete this.cover;
delete this.fake;
this.inherited(arguments);
}});
var _30a7=_3089("dijit.layout._Gutter",[_308f,_3090],{templateString:"<div class=\"dijitGutter\" role=\"presentation\"></div>",postMixInProperties:function(){
this.inherited(arguments);
this.horizontal=/top|bottom/.test(this.region);
},buildRendering:function(){
this.inherited(arguments);
_308a.add(this.domNode,"dijitGutter"+(this.horizontal?"H":"V"));
}});
var _30a8=_3089("dijit.layout.BorderContainer",_3091,{design:"headline",gutters:true,liveSplitters:true,persist:false,baseClass:"dijitBorderContainer",_splitterClass:_3093,postMixInProperties:function(){
if(!this.gutters){
this.baseClass+="NoGutter";
}
this.inherited(arguments);
},startup:function(){
if(this._started){
return;
}
array.forEach(this.getChildren(),this._setupChild,this);
this.inherited(arguments);
},_setupChild:function(child){
var _30a9=child.region;
if(_30a9){
this.inherited(arguments);
_308a.add(child.domNode,this.baseClass+"Pane");
var ltr=this.isLeftToRight();
if(_30a9=="leading"){
_30a9=ltr?"left":"right";
}
if(_30a9=="trailing"){
_30a9=ltr?"right":"left";
}
if(_30a9!="center"&&(child.splitter||this.gutters)&&!child._splitterWidget){
var _30aa=child.splitter?this._splitterClass:_30a7;
if(lang.isString(_30aa)){
_30aa=lang.getObject(_30aa);
}
var _30ab=new _30aa({id:child.id+"_splitter",container:this,child:child,region:_30a9,live:this.liveSplitters});
_30ab.isSplitter=true;
child._splitterWidget=_30ab;
_308b.place(_30ab.domNode,child.domNode,"after");
_30ab.startup();
}
child.region=_30a9;
}
},layout:function(){
this._layoutChildren();
},addChild:function(child,_30ac){
this.inherited(arguments);
if(this._started){
this.layout();
}
},removeChild:function(child){
var _30ad=child.region;
var _30ae=child._splitterWidget;
if(_30ae){
_30ae.destroy();
delete child._splitterWidget;
}
this.inherited(arguments);
if(this._started){
this._layoutChildren();
}
_308a.remove(child.domNode,this.baseClass+"Pane");
_308d.set(child.domNode,{top:"auto",bottom:"auto",left:"auto",right:"auto",position:"static"});
_308d.set(child.domNode,_30ad=="top"||_30ad=="bottom"?"width":"height","auto");
},getChildren:function(){
return array.filter(this.inherited(arguments),function(_30af){
return !_30af.isSplitter;
});
},getSplitter:function(_30b0){
return array.filter(this.getChildren(),function(child){
return child.region==_30b0;
})[0]._splitterWidget;
},resize:function(_30b1,_30b2){
if(!this.cs||!this.pe){
var node=this.domNode;
this.cs=_308d.getComputedStyle(node);
this.pe=_308c.getPadExtents(node,this.cs);
this.pe.r=_308d.toPixelValue(node,this.cs.paddingRight);
this.pe.b=_308d.toPixelValue(node,this.cs.paddingBottom);
_308d.set(node,"padding","0px");
}
this.inherited(arguments);
},_layoutChildren:function(_30b3,_30b4){
if(!this._borderBox||!this._borderBox.h){
return;
}
var _30b5=array.map(this.getChildren(),function(child,idx){
return {pane:child,weight:[child.region=="center"?Infinity:0,child.layoutPriority,(this.design=="sidebar"?1:-1)*(/top|bottom/.test(child.region)?1:-1),idx]};
},this);
_30b5.sort(function(a,b){
var aw=a.weight,bw=b.weight;
for(var i=0;i<aw.length;i++){
if(aw[i]!=bw[i]){
return aw[i]-bw[i];
}
}
return 0;
});
var _30b6=[];
array.forEach(_30b5,function(_30b7){
var pane=_30b7.pane;
_30b6.push(pane);
if(pane._splitterWidget){
_30b6.push(pane._splitterWidget);
}
});
var dim={l:this.pe.l,t:this.pe.t,w:this._borderBox.w-this.pe.w,h:this._borderBox.h-this.pe.h};
_3092.layoutChildren(this.domNode,dim,_30b6,_30b3,_30b4);
},destroyRecursive:function(){
array.forEach(this.getChildren(),function(child){
var _30b8=child._splitterWidget;
if(_30b8){
_30b8.destroy();
}
delete child._splitterWidget;
});
this.inherited(arguments);
}});
_30a8.ChildWidgetProperties={region:"",layoutPriority:0,splitter:false,minSize:0,maxSize:Infinity};
lang.extend(_308e,_30a8.ChildWidgetProperties);
_30a8._Splitter=_3093;
_30a8._Gutter=_30a7;
return _30a8;
});
},"dijit/form/DataList":function(){
define("dijit/form/DataList",["dojo/_base/declare","dojo/dom","dojo/_base/lang","dojo/query","dojo/store/Memory","../registry"],function(_30b9,dom,lang,query,_30ba,_30bb){
function _30bc(_30bd){
return {id:_30bd.value,value:_30bd.value,name:lang.trim(_30bd.innerText||_30bd.textContent||"")};
};
return _30b9("dijit.form.DataList",_30ba,{constructor:function(_30be,_30bf){
this.domNode=dom.byId(_30bf);
lang.mixin(this,_30be);
if(this.id){
_30bb.add(this);
}
this.domNode.style.display="none";
this.inherited(arguments,[{data:query("option",this.domNode).map(_30bc)}]);
},destroy:function(){
_30bb.remove(this.id);
},fetchSelectedItem:function(){
var _30c0=query("> option[selected]",this.domNode)[0]||query("> option",this.domNode)[0];
return _30c0&&_30bc(_30c0);
}});
});
},"url:davinci/ui/widgets/templates/AddFiles.html":"<div>\n\t<div class=\"dijitDialogPaneContentArea\">\n\t\t<label for=\"fileDialogParentFolder\">${uiNLS.parentFolder}</label>\n\t\t<div dojoAttachPoint=\"fileDialogParentFolder\"></div>\n\t\t<div>\n\t\t\t<input dojoAttachPoint=\"uploader\" multiple=\"true\" type=\"file\" data-dojo-type=\"dojox.form.Uploader\"/>\n\t\t</div>\n\t\t<div dojoAttachPoint=\"filelist\"></div>\n\t</div>\n\n  <div class=\"dijitDialogPaneActionBar\">\n  \t<button dojoAttachPoint=\"uploadBtn\" dojoType=\"dijit.form.Button\" class=\"maqPrimaryButton\">${uiNLS.upload}</button>\n\t\t<button dojoType='dijit.form.Button' dojoAttachEvent='onClick:_cancelButton' class=\"maqSecondaryButton\">${uiNLS.cancelButtonLabel}</button>\n\t</div>\n</div>\n","url:dojox/grid/resources/_Grid.html":"<div hidefocus=\"hidefocus\" role=\"grid\" dojoAttachEvent=\"onmouseout:_mouseOut\">\n\t<div class=\"dojoxGridMasterHeader\" dojoAttachPoint=\"viewsHeaderNode\" role=\"presentation\"></div>\n\t<div class=\"dojoxGridMasterView\" dojoAttachPoint=\"viewsNode\" role=\"presentation\"></div>\n\t<div class=\"dojoxGridMasterMessages\" style=\"display: none;\" dojoAttachPoint=\"messagesNode\"></div>\n\t<span dojoAttachPoint=\"lastFocusNode\" tabindex=\"0\"></span>\n</div>\n","url:dojox/grid/resources/View.html":"<div class=\"dojoxGridView\" role=\"presentation\">\n\t<div class=\"dojoxGridHeader\" dojoAttachPoint=\"headerNode\" role=\"presentation\">\n\t\t<div dojoAttachPoint=\"headerNodeContainer\" style=\"width:9000em\" role=\"presentation\">\n\t\t\t<div dojoAttachPoint=\"headerContentNode\" role=\"row\"></div>\n\t\t</div>\n\t</div>\n\t<input type=\"checkbox\" class=\"dojoxGridHiddenFocus\" dojoAttachPoint=\"hiddenFocusNode\" role=\"presentation\" />\n\t<input type=\"checkbox\" class=\"dojoxGridHiddenFocus\" role=\"presentation\" />\n\t<div class=\"dojoxGridScrollbox\" dojoAttachPoint=\"scrollboxNode\" role=\"presentation\">\n\t\t<div class=\"dojoxGridContent\" dojoAttachPoint=\"contentNode\" hidefocus=\"hidefocus\" role=\"presentation\"></div>\n\t</div>\n</div>\n","dojox/grid/util":function(){
define("dojox/grid/util",["../main","dojo/_base/lang","dojo/dom"],function(dojox,lang,dom){
var dgu=lang.getObject("grid.util",true,dojox);
dgu.na="...";
dgu.rowIndexTag="gridRowIndex";
dgu.gridViewTag="gridView";
dgu.fire=function(ob,ev,args){
var fn=ob&&ev&&ob[ev];
return fn&&(args?fn.apply(ob,args):ob[ev]());
};
dgu.setStyleHeightPx=function(_30c1,_30c2){
if(_30c2>=0){
var s=_30c1.style;
var v=_30c2+"px";
if(_30c1&&s["height"]!=v){
s["height"]=v;
}
}
};
dgu.mouseEvents=["mouseover","mouseout","mousedown","mouseup","click","dblclick","contextmenu"];
dgu.keyEvents=["keyup","keydown","keypress"];
dgu.funnelEvents=function(_30c3,_30c4,_30c5,_30c6){
var evts=(_30c6?_30c6:dgu.mouseEvents.concat(dgu.keyEvents));
for(var i=0,l=evts.length;i<l;i++){
_30c4.connect(_30c3,"on"+evts[i],_30c5);
}
};
dgu.removeNode=function(_30c7){
_30c7=dom.byId(_30c7);
_30c7&&_30c7.parentNode&&_30c7.parentNode.removeChild(_30c7);
return _30c7;
};
dgu.arrayCompare=function(inA,inB){
for(var i=0,l=inA.length;i<l;i++){
if(inA[i]!=inB[i]){
return false;
}
}
return (inA.length==inB.length);
};
dgu.arrayInsert=function(_30c8,_30c9,_30ca){
if(_30c8.length<=_30c9){
_30c8[_30c9]=_30ca;
}else{
_30c8.splice(_30c9,0,_30ca);
}
};
dgu.arrayRemove=function(_30cb,_30cc){
_30cb.splice(_30cc,1);
};
dgu.arraySwap=function(_30cd,inI,inJ){
var cache=_30cd[inI];
_30cd[inI]=_30cd[inJ];
_30cd[inJ]=cache;
};
return dgu;
});
},"dijit/form/_ListBase":function(){
define("dijit/form/_ListBase",["dojo/_base/declare","dojo/on","dojo/window"],function(_30ce,on,_30cf){
return _30ce("dijit.form._ListBase",null,{selected:null,_listConnect:function(_30d0,_30d1){
var self=this;
return self.own(on(self.containerNode,on.selector(function(_30d2,_30d3,_30d4){
return _30d2.parentNode==_30d4;
},_30d0),function(evt){
evt.preventDefault();
self[_30d1](evt,this);
}));
},selectFirstNode:function(){
var first=this.containerNode.firstChild;
while(first&&first.style.display=="none"){
first=first.nextSibling;
}
this._setSelectedAttr(first);
},selectLastNode:function(){
var last=this.containerNode.lastChild;
while(last&&last.style.display=="none"){
last=last.previousSibling;
}
this._setSelectedAttr(last);
},selectNextNode:function(){
var _30d5=this.selected;
if(!_30d5){
this.selectFirstNode();
}else{
var next=_30d5.nextSibling;
while(next&&next.style.display=="none"){
next=next.nextSibling;
}
if(!next){
this.selectFirstNode();
}else{
this._setSelectedAttr(next);
}
}
},selectPreviousNode:function(){
var _30d6=this.selected;
if(!_30d6){
this.selectLastNode();
}else{
var prev=_30d6.previousSibling;
while(prev&&prev.style.display=="none"){
prev=prev.previousSibling;
}
if(!prev){
this.selectLastNode();
}else{
this._setSelectedAttr(prev);
}
}
},_setSelectedAttr:function(node){
if(this.selected!=node){
var _30d7=this.selected;
if(_30d7){
this.onDeselect(_30d7);
this.selected=null;
}
if(node){
this.selected=node;
_30cf.scrollIntoView(node);
this.onSelect(node);
}
}else{
if(node){
this.onSelect(node);
}
}
}});
});
},"orion/editor/textMateStyler":function(){
define("orion/editor/textMateStyler",["orion/editor/regex"],function(_30d8){
var _30d9={unsupported:[{regex:/\(\?[ims\-]:/,func:function(match){
return "option on/off for subexp";
}},{regex:/\(\?<([=!])/,func:function(match){
return (match[1]==="=")?"lookbehind":"negative lookbehind";
}},{regex:/\(\?>/,func:function(match){
return "atomic group";
}}],toRegExp:function(str){
function fail(_30da,match){
throw new Error("Unsupported regex feature \""+_30da+"\": \""+match[0]+"\" at index: "+match.index+" in "+match.input);
};
function _30db(str){
var _30dc="";
var _30dd=false;
var len=str.length;
for(var i=0;i<len;){
var chr=str.charAt(i);
if(!_30dd&&chr==="#"){
while(i<len&&chr!=="\r"&&chr!=="\n"){
chr=str.charAt(++i);
}
}else{
if(!_30dd&&/\s/.test(chr)){
while(i<len&&/\s/.test(chr)){
chr=str.charAt(++i);
}
}else{
if(chr==="\\"){
_30dc+=chr;
if(!/\s/.test(str.charAt(i+1))){
_30dc+=str.charAt(i+1);
i+=1;
}
i+=1;
}else{
if(chr==="["){
_30dd=true;
_30dc+=chr;
i+=1;
}else{
if(chr==="]"){
_30dd=false;
_30dc+=chr;
i+=1;
}else{
_30dc+=chr;
i+=1;
}
}
}
}
}
}
return _30dc;
};
var flags="";
var i;
str=_30d9.processGlobalFlag("x",str,function(_30de){
return _30db(_30de);
});
str=_30d9.processGlobalFlag("i",str,function(_30df){
flags+="i";
return _30df;
});
for(i=0;i<this.unsupported.length;i++){
var match;
if((match=this.unsupported[i].regex.exec(str))){
fail(this.unsupported[i].func(match),match);
}
}
return new RegExp(str,flags);
},processGlobalFlag:function(flag,str,_30e0){
function _30e1(pat,start){
var depth=0,len=pat.length,_30e2=-1;
for(var i=start;i<len&&_30e2===-1;i++){
switch(pat.charAt(i)){
case "\\":
i++;
break;
case "(":
depth++;
break;
case ")":
depth--;
if(depth===0){
_30e2=i;
}
break;
}
}
return _30e2;
};
var flag1="(?"+flag+")",flag2="(?"+flag+":";
if(str.substring(0,flag1.length)===flag1){
return _30e0(str.substring(flag1.length));
}else{
if(str.substring(0,flag2.length)===flag2){
var _30e3=_30e1(str,0);
if(_30e3<str.length-1){
throw new Error("Only a "+flag2+") group that encloses the entire regex is supported in: "+str);
}
return _30e0(str.substring(flag2.length,_30e3));
}
}
return str;
},hasBackReference:function(regex){
return (/\\\d+/).test(regex.source);
},getSubstitutedRegex:function(regex,sub,_30e4){
_30e4=(typeof _30e4==="undefined")?true:false;
var _30e5=regex.source.split(/(\\\d+)/g);
var array=[];
for(var i=0;i<_30e5.length;i++){
var term=_30e5[i];
var _30e6=/\\(\d+)/.exec(term);
if(_30e6){
var text=sub[_30e6[1]]||"";
array.push(_30e4?_30d8.escape(text):text);
}else{
array.push(term);
}
}
return new RegExp(array.join(""));
},groupify:function(regex,_30e7){
var _30e8=1,_30e9=2,_30ea=3,_30eb=4;
var src=regex.source,len=src.length;
var _30ec=[],_30ed=0,_30ee=[],_30ef=1,_30f0=1;
var _30f1=[],_30f2={},_30f3={};
for(var i=0;i<len;i++){
var _30f4=_30ec[_30ec.length-1];
var chr=src.charAt(i);
switch(chr){
case "(":
if(_30f4===_30eb){
_30ec.pop();
_30f1.push(")");
_30ee[_30ee.length-1].end=i;
}
var peek2=(i+2<len)?(src.charAt(i+1)+""+src.charAt(i+2)):null;
if(peek2==="?:"||peek2==="?="||peek2==="?!"){
var _30f5;
if(peek2==="?:"){
_30f5=_30e8;
}else{
_30f5=_30ea;
_30ed++;
}
_30ec.push(_30f5);
_30ee.push({start:i,end:-1,type:_30f5});
_30f1.push(chr);
_30f1.push(peek2);
i+=peek2.length;
}else{
_30ec.push(_30e9);
_30ee.push({start:i,end:-1,type:_30e9,oldNum:_30ef,num:_30f0});
_30f1.push(chr);
if(_30ed===0){
_30f3[_30f0]=null;
}
_30f2[_30ef]=_30f0;
_30ef++;
_30f0++;
}
break;
case ")":
var group=_30ec.pop();
if(group===_30ea){
_30ed--;
}
_30ee[_30ee.length-1].end=i;
_30f1.push(chr);
break;
case "*":
case "+":
case "?":
case "}":
var op=chr;
var prev=src.charAt(i-1),_30f6=i-1;
if(chr==="}"){
for(var j=i-1;src.charAt(j)!=="{"&&j>=0;j--){
}
prev=src.charAt(j-1);
_30f6=j-1;
op=src.substring(j,i+1);
}
var _30f7=_30ee[_30ee.length-1];
if(prev===")"&&(_30f7.type===_30e9||_30f7.type===_30eb)){
_30f1.splice(_30f7.start,0,"(");
_30f1.push(op);
_30f1.push(")");
var _30f8={start:_30f7.start,end:_30f1.length-1,type:_30eb,num:_30f7.num};
for(var k=0;k<_30ee.length;k++){
group=_30ee[k];
if(group.type===_30e9||group.type===_30eb){
if(group.start>=_30f7.start&&group.end<=_30f6){
group.start+=1;
group.end+=1;
group.num=group.num+1;
if(group.type===_30e9){
_30f2[group.oldNum]=group.num;
}
}
}
}
_30ee.push(_30f8);
_30f0++;
break;
}else{
}
default:
if(chr!=="|"&&_30f4!==_30e9&&_30f4!==_30eb){
if(_30ed===0){
_30ec.push(_30eb);
_30ee.push({start:i,end:-1,type:_30eb,num:_30f0});
_30f1.push("(");
_30f3[_30f0]=null;
_30f0++;
}
}
_30f1.push(chr);
if(chr==="\\"){
var peek=src.charAt(i+1);
_30f1.push(peek);
i+=1;
}
break;
}
}
while(_30ec.length){
_30ec.pop();
_30f1.push(")");
}
var _30f9=new RegExp(_30f1.join(""));
var subst={};
_30e7=_30e7||_30f2;
for(var prop in _30e7){
if(_30e7.hasOwnProperty(prop)){
subst[prop]="\\"+_30e7[prop];
}
}
_30f9=this.getSubstitutedRegex(_30f9,subst,false);
return [_30f9,_30f2,_30f3];
},complexCaptures:function(_30fa){
if(!_30fa){
return false;
}
for(var prop in _30fa){
if(_30fa.hasOwnProperty(prop)){
if(prop!=="0"){
return true;
}
}
}
return false;
}};
function _30fb(_30fc,_30fd,_30fe){
this.initialize(_30fc);
this.grammar=this.clone(_30fd);
this.externalGrammars=_30fe?this.clone(_30fe):[];
this._styles={};
this._tree=null;
this._allGrammars={};
this.preprocess(this.grammar);
};
_30fb.prototype={initialize:function(_30ff){
this.textView=_30ff;
var self=this;
this._listener={onModelChanged:function(e){
self.onModelChanged(e);
},onDestroy:function(e){
self.onDestroy(e);
},onLineStyle:function(e){
self.onLineStyle(e);
}};
_30ff.addEventListener("ModelChanged",this._listener.onModelChanged);
_30ff.addEventListener("Destroy",this._listener.onDestroy);
_30ff.addEventListener("LineStyle",this._listener.onLineStyle);
_30ff.redrawLines();
},onDestroy:function(e){
this.destroy();
},destroy:function(){
if(this.textView){
this.textView.removeEventListener("ModelChanged",this._listener.onModelChanged);
this.textView.removeEventListener("Destroy",this._listener.onDestroy);
this.textView.removeEventListener("LineStyle",this._listener.onLineStyle);
this.textView=null;
}
this.grammar=null;
this._styles=null;
this._tree=null;
this._listener=null;
},clone:function clone(obj){
var c;
if(obj instanceof Array){
c=new Array(obj.length);
for(var i=0;i<obj.length;i++){
c[i]=clone(obj[i]);
}
}else{
c={};
for(var prop in obj){
if(Object.prototype.hasOwnProperty.call(obj,prop)){
var value=obj[prop];
if(typeof value==="object"&&value!==null){
c[prop]=clone(value);
}else{
c[prop]=value;
}
}
}
}
return c;
},preprocess:function(_3100){
var stack=[_3100];
for(;stack.length!==0;){
var rule=stack.pop();
if(rule._resolvedRule&&rule._typedRule){
continue;
}
rule._resolvedRule=this._resolve(rule);
rule._typedRule=this._createTypedRule(rule);
this.addStyles(rule.name);
this.addStyles(rule.contentName);
this.addStylesForCaptures(rule.captures);
this.addStylesForCaptures(rule.beginCaptures);
this.addStylesForCaptures(rule.endCaptures);
if(rule._resolvedRule!==rule){
stack.push(rule._resolvedRule);
}
if(rule.patterns){
for(var i=0;i<rule.patterns.length;i++){
stack.push(rule.patterns[i]);
}
}
}
},addStyles:function(scope){
if(scope&&!this._styles[scope]){
this._styles[scope]=[];
var _3101=scope.split(".");
for(var i=0;i<_3101.length;i++){
this._styles[scope].push(_3101.slice(0,i+1).join("-"));
}
}
},addStylesForCaptures:function(_3102){
for(var prop in _3102){
if(_3102.hasOwnProperty(prop)){
var scope=_3102[prop].name;
this.addStyles(scope);
}
}
},ContainerRule:(function(){
function _3103(rule){
this.rule=rule;
this.subrules=rule.patterns;
};
_3103.prototype.valueOf=function(){
return "aa";
};
return _3103;
}()),BeginEndRule:(function(){
function _3104(rule){
this.rule=rule;
this.beginRegex=_30d9.toRegExp(rule.begin);
this.endRegex=_30d9.toRegExp(rule.end);
this.subrules=rule.patterns||[];
this.endRegexHasBackRef=_30d9.hasBackReference(this.endRegex);
var _3105=_30d9.complexCaptures(rule.captures);
var _3106=_30d9.complexCaptures(rule.beginCaptures)||_30d9.complexCaptures(rule.endCaptures);
this.isComplex=_3105||_3106;
if(this.isComplex){
var bg=_30d9.groupify(this.beginRegex);
this.beginRegex=bg[0];
this.beginOld2New=bg[1];
this.beginConsuming=bg[2];
var eg=_30d9.groupify(this.endRegex,this.beginOld2New);
this.endRegex=eg[0];
this.endOld2New=eg[1];
this.endConsuming=eg[2];
}
};
_3104.prototype.valueOf=function(){
return this.beginRegex;
};
return _3104;
}()),MatchRule:(function(){
function _3107(rule){
this.rule=rule;
this.matchRegex=_30d9.toRegExp(rule.match);
this.isComplex=_30d9.complexCaptures(rule.captures);
if(this.isComplex){
var mg=_30d9.groupify(this.matchRegex);
this.matchRegex=mg[0];
this.matchOld2New=mg[1];
this.matchConsuming=mg[2];
}
};
_3107.prototype.valueOf=function(){
return this.matchRegex;
};
return _3107;
}()),_createTypedRule:function(rule){
if(rule.match){
return new this.MatchRule(rule);
}else{
if(rule.begin){
return new this.BeginEndRule(rule);
}else{
return new this.ContainerRule(rule);
}
}
},_resolve:function(rule){
var _3108=rule;
if(rule.include){
if(rule.begin||rule.end||rule.match){
throw new Error("Unexpected regex pattern in \"include\" rule "+rule.include);
}
var name=rule.include;
if(name.charAt(0)==="#"){
_3108=this.grammar.repository&&this.grammar.repository[name.substring(1)];
if(!_3108){
throw new Error("Couldn't find included rule "+name+" in grammar repository");
}
}else{
if(name==="$self"){
_3108=this.grammar;
}else{
if(name==="$base"){
throw new Error("Include \"$base\" is not supported");
}else{
_3108=this._allGrammars[name];
if(!_3108){
for(var i=0;i<this.externalGrammars.length;i++){
var _3109=this.externalGrammars[i];
if(_3109.scopeName===name){
this.preprocess(_3109);
this._allGrammars[name]=_3109;
_3108=_3109;
break;
}
}
}
}
}
}
}
return _3108;
},ContainerNode:(function(){
function _310a(_310b,rule){
this.parent=_310b;
this.rule=rule;
this.children=[];
this.start=null;
this.end=null;
};
_310a.prototype.addChild=function(child){
this.children.push(child);
};
_310a.prototype.valueOf=function(){
var r=this.rule;
return "ContainerNode { "+(r.include||"")+" "+(r.name||"")+(r.comment||"")+"}";
};
return _310a;
}()),BeginEndNode:(function(){
function _310c(_310d,rule,_310e){
this.parent=_310d;
this.rule=rule;
this.children=[];
this.setStart(_310e);
this.end=null;
this.endMatch=null;
if(rule.endRegexHasBackRef){
this.endRegexSubstituted=_30d9.getSubstitutedRegex(rule.endRegex,_310e);
}else{
this.endRegexSubstituted=null;
}
};
_310c.prototype.addChild=function(child){
this.children.push(child);
};
_310c.prototype.getIndexInParent=function(node){
return this.parent?this.parent.children.indexOf(this):-1;
};
_310c.prototype.setStart=function(_310f){
this.start=_310f.index;
this.beginMatch=_310f;
};
_310c.prototype.setEnd=function(_3110){
if(_3110&&typeof (_3110)==="object"){
var _3111=_3110;
this.endMatch=_3111;
this.end=_3111.index+_3111[0].length;
}else{
var _3112=_3110;
this.endMatch=null;
this.end=_3112;
}
};
_310c.prototype.shiftStart=function(_3113){
this.start+=_3113;
this.beginMatch.index+=_3113;
};
_310c.prototype.shiftEnd=function(_3114){
this.end+=_3114;
if(this.endMatch){
this.endMatch.index+=_3114;
}
};
_310c.prototype.valueOf=function(){
return "{"+this.rule.beginRegex+" range="+this.start+".."+this.end+"}";
};
return _310c;
}()),push:function(stack,rules){
if(!rules){
return;
}
for(var i=rules.length;i>0;){
stack.push(rules[--i]);
}
},exec:function(regex,text,_3115){
var match=regex.exec(text);
if(match){
match.index+=_3115;
}
regex.lastIndex=0;
return match;
},afterMatch:function(match){
return match.index+match[0].length;
},getEndMatch:function(node,text,_3116){
if(node instanceof this.BeginEndNode){
var rule=node.rule;
var _3117=node.endRegexSubstituted||rule.endRegex;
if(!_3117){
return null;
}
return this.exec(_3117,text,_3116);
}
return null;
},initialParse:function(){
var last=this.textView.getModel().getCharCount();
var root=new this.ContainerNode(null,this.grammar._typedRule);
this._tree=root;
this.parse(this._tree,false,0);
},onModelChanged:function(e){
var _3118=e.addedCharCount,_3119=e.addedLineCount,_311a=e.removedCharCount,_311b=e.removedLineCount,start=e.start;
if(!this._tree){
this.initialParse();
}else{
var model=this.textView.getModel();
var _311c=model.getCharCount();
var rs=model.getLineEnd(model.getLineAtOffset(start)-1);
var fd=this.getFirstDamaged(rs,rs);
rs=rs===-1?0:rs;
var _311d;
if(fd){
_311d=this.parse(fd,true,rs,start,_3118,_311a);
}else{
_311d=_311c;
}
this.textView.redrawRange(rs,_311d);
}
},getFirstDamaged:function(start,end){
if(start<0){
return this._tree;
}
var nodes=[this._tree];
var _311e=null;
while(nodes.length){
var n=nodes.pop();
if(!n.parent||this.isDamaged(n,start,end)){
if(n instanceof this.BeginEndNode){
_311e=n;
}
for(var i=0;i<n.children.length;i++){
nodes.push(n.children[i]);
}
}
}
return _311e||this._tree;
},isDamaged:function(n,start,end){
return (n.start<=end&&n.end>start);
},parse:function(_311f,_3120,rs,_3121,_3122,_3123){
var model=this.textView.getModel();
var _3124=model.getLineStart(model.getLineCount()-1);
var eof=model.getCharCount();
var _3125=this.getInitialExpected(_311f,rs);
var re=-1;
if(_3120){
_311f.repaired=true;
_311f.endNeedsUpdate=true;
var _3126=_311f.children[_311f.children.length-1];
var delta=_3122-_3123;
var _3127=_3126?model.getLineEnd(model.getLineAtOffset(_3126.end+delta)):-1;
var _3128=model.getLineEnd(model.getLineAtOffset(_3121+_3123));
re=Math.max(_3127,_3128);
}
re=(re===-1)?eof:re;
var _3129=_3125;
var node=_311f;
var _312a=false;
var pos=rs;
var _312b=-1;
while(node&&(!_3120||(pos<re))){
var _312c=this.getNextMatch(model,node,pos);
if(!_312c){
pos=(pos>=_3124)?eof:model.getLineStart(model.getLineAtOffset(pos)+1);
}
var match=_312c&&_312c.match,rule=_312c&&_312c.rule,isSub=_312c&&_312c.isSub,isEnd=_312c&&_312c.isEnd;
if(isSub){
pos=this.afterMatch(match);
if(rule instanceof this.BeginEndRule){
_312a=true;
if(_3120&&rule===_3129.rule&&node===_3129.parent){
var _312d=_3129;
_312d.setStart(match);
_312d.repaired=true;
_312d.endNeedsUpdate=true;
node=_312d;
_3129=this.getNextExpected(_3129,"begin");
}else{
if(_3120){
this.prune(node,_3129);
_3120=false;
}
var _312e=new this.BeginEndNode(node,rule,match);
node.addChild(_312e);
node=_312e;
}
}else{
}
}else{
if(isEnd||pos===eof){
if(node instanceof this.BeginEndNode){
if(match){
_312a=true;
_312b=Math.max(_312b,node.end);
node.setEnd(match);
pos=this.afterMatch(match);
if(_3120&&node===_3129&&node.parent===_3129.parent){
node.repaired=true;
delete node.endNeedsUpdate;
_3129=this.getNextExpected(_3129,"end");
}else{
if(_3120){
this.prune(node,_3129);
_3120=false;
}
}
}else{
node.setEnd(eof);
delete node.endNeedsUpdate;
}
}
node=node.parent;
}
}
if(_3120&&pos>=re&&!_312a){
this.prune(_311f,_3125);
_3120=false;
}
}
this.removeUnrepairedChildren(_311f,_3120,rs);
this.cleanup(_3120,_311f,rs,re,eof,_3122,_3123);
if(_3120){
return Math.max(_312b,pos);
}else{
return pos;
}
},removeUnrepairedChildren:function(node,_312f,start){
if(_312f){
var _3130=node.children;
var _3131=-1;
for(var i=0;i<_3130.length;i++){
var child=_3130[i];
if(!child.repaired&&this.isDamaged(child,start,Number.MAX_VALUE)){
_3131=i;
break;
}
}
if(_3131!==-1){
node.children.length=_3131;
}
}
},cleanup:function(_3132,_3133,rs,re,eof,_3134,_3135){
var i,node,_3136;
if(_3132){
var delta=_3134-_3135;
var _3137=this.getIntersecting(re-delta+1,eof);
_3136=this.getIntersecting(rs,re);
for(i=0;i<_3137.length;i++){
node=_3137[i];
if(!node.repaired&&node instanceof this.BeginEndNode){
node.shiftEnd(delta);
node.shiftStart(delta);
}
}
for(i=0;i<_3136.length;i++){
node=_3136[i];
if(node.repaired&&node.endNeedsUpdate){
node.shiftEnd(delta);
}
delete node.endNeedsUpdate;
delete node.repaired;
}
}else{
_3136=this.getIntersecting(rs,re);
for(i=0;i<_3136.length;i++){
delete _3136[i].repaired;
}
}
},getNextMatch:function(model,node,pos,_3138){
var _3139=model.getLineAtOffset(pos);
var _313a=model.getLineEnd(_3139);
var line=model.getText(pos,_313a);
var stack=[],_313b=[],_313c=[],_313d=[];
this.push(stack,node.rule.subrules);
while(stack.length){
var next=stack.length?stack.pop():null;
var _313e=next&&next._resolvedRule._typedRule;
if(_313e instanceof this.ContainerRule&&_313b.indexOf(_313e)===-1){
_313b.push(_313e);
this.push(stack,_313e.subrules);
continue;
}
if(_313e&&_3138&&!(_313e.matchRegex)){
continue;
}
var _313f=_313e&&this.exec(_313e.matchRegex||_313e.beginRegex,line,pos);
if(_313f){
_313c.push(_313f);
_313d.push(_313e);
}
}
var _3140=Number.MAX_VALUE,_3141=-1;
for(var i=0;i<_313c.length;i++){
var match=_313c[i];
if(match.index<_3140){
_3140=match.index;
_3141=i;
}
}
if(!_3138){
var _3142=node;
var _3143=this.getEndMatch(node,line,pos);
if(_3143){
var _3144=_3142.rule.applyEndPatternLast;
var _3145=_3141===-1||(_3143.index<_3140)||(!_3144&&_3143.index===_3140);
if(_3145){
return {isEnd:true,rule:_3142.rule,match:_3143};
}
}
}
return _3141===-1?null:{isSub:true,rule:_313d[_3141],match:_313c[_3141]};
},getInitialExpected:function(node,rs){
var i,child;
if(node===this._tree){
for(i=0;i<node.children.length;i++){
child=node.children[i];
if(child.start>=rs){
return child;
}
}
}else{
if(node instanceof this.BeginEndNode){
if(node.endMatch){
var _3146=node.endMatch.index;
for(i=0;i<node.children.length;i++){
child=node.children[i];
if(child.start>=rs){
break;
}
}
if(child&&child.start<_3146){
return child;
}
}else{
}
}
}
return node;
},getNextExpected:function(_3147,event){
var node=_3147;
if(event==="begin"){
var child=node.children[0];
if(child){
return child;
}else{
return node;
}
}else{
if(event==="end"){
var _3148=node.parent;
if(_3148){
var _3149=_3148.children[_3148.children.indexOf(node)+1];
if(_3149){
return _3149;
}else{
return _3148;
}
}
}
}
return null;
},prune:function(node,_314a){
var _314b=_314a.parent===node;
if(_314b){
node.children.length=_314a.getIndexInParent();
}else{
if(node instanceof this.BeginEndNode){
node.endMatch=null;
node.end=null;
}
}
if(node.parent){
node.parent.children.length=node.getIndexInParent()+1;
}
},onLineStyle:function(e){
function _314c(r1,r2){
return r1.start-r2.start;
};
if(!this._tree){
this.initialParse();
}
var _314d=e.lineStart,model=this.textView.getModel(),_314e=model.getLineEnd(e.lineIndex);
var rs=model.getLineEnd(model.getLineAtOffset(_314d)-1);
var node=this.getFirstDamaged(rs,rs);
var _314f=this.getLineScope(model,node,_314d,_314e);
e.ranges=this.toStyleRanges(_314f);
e.ranges.sort(_314c);
},getLineScope:function(model,node,start,end){
var pos=start;
var _3150=this.getInitialExpected(node,start);
var _3151=[],gaps=[];
while(node&&(pos<end)){
var _3152=this.getNextMatch(model,node,pos);
if(!_3152){
break;
}
var match=_3152&&_3152.match,rule=_3152&&_3152.rule,isSub=_3152&&_3152.isSub,isEnd=_3152&&_3152.isEnd;
if(match.index!==pos){
gaps.push({start:pos,end:match.index,node:node});
}
if(isSub){
pos=this.afterMatch(match);
if(rule instanceof this.BeginEndRule){
this.addBeginScope(_3151,match,rule);
node=_3150;
_3150=this.getNextExpected(_3150,"begin");
}else{
this.addMatchScope(_3151,match,rule);
}
}else{
if(isEnd){
pos=this.afterMatch(match);
this.addEndScope(_3151,match,rule);
_3150=this.getNextExpected(_3150,"end");
node=node.parent;
}
}
}
if(pos<end){
gaps.push({start:pos,end:end,node:node});
}
var _3153=this.getInheritedLineScope(gaps,start,end);
return _3151.concat(_3153);
},getInheritedLineScope:function(gaps,start,end){
var _3154=[];
for(var i=0;i<gaps.length;i++){
var gap=gaps[i];
var node=gap.node;
while(node){
var rule=node.rule.rule;
var name=rule.name,_3155=rule.contentName;
var scope=_3155||name;
if(scope){
this.addScopeRange(_3154,gap.start,gap.end,scope);
break;
}
node=node.parent;
}
}
return _3154;
},addBeginScope:function(_3156,match,_3157){
var rule=_3157.rule;
this.addCapturesScope(_3156,match,(rule.beginCaptures||rule.captures),_3157.isComplex,_3157.beginOld2New,_3157.beginConsuming);
},addEndScope:function(_3158,match,_3159){
var rule=_3159.rule;
this.addCapturesScope(_3158,match,(rule.endCaptures||rule.captures),_3159.isComplex,_3159.endOld2New,_3159.endConsuming);
},addMatchScope:function(_315a,match,_315b){
var rule=_315b.rule,name=rule.name,_315c=rule.captures;
if(_315c){
this.addCapturesScope(_315a,match,_315c,_315b.isComplex,_315b.matchOld2New,_315b.matchConsuming);
}else{
this.addScope(_315a,match,name);
}
},addScope:function(_315d,match,name){
if(!name){
return;
}
_315d.push({start:match.index,end:this.afterMatch(match),scope:name});
},addScopeRange:function(_315e,start,end,name){
if(!name){
return;
}
_315e.push({start:start,end:end,scope:name});
},addCapturesScope:function(_315f,match,_3160,_3161,_3162,_3163){
if(!_3160){
return;
}
if(!_3161){
this.addScope(_315f,match,_3160[0]&&_3160[0].name);
}else{
var _3164={1:0};
var sum=0;
for(var num=1;match[num]!==undefined;num++){
if(_3163[num]!==undefined){
sum+=match[num].length;
}
if(match[num+1]!==undefined){
_3164[num+1]=sum;
}
}
var start=match.index;
for(var _3165=1;_3160[_3165];_3165++){
var scope=_3160[_3165].name;
var _3166=_3162[_3165];
var _3167=start+_3164[_3166];
if(typeof match[_3166]!=="undefined"){
var _3168=_3167+match[_3166].length;
this.addScopeRange(_315f,_3167,_3168,scope);
}
}
}
},getIntersecting:function(start,end){
var _3169=[];
var nodes=this._tree?[this._tree]:[];
while(nodes.length){
var n=nodes.pop();
var _316a=false;
if(n instanceof this.ContainerNode){
_316a=true;
}else{
if(this.isDamaged(n,start,end)){
_316a=true;
_3169.push(n);
}
}
if(_316a){
var len=n.children.length;
for(var i=0;i<len;i++){
nodes.push(n.children[i]);
}
}
}
return _3169.reverse();
},toStyleRanges:function(_316b){
var _316c=[];
for(var i=0;i<_316b.length;i++){
var _316d=_316b[i];
var _316e=this._styles[_316d.scope];
if(!_316e){
throw new Error("styles not found for "+_316d.scope);
}
var _316f=_316e.join(" ");
_316c.push({start:_316d.start,end:_316d.end,style:{styleClass:_316f}});
}
return _316c;
}};
return {RegexUtil:_30d9,TextMateStyler:_30fb};
});
},"davinci/ve/actions/ContextAction":function(){
define(["dojo/_base/declare","davinci/actions/Action"],function(_3170,_3171){
return _3170("davinci.ve.actions.ContextAction",[_3171],{_normalizeSelection:function(_3172){
var _3173=_3172.getSelection();
if(_3173.length<2){
return _3173;
}
var _3174=_3172.rootWidget;
var roots=[];
dojo.forEach(_3173,function(w){
var p=w.getParent();
while(p&&p!=_3174){
for(var i=0;i<_3173.length;i++){
if(_3173[i]==p){
_3172.deselect(w);
return;
}
}
p=p.getParent();
}
roots.push(w);
});
return roots;
},_getEditor:function(){
return top.davinci&&top.davinci.Runtime&&top.davinci.Runtime.currentEditor;
},_getContext:function(_3175){
if(_3175){
return _3175;
}
var _3176=this._getEditor();
return _3176&&(_3176.getContext&&_3176.getContext()||_3176.context);
},fixupContext:function(_3177){
var obj=this._getContext(_3177);
if(obj.declaredClass=="davinci.ve.Context"){
return obj;
}else{
if(typeof obj.getContext=="function"){
return obj.getContext();
}else{
return null;
}
}
}});
});
},"*now":function(r){
r(["dojo/i18n!*preload*davinci/nls/davinci*[\"ar\",\"ca\",\"cs\",\"da\",\"de\",\"el\",\"en-gb\",\"en-us\",\"es-es\",\"fi-fi\",\"fr-fr\",\"he-il\",\"hu\",\"it-it\",\"ja-jp\",\"ko-kr\",\"nl-nl\",\"nb\",\"pl\",\"pt-br\",\"pt-pt\",\"ru\",\"sk\",\"sl\",\"sv\",\"th\",\"tr\",\"zh-tw\",\"zh-cn\",\"ROOT\"]"]);
}}});
define("davinci/davinci",["dijit/dijit","./Workbench","./workbench/Explorer","./workbench/OutlineView","./workbench/ProblemsView","./ve/palette/HtmlWidgets","./ve/views/StatesView","./ve/views/SwitchingStyleView","./ve/palette/ImageDragSource","./actions/UndoAction","./actions/SelectThemeAction","./actions/SelectLayoutAction","./actions/RedoAction","./actions/DownloadAction","./actions/StickyNoteAction","./actions/SaveAsWidget","./actions/UserNameAction","./actions/LogoutAction","./ve/actions/CopyAction","./ve/actions/CutAction","./ve/actions/DeleteAction","./ve/actions/PasteAction","./ve/actions/DuplicateAction","./ve/actions/EditValueAction","./ve/actions/EditPropertiesAction","./ve/actions/ChooseDeviceAction","./ve/actions/RotateDeviceAction","./ve/actions/SurroundAction","./ve/actions/SelectParentAction","./ve/actions/SelectAncestorAction","./ve/actions/UnselectAllAction","./ve/actions/ArrangeAction","./ve/actions/MoveToFrontAction","./ve/actions/MoveToBackAction","./ve/actions/MoveForwardAction","./ve/actions/MoveBackwardAction","./ve/actions/OtherAction","./ve/actions/EnableApplicationStates","./ve/actions/ViewDesignAction","./ve/actions/ViewSourceAction","./ve/actions/ViewSourceMenuAction","./ve/actions/ViewSplitHMenuAction","./ve/actions/ViewSplitVMenuAction","./ve/actions/AddState","./ve/actions/RemoveState","./ve/actions/ModifyState","./ve/PageEditor","./html/ui/CSSEditor","./html/ui/HTMLEditor","./html/ui/ImageViewer","./js/ui/JavaScriptEditor","./ve/prefs/HTMLEditPreferences","./review/view/CommentExplorerView","./review/actions/ViewFileAction","./review/actions/DeleteVersionAction","./review/actions/RestartVersionAction","dijit/layout/LayoutContainer","./commands/OrderedCompoundCommand","./version"],function(){
});
